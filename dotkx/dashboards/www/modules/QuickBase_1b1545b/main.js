define(["backbone","Pickr","flatpickr","rangePlugin","confirmDatePlugin","Handlebars","patternomaly","dashMoment","fflate","css!./css/app.css"],function(f,B,U,q,F,s,Y,h,H){var K,Q,z,W,l,G,j,X,Z,J,tt,et,nt,it,ot,e=this&&this.__extends||(K=function(t,e){return(K=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}))(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}K(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),st=this&&this.__spreadArray||function(t,e,n){if(n||2===arguments.length)for(var i,o=0,s=e.length;o<s;o++)!i&&o in e||((i=i||Array.prototype.slice.call(e,0,o))[o]=e[o]);return t.concat(i||Array.prototype.slice.call(e))},at=this&&this.__assign||function(){return(at=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},rt=this&&this.__awaiter||function(t,a,r,l){return new(r=r||Promise)(function(n,e){function i(t){try{s(l.next(t))}catch(t){e(t)}}function o(t){try{s(l.throw(t))}catch(t){e(t)}}function s(t){var e;t.done?n(t.value):((e=t.value)instanceof r?e:new r(function(t){t(e)})).then(i,o)}s((l=l.apply(t,a||[])).next())})},lt=this&&this.__generator||function(i,o){var s,a,r,l={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(n){return function(t){var e=[n,t];if(s)throw new TypeError("Generator is already executing.");for(;l;)try{if(s=1,a&&(r=2&e[0]?a.return:e[0]?a.throw||((r=a.return)&&r.call(a),0):a.next)&&!(r=r.call(a,e[1])).done)return r;switch(a=0,(e=r?[2&e[0],r.value]:e)[0]){case 0:case 1:r=e;break;case 4:return l.label++,{value:e[1],done:!1};case 5:l.label++,a=e[1],e=[0];continue;case 7:e=l.ops.pop(),l.trys.pop();continue;default:if(!(r=0<(r=l.trys).length&&r[r.length-1])&&(6===e[0]||2===e[0])){l=0;continue}if(3===e[0]&&(!r||e[1]>r[0]&&e[1]<r[3]))l.label=e[1];else if(6===e[0]&&l.label<r[1])l.label=r[1],r=e;else{if(!(r&&l.label<r[2])){r[2]&&l.ops.pop(),l.trys.pop();continue}l.label=r[2],l.ops.push(e)}}e=o.call(i,l)}catch(t){e=[6,t],a=0}finally{s=r=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}}},ut=function(){var t;function y(t,e,n){null!=t&&("number"==typeof t?this.fromNumber(t,e,n):null==e&&"string"!=typeof t?this.fromBytes(t):this.fromString(t,e))}function v(){return new y(null)}t="Microsoft Internet Explorer"==navigator.appName?(y.prototype.am=function(t,e,n,i,o,s){for(var a=32767&e,r=e>>15;0<=--s;){var l=32767&this[t],u=this[t++]>>15,c=r*l+u*a;o=((l=a*l+((32767&c)<<15)+n[i]+(1073741823&o))>>>30)+(c>>>15)+r*u+(o>>>30),n[i++]=1073741823&l}return o},30):"Netscape"!=navigator.appName?(y.prototype.am=function(t,e,n,i,o,s){for(;0<=--s;){var a=e*this[t++]+n[i]+o;o=Math.floor(a/67108864),n[i++]=67108863&a}return o},26):(y.prototype.am=function(t,e,n,i,o,s){for(var a=16383&e,r=e>>14;0<=--s;){var l=16383&this[t],u=this[t++]>>14,c=r*l+u*a;o=((l=a*l+((16383&c)<<14)+n[i]+o)>>28)+(c>>14)+r*u,n[i++]=268435455&l}return o},28),y.prototype.DB=t,y.prototype.DM=(1<<t)-1,y.prototype.DV=1<<t;y.prototype.FV=Math.pow(2,52),y.prototype.F1=52-t,y.prototype.F2=2*t-52;for(var e="0123456789abcdefghijklmnopqrstuvwxyz",n=new Array,i="0".charCodeAt(0),o=0;o<=9;++o)n[i++]=o;for(i="a".charCodeAt(0),o=10;o<36;++o)n[i++]=o;for(i="A".charCodeAt(0),o=10;o<36;++o)n[i++]=o;function l(t){return e.charAt(t)}function u(t,e){t=n[t.charCodeAt(e)];return null==t?-1:t}function f(t){var e=v();return e.fromInt(t),e}function b(t){var e,n=1;return 0!=(e=t>>>16)&&(t=e,n+=16),0!=(e=t>>8)&&(t=e,n+=8),0!=(e=t>>4)&&(t=e,n+=4),0!=(e=t>>2)&&(t=e,n+=2),0!=(e=t>>1)&&(t=e,n+=1),n}function S(t){this.m=t}function w(t){this.m=t,this.mp=t.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<t.DB-15)-1,this.mt2=2*t.t}function s(t,e){return t&e}function a(t,e){return t|e}function r(t,e){return t^e}function c(t,e){return t&~e}function p(){}function d(t){return t}function _(t){this.r2=v(),this.q3=v(),y.ONE.dlShiftTo(2*t.t,this.r2),this.mu=this.r2.divide(t),this.m=t}S.prototype.convert=function(t){return t.s<0||0<=t.compareTo(this.m)?t.mod(this.m):t},S.prototype.revert=function(t){return t},S.prototype.reduce=function(t){t.divRemTo(this.m,null,t)},S.prototype.mulTo=function(t,e,n){t.multiplyTo(e,n),this.reduce(n)},S.prototype.sqrTo=function(t,e){t.squareTo(e),this.reduce(e)},w.prototype.convert=function(t){var e=v();return t.abs().dlShiftTo(this.m.t,e),e.divRemTo(this.m,null,e),t.s<0&&0<e.compareTo(y.ZERO)&&this.m.subTo(e,e),e},w.prototype.revert=function(t){var e=v();return t.copyTo(e),this.reduce(e),e},w.prototype.reduce=function(t){for(;t.t<=this.mt2;)t[t.t++]=0;for(var e=0;e<this.m.t;++e){var n=32767&t[e],i=n*this.mpl+((n*this.mph+(t[e]>>15)*this.mpl&this.um)<<15)&t.DM;for(t[n=e+this.m.t]+=this.m.am(0,i,t,e,0,this.m.t);t[n]>=t.DV;)t[n]-=t.DV,t[++n]++}t.clamp(),t.drShiftTo(this.m.t,t),0<=t.compareTo(this.m)&&t.subTo(this.m,t)},w.prototype.mulTo=function(t,e,n){t.multiplyTo(e,n),this.reduce(n)},w.prototype.sqrTo=function(t,e){t.squareTo(e),this.reduce(e)},y.prototype.copyTo=function(t){for(var e=this.t-1;0<=e;--e)t[e]=this[e];t.t=this.t,t.s=this.s},y.prototype.fromInt=function(t){this.t=1,this.s=t<0?-1:0,0<t?this[0]=t:t<-1?this[0]=t+this.DV:this.t=0},y.prototype.fromString=function(t,e){var n;if(16==e)n=4;else if(8==e)n=3;else if(256==e)n=8;else if(2==e)n=1;else if(32==e)n=5;else{if(4!=e)return void this.fromRadix(t,e);n=2}this.t=0,this.s=0;for(var i=t.length,o=!1,s=0;0<=--i;){var a=8==n?255&t[i]:u(t,i);a<0?"-"==t.charAt(i)&&(o=!0):(o=!1,0==s?this[this.t++]=a:s+n>this.DB?(this[this.t-1]|=(a&(1<<this.DB-s)-1)<<s,this[this.t++]=a>>this.DB-s):this[this.t-1]|=a<<s,(s+=n)>=this.DB&&(s-=this.DB))}8==n&&0!=(128&t[0])&&(this.s=-1,0<s)&&(this[this.t-1]|=(1<<this.DB-s)-1<<s),this.clamp(),o&&y.ZERO.subTo(this,this)},y.prototype.fromBytes=function(t){this.t=0;for(var e=-1,n=this.s=0;++e<t.length;){var i=255&t[e];0==n?this[this.t++]=i:n+8>this.DB?(this[this.t-1]|=(i&(1<<this.DB-n)-1)<<n,this[this.t++]=i>>this.DB-n):this[this.t-1]|=i<<n,(n+=8)>=this.DB&&(n-=this.DB)}0!=(128&t[t.length-1])&&(this.s=-1,0<n)&&(this[this.t-1]|=(1<<this.DB-n)-1<<n),this.clamp()},y.prototype.clamp=function(){for(var t=this.s&this.DM;0<this.t&&this[this.t-1]==t;)--this.t},y.prototype.dlShiftTo=function(t,e){for(var n=this.t-1;0<=n;--n)e[n+t]=this[n];for(n=t-1;0<=n;--n)e[n]=0;e.t=this.t+t,e.s=this.s},y.prototype.drShiftTo=function(t,e){for(var n=t;n<this.t;++n)e[n-t]=this[n];e.t=Math.max(this.t-t,0),e.s=this.s},y.prototype.lShiftTo=function(t,e){for(var n=t%this.DB,i=this.DB-n,o=(1<<i)-1,s=Math.floor(t/this.DB),a=this.s<<n&this.DM,r=this.t-1;0<=r;--r)e[r+s+1]=this[r]>>i|a,a=(this[r]&o)<<n;for(r=s-1;0<=r;--r)e[r]=0;e[s]=a,e.t=this.t+s+1,e.s=this.s,e.clamp()},y.prototype.rShiftTo=function(t,e){e.s=this.s;var n=Math.floor(t/this.DB);if(n>=this.t)e.t=0;else{var i=t%this.DB,o=this.DB-i,s=(1<<i)-1;e[0]=this[n]>>i;for(var a=n+1;a<this.t;++a)e[a-n-1]|=(this[a]&s)<<o,e[a-n]=this[a]>>i;0<i&&(e[this.t-n-1]|=(this.s&s)<<o),e.t=this.t-n,e.clamp()}},y.prototype.subTo=function(t,e){for(var n=0,i=0,o=Math.min(t.t,this.t);n<o;)i+=this[n]-t[n],e[n++]=i&this.DM,i>>=this.DB;if(t.t<this.t){for(i-=t.s;n<this.t;)i+=this[n],e[n++]=i&this.DM,i>>=this.DB;i+=this.s}else{for(i+=this.s;n<t.t;)i-=t[n],e[n++]=i&this.DM,i>>=this.DB;i-=t.s}e.s=i<0?-1:0,i<-1?e[n++]=this.DV+i:0<i&&(e[n++]=i),e.t=n,e.clamp()},y.prototype.multiplyTo=function(t,e){var n=this.abs(),i=t.abs(),o=n.t;for(e.t=o+i.t;0<=--o;)e[o]=0;for(o=0;o<i.t;++o)e[o+n.t]=n.am(0,i[o],e,o,0,n.t);e.s=0,e.clamp(),this.s!=t.s&&y.ZERO.subTo(e,e)},y.prototype.squareTo=function(t){for(var e=this.abs(),n=t.t=2*e.t;0<=--n;)t[n]=0;for(n=0;n<e.t-1;++n){var i=e.am(n,e[n],t,2*n,0,1);(t[n+e.t]+=e.am(n+1,2*e[n],t,2*n+1,i,e.t-n-1))>=e.DV&&(t[n+e.t]-=e.DV,t[n+e.t+1]=1)}0<t.t&&(t[t.t-1]+=e.am(n,e[n],t,2*n,0,1)),t.s=0,t.clamp()},y.prototype.divRemTo=function(t,e,n){var i=t.abs();if(!(i.t<=0)){var o=this.abs();if(o.t<i.t)null!=e&&e.fromInt(0),null!=n&&this.copyTo(n);else{null==n&&(n=v());var s=v(),a=this.s,t=t.s,r=this.DB-b(i[i.t-1]),l=(0<r?(i.lShiftTo(r,s),o.lShiftTo(r,n)):(i.copyTo(s),o.copyTo(n)),s.t),u=s[l-1];if(0!=u){var i=u*(1<<this.F1)+(1<l?s[l-2]>>this.F2:0),c=this.FV/i,p=(1<<this.F1)/i,d=1<<this.F2,h=n.t,g=h-l,m=null==e?v():e;for(s.dlShiftTo(g,m),0<=n.compareTo(m)&&(n[n.t++]=1,n.subTo(m,n)),y.ONE.dlShiftTo(l,m),m.subTo(s,s);s.t<l;)s[s.t++]=0;for(;0<=--g;){var f=n[--h]==u?this.DM:Math.floor(n[h]*c+(n[h-1]+d)*p);if((n[h]+=s.am(0,f,n,g,0,l))<f)for(s.dlShiftTo(g,m),n.subTo(m,n);n[h]<--f;)n.subTo(m,n)}null!=e&&(n.drShiftTo(l,e),a!=t)&&y.ZERO.subTo(e,e),n.t=l,n.clamp(),0<r&&n.rShiftTo(r,n),a<0&&y.ZERO.subTo(n,n)}}}},y.prototype.invDigit=function(){var t,e;return this.t<1||0==(1&(t=this[0]))?0:0<(e=(e=(e=(e=(e=3&t)*(2-(15&t)*e)&15)*(2-(255&t)*e)&255)*(2-((65535&t)*e&65535))&65535)*(2-t*e%this.DV)%this.DV)?this.DV-e:-e},y.prototype.isEven=function(){return 0==(0<this.t?1&this[0]:this.s)},y.prototype.exp=function(t,e){if(4294967295<t||t<1)return y.ONE;var n,i=v(),o=v(),s=e.convert(this),a=b(t)-1;for(s.copyTo(i);0<=--a;)e.sqrTo(i,o),0<(t&1<<a)?e.mulTo(o,s,i):(n=i,i=o,o=n);return e.revert(i)},y.prototype.toString=function(t){if(this.s<0)return"-"+this.negate().toString(t);var e;if(16==t)e=4;else if(8==t)e=3;else if(2==t)e=1;else if(32==t)e=5;else{if(4!=t)return this.toRadix(t);e=2}var n,i=(1<<e)-1,o=!1,s="",a=this.t,r=this.DB-a*this.DB%e;if(0<a--)for(r<this.DB&&0<(n=this[a]>>r)&&(o=!0,s=l(n));0<=a;)r<e?(n=(this[a]&(1<<r)-1)<<e-r,n|=this[--a]>>(r+=this.DB-e)):(n=this[a]>>(r-=e)&i,r<=0&&(r+=this.DB,--a)),(o=0<n?!0:o)&&(s+=l(n));return o?s:"0"},y.prototype.negate=function(){var t=v();return y.ZERO.subTo(this,t),t},y.prototype.abs=function(){return this.s<0?this.negate():this},y.prototype.compareTo=function(t){var e=this.s-t.s;if(0!=e)return e;var n=this.t;if(0!=(e=n-t.t))return this.s<0?-e:e;for(;0<=--n;)if(0!=(e=this[n]-t[n]))return e;return 0},y.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+b(this[this.t-1]^this.s&this.DM)},y.prototype.mod=function(t){var e=v();return this.abs().divRemTo(t,null,e),this.s<0&&0<e.compareTo(y.ZERO)&&t.subTo(e,e),e},y.prototype.modPowInt=function(t,e){return e=new(t<256||e.isEven()?S:w)(e),this.exp(t,e)},y.ZERO=f(0),y.ONE=f(1),p.prototype.convert=d,p.prototype.revert=d,p.prototype.mulTo=function(t,e,n){t.multiplyTo(e,n)},p.prototype.sqrTo=function(t,e){t.squareTo(e)},_.prototype.convert=function(t){var e;return t.s<0||t.t>2*this.m.t?t.mod(this.m):t.compareTo(this.m)<0?t:(e=v(),t.copyTo(e),this.reduce(e),e)},_.prototype.revert=function(t){return t},_.prototype.reduce=function(t){for(t.drShiftTo(this.m.t-1,this.r2),t.t>this.m.t+1&&(t.t=this.m.t+1,t.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);t.compareTo(this.r2)<0;)t.dAddOffset(1,this.m.t+1);for(t.subTo(this.r2,t);0<=t.compareTo(this.m);)t.subTo(this.m,t)},_.prototype.mulTo=function(t,e,n){t.multiplyTo(e,n),this.reduce(n)},_.prototype.sqrTo=function(t,e){t.squareTo(e),this.reduce(e)};var h=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],g=(1<<26)/h[h.length-1];return y.prototype.chunkSize=function(t){return Math.floor(Math.LN2*this.DB/Math.log(t))},y.prototype.toRadix=function(t){if(null==t&&(t=10),0==this.signum()||t<2||36<t)return"0";var e=this.chunkSize(t),n=Math.pow(t,e),i=f(n),o=v(),s=v(),a="";for(this.divRemTo(i,o,s);0<o.signum();)a=(n+s.intValue()).toString(t).substr(1)+a,o.divRemTo(i,o,s);return s.intValue().toString(t)+a},y.prototype.fromRadix=function(t,e){this.fromInt(0);for(var n=this.chunkSize(e=null==e?10:e),i=Math.pow(e,n),o=!1,s=0,a=0,r=0;r<t.length;++r){var l=u(t,r);l<0?"-"==t.charAt(r)&&0==this.signum()&&(o=!0):(a=e*a+l,++s>=n&&(this.dMultiply(i),this.dAddOffset(a,0),a=s=0))}0<s&&(this.dMultiply(Math.pow(e,s)),this.dAddOffset(a,0)),o&&y.ZERO.subTo(this,this)},y.prototype.fromNumber=function(t,e,n){if("number"==typeof e)if(t<2)this.fromInt(1);else for(this.fromNumber(t,n),this.testBit(t-1)||this.bitwiseTo(y.ONE.shiftLeft(t-1),a,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(e);)this.dAddOffset(2,0),this.bitLength()>t&&this.subTo(y.ONE.shiftLeft(t-1),this);else{var n=new Array,i=7&t;n.length=1+(t>>3),e.nextBytes(n),0<i?n[0]&=(1<<i)-1:n[0]=0,this.fromString(n,256)}},y.prototype.bitwiseTo=function(t,e,n){for(var i,o=Math.min(t.t,this.t),s=0;s<o;++s)n[s]=e(this[s],t[s]);if(t.t<this.t){for(i=t.s&this.DM,s=o;s<this.t;++s)n[s]=e(this[s],i);n.t=this.t}else{for(i=this.s&this.DM,s=o;s<t.t;++s)n[s]=e(i,t[s]);n.t=t.t}n.s=e(this.s,t.s),n.clamp()},y.prototype.changeBit=function(t,e){return t=y.ONE.shiftLeft(t),this.bitwiseTo(t,e,t),t},y.prototype.addTo=function(t,e){for(var n=0,i=0,o=Math.min(t.t,this.t);n<o;)i+=this[n]+t[n],e[n++]=i&this.DM,i>>=this.DB;if(t.t<this.t){for(i+=t.s;n<this.t;)i+=this[n],e[n++]=i&this.DM,i>>=this.DB;i+=this.s}else{for(i+=this.s;n<t.t;)i+=t[n],e[n++]=i&this.DM,i>>=this.DB;i+=t.s}e.s=i<0?-1:0,0<i?e[n++]=i:i<-1&&(e[n++]=this.DV+i),e.t=n,e.clamp()},y.prototype.dMultiply=function(t){this[this.t]=this.am(0,t-1,this,0,0,this.t),++this.t,this.clamp()},y.prototype.dAddOffset=function(t,e){if(0!=t){for(;this.t<=e;)this[this.t++]=0;for(this[e]+=t;this[e]>=this.DV;)this[e]-=this.DV,++e>=this.t&&(this[this.t++]=0),++this[e]}},y.prototype.multiplyLowerTo=function(t,e,n){var i,o=Math.min(this.t+t.t,e);for(n.s=0,n.t=o;0<o;)n[--o]=0;for(i=n.t-this.t;o<i;++o)n[o+this.t]=this.am(0,t[o],n,o,0,this.t);for(i=Math.min(t.t,e);o<i;++o)this.am(0,t[o],n,o,0,e-o);n.clamp()},y.prototype.multiplyUpperTo=function(t,e,n){var i=n.t=this.t+t.t- --e;for(n.s=0;0<=--i;)n[i]=0;for(i=Math.max(e-this.t,0);i<t.t;++i)n[this.t+i-e]=this.am(e-i,t[i],n,0,0,this.t+i-e);n.clamp(),n.drShiftTo(1,n)},y.prototype.modInt=function(t){if(t<=0)return 0;var e=this.DV%t,n=this.s<0?t-1:0;if(0<this.t)if(0==e)n=this[0]%t;else for(var i=this.t-1;0<=i;--i)n=(e*n+this[i])%t;return n},y.prototype.millerRabin=function(t){var e=this.subtract(y.ONE),n=e.getLowestSetBit();if(n<=0)return!1;for(var i=e.shiftRight(n),o=(h.length<(t=t+1>>1)&&(t=h.length),v()),s=0;s<t;++s){o.fromInt(h[Math.floor(Math.random()*h.length)]);var a=o.modPow(i,this);if(0!=a.compareTo(y.ONE)&&0!=a.compareTo(e)){for(var r=1;r++<n&&0!=a.compareTo(e);)if(0==(a=a.modPowInt(2,this)).compareTo(y.ONE))return!1;if(0!=a.compareTo(e))return!1}}return!0},y.prototype.clone=function(){var t=v();return this.copyTo(t),t},y.prototype.intValue=function(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},y.prototype.byteValue=function(){return 0==this.t?this.s:this[0]<<24>>24},y.prototype.shortValue=function(){return 0==this.t?this.s:this[0]<<16>>16},y.prototype.signum=function(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1},y.prototype.toByteArray=function(){var t,e=this.t,n=new Array,i=(n[0]=this.s,this.DB-e*this.DB%8),o=0;if(0<e--)for(i<this.DB&&(t=this[e]>>i)!=(this.s&this.DM)>>i&&(n[o++]=t|this.s<<this.DB-i);0<=e;)i<8?(t=(this[e]&(1<<i)-1)<<8-i,t|=this[--e]>>(i+=this.DB-8)):(t=this[e]>>(i-=8)&255,i<=0&&(i+=this.DB,--e)),0!=(128&t)&&(t|=-256),0==o&&(128&this.s)!=(128&t)&&++o,(0<o||t!=this.s)&&(n[o++]=t);return n},y.prototype.equals=function(t){return 0==this.compareTo(t)},y.prototype.min=function(t){return this.compareTo(t)<0?this:t},y.prototype.max=function(t){return 0<this.compareTo(t)?this:t},y.prototype.and=function(t){var e=v();return this.bitwiseTo(t,s,e),e},y.prototype.or=function(t){var e=v();return this.bitwiseTo(t,a,e),e},y.prototype.xor=function(t){var e=v();return this.bitwiseTo(t,r,e),e},y.prototype.andNot=function(t){var e=v();return this.bitwiseTo(t,c,e),e},y.prototype.not=function(){for(var t=v(),e=0;e<this.t;++e)t[e]=this.DM&~this[e];return t.t=this.t,t.s=~this.s,t},y.prototype.shiftLeft=function(t){var e=v();return t<0?this.rShiftTo(-t,e):this.lShiftTo(t,e),e},y.prototype.shiftRight=function(t){var e=v();return t<0?this.lShiftTo(-t,e):this.rShiftTo(t,e),e},y.prototype.getLowestSetBit=function(){for(var t,e,n=0;n<this.t;++n)if(0!=this[n])return n*this.DB+(t=this[n],e=void 0,0==t?-1:((e=0)==(65535&t)&&(t>>=16,e+=16),0==(255&t)&&(t>>=8,e+=8),0==(15&t)&&(t>>=4,e+=4),0==(3&t)&&(t>>=2,e+=2),0==(1&t)&&++e,e));return this.s<0?this.t*this.DB:-1},y.prototype.bitCount=function(){for(var t=0,e=this.s&this.DM,n=0;n<this.t;++n)t+=function(t){for(var e=0;0!=t;)t&=t-1,++e;return e}(this[n]^e);return t},y.prototype.testBit=function(t){var e=Math.floor(t/this.DB);return e>=this.t?0!=this.s:0!=(this[e]&1<<t%this.DB)},y.prototype.setBit=function(t){return this.changeBit(t,a)},y.prototype.clearBit=function(t){return this.changeBit(t,c)},y.prototype.flipBit=function(t){return this.changeBit(t,r)},y.prototype.add=function(t){var e=v();return this.addTo(t,e),e},y.prototype.subtract=function(t){var e=v();return this.subTo(t,e),e},y.prototype.multiply=function(t){var e=v();return this.multiplyTo(t,e),e},y.prototype.divide=function(t){var e=v();return this.divRemTo(t,e,null),e},y.prototype.remainder=function(t){var e=v();return this.divRemTo(t,null,e),e},y.prototype.divideAndRemainder=function(t){var e=v(),n=v();return this.divRemTo(t,e,n),new Array(e,n)},y.prototype.modPow=function(t,e){var n=t.bitLength(),i=f(1);if(n<=0)return i;var o=n<18?1:n<48?3:n<144?4:n<768?5:6,s=new(n<8?S:e.isEven()?_:w)(e),a=new Array,r=3,l=o-1,u=(1<<o)-1;if(a[1]=s.convert(this),1<o){var c=v();for(s.sqrTo(a[1],c);r<=u;)a[r]=v(),s.mulTo(c,a[r-2],a[r]),r+=2}for(var p,d,h=t.t-1,g=!0,m=v(),n=b(t[h])-1;0<=h;){for(l<=n?p=t[h]>>n-l&u:(p=(t[h]&(1<<n+1)-1)<<l-n,0<h&&(p|=t[h-1]>>this.DB+n-l)),r=o;0==(1&p);)p>>=1,--r;if((n-=r)<0&&(n+=this.DB,--h),g)a[p].copyTo(i),g=!1;else{for(;1<r;)s.sqrTo(i,m),s.sqrTo(m,i),r-=2;0<r?s.sqrTo(i,m):(d=i,i=m,m=d),s.mulTo(m,a[p],i)}for(;0<=h&&0==(t[h]&1<<n);)s.sqrTo(i,m),d=i,i=m,m=d,--n<0&&(n=this.DB-1,--h)}return s.revert(i)},y.prototype.modInverse=function(t){var e=t.isEven();if(this.isEven()&&e||0==t.signum())return y.ZERO;for(var n=t.clone(),i=this.clone(),o=f(1),s=f(0),a=f(0),r=f(1);0!=n.signum();){for(;n.isEven();)n.rShiftTo(1,n),e?(o.isEven()&&s.isEven()||(o.addTo(this,o),s.subTo(t,s)),o.rShiftTo(1,o)):s.isEven()||s.subTo(t,s),s.rShiftTo(1,s);for(;i.isEven();)i.rShiftTo(1,i),e?(a.isEven()&&r.isEven()||(a.addTo(this,a),r.subTo(t,r)),a.rShiftTo(1,a)):r.isEven()||r.subTo(t,r),r.rShiftTo(1,r);0<=n.compareTo(i)?(n.subTo(i,n),e&&o.subTo(a,o),s.subTo(r,s)):(i.subTo(n,i),e&&a.subTo(o,a),r.subTo(s,r))}return 0!=i.compareTo(y.ONE)?y.ZERO:0<=r.compareTo(t)?r.subtract(t):r.signum()<0&&(r.addTo(t,r),r.signum()<0)?r.add(t):r},y.prototype.pow=function(t){return this.exp(t,new p)},y.prototype.gcd=function(t){var e=this.s<0?this.negate():this.clone(),n=t.s<0?t.negate():t.clone(),i=(e.compareTo(n)<0&&(t=e,e=n,n=t),e.getLowestSetBit());if((t=n.getLowestSetBit())<0)return e;for(0<(t=i<t?i:t)&&(e.rShiftTo(t,e),n.rShiftTo(t,n));0<e.signum();)0<(i=e.getLowestSetBit())&&e.rShiftTo(i,e),0<(i=n.getLowestSetBit())&&n.rShiftTo(i,n),0<=e.compareTo(n)?(e.subTo(n,e),e.rShiftTo(1,e)):(n.subTo(e,n),n.rShiftTo(1,n));return 0<t&&n.lShiftTo(t,n),n},y.prototype.isProbablePrime=function(t){var e,n=this.abs();if(1==n.t&&n[0]<=h[h.length-1]){for(e=0;e<h.length;++e)if(n[0]==h[e])return!0;return!1}if(n.isEven())return!1;for(e=1;e<h.length;){for(var i=h[e],o=e+1;o<h.length&&i<g;)i*=h[o++];for(i=n.modInt(i);e<o;)if(i%h[e++]==0)return!1}return n.millerRabin(t)},y.prototype.square=function(){var t=v();return this.squareTo(t),t},{BigInteger:y}}(),ct={VALUE_CREATED:"created",VALUE_UPDATED:"updated",VALUE_DELETED:"deleted",VALUE_UNCHANGED:"unchanged",getDiff:function(t,e){return this.removeUnchanged(this.map(t,e))},map:function(t,e){if(this.isFunction(t)||this.isFunction(e))throw"Invalid argument. Function given, object expected.";if(this.isValue(t)||this.isValue(e))return _.clone(void 0===t?e:t);var n,i,o={};for(i in t)this.isFunction(t[i])||((n=void 0)!==e[i]&&(n=e[i]),"_Hidden"===i?o[i]=t[i]:"unchanged"!==this.compareValues(t[i],n)?o[i]=this.map(t[i],n):o[i]=null);for(i in e)this.isFunction(e[i])||void 0!==o[i]||(o[i]=this.map(void 0,e[i]));return o},compareValues:function(t,e){return t===e||this.isDate(t)&&this.isDate(e)&&t.getTime()===e.getTime()?this.VALUE_UNCHANGED:void 0===t?this.VALUE_CREATED:void 0===e?this.VALUE_DELETED:this.VALUE_UPDATED},isFunction:function(t){return"[object Function]"==={}.toString.apply(t)},isArray:function(t){return"[object Array]"==={}.toString.apply(t)},isDate:function(t){return"[object Date]"==={}.toString.apply(t)},isObject:function(t){return"[object Object]"==={}.toString.apply(t)},isValue:function(t){return!this.isObject(t)&&!this.isArray(t)},removeUnchangedJSON:function(n){_.each(n,_.bind(function(t,e){_.isEqual(t,{})||_.isEqual([],t)||null===t?delete n[e]:_.isArray(t)||"string"==typeof t||this.removeUnchangedJSON(n[e])},this))},removeUsedKeys:function(t){for(var e in t)null!==t[e]&&"object"==typeof t[e]&&(this.removeUsedKeys(t[e]),_.isEqual(t[e],{}))&&delete t[e],null===t[e]&&delete t[e]},removeUnchanged:function(t){var n={},i=["string","number","boolean"];return _.each(t,_.bind(function(t,e){0<=_.indexOf(i,typeof t)||null===t&&_.isArray(t)?n[e]=t:n[e]=_.pickBy(t,function(t,e){return null!==t})},this)),this.removeUsedKeys(n),n}};function a(){}function o(){}function pt(){}function dt(){}function ht(t){return encodeURIComponent(t)}function gt(t,e){t=function(t){0===t.indexOf('"')&&(t=t.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return t=decodeURIComponent(t.replace(j," "))}catch(t){}}(t);return G.isFunction(e)?e(t):t}function mt(){this.perf={}}function r(){}function ft(){}function yt(t,e,n,i){i=J.call(this,i,t)||this;return i.isSorted=e,i.length=n,i}function vt(t){switch(t){case 1:case 4:case 10:return 1;case 5:return 2;case 6:case 8:case 13:case 14:case 17:case 18:case 19:return 4;case 7:case 9:case 12:case 15:case 16:return 8;case 2:return 16;default:return}}function bt(t){for(var e,n,i,o="",s=0;s<t.length;s++)switch((e=t[s])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(e);break;case 12:case 13:n=t[++s],o+=String.fromCharCode((31&e)<<6|63&n);break;case 14:n=t[++s],i=t[++s],o+=String.fromCharCode((15&e)<<12|(63&n)<<6|(63&i)<<0)}return o}"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(t,e){"use strict";if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(t),i=1;i<arguments.length;i++){var o=arguments[i];if(null!=o)for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(n[s]=o[s])}return n},writable:!0,configurable:!0}),Q=A=A||{},a.binarySearch=function(t,e,n,i){i=a.getComparator(i,n);return a.binarySearch2(t,e,i)},a.binarySearch2=function(t,e,n){for(var i,o,s=0,a=e.length-1;s<=a;)if(0<(i=n(t,e[o=a+s>>1])))s=1+o;else{if(!(i<0))return o;a=o-1}return-s-1},a.calcDialogHeight=function(t,e){e="FSBL"in window?window.finApi.getDialogHeightOffset(e):40;return window.innerHeight<t+e?window.innerHeight-e:t},a.calculateFontContrast=function(t){var e="",n=0===t.indexOf("#"),i=0===t.indexOf("rgb")||0===t.indexOf("rgba");return e=t&&(n||i)&&(i=n?a.hex2RGB(t):a.rgbStr2Array(t)).length?125<Math.round((299*parseInt(String(i[0]))+587*parseInt(String(i[1]))+114*parseInt(String(i[2])))/1e3)?n?a.getDefaultThemeColors("Dark")[0]:"rgb(40,40,40)":n?a.getDefaultThemeColors("Light")[0]:"rgb(15,15,15)":e},a.clickEvent=function(t){var e=this.hasTouch();return t?e?"touchend mouseup":"click":e?"touchstart click":"click"},a.compress=function(t){t=H.strToU8(t);return H.deflateSync(t,{level:9})},a.convertDateStringValueToMoment=function(t,e){return h.tz(t,e||"UTC")},a.convertISODatetimeToKDBLikeObject=function(t){var e=this.TIME_RX.exec(t),e=_.filter(e,function(t){return void 0!==t});return!e||e.length<2?t:a.convertValueToMoment(t).toKdbObject()},a.convertKDBTemporalToMoment=function(t){var e,n=!1;if(t&&_.isNumber(t.i)&&_.includes(a.Types.kdbTemporals,t.class)){switch(t.class){case"1212":(e=h.tz(t.i,"UTC")).nanoseconds(t.n%1e6),n=!0;break;case"1213":(e=h.tz("2000-01-01","UTC")).add(t.i,"month");break;case"1214":e=h.tz(t.toString(),"UTC");break;case"1216":(e=h.duration(0<t.i?Math.floor(t.i/1e6):Math.ceil(t.i/1e6))).nanoseconds(t.i%1e6);break;case"1217":e=h.duration(60*t.i*1e3);break;case"1218":e=h.duration(1e3*t.i);break;case"1219":e=h.duration(t.i);break;default:e=h.tz(t.i,"UTC"),n=!0}e.kdbType(t.class)}else e=h.tz(t,"UTC");return n&&this.timezone&&e.isValid()&&e.tz(this.timezone),e},a.dateUTCSafeFormatFromJsDate=function(t,e,n){return Q.Tools.convertValueToMoment(t)[(n=n||!1)?"formatNano":"format"](e=e||"YYYY-MM-DD HH:mm:ss.SSS")},a.drawPattern=function(t,e,n,i,o){return Y.draw(t,e,n,i,o)},a.convertKDBToViewstateValue=function(t){var e=t;return e=_.hasIn(t,"class")?"1222"===t.class?t.toString():a.convertKDBTemporalToMoment(t).toDashString():e},a.convertMomentToDatePicker=function(t,e){return t=a.convertValueToMoment(t),e?t.tz("UTC"):this.timezone&&t.isValid()&&!h.isDuration(t)&&t.tz(this.timezone),e=new Date(t.year(),t.month(),t.date(),t.hour(),t.minute(),t.second(),t.millisecond()),(t=t.nanoseconds())&&!_.isNaN(t)&&(e.nanoseconds=t),e},a.convertTypeToKdbType=function(t,e){return t?_.includes(a.Types.kdbTemporals,t)?t:_.includes(a.Types.kdbTemporals,a.Types.dashboardToKdb[t])?a.Types.dashboardToKdb[t]:null:a.inferKdbTypeFromDashString(e)},a.convertUserInputToMoment=function(t,e,n){return _.isString(t)?(t=t.replace(/(\d\d\d\d)\.(\d\d)\.(\d\d)/,"$1-$2-$3"),n=n?h.tz(t,e,"UTC"):this.timezone?h.tz(t,e,this.timezone):h(t,e),(e=a.extractNanos(t))&&!_.isNaN(e)&&(n.kdbType("1212"),n.nanoseconds(e)),n):t},a.convertValueToDuration=function(t,e){var n,i,o=a.convertTypeToKdbType(e,t);return _.includes(["1212","1213","1214","1215"],e)?a.convertValueToMoment(t,e):t?(h.isDuration(t)?n=t:_.isString(t)&&(i=(t=t.replace("1970-01-01T","").replace("Z","")).match(/(\d\d:\d\d:\d\d.\d\d\d)(\d\d\d\d\d\d)/))&&i[1]?("1216"===e&&-1!==t.indexOf("D")&&(e=t.substring(0,t.indexOf(":")).split("D"),e=Number(e[1])+24*Number(e[0]))&&(i[1]=e+i[1].substring(t.indexOf(":")-2)),n=h.duration(i[1]),(e=i[2]?Number(i[2]):0)&&!_.isNaN(e)&&n.nanoseconds(e)):n=h.duration(t),n&&o&&n.kdbType(o),n):h.duration(0)},a.convertValueToMoment=function(t,e,n){var i,o=a.convertTypeToKdbType(e,t),s=0;return _.includes(["1216","1217","1218","1219"],e)?a.convertValueToDuration(t,e):(null==t?(i=h(),n||i.tz(this.timezone)):h.isMoment(t)?i=t:(!_.isString(t)||"1214"!==o&&"1213"!==o?(i=h(t),n||i.tz(this.timezone)):i=h.utc(t),_.isDate(t)?s=t.nanoseconds:_.isString(t)&&(s=a.extractNanos(t)),s&&!_.isNaN(s)&&i.nanoseconds(s)),i&&o&&i.kdbType(o),i)},a.convertStringToMomentFormat=function(t,e){if(t){var n=!1;switch(e){case"1213":t=t.replace("m","");break;case"1212":t=t.split("D")[0].replace(/\./g,"-")+"T"+t.split("D")[1]+"Z",n=!0;break;case"1215":t=t.split("T")[0].replace(/\./g,"-")+"T"+t.split("T")[1]+"Z",n=!0}return a.convertValueToMoment(t,e,n)}},a.createPivotCollectionFunc=function(t){return f.Collection.extend({model:f.Model.extend({idAttribute:t,set:function(t,e){"function"==typeof t.subscribe&&(this.subscribe=t.subscribe),"function"==typeof t.unsubscribe&&(this.unsubscribe=t.unsubscribe),f.Model.prototype.set.call(this,t,e)},setX:function(t,e){var n;"object"==typeof t?n=t:(n={})[t]=e,_.extend(this.attributes,n)}})})},a.castToDashString=function(t,e){return e&&t&&t.class&&_.includes(["date","datetime","month","timestamp","minute","time","timespan","second"],e)?t=a.convertKDBTemporalToMoment(t).toDashString():_.isString(t)&&"timespan"===e&&-1<t.indexOf(".000Z")?t=t.replace(".000Z",".000000000Z"):_.isString(t)&&"datetime"===e&&null!==t.match(/[DTZ]/g)&&23<t.length&&(t=t.slice(0,23)+"Z"),t},a.extractNanos=function(t){var e=0;return e=t&&(t=(t=_.isFunction(t.toString)?t.toString():t).match(/\d{1,2}:\d{2}:\d{2}\.\d{3}(\d{6})/))?Number(t[1]):e},a.copyToClipboard=function(t,e,n){try{navigator.clipboard.write([new ClipboardItem({"image/png":t})]),n.showNotification({title:e,message:"Screenshot copied to clipboard"},!1)}catch(t){console.error(t)}},a.convertDataUrlToBlob=function(t){for(var t=t.split(","),e=atob(t[1]),n=e.length,i=new Uint8Array(n);n--;)i[n]=e.charCodeAt(n);return i},a.decompress=function(t){t=H.inflateSync(t);return H.strFromU8(t)},a.decodeFromBase64=function(t){return Uint8Array.from(atob(t),function(t){return t.charCodeAt(0)})},a.encodeToBase64=function(t){return btoa(String.fromCharCode.apply(null,t))},a.fileSave=function(t,e,n){n=n||"application/octet-stream";var i,o=document.createElement("a");return window.Blob?(i=new Blob([e],{type:n}),window.navigator.msSaveOrOpenBlob?o.onclick=function(){window.navigator.msSaveOrOpenBlob(i,t)}:void 0!==o.download&&o.setAttribute("href",URL.createObjectURL(i))):o.setAttribute("href",encodeURI(n+","+e)),void 0!==o.download&&o.setAttribute("download",t),document.body.appendChild(o),o.click(),document.body.removeChild(o),_.get(i,"size")?i.size:0},a.formatNumber=function(t,e){var n=t||"";return $.isNumeric(t)?(n=(t=this.toFixedNumber(t,e).split("."))[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),2===t.length&&(n+="."+t[1]),n):this.htmlEncode(n)},a.getComparator=function(t,s){switch(t){default:case 1:case 2:case 4:case 5:case 6:case 8:case 9:return function(t,e){e=s(e);return null==t||null==e?null!=t?1:null!=e?-1:0:e<t?1:t<e?-1:0};case 10:case 11:return function(t,e){e=s(e);return null==t||null==e?null!=t?1:null!=e?-1:0:t.localeCompare(e,{caseFirst:"lower"})};case 7:return function(t,e){var n,i,o;return e=s(e),null==t||null==e?null!=t?1:null!=e?-1:0:(i=(n="-"===t[0])?1-t.length:t.length)!==(o="-"===e[0]?1-e.length:e.length)?o<i?1:-1:(n?-1:1)*(e<t?1:t<e?-1:0)};case 12:case 16:return function(t,e){var e=s(e),n=null==t||t===1/0||t===-1/0,i=null==e||e===1/0||e===-1/0;return n&&i?e<t?1:t<e?-1:0:n?t>e.i?1:t<e.i?-1:0:i?t.i>e?1:t.i<e?-1:0:t.i>e.i?1:t.i<e.i?-1:t.n>e.n?1:t.n<e.n?-1:0};case 13:case 14:case 15:case 17:case 18:case 19:return function(t,e){var e=s(e),n=null==t||t===1/0||t===-1/0,i=null==e||e===1/0||e===-1/0;return n&&i?e<t?1:t<e?-1:0:n?t>e.i?1:t<e.i?-1:0:i?t.i>e?1:t.i<e?-1:0:t.i>e.i?1:t.i<e.i?-1:0}}},a.getCookie=function(t){for(var e=t+"=",n=document.cookie.split(";"),i=0;i<n.length;i++){for(var o=n[i];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(e))return decodeURIComponent(o.substring(e.length,o.length))}return""},a.getDeepDiff=function(t,e){return ct.getDiff(t,e)},a.getDefaultThemeColors=function(t){return"Light"===t?["#ffffff","#f4f4f4","#cecece"]:["#282828","#303030","#505050"]},a.getHash=function(t){t=(t||window).location.href.match(/#(.*)$/);return t?t[1]:""},a.getPaletteFromTheme=function(t,n,i,o){var s=[],a=!1,e=_.filter(t,function(t){var e=".dark"!==_.get(t,"theme")&&".light"!==_.get(t,"theme")||t.theme.toLowerCase()==="."+o.toLowerCase();return t.rule===i&&e}),r=(_.isEmpty(n)||" "===n||n===i)&&0<e.length;return r&&_.each(e,function(t){s.push({type:Q.Tools.rgbStr2hex(t.color)}),a=!0}),_.each(t,function(t){var e=".dark"!==_.get(t,"theme")&&".light"!==_.get(t,"theme")||t.theme.toLowerCase()==="."+o.toLowerCase();_.isEmpty(t.rule.trim())||t.rule!==n||!e||r||(s.push({type:Q.Tools.rgbStr2hex(t.color)}),a=!0)}),{updated:a,palette:s}},a.getRegex=function(t){var e,n=/\/[gimsuy]*$/,i="";return 0===t.indexOf("/")?(e=t.substring(1).replace(n,""),i=(n=t.match(n))?n[0].substring(1):""):e="^"+(t=t.replace(/[\-\[\]\/\{\}\(\)\+\?\.\\\^\$\|]/g,"\\$&")).replace(/\*/g,"(.*)")+"$",new RegExp(e,i)},a.getTimezoneOffset=function(){var t=this.timezone?h.tz(this.timezone):h();return t.utcOffset()},a.getTypeCategory=function(t){var e="";switch(t){case"1212":case"1213":case"1214":case"1215":case"date":case"datetime":case"month":case"timestamp":e="date";break;case"1216":case"1217":case"1218":case"1219":case"minute":case"second":case"time":case"timespan":e="duration"}return e},a.getNumberDecimalPlaces=function(t){var e=0;return e=-1!==t.lastIndexOf(".")?t.substr(t.lastIndexOf(".")+1,t.length).length:e},a.hasDefaultThemeColors=function(t,e,n,i){return!("Light"!==t||"#f0f0f0"!==e||"#e0e0e0"!==n&&n||"#c8c8c8"!==i&&i)||!("Dark"!==t||"#282828"!==e||"#303030"!==n&&n||"#505050"!==i&&i)},a.hasTouch=function(){return $(document).hasClass("touch")},a.hex2RGB=function(t){t=(4<t.length?RegExp(/^\#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i):RegExp(/^\#?([a-f\d])([a-f\d])([a-f\d])$/i)).exec(t);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:[]},a.hoverFix=function(t){var e=t.parentNode,n=t.nextSibling;e.removeChild(t),setTimeout(function(){e.insertBefore(t,n)},0)},a.htmlEncode=function(t){return t.toString().replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},a.inferKdbTypeFromDashString=function(t){var e;if(t&&_.isString(t)&&(e=t.match(/^(\d\d\d\d-\d\d)?(-\d\d)?(T\d\d:\d\d:\d\d\.\d{3})?(\d{6})?(?:Z)?$/))){if(e[1]&&e[2]&&e[3]&&e[4])return"1970-01-01"===t.substr(0,10)?"1216":"1212";if(e[1]&&e[2]&&e[3])return"1970-01-01"===t.substr(0,10)?"1219":"1215";if(e[1]&&e[2])return"1214";if(e[1])return"1213"}return null},a.isIE=function(){var t=window.navigator.userAgent,e=t.indexOf("MSIE ");return 0<e?parseInt(t.substring(e+5,t.indexOf(".",e)),10):0<t.indexOf("Trident/")?(e=t.indexOf("rv:"),parseInt(t.substring(e+3,t.indexOf(".",e)),10)):0<(e=t.indexOf("Edge/"))&&parseInt(t.substring(e+5,t.indexOf(".",e)),10)},a.isKDBTemporal=function(t){return t&&t.class&&_.includes(a.Types.kdbTemporals,t.class)||!1},a.objToUri=function(n){return _.reduce(_.keys(n),function(t,e){return e&&t.push(e+"="+n[e]),t},[]).join("&")},a.padLeft=function(t,e){return _.isNull(t)||_.isUndefined(t)?"":(t=t.toString()).length<e?a.padLeft("0"+t,e):t},a.roundToPlaces=function(t,e){e=Math.pow(10,e);return t*=e,(t=Math.round(t))/e},a.round=function(t,e,n){return n===this.Rounding.Normal?a.roundToPlaces(t,e):(e=Math.pow(10,e),n===a.Rounding.Floor?Math.floor(t*e)/e:Math.ceil(t*e)/e)},a.rgb2hex=function(t){var e="";return e=t.length?"#"+((1<<24)+(t[0]<<16)+(t[1]<<8)+t[2]).toString(16).slice(1):e},a.rgbStr2hex=function(t){function e(t,e){return t=Math.max(0,parseInt(t,10)),e?Math.floor(255*Math.min(100,t)/100):Math.min(255,t)}var n="";return n=(t=/^rgb\(\s*(-?\d+)(%?)\s*,\s*(-?\d+)(%?)\s*,\s*(-?\d+)(%?)\s*\)$/.exec(t))?"#"+(16777216+(e(t[1],t[2])<<16)+(e(t[3],t[4])<<8)+e(t[5],t[6])).toString(16).slice(1):n},a.rgbStr2Array=function(t){t=t.match(/rgba?\((\d{1,3}), ?(\d{1,3}), ?(\d{1,3})\)?(?:, ?(\d(?:\.\d?))\))?/);return t?[t[1],t[2],t[3],t[4]]:[]},a.smartFormatNumber=function(t,e,n){var i=Number(t),o="",s=1;return isNaN(i)?"":"string"==typeof t&&(i>Number.MAX_SAFE_INTEGER||i<Number.MIN_SAFE_INTEGER)?this.toFixedNumber(t,e):(t=Math.max(0,void 0===e?2:e),1e18<=(e=Math.abs(i))?(s=1e18,o="E"):1e15<=e?(s=1e15,o="P"):1e12<=e?(s=1e12,o="T"):1e9<=e?(s=1e9,o="B"):1e6<=e?(s=1e6,o="M"):1e3<=e&&(s=1e3,o="k"),e=a.roundToPlaces(i/s,t),(e=n?e.toFixed(t):e)+o)},a.sum=function(t){return _.reduce(t,function(t,e){return t+e},0)},a.toFixedNumber=function(t,e){var n,e=void 0===e?2:e,e=Math.min(20,Math.max(0,e));return"string"!=typeof t||/(^[^-\d]|^[-\d].*[^\d]+|^-$)/.test(t)?"number"==typeof t?(n=Number(t),a.roundToPlaces(n,e).toFixed(e)):this.htmlEncode(t):t+(e?".":"")+_.repeat("0",e)},a.touchDownEvent=function(t){return this.hasTouch()?"touchstart":"mousedown"},a.tapEvent=function(){return this.hasTouch()?"tap":"mousedown"},a.uriToObj=function(t){return _.reduce(t.split("&"),function(t,e){e=e.split("=");return t[e[0]]=e[1],t},{})},a.isIE11=/Trident\/.*rv:11/.test(navigator.userAgent),a.timezone=function(t){for(var e=t+"=",n=document.cookie.split(";"),i=0;i<n.length;i++){for(var o=n[i];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(e))return decodeURIComponent(o.substring(e.length,o.length))}return""}("dashboard-timezone")||h.tz.guess(),a.Formats={Date:["YYYY-MM-DD","DD/MM/YYYY","DD.MM.YYYY","MM/DD/YYYY","D/M/YYYY","M/D/YYYY","D/M/YY","M/D/YY","YYYY-MMM-DD","D MMM","D MMM YYYY","MMM D","MMM D, YYYY","YYYY-MM","MM/YYYY","M/YY","MMM YYYY"],DateTime:["YYYY-MM-DD HH:mm:ss","YYYY-MM-DD HH:mm:ss.SSS","YYYY-MM-DD HH:mm:ss.SSSSSS","YYYY-MM-DD HH:mm:ss.SSSSSSSSS","YYYY-MM-DD","MM/DD/YYYY","D/M/YYYY","M/D/YYYY","D/M/YY","M/D/YY","YYYY-MMM-DD","D MMM","D MMM YYYY","MMM D","MMM D, YYYY","HH:mm","HH:mm:ss","HH:mm:ss.SSS","HH:mm:ss.SSSSSS","HH:mm:ss.SSSSSSSSS","mm:ss","mm:ss.SSS","mm:ss.SSSSSS","mm:ss.SSSSSSSSS","ss","ss.SSS","ss.SSSSSS","ss.SSSSSSSSS"],Time:["HH:mm","HH:mm:ss","HH:mm:ss.SSS","HH:mm:ss.SSSSSS","HH:mm:ss.SSSSSSSSS","mm:ss","mm:ss.SSS","ss","ss.SSS"]},a.TIME_RX=/^((\d\d\d\d-\d\d)|(\d\d\d\d-\d\d-\d\d))?((T\d\d:\d\d:\d\d\.\d{3})(\d{6})?)?(?:Z)?$/,a.Rounding={Normal:0,Floor:1,Ceiling:2},a.Types={dashboardToKdb:{timestamp:"1212",month:"1213",date:"1214",datetime:"1215",timespan:"1216",minute:"1217",second:"1218",time:"1219"},kdbTemporals:["1212","1213","1214","1215","1216","1217","1218","1219"],kdbToDashboard:{1212:"timestamp",1213:"month",1214:"date",1215:"datetime",1216:"timespan",1217:"minute",1218:"second",1219:"time"}},a.Patterns=["line","disc","line-vertical","ring","diagonal","plus","diagonal-right-left","cross","triangle","zigzag","triangle-inverted","weave","zigzag-vertical","diamond","diamond-box","square","box"],Q.Tools=a,z=A=A||{},o.castDate=function(t){return t instanceof Date?t:t&&t.i?new Date(t.i):new Date(t)},o.convertDateToTimeObject=function(t){return{hour:t.getUTCHours(),minute:t.getUTCMinutes(),second:t.getUTCSeconds(),millisec:t.getUTCMilliseconds()}},o.getByQTypeNum=function(t){return(o.infosByNum=o.infosByNum?o.infosByNum:_.map(o.simple,function(t){return o.infos[t]}))[t]},o.getByName=function(t){var e=this.infos["double"===(t=void 0===t?"symbol":t)?"float":t];return e||((e=t?this.infos[t.replace("[]","")]:e)?{char:e.char+"[]",num:-e.num,literal:e.literal,null:"",name:t,editor:_.extend({},e.editor,{type:"List",itemType:e.editor.type,editorClass:e.name+"List"}),toKDBInput:function(t){t=_.values(t);return null!=t&&0<t.length?"("+(1<t.length?"":"enlist ")+_.map(t,function(t){return t&&t.toKDBInput?t.toKDBInput():e.toKDBInput(t)}).join(";")+")":"()"}}:this.infos.symbol)},o.toTimeMomentInput=function(t,e){var n=o.isNilorInfinite(e,t);return n.isNilOrInfinite?n.returnType:(n=z.Tools.isKDBTemporal(e)?z.Tools.convertKDBTemporalToMoment(e):z.Tools.convertValueToDuration(e),""===t?h.isDuration(n)?"'"+n.formatNano("HH:mm:ss.SSS",{trim:!1})+"'":"NULL":h.isDuration(n)?n.formatNano("HH:mm:ss.SSS",{trim:!1}):"0Nt")},o.isNilorInfinite=function(t,e){if(""===e){if(_.isNull(t)||_.isUndefined(t)||""===t||t===-1/0||t===1/0)return{isNilOrInfinite:!0,returnType:"NULL"}}else{if(_.isNull(t)||_.isUndefined(t))return{isNilOrInfinite:!0,returnType:"0N"+e};if(t===-1/0)return{isNilOrInfinite:!0,returnType:"-0W"+e};if(t===1/0)return{isNilOrInfinite:!0,returnType:"0W"+e}}return{isNilOrInfinite:!1,returnType:""}},o.toSecondMomentInput=function(t,e){var n=o.isNilorInfinite(e,t);return n.isNilOrInfinite?n.returnType:(n=z.Tools.isKDBTemporal(e)?z.Tools.convertKDBTemporalToMoment(e):z.Tools.convertValueToDuration(e),""===t?h.isDuration(n)?"'"+n.formatNano("HH:mm:ss",{trim:!1})+"'":"NULL":h.isDuration(n)?n.formatNano("HH:mm:ss",{trim:!1}):"0Nv")},o.toMinuteMomentInput=function(t,e){var n=o.isNilorInfinite(e,t);return n.isNilOrInfinite?n.returnType:(n=z.Tools.isKDBTemporal(e)?z.Tools.convertKDBTemporalToMoment(e):z.Tools.convertValueToDuration(e),""===t?h.isDuration(n)?"'"+n.format("HH:mm",{trim:!1})+"'":"NULL":h.isDuration(n)?n.format("HH:mm",{trim:!1}):"0Nu")},o.toTimespanMomentInput=function(t,e){var n,i=o.isNilorInfinite(e,t);return i.isNilOrInfinite?i.returnType:(i=z.Tools.isKDBTemporal(e)?z.Tools.convertKDBTemporalToMoment(e):z.Tools.convertValueToDuration(e),h.isDuration(i)?(e=i.format("DD"),n=parseInt(i.formatNano("HH")),i=i.formatNano("HH:mm:ss.SSSSSSSSS",{trim:!1}),""===t?"'".concat(e,"D").concat(i,"'"):"".concat(23<n?"00":e,"D").concat(i)):t?"0N".concat(t):"NULL")},o.toMonthMomentInput=function(t,e){var n=o.isNilorInfinite(e,t);return n.isNilOrInfinite?n.returnType:(n=z.Tools.isKDBTemporal(e)?z.Tools.convertKDBTemporalToMoment(e):h.tz(e,"Y.MM","UTC"),""===t?h.isMoment(n)&&n.isValid()?"'"+n.utcOffset(0).format("YYYY-MM-DD")+"'":"NULL":h.isMoment(n)&&n.isValid()?n.utcOffset(0).format("YYYY.MM")+"m":"0Nm")},o.toMomentUTC=function(t){return z.Tools.isKDBTemporal(t)?z.Tools.convertKDBTemporalToMoment(t):h.tz(t,"UTC")},o.toTimeStampMomentInput=function(t,e){var n=o.isNilorInfinite(e,t);if(n.isNilOrInfinite)return n.returnType;_.isString(e)&&(e=e.replace("D","T").replace(/^(\d\d\d\d)\.(\d\d).(\d\d)/,"$1-$2-$3"),e=/Z$/.test(e)?e:e+"Z");n=z.Tools.isKDBTemporal(e)?z.Tools.convertKDBTemporalToMoment(e):z.Tools.convertValueToMoment(e);return""===t?h.isMoment(n)&&n.isValid()?"'"+n.utcOffset(0).format("YYYY-MM-DD")+" "+n.formatNano("HH:mm:ss.SSSSSS",{trim:!1})+"'":"NULL":h.isMoment(n)&&n.isValid()?n.utcOffset(0).format("YYYY.MM.DD")+"D"+n.formatNano("HH:mm:ss.SSSSSSSSS",{trim:!1}):"0Np"},o.toDateTimeMomentInput=function(t,e){var n=o.isNilorInfinite(e,t);if(n.isNilOrInfinite)return n.returnType;_.isString(e)&&(e=e.replace(/^(\d\d\d\d)\.(\d\d).(\d\d)/,"$1-$2-$3"),e=/Z$/.test(e)?e:e+"Z");n=o.toMomentUTC(e);return""===t?h.isMoment(n)&&n.isValid()?"'"+n.utcOffset(0).format("YYYY-MM-DD")+" "+n.formatNano("HH:mm:ss.SSS",{trim:!1})+"'":"NULL":h.isMoment(n)&&n.isValid()?n.utcOffset(0).format("YYYY.MM.DD")+"T"+n.formatNano("HH:mm:ss.SSS",{trim:!1}):"0Np"},o.toDateMomentInput=function(t,e){var n=o.isNilorInfinite(e,t);if(n.isNilOrInfinite)return n.returnType;_.isString(e)&&(e=e.replace(/^(\d\d\d\d)\.(\d\d)\.(\d\d)/,"$1-$2-$3"));n=o.toMomentUTC(e);return""===t?h.isMoment(n)&&n.isValid()?"'"+n.utcOffset(0).format("YYYY-MM-DD")+"'":"NULL":h.isMoment(n)&&n.isValid()?n.utcOffset(0).format("YYYY.MM.DD"):"0Nd"},o.toNumberInput=function(t,e){return""===t?_.isNull(e)||_.isUndefined(e)||isNaN(e)||""===e||e===-1/0||e===1/0?"NULL":e:_.isNull(e)||_.isUndefined(e)||isNaN(e)||""===e?"0N"+t:e===-1/0?"-0W"+t:e===1/0?"0W"+t:e+t},o.toListInput=function(t,e){return e?"("+(_.every(e,function(t){return _.isNull(t)||_.isUndefined(t)||_.isNumber(t)})?_.map(e,function(t){return o.infos.float.toKDBInput(t)}):_.map(e,function(t){return o.infos.char.toKDBInput(t)})).join(t?",":";")+")":"()"},o.REGEX_MONTH=/^\d{4}-\d{2}$/,o.REGEX_DATEPICKER=/^\d{4}-\d{2}-\d{2}$/,o.REGEX_ROLLING=/^(?:NOW|(NOW|T)([\+|\-]\d+)(BD|WD)?)(\@)?(\d{1,2})?(:\d{2})?(:\d{2})?(.(\d{9}|\d{3}))?(?:Z)?$/,o.REGEX_DURATION=/^\d{4}-\d{2}-\d{2}T(\d{2,6}):(\d{2}):(\d{2})?[.](\d{9}|\d{3})?Z$/,o.REGEX_TIMEPICKER=/^\d{4}-\d{2}-\d{2}T(\d{2}):(\d{2}):(\d{2})?[.](\d{9}|\d{3})?Z$/,o.infos={List:{char:void 0,size:void 0,num:0,literal:void 0,null:"",name:"list",editor:"List",toKDBInput:function(t){return o.toListInput(!1,t)},toSQLInput:function(t){return o.toListInput(!0,t)}},boolean:{char:"b",size:"1",num:1,literal:"0b",null:"",name:"boolean",editor:{type:"Checkbox"},toKDBInput:function(t){return t?"1b":"0b"},toSQLInput:function(t){return t?"1":"0"}},guid:{char:"g",size:"16",num:2,literal:"",null:"0Ng",name:"guid",editor:{type:"Text",editorAttrs:{maxLength:36},validators:[function(t){if(!t.match(/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/))return{type:"guid",message:"Invalid, requires: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"}}]},toKDBInput:function(t){return _.isNull(t)||_.isUndefined(t)||""===t?"0Ng":t===-1/0?"0w":t===1/0?"-0w":'"G"$"'+t.toString()+'"'},toSQLInput:function(t){return _.isNull(t)||_.isUndefined(t)||""===t||t===-1/0||t===1/0?"NULL":"'"+t.toString()+"'"}},byte:{char:"x",size:"1",num:4,literal:"0x00",null:"",name:"byte",editor:{type:"Number",editorAttrs:{min:-128,max:127,step:1},validators:["number",{type:"range",min:-128,max:127},function(t){if(t%1!=0)return{type:"whole-number",message:"Must be a whole number"}}]},toKDBInput:function(t){return _.isNull(t)||_.isUndefined(t)||isNaN(t)||""===t||t===-1/0?"0x0":t===1/0?"0xFF":"0x"+Number(t).toString(16)},toSQLInput:function(t){return _.isNull(t)||_.isUndefined(t)||isNaN(t)||""===t||t===-1/0||t===1/0?"NULL":Number(t).toString(16)}},short:{char:"h",size:"2",num:5,literal:"0h",null:"0Nh",name:"short",editor:{type:"Number",editorAttrs:{min:-32768,max:32767,step:1},validators:["number",{type:"range",min:-32768,max:32767},function(t){if(t%1!=0)return{type:"whole-number",message:"Must be a whole number"}}]},toKDBInput:function(t){return o.toNumberInput("h",t)},toSQLInput:function(t){return o.toNumberInput("",t)}},int:{char:"i",size:"4",num:6,literal:"0",null:"0N",name:"int",editor:{type:"Number",editorAttrs:{min:-2147483648,max:2147483647,step:1},validators:["number",{type:"range",min:-2147483648,max:2147483647},function(t){if(t%1!=0)return{type:"whole-number",message:"Must be a whole number"}}]},toKDBInput:function(t){return o.toNumberInput("i",t)},toSQLInput:function(t){return o.toNumberInput("",t)}},long:{char:"j",size:"8",num:7,literal:"0j",null:"0Nj",name:"long",editor:{type:"Long",validators:["number",{type:"range",min:-0x8000000000000000,max:0x8000000000000000},function(t){if(t%1!=0)return{type:"whole-number",message:"Must be a whole number"}}]},toKDBInput:function(t){return o.toNumberInput("j",t)},toSQLInput:function(t){return o.toNumberInput("",t)}},real:{char:"e",size:"4",num:8,literal:"0e",null:"0Ne",name:"real",editor:{type:"Number",editorAttrs:{step:"any"},validators:["number"]},toKDBInput:function(t){return o.toNumberInput("e",t)},toSQLInput:function(t){return o.toNumberInput("",t)}},float:{char:"f",size:"8",num:9,literal:"0.0 or 0f",null:"0n",name:"float",editor:{type:"Number",editorAttrs:{step:"any"},validators:["number"]},toKDBInput:function(t){return o.toNumberInput("f",t)},toSQLInput:function(t){return o.toNumberInput("",t)}},char:{char:"c",size:"1",num:10,literal:'" "',null:'" "',name:"char",editor:{type:"Text",editorAttrs:{maxlength:1}},toKDBInput:function(t){return _.isNull(t)||_.isUndefined(t)||0===t.length?'" "':'"'+(t&&t.toString?t.toString().replace(/\\/g,"\\\\").replace(/"/g,'\\"'):" ")+'"'},toSQLInput:function(t){return _.isNull(t)||_.isUndefined(t)?"''":"'"+(t&&t.toString?t.toString().replace(/\\/g,"\\\\").replace(/"/g,'\\"'):"")+"'"}},symbol:{char:"s",size:".",num:11,literal:"`",null:"`",name:"symbol",editor:{type:"Text"},toKDBInput:function(t){return _.isNull(t)||_.isUndefined(t)?"`":'`$"'+(t&&t.toString?t.toString().replace(/\\/g,"\\\\").replace(/"/g,'\\"'):"")+'"'},toSQLInput:function(t){return _.isNull(t)||_.isUndefined(t)?"''":"'"+(t&&t.toString?t.toString().replace(/\\/g,"\\\\").replace(/"/g,'\\"'):"")+"'"}},timestamp:{char:"p",size:"8",num:12,literal:"dateDtimespan",null:"0Np",name:"timestamp",editor:{type:"DateTimePicker",options:{hasNano:!0,isTimestamp:!0,dateFormat:"yy-mm-dd",timeFormat:"HH:mm:ss.SSSSSSSSS",width:200,bindButton:!0},validators:[function(t){if(t){t=z.Tools.convertUserInputToMoment(t,"YYYY/MM/DD HH:mm:ss.SSS");if(t&&!t.isValid())return{type:"timestamp",message:"Invalid date/time"}}}]},toKDBInput:function(t){return o.toTimeStampMomentInput("p",t)},toSQLInput:function(t){return o.toTimeStampMomentInput("",t)}},month:{char:"m",size:"4",num:13,literal:"2000.01m",null:"0Nm",name:"month",editor:{type:"Month",options:{bindButton:!1}},toKDBInput:function(t){return o.toMonthMomentInput("m",t)},toSQLInput:function(t){return o.toMonthMomentInput("",t)}},date:{char:"d",size:"4",num:14,literal:"2000.01.01",null:"0Nd",name:"date",editor:{type:"DatePicker",options:{dateFormat:"yy-mm-dd",width:75,bindButton:!0},validators:[function(t){if(t){var e=z.Tools.convertUserInputToMoment(t,"YYYY/MM/DD");if(e&&!e.isValid())return{type:"date",message:"Invalid date"}}return!o.REGEX_DATEPICKER.test(t.substr(0,10))}]},toKDBInput:function(t){return o.toDateMomentInput("d",t)},toSQLInput:function(t){return o.toDateMomentInput("",t)}},datetime:{char:"z",size:"8",num:15,literal:"dateTtime",null:"0Nz",name:"datetime",editor:{type:"DateTimePicker",options:{dateFormat:"yy-mm-dd",timeFormat:"HH:mm:ss.SSS",width:155,bindButton:!0},validators:[function(t){return _.isFunction(t.toISOString)&&(t=t.toISOString()),!o.REGEX_TIMEPICKER.test(t)}]},toKDBInput:function(t){return o.toDateTimeMomentInput("z",t)},toSQLInput:function(t){return o.toDateTimeMomentInput("",t)}},timespan:{char:"n",size:"8",num:16,literal:"00:00:00.00",null:"0Nn",name:"timespan",editor:{type:"TimePicker",options:{isDuration:!0,hasNano:!0,isTimespan:!0,timeFormat:"HH:mm:ss.SSSSSSSSS",width:142,bindButton:!1},validators:[function(t){return!1}]},toKDBInput:function(t){return o.toTimespanMomentInput("n",t)},toSQLInput:function(t){return o.toTimespanMomentInput("",t)}},minute:{char:"u",size:"4",num:17,literal:"00:00:00",null:"0Nu",name:"minute",editor:{type:"TimePicker",options:{isDuration:!0,timeFormat:"HH:mm",width:61,bindButton:!1},validators:[function(t){return!1}]},toKDBInput:function(t){return o.toMinuteMomentInput("u",t)},toSQLInput:function(t){return o.toMinuteMomentInput("",t)}},second:{char:"v",size:"4",num:18,literal:"00:00:00",null:"0Nv",name:"second",editor:{type:"TimePicker",options:{isDuration:!0,timeFormat:"HH:mm:ss",width:79,bindButton:!1},validators:[function(t){return!1}]},toKDBInput:function(t){return o.toSecondMomentInput("v",t)},toSQLInput:function(t){return o.toSecondMomentInput("",t)}},time:{char:"t",size:"4",num:19,literal:"00:00:00.000",null:"0Nt",name:"time",editor:{type:"TimePicker",options:{isDuration:!0,timeFormat:"HH:mm:ss.SSS",width:102,bindButton:!1},validators:[function(t){return!o.REGEX_TIMEPICKER.test(t.toString())}]},toKDBInput:function(t){return o.toTimeMomentInput("t",t)},toSQLInput:function(t){return o.toTimeMomentInput("",t)}},string:{char:"",size:".",num:20,literal:"",null:"",name:"string",editor:{type:"TextArea"},toKDBInput:function(t){return _.isNull(t)||_.isUndefined(t)?'""':'"'+(t&&t.toString?t.toString().replace(/\\/g,"\\\\").replace(/"/g,'\\"'):"")+'"'},toSQLInput:function(t){return _.isNull(t)||_.isUndefined(t)?"''":"'"+(t&&t.toString?t.toString().replace(/\\/g,"\\\\").replace(/"/g,'\\"'):"")+"'"}},list:{char:"Q",size:"",num:21,literal:[],null:"",name:"list",editor:{type:"CustomList",options:{itemType:"Text"}},toKDBInput:function(t){t=_.values(t);return null!=t&&0<t.length?"("+(1<t.length?"":"enlist ")+_.map(t,function(t){return t&&t.toKDBInput?t.toKDBInput():'`$"'+(_.isString(t)?t.replace(/\"/g,'\\"'):t)+'"'}).join(";")+")":"()"},toSQLInput:function(t){t=_.values(t);return void 0!==t&&0<t.length?"("+_.map(t,function(t){return t&&t.toKDBInput?t.toKDBInput():_.isString(t)?"'"+t+"'":t}).join(",")+")":"()"}},monthRolling:{char:"m",size:"4",num:13,literal:"2000.01m",null:"0Nm",name:"monthRolling",editor:{type:"MonthRolling",options:{dateFormat:"yy-mm"},validators:[function(t){return!o.REGEX_ROLLING.test(t.toString().toUpperCase())&&!o.REGEX_MONTH.test(t.toString())&&{type:"rolling",message:"Please provide valid syntax"}}]}},dateRolling:{char:"d",size:"4",num:22,literal:"2000.01.01",null:"0Nd",name:"dateRolling",editor:{type:"DatePickerRolling",options:{dateFormat:"yy-mm-dd"},validators:[function(t){return!(o.REGEX_ROLLING.test(t.toString().toUpperCase())||t&&t.toISOString&&o.REGEX_DATEPICKER.test(t.toISOString())||o.REGEX_DATEPICKER.test(t.substr(0,10)))&&{type:"rolling",message:"Please provide valid syntax"}}]},toKDBInput:function(t){return $.datepicker.formatDate("yy.mm.dd",o.castDate(t))},toSQLInput:function(t){return"'"+$.datepicker.formatDate("yyyy-mm-dd",o.castDate(t))+"'"}},datetimeRolling:{char:"z",size:"8",num:23,literal:"dateTtime",null:"0Nz",name:"datetimeRolling",editor:{type:"DateTimePickerRolling",options:{dateFormat:"yy-mm-dd",timeFormat:"HH:mm:ss.SSS"},validators:[function(t){return!(o.REGEX_ROLLING.test(t.toString().toUpperCase())||t&&t.toISOString&&o.REGEX_TIMEPICKER.test(t.toISOString())||o.REGEX_TIMEPICKER.test(t))&&{type:"guid",message:"Please provide valid syntax"}}]}},timestampRolling:{char:"p",size:"8",num:24,literal:"dateDtimespan",null:"0Np",name:"timestampRolling",editor:{type:"DateTimePickerRolling",options:{hasNano:!0,isTimestamp:!0,dateFormat:"yy-mm-dd",timeFormat:"HH:mm:ss.SSSSSSSSS"},validators:[function(t){return!(o.REGEX_ROLLING.test(t.toString().toUpperCase())||t&&t.toISOString&&o.REGEX_TIMEPICKER.test(t.toISOString())||o.REGEX_TIMEPICKER.test(t))&&{type:"guid",message:"Please provide valid syntax"}}]}},timeRolling:{char:"t",size:"4",num:25,literal:"00:00:00.000",null:"0Nt",name:"timeRolling",editor:{type:"TimePickerRolling",options:{isDuration:!0,timeFormat:"HH:mm:ss.SSS"},validators:[function(t){return!o.REGEX_ROLLING.test(t.toString().toUpperCase())&&!o.REGEX_TIMEPICKER.test(t.toString())&&{type:"guid",message:"Please provide valid syntax"}}]}},minuteRolling:{char:"u",size:"4",num:26,literal:"00:00:00",null:"0Nu",name:"minuteRolling",editor:{type:"TimePickerRolling",options:{isDuration:!0,timeFormat:"HH:mm"},validators:[function(t){return!o.REGEX_ROLLING.test(t.toString().toUpperCase())&&!o.REGEX_TIMEPICKER.test(t.toString())&&{type:"guid",message:"Please provide valid syntax"}}]}},secondRolling:{char:"v",size:"4",num:27,literal:"00:00:00",null:"0Nv",name:"secondRolling",editor:{type:"TimePickerRolling",options:{isDuration:!0,timeFormat:"HH:mm:ss"},validators:[function(t){return!o.REGEX_ROLLING.test(t.toString().toUpperCase())&&!o.REGEX_TIMEPICKER.test(t.toString())&&{type:"guid",message:"Please provide valid syntax"}}]}},dict:{char:"Q",size:"",num:98,literal:[],null:"",name:"dict",editor:{type:"Dict",options:{itemType:"Text"}},toKDBInput:function(t){var e,n;return _.isEmpty(t)?"()!()":(e=_.keys(t),t=_.values(t),"("+(n=1===e.length?"enlist ":"")+_.map(e,function(t){return'`$"'+t+'"'}).join(";")+")!("+n+_.map(t,function(t){return t.type?o.getByName(t.type).toKDBInput(t.value):'`$"'+t.replace(/\"/g,'\\"')+'"'}).join(";")+")")},toSQLInput:function(t){return t}},email:{char:"",size:"",num:29,literal:"",null:"",name:"email",editor:{type:"Text",options:{itemType:"Text"},validators:["email"]},toKDBInput:function(t){return o.infos.symbol.toKDBInput(t)},toSQLInput:function(t){return"'"+o.infos.symbol.toKDBInput(t)+"'"}}},o.simple=["list","boolean","guid","byte","byte","short","int","long","real","float","char","symbol","timestamp","month","date","datetime","timespan","minute","second","time","dict"],o.infosByNum=null,z.RTTI=o,W=A=A||{},pt.constructPivotWhereString=function(t){var e=[];return t.forEach(function(t){switch(t.columnType){case 1:case 2:case 4:case 5:case 6:case 7:case 8:case 9:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:e.push("("+t.columnOperator+';`$"'+t.columnName+'"; '+W.RTTI.getByQTypeNum(t.columnType).toKDBInput(t.columnValue)+")");break;case 10:1==t.columnValue.length?e.push("("+t.columnOperator+';`$"'+t.columnName+'"; "'+t.columnValue.toString()+'")'):e.push('(~\\:;`$"'+t.columnName+'"; "'+t.columnValue.toString()+'")');break;case 11:e.push("("+t.columnOperator+';`$"'+t.columnName+'"; enlist `$"'+t.columnValue.toString()+'")');break;default:_.isString(t.columnValue)?e.push('(~\\:;`$"'+t.columnName+'"; "'+t.columnValue.toString()+'")'):e.push("("+t.columnOperator+';`$"'+t.columnName+'"; enlist `$"'+t.columnValue.toString()+'")')}}),1==e.length?"enlist "+e[0]:"("+e.join(";")+")"},pt._generateOrderingKdbSyntax=function(t){var e,n="";return n=2===(t=(t=t||"").split(",")).length&&"null"!=(e=t[1])?"`"+t[0]+";"+("asc"===e?1:-1):n},pt.strip=function(t){return t&&0<t.length?t.replace(/((^|\s+)\/.*$)|^\s+|\s*\n/gm," "):t},pt.constructPivotQuery=function(n){var t,e,i,o,s,a,r="",l="0j",u=n.pivotSource,c=n.table,p=this.strip(n.queryString),d=n.queryParams,h=n.aggFn,g=n.aggregateFns,m=n._generateOrderingKdbSyntax,f=/^[A-Za-z0-9]+\w*$/;function y(t){return 1<t.length?_.reduce(t,function(t,e,n,i){t+=";"!==t.substr(-1)&&0<n?";":"";return e.match(f)?t+="`"+e:t+='`$"'+e+'"'+(n<i.length-1?";":""),t},"(")+")":1===t.length?t[0].match(f)?"enlist `"+t[0]:'enlist `$"'+t[0]+'"':void 0}return m=this._generateOrderingKdbSyntax(m),a=y(n.dimensions),t=y(_.isArray(n.aggregateLabels)&&!_.isEmpty(n.aggregateLabels)?_.map(n.aggregateLabels,function(t,e){return t||n.aggregateCols[e]}):n.aggregateCols),e=this.constructPivotWhereString(n.wheres),1===n.aggregateCols.length&&(r="enlist "),r+="(",_.each(n.aggregateCols,function(t,e){0<t.length&&(o=g&&g[e]||h,r+="("+o+";"+(t.match(f)?"`"+t:'`$"'+t+'"')+");")}),r=r.substr(0,r.length-1)+")",n.topX&&"null"!==n.topX&&"all"!==n.topX&&(l=n.topX+"j"),a="`d`g!("+a+";"+(n.columnLabel&&0<n.columnLabel.length?"enlist `"+n.columnLabel:"()")+")","query"===u?(p=$.trim(p),u=/^{\[([a-z0-9A-Z\;\w\/ ]+?)\]/.exec(p),s="",$.isArray(u)?s=u[0]:"{[]"!==p.substring(0,3)?p="{[] "+p+"}[]":p+="[]",0<s.length&&(1===d.length?p=p+"["+d[0].name+"]":(p+="[",_.each(d,function(t,e){0<e&&(p+=";"),p+=t.name}),p+="]")),i=s+" "+this.PIVOT_FUNCTION+"["+p+";"+e+";"+a+";"+t+";"+r+";"+l+";("+m+")]",0<s.length&&(i+="}")):i=this.PIVOT_FUNCTION+"[`"+c+";"+e+";"+a+";"+t+";"+r+";"+l+";("+m+")]",i},pt.PIVOT_FUNCTION="$[{x~key x}`.pivot.pivotV3;.pivot.pivotV3;{[t;w;d;a;f;n;o] g:(); if [(type d)=99h; [g:d[`g]; d:d[`d],g;]];piv: 0!?[t;w;d!d;a!f]; if [(count g)>0; [d: (-1 _ d); a2:d,a; piv2: 0!?[piv;();g!g;a2!a2]; grpData:{[x;d;grpCol;f] labels: $[(count f)>1;(`$((string x[grpCol]) ,/: string f[;0]));x[grpCol]]; d xkey (d,labels) xcol flip x _ grpCol}; piv: 0! () uj/ each[grpData[;d;g[0];f]] piv2; ]]; if [(count o)>0;[field: o[0]; order: o[1]; piv:$[order>0;field xasc piv;field xdesc piv];]]; $[n<=0;piv;n sublist piv]}]",W.Pivot=pt,l=A=A||{},dt.applyAnalytic=function(){function t(t,e,n){i.setLastRunInfo(n||{}),i.onExecuteSubscriptionSuccess(t,i.get("_forceReset"),e)}function e(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];i.onError(i,i.attributes,t,"Error",e)}var i=this,n=i.get("_subscriptionKey")||l.DataSet.DEFAULT_ROW_INDEX;i.dataSet=new l.DataSet({idAttribute:n,collectionFunc:f.Collection.extend({model:f.Model.extend({idAttribute:n})}),agent:i.agent,applyMaxRowCountLimitOnReset:l.DocumentDataModel.DASH_ENGINE.isIEMode()||l.DocumentDataModel.DASH_ENGINE.isDirectMode_AND_isConnectionTargeting_insightsSDK(i.get("_connection")),maxRows:i.get("_maxRows"),primaryKey:n}),i.dataSet2=new l.DataSet2({idAttribute:n,collectionFunc:f.Collection.extend({model:f.Model.extend({idAttribute:n})}),agent:i.agent,maxRows:i.get("_maxRows"),primaryKey:n}),i.unset("error"),i.unset("queryStatus"),i.updateParameters(!0),"streaming"===i.get("_subscriptionType")?i.execute=i.wrapWithErrorHandler(function(){i.onExecuteBegin(),i.runWithConnectionCheck(e,function(){i.updateBuilder(function(){i.subscriptionId=l.DashClient.client.subscribe(i.get("_maxRows"),i.get("_selectedAnalytic"),i.get("_connection"),t,e,i.bindViewStateToKdbParams(i.get("_analyticParams"))),l.Log.Log("Subbd: "+i.subscriptionId)},e)})},i,i.attributes):i.execute=i.wrapWithErrorHandler(function(){i.onExecuteBegin(),i.runWithConnectionCheck(e,function(){i.updateBuilder(function(){l.DashClient.runAnalytic2(i.get("_selectedAnalytic"),i.get("_connection"),i.bindViewStateToKdbParams(i.get("_analyticParams")),t,e,i.get("_maxRows")||l.DocumentDataModel.DEFAULT_MAX_ROWS,null,i.performance)},e)})},i,i.attributes)},dt.applyQuery=function(){function n(t,e,n){o.setLastRunInfo(n||{}),o.onExecuteSuccess(t,o.get("_forceReset"),e)}function i(t){o.onError(o,o.attributes,t,"Error",arguments)}var o=this,t=o.get("_subscriptionKey")||l.DataSet.DEFAULT_ROW_INDEX;o.applyViewStateAttributes();o.dataSet=new l.DataSet({idAttribute:t,collectionFunc:f.Collection.extend({model:f.Model.extend({idAttribute:t})}),agent:o.agent,applyMaxRowCountLimitOnReset:l.DocumentDataModel.DASH_ENGINE.isIEMode()||l.DocumentDataModel.DASH_ENGINE.isDirectMode_AND_isConnectionTargeting_insightsSDK(o.get("_connection")),maxRows:o.get("_maxRows"),primaryKey:t}),o.dataSet2=new l.DataSet2({idAttribute:t,collectionFunc:f.Collection.extend({model:f.Model.extend({idAttribute:t})}),agent:o.agent,maxRows:o.get("_maxRows"),primaryKey:t}),o.unset("error"),o.unset("queryStatus"),o.updateParameters(),"streaming"===o.get("_subscriptionType")?o.execute=o.wrapWithErrorHandler(function(){o.onExecuteBegin();var t=o.get("_queryString"),e=o.bindViewStateToKdbParams(o.get("_queryParams")),t=dt.replaceParameters(t,e);o.subscriptionId=l.DashClient.client.subscribe(o.get("_maxRows"),t,o.get("_connection"),n,i),l.Log.Log("Subbd: "+o.subscriptionId)},o,o.attributes):o.execute=o.wrapWithErrorHandler(function(){o.onExecuteBegin();var t=o.get("_queryString"),e=o.bindViewStateToKdbParams(o.get("_queryParams"));t&&""!==t.trim()&&("sql"===o.get("_dataType")?l.DashClient.runAnalytic2(l.KdbQuery.executeSql,o.get("_connection"),[{type:"string",value:o.toSQLString(t,e)}],n,i,o.get("_maxRows")||l.DocumentDataModel.DEFAULT_MAX_ROWS,void 0,o.performance):"pykx"===o.get("_dataType")?l.DashClient.getQueryData2("q",o.get("_connection"),o.toPyKxString(t,e),[],n,i,o.get("_maxRows")||l.DocumentDataModel.DEFAULT_MAX_ROWS,void 0,o.performance):l.DashClient.getQueryData2("q",o.get("_connection"),t,e,n,i,o.get("_maxRows")||l.DocumentDataModel.DEFAULT_MAX_ROWS,void 0,o.performance))},o,o.attributes)},dt.bindViewStateToKdbParams=function(t){var o,a,r=this,e=[];return $.extend(!0,e,t),0<e.length&&_.each(e,function(s){var t,e,n,i;"string"==typeof s.value&&(a=s.value.match(l.DocumentDataModel.PARAMETER_RX))&&(t=r.getViewState().getByPath(a[0].substring(2,a[0].length-2)))&&(e=void 0,_.isFunction(t.get)?t.get("_rolling")&&s.useRollingSyntax?(e=l.Helpers.convertRollingToDate(t.get("_default"),t.get("_type")),(i=r.get(l.DocumentDataModel.AUTO_EXECUTE))&&r.stopListening(t,"change:value",r.onParameterChange),t.set("value",e),i&&r.listenTo(t,"change:value",r.onParameterChange)):e=t.get("value"):e=t.value,void 0===e&&(s.value=null),s.value=_.isObject(e)&&!_.isArray(e)?$.extend(!0,{},e):e),"dict"===s.type&&_.isObject(s.value)?_.each(_.keys(s.value),function(t){var e,n,i,o;s.value[t]instanceof f.Model?s.value[t]={type:s.value[t].get("_type"),IsKdbParam:!0,isViewState:!0,name:s.value[t].path,value:s.value[t].get("value")}:"object"==typeof s.value[t]?_.has(s.value[t],"_isKdbReady")||((o=r.getViewState().getByPath(s.value[t].name))?(s.value[t].type=o.get("_type"),s.value[t].value=o.get("value")):"string"==typeof s.value[t].value&&0===s.value[t].value.indexOf("<%")&&(i=s.value[t].value.substring(2,s.value[t].value.length-2),o=r.getViewState().getByPath(i))&&(e=void 0,o.get("_rolling")&&!0===s.value[t].useRollingSyntax?(e=l.Helpers.convertRollingToDate(o.get("_default"),o.get("_type")),(n=r.get(l.DocumentDataModel.AUTO_EXECUTE))&&r.stopListening(o,"change:value",r.onParameterChange),o.set("value",e),n&&r.listenTo(o,"change:value",r.onParameterChange),s.value[t].value=e):s.value[t].value=o.get("value"))):"string"==typeof s.value[t]&&0===s.value[t].indexOf("<%")&&(i=s.value[t].substring(2,s.value[t].length-2),o=r.getViewState().getByPath(i))&&(s.value[t]={type:o.get("_type"),IsKdbParam:!0,isViewState:!0,name:s.value[t],value:o.get("value")})}):(a=s.type,(o=l.RTTI.getByName(a))&&"dict"===o.name&&(n={},_.isString(s.value)&&(i=s.value.split(""),_.each(i,function(t){t=t.split("");6===t.length&&(n[t[0]]={type:t[1],IsKdbParam:!0,isViewState:!0,name:t[0],value:t[2]})})),s.value=n))}),e},dt.generatePivotModel=function(t,e,n,s){var a,r=this;return s.breakdownCols instanceof f.Model&&(s.breakdownCols=s.breakdownCols.get("value")),r.meta={},a=f.Model.extend({defaults:{_dataType:r.get("_dataType"),_pivotType:r.get("_pivotType"),_subscriptionType:r.get("_subscriptionType"),_subscriptionInterval:r.get("_subscriptionInterval")},idAttribute:t,childId:e,childModelType:n,initialize:function(){this.isDirty=!0,this.isPending=!1,this.legacyUpdates=[],this.agent=new l.Agent},apply:function(){this.dataSet=new l.DataSet({idAttribute:e,collectionFunc:f.Collection.extend({model:n}),agent:this.agent,maxRows:s.maxRows,primaryKey:e}),this.dataSet2=new l.DataSet2({idAttribute:e,agent:this.agent,maxRows:s.maxRows,primaryKey:e})},getRoot:function(){return r},getViewState:function(){return r.getViewState()},execute:function(t){function e(t,e){i.onExecuteSuccess(r.executeClientPivotQuery(r.clientPivotData,{wheres:s.wheres}),r.get("_forceReset"),void 0)}var n,i=this,o=!r.clientPivotData||r.isDirty||t&&t.intervalQuery;this.wheres||(this.wheres=s.wheres),i.onExecuteBegin();try{s.topX=null,s.ordering=null,s.queryParams=r.bindViewStateToKdbParams(r.get("_queryParams")),s.maxRows=r.get("_maxRows")||l.DocumentDataModel.DEFAULT_MAX_ROWS,s.queryString=s.queryString,_.each(s.wheres,function(t,e){var t="string"==typeof t?t:t.columnName,n=r.meta[t];s.wheres[e]={columnName:t,columnType:n,columnOperator:"=",columnValue:i.get(t)}}),n=function(t){r.onError(a,s,t,"Error",arguments)},"client"===i.get("_pivotType")?o?r.runWithConnectionCheck(n,function(){switch(r.get("_dataType")){case"query":l.DashClient.getQueryData("kdb",r.get("_connection"),s.queryString,s.queryParams,function(t){t&&(r.clientPivotData=t),e()},n,null,null,r.performance);break;case"virtual":r.executeVirtualQuery(r.get("_virtualQueryString"),r.get("_virtualParams"),function(t){r.clientPivotData=t,e()});break;case"sql":l.DashClient.runAnalytic(l.KdbQuery.executeSql,r.get("_connection"),[{type:"string",value:i.toSQLString(s.queryString,s.queryParams)}],function(t){r.clientPivotData=t,e()},n,r.get("_maxRows")||l.DocumentDataModel.DEFAULT_MAX_ROWS,void 0,r.performance);break;case"api":l.DashClient.runAnalytic(r.get("_selectedAnalytic"),r.get("_connection"),r.bindViewStateToKdbParams(i.get("_analyticParams")),function(t){r.clientPivotData=t,e()},n,r.get("_maxRows")||l.DocumentDataModel.DEFAULT_MAX_ROWS,null,r.performance)}}):e():r.runWithConnectionCheck(n,function(){dt.getPivotData(s,function(t,e){_.extend(r.meta,t.meta),i.onExecuteSuccess(t,r.get("_forceReset"),e,r.meta)},n,r.performance)})}catch(t){r.onError(a,s,t,"Error",arguments)}},exportPivotData:function(t,e){e("Pivot export not supported")},checkMaxRowLimit:r.checkMaxRowLimit,clearTimer_ignoreQueryStatusUpdates:r.clearTimer_ignoreQueryStatusUpdates,clearVirtualSubscriptions:_.noop,clearVirtualSubscriptionsAll:_.noop,executeClientPivotQuery:r.executeClientPivotQuery,formatValue:r.formatValue,getViewStateAttribute:r.getViewStateAttribute,isPagingData:r.isPagingData,legacyFlush:r.legacyFlush,legacyUpdate:r.legacyUpdate,logPrefix:r.logPrefix,onComplete:r.onComplete,onExecuteBegin:r.onExecuteBegin,onExecuteSuccess:r.onExecuteSuccess,reset:r.reset,start:r.start,stop:r.stop,subscribe:r.subscribe,triggerCallbacks:_.noop,updateVirtualSubscriptions:_.noop,unsubscribe:r.unsubscribe},{staticIdAttribute:t})},dt.testConnection=function(t,e,n){t=_.clone(t);t.dbtype=t.type,t.pass=t.password,l.DashClient.runAPI(".api.conUpsert","gw",[{type:"symbol",value:t.name},{type:"string",value:JSON.stringify(t)}],e,n)},dt.deleteConnection=function(t){l.DashClient.runAPI(".api.conDelete","gw",[{type:"symbol",value:t}],function(){},function(){})},dt.connectionCollectionSync=function(t,e,n){if("read"!==t)throw"data operation not supported for DocumentCollection";l.DashClient.runAPI(".api.conList","gw",[],function(t){return n.success(_.map(t.rows,function(t){return t.type=t.dbtype,delete t.dbtype,t.password=t.pass,delete t.pass,t}))},function(t){return n.error(t)})},dt.connectionSync=function(t,e,n){var i=this;switch(t){case"update":(o={}).originalName=i.get("originalName");case"create":var o=_.extend(o||{},{name:i.id,dbtype:i.get("type"),tls:i.get("tls"),host:i.get("host"),port:i.get("port"),user:i.get("user"),pass:i.get("password"),database:""}),s=i.isTargeting_insightsSDK();o.qipcport=s?i.get("qipcport"):"",l.DashClient.runAPI(".api.conUpsert","gw",[{type:"symbol",value:i.id},{type:"string",value:JSON.stringify(o)}],function(t){return n.success(t)},function(t){return n.error(t)});break;case"delete":l.DashClient.runAPI(".api.conDelete","gw",[{type:"symbol",value:i.id}],function(){return n.success()},function(t){return n.error(t)});break;default:throw"data operation not supported for Document"}},dt.documentCollectionSync=function(t,e,i){if("read"!==t)throw"data operation not supported for DashCollection";l.DashClient.runAPI(".api.dashList","gw",[],function(t){var e,n=[];t.rows.forEach(function(e){try{n.push(new l.Document(JSON.parse(e.description)))}catch(t){l.Log.Error("Error parsing dashboard description",e)}}),i.success&&((e=this.location.hostname)&&(n=_.filter(n,function(t){t=t.get("hostnameAccess");return!t||0<=t.indexOf(e)})),i.success(n))},function(t){alert("Retrieve Dashboards FAILED"),i.error&&i.error(t)})},dt.documentSync=function(t,e,n){var i,o=this;switch(t){case"read":l.DashClient.runAPI(".api.dashRead","gw",[{type:"symbol",value:o.id}],function(t){try{i=JSON.parse(t.rows[0].string)}catch(t){n.error&&n.error(t)}n.success&&n.success(i)},function(t){n.error&&n.error(t)});break;case"update":l.DashClient.runAPI(".api.dashUpsert","gw",[{type:"symbol",value:o.id},{type:"string",value:JSON.stringify(_.omit(o.attributes,["permissionEntity"]),null,2)}],function(){n.success&&n.success(o.attributes)},function(t){n.error&&n.error(t)});break;case"delete":l.DashClient.runAPI(".api.dashDelete","gw",[{type:"symbol",value:o.id}],function(){n.success&&n.success()},function(t){n.error&&n.error(t)});break;default:throw"data operation not supported for Document"}},dt.replaceParameters=function(t,n){var e,i=0;if("string"==typeof t){if(t=this.strip(t),(e=/^\{(\[([^\]]+)\])?(.*)\}$/.exec(t))&&4===e.length)return e[2]?(e=e[2].split(";"),i+=e.length,t+"["+_.map(e,function(t,e){return l.RTTI.getByName(n[e].type).toKDBInput(n[e].value)}).join(";")+"]"):t+"[]";t=t.replace(/<%[^<>%]+%>/g,function(t){var e=i++;return l.RTTI.getByName(n[e].type).toKDBInput(n[e].value)})}return t},dt.stop=function(){var t,e=this;e.pollingEvent&&(clearInterval(e.pollingEvent),e.pollingEvent=null),e.subscriptionId&&(l.DashClient.client.unsubscribe(e.subscriptionId),e.subscriptionId=null,e.isPending=!1),null!=(t=e.streamManager)&&t.destroy(),e.streamManager=null},dt.getPivotData=function(t,n,e,i){l.DashClient.getQueryData2("q",t.connection,l.Pivot.constructPivotQuery(t),t.queryParams,function(t,e){n(t,e)},e,t.maxRows,void 0,i)},dt.strip=function(t){return t&&0<t.length?t.replace(/((^|\s+)\/.*$)|^\s+|\s*\n/gm," ").trim():t},dt.parameterRx=new RegExp("<%([^<>%]+?)%>","g"),dt.DEFAULT_NULL_VALL=-0x8000000000000000,l.DashClientLib=dt,G=$,j=/\+/g,G.cookie=function(t,e,n){var i,o;if(void 0!==e&&!G.isFunction(e))return"number"==typeof(n=G.extend({},n)).expires&&(i=n.expires,(o=n.expires=new Date).setTime(+o+864e5*i)),document.cookie=[ht(t),"=",ht(String(e)),n.expires?"; expires="+n.expires.toUTCString():"",n.path?"; path="+n.path:"",n.domain?"; domain="+n.domain:"",n.secure?"; secure":""].join("");for(var s=t?void 0:{},a=document.cookie?document.cookie.split("; "):[],r=0,l=a.length;r<l;r++){var u=a[r].split("="),c=(c=u.shift(),decodeURIComponent(c)),u=u.join("=");if(t&&t===c){s=gt(u,e);break}t||void 0===(u=gt(u))||(s[c]=u)}return s},G.removeCookie=function(t,e){return void 0!==G.cookie(t)&&(G.cookie(t,"",G.extend({},e,{expires:-1})),!G.cookie(t))},n=A=A||{},mt.prototype.trigger=function(t){this.perf[t]=Date.now()},mt.prototype.set=function(t,e){this.perf[t]=e},Object.defineProperty(mt.prototype,"performance",{get:function(){return this.perf},enumerable:!1,configurable:!0}),n.PerformanceMetrics=mt,X=A=A||{},r.attemptUpload=function(t){r.logUploadConnected?X.DeltaClientLib.createLog(t,function(){},function(){r.logUploadConnected=!1,r.storeLocal(t),r.debounceRetryConnection()}):r.storeLocal(t)},r.logPerformanceMetrics=function(t,e){var n,i,o;r.clientLoggingEnabled&&(e=e.performance,n=e.onAgentNotify-e.apply,t="Performance Metrics<--\x3e"+h().format("H:mm:ss.SSS")+"<--\x3e"+t+" (Roundtrip: "+n.toFixed(0)+"ms)<--\x3e",o=function(t){var e=t/n*100;return t.toFixed(0)+" ms  "+e.toFixed(2)+"%"},(i=[])[0]=e.serverStart?e.serverStart-e.apply:0,i[1]=e.serverStart&&e.serverEnd?e.serverEnd-e.serverStart:n,i[2]=e.serverEnd?e.onAgentNotify-e.serverEnd:0,t=(t=(t+="Dispatch: "+o(i[0]))+", Server Duration: "+o(i[1]))+", IPC & Deserialize: "+o(i[2]),r.attemptUpload(t))},r.setClientLogging=function(){r.logUploadConnected=!0,r.clientLoggingEnabled=!0,r.traceConsoleError(),r.trace(X.Tools.getCookie("dashboard-log-level"))},r.trace=function(t){t=Number(t);r.clientLoggingEnabled?r.turnOnUploads(t):(r.Error=0<t?console.error.bind(console,"%s",r.logPrefix(r.Level.Error)):_.noop,r.Handled=1<t?console.error.bind(console,"%s",r.logPrefix(r.Level.Handled)):_.noop,r.Warn=1<t?console.warn.bind(console,"%s",r.logPrefix(r.Level.Warn)):_.noop,r.Debug=2<t?console.debug.bind(console,"%s",r.logPrefix(r.Level.Debug)):_.noop,r.Log=2<t?console.log.bind(console,"%s",r.logPrefix(r.Level.Info)):_.noop,r.Info=3<t?console.info.bind(console,"%s",r.logPrefix(r.Level.Info)):_.noop)},r.turnOnUploads=function(n){r.Error=function(t,e){0<n&&console.error(t,e||""),0<r.ServerLogLevel&&r.attemptUpload(r.logUploadString(this.Level.Error,t,e))},r.Handled=function(t,e){1<n&&console.error(t,e||""),1<r.ServerLogLevel&&r.attemptUpload(r.logUploadString(this.Level.Handled,t,e))},r.Warn=function(t,e){1<n&&console.warn(r.logPrefix(this.Level.Warn)+t,e||""),2<r.ServerLogLevel&&r.attemptUpload(r.logUploadString(this.Level.Warn,t,e))},r.Debug=function(t,e){2<n&&console.debug(r.logPrefix(this.Level.Debug)+t,e||""),2<r.ServerLogLevel&&r.attemptUpload(r.logUploadString(this.Level.Debug,t,e))},r.Log=function(t,e){2<n&&console.log(r.logPrefix(this.Level.Log)+t,e||""),2<r.ServerLogLevel&&r.attemptUpload(r.logUploadString(this.Level.Log,t,e))},r.Info=function(t,e){3<n&&console.info(r.logPrefix(this.Level.Info)+t,e||""),3<r.ServerLogLevel&&r.attemptUpload(r.logUploadString(this.Level.Info,t,e))}},r.getStackTrace=function(){return"\nStack Trace: "+(new Error("").stack||"").split("\n").slice(3,9).join("\n")},r.logPrefix=function(t){function e(){}return e.toString=function(){return t+"\t"+h().format("H:mm:ss.SSS")+"\t"},e},r.logUploadString=function(t,e,n){e=t+"<--\x3e"+h().format("H:mm:ss.SSS")+"<--\x3e"+e+"<--\x3e";return n&&(e+=JSON.stringify(n)),t!==this.Level.Info&&(e+=r.getStackTrace()),e},r.retryConnection=function(t){var e=[1,3,15,60,180,900];t===e.length&&--t,setTimeout(function(){r.uploadStoredLogs(t)},1e3*e[t])},r.storeLocal=function(t){var e,n,i=localStorage.length-1;if(localStorage.getItem("0000"))for(;!n;)(e=localStorage.key(i)).match(/\d\d\d\d/)&&(n=("000"+(parseInt(e)+1)).slice(-4)),--i;else n="0000";localStorage.setItem(n,t)},r.traceConsoleError=function(){var i=console.error;console.error=function(t,e){var n=r.logPrefix(r.Level.Error)+t;i.apply(console,[n,e||""]),r.attemptUpload(r.logUploadString(r.Level.Error,t,e))}},r.uploadStoredLogs=function(e){function n(t){t<localStorage.length?(i=localStorage.key(t)).match(/\d\d\d\d/)?(o=localStorage.getItem(i),X.DeltaClientLib.createLog(o,function(){s=!0,localStorage.removeItem(i),n(t)},function(){r.retryConnection(s?0:e+1)})):n(t+1):r.logUploadConnected=!0}var i,o,s=!1;n(0)},r.ServerLogLevel=4,r.debounceRetryConnection=_.debounce(function(){r.retryConnection(0)},300,{maxWait:1e3}),n=r,X.Log=n,(i=(i=n=X.Log||(X.Log={})).Level||(i.Level={})).Info="INFO",i.Warn="WARN",i.Error="ERROR",i.Fatal="FATAL",i.Critical="CRITICAL",i.Off="OFF",i.Handled="HANDLED",i.Debug="DEBUG",n.trace($.cookie("dashboard-log-level")),window.onerror=function(t,e,n,i,o){t&&t.toString&&t.toString(),o&&o.toString&&o.toString(),X.DeltaClientLib.createLog(t+"<--\x3e"+h().format("H:mm:ss.SSS")+"<--\x3e"+o,_.noop,_.noop)},Z=A=A||{},ft.initializeDeltaClient=function(t,e,n,i,o,s,a,r,l,u,c,p,d){this.host=t,this.port=e,this.secure=n,this.fromUrl=i,this.username=o,this.successCallback=a,this.errorCallback=r,this.token=l,this.appid=u,this.saml=p,this.forceLogin=d,this.properties={},this.clientLoggedIn=!1,this.errorCallback=r,sessionStorage&&sessionStorage.getItem("isLoggingOut")?(t=sessionStorage.getItem("logoutType"),sessionStorage.removeItem("isLoggingOut"),sessionStorage.removeItem("logoutType"),e=t?t.toLowerCase():"",n=window.location.origin,win.Client.toSsoLogoutEndpoint(e,n)):this.deltaClient?this.saml?this.deltaClient.register("dashboards"):this.deltaClient.login(this.username,s,this.appid,[],this.forceLogin):(this.deltaClient=new win.Client({host:this.host,port:this.port,secure:this.secure,fromURL:this.fromUrl},c,c),this.initDeltaClient(s))},ft.initializeDeltaClientCopy=function(t,e,n,i,o,s,a,r,l,u,c){this.host=e,this.port=n,this.secure=i,this.fromUrl=o,this.username=s,this.successCallback=r,this.errorCallback=l,this.appid=u,this.saml=c,this.properties={},this.clientLoggedIn=!0,this.deltaClient=t,this.deltaClient.DeltaClientLogin=!0,this.initDeltaClient(a)},ft.initDeltaClient=function(t){var n=this,i=!1,o=null;this.deltaClient.status._subscribe({next:function(t){switch(t.type){case win.Client.status.CONNECTING:i&&($(n).trigger("DeltaClientDisconnect"),n.disconnected=!0),n.eCode=t.eCode,o=o||_.delay(function(){n.sendError(1006===n.eCode?"WebSocket connection error, please check proxy settings":"Server connectivity issues, please try again.")},n.DEFAULT_TIMEOUT);break;case win.Client.status.CONNECTED:try{i=!0;var e=n.deltaClient.systemConfig();e&&(n.showLastLoginAttempts=e.showLastLoginAttempts),n.clientLoggedIn?$(n).trigger("DeltaClientConnect"):n.onFirstLogin(),clearTimeout(o),$.cookie("deltaToken",n.deltaClient.tokenKey(),{expires:30,path:"/;SameSite=Strict",secure:"https:"===_.get(window,"location.protocol")}),o=null}catch(t){n.sendError("There was a problem connecting to the server: "+t)}break;case win.Client.status.LOGGED_IN:clearTimeout(o),o=null,n.username=n.deltaClient.user();break;case win.Client.status.LOGGED_OUT:n.changingPassword&&_.isString(t.data)&&-1!==t.data.indexOf("Client action")?setTimeout(function(){this.changingPasswordFailed=!1,this.deltaClient.resetPassword(this.username,this.changingPasswordOld,this.changingPasswordNew)},500):_.isString(t.data)&&-1===t.data.indexOf("no connection available")?($.removeCookie("deltaToken",{path:"/;SameSite=Strict"}),n.saml?n.ssoLogout("local"):(-1!==t.data.indexOf("timeout")?$.cookie("deltaLoginError","Your session timed out",{expires:30,path:"/;SameSite=Strict",secure:"https:"===_.get(window,"location.protocol")}):-1!==t.data.indexOf("force logout")?$.cookie("deltaLoginError","Forced logout",{expires:30,path:"/;SameSite=Strict",secure:"https:"===_.get(window,"location.protocol")}):-1!==t.data.indexOf("session limit")?$.cookie("deltaLoginError",t.data.split("|")[2],{expires:30,path:"/;SameSite=Strict",secure:"https:"===_.get(window,"location.protocol")}):$.removeCookie("deltaLoginError",{path:"/;SameSite=Strict"}),window.onbeforeunload=function(t){},location.reload())):!t.data&&n.disconnected?n.errorCallback("loginRequired"):i&&($.removeCookie("deltaToken",{path:"/;SameSite=Strict"}),location.reload());break;case win.Client.status.EXPIRED:clearTimeout(o),o=null,Z.Log.Log("Expired",t),n.sendError("Your password has expired");break;case win.Client.status.RESET:clearTimeout(o),o=null,$(n).trigger("Reset"),n.sendError("Please reset password"),Z.Log.Log("Reset",t);break;case win.Client.status.RESET_FAIL:clearTimeout(o),o=null,n.changingPasswordFail&&n.changingPasswordFail(t.data),n.changingPasswordFailed=!0,Z.Log.Log("Reset Fail",t);break;case win.Client.status.RESET_SUCCESS:n.changingPassword&&(n.changingPasswordFailed?n.changingPassword=!1:(n.changingPasswordSuccess&&n.changingPasswordSuccess(),n.changingPassword=!1,n.changingPasswordFail=null,n.changingPasswordSuccess=null,n.changingPasswordOld=null,n.changingPasswordNew=null,n.successCallback&&n.successCallback(),$.cookie("deltaLoginError","Password changed. Please login again.",{expires:30,secure:"https:"===_.get(window,"location.protocol"),path:"/;SameSite=Strict"}),$.removeCookie("deltaToken",{path:"/;SameSite=Strict"})));break;case win.Client.status.FAULT:Z.Log.Log("Fault",t),clearTimeout(o),o=null,"userSessionLimit"!==t.data&&$.removeCookie("deltaToken",{path:"/;SameSite=Strict"}),n.sendError(t.data)}},error:function(){Z.Log.Error("onError",arguments)},complete:function(){Z.Log.Info("onCompleted",arguments)}}),this.token=this.token||this.deltaClient.tokenKey(),this.deltaClient.DeltaClientLogin?this.onFirstLogin():this.saml?this.deltaClient.register("dashboards"):this.token?this.deltaClient.loginWithTokenKey(this.token,this.appid):this.deltaClient.login(this.username,t,this.appid,[],this.forceLogin)},ft.getDashboardProperty=function(t){return this.properties[t]},ft.changeUserPassword=function(t,e,n,i){this.changingPassword||(this.changingPassword=!0,this.changingPasswordOld=t,this.changingPasswordNew=e,this.changingPasswordSuccess=n,this.changingPasswordFail=i,this.changingPasswordFailed=!1,this.deltaClient.resetPassword(this.username,this.changingPasswordOld,this.changingPasswordNew))},ft.onFirstLogin=function(){var e=this;this.deltaClient.request("ConfigAPI.getConfigParameter",function(t){t.rows.forEach(function(t){e.properties[t.Property.elementValue]=t.Value.elementValue}),"true"==e.properties.legacy_managed&&(e.startManagedQuery=e.startLegacyManagedQuery,e.startManagedQuery2=e.startLegacyManagedQuery2),Z.Tools.timezone=$.cookie("dashboard-timezone")||e.properties.timezone||h.tz.guess(),e.clientLoggedIn=!0,e.deltaClient.clientLoggingEnabled()&&(e.properties.hasOwnProperty("log-level")&&(Z.Log.ServerLogLevel=Number(e.properties["log-level"])),Z.Log.setClientLogging()),$(e).trigger("DeltaClientLogin"),e.deltaClient.DeltaClientLogin=!0,e.successCallback&&e.successCallback(),$(e).trigger("DeltaClientConnect")},_.noop,"DASHproperties","DEFAULT","delta_install_default")},ft.sendError=function(t,e){this.errorCallback&&this.errorCallback(t)},ft.ssoLogout=function(t){this.deltaClient&&this.deltaClient.ssoLogout(t),$.removeCookie("deltaToken",{path:"/;SameSite=Strict"}),_.delay(function(){location.reload()},500)},ft.clientLoggedIn=!1,ft.changingPassword=!1,ft.changingPasswordFailed=!1,ft.disconnected=!1,ft.DEFAULT_TIMEOUT=6e4,Z.DCBase=ft,i=A=A||{},tt=function(t,e){this.offset=t,this.qtype=e},i.qAtom=tt,e(yt,J=tt),et=yt,i.qVector=et,nt=function(t,e,n){this.qtype=0,this.isSorted=t,this.values=e,this.end=n},i.qGenericList=nt,it=function(t,e){this.qtype=11,this.isSorted=t,this.offsets=e},i.qSymList=it,ot=function(t,e,n,i){this.keys=n,this.values=i,this.qtype=t,this.isSorted=e},i.qDict=ot,i.getTypeSize=vt,i.u8u16=function(t){for(var e=[],n=0;n<t.length;n++){var i=t.charCodeAt(n);i<128?e.push(i):i<2048?e.push(192|i>>6,128|63&i):i<55296||57344<=i?e.push(224|i>>12,128|i>>6&63,128|63&i):(i=65536+((1023&i)<<10|1023&t.charCodeAt(++n)),e.push(240|i>>18,128|i>>12&63,128|i>>6&63,128|63&i))}return e},i.u16u8=bt,i.IPCuncompress=function(t){var e=new Uint8Array(t);if(e.length<13)return e;for(var n,i=0,o=0,s=8,a=s,r=0,l=12,t=(t=e.buffer.slice(8,12),new Uint32Array(t)[0]),u=new Uint8Array(t),c=new Int32Array(256);s<u.length;){if(0==r&&(o=255&e[l++],r=1),0!=(o&r)){n=c[255&e[l++]],u[s++]=u[n++],u[s++]=u[n++];for(var i=255&e[l++],p=0;p<i;p++)u[s+p]=u[n+p]}else u[s++]=e[l++];for(;a<s-1;)c[255&u[a]^255&u[a+1]]=a++;0!=(o&r)&&(a=s+=i),256==(r*=2)&&(r=0)}return u.buffer},i.IPCisCompressed=function(t){return 1===new Uint8Array(t)[2]},i.deserialize=function(t,e,n){var p=void 0===e?8:e,d=new DataView(t);function h(){return d.getInt8(p++)}function g(){return d.getUint8(p++)}function m(){var t=d.getInt32(p,!0);return p+=4,t}function f(t){var e,n=1===g(),i=m(),o=vt(t);if(o)return e=new et(t,n,i,p),p+=i*o,e;if(11===t){for(var s=new Array(i),a=0;a<i;a++){s[a]=p;for(;0!==g(););}return new it(n,s)}if(0!==t)throw"Unsupported type";for(var r=new Array(i),a=0;a<i;a++)r[a]=v();return new nt(n,r,p)}function y(){var t=1===g();return 99!==h()&&console.error("c.js Assertion type=99 failed."),new ot(98,t,f(h()),f(h()))}function v(){var t,e,n,i=h();if(-20<i&&i<0){var o=i,s=new tt(p,o),a=vt(-o);if(a)p+=a;else{if(-11!==o)throw"Unsupported type";for(;0!==g(););}return s}if(99<i){a=new tt(p,i);if(100===i){for(var r,l=[];0!==(r=d.getUint8(p++));)l.push(r);return bt(l),v()}if(i<104)return 0===h()&&101===i?new tt(p-1,i):a;if(105<i)v();else for(var u=0,c=m()||0;u<c;u++)v();return a}return 99===i?98===d.getUint8(p)?(t=1===g(),e=y(),p++,n=y(),new ot(99,t,e,n)):(t=f(h()),n=98===(e=g())?y():f(e),new ot(99,!1,t,n)):98===i?y():f(i)}if(n){if(0===h()){m();if(0===h()&&-6===h())return e=m(),h(),[e,g(),v()]}return[0,5,"Message parse error"]}return v()};var n=A=A||{};(i=St=n.CommandOp||(n.CommandOp={}))[i.Add=0]="Add",i[i.Remove=1]="Remove",i[i.Set=2]="Set";var St,wt=function(t,e,n){this.op=t,this.key=e,this.payload=n},_t=(n.Todo=wt,Tt.pathArrayToText=function(t){return t.reverse().join(".")},Tt.prototype.pathText=function(){return Tt.pathArrayToText(this.path)},Tt);function Tt(t,e,n,i){this.title=t,this.path=e,this.todo=n,this.undo=i}n.Command=_t,Ct=f.Model,e(Dt,Ct),Dt.prototype.setParent=function(t){this.parent=t},Dt.prototype.getComponents=function(){return[]};var Ct,i=Dt;function Dt(t,e,n){t=Ct.call(this,t,e)||this;return t.parent=n,t}n.CommandoModel=i,Et=f.Collection,e(Mt,Et),Mt.prototype.commandAdd=function(t,e){var n=_.isArray(t)?t:[t];this.postCommand(this,new _t(this.getCommandDescription(St.Add,t,e||"Add"),[],n.map(function(t){return new wt(St.Add,"",{attributes:t.toJSON()})}),n.map(function(t){return new wt(St.Remove,"",t.id)})))},Mt.prototype.commandRemove=function(t){var e=this,n=_.isArray(t)?t:[t];this.postCommand(this,new _t(this.getCommandDescription(St.Remove,t),[],n.map(function(t){return new wt(St.Remove,"",t.id)}),n.map(function(t){return new wt(St.Add,"",{attributes:t.toJSON(),index:e.findIndex(t)})})))},Mt.prototype.commandSet=function(t){var i=this,e=t.map(function(t,e){var n=i.get(t.id)||i.at(e);if(n)return e=n.changedAttributes(t),t=_.mapValues(e,function(t,e){return n.previous(e)}),n.id&&(t.id=n.id),t});this.postCommand(this,new _t(this.getCommandDescription(St.Set,t),[],[new wt(St.Set,"",t)],[new wt(St.Set,"",e)]))},Mt.prototype.doCommand=function(t,e){var n=this,i=t.pop();i?(i=this.get(i))&&i.doCommand(t,e):e.forEach(function(t){n.doCommandByOp[t.op](t.payload)})},Mt.prototype.doCommandAdd=function(t){this.add(t.attributes,{at:t.index})},Mt.prototype.doCommandSet=function(t){this.set(t,{remove:!1})},Mt.prototype.doCommandRemove=function(t){this.remove(t)},Mt.prototype.getCommandDescription=function(t,e,n){var i=this.getCommandDescriptor(e);return(n=n||St[t])+" "+(i=i&&_.isArray(e)&&1<e.length?this.getPluralDescriptor(i):i)},Mt.prototype.getCommandDescriptor=function(t){return this.descriptor},Mt.prototype.getComponents=function(){return _.flatMap(this.models,function(t){return t.getComponents()})},Mt.prototype.getPluralDescriptor=function(t){return t+"s"},Mt.prototype.postCommand=function(t,e){return this.parent.postCommand(this,e)},Mt.prototype.preinitialize=function(t,e){this.parent=e.parent},Mt.prototype.setParent=function(t){this.parent=t},Mt.prototype._prepareModel=function(t,e){return this._isModel(t)?(t.collection||(t.collection=this),t):(t=new((e=e?_.clone(e):{}).collection=this).model(t,e,this)).validationError?(this.trigger("invalid",this,t.validationError,e),!1):t};var Et,i=Mt;function Mt(t,e,n){t=Et.call(this,t,_.extend(e,{parent:n}))||this;return t.doCommandByOp=((e={})[St.Add]=t.doCommandAdd.bind(t),e[St.Remove]=t.doCommandRemove.bind(t),e[St.Set]=t.doCommandSet.bind(t),e),t}n.ComandoCollection=i;function Pt(t,e){if(("Accordion"===t||"Popup"===t)&&e&&e.widgets&&1<e.widgets.length&&!(e.widgets instanceof f.Collection))if("Popup"===t){t=_.findLast(e.widgets,function(t){return t.component});e.widgets.length=0,t&&e.widgets.push(t)}else for(var n,i={},o=e.widgets.length-1;0<=o;o--)i[n=e.widgets[o].sectionId]?e.widgets.splice(o,1):i[n]=!0}It=f.Model,e(b,It),b.objToPaths=function(t,e,n){var i,o,s=!1,a={},r=b.keyPathSeparator;for(o in t){var l=t[o];if(n=n?n+r+o:o,(!0===e||e&&"string"==typeof e&&e!==n&&0===e.indexOf(n))&&(s=!0),l&&l.constructor===Object)if(_.isEmpty(l))a[o]=l;else if(_.has(l,"_dashboardsType"))a[o]=l;else for(var u in i=this.objToPaths(l,e,n)){var c=i[u];a[o+r+u]=c}else if(l&&l.constructor===Array&&s)for(var u in i=this.objToPaths(l,e,n)){c=i[u];a[o+r+u]=c}else a[o]=l}return a},b.getNested=function(t,e,n){for(var i=e?e.split(b.keyPathSeparator):[],o=t,s=0,a=i.length;s<a;s++){if(n&&!_.has(o,i[s]))return!1;if(void 0===(o=null==(o=o[i[s]])&&s<a-1?{}:o))return!!n||o}return!!n||o},b.setNested=function(t,e,n,i){i=i||{};for(var o=e?e.split(b.keyPathSeparator):[],s=t,a=0,r=o.length;a<r&&void 0!==s;a++){var l,u=o[a];a===r-1?i.unset?delete s[u]:s[u]=n:(void 0!==s[u]&&_.isObject(s[u])||(l=o[a+1],s[u]=/^\d+$/.test(l)?[]:{}),s=s[u])}},b.deleteNested=function(t,e){this.setNested(t,e,null,{unset:!0})},b.prototype.toJSON=function(t){return _.merge({},this.attributes)},b.prototype.get=function(t){return b.getNested(this.attributes,t)},b.prototype.set=function(t,e,n){var i,o,s,a,r,l,u,c;if(null!=t){if("object"==typeof t?(o=t,n=e||{}):(o={})[t]=e,!this._validate(o,n=n||{}))return null;for(i in s=n.unset,r=n.silent,a=[],l=this._changing,this._changing=!0,l||(this._previousAttributes=_.merge({},this.attributes),this.changed={}),c=this.attributes,u=this._previousAttributes,this.idAttribute in o&&(this.id=o[this.idAttribute]),o=b.objToPaths(o))e=o[i],_.isEqual(b.getNested(c,i),e)||a.push(i),_.isEqual(b.getNested(u,i),e)?b.deleteNested(this.changed,i):b.setNested(this.changed,i,e),s?b.deleteNested(c,i):b.setNested(c,i,e);if(_.each(this.changed,_.bind(function(t,e){_.isEmpty(t)&&_.isObject(t)&&!_.isArray(t)&&delete this.changed[e]},this)),!r){a.length&&(this._pending=!0);for(var p=b.keyPathSeparator,d={},h=0,g=a.length;h<g;h++)for(var t=a[h],m=(d.hasOwnProperty(t)&&d[t]||(d[t]=!0,this.trigger("change:"+t,this,b.getNested(c,t),n)),t.split(p)),f=m.length-1;0<f;f--){var y=m.slice(0,f).join(p),v=y+p+"*";d.hasOwnProperty(v)&&d[v]||(d[v]=!0,this.trigger("change:"+v,this,b.getNested(c,y),n)),d.hasOwnProperty(y)&&d[y]||(d[y]=!0,this.trigger("change:"+y,this,b.getNested(c,y),n))}}if(!l){if(!r)for(;this._pending;)this._pending=!1,this.trigger("change",this,n);this._pending=!1,this._changing=!1}}return this},b.prototype.clear=function(t){var e,n={};for(e in b.objToPaths(this.attributes))n[e]=void 0;return this.set(n,_.extend({},t,{unset:!0}))},b.prototype.hasChanged=function(t){return null==t?!_.isEmpty(this.changed):void 0!==b.getNested(this.changed,t)},b.prototype.changedAttributes=function(t,e){if(!t)return!!this.hasChanged()&&b.objToPaths(this.changed,e);var n,i=this._changing?this._previousAttributes:this.attributes,o=b.objToPaths(t),s=b.objToPaths(i),a=!1;for(n in o)_.includes(["array","object"],typeof i[n])&&void 0===t[n]?(a=a||{})[n]=void 0:_.isEqual(s[n],o[n])||((a=a||{})[n]=o[n]);return a},b.prototype.previous=function(t){return null!=t&&this._previousAttributes?b.getNested(this._previousAttributes,t):null},b.prototype.previousAttributes=function(){return _.merge({},this._previousAttributes)},b.prototype.toFlat=function(t){return b.objToPaths(this.attributes,t)},b.keyPathSeparator=".";var It,n=b;function b(t,e){var n,i=It.call(this,t,e)||this,o=t||{};return i.cid=_.uniqueId("c"),i.attributes={},e&&e.collection&&(i.collection=e.collection),e&&e.parse&&(o=i.parse(o,e)||{}),(n=_.result(i,"defaults"))&&(o=_.merge(n,o)),i.set(o,e),i.changed={},i.initialize.apply(i,arguments),i}f.DeepModel=n;function At(){return{appArgs:{json:{Style:{advanced:"",cssClasses:""},Alignment:{paddingLeft:null,paddingRight:null,paddingTop:null,paddingBottom:null,innerPaddingLeft:null,innerPaddingRight:null,innerPaddingTop:null,innerPaddingBottom:null,titlePaddingLeft:null,titlePaddingRight:null,titlePaddingTop:7,titlePaddingBottom:7},format:{widgetTitle:null,titleFontSize:16,titleHorizontal:"Center",titleColor:null,titleBottomBorderWidth:null,titleFontBold:null,titleShadow:!1,titleBackgroundColor:null,titleTransparentBackground:null,tileBorderWidth:null,tileBorderRounding:null,tileBorderColor:null,tileBackgroundColor:null,tileTransparentBackground:null,tileShadow:null}},schema:{properties:{Style:{type:"object",title:"Style",options:{collapsed:!0},properties:{advanced:{type:"css",title:"Advanced CSS",default:""},cssClasses:{type:"string",title:"CSS Classes",default:""}}},Alignment:{type:"object",title:"Margins",options:{collapsed:!0},properties:{paddingLeft:{type:"number",title:"Outer Left",default:null,format:"number",propertyOrder:2001},paddingRight:{type:"number",title:"Outer Right",default:null,format:"number",propertyOrder:2002},paddingTop:{type:"number",title:"Outer Top",default:null,format:"number",propertyOrder:2003},paddingBottom:{type:"number",title:"Outer Bottom",default:null,format:"number",propertyOrder:2004},innerPaddingLeft:{type:"number",title:"Inner Left",default:null,format:"number",propertyOrder:2005},innerPaddingRight:{type:"number",title:"Inner Right",default:null,format:"number",propertyOrder:2006},innerPaddingTop:{type:"number",title:"Inner Top",default:null,format:"number",propertyOrder:2007},innerPaddingBottom:{type:"number",title:"Inner Bottom",default:null,format:"number",propertyOrder:2008},titlePaddingLeft:{type:"number",title:"Title Left",default:null,format:"number",propertyOrder:2009},titlePaddingRight:{type:"number",title:"Title Right",default:null,format:"number",propertyOrder:2010},titlePaddingTop:{type:"number",title:"Title Top",default:null,format:"number",propertyOrder:2011},titlePaddingBottom:{type:"number",title:"Title Bottom",default:null,format:"number",propertyOrder:2012}}},format:{type:"object",title:"Format",options:{collapsed:!0},properties:{widgetTitle:{type:"string",title:"Title",propertyOrder:2001},titleFontSize:{type:"number",title:"Title Font Size",propertyOrder:2002},titleColor:{type:"gradient",title:"Title Font Color",options:{gradient:!1,noColor:!0},default:null,propertyOrder:2003},titleFontBold:{type:"boolean",title:"Title Bold",default:!1,format:"checkbox",propertyOrder:2004},titleShadow:{type:"boolean",title:"Title Shadow",default:!1,format:"checkbox",propertyOrder:2005},titleHorizontal:{type:"string",title:"Title Horizontal Align",enum:["Left","Center","Right"],propertyOrder:2006},titleBottomBorderWidth:{type:"number",title:"Title Bottom Border Size",default:null,format:"number",propertyOrder:2007},titleBackgroundColor:{type:"gradient",title:"Title Background Color",default:null,options:{gradient:!1,noColor:!0},propertyOrder:2008},titleTransparentBackground:{type:"boolean",title:"Title Transparent Background",default:!1,format:"checkbox",propertyOrder:2009},tileBackgroundColor:{type:"gradient",title:"Background Color",default:null,options:{gradient:!1,noColor:!0},propertyOrder:2010},tileTransparentBackground:{type:"boolean",title:"Transparent Background",default:!1,format:"checkbox",propertyOrder:2011},tileBorderWidth:{type:"number",title:"Border Size",default:null,format:"number",propertyOrder:2012},tileBorderRounding:{type:"number",title:"Border Rounding",default:null,format:"number",propertyOrder:2013},tileBorderColor:{type:"gradient",title:"Border Color",default:null,options:{gradient:!1,noColor:!0},propertyOrder:2014},tileShadow:{type:"boolean",title:"Component Shadow",default:!1,format:"checkbox",propertyOrder:2015}}}}}}}}var kt,xt,Nt=A=A||{};Lt=f.DeepModel,e(Vt,Lt),Vt.setDataProperties=function(t){if(t){for(var e in t)t[e]&&t[e].path?t[e]instanceof Nt.DocumentDataModel?t[e]={_dashboardsType:"data",value:t[e].path}:t[e]instanceof Nt.DocumentViewModel&&(t[e]={_dashboardsType:"viewstate",value:t[e].path}):"object"==typeof t[e]&&(t[e]=Vt.setDataProperties(t[e]));return t}},Vt.prototype.initialize=function(){this.listenTo(this,"change",this.determineMaterialChange.bind(this))},Vt.prototype.clone=function(t){var o,s,a,e={},r=function(n,i){_.each(_.keys(n),function(t){var e=0;if(n[t]instanceof Nt.DocumentViewModel||n[t]instanceof Nt.DocumentDataModel)i[t]=n[t];else if(n[t]instanceof Array)for(i[t]=new Array(n[t].length),e=0;e<n[t].length;e+=1)_.isObjectLike(n[t][e])?(i[t][e]=n[t][e]instanceof Array?[]:{},r(n[t][e],i[t][e])):i[t][e]=n[t][e];else n[t]instanceof Date?(i[t]=new Date,i[t].setTime(n[t].getTime())):_.isObject(n[t])?(i[t]={},r(n[t],i[t])):"advanced"===t&&-1!==n[t].indexOf(o)&&s?i[t]=n[t].replace(a,s):i[t]=n[t]})};return t&&(o=t.previousWidgetId,s=t.widgetId,a=new RegExp(o,"g")),r(this.attributes,e),new Vt(e,{},this.parent)},Vt.prototype.commandSet=function(t){var n=this,e=_.mapValues(t,function(t,e){return n.get(e)}),i=_.keys(t),o="Set ",i=(i[0]&&(o+=_.last(i[0].split("."))),1<i.length&&(o+=" & "+(i.length-1)+" more"),new Nt.Command(o,[],[new Nt.Todo(Nt.CommandOp.Set,"",t)],[new Nt.Todo(Nt.CommandOp.Set,"",e)]));this.postCommand(this,i)},Vt.prototype.determineMaterialChange=function(t,e){t.changed&&!_.isEmpty(_.omit(t.changed,t.IMMATERIAL_ATTRIBUTES))&&this.trigger("materialChange")},Vt.prototype.doCommand=function(t,e){var n=this;e.forEach(function(t){n.set(t.payload)})},Vt.prototype.postCommand=function(t,e){return this.parent&&this.parent.postCommand(this,e)},Vt.prototype.setParent=function(t){this.parent=t},Vt.prototype.toDiff=function(t){var o={},s=this._templates;return s&&s.Defaults&&(_.defaultsDeep(s.Defaults,At().appArgs.json),_.each(t,_.bind(function(t,i){var e;s.Defaults[i]&&("string"==typeof t?o[i]=t:_.isArray(t)||(e=ct.getDiff(t,s.Defaults[i]),_.isEmpty(e))||(o[i]=e),_.isArray(t))&&_.each(t,_.bind(function(t,e){var n={},n=t&&t._Hidden&&t._Hidden._Type?ct.getDiff(t,s[i][t._Hidden._Type]):void 0!==s[i]&&s[i][i]?ct.getDiff(t,s[i][i]):t;o[i]=void 0===o[i]?[]:o[i],o[i].push(n)},this))},this))),o},Vt.prototype.toJSON=function(){var t=$.extend(!0,{},this.attributes),e=(Vt.setDataProperties(t),this.toDiff(t));return _.isEmpty(e)?t:e};var Lt,Rt=Vt;function Vt(t,e,n){t=Lt.call(this,t,e)||this;return t.IMMATERIAL_ATTRIBUTES=["version","poss_sel_cols","possible_axis","possible_colors","possible_columns","possible_dashboards","possible_floats","possible_keys","possible_labels","possible_Period","possible_screens","possible_selected_columns","possible_servers","possible_shapes","possible_strings","possible_track","possible_values","possible_viewstates","possibleColumns","possibleConnections","possibleKeys","possibleLabels","possibleValues","datagridPossibleColumns","datagridPossibleColumnsWithItself","selectedColumnPossibleValues","highlightTargetPossibleValues","sortingPossibleValues","Selection"],t.parent=n,t}Nt.ComponentOptions=Rt,Ot=Nt.CommandoModel,e($t,Ot),$t.convertDashboardTypesToModels=function(i,t,e){var o,s,a,r=f.DeepModel.keyPathSeparator;i&&(o={data:t,viewstate:e},t=i.toFlat(!0),s=_.keys(o),a=function(t,e){var n;_.isObject(t)&&_.includes(s,t._dashboardsType)&&"string"==typeof(n=t.value)&&((t=(t=o[t._dashboardsType](n))||{}).path=n,i.set(e,t,{silent:!0}))},_.each(t,function(t,i){_.isArray(t)?_.each(t,function(t,n){_.each(t,function(t,e){a(t,i+r+n+r+e)})}):a(t,i)}))},$t.prototype.initialize=function(){var t=this.get("key");t&&/App$/.test(t)&&this.set("key",t.replace(/App$/,""),{silent:!0}),this.silentCast("options",Rt),this.silentCast("components",qt),this.listenTo(this.get("components"),"materialChange",function(){this.trigger("materialChange")}),Pt(this.attributes.key,this.attributes),this.silentCast("widgets",Nt.WidgetCollection),this.listenTo(this.get("widgets"),"materialChange",function(){this.trigger("materialChange")}),this.listenTo(this.get("options"),"materialChange",this.onOptionsMaterialChange)},$t.prototype.clone=function(t){var e=new $t({definitionId:this.get("definitionId"),key:this.get("key"),containerId:this.get("containerId"),components:this.get("components").clone(),widgets:this.get("widgets").clone()},{},this.parent);return t=t||{previousWidgetId:this.id,widgetId:e.id},e.set("options",this.get("options").clone(t),{silent:!0}),e},$t.prototype.defaults=function(){return{id:Nt.Helpers.getGUID(),key:null,options:new Rt({},{},this),containerId:null,components:new qt([],{},this),widgets:new Nt.WidgetCollection([],{},this)}},$t.prototype.doCommand=function(t,e){if(0<t.length){var n=t.pop();if(-1!=["options","components","widgets"].indexOf(n))return this.get(n).doCommand(t,e);throw"Unsupported command key"}},$t.prototype.getComponents=function(){return[this].concat(this.get("widgets").getComponents()).concat(this.get("components").getComponents())},$t.prototype.getInnermostComponents=function(t){var e,n,i=this.get("components");return 0!==i.length&&(n="Tabs"===t?this.get("options").get("Selection").target_tab:0,e=this.get("options").get("Items")[n].Id,n=i.find(function(t){return"Tabs"===t.get("key")&&t.get("containerId")===e}))?n.getInnermostComponents(t):i},$t.prototype.postCommand=function(t,e){return t instanceof qt?e.path.push("components"):t instanceof Nt.WidgetCollection?e.path.push("widgets"):t instanceof Object&&e.path.push("options"),e.path.push(this.id),this.parent&&this.parent.postCommand(this,e)},$t.prototype.onOptionsMaterialChange=function(){this.get("upgrading")||this.trigger("materialChange")},$t.prototype.silentCast=function(t,e,n){this.get(t)instanceof e||this.set(t,new e(this.get(t),n,this),{silent:!0})},$t.prototype.parseCastAndListen=function(t,e,n,i,o){var s=this;!t||!t[e]||t[e]instanceof n||(t[e]=new n(t[e],o,this),this.listenTo(t[e],i,function(t){s.trigger("change",s)}))},$t.prototype.parse=function(t){return this.parseCastAndListen(t,"components",qt,"change add remove"),this.parseCastAndListen(t,"options",Rt,"change"),Pt(this.attributes.key,t),this.parseCastAndListen(t,"widgets",Nt.WidgetCollection,"change add remove"),t},$t.prototype.setParent=function(t){this.parent=t,this.get("components")&&this.get("components").setParent(this),this.get("options")&&this.get("options").setParent(this),this.get("widgets")&&this.get("widgets").setParent(this)};var Ot,Bt=$t;function $t(){return null!==Ot&&Ot.apply(this,arguments)||this}Nt.Component=Bt,Ut=Nt.ComandoCollection,e(Ft,Ut),Ft.prototype.clone=function(){return new Ft(_.map(this.models,function(t){return t.clone()}),{model:this.model,comparator:this.comparator},this.parent)},Ft.prototype.getCommandDescriptor=function(t){var e,n=Ut.prototype.getCommandDescriptor.call(this,t);return _.isArray(t)&&1===t.length?e=t[0]:t instanceof Bt&&(e=t),(n=e instanceof f.Model?e.get("key"):n)||this.descriptor},Ft.prototype.setParent=function(t){var e=this;this.parent=t,this.map(function(t){return t.setParent(e)})};var Ut,qt=Ft;function Ft(){var t=null!==Ut&&Ut.apply(this,arguments)||this;return t.descriptor="Component",t}function Yt(t,e,n){t=xt.call(this,t,e,n)||this;return t.IMMATERIAL_ATTRIBUTES=["isGridstack"],t.parent=n,t.listenTo(t,"change",t.determineMaterialChange.bind(t)),t}(Nt.ComponentCollection=qt).prototype.model=Bt,kt=A=A||{},xt=kt.CommandoModel,e(Yt,xt),Yt.prototype.commandSet=function(t){this.postCommand(this,new kt.Command("Set Layout",[],[new kt.Todo(kt.CommandOp.Set,"",t)],[new kt.Todo(kt.CommandOp.Set,"",_.clone(this.toJSON()))]))},Yt.prototype.defaults=function(){return{row:null,column:null,rowSpan:12,colSpan:6}},Yt.prototype.determineMaterialChange=function(){this.changed&&!_.isEmpty(_.omit(this.changed,this.IMMATERIAL_ATTRIBUTES))&&this.trigger("materialChange")},Yt.prototype.doCommand=function(t,e){var n=this;e.forEach(function(t){n.set(t.payload)})},Yt.prototype.postCommand=function(t,e){return this.parent.postCommand(this,e)},kt.Layout=Yt;var Ht,Kt,Qt,zt,Wt,Gt,jt,Xt,Zt,Jt,te,ee,ne,ie,oe,se,ae,re,le,ue,ce,pe,de,he,ge,me,fe,ye,ve,be,Se,we,_e,Te,Ce,De,Ee,Me,Pe,Ie,Ae,ke=A=A||{};xe=ke.CommandoModel,e(Le,xe),Le.prototype.clone=function(t){var e=new Le({},{},this.parent),t=(t&&e.set("id",t),_.omit(this.attributes,"id"));return t.component=this.get("component").clone({previousWidgetId:this.id,widgetId:e.id}),t.layout=this.get("layout").clone(),e.set(t),e},Le.prototype.defaults=function(){return{id:ke.Helpers.getGUID(),layout:new ke.Layout({},{},this),component:null}},Le.prototype.commandSet=function(t){var e=this.clone(this.id).toJSON();this.postCommand(this,new ke.Command("Set Widget",[],[new ke.Todo(ke.CommandOp.Set,"",t)],[new ke.Todo(ke.CommandOp.Set,"",e)]))},Le.prototype.doCommand=function(t,e){var n=this;if(0<t.length){var i=t.pop();if(-1!==["layout","component"].indexOf(i))return this.get(i).doCommand(t,e);throw"Unsupported command key"}e.forEach(function(t){t.payload.component&&(t.payload.component instanceof f.Model?n.set("component",t.payload.component):n.set("component",new ke.Component(t.payload.component,{},n)))})},Le.prototype.getComponents=function(){return this.get("component").getComponents()},Le.prototype.postCommand=function(t,e){return t instanceof ke.Layout?e.path.push("layout"):t instanceof ke.Component&&(e.path.pop(),e.path.push("component")),e.path.push(this.id),this.parent.postCommand(this,e)},Le.prototype.onComponentChanged=function(t,e,n){e&&this.listenTo(e,"change",function(t,e){this.trigger("change",t,e)})},Le.prototype.onMaterialChange=function(){this.trigger("materialChange")},Le.prototype.setParent=function(t){this.parent=t,this.get("component")&&this.get("component").setParent(this),this.get("layout")&&this.get("layout").setParent(this)};var xe,Ne=Le;function Le(t,e,n){t=xe.call(this,t,e,n)||this;return t.IMMATERIAL_ATTRIBUTES=[],!t.get("layout")||t.get("layout")instanceof ke.Layout||t.set({layout:new ke.Layout(t.get("layout"),{},t)},{silent:!0}),!t.get("component")||t.get("component")instanceof ke.Component||t.set({component:new ke.Component(t.get("component"),{},t)},{silent:!0}),t.get("component")&&t.listenTo(t.get("component"),"materialChange",t.onMaterialChange.bind(t)),t.get("layout")&&t.listenTo(t.get("layout"),"materialChange",t.onMaterialChange.bind(t)),t.listenTo(t,"change:component",t.onComponentChanged.bind(t)),t.onComponentChanged(t,t.get("component")),t}ke.Widget=Ne,Re=ke.ComandoCollection,e(Ve,Re),Ve.prototype.clone=function(){return new Ve(_.map(this.models,function(t){return t.clone()}),{model:Ne,comparator:this.comparator},this.parent)},Ve.prototype.commandSet=function(t){var i=this,e=t.map(function(t,e){var n=i.get(t.id)||i.at(e);if(n)return e=n.changedAttributes(t),t=_.mapValues(e,function(t,e){e=n.get(e);return e instanceof f.Model?e.toJSON():e}),n.id&&(t.id=n.id),t}),t=new ke.Command(this.getCommandDescription(ke.CommandOp.Set,t),[],[new ke.Todo(ke.CommandOp.Set,"",t)],[new ke.Todo(ke.CommandOp.Set,"",e)]);this.postCommand(this,t)},Ve.prototype.doCommandSet=function(t){var n=this;t.forEach(function(t){var e=n.get(t.id);e&&(t.component&&e.get("component").set(t.component),t.layout)&&e.get("layout").set(t.layout)})},Ve.prototype.getCommandDescriptor=function(t){var e,n=Re.prototype.getCommandDescriptor.call(this,t);return _.isArray(t)&&1===t.length?e=t[0]:t instanceof Ne&&(e=t),(n=e instanceof f.Model&&e.get("component")?e.get("component").get("key"):n)||this.descriptor},Ve.prototype.setParent=function(t){var e=this;this.parent=t,this.map(function(t){return t.setParent(e)})};var Re,i=Ve;function Ve(){var t=null!==Re&&Re.apply(this,arguments)||this;return t.commandQueue=[],t.descriptor="Widget",t.model=Ne,t}(ke.WidgetCollection=i).prototype.model=Ne;var Oe=A=A||{},n=(Be.prototype.toDate=function(){return Oe.Tools.convertKDBTemporalToMoment(this)},Be.prototype.toString=function(){return this.toDate().formatNano("YYYY-MM-DD HH:mm:ss.SSSSSSSSS")},Be);function Be(t,e){this.i=t,this.n=e}Oe.rTimestampClass=n,$e.prototype.toDate=function(){return Oe.Tools.convertKDBTemporalToMoment(this)},$e.prototype.toString=function(){return"number"!=typeof this.i||isNaN(this.i)?"":this.i===Number.POSITIVE_INFINITY?"Infinity":this.i===Number.NEGATIVE_INFINITY?"-Infinity":this.toDate().format("YYYY-MM")};i=$e;function $e(t){this.i=t}Oe.rMonthClass=i,Ue.prototype.toDate=function(){return Oe.Tools.convertKDBTemporalToMoment(this)},Ue.prototype.toString=function(){return"number"!=typeof this.i||isNaN(this.i)?"":this.i===Number.POSITIVE_INFINITY?"Infinity":this.i===Number.NEGATIVE_INFINITY?"-Infinity":h(new Date(this.i)).utcOffset(0).format("YYYY-MM-DD")};var u=Ue;function Ue(t,e){this.i=t,this.n=e}Oe.rDateClass=u,Fe.prototype.toDate=function(){return Oe.Tools.convertKDBTemporalToMoment(this)},Fe.prototype.toString=function(){return this.toDate().format("YYYY-MM-DD HH:mm:ss.SSS")};var qe=Fe;function Fe(t){this.i=t}Oe.rDateTimeClass=qe,He.prototype.toDate=function(){return Oe.Tools.convertKDBTemporalToMoment(this)},He.prototype.toString=function(){return this.toDate().formatNano("HH:mm:ss.SSSSSSSSS",{trim:!1})};var Ye=He;function He(t){this.i=t}Oe.rTimespanClass=Ye,Qe.prototype.toDate=function(){return Oe.Tools.convertKDBTemporalToMoment(this)},Qe.prototype.toString=function(){return this.toDate().format("HH:mm",{trim:!1})};var Ke=Qe;function Qe(t){this.i=t,this.n=0}Oe.rMinuteClass=Ke,We.prototype.toDate=function(){return Oe.Tools.convertKDBTemporalToMoment(this)},We.prototype.toString=function(){return this.toDate().format("HH:mm:ss",{trim:!1})};var ze=We;function We(t){this.i=t}Oe.rSecondClass=ze,Ge.prototype.toDate=function(){return Oe.Tools.convertKDBTemporalToMoment(this)},Ge.prototype.toString=function(){return this.toDate().format("HH:mm:ss.SSS",{trim:!1})};var c=Ge;function Ge(t){this.i=t}Oe.rTimeClass=c,n.prototype.class="1212",i.prototype.class="1213",u.prototype.class="1214",qe.prototype.class="1215",Ye.prototype.class="1216",Ke.prototype.class="1217",ze.prototype.class="1218",c.prototype.class="1219";n=A=A||{},d.isLong=function(t){return!0===(t&&t.__isLong__)},d.fromInt=function(t,e){var n,i,o;return e?(o=0<=(t>>>=0)&&t<256)&&(i=d.UINT_CACHE[t])?i:(n=d.fromBits(t,(0|t)<0?-1:0,!0),o&&(d.UINT_CACHE[t]=n),n):(o=-128<=(t|=0)&&t<128)&&(i=d.INT_CACHE[t])?i:(n=d.fromBits(t,t<0?-1:0,!1),o&&(d.INT_CACHE[t]=n),n)},d.fromNumber=function(t,e){if(isNaN(t))return e?d.UZERO:d.ZERO;if(e){if(t<0)return d.UZERO;if(d.TWO_PWR_64_DBL<=t)return d.MAX_UNSIGNED_VALUE}else{if(t<=-d.TWO_PWR_63_DBL)return d.MIN_VALUE;if(d.TWO_PWR_63_DBL<=t+1)return d.MAX_VALUE}return t<0?d.fromNumber(-t,e).neg():d.fromBits(t%d.TWO_PWR_32_DBL|0,t/d.TWO_PWR_32_DBL|0,e)},d.fromBits=function(t,e,n){return new d(t,e,n)},d.fromString=function(t,e,n){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return d.ZERO;if(e="number"==typeof e?(n=e,!1):!!e,(n=n||10)<2||36<n)throw RangeError("radix");var i;if(0<(i=t.indexOf("-")))throw Error("interior hyphen");if(0===i)return d.fromString(t.substring(1),e,n).neg();for(var o=d.fromNumber(Math.pow(n,8)),s=d.ZERO,a=0;a<t.length;a+=8){var r=Math.min(8,t.length-a),l=parseInt(t.substring(a,a+r),n);s=(r<8?(r=d.fromNumber(Math.pow(n,r)),s.mul(r)):s=s.mul(o)).add(d.fromNumber(l))}return s.unsigned=e,s},d.fromValue=function(t,e){return"number"==typeof t?d.fromNumber(t,e):"string"==typeof t?d.fromString(t,e):d.fromBits(t.low,t.high,"boolean"==typeof e?e:t.unsigned)},d.prototype.toInt=function(){return this.unsigned?this.low>>>0:this.low},d.prototype.toNumber=function(){return this.unsigned?(this.high>>>0)*d.TWO_PWR_32_DBL+(this.low>>>0):this.high*d.TWO_PWR_32_DBL+(this.low>>>0)},d.prototype.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";var e,n;if(this.isNegative())return this.eq(d.MIN_VALUE)?(n=d.fromNumber(t),n=(e=this.div(n)).mul(n).sub(this),e.toString(t)+n.toInt().toString(t)):"-"+this.neg().toString(t);for(var i=d.fromNumber(Math.pow(t,6),this.unsigned),o=this,s="";;){var a=o.div(i),r=(o.sub(a.mul(i)).toInt()>>>0).toString(t);if((o=a).isZero())return r+s;for(;r.length<6;)r="0"+r;s=""+r+s}},d.prototype.getHighBits=function(){return this.high},d.prototype.getHighBitsUnsigned=function(){return this.high>>>0},d.prototype.getLowBits=function(){return this.low},d.prototype.getLowBitsUnsigned=function(){return this.low>>>0},d.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.eq(d.MIN_VALUE)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;0<e&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},d.prototype.isZero=function(){return 0===this.high&&0===this.low},d.prototype.isNegative=function(){return!this.unsigned&&this.high<0},d.prototype.isPositive=function(){return this.unsigned||0<=this.high},d.prototype.isOdd=function(){return 1==(1&this.low)},d.prototype.isEven=function(){return 0==(1&this.low)},d.prototype.equals=function(t){return d.isLong(t)||(t=d.fromValue(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&this.high===t.high&&this.low===t.low},d.prototype.notEquals=function(t){return!this.eq(t)},d.prototype.lessThan=function(t){return this.comp(t)<0},d.prototype.lessThanOrEqual=function(t){return this.comp(t)<=0},d.prototype.greaterThan=function(t){return 0<this.comp(t)},d.prototype.greaterThanOrEqual=function(t){return 0<=this.comp(t)},d.prototype.compare=function(t){var e,n;return d.isLong(t)||(t=d.fromValue(t)),this.eq(t)?0:(e=this.isNegative(),n=t.isNegative(),e&&!n?-1:!e&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1)},d.prototype.negate=function(){return!this.unsigned&&this.eq(d.MIN_VALUE)?d.MIN_VALUE:this.not().add(d.ONE)},d.prototype.add=function(t){d.isLong(t)||(t=d.fromValue(t));var e=this.high>>>16,n=65535&this.high,i=this.low>>>16,o=65535&this.low,s=t.high>>>16,a=65535&t.high,r=t.low>>>16,l=0,u=0,c=0,p=0;return u+=(c=c+((p+=o+(65535&t.low))>>>16)+(i+r))>>>16,d.fromBits((c&=65535)<<16|(p&=65535),((l+=(u+=n+a)>>>16)+(e+s)&65535)<<16|(u&=65535),this.unsigned)},d.prototype.subtract=function(t){return d.isLong(t)||(t=d.fromValue(t)),this.add(t.neg())},d.prototype.multiply=function(t){var e,n,i,o,s,a,r,l,u,c,p;return this.isZero()?d.ZERO:(d.isLong(t)||(t=d.fromValue(t)),d.wasm?(e=d.wasm.mul(this.low,this.high,t.low,t.high),d.fromBits(e,d.wasm.get_high(),this.unsigned)):t.isZero()?d.ZERO:this.eq(d.MIN_VALUE)?t.isOdd()?d.MIN_VALUE:d.ZERO:t.eq(d.MIN_VALUE)?this.isOdd()?d.MIN_VALUE:d.ZERO:this.isNegative()?t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg():t.isNegative()?this.mul(t.neg()).neg():this.lt(d.TWO_PWR_24)&&t.lt(d.TWO_PWR_24)?d.fromNumber(this.toNumber()*t.toNumber(),this.unsigned):(e=this.high>>>16,n=65535&this.high,i=this.low>>>16,o=65535&this.low,s=t.high>>>16,a=65535&t.high,r=t.low>>>16,p=(p=c=u=l=0)+((u=u+((c+=o*(t=65535&t.low))>>>16)+i*t)>>>16)+((u=(u&65535)+o*r)>>>16),d.fromBits((u&=65535)<<16|(c&=65535),(l=(l=(l+=(p+=n*t)>>>16)+((p=(p&65535)+i*r)>>>16)+((p=(p&65535)+o*a)>>>16))+(e*t+n*r+i*a+o*s)&65535)<<16|(p&=65535),this.unsigned)))},d.prototype.divide=function(t){if((t=d.isLong(t)?t:d.fromValue(t)).isZero())throw Error("division by zero");var e,n,i,o;if(d.wasm)return this.unsigned||-2147483648!==this.high||-1!==t.low||-1!==t.high?(e=(this.unsigned?d.wasm.div_u:d.wasm.div_s)(this.low,this.high,t.low,t.high),d.fromBits(e,d.wasm.get_high(),this.unsigned)):this;if(this.isZero())return this.unsigned?d.UZERO:d.ZERO;if(this.unsigned){if((t=t.unsigned?t:t.toUnsigned()).gt(this))return d.UZERO;if(t.gt(this.shru(1)))return d.UONE;i=d.UZERO}else{if(this.eq(d.MIN_VALUE))return t.eq(d.ONE)||t.eq(d.NEG_ONE)?d.MIN_VALUE:t.eq(d.MIN_VALUE)?d.ONE:(o=this.shr(1).div(t).shl(1)).eq(d.ZERO)?t.isNegative()?d.ONE:d.NEG_ONE:(n=this.sub(t.mul(o)),o.add(n.div(t)));if(t.eq(d.MIN_VALUE))return this.unsigned?d.UZERO:d.ZERO;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();i=d.ZERO}for(n=this;n.gte(t);){o=Math.max(1,Math.floor(n.toNumber()/t.toNumber()));for(var s=Math.ceil(Math.log(o)/Math.LN2),a=s<=48?1:Math.pow(2,s-48),r=d.fromNumber(o),l=r.mul(t);l.isNegative()||l.gt(n);)l=(r=d.fromNumber(o-=a,this.unsigned)).mul(t);r.isZero()&&(r=d.ONE),i=i.add(r),n=n.sub(l)}return i},d.prototype.modulo=function(t){var e;return d.isLong(t)||(t=d.fromValue(t)),d.wasm?(e=(this.unsigned?d.wasm.rem_u:d.wasm.rem_s)(this.low,this.high,t.low,t.high),d.fromBits(e,d.wasm.get_high(),this.unsigned)):this.sub(this.div(t).mul(t))},d.prototype.not=function(){return d.fromBits(~this.low,~this.high,this.unsigned)},d.prototype.and=function(t){return d.isLong(t)||(t=d.fromValue(t)),d.fromBits(this.low&t.low,this.high&t.high,this.unsigned)},d.prototype.or=function(t){return d.isLong(t)||(t=d.fromValue(t)),d.fromBits(this.low|t.low,this.high|t.high,this.unsigned)},d.prototype.xor=function(t){return d.isLong(t)||(t=d.fromValue(t)),d.fromBits(this.low^t.low,this.high^t.high,this.unsigned)},d.prototype.shiftLeft=function(t){return d.isLong(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?d.fromBits(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):d.fromBits(0,this.low<<t-32,this.unsigned)},d.prototype.shiftRight=function(t){return d.isLong(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?d.fromBits(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):d.fromBits(this.high>>t-32,0<=this.high?0:-1,this.unsigned)},d.prototype.shiftRightUnsigned=function(t){return d.isLong(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?d.fromBits(this.low>>>t|this.high<<32-t,this.high>>>t,this.unsigned):d.fromBits(32===t?this.high:this.high>>>t-32,0,this.unsigned)},d.prototype.rotateLeft=function(t){var e;return d.isLong(t)&&(t=t.toInt()),0==(t&=63)?this:32===t?d.fromBits(this.high,this.low,this.unsigned):t<32?d.fromBits(this.low<<t|this.high>>>(e=32-t),this.high<<t|this.low>>>e,this.unsigned):d.fromBits(this.high<<(t-=32)|this.low>>>(e=32-t),this.low<<t|this.high>>>e,this.unsigned)},d.prototype.rotateRight=function(t){var e;return d.isLong(t)&&(t=t.toInt()),0==(t&=63)?this:32===t?d.fromBits(this.high,this.low,this.unsigned):t<32?d.fromBits(this.high<<(e=32-t)|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned):d.fromBits(this.low<<(e=32-(t-=32))|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)},d.prototype.toSigned=function(){return this.unsigned?d.fromBits(this.low,this.high,!1):this},d.prototype.toUnsigned=function(){return this.unsigned?this:d.fromBits(this.low,this.high,!0)},d.prototype.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},d.prototype.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},d.prototype.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,e>>>24,e>>>16&255,e>>>8&255,255&e]},d.fromBytes=function(t,e,n){return n?d.fromBytesLE(t,e):d.fromBytesBE(t,e)},d.fromBytesLE=function(t,e){return new d(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)},d.fromBytesBE=function(t,e){return new d(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)},d.wasm=null,d.INT_CACHE={},d.UINT_CACHE={},d.TWO_PWR_16_DBL=65536,d.TWO_PWR_24_DBL=1<<24,d.TWO_PWR_63_DBL=(d.TWO_PWR_64_DBL=(d.TWO_PWR_32_DBL=d.TWO_PWR_16_DBL*d.TWO_PWR_16_DBL)*d.TWO_PWR_32_DBL)/2,d.TWO_PWR_24=d.fromInt(d.TWO_PWR_24_DBL),d.ZERO=d.fromInt(0),d.UZERO=d.fromInt(0,!0),d.ONE=d.fromInt(1),d.UONE=d.fromInt(1,!0),d.NEG_ONE=d.fromInt(-1),d.MAX_VALUE=d.fromBits(-1,2147483647,!1),d.MAX_UNSIGNED_VALUE=d.fromBits(-1,-1,!0),d.MIN_VALUE=d.fromBits(0,-2147483648,!1),i=d;function d(t,e,n){this.eqz=this.isZero.bind(this),this.eq=this.equals.bind(this),this.neq=this.notEquals.bind(this),this.ne=this.notEquals.bind(this),this.lt=this.lessThan.bind(this),this.lte=this.lessThanOrEqual.bind(this),this.le=this.lessThanOrEqual.bind(this),this.gt=this.greaterThan.bind(this),this.gte=this.greaterThanOrEqual.bind(this),this.ge=this.greaterThanOrEqual.bind(this),this.comp=this.compare.bind(this),this.neg=this.negate.bind(this),this.sub=this.subtract.bind(this),this.mul=this.multiply.bind(this),this.div=this.divide.bind(this),this.mod=this.modulo.bind(this),this.rem=this.modulo.bind(this),this.shl=this.shiftLeft.bind(this),this.shr=this.shiftRight.bind(this),this.shru=this.shiftRightUnsigned.bind(this),this.shr_u=this.shiftRightUnsigned.bind(this),this.rotl=this.rotateLeft.bind(this),this.rotr=this.rotateRight.bind(this),this.low=0|t,this.high=0|e,this.unsigned=!!n}n.Long=i,Object.defineProperty(i.prototype,"__isLong__",{value:!0});try{i.wasm=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(t){}function je(t,e,n,i){this.length=t,this.offset=e,this.qtype=n,this.dataView=i}function Xe(t,e,n,i,o){e=zt.call(this,t,e,n,i)||this;return e.indexOffset=0,e.index=null,e.rangeCache=null,e.SIZE=o,e.bufferLength=t,e}function Ze(t,e,n,i){return Wt.call(this,t,e,n,i,1)||this}function Je(t,e,n){return jt.call(this,t,e,Gt.TypeNum.Byte,n)||this}function tn(t,e,n,i){return Xt.call(this,t,e,n,i,4)||this}function en(){}function nn(t,e,n){return te.call(this,t,e,Jt.TypeNum.Date,n)||this}function on(t,e,n){return ne.call(this,t,e,ee.TypeNum.Float,n,4)||this}function sn(t,e,n){return oe.call(this,t,e,ie.TypeNum.Int,n)||this}function an(t,e,n){return re.call(this,t,e,ae.TypeNum.Minute,n)||this}function rn(t,e,n,i){return le.call(this,t,e,n,i,8)||this}function ln(t,e,n){return ce.call(this,t,e,ue.TypeNum.Double,n)||this}function un(t,e,n){return de.call(this,t,e,pe.TypeNum.Short,n,2)||this}function cn(t,e,n){return me.call(this,t,e,ge.TypeNum.Time,n)||this}function pn(t,e,n,i){return ye.call(this,t,e,n,i,8)||this}function dn(t,e,n){return Se.call(this,t,e,be.TypeNum.Timestamp,n)||this}function hn(t,e,n){return _e.call(this,t,e,we.TypeNum.Bool,n)||this}function gn(t,e,n){return De.call(this,t,e,Ce.TypeNum.Char,n)||this}function mn(t,e,n){return Pe.call(this,t,e,Me.TypeNum.DateTime,n)||this}function fn(t,e,n){return Ae.call(this,t,e,Ie.TypeNum.Guid,n,16)||this}Ht=A=A||{},(Kt=Ht.ipc||(Ht.ipc={})).fromString=function(t,e){return _.isString(e)&&t.fromString?t.fromString(e):e},(u=Kt.TypeNum||(Kt.TypeNum={}))[u.List=0]="List",u[u.Bool=1]="Bool",u[u.Guid=2]="Guid",u[u.Byte=4]="Byte",u[u.Short=5]="Short",u[u.Int=6]="Int",u[u.Long=7]="Long",u[u.Float=8]="Float",u[u.Double=9]="Double",u[u.Char=10]="Char",u[u.Symbol=11]="Symbol",u[u.Timestamp=12]="Timestamp",u[u.Month=13]="Month",u[u.Date=14]="Date",u[u.DateTime=15]="DateTime",u[u.Timespan=16]="Timespan",u[u.Minute=17]="Minute",u[u.Second=18]="Second",u[u.Time=19]="Time",u[u.Table=98]="Table",u[u.Dict=99]="Dict",u[u.Unary=101]="Unary",je.prototype.isAligned=function(){return!0},je.prototype.isTemporal=function(){return this.qtype<=12&&this.qtype<=19},je.prototype.toLegacy=function(t){return this.getValue(t)},je.prototype.toViewState=function(t){return{_type:Kt.Parse.TYPE_NAMES[Math.abs(this.qtype)],value:Ht.Tools.convertKDBToViewstateValue(this.toLegacy(t))}},u=je,Kt.TypeBase=u,Qt=A=A||{},qe=Qt.ipc||(Qt.ipc={}),zt=qe.TypeBase,e(Xe,zt),Xe.prototype.getRange=function(){return this.rangeCache||(this.rangeCache=this.calcRange())},Xe.prototype.mergeIndexed=function(t){if(t.length>=this.length)throw"Invalid Merge Size";this.resetRangeCache(),new Uint8Array(this.dataView.buffer,this.offset,t.length*this.SIZE).set(new Uint8Array(t.dataView.buffer,t.offset,t.length*this.SIZE))},Xe.prototype.checkIndex=function(){for(var t=1;t<this.index.length;t++)if(this.hash(this.index[t-1])>this.hash(this.index[t]))return!0;return!1},Xe.prototype.hasIndex=function(){return!!this.index},Xe.prototype.getIndexFromSortedIndex=function(t){return(this.length+this.index[t]-this.indexOffset)%this.length},Xe.prototype.getScalarFromSortedIndex=function(t){return t=(this.indexOffset+t)%this.length,8===this.SIZE&&Qt.Tools.isIE11&&-1!==[9,15].indexOf(this.qtype)?this.getLegacyScalar(this.index[t]):this.getScalar(this.index[t])},Xe.prototype.findIndex=function(t){var n=this,e=8!==this.SIZE||-1!==[9,15].indexOf(this.qtype)?function(t,e){return t-n.hash(e)}:Qt.Tools.isIE11?function(t,e){return t.compare(n.hash(e))}:function(t,e){return Number(t-n.hash(e))};return Qt.Tools.binarySearch2(t,this.index,e)},Xe.prototype.mergeKeyedPrimary=function(t,e,n){this.resetRangeCache(),this.hasIndex()||this.generateIndex();for(var i=0;i<t.length;i++){var o,s,a=this.findIndex(t.hash(i));a<0?(o=void 0,this.length===e?(o=this.indexOffset%e,s=this.findIndex(this.hash(o)),this.index.splice(s,1),s<-a-1&&a++,this.index.splice(-a-1,0,o),this.indexOffset=(this.indexOffset+1)%e):((o=this.length)>=this.bufferLength&&this.reallocate(e),this.index.splice(-a-1,0,o),this.length++),new Uint8Array(this.dataView.buffer,this.offset+o*this.SIZE,this.SIZE).set(new Uint8Array(t.dataView.buffer,t.offset+i*this.SIZE,this.SIZE)),n.push(o)):(s=this.index[a],n.push(s))}return this.indexOffset},Xe.prototype.mergeKeyed=function(t,e,n,i){this.resetRangeCache();for(var o=0;o<e.length;o++){var s=e[o];s===this.length&&(s>=this.bufferLength&&this.reallocate(i),this.length++),new Uint8Array(this.dataView.buffer,this.offset+s*this.SIZE,this.SIZE).set(new Uint8Array(t.dataView.buffer,t.offset+o*this.SIZE,this.SIZE))}this.indexOffset=n},Xe.prototype.reallocate=function(t){this.bufferLength=t||this.bufferLength;t=new ArrayBuffer(this.bufferLength*this.SIZE);new Uint8Array(t,0,this.length*this.SIZE).set(new Uint8Array(this.dataView.buffer,this.offset,this.length*this.SIZE)),this.dataView=new DataView(t),this.offset=0},Xe.prototype.sliceDataView=function(t){var e=this.getByteLocation(t),t=(this.bufferLength=this.length=this.length-t,this.dataView.buffer.slice(e,e+this.SIZE*this.length));this.dataView=new DataView(t),this.offset=0,this.values=void 0,this.indexOffset=0,this.index=null,this.rangeCache=null},Xe.prototype.toTypedArray=function(){var t,e;return this.align(),1===this.SIZE?t=Uint8Array:2===this.SIZE?t=Int16Array:4===this.SIZE?t=8===this.qtype?Float32Array:Int32Array:8===this.SIZE&&(t=-1!==[9,15].indexOf(this.qtype)?Float64Array:BigInt64Array),0===this.indexOffset?new t(this.dataView.buffer,this.offset,this.length):((e=new t(this.length)).set(new t(this.dataView.buffer,this.indexOffset*this.SIZE,this.length-this.indexOffset)),e.set(new t(this.dataView.buffer,0,this.indexOffset),this.length-this.indexOffset),e)},Xe.prototype.align=function(){this.offset%this.SIZE!=0&&this.reallocate()},Xe.prototype.getByteLocation=function(t){return this.offset+(t+this.indexOffset)%this.length*this.SIZE},Xe.prototype.getHashLocation=function(t){return this.offset+t*this.SIZE},Xe.prototype.generateIndex=function(){var n=this;this.index=new Array(this.length);for(var t=0;t<this.length;t++)this.index[t]=t;8!==this.SIZE||-1!==[9,15].indexOf(this.qtype)?this.index.sort(function(t,e){return n.hash(t)-n.hash(e)}):Qt.Tools.isIE11?this.index.sort(function(t,e){return n.hash(t).compare(n.hash(e))}):this.index.sort(function(t,e){return Number(n.hash(t)-n.hash(e))})},Xe.prototype.resetRangeCache=function(){this.rangeCache=null},qe.Vector=Xe,Ye=(Ye=A=A||{}).ipc||(Ye.ipc={}),Wt=Ye.Vector,e(Ze,Wt),Ze.prototype.calcRange=function(){for(var t=Ze.MIN,e=Ze.MAX,n=0;n<this.length;n+=1){var i=this.getScalar(n);t<i&&(t=i),i<e&&(e=i)}return[e,t]},Ze.prototype.getScalar=function(t){return this.dataView.getUint8(this.getByteLocation(t))},Ze.prototype.hash=function(t){return this.dataView.getUint8(this.getHashLocation(t))},Ze.MIN=0,Ze.MAX=255,Ye.U8=Ze,Ke=A=A||{},Gt=Ke.ipc||(Ke.ipc={}),jt=Gt.U8,e(Je,jt),Je.listToIPC=function(t){var e=t.length+6,n=Gt.Util.createBuffer(e);return n.wb(Je.TYPE_NUM),n.wb(0),n.wi(t.length),_.each(t,function(t){return n.wb(t)}),n.data},Je.toIPC=function(t){var e=Gt.Util.createBuffer(2);return e.wb(256-Je.TYPE_NUM),e.wb(t||0),e.data},Je.prototype.getValue=function(t){return this.getScalar(t)},Je.TYPE_NUM=4,Gt.Byte=Je,ze=(ze=A=A||{}).ipc||(ze.ipc={}),Xt=ze.Vector,e(tn,Xt),tn.prototype.calcRange=function(){for(var t=Number.NEGATIVE_INFINITY,e=Number.POSITIVE_INFINITY,n=0;n<this.length;n+=1){var i=this.getScalar(n);(t===tn.NULL||t<i&&i!==tn.NULL)&&(t=i),(e===tn.NULL||i<e&&i!==tn.NULL)&&(e=i)}return[e,t]},tn.prototype.getScalar=function(t){return this.dataView.getInt32(this.getByteLocation(t),!0)},tn.prototype.hash=function(t){return this.dataView.getInt32(this.getHashLocation(t))},tn.NULL=-2147483648,tn.INFINITY_NEGATIVE=-2147483647,tn.INFINITY_POSITIVE=2147483647,ze.I32=tn,c=A=A||{},n=c.ipc||(c.ipc={}),en.QEPOCH=10957*(en.MSDAY=864e5),en.LONG_NULL=new c.Long(0,2147483648),en.LONG_INFINITY_NEGATIVE=new c.Long(1,2147483648),en.LONG_INFINITY_POSITIVE=c.Long.MAX_VALUE,en.JS_DATE_MIN=-864e13,en.TIME_PARTS_RX=/(-?\d{1,7}:\d\d:\d\d.\d\d\d)(\d\d\d\d\d\d)/,en.BQEPOCH=new ut.BigInteger((1e6*en.QEPOCH).toString()),n.Constants=en,Zt=A=A||{},Jt=Zt.ipc||(Zt.ipc={}),te=Jt.I32,e(nn,te),nn.fromMoment=function(t){return null===t?null:new Zt.rDateClass(t.valueOf())},nn.fromScalar=function(t){return null===t?null:new Zt.rDateClass(Jt.Constants.QEPOCH+t*Jt.Constants.MSDAY)},nn.fromString=function(t){if(!t)return null;t=t.replace(/\./g,"-");t=h.utc(t);return nn.fromMoment(t)},nn.listToIPC=function(t){var e=4*t.length+6,n=Jt.Util.createBuffer(e);return n.wb(Jt.TypeNum.Date),n.wb(0),n.wi(t.length),_.each(t,function(t){return nn.writeValue(t,n.wb)}),n.data},nn.toIPC=function(t){var e=Jt.Util.createBuffer(5);return e.wb(256-Jt.TypeNum.Date),nn.writeValue(t,e.wb),e.data},nn.writeValue=function(t,e){Jt.Int.writeValue(null===t?null:nn.toScalar(t),e)},nn.toMoment=function(t){return null===t?null:h.tz(t.toString(),"UTC")},nn.toScalar=function(t){return null===t?null:(t.i-Jt.Constants.QEPOCH)/Jt.Constants.MSDAY},nn.toString=function(t,e){return void 0===e&&(e="YYYY-MM-DD"),null===t?null:nn.toMoment(t).format(e)},nn.prototype.getValue=function(t){t=te.prototype.getScalar.call(this,t);return t===Jt.I32.NULL?null:t===Jt.I32.INFINITY_NEGATIVE?-1/0:t===Jt.I32.INFINITY_POSITIVE?1/0:new Zt.rDateClass(Jt.Constants.QEPOCH+t*Jt.Constants.MSDAY)},Jt.QDate=nn,i=A=A||{},ee=i.ipc||(i.ipc={}),ne=ee.Vector,e(on,ne),on.listToIPC=function(t){var e=4*t.length+6,n=ee.Util.createBuffer(e);return n.wb(on.TYPE_NUM),n.wb(0),n.wi(t.length),_.each(t,function(t){return on.writeValue(t,n.wb)}),n.data},on.toIPC=function(t){var e=ee.Util.createBuffer(5);return e.wb(256-on.TYPE_NUM),on.writeValue(t,e.wb),e.data},on.writeValue=function(t,e){var n;null!==t?((n=new Float32Array(1))[0]=t,_.each(new Uint8Array(n.buffer),function(t){return e(t)})):_.each([0,0,192,255],function(t){return e(t)})},on.prototype.calcRange=function(){for(var t=Number.NEGATIVE_INFINITY,e=Number.POSITIVE_INFINITY,n=0;n<this.length;n+=1){var i=this.getScalar(n);(isNaN(t)||t<i&&!isNaN(i))&&(t=i),(isNaN(e)||i<e&&!isNaN(i))&&(e=i)}return[e,t]},on.prototype.getScalar=function(t){return this.dataView.getFloat32(this.getByteLocation(t),!0)},on.prototype.getValue=function(t){t=this.getScalar(t);return isNaN(t)?null:t},on.prototype.hash=function(t){return this.dataView.getFloat32(this.getHashLocation(t),!0)},on.TYPE_NUM=8,ee.Float=on,u=A=A||{},ie=u.ipc||(u.ipc={}),oe=ie.I32,e(sn,oe),sn.listToIPC=function(t){var e=4*t.length+6,n=ie.Util.createBuffer(e);return n.wb(sn.TYPE_NUM),n.wb(0),n.wi(t.length),_.each(t,function(t){return sn.writeValue(t,n.wb)}),n.data},sn.toIPC=function(t){var e=ie.Util.createBuffer(5);return e.wb(256-sn.TYPE_NUM),sn.writeValue(t,e.wb),e.data},sn.writeValue=function(t,e){var n;null!==t?((n=new Int32Array(1))[0]=t,_.each(new Uint8Array(n.buffer),function(t){return e(t)})):_.each([0,0,0,128],function(t){return e(t)})},sn.prototype.getValue=function(t){t=this.getScalar(t);return-2147483648===t?null:-2147483647===t?-1/0:2147483647===t?1/0:t},sn.TYPE_NUM=6,ie.Int=sn,se=A=A||{},ae=se.ipc||(se.ipc={}),re=ae.I32,e(an,re),an.fromMoment=function(t){return an.fromScalar(t.asMinutes())},an.fromScalar=function(t){return null===t?null:new se.rMinuteClass(t)},an.fromString=function(t){var e=(t=t.replace("1970-01-01T","").replace("Z","")).match(ae.Constants.TIME_PARTS_RX),e=h.duration(e&&e[1]?e[1]:t);return an.fromMoment(e)},an.listToIPC=function(t){var e=4*t.length+6,n=ae.Util.createBuffer(e);return n.wb(ae.TypeNum.Minute),n.wb(0),n.wi(t.length),_.each(t,function(t){return an.writeValue(t,n.wb)}),n.data},an.toMoment=function(t){return null===t?null:h.duration(60*t.i*1e3)},an.toScalar=function(t){return null===t?null:t.i},an.toString=function(t,e,n){return void 0===e&&(e="HH:mm:ss.SSS"),void 0===n&&(n={trim:!1}),null===t?"":an.toMoment(t).format(e,n)},an.toIPC=function(t){var e=ae.Util.createBuffer(5);return e.wb(256-ae.TypeNum.Minute),an.writeValue(t,e.wb),e.data},an.writeValue=function(t,e){ae.Int.writeValue(an.toScalar(t),e)},an.prototype.getValue=function(t){t=re.prototype.getScalar.call(this,t);return t===ae.I32.NULL?null:new se.rMinuteClass(t)},ae.Minute=an,qe=(qe=A=A||{}).ipc||(qe.ipc={}),le=qe.Vector,e(rn,le),rn.prototype.calcRange=function(){for(var t=Number.NEGATIVE_INFINITY,e=Number.POSITIVE_INFINITY,n=0;n<this.length;n+=1){var i=this.getScalar(n);(isNaN(t)||t<i&&!isNaN(i))&&(t=i),(isNaN(e)||i<e&&!isNaN(i))&&(e=i)}return[e,t]},rn.prototype.getScalar=function(t){return this.dataView.getFloat64(this.getByteLocation(t),!0)},rn.prototype.hash=function(t){return this.dataView.getFloat64(this.getHashLocation(t),!0)},rn.prototype.toSplitTypedArray=function(){return this.align(),new Float32Array(this.dataView.buffer,this.offset,2*this.length)},qe.F64=rn,Ye=A=A||{},ue=Ye.ipc||(Ye.ipc={}),ce=ue.F64,e(ln,ce),ln.listToIPC=function(t){var e=8*t.length+6,n=ue.Util.createBuffer(e);return n.wb(ln.TYPE_NUM),n.wb(0),n.wi(t.length),_.each(t,function(t){return ln.writeValue(t,n.wb)}),n.data},ln.toIPC=function(t){var e=ue.Util.createBuffer(9);return e.wb(256-ln.TYPE_NUM),ln.writeValue(t,e.wb),e.data},ln.writeValue=function(t,e){var n;null!==t?((n=new Float64Array(1))[0]=t,_.each(new Uint8Array(n.buffer),function(t){return e(t)})):_.each([0,0,0,0,0,0,248,255],function(t){return e(t)})},ln.prototype.getValue=function(t){t=this.getScalar(t);return isNaN(t)?null:t},ln.TYPE_NUM=9,ue.Double=ln,Ke=A=A||{},pe=Ke.ipc||(Ke.ipc={}),de=pe.Vector,e(un,de),un.listToIPC=function(t){var e=2*t.length+6,n=pe.Util.createBuffer(e);return n.wb(un.TYPE_NUM),n.wb(0),n.wi(t.length),_.each(t,function(t){return un.writeValue(t,n.wb)}),n.data},un.toIPC=function(t){var e=pe.Util.createBuffer(3);return e.wb(256-un.TYPE_NUM),un.writeValue(t,e.wb),e.data},un.writeValue=function(t,e){var n;null!==t?((n=new Int16Array(1))[0]=t,_.each(new Uint8Array(n.buffer),function(t){return e(t)})):_.each([0,128],function(t){return e(t)})},un.prototype.getValue=function(t){t=this.getScalar(t);return-32768===t?null:-32767===t?-1/0:32767===t?1/0:t},un.prototype.calcRange=function(){for(var t=Number.NEGATIVE_INFINITY,e=Number.POSITIVE_INFINITY,n=0;n<this.length;n+=1){var i=this.getScalar(n);(t===un.SHORT_NULL||t<i&&i!==un.SHORT_NULL)&&(t=i),(e===un.SHORT_NULL||i<e&&i!==un.SHORT_NULL)&&(e=i)}return[e,t]},un.prototype.getScalar=function(t){return this.dataView.getInt16(this.getByteLocation(t),!0)},un.prototype.hash=function(t){return this.dataView.getInt16(this.getHashLocation(t))},un.TYPE_NUM=5,un.SHORT_NULL=-32768,pe.Short=un,he=A=A||{},ge=he.ipc||(he.ipc={}),me=ge.I32,e(cn,me),cn.fromMoment=function(t){return null===t?null:new he.rTimeClass(t.asMilliseconds())},cn.fromScalar=function(t){return null===t?null:new he.rTimeClass(t)},cn.fromString=function(t){var e=(t=t.replace("1970-01-01T","").replace("Z","")).match(ge.Constants.TIME_PARTS_RX),e=h.duration(e&&e[1]?e[1]:t);return cn.fromMoment(e)},cn.listToIPC=function(t){var e=4*t.length+6,n=ge.Util.createBuffer(e);return n.wb(ge.TypeNum.Time),n.wb(0),n.wi(t.length),_.each(t,function(t){return cn.writeValue(t,n.wb)}),n.data},cn.toIPC=function(t){var e=ge.Util.createBuffer(5);return e.wb(256-ge.TypeNum.Time),cn.writeValue(t,e.wb),e.data},cn.toMoment=function(t){return null===t?null:h.duration(t.i)},cn.toScalar=function(t){return null===t?null:t.i},cn.toString=function(t,e,n){return void 0===e&&(e="HH:mm:ss.SSS"),void 0===n&&(n={trim:!1}),null===t?"":cn.toMoment(t).format(e,n)},cn.writeValue=function(t,e){ge.Int.writeValue(cn.toScalar(t),e)},cn.prototype.getValue=function(t){t=me.prototype.getScalar.call(this,t);return t===ge.I32.NULL?null:new he.rTimeClass(t)},ge.Time=cn,fe=A=A||{},ze=fe.ipc||(fe.ipc={}),ye=ze.Vector,e(pn,ye),pn.prototype.calcRange=function(){if("undefined"!=typeof BigInt){for(var t=this.getScalar(0),e=t,n=BigInt("-9223372036854775808"),i=1;i<this.length;i++){var o=this.getScalar(i);(t===n||t<o&&o!==n)&&(t=o),(e===n||o<e&&o!==n)&&(e=o)}return[e,t]}for(var s=this.getLegacyScalar(0),a=s,r=pn.LONG_NULL,i=1;i<this.length;i++){o=this.getLegacyScalar(i);(s.eq(r)||o.gt(s)&&!o.eq(r))&&(s=o),(a.eq(r)||o.lt(a)&&!o.eq(r))&&(a=o)}return[a,s]},pn.prototype.getLegacyScalar=function(t){t=new Uint8Array(this.dataView.buffer,this.getByteLocation(t),this.SIZE);return fe.Long.fromBytesLE(t)},pn.prototype.getScalar=function(t){return this.dataView.getBigInt64(this.getByteLocation(t),!0)},pn.prototype.hash=function(t){return this.dataView.getBigInt64(this.getHashLocation(t),!0)},pn.LONG_NULL=new fe.Long(0,2147483648),pn.LONG_INFINITY_NEGATIVE=new fe.Long(1,2147483648),pn.LONG_INFINITY_POSITIVE=fe.Long.MAX_VALUE,c=pn,ze.I64=c,fe.Tools.isIE11&&(c.prototype.hash=function(t){t=new Uint8Array(this.dataView.buffer,this.getHashLocation(t),this.SIZE);return fe.Long.fromBytesLE(t)},c.prototype.toTypedArray=function(){var t;return this.align(),0===this.indexOffset?new Uint8Array(this.dataView.buffer,this.offset,this.length*this.SIZE):((t=new Uint8Array(this.length*this.SIZE)).set(new Uint8Array(this.dataView.buffer,this.indexOffset*this.SIZE,(this.length-this.indexOffset)*this.SIZE)),t.set(new Uint8Array(this.dataView.buffer,0,this.indexOffset*this.SIZE),(this.length-this.indexOffset)*this.SIZE),t)}),ve=A=A||{},be=ve.ipc||(ve.ipc={}),Se=be.I64,e(dn,Se),dn.fromMoment=function(t){return null===t?null:new ve.rTimestampClass(t.valueOf(),1e6*t.milliseconds()+t.nanoseconds())},dn.fromScalar=function(t){var t="bigint"==typeof t||"number"==typeof t?ve.Long.fromString(t.toString()):t;return t.equals(be.Constants.LONG_NULL)?null:(t=new ut.BigInteger(t.toString()).add(be.Constants.BQEPOCH).toString(),new ve.rTimestampClass(Number(t.substring(0,t.length-6)),Number(t.substring(t.length-9))))},dn.fromString=function(t){if(null===t)return null;var e=t.match(/(.*)(D|T)(.*?)Z?$/);if(!e)return null;t=e[1].replace(/\./g,"-")+"T"+e[3]+"Z";e=h(t);return e.nanoseconds(ve.Tools.extractNanos(t)),dn.fromMoment(e)},dn.listToIPC=function(t){var e=8*t.length+6,n=be.Util.createBuffer(e);return n.wb(be.TypeNum.Timestamp),n.wb(0),n.wi(t.length),_.each(t,function(t){return be.DateTime.writeValue(t,n.wb)}),n.data},dn.toIPC=function(t){var e=be.Util.createBuffer(9);return e.wb(256-be.TypeNum.Timestamp),dn.writeValue(t,e.wb),e.data},dn.toMoment=function(t){var e;return null===t?null:((e=h.tz(t.i,"UTC")).nanoseconds(t.n%1e6),ve.Tools.timezone&&e.isValid()&&e.tz(ve.Tools.timezone),e)},dn.toScalar=function(t){return null===t?null:BigInt(dn.toScalarString(t))},dn.toString=function(t,e){var n;return null===t?"":(n=(t=dn.toMoment(t)).format(e||"YYYY-MM-DDTHH:mm:ss.SSS"),e?n:n.substr(0,23)+_.padEnd(""+t.nanoseconds(),6,"0")+"Z")},dn.writeValue=function(t,e){t=dn.toScalarString(t);be.QLong.writeValue(t,e)},dn.toScalarString=function(t){if(null===t)return null;_.isNumber(t)&&(t=this.fromMoment(h(t)));var e=_.padStart(t.n.toFixed(0),9,"0"),t=t.i.toFixed(0);return new ut.BigInteger(t+e.substring(3)).subtract(be.Constants.BQEPOCH).toString()},dn.prototype.getValue=function(t){var t=new Uint8Array(this.dataView.buffer,this.getByteLocation(t),this.SIZE),t=ve.Long.fromBytesLE(t);return t.equals(dn.LONG_NULL)?null:(t=new ut.BigInteger(t.toString()).add(be.Constants.BQEPOCH).toString(),new ve.rTimestampClass(Number(t.substring(0,t.length-6)),Number(t.substring(t.length-9))))},be.Timestamp=dn,n=A=A||{},we=n.ipc||(n.ipc={}),_e=we.U8,e(hn,_e),hn.listToIPC=function(t){var e=t.length+6,n=we.Util.createBuffer(e);return n.wb(hn.TYPE_NUM),n.wb(0),n.wi(t.length),_.each(t,function(t){return n.wb(t?1:0)}),n.data},hn.toIPC=function(t){var e=we.Util.createBuffer(2);return e.wb(256-hn.TYPE_NUM),e.wb(t?1:0),e.data},hn.prototype.getValue=function(t){return 1===this.getScalar(t)},hn.TYPE_NUM=1,we.Boolean=hn,Te=A=A||{},Ce=Te.ipc||(Te.ipc={}),De=Ce.U8,e(gn,De),gn.listToIPC=function(t){var t=t.map(function(t){return Te.u8u16(t&&t.length?t[0]:" ")}),e=t.flat(),t=t.length+6,n=Ce.Util.createBuffer(t);return n.wb(gn.TYPE_NUM),n.wb(0),n.wi(e.length),_.each(e,function(t){return n.wb(t)}),n.data},gn.toIPC=function(t){var t=Te.u8u16(t&&t.length?t[0]:" "),e=Ce.Util.createBuffer(1+t.length);return e.wb(256-gn.TYPE_NUM),t.forEach(function(t){return e.wb(t)}),e.data},gn.u16u8=function(t){for(var e,n,i,o="",s=0;s<t.length;s++)switch((e=t[s])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(e);break;case 12:case 13:n=t[++s],o+=String.fromCharCode((31&e)<<6|63&n);break;case 14:n=t[++s],i=t[++s],o+=String.fromCharCode((15&e)<<12|(63&n)<<6|(63&i)<<0)}return o},gn.prototype.getValue=function(t){t=this.getScalar(t);return 0===t?"":Te.u16u8([t])},gn.TYPE_NUM=10,Ce.Char=gn,Ee=A=A||{},Me=Ee.ipc||(Ee.ipc={}),Pe=Me.F64,e(mn,Pe),mn.fromMoment=function(t){return null===t?null:new Ee.rDateTimeClass(t.valueOf())},mn.fromScalar=function(t){return isNaN(t)||null===t?null:new Ee.rDateTimeClass(Me.Constants.QEPOCH+t*Me.Constants.MSDAY)},mn.fromString=function(t){if(null===t)return null;var e=t.match(/(.*)(D|T)(.*?)Z?$/);if(!e)return null;t=e[1].replace(/\./g,"-")+"T"+e[3]+"Z";e=h(t);return mn.fromMoment(e)},mn.listToIPC=function(t){var e=8*t.length+6,n=Me.Util.createBuffer(e);return n.wb(Me.TypeNum.DateTime),n.wb(0),n.wi(t.length),_.each(t,function(t){return mn.writeValue(t,n.wb)}),n.data},mn.toIPC=function(t){var e=Me.Util.createBuffer(9);return e.wb(256-Me.TypeNum.DateTime),mn.writeValue(t,e.wb),e.data},mn.toMoment=function(t){return null===t?null:(t=h.tz(t.i,"UTC"),Ee.Tools.timezone&&t.isValid()&&t.tz(Ee.Tools.timezone),t)},mn.toScalar=function(t){return null===t?null:(t.i-Me.Constants.QEPOCH)/Me.Constants.MSDAY},mn.toString=function(t,e){return null===t?"":(t=mn.toMoment(t),void 0!==e?t.format(e):t.toISOString())},mn.writeValue=function(t,e){Me.Double.writeValue(mn.toScalar(t),e)},mn.prototype.getValue=function(t){return mn.fromScalar(this.getScalar(t))},Me.DateTime=mn,i=A=A||{},Ie=i.ipc||(i.ipc={}),Ae=Ie.Vector,e(fn,Ae),fn.prototype.calcRange=function(){throw"Not implemented"},fn.prototype.hash=function(t){throw"GUID hash not implemented "+t},fn.prototype.getScalar=function(t){return this.dataView.getBigInt64(this.getByteLocation(t),!0)},fn.prototype.getValue=function(t){for(var e=this.getByteLocation(t),n=e+this.SIZE,i="0123456789abcdef",o="",s=e;s<n;s++)var a=this.dataView.getUint8(s),r=s-e,o=(o+=4==r||6==r||8==r||10==r?"-":"")+i[a>>4]+i[15&a];return"00000000-0000-0000-0000-000000000000"===o?null:o},Ie.Guid=fn;Qn.hash=function(t){t=Qn.md51_array(t);return Qn.hex(t)},Qn.rhex=function(t){for(var e="",n=0;n<4;n+=1)e+=Qn.hex_chr[t>>8*n+4&15]+Qn.hex_chr[t>>8*n&15];return e},Qn.hex=function(t){for(var e=0;e<t.length;e+=1)t[e]=Qn.rhex(t[e]);return t.join("")},Qn.md5cycle=function(t,e){var n=t[0],i=t[1],o=t[2],s=t[3],i=((i+=((o=((o+=((s=((s+=((n=((n+=(i&o|~i&s)+e[0]-680876936|0)<<7|n>>>25)+i|0)&i|~n&o)+e[1]-389564586|0)<<12|s>>>20)+n|0)&n|~s&i)+e[2]+606105819|0)<<17|o>>>15)+s|0)&s|~o&n)+e[3]-1044525330|0)<<22|i>>>10)+o|0;i=((i+=((o=((o+=((s=((s+=((n=((n+=(i&o|~i&s)+e[4]-176418897|0)<<7|n>>>25)+i|0)&i|~n&o)+e[5]+1200080426|0)<<12|s>>>20)+n|0)&n|~s&i)+e[6]-1473231341|0)<<17|o>>>15)+s|0)&s|~o&n)+e[7]-45705983|0)<<22|i>>>10)+o|0,i=((i+=((o=((o+=((s=((s+=((n=((n+=(i&o|~i&s)+e[8]+1770035416|0)<<7|n>>>25)+i|0)&i|~n&o)+e[9]-1958414417|0)<<12|s>>>20)+n|0)&n|~s&i)+e[10]-42063|0)<<17|o>>>15)+s|0)&s|~o&n)+e[11]-1990404162|0)<<22|i>>>10)+o|0,i=((i+=((o=((o+=((s=((s+=((n=((n+=(i&o|~i&s)+e[12]+1804603682|0)<<7|n>>>25)+i|0)&i|~n&o)+e[13]-40341101|0)<<12|s>>>20)+n|0)&n|~s&i)+e[14]-1502002290|0)<<17|o>>>15)+s|0)&s|~o&n)+e[15]+1236535329|0)<<22|i>>>10)+o|0,i=((i+=((o=((o+=((s=((s+=((n=((n+=(i&s|o&~s)+e[1]-165796510|0)<<5|n>>>27)+i|0)&o|i&~o)+e[6]-1069501632|0)<<9|s>>>23)+n|0)&i|n&~i)+e[11]+643717713|0)<<14|o>>>18)+s|0)&n|s&~n)+e[0]-373897302|0)<<20|i>>>12)+o|0,i=((i+=((o=((o+=((s=((s+=((n=((n+=(i&s|o&~s)+e[5]-701558691|0)<<5|n>>>27)+i|0)&o|i&~o)+e[10]+38016083|0)<<9|s>>>23)+n|0)&i|n&~i)+e[15]-660478335|0)<<14|o>>>18)+s|0)&n|s&~n)+e[4]-405537848|0)<<20|i>>>12)+o|0,i=((i+=((o=((o+=((s=((s+=((n=((n+=(i&s|o&~s)+e[9]+568446438|0)<<5|n>>>27)+i|0)&o|i&~o)+e[14]-1019803690|0)<<9|s>>>23)+n|0)&i|n&~i)+e[3]-187363961|0)<<14|o>>>18)+s|0)&n|s&~n)+e[8]+1163531501|0)<<20|i>>>12)+o|0,i=((i+=((o=((o+=((s=((s+=((n=((n+=(i&s|o&~s)+e[13]-1444681467|0)<<5|n>>>27)+i|0)&o|i&~o)+e[2]-51403784|0)<<9|s>>>23)+n|0)&i|n&~i)+e[7]+1735328473|0)<<14|o>>>18)+s|0)&n|s&~n)+e[12]-1926607734|0)<<20|i>>>12)+o|0,i=((i+=((o=((o+=((s=((s+=((n=((n+=(i^o^s)+e[5]-378558|0)<<4|n>>>28)+i|0)^i^o)+e[8]-2022574463|0)<<11|s>>>21)+n|0)^n^i)+e[11]+1839030562|0)<<16|o>>>16)+s|0)^s^n)+e[14]-35309556|0)<<23|i>>>9)+o|0,i=((i+=((o=((o+=((s=((s+=((n=((n+=(i^o^s)+e[1]-1530992060|0)<<4|n>>>28)+i|0)^i^o)+e[4]+1272893353|0)<<11|s>>>21)+n|0)^n^i)+e[7]-155497632|0)<<16|o>>>16)+s|0)^s^n)+e[10]-1094730640|0)<<23|i>>>9)+o|0,i=((i+=((o=((o+=((s=((s+=((n=((n+=(i^o^s)+e[13]+681279174|0)<<4|n>>>28)+i|0)^i^o)+e[0]-358537222|0)<<11|s>>>21)+n|0)^n^i)+e[3]-722521979|0)<<16|o>>>16)+s|0)^s^n)+e[6]+76029189|0)<<23|i>>>9)+o|0,i=((i+=((o=((o+=((s=((s+=((n=((n+=(i^o^s)+e[9]-640364487|0)<<4|n>>>28)+i|0)^i^o)+e[12]-421815835|0)<<11|s>>>21)+n|0)^n^i)+e[15]+530742520|0)<<16|o>>>16)+s|0)^s^n)+e[2]-995338651|0)<<23|i>>>9)+o|0,i=((i+=((s=((s+=(i^((n=((n+=(o^(i|~s))+e[0]-198630844|0)<<6|n>>>26)+i|0)|~o))+e[7]+1126891415|0)<<10|s>>>22)+n|0)^((o=((o+=(n^(s|~i))+e[14]-1416354905|0)<<15|o>>>17)+s|0)|~n))+e[5]-57434055|0)<<21|i>>>11)+o|0,i=((i+=((s=((s+=(i^((n=((n+=(o^(i|~s))+e[12]+1700485571|0)<<6|n>>>26)+i|0)|~o))+e[3]-1894986606|0)<<10|s>>>22)+n|0)^((o=((o+=(n^(s|~i))+e[10]-1051523|0)<<15|o>>>17)+s|0)|~n))+e[1]-2054922799|0)<<21|i>>>11)+o|0,i=((i+=((s=((s+=(i^((n=((n+=(o^(i|~s))+e[8]+1873313359|0)<<6|n>>>26)+i|0)|~o))+e[15]-30611744|0)<<10|s>>>22)+n|0)^((o=((o+=(n^(s|~i))+e[6]-1560198380|0)<<15|o>>>17)+s|0)|~n))+e[13]+1309151649|0)<<21|i>>>11)+o|0,i=((i+=((s=((s+=(i^((n=((n+=(o^(i|~s))+e[4]-145523070|0)<<6|n>>>26)+i|0)|~o))+e[11]-1120210379|0)<<10|s>>>22)+n|0)^((o=((o+=(n^(s|~i))+e[2]+718787259|0)<<15|o>>>17)+s|0)|~n))+e[9]-343485551|0)<<21|i>>>11)+o|0,t[0]=n+t[0]|0,t[1]=i+t[1]|0,t[2]=o+t[2]|0,t[3]=s+t[3]|0},Qn.md5blk_array=function(t){for(var e=[],n=0;n<64;n+=4)e[n>>2]=t[n]+(t[n+1]<<8)+(t[n+2]<<16)+(t[n+3]<<24);return e},Qn.md51_array=function(t){for(var e,n,i,o,s=t.length,a=[1732584193,-271733879,-1732584194,271733878],r=64;r<=s;r+=64)Qn.md5cycle(a,Qn.md5blk_array(t.subarray(r-64,r)));for(e=(t=r-64<s?t.subarray(r-64):new Uint8Array(0)).length,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r=0;r<e;r+=1)n[r>>2]|=t[r]<<(r%4<<3);if(n[r>>2]|=128<<(r%4<<3),55<r)for(Qn.md5cycle(a,n),r=0;r<16;r+=1)n[r]=0;return o=(o=8*s).toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(o[2],16),o=parseInt(o[1],16)||0,n[14]=i,n[15]=o,Qn.md5cycle(a,n),a},Qn.hex_chr=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];var yn,vn,bn,Sn,wn,_n,Tn,Cn,Dn,En,Mn,Pn,In,An,kn,xn,Nn,Ln,Rn,Vn,On,Bn,$n,Un,p,g,qn,Fn,Yn,Hn,Kn=Qn;function Qn(){}function zn(t,e,n){n=bn.call(this,t.length,void 0,0,n)||this;return n.indexOffset=0,n.end=e,n.values=t,n}function Wn(t,e,n){return _n.call(this,t,e,wn.TypeNum.Long,n)||this}function Gn(t,e,n){t=Dn.call(this,t,t?e[0]:void 0,Cn.TypeNum.Symbol,n)||this;return t.indexOffset=0,t.offsets=e,t}function jn(){}function Xn(t,e,n){return In.call(this,t,e,Pn.TypeNum.Month,n)||this}function Zn(t,e,n){return xn.call(this,t,e,kn.TypeNum.Second,n)||this}function Jn(t,e,n){return Rn.call(this,t,e,Ln.TypeNum.Timespan,n)||this}function ti(t,e,n){return On.call(this,t,e,Vn.TypeNum.Unary,n)||this}function ei(t,e,n,i){this.length=t,this.keys=e,this.values=n,this.qtype=i||Bn.TypeNum.Dict}function ni(t,n,i){var o=this;this.class="203",this.columns=[],this.meta={},this.cols={},void 0!==t&&(this.columns=t).forEach(function(t,e){o.meta[t]=n[e].qtype,o.cols[t]=$n.Parse.col(n[e],i)})}function ii(){}function m(t){var e=this,n=(this.requests={},this.requestId=1,this.httpOn=!1,this.insightsAPI=!1,(m.client=this).insightsAPI=t.insightsAPI||!1,this.debouncedHeartbeat=t.httpOnly?_.noop.bind(this):_.debounce(this.heartbeat.bind(this),15e3),(t.httpOn||t.httpOnly||t.insightsAPI)&&(this.httpOn=!0),t.httpOnly||t.insightsAPI);if(t.noWorker||n)n?_.defer(function(){return e.onOpen(void 0)}):this.init();else{n=requirejs.toUrl("worker")+".js";g.Log.Log(m.WORK+n),t.name=_.get(t,"dashboards.kxnodeflate")?"kxnodeflate":"";try{!window.SharedWorker||"FSBL"in window?(this.worker=new Worker(n,t),this.worker.onmessage=function(t){return e.onWsMessage(t)},this.worker.onerror=function(t){return e.onWorkerError(t)}):(this.worker=new SharedWorker(n,t),this.worker.port.onmessage=function(t){return e.onWsMessage(t)},this.worker.port.onmessageerror=function(t){return e.onWorkerError(t)},this.worker.port.start(),this.worker.onerror=function(t){return e.onWorkerError(t)})}catch(t){throw g.Log.Log(m.WORK+"create err",t),t}}}function oi(){this.legacySubscribers={},this.rawSubscribers={}}function si(t){var n=this,i=t.mappings||{};this.setDataModelMappings=t.setMappings,this.subscriptionKey=_.uniqueId("mapper_"),this.subscribe=t.subscribe,this.subscribed=!1,this.unsubscribe=t.unsubscribe,this.viewState=t.viewState,this.model=new f.Model({key:i.key||"",value:i.value||""}),this.mappings=new f.Collection(_.map(i.mappings,function(t,e){return new f.Model({key:e,value:"",viewstate:t&&t._dashboardsType?n.viewState.getByPath(i.mappings[e].value):t})})||[]),_.extend(this,f.Events)}function ai(t){this.collection=t}yn=A=A||{},vn=yn.ipc||(yn.ipc={}),bn=vn.TypeBase,e(zn,bn),zn.toIPC=function(t){var e=_.sumBy(t,function(t){return t.length})+6,n=vn.Util.createBuffer(e);return n.wb(0),n.wb(0),n.wi(t.length),_.each(t,function(t){_.each(t,function(t){return n.wb(t)})}),n.data},zn.prototype.getFirstOffset=function(t){var e,t=this.values[t];return 0===(t=98!==t.qtype&&99!==t.qtype?t:(98===(e=t).keys.qtype||99===e.keys.qtype?e.keys:e).keys).qtype?new zn((e=t).values,e.end,this.dataView).getFirstOffset(0):11===t.qtype?t.offsets[0]:(0<=t.qtype&&t.qtype,t.offset)},zn.prototype.getEndOffset=function(t){t=this.values[t];if(0===(t=98!==t.qtype&&99!==t.qtype?t:(98===(e=t).values.qtype||99===e.values.qtype?e.values:e).values).qtype)return t.end;if(11===t.qtype)for(var e=t,n=e.offsets[e.offsets.length-1];0!==this.dataView.getUint8(n++););else{if(-11!==t.qtype)return 0<=t.qtype&&t.qtype<=19?(e=t).offset+yn.getTypeSize(e.qtype)*e.length:(e=t).offset+yn.getTypeSize(Math.abs(e.qtype));for(n=t.offset;0!==this.dataView.getUint8(n++););}return n},zn.prototype.getValue=function(t){t=this.values[t];return 98===t.qtype||99===t.qtype?vn.Parse.table(t,this.dataView):vn.Parse.col(t,this.dataView)},zn.prototype.isolate=function(t){var e=this.getFirstOffset(t),n=this.getEndOffset(t)-e,i=new ArrayBuffer(n),o=new Uint8Array(i,0,n);return o.set(new Uint8Array(this.dataView.buffer,e,n)),this.offsetItem(t,-e),98===this.values[t].qtype||99===this.values[t].qtype?(this.values[t]=vn.Parse.table(this.values[t],new DataView(i)),Kn.hash(o)):(this.values[t]=n=vn.Parse.col(this.values[t],new DataView(i)),10===n.qtype?this.toLegacy(t):1===n.length&&-20<n.qtype&&n.qtype<20&&0!==n.qtype&&11!==n.qtype&&-11!==n.qtype?(e=n.hash(0),yn.Long.isLong(e)?e.toString():e):Kn.hash(o))},zn.prototype.offsetItem=function(t,e){var n,i=this.values[t];98!==i.qtype&&99!==i.qtype||(i=(98===(n=i).keys.qtype||99===n.keys.qtype?n.keys:n).keys,n=(98===n.values.qtype||99===n.values.qtype?n.values:n).values,this.offsetQTyped(t,e,n)),this.offsetQTyped(t,e,i)},zn.prototype.offsetQTyped=function(t,e,n){if(0===n.qtype)for(var i=new zn(n.values,n.end,this.dataView),o=0;o<i.length;o++)i.offsetItem(o,e);else if(11===n.qtype)for(var s=n,a=0;a<s.offsets.length;a++)s.offsets[a]+=e;else n.offset+=e},zn.prototype.mergeIndexed=function(t){if(t.length>=this.length)throw"Invalid Merge Size";if(0!==t.length){var e=t.getFirstOffset(0),n=t.end-e,i=this.getFirstOffset(t.values.length),o=this.end-i,s=new ArrayBuffer(n+o);new Uint8Array(s,0,n).set(new Uint8Array(t.dataView.buffer,e,n)),new Uint8Array(s,n,o).set(new Uint8Array(this.dataView.buffer,i,o));for(var a=0;a<t.length;a++)this.values[a]=_.clone(t.values[a]),this.offsetItem(a,-e);for(var r=n-i,a=t.length;a<this.length;a++)this.offsetItem(a,r);this.end+=r,this.dataView=new DataView(s)}},zn.prototype.mergeKeyedPrimary=function(t,e,n){var i=this;if(void 0===this.keyIndex){for(var o={},s=0;s<this.length;s++)o[this.isolate(s)]=s;this.keyIndex=o,delete this.dataView,this.getValue=function(t){return i.values[(t+i.indexOffset)%i.length]}}for(s=0;s<t.length;s++){var a,r=t.isolate(s),l=t.values[s],u=this.keyIndex[r];void 0===u?this.length===e?(a=this.indexOffset%e,this.keyIndex[r]=a,this.values[a]=l,n.push(a),this.indexOffset++):(this.keyIndex[r]=this.length,n.push(this.length),this.values.push(l),this.length++):n.push(u)}return this.indexOffset},zn.prototype.mergeKeyed=function(t,e,n,i){var o=this;if(void 0===this.values){for(var s=[],a=0;a<this.length;a++){var r=this.getValue(a);s.push(r)}this.values=s,delete this.dataView,this.getValue=function(t){return o.values[(t+o.indexOffset)%o.length]}}for(var l=!1,a=0;a<e.length;a++){var u=t.getValue(a),c=e[a];c===this.length?(this.values.push(u),this.length++,l=!0):c>this.length||(this.values[c]=u,l=!0)}if(l){for(var p=_.sumBy(this.values,"length"),d=new ArrayBuffer(p),h=new Uint8Array(d,0,p),g=0,a=0;a<this.values.length;a++){var m,f=this.values[a];f instanceof vn.Vector?(m=f.toTypedArray().slice(),h.set(new Uint8Array(m.buffer),g),this.values[a]=new yn.qVector(f.qtype,!1,f.length,g),g+=f.length):f instanceof yn.qVector&&(h.set(new Uint8Array(this.dataView.buffer,f.offset,f.length),g),f.offset=g,g+=f.length)}this.dataView=new DataView(d),this.end=g}this.indexOffset=n},zn.prototype.sliceDataView=function(t){var e=this.getFirstOffset(t),n=this.getEndOffset(this.length-1),n=this.dataView.buffer.slice(e,n);if(this.dataView=new DataView(n),this.length=this.length-t,this.values){this.values.splice(0,t);for(var i=0;i<this.values.length;i++)this.values[i].offset-=e;this.end-=e}},zn.prototype.toLegacy=function(t){var e,n=this.values[t],i=this.dataView;if(10!==n.qtype)return-20<n.qtype&&n.qtype<0?vn.Parse.col(n,i).toLegacy(0):0<=n.qtype&&n.qtype<20?(e=vn.Parse.col(n,i),_.times(e.length).map(function(t){return e.toLegacy(t)})):98===n.qtype||99===n.qtype?vn.Parse.table(n,i).toLegacy():101===n.qtype?null:void 0;var o=n,s=[];for(t=0;t<o.length;t++)s.push(i.getUint8(o.offset+t));return vn.Char.u16u8(s)},zn.prototype.toViewState=function(t){var e=this.values[t];return 99===e.qtype||98===e.qtype?vn.Parse.table(e,this.dataView).toViewState():{_type:10===e.qtype?"string":vn.Parse.TYPE_NAMES[Math.abs(e.qtype)],value:yn.Tools.convertKDBToViewstateValue(this.toLegacy(t))}},vn.List=zn,Sn=A=A||{},wn=Sn.ipc||(Sn.ipc={}),_n=wn.I64,e(Wn,_n),Wn.listToIPC=function(t){var e=8*t.length+6,n=wn.Util.createBuffer(e);return n.wb(Wn.TYPE_NUM),n.wb(0),n.wi(t.length),_.each(t,function(t){return Wn.writeValue(t,n.wb)}),n.data},Wn.toIPC=function(t){var e=wn.Util.createBuffer(9);return e.wb(256-Wn.TYPE_NUM),Wn.writeValue(t,e.wb),e.data},Wn.writeValue=function(t,e){null!==t?(t=Sn.Long.fromString(""+t),_.each(t.toBytesLE(),function(t){return e(t)})):_.each([0,0,0,0,0,0,0,128],function(t){return e(t)})},Wn.prototype.getValue=function(t){t=this.getLegacyScalar(t);return t.equals(wn.I64.LONG_INFINITY_NEGATIVE)?-1/0:t.equals(wn.I64.LONG_INFINITY_POSITIVE)?1/0:t.equals(wn.I64.LONG_NULL)?null:t.toString()},Wn.TYPE_NUM=7,wn.QLong=Wn,Tn=A=A||{},Cn=Tn.ipc||(Tn.ipc={}),Dn=Cn.TypeBase,e(Gn,Dn),Gn.listToIPC=function(t){var e=_.sumBy(t,function(t){return t.length+1})+6,n=Cn.Util.createBuffer(e);return n.wb(11),n.wb(0),n.wi(t.length),_.each(t,function(t){return Gn.writeValue(t,n.wb)}),n.data},Gn.toIPC=function(t){var e=t?t.length+2:2,e=Cn.Util.createBuffer(e);return e.wb(245),null===t&&void 0===t||Gn.writeValue(t,e.wb),e.data},Gn.writeValue=function(t,e){null!=t&&_.each(""+t,function(t){return e(t.charCodeAt(0))}),e(0)},Gn.prototype.getValue=function(t){if(this.values)return this.values[(t+this.indexOffset)%this.length];for(var e,n=this.offsets[(t+this.indexOffset)%this.length],i=[];0!==(e=this.dataView.getUint8(n++));)i.push(e);return Tn.u16u8(i)},Gn.prototype.hash=function(t){return this.getValue(t)},Gn.prototype.mergeIndexed=function(t){if(t.length>=this.length)throw"Invalid Merge Size";if(null!==t.offset){for(var e=_.last(t.offsets);0!==t.dataView.getUint8(e++););for(var n=e-t.offset,i=this.offsets[t.length],o=_.last(this.offsets);0!==this.dataView.getUint8(o++););var s=o-i,a=new ArrayBuffer(n+s);new Uint8Array(a,0,n).set(new Uint8Array(t.dataView.buffer,t.offset,n)),new Uint8Array(a,n,s).set(new Uint8Array(this.dataView.buffer,i,s));for(var r=0;r<t.length;r++)this.offsets[r]=t.offsets[r]-t.offset;for(var l=n-i,r=t.length;r<this.length;r++)this.offsets[r]=this.offsets[r]+l;this.offset=0,this.dataView=new DataView(a)}},Gn.prototype.mergeKeyedPrimary=function(t,e,n){if(void 0===this.keyIndex){for(var i={},o=[],s=0;s<this.length;s++){var a=this.getValue(s);i[a]=s,o.push(a)}this.keyIndex=i,this.values=o,delete this.offsets,delete this.dataView}for(s=0;s<t.length;s++){var r,l=t.getValue(s),u=this.keyIndex[l];void 0===u?this.length===e?(r=this.indexOffset%e,this.keyIndex[l]=r,this.values[r]=l,n.push(r),this.indexOffset++):(this.keyIndex[l]=this.length,n.push(this.length),this.values.push(l),this.length++):n.push(u)}return this.indexOffset},Gn.prototype.mergeKeyed=function(t,e,n,i){if(void 0===this.values){for(var o=[],s=0;s<this.length;s++){var a=this.getValue(s);o.push(a)}this.values=o,delete this.offsets,delete this.dataView}for(s=0;s<e.length;s++){var r=t.getValue(s),l=e[s];l===this.length?(this.values.push(r),this.length++):l>this.length||(this.values[l]=r)}this.indexOffset=n},Gn.prototype.sliceDataView=function(t){for(var e=this.offsets[t],n=this.offsets[this.offsets.length-1];0!==this.dataView.getUint8(n++););var i=this.dataView.buffer.slice(e,n);this.dataView=new DataView(i),this.offset=0,this.length=this.length-t,this.offsets.splice(0,t);for(var o=0;o<this.offsets.length;o++)this.offsets[o]-=e;this.indexOffset=0,this.keyIndex=void 0,this.values=void 0},Cn.Symbol=Gn,u=A=A||{},En=u.ipc||(u.ipc={}),jn.u8u16=function(t){for(var e=[],n=0;n<t.length;n++){var i=t.charCodeAt(n);i<128?e.push(i):i<2048?e.push(192|i>>6,128|63&i):i<55296||57344<=i?e.push(224|i>>12,128|i>>6&63,128|63&i):(i=65536+((1023&i)<<10|1023&t.charCodeAt(++n)),e.push(240|i>>18,128|i>>12&63,128|i>>6&63,128|63&i))}return e},jn.listToIPC=function(t){return En.List.toIPC(t.map(function(t){return jn.toIPC(t)}))},jn.toIPC=function(t){var t=t?jn.u8u16(t):[],e=t.length+6,n=En.Util.createBuffer(e);return n.wb(jn.TYPE_NUM),n.wb(0),n.wi(t.length),_.each(t,function(t){return n.wb(t)}),n.data},jn.TYPE_NUM=10,En.QString=jn,Mn=A=A||{},Pn=Mn.ipc||(Mn.ipc={}),In=Pn.I32,e(Xn,In),Xn.fromMoment=function(t){return null===t?null:new Mn.rMonthClass(Math.round(t.diff(h([2e3]),"months",!0)))},Xn.fromScalar=function(t){return null===t?null:new Mn.rMonthClass(t)},Xn.fromString=function(t){if(null===t)return null;t=t.replace(/\./g,"-").replace(/m$/,"");t=h.utc(t);return Xn.fromMoment(t)},Xn.listToIPC=function(t){var e=4*t.length+6,n=Pn.Util.createBuffer(e);return n.wb(Xn.TYPE_NUM),n.wb(0),n.wi(t.length),_.each(t,function(t){return Xn.writeValue(t,n.wb)}),n.data},Xn.toIPC=function(t){var e=Pn.Util.createBuffer(5);return e.wb(256-Xn.TYPE_NUM),Xn.writeValue(t,e.wb),e.data},Xn.toMoment=function(t){var e;return null===t?null:((e=h.tz("2000-01-01","UTC")).add(t.i,"month"),e)},Xn.toScalar=function(t){return null===t?null:t.i},Xn.toString=function(t,e){return void 0===e&&(e="YYYY-MM"),null===t?"":Xn.toMoment(t).format(e)},Xn.writeValue=function(t,e){Pn.Int.writeValue(Xn.toScalar(t),e)},Xn.prototype.getValue=function(t){t=In.prototype.getScalar.call(this,t);return t===Pn.I32.NULL?null:new Mn.rMonthClass(t)},Xn.TYPE_NUM=13,Pn.Month=Xn,An=A=A||{},kn=An.ipc||(An.ipc={}),xn=kn.I32,e(Zn,xn),Zn.fromMoment=function(t){return null===t?null:new An.rSecondClass(t.asSeconds())},Zn.fromScalar=function(t){return null===t?null:new An.rSecondClass(t)},Zn.fromString=function(t){var e=(t=t.replace("1970-01-01T","").replace("Z","")).match(kn.Constants.TIME_PARTS_RX),e=h.duration(e&&e[1]?e[1]:t);return Zn.fromMoment(e)},Zn.listToIPC=function(t){var e=4*t.length+6,n=kn.Util.createBuffer(e);return n.wb(kn.TypeNum.Second),n.wb(0),n.wi(t.length),_.each(t,function(t){return Zn.writeValue(t,n.wb)}),n.data},Zn.toIPC=function(t){var e=kn.Util.createBuffer(5);return e.wb(256-kn.TypeNum.Second),Zn.writeValue(t,e.wb),e.data},Zn.toMoment=function(t){return null===t?null:h.duration(1e3*t.i)},Zn.toScalar=function(t){return null===t?null:t.i},Zn.toString=function(t,e,n){return void 0===e&&(e="HH:mm:ss.SSS"),void 0===n&&(n={trim:!1}),null===t?"":Zn.toMoment(t).format(e,n)},Zn.writeValue=function(t,e){kn.Int.writeValue(Zn.toScalar(t),e)},Zn.prototype.getValue=function(t){t=xn.prototype.getScalar.call(this,t);return t===kn.I32.NULL?null:new An.rSecondClass(t)},kn.Second=Zn,Nn=A=A||{},Ln=Nn.ipc||(Nn.ipc={}),Rn=Ln.I64,e(Jn,Rn),Jn.fromScalar=function(t){return null===t?null:new Nn.rTimespanClass(t)},Jn.fromMoment=function(t){return null===t?null:new Nn.rTimespanClass(t.valueOfNano())},Jn.fromString=function(t){var e,n=(t=t.replace("1970-01-01T","").replace("Z","")).match(Ln.Constants.TIME_PARTS_RX);return n&&n[1]?(-1!==t.indexOf("D")&&(e=t.substring(0,t.indexOf(":")).split("D"),e=Number(e[1])+24*Number(e[0]))&&(n[1]=e+n[1].substring(2)),e=h.duration(n[1]),(n=Number(n[2]||0))&&!_.isNaN(n)&&e.nanoseconds(n)):e=h.duration(t),Jn.fromMoment(e)},Jn.listToIPC=function(t){var e=8*t.length+6,n=Ln.Util.createBuffer(e);return n.wb(Ln.TypeNum.Timespan),n.wb(0),n.wi(t.length),_.each(t,function(t){return Jn.writeValue(t,n.wb)}),n.data},Jn.toIPC=function(t){var e=Ln.Util.createBuffer(9);return e.wb(256-Ln.TypeNum.Timespan),Jn.writeValue(t,e.wb),e.data},Jn.toMoment=function(t){var e;return null===t?null:((e=h.duration((0<t.i?Math.floor:Math.ceil)(t.i/1e6))).nanoseconds(t.i%1e6),e)},Jn.toScalar=function(t){return null===t?null:t.i},Jn.toString=function(t,e,n){return null===t?"":(n=(t=Jn.toMoment(t)).format(e||"HH:mm:ss.SSS",n||{trim:!1}),e?n:n+_.padEnd(""+t.nanoseconds(),6,"0"))},Jn.writeValue=function(t,e){Ln.QLong.writeValue(t?Jn.toScalar(t).toFixed(0):null,e)},Jn.prototype.getValue=function(t){t=this.getLegacyScalar(t),t="bigint"==typeof t||"number"==typeof t?Nn.Long.fromString(t.toString()):t;return t.equals(Ln.I64.LONG_NULL)?null:new Nn.rTimespanClass(Number(t.toString()))},Ln.Timespan=Jn,qe=A=A||{},Vn=qe.ipc||(qe.ipc={}),On=Vn.U8,e(ti,On),ti.prototype.getValue=function(t){return this.getScalar(t)},Vn.Unary=ti,Ye=A=A||{},Bn=Ye.ipc||(Ye.ipc={}),ei.toIPC=function(t,e){var n=_.sumBy(t,function(t){return t.length+1})+7+e.length,i=Bn.Util.createBuffer(n);return i.wb(99),i.wb(11),i.wb(0),i.wi(t.length),_.each(t,function(t){return Bn.Symbol.writeValue(t,i.wb)}),_.each(e,function(t){return i.wb(t)}),i.data},ei.prototype.getKey=function(t){return this.keys.getValue(t)},ei.prototype.getValue=function(t){return this.values.getValue(t)},ei.prototype.toObject=function(){for(var t={},e=0;e<this.length;e++)t[this.getKey(e)]=this.getValue(e);return t},ei.prototype.toLegacy=function(){var e=this,n=new Bn.Table;return 99===this.qtype?(n.addParsedColumn("Property",this.keys),n.addParsedColumn("Value",this.values)):_.times(this.keys.length,function(t){n.addParsedColumn(e.keys.toLegacy(t),e.values.getValue(t))}),n.toLegacy()},ei.prototype.toViewState=function(){for(var t={},e=0;e<this.length;e++)t[this.getKey(e)]=this.values.toViewState(e);return{_type:"dict",value:t}},Ye=ei,(Bn.Dict=Ye).prototype.qtype=99,Ke=A=A||{},$n=Ke.ipc||(Ke.ipc={}),ni.toLegacy=function(t,i,o){for(var e=0<i.length?o[i[0]].length:0,s=new Array(e),n=0;n<e;n++)!function(e){var n=new Object;i.forEach(function(t){return n[t]=o[t].toLegacy(e)}),s[e]=n}(n);return{class:"203",columns:i.slice(0),meta:_.clone(t),rows:s}},ni.prototype.addColumn=function(t,e,n){this.columns.push(t),this.meta[t]=e.qtype,this.cols[t]=$n.Parse.col(e,n)},ni.prototype.addParsedColumn=function(t,e){this.columns.push(t),this.meta[t]=e.qtype,this.cols[t]=e},ni.prototype.merge=function(e){var n=this;return this.columns=this.columns.concat(e.columns),e.columns.forEach(function(t){n.meta[t]=e.meta[t],n.cols[t]=e.cols[t]}),this},ni.prototype.toLegacy=function(){return ni.toLegacy(this.meta,this.columns,this.cols)},ni.prototype.toViewState=function(){return{_type:"table",value:this.toLegacy()}},Ke=ni,($n.Table=Ke).prototype.qtype=98,Un=A=A||{},p=Un.ipc||(Un.ipc={}),ii.col=function(t,e){var n;return-11===t.qtype?new p.Symbol(1,[t.offset],e):11===t.qtype?new p.Symbol(t.offsets.length,t.offsets,e):0===t.qtype?new p.List(t.values,t.end,e):101===t.qtype?new p.Unary(1,t.offset,e):98===t.qtype||99===t.qtype?ii.table(t,e):101===t.qtype?new p.Unary(1,t.offset,e):(n=ii.VECTOR_COLUMN_CLASSES[Math.abs(t.qtype)])?t.qtype<0?new n(1,t.offset,e):new n(t.length,t.offset,e):null},ii.dict=function(t,e){var n=ii.col(t.keys,e),e=ii.col(t.values,e);return new p.Dict(n.length,n,e,t.qtype)},ii.flipDict=function(t,e){var n=ii.col(t.keys,e),i=ii.col(t.values,e);return new p.Table(_.times(n.length,function(t){return n.toLegacy(t)}),_.times(i.length,function(t){return i.getValue(t)}),e)},ii.reshape=function(t,e){var n=t.qtype,i=new DataView(e);if("com.fd.business.querymanager.subscriptions.StreamingSubscription"===t.class||"210"===t.class||"207"===t.class)return t;e=ii.table(t,i);if(e&&98===e.qtype)return e;var o=new p.Table;if(-20<n&&n<0){e=ii.TYPE_NAMES[-n]||"unknown";o.addColumn(e,-11===n?new Un.qSymList(!0,[t.offset]):new Un.qVector(-n,!0,1,t.offset),i)}else if(99===n){e=t;o.addColumn("Property",e.keys,i),o.addColumn("Value",e.values,i)}else if(10===n){var s=t;o.addColumn("string",new Un.qGenericList(!0,[s],s.offset+s.length*Un.getTypeSize(s.qtype)),i)}else if(0===n)t.values.forEach(function(t,e){null!==t&&(e=(10===t.qtype?"string":ii.TYPE_NAMES[Math.abs(t.qtype)]||"unknown")+e,t.qtype<0?o.addColumn(e,-11===t.qtype?new Un.qSymList(!0,[t.offset]):new Un.qVector(-t.qtype,!0,1,t.offset),i):o.addColumn(e,10!==t.qtype&&t.qtype<=19?t:new Un.qGenericList(!0,[t],10===t.qtype?t.offset+Un.getTypeSize(t.qtype)*t.length:t.offset),i))});else if(11===n){var a=t;a.offsets.forEach(function(t,e){o.addColumn((ii.TYPE_NAMES[a.qtype]||"unknown")+e,new Un.qSymList(!0,[t]),i)})}else{if(!(0<=n&&n<20)){if(101===n)return o;throw"Unsupported Root Object"}for(var s=t,r=Un.getTypeSize(s.qtype),l=0;l<s.length;l++)o.addColumn((ii.TYPE_NAMES[s.qtype]||"unknown")+l,new Un.qVector(s.qtype,!0,1,s.offset+r*l),i)}return o},ii.table=function(t,e){if(98===t.qtype)return ii.flipDict(t,e);if(99===t.qtype){var n,i,o,s=t;if(98!==s.values.qtype)return ii.dict(t,e);if(98===s.keys.qtype)return t=ii.flipDict(s.keys,e),n=ii.flipDict(s.values,e),t.merge(n);if(11===s.keys.qtype&&11===s.values.keys.qtype)return i=ii.col(s.values.keys,e),t=["key"].concat(_.times(i.length,function(t){return i.toLegacy(t)})),o=ii.col(s.values.values,e),new p.Table(t,[s.keys].concat(_.times(o.length,function(t){return o.getValue(t)})),e);throw"Unsupported nested table/dict"}},ii.TYPE_NAMES=["list","boolean","guid",void 0,"byte","short","int","long","real","float","char","symbol","timestamp","month","date","datetime","timespan","minute","second","time"],ii.VECTOR_COLUMN_CLASSES=[null,p.Boolean,p.Guid,null,p.Byte,p.Short,p.Int,p.QLong,p.Float,p.Double,p.Char,null,p.Timestamp,p.Month,p.QDate,p.DateTime,p.Timespan,p.Minute,p.Second,p.Time],p.Parse=ii,g=A=A||{},qn=function(t,e,n,i,o,s,a){this.maxResults=2147483647,this.timestamp=(new Date).getTime(),this.op=t,this.connectionId=e,this.query=n,i&&(this.maxResults=i),this.success=o,this.error=s,this.host=a},g.DCRequest=qn,m.createLog=function(t,e,n){},m.getQueryData=function(t,e,n,i,o,s,a,r,l){m.getQueryData2(t,e,n,i,m.legacyRowCallback(o),s,a,r,l)},m.getQueryData2=function(t,e,n,i,o,s,a,r,l){r&&g.Log.Error("Paging not supported in lite"),"sql"===t&&g.Log.Error("SQL not supported in lite");r=this.parametersToString(i);r&&(n=n+"["+r+"]"),l&&l.trigger("serverStart"),m.client.send(2,a,e,n,function(t,e,n){n&&l&&(l.set("serverStart",n[0]),l.set("serverEnd",n[1])),o(t,e)},s)},m.parametersToString=function(t){var n,e="";return _.isEmpty(t)||(n=[],_.each(t,function(t,e){n.push(g.RTTI.getByName(t.type).toKDBInput(t.value))}),e=n.join(";")),e},m.parametersToIPC=function(t){function n(t){var e=m.deltaNameMap[t.type];if(e)return"list"===t.type?g.ipc.Symbol.listToIPC(t.value.map(function(t){return _.isNil(t)?"":t.toString()})):e.toIPC(g.ipc.fromString(e,t.value));throw"Unsupported param type: "+t.type}var i=[];return _.isEmpty(t)||_.each(t,function(t,e){"dict"===t.type?i.push(g.ipc.Dict.toIPC(_.map(t.value,function(t,e){return e}),g.ipc.List.toIPC(_.map(t.value,n)))):"list"===t.type?i.push(g.ipc.Symbol.listToIPC(t.value.map(function(t){return _.isNil(t)?"":t.toString()}))):i.push(n(t))}),g.ipc.List.toIPC(i)},m.runAnalytic=function(t,e,n,i,o,s,a,r){m.runAnalytic2(t,e,n,function(t,e){var t=g.ipc.Parse.reshape(t,e),n=t.toLegacy();return delete t.cols,e=null,i(n)},o,s,null,r)},m.runAnalytic2=function(t,e,n,i,o,s,a,r){n&&_.values(n).length||(n=[{type:"symbol",value:null}]),m.client.send(2,s,e,[{type:"symbol",value:t}].concat(_.values(n)),function(t,e,n){n&&r&&(r.set("serverStart",n[0]),r.set("serverEnd",n[1])),i(t,e)},o)},m.runAPI=function(t,e,n,i,o,s,a,r){n&&_.values(n).length||(n=[{type:"symbol",value:null}]),m.client.send(1,s,e,[{type:"symbol",value:t}].concat(_.values(n)),function(t,e){var t=g.ipc.Parse.reshape(t,e),n=t.toLegacy();return delete t.cols,e=null,i(n)},o)},m.runAPI_InsightsSDK=function(t,e,n){m.client.send(1,void 0,"gw",[{type:"symbol",value:".api.callInsightsSDK"}].concat(t||[]),e,n)},m.getDeltaAnalytics=function(e,t){m.runAnalytic(g.KdbQuery.getFunctions,t,[],function(t){return e(_.map(t.rows,function(t){return t.parameters=t.parameters.rows,t.name=".api."+t.name,t}))},function(){})},m.legacyRowCallback=function(n){return function(t,e){n&&(e&&e.byteLength&&(t.dataSet?t.dataSet=g.ipc.Parse.reshape(t.dataSet,e).toLegacy():t=g.ipc.Parse.reshape(t,e).toLegacy()),n(t))}},m.updateTable=function(n,t,e){for(var i=[],o=0;o<3;o+=1)i[o]={type:"dict",value:{},index:o};_.each(i,function(t,e){t.index=e}),_.each(n.addedDict.items,function(t,e){i[0].value[e]={type:m.updateTableGetListType(n.typeConfig[e],t),value:t}}),_.each(n.updatedDict.items,function(t,e){i[1].value[e]={type:m.updateTableGetListType(n.typeConfig[e],t),value:t}}),_.each(n.deletedDict.items,function(t,e){i[2].value[e]={type:m.updateTableGetListType(n.typeConfig[e],t),value:t}}),"analytic"===n.updateType?n.updateAnalytic&&m.runAnalytic(n.updateAnalytic,n.connection,i,t,e):m.getQueryData("kdb",n.connection,n.query,i,t,e)},m.updateTableGetListType=function(t,e){var n;switch(t){case 0:return n=_.isArray(e)?_.isBoolean(e[0])?"listlistboolean":_.isString(e[0])?"listliststring":"listlistsymbol":_.isString(e)?"string[]":"symbol[]";case 1:return"boolean[]";case 2:return"guid[]";case 4:return"byte[]";case 5:return"short[]";case 6:return"int[]";case 7:return"long[]";case 8:return"real[]";case 9:return"float[]";case 10:return n="char[]",_.each(e,function(t){1<t.length&&(n="string[]")}),n;case 11:return"symbol[]";case 12:return"timestamp[]";case 13:return"month[]";case 14:return"date[]";case 15:return"datetime[]";case 16:return"timespan[]";case 17:return"minute[]";case 18:return"second[]";case 19:return"time[]";default:return"symbol[]"}},m.prototype.destroy=function(){if(this.ws)try{this.ws.onopen=_.noop.bind(this),this.ws.onclose=_.noop.bind(this),this.ws.onmessage=_.noop.bind(this),this.ws.close(),this.ws=null}catch(t){this.ws=null}},m.prototype.send=function(t,e,n,i,o,s){return this.sendRequest(new qn(t,n,i,e,o,s,location.host))},m.prototype.subscribe=function(t,e,n,i,o,s){if(void 0===s){var a=void 0,r=/^(`[a-zA-Z]\w+)+$/gm;if(e.match(/^\((`\$"([^"]+)")(;`\$"([^"]+)")*\)$/gm))a=e.match(/`\$"([^"]+)"/g).map(function(t){return t.substring(3,t.length-1)});else{if(!e.match(r))return void o('Enter stream query as a symbol list in the form: (`$"symA";`$"symB")');a=e.match(r).map(function(t){return t.substring(1,t.length)})}s=(1<a.length?a.slice(1):[]).map(function(t){return{type:"symbol",value:t}})}return _.first(s)||s.push({type:"symbol",value:null}),s.splice(0,0,{type:"symbol",value:e}),this.send(3,-t,n,s,i,o)},m.prototype.unsubscribe=function(t){delete this.requests[t],this.sendRequest(new qn(4,null,null,_.noop.bind(this),_.noop.bind(this)),t)},m.prototype.heartbeat=function(){this.ws?this.sendRequest(new qn(0)):this.init()},m.prototype.init=function(){try{var t="file:"===location.protocol?"ws://localhost:10001/":("https:"===location.protocol?"wss://":"ws://")+location.host+"/api/ws";g.Log.Log(m.SOCK+t),this.ws=new WebSocket(t),this.ws.binaryType="arraybuffer",this.ws.onopen=this.onWsOpen.bind(this),this.ws.onclose=this.onWsClose.bind(this),this.ws.onerror=this.onWsError.bind(this),this.ws.onmessage=this.onWsMessage.bind(this)}catch(t){g.Log.Log(m.SOCK+"Create Err",t)}this.debouncedHeartbeat()},m.prototype.commonDiacriticsStrToOctal=function(t){var e=new TextEncoder;for(var n,i="",o=0,s=t;o<s.length;o++){var a=s[o];"".includes(a)?i+=(n=a,n=e.encode(n),(0<(n=Array.from(n,function(t){return t.toString(8).padStart(3,"0")})).length?"\\":"")+n.join("\\")):i+=a}return i},m.prototype.sendRequest=function(e,n){function t(t,e){return e.push(g.ipc.Symbol.toIPC(t.connectionId)),e.push(g.ipc.List.toIPC([g.ipc.Int.toIPC(t.maxResults),"string"==typeof t.query?g.ipc.Char.listToIPC(l.commonDiacriticsStrToOctal(t.query).split("")):t.query instanceof Array?m.parametersToIPC(t.query):t.query])),e.push(g.ipc.Char.listToIPC(l.commonDiacriticsStrToOctal(t.host).split(""))),e}var i,o,s,a,r,l=this,u=(n=n||this.requestId++,this.requests[n]=e,[g.ipc.Int.toIPC(this.httpOn?0:n),g.ipc.Int.toIPC(e.op)]);switch(e.op){case 3:if(this.insightsAPI||!e.query||![2,3].includes(e.query.length))throw new Error("Client: Unsupported Operation");case 1:case 2:this.worker&&!this.httpOn?(r=t(e,[n,e.op]),(!window.SharedWorker||"FSBL"in window?this.worker:this.worker.port).postMessage(r)):((i=new XMLHttpRequest).onprogress=function(t){t.lengthComputable&&(t=t.loaded/t.total*100,g.Log.Log("DashClient download: "+t+"%"))},i.onload=function(){delete l.requests[n],500===i.status?e.error(g.u16u8(new Uint8Array(i.response,Math.min(i.response.byteLength,14)))):i.response&&10<=i.response.byteLength?e.success(g.deserialize(i.response),i.response,[e.timestamp,Date.now()]):e.error("Invalid response")},i.onerror=function(t){delete l.requests[n],e.error("Network failure")},o=location.protocol+"//"+location.host+"/",s="object"==typeof e.query&&(null==(s=e.query[0])?void 0:s.value)===g.KdbQuery.executeSql,this.insightsAPI&&2===e.op&&("string"==typeof e.query||s)?(o+="servicegateway/sandbox/"+encodeURIComponent(e.connectionId)+(s?"/sql":"/qsql"),a=JSON.stringify({query:s?e.query[1].value:e.query,maxResults:Number(e.maxResults)}),i.open("POST",o,!0),i.responseType="arraybuffer",i.send(a)):(a=g.ipc.Util.toMessage(g.ipc.List.toIPC(t(e,u)))).byteLength<2048?(i.open("GET",o+"api/"+btoa(a.reduce(function(t,e){return t+String.fromCharCode(e)},"")).replace(/\//g,"+"),!0),i.responseType="arraybuffer",i.send()):(i.open("POST",o,!0),i.responseType="arraybuffer",i.send(a)));break;case 4:this.ws&&this.ws.readyState===WebSocket.OPEN?this.ws.send(g.ipc.Util.toMessage(g.ipc.List.toIPC(t(e,u)))):this.worker&&!this.httpOn&&(r=[n,e.op],(!window.SharedWorker||"FSBL"in window?this.worker:this.worker.port).postMessage(r));break;case 0:this.ws&&this.ws.readyState===WebSocket.OPEN&&(this.ws.send(g.ipc.Util.toMessage(g.ipc.List.toIPC(t(e,u)))),this.debouncedHeartbeat());break;default:throw new Error("Client: Unsupported Operation")}return n},m.prototype.onDisconnect=function(t){g.Log.Log("DashClient Disconnect",t),$(this).trigger("DeltaClientDisconnect",t)},m.prototype.onOpen=function(t){g.Log.Log("DashClient Connect"),$(this).trigger("DeltaClientConnect"),g.Log.Log("DashClient Login"),$(this).trigger("DeltaClientLogin")},m.prototype.onWorkerError=function(t){g.Log.Log(m.WORK+"error",t),this.onDisconnect(t)},m.prototype.onWsClose=function(t){g.Log.Log(m.SOCK+"Closed",t),this.destroy()},m.prototype.onWsError=function(t){g.Log.Log(m.SOCK+"Error",t),this.onDisconnect(t),this.destroy()},m.prototype.onWsMessage=function(t){if(t.data instanceof Array){if(6===t.data[0])return void(t.data[1]===WebSocket.OPEN?this.onOpen(null):this.onWorkerError(t.data[2]||"ws not open"));if(5===t.data[0])return this.onWorkerError(t.data[1])}var e=g.deserialize(t.data,8,!0),n=e[0],i=e[1],o=this.requests[n];o?(3!==o.op&&delete this.requests[n],2!==o.op&&1!==o.op&&3!==o.op||(5===i?(i=e[2],o.error(g.u16u8(new Uint8Array(t.data,i.offset,i.length)))):(i=this.httpOn&&3!==o.op?Date.now():new Float64Array(t.data,0,1)[0],o.success(e[2]||{},t.data,[o.timestamp,i])))):g.Log.Warn('Stray Response "'+n+'"')},m.prototype.onWsOpen=function(t){console.log("websocket open",t),this.ws.readyState===WebSocket.OPEN?(g.Log.Log(m.SOCK+"Open",t),this.onOpen(t)):(g.Log.Log(m.SOCK+"Open Error",t),this.onDisconnect(t))},m.SOCK="Socket ",m.WORK="Worker ",m.deltaNameMap={boolean:g.ipc.Boolean,guid:g.ipc.Symbol,byte:g.ipc.Byte,short:g.ipc.Short,int:g.ipc.Int,long:g.ipc.QLong,real:g.ipc.Float,float:g.ipc.Double,char:g.ipc.Char,symbol:g.ipc.Symbol,timestamp:g.ipc.Timestamp,month:g.ipc.Month,date:g.ipc.QDate,datetime:g.ipc.DateTime,timespan:g.ipc.Timespan,minute:g.ipc.Minute,second:g.ipc.Second,time:g.ipc.Time,string:g.ipc.QString,list:g.ipc.List},g.DashClient=m,Fn=A=A||{},oi.prototype.notifyAllLegacyChange=function(e,n,i,o){var s=this;_.each(this.legacySubscribers,function(t){return s.notifyChange(t,e,n,i,o)})},oi.prototype.notifyAllRawChange=function(e,n,i,o){var s=this;_.each(this.rawSubscribers,function(t){return s.notifyChange(t,e,n,i,o)})},oi.prototype.notifyChange=function(t,e,n,i,o){this.callSubscriber(t,t.onData,e,n,i,o)},oi.prototype.getSubscribers=function(){return _.union(_.keys(this.legacySubscribers),_.keys(this.rawSubscribers))||[]},oi.prototype.subscribe=function(t,e,n){n=n?this.rawSubscribers:this.legacySubscribers;return!n[t]&&(n[t]=e,!0)},oi.prototype.subscriberCount=function(){return this.subscriberLegacyCount()+this.subscriberRawCount()},oi.prototype.subscriberLegacyCount=function(){return _.keys(this.legacySubscribers).length},oi.prototype.subscriberRawCount=function(){return _.keys(this.rawSubscribers).length},oi.prototype.unsubscribe=function(t){return this.legacySubscribers[t]?(delete this.legacySubscribers[t],!0):!!this.rawSubscribers[t]&&(delete this.rawSubscribers[t],!0)},oi.prototype.unsubscribeAll=function(){return this.legacySubscribers={},this.rawSubscribers={},!0},oi.prototype.callSubscriber=function(e,t,n,i,o,s){if(t)try{t.apply(e,Array.prototype.slice.call(arguments,2))}catch(t){this.onSubscriberError(e,t)}},oi.prototype.onSubscriberError=function(t,e){Fn.Log.Error("ERROR: Subscriber error!",e)},Fn.Agent=oi,Yn=A=A||{},si.prototype.trigger=function(t){for(var e=1;e<arguments.length;e++)e-1,0},si.prototype.listenTo=function(t,e,n){},si.prototype.stopListening=function(t,e,n){},si.prototype.initialize=function(){this.setSubscription(),this.initializeEvents()},si.prototype.initializeEvents=function(){this.listenTo(this.mappings,"add reset remove",this.onMappingsCollectionChange),this.listenTo(this.mappings,"change:key",this.onMappingItemKeyChange),this.listenTo(this.mappings,"change:viewstate",this.onMappingItemViewStateChange),this.listenTo(this.model,"change:key",this.onMappingKeyChange),this.listenTo(this.model,"change:value",this.onMappingValueChange)},si.prototype.addMapping=function(){var t=this.getPossibleKeys(),e=_.difference(t,this.mappings.map(function(t){return t.get("key")})),e=e?e[0]:t[0]||"",t=_.isString(e)?this.viewState.getByPath(e):"";this.mappings.add({key:e,value:this.getValue(e),viewstate:t||""})},si.prototype.cleanUp=function(){this.stopListening(),this.mappings.reset(),this.setSubscription()},si.prototype.generateValues=function(){this.mappings.each(function(t){t.set("value",this.getValue(t.get("key")))}.bind(this))},si.prototype.getColumns=function(){return this.columns||[]},si.prototype.getPossibleKeys=function(){return this.data?_.keys(this.data):[]},si.prototype.getValue=function(t){return this.data?this.data[t]:void 0},si.prototype.onData=function(t,e,n){var i,o=this.model.get("key"),s=this.model.get("value"),a={},r=[],l=this.mappings.reduce(function(t,e){return t[e.get("key")]=e.get("viewstate"),t},{}),u=e.cols?e.cols[o]?e.cols[o].length:0:(i=e.collection.models.map(function(t){return t.attributes})).length;this.columns=t.columns.collection.map("id"),this.columns.length&&!_.isEqual(this.columns,["unknown0"])&&(this.model.get("key")&&_.includes(this.columns,this.model.get("key"))||this.model.set("key",(_.intersection(this.columns,["k","Key","key"])||[])[0]||this.columns[0]||""),this.model.get("value")&&_.includes(this.columns,this.model.get("value"))||this.model.set("value",(_.intersection(this.columns,["v","Val","val"])||[])[0]||this.columns[1]||""));for(var c=0;c<u;c++){var p=i?i[c][o]:e.cols[o].getValue(c);a[p]=i?Yn.Tools.convertKDBToViewstateValue(i[c][s]):(e.cols[s]&&e.cols[s].toViewState(c)||{}).value,r.push({Key:p,Viewstate:l[p]})}this.data=a,this.trigger("on-data"),_.each(r,function(t){var e=t.Key,e=a[e],t=_.isString(t.Viewstate)?this.viewState.getByPath(t.Viewstate):t.Viewstate&&t.Viewstate.path?this.viewState.getByPath(t.Viewstate.path):null;_.isObject(e)&&_.each(e,function(t){t&&t._type&&(t.type=t._type,delete t._type)}),t&&_.isFunction(t.set)&&!_.isUndefined(e)&&t.setModelValue(e)}.bind(this))},si.prototype.onMappingItemKeyChange=function(t){t.set("value",this.getValue(t.get("key"))),this.setDataModel()},si.prototype.onMappingItemViewStateChange=function(){this.setDataModel()},si.prototype.onMappingKeyChange=function(){this.generateValues(),this.setDataModel(),this.trigger("key-change")},si.prototype.onMappingsCollectionChange=function(){this.setSubscription(),this.setDataModel(),this.trigger("mappings-change")},si.prototype.onMappingValueChange=function(){this.generateValues(),this.setDataModel(),this.trigger("value-change")},si.prototype.removeMapping=function(t){this.mappings.remove(t)},si.prototype.resetMappings=function(){var e=this;this.mappings.reset(_.map(this.getPossibleKeys(),function(t){return new f.Model({key:t,value:e.getValue(t),viewstate:""})})),this.onMappingsCollectionChange()},si.prototype.setDataModel=function(){this.setDataModelMappings(this.toJSON())},si.prototype.setSubscription=function(t){this.mappings.isEmpty()&&!t?this.subscribed&&(this.subscribed=!1,this.unsubscribe(this.subscriptionKey)):this.subscribed||(this.subscribed=!0,this.subscribe(this.subscriptionKey,{onData:this.onData.bind(this)}))},si.prototype.toJSON=function(){return{key:this.model.get("key"),mappings:this.mappings.reduce(function(t,e){var n=e.get("key"),e=e.get("viewstate");return e instanceof Yn.DocumentViewModel?t[n]={_dashboardsType:"viewstate",value:e.path}:t[n]=e,t},{}),value:this.model.get("value")}},Yn.DataMapper=si,ze=A=A||{},ai.prototype.assign=function(t){this.collection=t},ai.prototype.items=function(){return this.reset||_.map(this.collection.models,function(t){return t.attributes})},ze.ChangeSet=ai;var ri=A=A||{},li={1212:!0,1213:!0,1214:!0,1215:!0,1216:!0,1217:!0,1218:!0,1219:!0};function ui(t,e,n){if(null!=t){var i,o;for(o in"object"==typeof t?(i=t,0):(i={})[t]=e,this.changed={},i){var s=this.attributes[o];e=i[o],(s&&e&&"object"==typeof s&&"object"==typeof e?li[s.class]&&li[e.class]?s.i===e.i&&s.n===e.n:_.isEqual(s,e):s===e)||(this.attributes[o]=this.changed[o]=e)}this.idAttribute in i&&(this.id=this.get(this.idAttribute))}return this}function ci(){return!!this.hasChanged()&&this.changed}function S(t){this.breakdownColumns=[],this.columns=new f.Collection,this.columnDict={},this.preferBackground=!1,this.breakdownColumns=[],this.agent=t.agent,this.collection=new t.collectionFunc,this.collectionFunc=t.collectionFunc,this.collection.model.prototype.set=ui,this.collection.model.prototype.changedAttributes=ci,this.idAttribute=t.idAttribute,this.maxRows=Number(t.maxRows),this.showAllRows=""===t.maxRows,this.primaryKey=t.primaryKey||S.DEFAULT_ROW_INDEX,this.lazyLoading=t.lazyLoading||!1,this.applyMaxRowCountLimitOnReset=!!t.applyMaxRowCountLimitOnReset}function pi(t){this.breakdownColumns=[],this.columns=new f.Collection,this.columnDict={},this.breakdownColumns=[],this.agent=t.agent,this.idAttribute=t.idAttribute,this.maxRows=Number(t.maxRows),this.showAllRows=""===t.maxRows,this.primaryKey=t.primaryKey||Hn.DataSet.DEFAULT_ROW_INDEX}f.Model,S.isPerformanceMemoryPropertyPresent=function(){return/Edg|Chrome|OPR/.test(navigator.userAgent)&&window.performance&&window.performance.memory},S.columnsToCollection=function(t){var e=new f.Collection;return e.models=t.map(function(t){var e=new f.Model;return e.id=t.id,e.attributes=t,e}),e.length=t.length,e},S.updateColumns=function(e,t,n,i){var s=[],a=[],o=t.columns||[],t=[];return i||_.isEmpty(e)?(e={},o.forEach(function(t){return e[t.id]=t}),n.reset=o):(o.forEach(function(t){var n,i,o=e[t.id];o?(i=!(n={}),_.each(t,function(t,e){o[e]!==t&&(i=!0,n[e]=t)}),i&&a.push(_.extend(n,{id:t.id}))):s.push(t)}),(t=(i=_.values(e)).length+s.length>o.length?_.reject(i,function(e){return _.find(o,function(t){return t.id===e.id})}):t).forEach(function(t){return delete e[t.id]}),s.forEach(function(t){return e[t.id]=t}),s.length&&(n.add=s),a.length&&(n.change=a),t&&t.length&&(n.remove=t)),e},S.prototype.addOrExtendExisting=function(t,e,n){var i=t[e=_.isObject(e)?e.toString():e];return i?(_.extend(i,n),!1):(t[e]=n,!0)},S.prototype.addSubscribeFunctions=function(t){var e=this;return t.forEach(function(t){var n=e.collection.get(t[e.primaryKey]);n&&(n.subscribe&&(t.subscribe=function(t,e){n.subscribe(t,e)}),n.unsubscribe)&&(t.unsubscribe=function(t){n.unsubscribe(t)})}),t},S.prototype.background=function(){this.preferBackground=!0},S.prototype.cleanUp=function(){this.columnDict={},this.columns=S.columnsToCollection([]),this.collection.reset(),this.visibilityChangeHandler&&document.removeEventListener("visibilitychange",this.visibilityChangeHandler)},S.prototype.flushUpdates=function(){this.tempDataSet&&(this.onDataInternal({breakdownColumns:this.tempDataSet.breakdownColumns,columns:_.values(this.tempDataSet.columnDict),paging:this.tempDataSet.pagingMeta},this.tempDataSet.collection.models.map(function(t){return t.attributes}),this.tempDataSet.forceReset),delete this.tempDataSet,this.preferBackground=!1)},S.prototype.indexArray=function(t){var e,n;if(this.lazyLoading)for(n=this.pagingMeta.startRows,e=0;e<t.length;e+=1,n+=1)t[e][S.DEFAULT_ROW_INDEX]=n;else for(e=0;e<t.length;e+=1)t[e][S.DEFAULT_ROW_INDEX]=e},S.prototype.isBackground=function(){return!this.noBackground&&(this.preferBackground||document.hidden&&!("FSBL"in window))},S.prototype.isEmpty=function(){return!(this.collection&&this.collection.models&&this.collection.models.length)&&(!this.tempDataSet||this.tempDataSet.isEmpty())},S.prototype.setAvailableMemoryThreshold=function(t){this.availableMemoryThreshold=t*Math.pow(1024,2)},S.prototype.getMemoryText=function(t){return(t/=Math.pow(1024,3)).toFixed(2)+" GB"},S.prototype.mergeData=function(t,e,n,i){var o,s,a,r=this,l={},u={},c=[],p=[];if(r.primaryKey===S.DEFAULT_ROW_INDEX&&r.indexArray(t),0===r.collection.length&&0<t.length){if(r.applyMaxRowCountLimitOnReset&&t.length>r.maxRows?t=t.slice(t.length-r.maxRows):0!==r.maxRows||r.showAllRows||(t=[]),t.forEach(function(t){_.isNull(t[r.primaryKey])&&(t[r.primaryKey]=""),c.push(t)}),n.reset=c,r.collection.model&&r.collection.model.prototype.defaults)r.collection.reset(c);else{if(c.length&&S.isPerformanceMemoryPropertyPresent()&&0<this.availableMemoryThreshold){if(this.availableMemoryThreshold>window.performance.memory.jsHeapSizeLimit)throw d=this.getMemoryText(this.availableMemoryThreshold),v=this.getMemoryText(window.performance.memory.jsHeapSizeLimit),S.ERROR_MSG_AVAILABLE_MEMORY_THRESHOLD+" ("+d+") is greater than or equal to the browser's total memory size of "+v+".";for(var d=window.performance.memory.jsHeapSizeLimit-window.performance.memory.usedJSHeapSize,h=c.length,g=Math.max(1,.01*h),m=Math.max(1,Math.round(h/g)),f=0,y=0;f<h;)y=Math.max(y,JSON.stringify(c[f]).length),f+=m;var v,g=y+166,b=new r.collection.model,b=2*((g+=(parseInt(b.cid.substring(1))+c.length).toString().length+1)*c.length);if(b-=c.length/1e6*(50*Math.pow(1024,2)),this.availableMemoryThreshold>d-b)throw v=this.getMemoryText(window.performance.memory.jsHeapSizeLimit),g=window.performance.memory.usedJSHeapSize+b+this.availableMemoryThreshold,d=this.getMemoryText(g),b=window.performance.memory.jsHeapSizeLimit-g,g=this.getMemoryText(b),S.ERROR_MSG_BROWSER_HAS_INSUFFICIENT_MEMORY+"<br><br>+"+v+" Total memory size<br>- "+d+" Memory used + projected requirement<br>=======<br> "+g}r.collection.reset(c.map(function(t){var e=new r.collection.model;return e.attributes=t,e.idAttribute in t&&(e.id=t[e.idAttribute]),e}))}r.addSubscribeFunctions(c)}else{for(o=0;o<t.length;o+=1)s=t[o][r.primaryKey],_.isNull(s)&&(s=t[o][r.primaryKey]=""),s=_.isObject(s)?s.toString():s,!l[s]&&r.collection.get(s)?r.addOrExtendExisting(u,s,t[o]):r.addOrExtendExisting(l,s,t[o])&&c.push(t[o]);b=[],e?b=r.collection.filter(function(t){return s=t.get(r.primaryKey),!(_.has(u,s)||_.has(l,s))}):(v=r.collection.length+c.length,(v-=(b=v>r.maxRows?r.collection.models.slice(0,v-r.maxRows):b).length)>r.maxRows&&(c=c.slice(v-r.maxRows))),b.length&&(r.collection.remove(b),i||(n.remove=_.map(b,function(t){return t.attributes}))),_.each(u,function(t){s=t[r.primaryKey],(a=r.collection.get(s))&&(a.set(t),i||(t=a.changedAttributes())&&(t[r.primaryKey]=s,p.push(t)))}),r.collection.add(c),r.addSubscribeFunctions(c),i||(c.length&&(n.add=c),p.length&&(n.change=p),e&&0===t.length&&!(n.add||n.change||n.remove)&&(n.reset=[]))}},S.prototype.onData=function(t,e,n,i,o){this.isBackground()?(this.tempDataSet||(this.tempDataSet=new S({idAttribute:this.idAttribute,collectionFunc:this.collectionFunc,agent:new ri.Agent,maxRows:this.maxRows,primaryKey:this.primaryKey}),this.tempDataSet.forceReset=!1),this.tempDataSet.onDataInternal(t,e,n,i,void 0,!0),n&&(this.tempDataSet.forceReset=!0)):this.onDataInternal(t,e,n,i,o)},S.prototype.onDataInternal=function(t,e,n,i,o,s){var a,r=new ri.ChangeSet(this.collection),l=new ri.ChangeSet(void 0);if(t&&(_.isUndefined(t.breakdownColumns)||(this.breakdownColumns=t.breakdownColumns),this.columnDict=S.updateColumns(this.columnDict,t,l,s),l.remove)&&(a=l.remove.map(function(t){return t.id}),this.collection.models.forEach(function(e){a.forEach(function(t){delete e.attributes[t],delete e.changed[t]})})),this.pagingMeta=t.paging,e)try{this.mergeData(e,n,r,s),ri.Log.Info("Data: "+this.updateSetCountToString(r,this.collection.models))}catch(t){throw t}s||(t={primaryKey:this.primaryKey,columns:l},e=i||void 0,this.pagingMeta&&(t.paging=this.pagingMeta),_.isArray(this.breakdownColumns)&&(t.breakdownColumns=this.breakdownColumns,t.breakdownColumns instanceof f.Model)&&(t.breakdownColumns=t.breakdownColumns.get("value")),o&&o.trigger("onAgentNotify"),t.columns.assign(this.columns=S.columnsToCollection(_.values(this.columnDict))),this.agent.notifyAllLegacyChange(t,r,e,o))},S.prototype.onDataRefresh=function(t){var e=_.values(this.columnDict),n=new ri.ChangeSet(this.collection),i=new ri.ChangeSet(this.columns),o={};i.reset=e,o={primaryKey:this.primaryKey,columns:i},_.isArray(this.breakdownColumns)&&(o.breakdownColumns=this.breakdownColumns,o.breakdownColumns instanceof f.Model)&&(o.breakdownColumns=o.breakdownColumns.get("value")),this.pagingMeta&&(o.paging=this.pagingMeta),n.reset=this.addSubscribeFunctions(this.collection.map(function(t){return t.attributes})),t?this.agent.notifyChange(t,o,n):this.agent.notifyAllLegacyChange(o,n)},S.prototype.updateSetCountToString=function(t,e){return(t.add?" +"+t.add.length:"")+(t.remove?" -"+t.remove.length:"")+(t.change?" ~"+t.change.length:"")+(t.reset?" ="+t.reset.length:"")+" ==>"+e.length},S.DEFAULT_ROW_INDEX="_rowIndex",S.ERROR_MSG_BROWSER_HAS_INSUFFICIENT_MEMORY="Browser has insufficient memory.",S.ERROR_MSG_AVAILABLE_MEMORY_THRESHOLD="Available Memory Threshold",ri.DataSet=S,Hn=A=A||{},pi.prototype.cleanUp=function(){this.columnDict={},this.columns=Hn.DataSet.columnsToCollection([]),this.cols=void 0},pi.prototype.indexArray=function(t){for(var e=0;e<t.length;e+=1)t[e][Hn.DataSet.DEFAULT_ROW_INDEX]=e},pi.prototype.isEmpty=function(){var t=Object.keys(this.columnDict);return!this.cols||0==t.length||!this.cols[t[0]]||0==this.cols[t[0]].length},pi.prototype.onData=function(t,n,e,i,o){var s,a,r=this,l=new Hn.ChangeSet(this.collection),u=new Hn.ChangeSet(void 0),c={},i=i||void 0;t&&(_.isUndefined(t.breakdownColumns)||(this.breakdownColumns=t.breakdownColumns),this.columnDict=Hn.DataSet.updateColumns(this.columnDict,t,u)),c={primaryKey:this.primaryKey,columns:u},this.pagingMeta=t.paging,this.pagingMeta&&(c.paging=this.pagingMeta),_.isArray(this.breakdownColumns)&&(c.breakdownColumns=this.breakdownColumns,c.breakdownColumns instanceof f.Model)&&(c.breakdownColumns=c.breakdownColumns.get("value")),e||!this.cols?(this.cols=n,this.sliceCols()):null==this.primaryKey||"_rowIndex"===this.primaryKey?(t=n[Object.keys(n)[0]])&&t.length>=this.maxRows?(this.cols=n,this.sliceCols()):(_.each(this.cols,function(t,e){n[e]||delete r.cols[e]}),_.each(n,function(t,e){var n=r.cols[e];n&&t.length<n.length?t.qtype!==n.qtype?Hn.Log.Error("Column '"+e+"': meta mis-match - cannot merge kdb type "+t.qtype+" -> "+n.qtype):n.mergeIndexed(t):r.cols[e]=t})):(e=n[this.primaryKey])&&e.length>=this.maxRows?(this.cols=n,this.sliceCols()):(t=this.cols[this.primaryKey],a=t.mergeKeyedPrimary(e,this.maxRows,s=[]),t.length===this.maxRows&&t.findIndex&&t.findIndex(e.hash(0))>=this.maxRows-e.length&&(l.keyCol=e),_.each(this.cols,function(t,e){n[e]||delete r.cols[e]}),_.each(n,function(t,e){var n;e!==r.primaryKey&&((n=r.cols[e])?n.mergeKeyed(t,s,a,r.maxRows):r.cols[e]=t)})),l.cols=this.cols,u.assign(this.columns=Hn.DataSet.columnsToCollection(_.values(this.columnDict))),this.agent.notifyAllRawChange(c,l,i,o)},pi.prototype.onDataRefresh=function(t){var e=_.values(this.columnDict),n=new Hn.ChangeSet(this.collection),i=new Hn.ChangeSet(this.columns),e=(i.reset=e,{primaryKey:this.primaryKey,columns:i});_.isArray(this.breakdownColumns)&&(e.breakdownColumns=this.breakdownColumns,e.breakdownColumns instanceof f.Model)&&(e.breakdownColumns=e.breakdownColumns.get("value")),this.pagingMeta&&(e.paging=this.pagingMeta),n.cols=this.cols,t?this.agent.notifyChange(t,e,n):this.agent.notifyAllRawChange(e,n)},pi.prototype.sliceCols=function(){var e,n=this,t=Object.keys(this.cols)[0];t&&(e=this.cols[t].length)>this.maxRows&&!this.showAllRows&&_.each(this.cols,function(t){t.sliceDataView(e-n.maxRows)})},pi.prototype.updateSetCountToString=function(t,e){return(t.add?" +"+t.add.length:"")+(t.remove?" -"+t.remove.length:"")+(t.change?" ~"+t.change.length:"")+(t.reset?" ="+t.reset.length:"")+" ==>"+e.length},Hn.DataSet2=pi,(A||(A={})).LegacyUpdate=function(t,e,n,i){this.table=t,this.forceReset=e,this.pagingMeta=n,this.pivotMeta=i};di.prototype.increasePendingCounter=function(t){this.pendingCounter++,this.isDirty=!0,this.isIdle=!1,this.deactivateIdleTimer(),this.log("+",t)},di.prototype.decreasePendingCounter=function(){this.pendingCounter--,this.log("-"),0===this.pendingCounter&&this.activateIdleTimer()},di.prototype.activateIdleTimer=function(){var t=this;this.timerId=setTimeout(function(){t.isIdle=!0,t.log("READY")},this.idleTimeout)},di.prototype.deactivateIdleTimer=function(){void 0!==this.timerId&&(clearTimeout(this.timerId),this.timerId=void 0)},di.prototype.logIt=function(t,e){void 0===t&&(t=""),void 0===e&&(e=""),console.log(this.id,t,this.pendingCounter,e)},di.prototype.log=function(t,e){void 0===t&&(t="")},di.prototype.reset=function(){this.isDirty=!1,this.isIdle=!1,this.pendingCounter=0,this.deactivateIdleTimer(),this.log("RESET","idleTimeout: "+this.idleTimeout+"ms")},di.prototype.getDirtyFlag=function(){return this.isDirty},di.prototype.isReady=function(){return this.isDirty&&0===this.pendingCounter&&this.isIdle},di.prototype.toggleLogging=function(t){this.log=t?this.logIt:_.noop};c=di;function di(t,e){void 0===e&&(e=500),this.id=t,this.idleTimeout=e,this.pendingCounter=0,this.isDirty=!1,this.isIdle=!1}no.init=function(t){var e=location.href;t&&0<=e.indexOf("print=pdf")?(this.isActive=!0,document.body.classList.add("pdf"),window.KXisReadyForPrinting=this.isReadyForPrinting.bind(this),this.devMode=0<=e.indexOf("print=pdfdev"),this.devMode&&(this.toggleLogging(!0),$("head").append("\n                    <style>\n                        body::-webkit-scrollbar {\n                            width: 0; height: 0;\n                        }\n                    </style>\n                "))):(this.isActive=!1,this.toggleLogging(!1))},no.increaseDataPendingCounter=function(t){this.isActive&&this.dataTracker.increasePendingCounter(t)},no.decreaseDataPendingCounter=function(){this.isActive&&this.dataTracker.decreasePendingCounter()},no.increaseAppPendingCounter=function(t){this.isActive&&this.appTracker.increasePendingCounter(t)},no.decreaseAppPendingCounter=function(){this.isActive&&this.appTracker.decreasePendingCounter()},no.hasExpandableTabPanelInTopLevel=function(t){var e=!1,t=_.get(t,"attributes.widgets.models[0].attributes.component");return e="Tabs"===(null==t?void 0:t.get("key"))?!0===t.get("options").get("Selection.expandOnPdf"):e},no.reset=function(t){var e,n=this;this.isActive&&(e="pdf-flow-layout",this.hasExpandableTabPanelInTopLevel(t)?document.documentElement.classList.add(e):document.documentElement.classList.remove(e),this.appTracker.reset(),this.dataTracker.reset(),this.devMode)&&(this.devModeLoopId&&clearInterval(this.devModeLoopId),this.devModeLoopId=setInterval(function(){n.isReadyForPrinting()&&(console.log("KX PRINTING READY"),clearInterval(n.devModeLoopId))},100))},no.isReadyForPrinting=function(){if(this.appTracker.isReady()){if(this.dataTracker.isReady())return!0;this.dataTracker.getDirtyFlag()||(this.increaseDataPendingCounter("KX_Forced_DataSource"),this.decreaseDataPendingCounter())}return!1},no.toggleLogging=function(t){this.appTracker.toggleLogging(t),this.dataTracker.toggleLogging(t)},no.appTracker=new c("KXapp",0),no.dataTracker=new c("KXdata",500),no.isActive=!1,no.devMode=!1;var hi,gi,mi,fi,yi,vi,bi,Si,wi,_i,Ti,Ci,Di,Ei,Mi,Pi,Ii,Ai,ki,xi,Ni,Li,Ri,Vi,Oi,Bi,$i,Ui,qi,Fi,Yi,y,Hi,Ki,Qi,zi,v,Wi,Gi,w,ji,Xi,Zi,Ji,to,eo=no;function no(){}function io(t){this.isWebSocketOpen=!1,this.LOG_PREFIX="KXIstream ",this.ENABLE_PING=!1,this.webSocketUrl=t,io.INSTANCES_COUNTER++}hi=A=A||{},io.prototype.initialize=function(){var t=this,e=(this.pendingRequests=[],this.processedRequests=new Map,this.usedCids=new Map,hi.Log.Log(this.LOG_PREFIX+(new Date).toISOString()+" ws init, url:"+this.webSocketUrl),new WebSocket(this.webSocketUrl));this.ws=e,this.ws.binaryType="arraybuffer",this.ENABLE_PING&&(this.sendPingDebounced=_.debounce(this.sendPing,15e3)),this.ws.onopen=function(){hi.Log.Log(t.LOG_PREFIX+(new Date).toISOString()+" ws.onopen"),t.ws?(t.isWebSocketOpen=!0,t.processPendingRequests(),t.sendPingDebounced&&t.sendPingDebounced()):e.close()},this.ws.onclose=function(){var t;hi.Log.Log(this.LOG_PREFIX+(new Date).toISOString()+" ws.onclose",arguments),(this.ws=null)!=(t=this.sendPingDebounced)&&t.cancel(),0===this.pendingRequests.length&&1===this.processedRequests.size&&(t=this.processedRequests.values().next().value,_.get(t,"requestJson.type")===gi.subsnap)&&t.errorFn("Stream closed, please check if the pipeline is running.")}.bind(this),this.ws.onerror=function(){var t;hi.Log.Log(this.LOG_PREFIX+(new Date).toISOString()+" ws.onerror",arguments),this.pendingRequests.length&&_.get(t=this.pendingRequests[0],"requestJson.type")===gi.subsnap&&t.errorFn('Stream not found, please check if the pipeline is running or you are not missing required role: "insights.query.stream".')}.bind(this),this.ws.onmessage=function(t){hi.Log.Log(this.LOG_PREFIX+(new Date).toISOString()+" ws.onmessage",arguments),this.sendPingDebounced&&this.sendPingDebounced(),this.processMessage(t)}.bind(this)},io.prototype.sendPing=function(){this.ws?(hi.Log.Log(this.LOG_PREFIX+(new Date).toISOString()+" heartbeat"),this.ws.send(new Uint8Array(0)),this.sendPingDebounced&&this.sendPingDebounced()):hi.Log.Log(this.LOG_PREFIX+(new Date).toISOString()+" heartbeat not sent")},io.prototype.processMessage=function(t){var e,n,i,o,s=this,a=null;t.data instanceof ArrayBuffer?(a=t.data,e=this.decodeArrayBuffer(a)):(e=JSON.parse(t.data)).id=e.id.toString(),hi.Log.Log(this.LOG_PREFIX+"ws.onmessage "+e.type+" "+e.id),e.type===mi.error&&(n=io.WEBSOCKET_ERROR_MESSAGES[e.error],hi.Log.Error(this.LOG_PREFIX+"ws.onmessage: error code "+n,t),null!=(i=this.processedRequests.get(e.id)))&&i.errorFn("Streaming Error: "+n),e.type===mi.subsnapped?(hi.Log.Log(this.LOG_PREFIX+"ws.onmessage subsnapped",e.payload.subscription),i=this.processedRequests.get(e.id),this.usedCids.set(i.ddm.cid,e.payload.subscription),i.successFn(this.processStreamingResponse(e),a)):e.type===mi.update?(hi.Log.Log(this.LOG_PREFIX+"ws.onmessage update",e.payload.subscription),(i=this.processedRequests.get(e.id))?i.successFn(this.processStreamingResponse(e),a):hi.Log.Log(this.LOG_PREFIX+"ws.onmessage update, already unsubscribed",e)):e.type===mi.unsubscribed&&(hi.Log.Log(this.LOG_PREFIX+"ws.onmessage unsubscribed",e.payload.subscription),o=this.processedRequests.get(e.id),this.usedCids.delete(o.ddm.cid),this.processedRequests.forEach(function(t,e){t.ddm===o.ddm&&s.processedRequests.delete(e)}),this.processPendingRequests(o.ddm))},io.prototype.decodeArrayBuffer=function(t){for(var e=hi.deserialize(t,8,!1),n=hi.ipc.Parse.reshape(e,t),i={},o=0;o<n.cols.Property.length;o++){var s=n.cols.Value.getValue(o);if(s instanceof hi.ipc.Dict){for(var a=s,r={},l=0;l<a.length;l++){var u=a.getKey(l);r[u]="data"===u?a.values.values[l]:"subscription"===u?a.getValue(l).getValue(0):a.getValue(l)}s=r}else s=s.getValue(0);i[n.cols.Property.getValue(o)]=s}return i},io.prototype.processRequest=function(t){hi.Log.Log(this.LOG_PREFIX+"ws.send "+JSON.stringify(t.requestJson)),this.ws.send(JSON.stringify(t.requestJson)),this.processedRequests.set(t.requestJson.id.toString(),t)},io.prototype.processPendingRequests=function(e){if(e){var t=this.pendingRequests.findIndex(function(t){return t.ddm===e});0<=t&&(n=this.pendingRequests.splice(t,1)[0],this.processRequest(n))}else for(;this.pendingRequests.length;){var n=this.pendingRequests.shift();this.processRequest(n)}},io.prototype.processStreamingResponse=function(t){var i,e,o=t.payload.data,n=null;return o instanceof hi.qDict?n=o:(t=(i=_.keys(o)).length?o[i[0]]:[],(n={columns:i,meta:_.reduce(i,function(t,e){return t[e]=io.META_COLUMN_TYPE_SYMBOL,t},{}),rows:t.map(function(t,e){var n={};return i.forEach(function(t){n[t]=o[t][e]}),n})}).rows.length&&(e=n.rows[0],i.forEach(function(t){_.isNumber(e[t])&&(n.meta[t]=io.META_COLUMN_TYPE_FLOAT)}))),n},io.prototype.createNewRequestId=function(){return _.uniqueId()},io.prototype.createRequest=function(t,e,n,i,o){return{ddm:e,requestJson:{type:t,id:Number(this.createNewRequestId()),payload:n},successFn:i,errorFn:o}},io.prototype.sendRequest=function(e,t,n,i){t=this.createRequest(gi.subsnap,e,t,n,i);this.isWebSocketOpen?this.usedCids.has(e.cid)?(n=this.createRequest(gi.unsubscribe,e,{subscription:this.usedCids.get(e.cid)},n,i),this.processRequest(n),this.pendingRequests=this.pendingRequests.filter(function(t){return t.ddm!==e}),t.requestJson.id=Number(this.createNewRequestId()),this.pendingRequests.push(t)):this.processRequest(t):(this.ws||this.initialize(),this.pendingRequests=this.pendingRequests.filter(function(t){return t.ddm!==e}),this.pendingRequests.push(t))},io.prototype.clear=function(){var t;this.ws&&(io.INSTANCES_COUNTER--,1===this.ws.readyState&&this.ws.close(),this.ws=void 0,1===this.processedRequests.size)&&hi.Log.Log(this.LOG_PREFIX+"ws closed "+this.processedRequests.keys().next().value),null!=(t=this.processedRequests)&&t.clear(),null!=(t=this.usedCids)&&t.clear(),this.pendingRequests=[],this.isWebSocketOpen=!1,null!=(t=this.sendPingDebounced)&&t.cancel()},io.prototype.destroy=function(){this.clear()},io.INSTANCES_COUNTER=0,io.WEBSOCKET_ERROR_MESSAGES={20:"20: No type",21:"21: Payload not present",22:"22: Payload invalid",28:"28: Bad or no id provided",29:"29: id is equal to or less than the last one seen on this connection",42:"42: Already subscribed",43:"43: Not subscribed",61:"Incorrect data type received",62:"Failed to provide all required inputs. Expected:topic,subTopic,uuid,subType.",63:"Provided table does not exist for subscription",64:"Not all filters provided as valid keyed tables"},io.META_COLUMN_TYPE_FLOAT=9,io.META_COLUMN_TYPE_SYMBOL=11,hi.StreamManager=io,(n=gi=gi||{}).subsnap="subsnap",n.unsubscribe="unsubscribe",(n=mi=mi||{}).subsnapped="subsnapped",n.update="update",n.unsubscribed="unsubscribed",n.error="error",(A||(A={})).ViewStateBinding=function(t,e){this.callback=t,this.model=e},((i=A=A||{}).Dash||(i.Dash={})).DATA_SOURCE_insightsSDK="insightsSDK",f.emulateHTTP=!0;var oo=A=A||{};so=f.Model,e(lo,so),lo.prototype.defaults=function(){return{name:"default",type:"q",host:"localhost",port:"80",tls:"false",user:"",password:""}},lo.prototype.isTargeting_insightsSDK=function(){return this.get("type")===oo.Dash.DATA_SOURCE_insightsSDK};var so,ao,ro=lo;function lo(){return null!==so&&so.apply(this,arguments)||this}function uo(){var t=null!==ao&&ao.apply(this,arguments)||this;return t.model=ro,t}function co(t){var e=yi.call(this,t)||this;return e.options=t,e.setSchema(),e}function po(e){var n,t=Si.call(this,e)||this,i=t.get("children");return i&&!_.isArray(i)||(n=new f.Collection,_.each(i||[],function(t){_.extend(t,{appModel:e.appModel}),t=new(t.hasOwnProperty("children")?po:bi.RuleModel)(t),n.add(t)}),t.set("children",n)),0<t.get("children").length&&t.set("active",!0,{silent:!0}),t.listenTo(t.get("children"),"add remove reset change",function(){0<t.get("children").filter(function(t){return t.get("active")}).length?t.set("active",!0):t.set("active",!1),t.trigger("change")}),t}function ho(){return null!==Ti&&Ti.apply(this,arguments)||this}function go(t){this.id=t.id,this.group=t.group,t.meta&&(this.meta=t.meta),"result"!==this.group&&(this.data=t.data||{})}function mo(){return null!==Pi&&Pi.apply(this,arguments)||this}function fo(){return null!==Ai&&Ai.apply(this,arguments)||this}function yo(){return null!==Ni&&Ni.apply(this,arguments)||this}function vo(t){t=Ri.call(this,t)||this;return _.isEmpty(t.data)&&(t.data={fn:"lj",swap:!1,left:[],right:[]}),t}function bo(){return null!==Oi&&Oi.apply(this,arguments)||this}function So(){return null!==Ui&&Ui.apply(this,arguments)||this}function wo(){var t=null!==Yi&&Yi.apply(this,arguments)||this;return t.docDataModel=null,t.bindingParams=[],t}function T(t,e,n,i,o,s){var a=Hi.call(this,t)||this,r=(a.agent=new y.Agent,a.callbacks=[],a.dataMapper=null,a.dataSet=null,a.dataSet2=null,a.forceInternalReset=!1,a.ignoreQueryStatusUpdates=!1,a.isClone=!1,a.isDirty=!1,a.isPending=!1,a.isMemoryErrMsg=!1,a.legacyFlushTime=0,a.consolidateCount=0,a.dataExecuteSuccessCount=0,a.onExecuteBeginCount=0,a.durationMovingAverage=T.FAST_THRESHOLD,a.paramChanged=[],a.parameterModels=[],a.performance=new y.PerformanceMetrics,a.pollingEvent=null,a.subscriptionId=null,a.subscriptionTypes=["polling","subscription","streaming"],a.viewStateBindings={},a.virtualSubscriptions={},a.startExecuted=!1,a.pendingVirtualSubscriptions={},[]);return a.root=e||a,a.path=n,a.viewState=i,a.group=o,a.virtualSubscriptions=s||{},a.group?(a.unset("_pagingType",{silent:!0}),a.unset(T.AUTO_EXECUTE,{silent:!0})):a.isUsingApi()&&y.CustomAPIHelpers.upgradeDocumentDataModel(a),a.get("_queryString")||!a.get("_pivotQuery")&&!a.get("_table")||(a.set("_queryString",a.get("_pivotQuery")||"select from "+a.get("_table")),a.unset("_pivotQuery"),a.unset("_table")),_.keys(a.attributes).forEach(function(t){var e,n=a.get(t);_.isArray(n)||!_.isObject(n)||n instanceof f.Model||(n._dataType?("copy"===n._dataType&&(n._dataType="query"),_.includes(T.SUPPORTED_DATA_SOURCES,n._dataType)?(e=new T(n,a.root,a.path?a.path+"/"+t:t,a.viewState),r.push(e),a.set(t,e,{silent:!0}),a.listenTo(e,"materialChange",a.onMaterialChange)):y.Log.Error(a.logPrefix()+" unsupported datatype: ",n._dataType)):"viewstate"===n._dashboardsType?(e=a.viewState.getByPath(n.value),a.set(t,e,{silent:!0})):_.includes(["_analyticParams","_mappings","_pageSort"],t)||n instanceof f.Model&&n.get("_viewType")||(e=new T(n,a.root,a.path?a.path+"/"+t:t,a.viewState,!0),a.set(t,e,{silent:!0}),a.listenTo(e,"change",function(){return a.trigger("change",a)}),a.listenTo(e,"materialChange",a.onMaterialChange)))}),a.has("_pagingNum")&&a.set("_pagingNum",0,{silent:!0}),a.has("_pageSort")&&a.set("_pageSort",{},{silent:!0}),a.debouncedParameterChange=_.throttle(a.applyParameterChange.bind(a),60,{leading:!1}),a.listenTo(a,"change",a.onModelChange),a}function C(){}function D(t,e,n){t=zi.call(this,t,e,n)||this;return t.MATERIAL_ATTRIBUTES=["_type","_default"],t.withAllProperties=!1,e&&(e.path&&(t.path=e.path),t.root=!0===e.root?t:e.root),_.each(_.keys(t.attributes),function(t){var e,n=this.get(t);if(!(n instanceof f.Model))if(_.isObject(n)&&-1===["_default","value",".settings"].indexOf(t))e=new D(n,{path:this.path?this.path+"/"+t:t,root:this.root},this),this.set(t,e,{silent:!0}),this.listenTo(e,"change",this.onChildModelChange),this.listenTo(e,"materialChange",this.onMaterialChange);else if(".settings"===t){for(var i in n)n.hasOwnProperty(i)&&(n[i]=new f.Model(n[i]));this.set(t,new f.Model(n))}else this.set(t,n),"_default"===t&&(this.get("_rolling")?this.set("value",Qi.Helpers.convertRollingToDate(n,this.get("_type"))):this.set("value",n))}.bind(t)),_.has(t.attributes,"_default")&&_.has(t.attributes,"value")&&(t.attributes._type=t.attributes._type||"symbol",t.schema={_type:{type:"Select",options:D.DATA_TYPES_ALL}},t.updateSchema()),t.listenTo(t,"change",t.onChange),t}(oo.Connection=ro).prototype.idAttribute="name",ao=f.Collection,e(uo,ao),oo.ConnectionCollection=uo,fi=A=A||{},u=fi.DataFilter||(fi.DataFilter={}),yi=f.Model,e(co,yi),co.prototype.defaults=function(){return{propertyName:null,propertyType:null,operator:null,value:null,value2:null,active:!0,type:"normal",compareFields:!1}},co.prototype.getBindingValue=function(e){var t=_.find(this.get("appModel").get("settingsModel").get("Bindings"),function(t){return t.Key===e});return t&&t.ViewState instanceof fi.DocumentViewModel?t.ViewState.get("value"):""},co.prototype.getTypeOperators=function(t){void 0===t&&(t=null);function e(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];_.each(t,function(t){return n.push.apply(n,t)})}var n=[],i={equal:[{label:"equal",val:"equal"},{label:"not equal",val:"not_equal"}],like:[{label:"like",val:"like"},{label:"not like",val:"not_like"}],blank:[{label:"is blank",val:"is_blank"},{label:"is not blank",val:"is_not_blank"}],compare:[{label:"less",val:"less"},{label:"less or equal",val:"less_or_equal"},{label:"greater",val:"greater"},{label:"greater or equal",val:"greater_or_equal"}],in:[{label:"in",val:"in"},{label:"not in",val:"not_in"}]};switch(this.get("compareFields")&&(i.like=i.blank=i.in=[]),e(i.equal),t){case 0:e(i.like,i.blank);break;case 5:case 6:case 7:case 8:case 9:case 4:e(i.compare,i.blank,i.in);break;case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:e(i.compare,i.blank);break;case 11:e(i.in,i.like,i.blank);break;case 2:e(i.in,i.blank);break;case 10:case 1:e(i.blank)}return n},co.prototype.replaceBindings=function(t){var e=this;return _.isString(t)&&this.get("appModel").get("Bindings")?t.replace(co.VSRx,function(t){t=t.substring(2,t.length-2);return e.getBindingValue(t)}):t},co.prototype.setSchema=function(){var n,t,i,o,e,s=this,a=this.get("propertyType");"histogram"===this.get("type")?(n=[5,6,7,8,9,12,13,14,15,16,17,18,19],t=this.options.appModel.get("data.items").filter(function(t,e){return _.includes(n,s.options.appModel.get("data.meta.columns.models")[e].get("kdbType"))}).map(function(t){return{label:t.get("propertyName"),val:t.get("propertyName")}}),this.schema={active:{title:"Is Active:",type:"Checkbox"},propertyName:{title:"Property:",type:"Select",options:_.sortBy(t,"label")},value:_.extend({title:"From"},fi.RTTI.getByQTypeNum(a||11).editor),value2:_.extend({title:"To"},fi.RTTI.getByQTypeNum(a||11).editor)}):(t=this.options.appModel.get("data.items").map(function(t){return{label:t.get("propertyName"),val:t.get("propertyName")}}),this.schema={active:{title:"Is Active:",type:"Checkbox"},propertyName:{title:"Property:",type:"Select",options:_.sortBy(t,"label")},operator:{title:"Operator:",type:"Select",options:this.getTypeOperators(a)},value:_.extend({title:"Value"},fi.RTTI.getByQTypeNum(a||11).editor)}),this.get("compareFields")?this.schema.value={title:"Value",type:"Select"}:this.get("operator")&&this.get("propertyName")&&_.some(["in","not_in","equal","not_equal","greater","less","greater_or_equal","less_or_equal"],function(t){return t===s.get("operator")})&&(t=this.options.appModel.get("data.items").get(this.get("propertyName")),a=0<=_.indexOf(["equal","not_equal","greater","less","greater_or_equal","less_or_equal"],this.get("operator")),t)&&(e=null,t.get("result")&&t.get("result").data?(i=t.get("DataSourceMapping.Text")||this.get("propertyName"),o=t.get("DataSourceMapping.Value")||this.get("propertyName"),e=t.get("result").data.collection.map(function(t){var e=t.get(i),t=t.get(o);return{label:_.isBoolean(e)?e+"":e,val:_.isBoolean(t)?t+"":t}}),(e=_.uniqBy(_.reject(e,function(t){return _.isNil(t.label)}),function(t){return t.label})).length<=0&&this.get("value")&&_.isArray(this.get("value"))&&0<this.get("value").length&&_.each(this.get("value"),function(t){e.push({label:t,val:t})}),e.splice(0,0,{label:"",val:""}),this.schema.value={title:"Value",type:a?"Select":"MultiSelect",options:e,modelKey:"value"}):0<t.get("items").length?((e=_.map(t.get("items"),function(t){return{label:t.Text,val:t.Value}})).splice(0,0,{label:"",val:""}),this.schema.value={title:"Value",type:a?"Select":"MultiSelect",options:e,modelKey:"value"}):a||(this.schema.value=_.extend({title:"Value"},fi.RTTI.getByQTypeNum(0).editor)))},co.prototype.isValueValid=function(t){return!!_.includes(["is_not_blank","is_blank"],this.get("operator"))||!(_.isUndefined(t)||_.isNull(t)||""===t)},co.prototype.toJSON=function(){var t="histogram"===this.get("type")?_.pick(this.attributes,"propertyName","propertyType","value","value2","active","type"):_.pick(this.attributes,"propertyName","propertyType","operator","value","active","type","compareFields");return null===t.propertyType&&(t.propertyType=11),t},co.prototype.toIPC=function(){return"histogram"===this.get("type")?this.toIPCHistogram():this.toIPCNormal()},co.prototype.toIPCHistogram=function(){var t=new Uint8Array([102,5]),e=[],n=this.get("propertyName"),i=this.get("propertyType"),o=7===i?Math.ceil(this.get("value")):this.get("value"),s="greater_or_equal",i=7===i?Math.floor(this.get("value2")):this.get("value2"),a="less_or_equal";return this.get("active")&&n&&this.isValueValid(o)&&this.isValueValid(i)?(e.push(this.toIPCNormal(n,s,o)),e.push(this.toIPCNormal(n,a,i)),fi.ipc.List.toIPC([t].concat(e))):null},co.prototype.toIPCNormal=function(t,e,n){var i=this,o=(void 0===e&&(e=null),void 0===n&&(n=null),t=(t=void 0===t?null:t)||this.get("propertyName"),e=e||this.get("operator"),n=this.replaceBindings(n||this.get("value")),-this.get("propertyType")||10);return this.get("active")&&t&&e&&this.isValueValid(n)?(t=fi.ipc.Util.getType(o),n=this.get("compareFields")&&n===this.get("value")?fi.ipc.Symbol.toIPC(n):"in"===e||"not_in"===e?(_.isArray(n)||(n=null===n?[]:[n]),t.listToIPC(_.map(n,function(t){return i.typeCast(t)}))):(-1===o&&_.isString(n)&&(n="true"===n),t.toIPC(fi.ipc.fromString(t,n))),fi.ipc.Dict.toIPC(["src","comparison","value","dataType","compareFields"],fi.ipc.List.toIPC(_.map([this.get("propertyName"),e],function(t){return fi.ipc.Symbol.toIPC(t)}).concat([n,fi.ipc.Short.toIPC(o),fi.ipc.Boolean.toIPC(this.get("compareFields"))])))):null},co.prototype.toKDB=function(){var t,e;return this.get("active")&&this.get("propertyName")&&this.get("operator")&&this.isValueValid(this.get("value"))?(e="in"===this.get("operator")||"not_in"===this.get("operator")?(t=fi.RTTI.getByQTypeNum(0),e=this.get("value"),t.toKDBInput(e)):(t=fi.RTTI.getByQTypeNum(this.get("propertyType")||11)).toKDBInput(this.get("value")),"(`src`comparison`value!(`"+this.get("propertyName")+";`"+this.get("operator")+";"+e+"))"):null},co.prototype.typeCast=function(t){switch(this.get("propertyType")){case 4:case 5:case 6:case 7:case 8:case 9:if(!_.isNaN(Number(t)))return Number(t)}return null!==t?""+t:""},co.prototype.validate=function(t,e){var n,t=isNaN(t)||isNaN(e)?(n=h(t),h(e)):(n=new Number(t),new Number(e));return t<=n},co.VSRx=/^<%[^<>%]*%>$/i,u.RuleModel=co,vi=A=A||{},bi=vi.DataFilter||(vi.DataFilter={}),Si=f.Model,e(po,Si),po.prototype.defaults=function(){return{children:new f.Collection,operator:"AND",active:!1}},po.prototype.isNull=function(){return _.every(this.get("children").filter(function(t){return t.get("active")}),function(t){return t instanceof po?t.isNull():_.isNull(t.toIPC())})},po.prototype.toJSON=function(){return{operator:this.get("operator"),children:this.get("children").toJSON()}},po.prototype.toIPC=function(){var e,n=new Array,t=this.get("children").filter(function(t){return t.get("active")}),t=(0<t.length&&_.each(t,function(t){(e=t instanceof po&&t.isNull()?null:t.toIPC())&&n.push(e)}),new Uint8Array([102,"AND"===this.get("operator")?5:6]));return vi.ipc.List.toIPC([t].concat(n))},po.prototype.toKDB=function(){var e,t="("+this.get("operator")+";",n=[];return!(0<this.get("children").length)||(this.get("children").each(function(t){(e=t.toKDB())&&n.push(e)}),n.length<=0)?null:(t+=n.join(";"))+")"},bi.GroupModel=po,wi=A=A||{},_i=wi.DataFilter||(wi.DataFilter={}),Ti=f.View,e(ho,Ti),ho.generateIpcHexMessage=function(t){t=new _i.GroupModel(_.extend({appModel:new f.DeepModel({"data.items":new f.Collection})},t));return wi.ipc.Util.toHexString(wi.ipc.Util.toMessage(t.toIPC()))},_i.App=ho,Ci=A=A||{},Di=Ci.QueryBuilder||(Ci.QueryBuilder={}),go.getBindingKeysFromArray=function(t,e){return t.concat(_.filter(e,function(t){return _.isString(t)&&go.VSRx.exec(t)}).map(function(t){return t.substring(2,t.length-2)}))},go.getActiveBindingKeys=function(t){return[]},go.replaceAllBindings=function(t,e){void 0===e&&(e="value"),_.each(t,function(t){!t[e]&&t.children?go.replaceAllBindings(t.children):t[e]="string"==typeof t[e]&&go.VSRx.test(t[e])?go.replaceBindings(t[e]):t[e]})},go.replaceBindings=function(t){var e,t=t.substring(2,t.length-2);return go.viewModel?(e=go.viewModel.getByPath(t))&&e.get("value"):go.bindings[t]},go.replaceKeys=function(t){var o=this,s=!1;_.each(t,function(t,e,n){var i;go.VSRx.exec(e)&&(i=e.replace(go.VSRx,go.replaceBindings.bind(o)),s=!0),s&&(delete n[e],n[i||e]=t)})},go.prototype.toIPC=function(){return Ci.ipc.Dict.toIPC(["type","data"],Ci.ipc.List.toIPC([Ci.ipc.Symbol.toIPC(this.group),Di.App.groupToClass[this.group].dataToIPC(this.data)]))},go.bindings={},go.VSRx=/^<%[^<>%]*%>$/i,Di.GraphNode=go,Ei=A=A||{},Mi=Ei.QueryBuilder||(Ei.QueryBuilder={}),Pi=Mi.GraphNode,e(mo,Pi),mo.partitionParameterToIPC=function(t,e){return t instanceof Array?Ei.ipc.List.toIPC(t.map(function(t){return e.toIPC(Ei.ipc.fromString(e,""+t))})):e.toIPC(Ei.ipc.fromString(e,""+t))},mo.dataToIPC=function(t){var e,n;return(t=mo.processBindings(t)).name&&t.params?Ei.ipc.List.toIPC([Ei.ipc.Symbol.toIPC(t.name)].concat(mo.recursiveToIPC(t.params))):t.name&&t.partition?(n=Ei.RTTI.getByName(t.partition.type).num,e=Ei.ipc.Util.getType("-"+n),n="equals"===t.partition.operator?8:"in"===t.partition.operator?23:24,Ei.ipc.Dict.toIPC(["table","operator","type","values"],Ei.ipc.List.toIPC([Ei.ipc.Symbol.toIPC(t.partition.name),new Uint8Array([102,n]),Ei.ipc.Symbol.toIPC("long"===t.partition.type?"year":t.partition.type),1<t.partition.parameters.length?Ei.ipc.List.toIPC(t.partition.parameters.map(function(t){return mo.partitionParameterToIPC(t.value,e)})):mo.partitionParameterToIPC(t.partition.parameters[0].value,e)]))):Ei.ipc.QString.toIPC(t)},mo.processBindings=function(t){return(t=_.cloneDeep(t))&&t.params?mo.replaceAllBindings(t.params):t&&t.partition&&mo.replaceAllBindings(t.partition.parameters),t},mo.getActiveBindingKeys=function(t){return t.params?t.params.filter(function(t){return!!_.isString(t.value)&&Mi.GraphNode.VSRx.exec(t.value)}).map(function(t){return t.value.substring(2,t.value.length-2)}):[]},mo.recursiveToIPC=function(t){return _.flatten(_.map(t,function(t){var e=Ei.RTTI.getByName("list"===t.type?"List":t.type),n=e?e.num:11;return 98===n?mo.recursiveToIPC(t.value):(7===n&&""===t.value&&(t.value="0"),e=Ei.ipc.Util.getType(0<n?"-"+n:""+n)||Ei.ipc.Util.getType("-11"),0===n&&t.value instanceof Array?e.toIPC(t.value.map(function(t){return Ei.ipc.Symbol.toIPC(t)})):e.toIPC(Ei.ipc.fromString(e,t.value)))}))},Mi.DataNode=mo,Ii=A=A||{},qe=Ii.QueryBuilder||(Ii.QueryBuilder={}),Ai=qe.GraphNode,e(fo,Ai),fo.dataToIPC=function(t){return t=fo.processBindings(t),Ii.ipc.Dict.toIPC(["select","where","distinct"],Ii.ipc.List.toIPC([Ii.ipc.Dict.toIPC(_.keys(t.select),Ii.ipc.Symbol.listToIPC(_.values(t.select))),Ii.ipc.Util.fromHexString(Ii.DataFilter.App.generateIpcHexMessage(t.where).slice(16)),Ii.ipc.Boolean.toIPC(t.distinct)]))},fo.getActiveBindingKeys=function(t){var e=[];return _.each(t.where.children,function(t){return e=fo.getBindingKeysFromArray(e,_.keys(t))}),fo.getBindingKeysFromArray(e,_.keys(t.select))},fo.processBindings=function(t){return t=_.cloneDeep(t),this.replaceAllBindings(t.where.children),this.replaceKeys(t.select),t},fo.operatorMap={AND:" and ",OR:" or ",equal:"=",in:" in ",like:" like ",greater_or_equal:">=",less:"<",less_or_equal:"<=",greater:">",is_blank:" is blank",not_equal:"!=",not_in:" not in ",not_like:" not like ",is_not_blank:" is not blank"},qe.FilterNode=fo,ki=A=A||{},xi=ki.QueryBuilder||(ki.QueryBuilder={}),Ni=xi.GraphNode,e(yo,Ni),yo.dataToIPC=function(t){return t=yo.processBindings(t),ki.ipc.Dict.toIPC(["groupBy","agg"],ki.ipc.List.toIPC([ki.ipc.Dict.toIPC(_.keys(t.groupBy),ki.ipc.List.toIPC(_.values(t.groupBy).map(function(t){return _.isString(t)?ki.ipc.Symbol.toIPC(t):ki.ipc.Dict.toIPC(_.keys(t),ki.ipc.Symbol.listToIPC(_.values(t)))}))),_.isEmpty(t.agg)?ki.ipc.List.toIPC([]):ki.ipc.Dict.toIPC(_.keys(t.agg),ki.ipc.List.toIPC(_.map(_.values(t.agg),function(t){return ki.ipc.Symbol.listToIPC(t.map(function(t){return String(t)}))})))]))},yo.getActiveBindingKeys=function(t){return yo.getBindingKeysFromArray([],_.union(_.keys(t.agg),_.keys(t.groupBy)))},yo.processBindings=function(t){return t=_.cloneDeep(t),xi.GraphNode.replaceKeys(t.agg),xi.GraphNode.replaceKeys(t.groupBy),t},xi.GroupByNode=yo,Li=A=A||{},Ye=Li.QueryBuilder||(Li.QueryBuilder={}),Ri=Ye.GraphNode,e(vo,Ri),vo.dataToIPC=function(t){return t?Li.ipc.Dict.toIPC(["fn","swap","left","right"],Li.ipc.List.toIPC([Li.ipc.Symbol.toIPC(t.fn),Li.ipc.Boolean.toIPC(t.swap),Li.ipc.List.toIPC(_.map(t.left,function(t){return Li.ipc.Symbol.toIPC(String(t))})),Li.ipc.List.toIPC(_.map(t.right,function(t){return Li.ipc.Symbol.toIPC(String(t))}))])):Li.ipc.Int.toIPC(null)},Ye.JoinNode=vo,Vi=A=A||{},Ke=Vi.QueryBuilder||(Vi.QueryBuilder={}),Oi=Ke.GraphNode,e(bo,Oi),bo.dataToIPC=function(){return Vi.ipc.Int.toIPC(null)},Ke.ResultNode=bo,Bi=A=A||{},$i=Bi.QueryBuilder||(Bi.QueryBuilder={}),Ui=$i.GraphNode,e(So,Ui),So.dataToIPC=function(t){return t=So.processBindings(t),Bi.ipc.Dict.toIPC(["filter","update"],Bi.ipc.List.toIPC([Bi.ipc.Util.fromHexString(Bi.DataFilter.App.generateIpcHexMessage(t.filter).slice(16)),Bi.ipc.Dict.toIPC(_.map(t.update,"column"),Bi.ipc.List.toIPC(_.map(t.update,function(t){var e=Bi.ipc.Util.getType(t.propertyType),e=e.toIPC(Bi.ipc.fromString(e,t.val));return-11===t.propertyType?Bi.ipc.List.toIPC([e]):e})))]))},So.getActiveBindingKeys=function(t){var e=[];return _.each(t.filter.children,function(t){return e=So.getBindingKeysFromArray(e,_.keys(t))}),_.each(t.update,function(t){return e=So.getBindingKeysFromArray(e,_.values(t))}),e},So.processBindings=function(t){return t=_.cloneDeep(t),$i.GraphNode.replaceAllBindings(t.filter.children),$i.GraphNode.replaceAllBindings(t.update,"val"),t},$i.UpdateNode=So,qi=A=A||{},Fi=qi.QueryBuilder||(qi.QueryBuilder={}),Yi=f.View,e(wo,Yi),wo.calculateReverseEdges=function(t){t=_.reduce(t,function(e,t,n){return _.each(t,function(t){void 0===e[t]?e[t]=[n]:e[t].push(n)}),e},{});return _.fromPairs(_.map(t,function(t,e){return[e,_.sortBy(t)]}))},wo.createNode=function(t){switch(t.group){case"data":case"function":case"stream":return new Fi.DataNode(t);case"filter":return new Fi.FilterNode(t);case"groupBy":return new Fi.GroupByNode(t);case"join":return new Fi.JoinNode(t);case"update":return new Fi.UpdateNode(t);case"result":return new Fi.ResultNode(t);default:throw"Invalid node "+t}},wo.graphToIPC=function(e,n,i){var o=this,s={},a={},r=this.calculateReverseEdges(n),l=function(t){_.extend(s,_.pick(e,t)),t!==i&&_.extend(a,_.pick(n,t)),_.each(r[t],function(t){l(t)})},t=(l(i||"result"),e=s,n=a,qi.ipc.Dict.toIPC(["nodes","edges"],qi.ipc.List.toIPC([qi.ipc.Dict.toIPC(_.keys(e),qi.ipc.List.toIPC(_.values(e).map(function(t){return o.createNode(t).toIPC()}))),qi.ipc.Dict.toIPC(_.keys(r),qi.ipc.List.toIPC(_.values(r).map(function(t){return qi.ipc.List.toIPC(_.sortBy(t).map(function(t){return qi.ipc.Symbol.toIPC(t)}))})))])));return qi.ipc.Util.toHexString(qi.ipc.Util.toMessage(t))},wo.prototype.getIPC=function(t,e,n){t=JSON.parse(t);return this.docDataModel=n,t=this.replaceBindingsInGraph(t),wo.graphToIPC(t.nodes,t.edges,e)},wo.prototype.replaceBindings=function(t){var e=t.substring(2,t.length-2),e=this.docDataModel.getViewState().getByPath(e);return this.bindingParams.push({value:t}),e&&e.get("value")},wo.prototype.replaceBindingsInGraph=function(t){var n=this;return this.bindingParams=[],_.values(t.nodes).forEach(function(e){[{type:"params",value:"value",children:null},{type:"filter",value:"value",children:"children"},{type:"where",value:"value",children:"children"},{type:"update",value:"val",children:null}].forEach(function(t){return e.data&&e.data[t.type]&&n.replaceAllBindings(e.data[t.type],t.value,t.children)}),["select","agg","groupBy"].forEach(function(t){return e.data&&e.data[t]&&n.replaceKeys(e.data[t])})}),this.docDataModel.set("_builderParams",this.bindingParams),t},wo.prototype.replaceAllBindings=function(t,e,n){var i=this;void 0===e&&(e="value"),void 0===n&&(n=""),_.isEmpty(n)||(t=t[n]),_.each(t,function(t){!t[e]&&t.children?i.replaceAllBindings(t.children):void 0!==t[e]&&(t[e]="string"==typeof t[e]&&wo.VSRx.test(t[e])?i.replaceBindings(t[e]):t[e])})},wo.prototype.replaceKeys=function(t){var o=this,s=!1;_.each(t,function(t,e,n){var i;wo.VSRx.exec(e)&&(i=e.replace(wo.VSRx,o.replaceBindings.bind(o)),s=!0),s&&(delete n[e],n[i||e]=t)})},wo.groupToClass={data:Fi.DataNode,function:Fi.DataNode,stream:Fi.DataNode,filter:Fi.FilterNode,update:Fi.UpdateNode,groupBy:Fi.GroupByNode,join:Fi.JoinNode,result:Fi.ResultNode},wo.VSRx=/^<%[^<>%]*%>$/i,Fi.App=wo,y=A=A||{},Hi=f.Model,e(T,Hi),T.convertDeltaClientColumnSpecToMeta=function(n){return(n.columns||[]).map(function(t,e){return{id:t,index:e,kdbType:n.meta[t]}})},T.convertMetaToDeltaClientColumnSpec=function(t){return{columns:_.map(t,function(t){return t.id}),meta:_.fromPairs(_.map(t,function(t){return[t.id,t.kdbType]}))}},T.prototype.apply=function(){var n=this,i=(this.performance.trigger("apply"),(T.DASH_ENGINE.isIEMode()||T.DASH_ENGINE.isDirectMode_AND_isConnectionTargeting_insightsSDK(this.get("_connection")))&&(this.clearTimer_ignoreQueryStatusUpdates(),this.checkMaxRowLimit=this.checkMaxRowLimitEmbeddedMode),!1),o=!1;if(this.has("error")||this.set("error",null,{silent:!0}),"pivot"===this.get("_dataType")&&this.set({_dataType:"query",_pivotType:"server"},{silent:!0}),this.stop(),this.reset(),this.bindViewStateToConnections(this.get("_connection_Viewstate")),this.get("_pivotType"))this.applyPivot();else switch(this.get("_dataType")){case"query":this.applyQuery();break;case"api":o=!0;case"analytic":case"builder":case"streaming":this.applyAnalytic();break;case"insightsStreaming":this.applyInsightsStreaming();break;case"copy":this.applyCopy();break;case"virtual":this.applyVirtual(),i=!0;break;case"pykx":case"sql":this.applyQuery()}this.forceInternalReset=!0,i&&this.performance&&this.performance.trigger("serverStart"),this.updateVirtualSubscriptions(),i&&this.performance&&this.performance.trigger("serverEnd"),this.dataMapper=new y.DataMapper({mappings:this.get("_mappings"),setMappings:function(t){n.set("_mappings",t)},subscribe:function(t,e){return n.subscribe(t,e,!(i||o))},unsubscribe:function(t){return n.unsubscribe(t)},viewState:this.viewState}),this.dataMapper.initialize()},T.prototype.applyCopy=function(){var t=this.get("_subscriptionKey")||y.DataSet.DEFAULT_ROW_INDEX;this.dataSet=new y.DataSet({idAttribute:t,collectionFunc:f.Collection.extend({model:f.Model.extend({idAttribute:t})}),agent:this.agent,applyMaxRowCountLimitOnReset:T.DASH_ENGINE.isIEMode()||T.DASH_ENGINE.isDirectMode_AND_isConnectionTargeting_insightsSDK(this.get("_connection")),maxRows:this.get("_maxRows"),primaryKey:t}),this.unset("error"),this.unset("queryStatus"),this.updateParameters(),this.isDirty=!1,this.execute=_.noop.bind(this)},T.prototype.applyAnalytic=function(){function t(t,e){o.onExecuteSubscriptionSuccess(t,o.get("_forceReset"),e)}function e(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];o.onError(o,o.attributes,t,"Error",e)}var n,i,o=this,s=this.get("_subscriptionKey")||y.DataSet.DEFAULT_ROW_INDEX,a=this.applyViewStateAttributes();this.dataSet=new y.DataSet({idAttribute:s,collectionFunc:f.Collection.extend({model:f.Model.extend({idAttribute:s})}),agent:this.agent,applyMaxRowCountLimitOnReset:T.DASH_ENGINE.isIEMode()||T.DASH_ENGINE.isDirectMode_AND_isConnectionTargeting_insightsSDK(this.get("_connection")),maxRows:this.get("_maxRows"),primaryKey:s}),this.dataSet2=new y.DataSet2({idAttribute:s,agent:this.agent,maxRows:this.get("_maxRows"),primaryKey:s}),this.unset("error"),this.unset("queryStatus"),this.updateParameters(!0),"subscription"===this.get("_subscriptionType")?(i=this.formatValue(a._subscriptionInterval,"_subscriptionInterval"),this.execute=this.wrapWithErrorHandler(function(){o.onExecuteBegin(),o.get("_serverPaging")&&(n={type:o.getPagingType(),num:o.get("_pagingNum")||0,size:o.get("_pageSize")||T.DEFAULT_PAGE_SIZE,sorting:o.get("_pageSort")||{}}),o.runWithConnectionCheck(e,function(){o.updateBuilder(function(){y.DeltaClientLib.startManagedAnalytic2(o.get("_selectedAnalytic"),o.get("_connection"),o.bindViewStateToKdbParams(o.get("_analyticParams")),t,e,i,o.get("_maxRows")||T.DEFAULT_MAX_ROWS,o.performance)},e)})},this,this.attributes)):"streaming"===this.get("_subscriptionType")?this.execute=this.wrapWithErrorHandler(function(){o.updateBuilder(function(){o.onExecuteBegin(),o.runWithConnectionCheck(e,function(){y.DeltaClientLib.startStreamingAnalytic2(o.get("_selectedAnalytic"),o.get("_connection"),o.bindViewStateToKdbParams(o.get("_analyticParams")),t,e,o.performance)})},e)},this,this.attributes):this.execute=this.wrapWithErrorHandler(function(){o.updateBuilder(function(){o.onExecuteBegin(),o.get("_serverPaging")&&(n={type:o.getPagingType(),num:o.get("_pagingNum")||0,size:o.get("_pageSize")||T.DEFAULT_PAGE_SIZE,sorting:o.get("_pageSort")||{}}),o.runWithConnectionCheck(e,function(){y.DeltaClientLib.runAnalytic2(o.get("_selectedAnalytic"),o.get("_connection"),o.bindViewStateToKdbParams(o.get("_analyticParams")),t,e,o.get("_maxRows")||T.DEFAULT_MAX_ROWS,n,o.performance)})},e)},this,this.attributes)},T.prototype.applyInsightsStreaming=function(){function c(t,e){d.onExecuteSuccess(t,d.get("_forceReset"),e)}function p(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];d.onError(d,d.attributes,t,"Error",e)}var d=this,t=this.get("_subscriptionKey")||y.DataSet.DEFAULT_ROW_INDEX;this.dataSet=new y.DataSet({idAttribute:t,collectionFunc:f.Collection.extend({model:f.Model.extend({idAttribute:t})}),agent:this.agent,applyMaxRowCountLimitOnReset:T.DASH_ENGINE.isIEMode()||T.DASH_ENGINE.isDirectMode_AND_isConnectionTargeting_insightsSDK(this.get("_connection")),maxRows:this.get("_maxRows"),primaryKey:t}),this.dataSet2=new y.DataSet2({idAttribute:t,agent:this.agent,maxRows:this.get("_maxRows"),primaryKey:t}),this.unset("error"),this.unset("queryStatus"),this.updateParameters(!0),this.execute=this.wrapWithErrorHandler(function(){d.updateBuilder(function(){d.onExecuteBegin();var t,e=d.bindViewStateToKdbParams(d.get("_streamingParameters")),n=_.get(_.find(e,{id:"pipeline"}),"value",""),i=T.DASH_ENGINE,o=d.get("_connection"),s=!1,o=(i.isDirectMode()&&i.isConnectionTargeting_insightsSDK(o)?(t=i.getConnectionHostname(o).replace("http","ws"),t="".concat(t,"/ws/v1/subscribe/").concat(n,"?out=qipc"),s=i.useQipc_forTargeting_insightsSDK(o)):t=("https:"===window.location.protocol?"wss://":"ws://")+window.location.host+"/servicegateway/ws/v1/subscribe/"+n+"?out=qipc",s||null!=(i=d.streamManager)&&i.destroy(),_.get(_.find(e,{id:"table"}),"value","")),i=_.find(e,{id:"filters"}),a=_.get(i,"value",""),r={},l=!1;if(""!==_.trim(a)){try{var u=y.CustomAPIHelpers.replaceInlineParameters(a,i,e,!0),r=JSON.parse(u)}catch(t){l=!0,y.Log.Warn(d.logPrefix()+" JSON parsing failed for subTopic: "+a)}if(l||a.indexOf("{")<0)return void p('Enter your filter criteria using JSON format (e.g. {"sym": "FDPL", "bsize": [2, 3]})')}i={topic:o,subTopic:r};s?(e=[o,JSON.stringify(r)].map(function(t){return{type:"symbol",value:t}}),d.subscriptionId=y.DashClient.client.subscribe(d.get("_maxRows"),n,d.get("_connection"),c,p,e),y.Log.Info(d.logPrefix()+"InsightsSDK streamId: "+d.subscriptionId)):(d.streamManager=new y.StreamManager(t),d.streamManager.sendRequest(d,i,c,p))},p)},this,this.attributes)},T.prototype.updateBuilder=function(t,e){var n,i;"builder"===this.get("_dataType")&&(n="streaming"===this.get("_subscriptionType"),i=(new y.QueryBuilder.App).getIPC(this.get("_graphJSON"),this.get("_selectedNode"),this),n?(this.set("_selectedAnalytic",i),this.set("_analyticParams",[],{silent:!0})):(this.set("_selectedAnalytic",".queryBuilder.processGraph2"),this.set("_analyticParams",[{id:"graph",name:"graph",index:0,type:n?"symbol":"string",value:i}],{silent:!0}))),t()},T.prototype.runWithConnectionCheck=function(t,e){var n=this.get("_connection");!this.get("_ignoreNullConnectionCheck")&&(null==n||"DC"===n)?t({message:"Invalid connection specified"}):e()},T.prototype.applyPivot=function(){var s,a=this,r=this.get("_breakdownCols"),l={dataSource:this.get("_dataSource"),connection:this.get("_connection"),pivotSource:"query",queryString:this.get("_queryString"),queryParams:this.get("_queryParams"),breakdownCols:this.get("_breakdownCols"),aggFn:this.get("_aggFn"),ordering:this.get("_ordering"),maxRows:this.get("_maxRows"),subscriptionType:this.get("_subscriptionType"),subscriptionInterval:this.get("_subscriptionInterval"),columnLabel:this.get("_columnLabel")},n=this.applyViewStateAttributes();_.each(n,function(t,e){"_subscriptionInterval"===e?n[e]=a.formatValue(t,"_subscriptionInterval"):_.isString(t)&&(n[e]=t.trim(),n[e]=t.split(",")),l[e.replace("_","")]=t}),r=l.breakdownCols,s=f.Model.extend({idAttribute:_.last(r),getRoot:function(){return a}}),_.each(r,function(t,e){var n={},i=r[r.length-e-1],o=e===r.length-1?"id":r[r.length-e-2];_.extend(n,l,{dimensions:r.slice(0,r.length-e),wheres:r.slice(0,r.length-e-1),id:o}),s=a.generatePivotModel(o,i,s,n)}),this.unset("error"),this.unset("queryStatus"),this.updateParameters(),_.extend(this,{dataSet:new y.DataSet({idAttribute:s.prototype.childId,collectionFunc:f.Collection.extend({model:s.prototype.childModelType||s}),agent:this.agent,maxRows:l.maxRows,applyMaxRowCountLimitOnReset:T.DASH_ENGINE.isIEMode()||T.DASH_ENGINE.isDirectMode_AND_isConnectionTargeting_insightsSDK(this.get("_connection")),primaryKey:s.prototype.childId}),dataSet2:new y.DataSet2({idAttribute:s.prototype.childId,agent:this.agent,maxRows:l.maxRows,primaryKey:s.prototype.childId}),execute:s.prototype.execute||_.noop.bind(this),exportPivotData:s.prototype.exportPivotData,staticIdAttribute:s.staticIdAttribute})},T.prototype.applyQuery=function(){function o(t,e){a.onExecuteSubscriptionSuccess(t,a.get("_forceReset"),e)}function s(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];a.onError(a,a.attributes,t,"Error",e)}var n,a=this,t=this.get("_subscriptionKey")||y.DataSet.DEFAULT_ROW_INDEX,e=this.applyViewStateAttributes();this.dataSet=new y.DataSet({idAttribute:t,collectionFunc:f.Collection.extend({model:f.Model.extend({idAttribute:t})}),agent:this.agent,lazyLoading:this.get("_lazyLoading"),applyMaxRowCountLimitOnReset:T.DASH_ENGINE.isIEMode()||T.DASH_ENGINE.isDirectMode_AND_isConnectionTargeting_insightsSDK(this.get("_connection")),maxRows:this.get("_maxRows"),primaryKey:t}),this.dataSet2=new y.DataSet2({idAttribute:t,agent:this.agent,lazyLoading:this.get("_lazyLoading"),maxRows:this.get("_maxRows"),primaryKey:t}),this.unset("error"),this.unset("queryStatus"),this.updateParameters(),"subscription"===this.get("_subscriptionType")?(n=this.formatValue(e._subscriptionInterval,"_subscriptionInterval"),this.execute=this.wrapWithErrorHandler(function(){var t=null,e=(a.onExecuteBegin(),a.replaceViewStateParams(a.get("_queryString")));a.get("_serverPaging")&&(t={type:a.getPagingType(),num:a.get("_pagingNum")||0,size:a.get("_pageSize")||T.DEFAULT_PAGE_SIZE,sorting:a.get("_pageSort")||{}}),a.runWithConnectionCheck(s,function(){y.DeltaClientLib.startManagedQuery2(a.get("_connection"),e,a.bindViewStateToKdbParams(a.get("_queryParams")),o,s,n,a.get("_maxRows")||T.DEFAULT_MAX_ROWS,t,a.performance)})},this,this.attributes)):this.execute=this.wrapWithErrorHandler(function(){var n=null,i=(a.onExecuteBegin(),a.replaceViewStateParams(a.get("_queryString")));a.get("_serverPaging")&&(n={type:a.getPagingType(),num:a.get("_pagingNum")||0,size:a.get("_pageSize")||T.DEFAULT_PAGE_SIZE,sorting:a.get("_pageSort")||{}}),a.runWithConnectionCheck(s,function(){var t=a.get("_dataType"),e=a.bindViewStateToKdbParams(a.get("_queryParams"));y.DeltaClientLib.getQueryData2(a.get("_dataSource"),a.get("_connection"),a.parseQueryByDataType(t,i,e),"sql"===t||"pykx"===t?[]:e,o,s,a.get("_maxRows")||T.DEFAULT_MAX_ROWS,n,a.performance)})},this,this.attributes)},T.prototype.parseQueryByDataType=function(t,e,n){switch(t){case"sql":var i=this.toSQLString(e,n).replace(/"/g,'\\"');return"".concat(y.KdbQuery.executeSql,' "').concat(i,'"');case"pykx":return this.toPyKxString(e,n);default:return e}},T.prototype.applyVirtual=function(){function t(t,e){n.onExecuteSuccess(t,n.get("_forceReset"),e)}var n=this,e=this.get("_subscriptionKey")||y.DataSet.DEFAULT_ROW_INDEX;this.dataSet=new y.DataSet({idAttribute:e,collectionFunc:f.Collection.extend({model:f.Model.extend({idAttribute:e})}),agent:this.agent,maxRows:9007199254740991,primaryKey:e}),this.unset("error"),this.unset("queryStatus"),this.updateParameters(),this.execute=this.wrapWithErrorHandler(function(){this.onExecuteBegin(),this.updateVirtualSubscriptions(),this.executeVirtualQuery(this.get("_virtualQueryString"),this.get("_virtualParams"),t)},this,this.attributes)},T.prototype.applyParameterChange=function(){var t,e;this.paramChanged&&this.paramChanged.length&&(t=!!_.find(this.paramChanged,function(t){return"#forced"===t}),e=!!_.find(this.paramChanged,function(t){return t.runApply}),y.Log.Info(this.logPrefix()+"apply parameter change",this.paramChanged),this.paramChanged=[],this.agent.subscriberCount()?e?(this.apply(),this.start()):this.isPending?this.isDirty=!0:(this.isDirty=this.isDirty||t,this.performance.trigger("paramChange"),this.start()):t&&(e=this.onExecuteBeginCount,this.dataSet||this.apply(),e===this.onExecuteBeginCount)&&this.execute())},T.prototype.applyViewStateAttributes=function(){var e=this,s={},t=_.clone(T.VIEW_STATE_ATTRIBUTES[this.get("_dataType")])||{},a=_.clone(this.viewStateBindings);return this.get("_pivotType")&&_.extend(t,T.VIEW_STATE_ATTRIBUTES.pivot),_.each(t,function(n,i){var o=e.get(i),t=_.findKey(a,function(t,e){return e===i&&t.callback===n&&t.model===o});t?(a=_.omit(a,t),o=o.get("value")):o instanceof f.Model&&(e.listenTo(o,"change:value",e[n]),e.viewStateBindings[i]=new y.ViewStateBinding(n,o),o=o.get("value")),s[i]=o}),this.get("_pivotType")&&s[T.AGGREGATE_COLS_PROP]&&s[T.AGGREGATE_LABELS_PROP]&&s[T.AGGREGATE_COLS_PROP].length!==s[T.AGGREGATE_LABELS_PROP].length&&(y.Log.Warn(this.logPrefix()+"invalid aggregate labels length"),s[T.AGGREGATE_LABELS_PROP]=[]),_.each(a,function(t){e.stopListening(t.model,"change:value",t.callback)}),s},T.prototype.bindViewStateToConnections=function(t){var e;_.isNaN(t)||(e=null==(e=this.getViewState())?void 0:e.getByPath(t))&&this.listenTo(e,"change:value",this.determineConnection)},T.prototype.determineConnection=function(){var t=this.get("_connection_Viewstate"),e=this.get("_connection");t&&(t=t.get("value"))!==e&&(this.set("_connection",t),this.stop(),this.execute())},T.prototype.bindViewStateToKdbParams=function(t){var a,r,o,l=this,e=[];return $.extend(!0,e,t),e&&0<e.length&&e.forEach(function(s){var t,e,n,i;"string"==typeof s.value&&(o=s.value.match(T.PARAMETER_RX))&&(t=l.getViewState().getByPath(o[0].substring(2,o[0].length-2)))&&(e=void 0,_.isFunction(t.get)?t.get("_rolling")&&!0===s.useRollingSyntax?(e=y.Helpers.convertRollingToDate(t.get("_default"),t.get("_type")),(n=l.get(T.AUTO_EXECUTE))&&l.stopListening(t,"change:value",l.onParameterChange),t.set("value",e),n&&l.listenTo(t,"change:value",l.onParameterChange)):e=t.get("value"):e=t.value,void 0===e&&(s.value=null),s.value=_.isObject(e)&&!_.isArray(e)?$.extend(!0,{},e):e),"dict"===s.type&&_.isObject(s.value)?_.keys(s.value).forEach(function(t){if(s.value[t]instanceof f.Model)s.value[t]={type:s.value[t].get("_type"),IsKdbParam:!0,isViewState:!0,name:s.value[t].path,value:s.value[t].get("value")};else if("object"==typeof s.value[t]){if(_.has(s.value[t],"_isKdbReady"))return;var e,n;"string"==typeof s.value[t].value&&0===s.value[t].value.indexOf("<%")?(i=s.value[t].value.substring(2,s.value[t].value.length-2),(o=l.getViewState().getByPath(i))&&(e=void 0,o.get("_rolling")&&!0===s.value[t].useRollingSyntax?(e=y.Helpers.convertRollingToDate(o.get("_default"),o.get("_type")),(n=l.get(T.AUTO_EXECUTE))&&l.stopListening(o,"change:value",l.onParameterChange),o.set("value",e),n&&l.listenTo(o,"change:value",l.onParameterChange),s.value[t].value=e):s.value[t].value=o.get("value"))):"dict"===s.value[t].type&&(s.value[t]=l.bindViewStateToKdbParams([s.value[t]])[0])}else{var i,o;"string"==typeof s.value[t]&&(i=void 0,0===s.value[t].indexOf("<%"))&&(i=s.value[t].substring(2,s.value[t].length-2),o=l.getViewState().getByPath(i))&&(s.value[t]={type:o.get("_type"),IsKdbParam:!0,isViewState:!0,name:s.value[t],value:o.get("value")})}a=s.value[t].type,(r=a?y.RTTI.getByName(a):null)&&r.toKDBInput&&(s.value[t].value=_.includes(T.TYPES_TO_PARSE,a)?r.toKDBInput(s.value[t].value):s.value[t].value,y.Log.Info(l.logPrefix()+"View State  Binding ["+s.name+"]",s.value[t].value))}):(a=s.type,(r=y.RTTI.getByName(a))&&("dict"!==r.name&&r.toKDBInput?(s.value=_.includes(T.TYPES_TO_PARSE,a)?r.toKDBInput(s.value):s.value,y.Log.Info(l.logPrefix()+"View State  Binding ["+s.name+"]",s.value)):"dict"===r.name&&(n=s.value.split(""),i={},n.forEach(function(t){t=t.split("");6===t.length&&(i[t[0]]={type:t[1],IsKdbParam:!0,isViewState:!0,name:t[0],value:t[2]})}),s.value=i)))}),e},T.prototype.checkMaxRowLimit=function(t,e){},T.prototype.checkMaxRowLimitNoop=function(t,e){},T.prototype.checkMaxRowLimitEmbeddedMode=function(t,e){var n=this;t.cols&&(99===e.qtype?(e=Object.keys(t.cols)[0])&&t.cols[e].length>this.get("_maxRows")&&(this.checkMaxRowLimit=this.checkMaxRowLimitNoop,this.set("queryStatus",{type:"Info",message:"Max rows exceeded, rows trimmed."}),this.ignoreQueryStatusUpdates=!0,this.timerId_ignoreQueryStatusUpdates=setTimeout(function(){n.clearTimer_ignoreQueryStatusUpdates()},3e3)):this.checkMaxRowLimit=this.checkMaxRowLimitNoop)},T.prototype.clearTimer_ignoreQueryStatusUpdates=function(){this.ignoreQueryStatusUpdates=!1,this.timerId_ignoreQueryStatusUpdates&&(clearTimeout(this.timerId_ignoreQueryStatusUpdates),this.timerId_ignoreQueryStatusUpdates=void 0)},T.prototype.clearVirtualSubscriptions=function(t){var n=this;_.each(t,function(t){var e=n.virtualSubscriptions[t];e&&(e instanceof T&&e.unsubscribe(t),delete n.virtualSubscriptions[t])})},T.prototype.clearVirtualSubscriptionsAll=function(){var t=_.keys(this.virtualSubscriptions);this.clearVirtualSubscriptions(t)},T.prototype.clone=function(){var t=new T(this.attributes,this.root,this.path,this.viewState,this.group);return t.isClone=!0,t},T.prototype.defaults=function(){var t={_pagingType:"NONE"};return t[T.AUTO_EXECUTE]=!0,t},T.prototype.destroy=function(){var t;this.stop(),this.reset(),this.agent&&this.agent.unsubscribeAll(),null!=(t=this.streamManager)&&t.destroy(),this.streamManager=null,this.clearTimer_ignoreQueryStatusUpdates(),f.Model.prototype.destroy.call(this)},T.prototype.determineMaterialChange=function(){this.changed&&!_.isEmpty(_.omit(this.changed,T.IMMATERIAL_ATTRIBUTES))&&this.trigger("materialChange")},T.prototype.doCommand=function(t,e){var n;if(0<t.length)return n=t.reverse().join("/"),this.getByPath(n).doCommand(t,e)},T.prototype.executeClientPivotQuery=function(n,t){var a,r,i,l,u,c,p,d,h,s=this,g={columns:[],meta:{},rows:[]};return n&&(a=this.getViewStateAttribute("_aggregateCols")||[],r=this.getViewStateAttribute("_aggregateFns")||[],u=this.getViewStateAttribute("_aggregateLabels")||[],i=this.getViewStateAttribute("_breakdownCols")||[],l=a.map(function(t){return y.Tools.getComparator(n.meta[t]||0,function(t){return t})}),u=_.map(a,function(t,e){return u[e]||t}),c=t&&t.wheres?t.wheres:[],c=_.filter(c,function(t,e){return t.comparator=y.Tools.getComparator(n.meta[t.columnName]||0,function(t){return t}),t.columnName===i[e]}),p=_.take(i,c.length+1),d=_.last(p),h=y.Tools.getComparator(n.meta[d]||0,function(t){return t[d]}),n.rows.forEach(function(o){for(var t,s,e=0;e<c.length;e++){var n=c[e];if(0!==n.comparator(n.columnValue,o[n.columnName]))break}e<c.length||(t=o[d],(t=y.Tools.binarySearch2(t,g.rows,h))<0?(s=_.pick(o,p),g.rows.splice(-t-1,0,s),u.forEach(function(t,e){"count"===r[e]?s[t]=0:_.includes(["max","min","sum"],r[e])?s[t]=null:s[t]=[]})):s=g.rows[t],a.forEach(function(t,e){var n=r[e],i=u[e];switch(n){case"count":s[i]+=1;break;case"max":null===o[t]||null!==s[i]&&-1!==l[e](s[i],o[t])||(s[i]=o[t]);break;case"min":null===o[t]||null!==s[i]&&1!==l[e](s[i],o[t])||(s[i]=o[t]);break;case"sum":null!==o[t]&&(s[i]+=Number(o[t]));break;default:s[i]=s[i]||[],s[i].push(o)}}))}),_.every(r,function(t){return _.includes(["count","max","min","sum"],t)})||g.rows.forEach(function(o){u.forEach(function(t,e){var n=o[t],i=r[e];if(_.isArray(n))switch(i){case"avg":n=_.map(n,function(t){return _.transform(t,function(t,e,n){return t[n]=Number(e)})}),o[t]=_.meanBy(n,a[e]);break;case"first":o[t]=_.first(n)[a[e]];break;case"last":o[t]=_.last(n)[a[e]];break;default:o[t]=s.executeUserJavascript(i,["data"],[n])}})}),_.each(p,function(t){g.columns.push(t),g.meta[t]=n.meta[t]||11}),_.each(a,function(t,e){g.columns.push(u[e]),g.meta[u[e]]="count"===r[e]?7:n.meta[t]||11})),g},T.prototype.executeUserJavascript=function(e,n,i){try{return new Function(n,e).apply({},i)}catch(t){n=/<anonymous>:(\d+):(\d+)/.exec(t.stack);if(n&&3===n.length)throw e=Number(n[1]),i=Number(n[2]),t.message+" ("+(e-2)+":"+i+")";throw t.message}},T.prototype.executeVirtualQuery=function(t,e,n){var o=this,t=T.VIRTUAL_QUERY_REGEX.exec(t),s=[],a=[],r=!1;if(!t)throw"Invalid function definition";_.each(e,function(t){switch(t.type){case"datasource":var e,n,i=o.path+"_"+t.value;o.get("isSourceDataDialog")&&(i+="#edit"),s.push(t.name),(i=o.virtualSubscriptions[i])?(e=i.get("_subscriptionKey")||y.DataSet.DEFAULT_ROW_INDEX,n=o.get("_subscriptionKey")||y.DataSet.DEFAULT_ROW_INDEX,r=r||n===y.DataSet.DEFAULT_ROW_INDEX&&(e===y.DataSet.DEFAULT_ROW_INDEX||"virtual"===i.get("_dataType")),a.push(_.extend(T.convertMetaToDeltaClientColumnSpec(i.dataSet?_.sortBy(i.dataSet.columns.map(function(t){return t.attributes}),"index"):[]),{rows:i.dataSet?i.dataSet.collection.models.map(function(t){return t.attributes}):[]}))):a.push(null);break;case"text":s.push(t.name),a.push(t.value);break;case"viewstate":s.push(t.name),(i=o.viewState.getByPath(t.value))?(n=t.useRollingSyntax?y.Helpers.convertRollingToDate(i.get("_default"),i.get("_type")):i.get("value"),t.useRollingSyntax&&((e=o.get(T.AUTO_EXECUTE))&&o.stopListening(i,"change:value",o.onParameterChange),i.set("value",n),e)&&o.listenTo(i,"change:value",o.onParameterChange),a.push(n)):a.push(null)}}),s.push("callback"),a.push(function(t){t.rows&&r&&(t.rows=t.rows.map(function(t){return Object.assign({},t)})),n(t)}),s.push("Tools"),a.push(y.Tools),t&&6===t.length&&(e=t[4],this.executeUserJavascript(e,s,a))},T.prototype.exportData=function(t,e,n){var i,o,s={},a="";n&&(n.exportName&&(a=n.exportName),n.exportParams)&&(s=n.exportParams),"analytic"===this.get("_dataType")?this.runWithConnectionCheck(e,function(){y.DeltaClientLib.exportAnalyticData(this.get("_selectedAnalytic"),this.get("_connection"),this.bindViewStateToKdbParams(this.get("_analyticParams")),a,s,t,e)}.bind(this)):"pivot"===this.get("_dataType")||this.get("_pivotType")?(i=this,n&&n.focus&&_.isString(n.focus)&&(o=n.focus.split(","),_.each(o,function(t){i.dataSet.collection.has(t)&&(i=i.dataSet.collection.get(t))})),i.exportPivotData(t,e,n)):"query"===this.get("_dataType")?this.runWithConnectionCheck(e,function(){y.DeltaClientLib.exportQueryData(this.get("_connection"),this.replaceViewStateParams(this.get("_queryString")),this.bindViewStateToKdbParams(this.get("_queryParams")),a,s,t,e)}.bind(this)):e("Export not currently supported for type "+this.get("_dataType"))},T.prototype.flatten=function(){return _.includes(["api","analytic","streaming","pivot","query","virtual","builder","sql","pykx","insightsStreaming"],this.get("_dataType"))?[this]:_.reduce(_.omit(this.attributes,"error"),function(t,e){return t.concat(e.flatten())},[])},T.prototype.flattenObject=function(t){var e={};if(_.keys(t).length){for(var n in t)if(t.hasOwnProperty(n))if("object"==typeof t[n]){var i,o=this.flattenObject(t[n]);for(i in o)o.hasOwnProperty(i)&&(e[n+"."+i]=o[i])}else e[n]=t[n];return e}return{0:t.toString()}},T.prototype.forceExecute=function(t,e){this.paramChanged.push("#forced"),e&&this.callbacks.push(e),this.debouncedParameterChange()},T.prototype.formatValue=function(t,e){return t="_subscriptionInterval"===e?1e3*Math.min(3600,Math.max(.5,Number(t||0))):t},T.prototype.wrapQuery=function(t){return'"'+t.replace(/"/g,'\\"')+'";'},T.prototype.kdbStringParamtoPyKxParam=function(t){var e="";switch(_.get(t,"type")){case"datetime":case"timestamp":case"second":case"minute":case"time":case"timespan":e=_.get(t,"value").replace("T","D").replace("Z","");break;case"date":e=_.get(t,"value").replace(/-/g,".");break;case"symbol":case"char":e="`"+_.get(t,"value");break;case"string":e='enlist "'+_.get(t,"value")+'"';break;case"boolean":e=_.get(t,"value")?"1b":"0b";break;case"list":e='enlist "'+_.get(t,"value").toString()+'"';break;default:e=_.get(t,"value")}return e},T.prototype.toPyKxString=function(t,e){var n=this,i="(::)";return 1<e.length?i="("+_.map(e,function(t){return n.kdbStringParamtoPyKxParam(t)}).join(",")+")":1===e.length&&(i=this.kdbStringParamtoPyKxParam(e[0])),".pykx.dash.runFunction["+this.wrapQuery(t)+i+"]"},T.prototype.toSQLString=function(i,t){return _.each(t,function(t){var e,n=t.type,n=n?y.RTTI.getByName(n):null;n&&n.toSQLInput&&(e=new RegExp("{{"+t.name+"}}","g"),i=i.replace(e,n.toSQLInput(t.value)))}),i},T.prototype.generatePivotModel=function(t,e,n,a){var r=this,l=(a.breakdownCols instanceof f.Model&&(a.breakdownCols=a.breakdownCols.get("value")),r.meta={},f.Model.extend({defaults:{_dataType:r.get("_dataType"),_pivotType:r.get("_pivotType"),_subscriptionType:r.get("_subscriptionType"),_subscriptionInterval:r.get("_subscriptionInterval")},idAttribute:t,childId:e,childModelType:n,initialize:function(){this.isDirty=!0,this.isPending=!1,this.legacyUpdates=[],this.agent=new y.Agent},apply:function(){this.dataSet=new y.DataSet({idAttribute:e,collectionFunc:f.Collection.extend({model:n}),agent:this.agent,applyMaxRowCountLimitOnReset:T.DASH_ENGINE.isIEMode()||T.DASH_ENGINE.isDirectMode_AND_isConnectionTargeting_insightsSDK(r.get("_connection")),maxRows:a.maxRows,primaryKey:e}),this.dataSet2=new y.DataSet2({idAttribute:e,agent:this.agent,maxRows:a.maxRows,primaryKey:e})},getRoot:function(){return r},getViewState:function(){return r.getViewState()},execute:function(e){function n(t){t?o(t):o(r.executeClientPivotQuery(r.clientPivotData,{wheres:a.wheres}),r.get("_forceReset"))}var i=this,t=!r.clientPivotData||r.isDirty||e&&e.intervalQuery,o=(this.wheres||(this.wheres=a.wheres),i.onExecuteSubscriptionSuccess.bind(i));i.onExecuteBegin();try{a.topX=null,a.ordering=null,a.queryParams=r.bindViewStateToKdbParams(r.get("_queryParams")),a.maxRows=r.get("_maxRows")||T.DEFAULT_MAX_ROWS,_.each(a.wheres,function(t,e){var t="string"==typeof t?t:t.columnName,n=r.meta[t];a.wheres[e]={columnName:t,columnType:n,columnOperator:"=",columnValue:i.get(t)}});function s(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];r.onError(l,a,t,"Error",e)}"client"===i.get("_pivotType")?t?(i.stop(),r.runWithConnectionCheck(s,function(){switch(r.get("_dataType")){case"query":var t=r.replaceViewStateParams(a.queryString);"subscription"===i.get("_subscriptionType")?y.DeltaClientLib.startManagedQuery(a.connection,t,r.bindViewStateToKdbParams(a.queryParams),function(t,e){t&&t.dataSet&&t.dataSet.rows?(r.clientPivotData=t.dataSet,n()):n(t)},s,1e3*a.subscriptionInterval,a.maxRows,null,i.performance):y.DeltaClientLib.getQueryData(a.dataSource,a.connection,t,r.bindViewStateToKdbParams(a.queryParams),function(t){r.clientPivotData=t,n()},s,a.maxRows,null,i.performance);break;case"api":case"analytic":case"streaming":"subscription"===i.get("_subscriptionType")?y.DeltaClientLib.startManagedAnalytic(r.get("_selectedAnalytic"),r.get("_connection"),r.bindViewStateToKdbParams(r.get("_analyticParams")),function(t,e){t&&t.rows?(r.clientPivotData=t,n()):n(t)},s,1e3*a.subscriptionInterval,a.maxRows,i.performance):y.DeltaClientLib.runAnalytic(r.get("_selectedAnalytic"),r.get("_connection"),r.bindViewStateToKdbParams(r.get("_analyticParams")),function(t){r.clientPivotData=t,n()},s,a.maxRows,null,i.performance);break;case"virtual":r.executeVirtualQuery(r.get("_virtualQueryString"),r.get("_virtualParams"),function(t){r.clientPivotData=t,n()});break;case"builder":"subscription"===i.get("_subscriptionType")?y.DeltaClientLib.startManagedQuery(a.connection,i.get("_analyticString"),i.get("_queryBuilderParams"),function(t,e){t&&t.dataSet&&t.dataSet.rows?(r.clientPivotData=t.dataSet,n()):n(t)},s,1e3*a.subscriptionInterval,a.maxRows,null,i.performance):y.DeltaClientLib.getQueryData(a.dataSource,a.connection,i.get("_analyticString"),i.get("_queryBuilderParams"),function(t){r.clientPivotData=t,n()},s,a.maxRows,null,i.performance)}})):n():("builder"===r.get("_dataType")&&(a.queryString=r.get("_analyticString"),a.queryParams=r.get("_queryBuilderParams")),r.runWithConnectionCheck(s,function(){y.DeltaClientLib.getPivotData(a,function(t,e){_.extend(r.meta,t.meta),"subscription"===r.get("_subscriptionType")?i.onExecuteSubscriptionSuccess(t,r.get("_forceReset"),e,r.meta):i.onExecuteSuccess(t,r.get("_forceReset"),e,r.meta)},s,i.performance)}))}catch(t){r.onError(l,a,t,"Error",e)}},exportPivotData:function(t,e,n){r.runWithConnectionCheck(e,function(){y.DeltaClientLib.exportPivotData($.extend({},a,n),t,e)})},checkMaxRowLimit:r.checkMaxRowLimit,clearTimer_ignoreQueryStatusUpdates:r.clearTimer_ignoreQueryStatusUpdates,clearVirtualSubscriptions:_.noop,clearVirtualSubscriptionsAll:_.noop,executeClientPivotQuery:r.executeClientPivotQuery,formatValue:r.formatValue,getViewStateAttribute:r.getViewStateAttribute,isPagingData:r.isPagingData,logPrefix:r.logPrefix,legacyFlush:r.legacyFlush,legacyUpdate:r.legacyUpdate,onComplete:r.onComplete,onExecuteSubscriptionSuccess:r.onExecuteSubscriptionSuccess,onExecuteBegin:r.onExecuteBegin,onExecuteSuccess:r.onExecuteSuccess,reset:r.reset,start:r.start,stop:r.stop,subscribe:r.subscribe,triggerCallbacks:_.noop,updateVirtualSubscriptions:_.noop,unsubscribe:r.unsubscribe},{staticIdAttribute:t}));return l},T.prototype.getByPath=function(t){var e;if(t)return t=_.filter(t.split("/"),function(t){return t&&0<t.length}),e=this,_.each(t,function(t){e=e&&e.get(t)}),e},T.prototype.getExecutionRate=function(){var t;return this.performance&&(t=this.performance.performance.apply)?6e4*this.dataExecuteSuccessCount/(Date.now()-t):0},T.prototype.getMappedViewStates=function(){var t=this.get("_mappings"),e=[];return t&&t.mappings&&_.each(t.mappings,function(t){e.push(t&&t._dashboardsType?this.viewState.getByPath(t.value):t)}.bind(this)),e},T.prototype.getMeta=function(e){var n=this,i=_.uniqueId("getMeta_");this.subscribe(i,{onData:function(t){e(t),_.defer(function(){return n.unsubscribe(i)})}})},T.prototype.getRoot=function(){return this},T.prototype.getTreeList=function(){var t=_.filter(this.attributes,function(t){return t instanceof T});return t.length?_.chain(t).map(function(t){return t.getTreeList()}).flatten().value():[this]},T.prototype.getViewState=function(){return this.viewState},T.prototype.getPagingType=function(){var t=T.DEFAULT_PAGING;return t=this.get("_serverPaging")?this.get("_forceReset")?"PAGENO_NOCACHE":this.get("_pagingType")&&"NONE"!==this.get("_pagingType")?this.get("_pagingType"):"PAGENO":t},T.prototype.getParameters=function(){var n,e,t,i=this,o=[];return this.get("_queryParams")?t=this.get("_queryParams"):this.get("_updateQueryParams")?t=this.get("_updateQueryParams"):this.get("_builderParams")?t=this.get("_builderParams"):this.get("_analyticParams")?t=this.get("_analyticParams"):this.get("_virtualParams")&&(t=_.filter(this.get("_virtualParams"),{type:"viewstate"}).map(function(t){return{value:"<%"+t.value+"%>"}})),t&&_.each(t,function(t){"string"==typeof t.value&&(e=t.value.match(T.PARAMETER_RX))&&(n={path:e[0].substring(2,e[0].length-2)},(e=i.viewState.getByPath(e[0].substring(2,e[0].length-2)))&&"dict"===e.get("_type")&&(n.dictParameters=[],_.each(e.get("value"),function(t,e){t instanceof f.Model?n.dictParameters.push({path:t.path,key:e}):_.isObject(t)?t.name?n.dictParameters.push({path:t.name,key:e}):t.type&&n.dictParameters.push({raw:!0,key:e,type:t.type,value:t.value}):_.isString(t)?t.match(T.PARAMETER_RX)?n.dictParameters.push({path:t.substring(2,t.length-2)}):n.dictParameters.push({path:t}):t&&n.dictParameters.push({path:t.name||t})})),o.push(n))}),o},T.prototype.getViewStateAttribute=function(t){t=this.get(t);return t instanceof f.Model?t.get("value"):t},T.prototype.getViewStateDict=function(){var i={},e=[],n=_.union(_.filter(this.get("_analyticParams"),function(t){return"dict"===t.type&&e.push(t),t.isViewState}),_.filter(this.get("_queryParams"),function(t){return"dict"===t.type&&e.push(t),t.isViewState}),_.filter(this.get("_virtualParams"),function(t){return"dict"===t.type&&e.push(t),t.isVirtual=!0,"viewstate"===t.type}));return _.each(e,function(t){_.each(t.value,function(t){t.isViewState&&n.push(t)})}),n&&0<n.length&&_.each(n,_.bind(function(n){var t=this.parseViewState(n.value,n.isVirtual);t&&(i[n.name]=t),"dict"===n.type&&_.isObject(n.value)&&_.each(n.value,function(t,e){t=this.parseViewState(t);t&&(i[n.name+"."+e]=t)}.bind(this))},this)),_.each(_.reduce(_.values(T.VIEW_STATE_ATTRIBUTES),function(t,e){return t.concat(_.keys(e))},[]),_.bind(function(t){var e=this.get(t);e instanceof f.Model&&(i[t]=e)},this)),i},T.prototype.isUsingApi=function(){return"api"===this.get("_dataType")&&!!this.get("_selectedAnalytic")},T.prototype.isMapping=function(){return this.get("_mappings")&&!_.isEmpty(this.get("_mappings").mappings)},T.prototype.isPagingData=function(t){return t&&t.rows&&t.rows[0]&&"startRows"===t.rows[0].Property&&t.rows[3]},T.prototype.legacyFlush=function(){var t;this.legacyFlushTime=Date.now(),this.legacyFlushFrame=void 0,(this.deferredUpdate&&this.agent.subscriberLegacyCount()||this.get("_dataType").match(/virtual|copy/))&&(t=this.legacyUpdate(this.deferredUpdate),this.dataSet&&this.dataSet.flushUpdates(),this.deferredUpdate&&this.deferredUpdate.forceReset&&t.rows&&!t.rows.length||!this.dataSet||this.dataSet&&this.dataSet.isEmpty()?0!==this.agent.subscriberRawCount()||this.isMemoryErrMsg?this.isMemoryErrMsg&&(this.isMemoryErrMsg=!1):this.set("queryStatus",{type:"NoResults",options:{}}):this.ignoreQueryStatusUpdates||this.unset("queryStatus"),0<this.consolidateCount?y.Log.Info(this.logPrefix()+"consolidated "+(this.consolidateCount+1)):y.Log.Info(this.logPrefix()+"deferred")),this.consolidateCount=0,this.deferredUpdate=void 0,this.durationMovingAverage=(2*this.durationMovingAverage+(Date.now()-this.legacyFlushTime))/3},T.prototype.legacyUpdate=function(t){var e,n=t.forceReset,i=t.table,o=t.pivotMeta,s=this.get("_breakdownCols"),o=(s instanceof f.Model&&(s=s.get("value")),o&&_.extend(o,i.meta),i.rows?i:i.toLegacy());try{this.viewState&&_.isFunction(this.viewState.get)&&this.viewState.get("_settings")&&this.viewState.get("_settings").get("dashboardAvailableMemoryThreshold")&&this.dataSet.setAvailableMemoryThreshold(this.viewState.get("_settings").get("dashboardAvailableMemoryThreshold").get("value")),this.dataSet.onData({breakdownColumns:s,columns:T.convertDeltaClientColumnSpecToMeta(o),paging:_.omit(t.pagingMeta,"data")},o.rows,n,e,this.performance)}catch(t){"string"==typeof t?((e=e||{}).message=t,e.type="Error",this.isMemoryErrMsg=t.startsWith(y.DataSet.ERROR_MSG_BROWSER_HAS_INSUFFICIENT_MEMORY)||t.startsWith(y.DataSet.ERROR_MSG_AVAILABLE_MEMORY_THRESHOLD)):"object"==typeof t&&(e=t),this.onError(this,this.attributes,t,"Error",[])}return o},T.prototype.logPrefix=function(){return"DataModel "+this.agent.subscriberCount()+" "+this.path+" "},T.prototype.objToString=function(e){var n=[];return _.each(_.keys(e),function(t){n.push(t+": "+e[t])}),n.join("\n")},T.prototype.onComplete=function(){this.isDirty&&!this.isPending&&(this.stop(),this.forceInternalReset=!0,this.start())},T.prototype.onError=function(t,e,n,i,o){n={error:_.isObject(n)?this.objToString(this.flattenObject(n)):n,type:i,options:$.extend({},e),args:void 0};this.triggerCallbacks(n),o&&(n.args=$.extend({},o)),this.set({error:n}),this.set({queryStatus:n}),this.isPending=!1,this.onComplete();try{this.dataSet&&this.dataSet.onData([],[],this.forceInternalReset,n),this.dataSet2&&this.dataSet2.onData([],{},this.forceInternalReset,n)}catch(t){}".pykx.dash.runFunction"===_.get(n,"error")&&_.set(n,"error","Python integration not available, requires loading of pykx on q server, See docs for more information"),y.Log.Error(this.logPrefix()+"onError ",n),t&&t.trigger&&t.trigger("error",t,n)},T.prototype.onExecuteBegin=function(){this.isPending=!0,this.isDirty=!1,this.onExecuteBeginCount++,"function"==typeof this.determineConnection&&this.determineConnection(),this.set({queryStatus:{type:"Loading"}}),y.Log.Info(this.logPrefix()+"execute begin")},T.prototype.onExecuteSuccess=function(e,t,n,i){var o,s={},a=this.get("_breakdownCols");if(a instanceof f.Model&&(a=a.get("value")),this.dataExecuteSuccessCount++,this.triggerCallbacks(),this.trigger("DataRecieved",!0),n&&n.byteLength){var r=["startRows","numRows","totalNumRows","data"];if(e&&99===e.qtype&&11===e.keys.qtype&&4===e.keys.offsets.length&&_.isEqual(r,_.times(4,function(t){return y.ipc.Parse.col(e.keys,new DataView(n)).toLegacy(t)}))){for(var l=y.ipc.Parse.col(e.values,new DataView(n)),u=0;u<3;u++)s[r[u]]=l.toLegacy(u);s.pagingType=this.getPagingType(),s.pageSize=this.get("_pageSize"),o=y.ipc.Parse.reshape(l.values[3],n),t=!0}else o=y.ipc.Parse.reshape(e.dataSet||e,n);i&&_.extend(i,o.meta),t=t||this.forceInternalReset,this.checkMaxRowLimit(o,e),this.agent.subscriberRawCount()&&(this.unset("error"),this.dataSet2.onData({breakdownColumns:a,columns:T.convertDeltaClientColumnSpecToMeta(o),paging:_.omit(s,"data")},o.cols,t,void 0,this.performance),this.forceInternalReset=!1,!this.dataSet2||this.dataSet2&&this.dataSet2.isEmpty()?this.set("queryStatus",{type:"NoResults",options:{}}):this.ignoreQueryStatusUpdates||this.unset("queryStatus"))}else this.isPagingData(e)?(_.each(e.rows,function(t){s[t.Property]=t.Value}),s.pagingType=this.getPagingType(),s.pageSize=this.get("_pageSize"),o=s.data||{},t=!0):o=e;(this.agent.subscriberLegacyCount()||this.get("_dataType").match(/virtual|copy/))&&(t=t||this.forceInternalReset,a=new y.LegacyUpdate(o,t,s,i),this.forceInternalReset=!1,this.deferredUpdate?(this.dataSet.background(),this.consolidateCount++,this.legacyUpdate(this.deferredUpdate),this.deferredUpdate=a):!this.dataSet.isBackground()&&(this.durationMovingAverage<=T.FAST_THRESHOLD||Date.now()-this.legacyFlushTime-this.durationMovingAverage>T.OLD_THRESHOLD)?(this.deferredUpdate=a,this.legacyFlush(),y.Log.Info(this.logPrefix()+" Express")):this.deferredUpdate=a,!this.legacyFlushFrame)&&this.deferredUpdate&&(this.legacyFlushFrame=window.requestAnimationFrame(this.legacyFlush.bind(this)),this.deferredUpdate=a),this.isPending=!1,this.unset("error"),y.Log.Info(this.logPrefix()+"execute success"),"static"===this.get("_subscriptionType")&&_.times(this.agent.subscriberCount(),function(){eo.decreaseDataPendingCounter()}),this.onComplete()},T.prototype.onExecuteSubscriptionSuccess=function(t,e,n,i){if("207"===t.class)this.stop(),t.add?(this.subscriptionId=t.clientId+":"+t.subId,this.isPending=!1,y.Log.Info(this.logPrefix()+"sub started "+t.subId)):y.Log.Info(this.logPrefix()+"sub stopped "+t.subId);else if("208"===t.class)y.Log.Info(this.logPrefix()+"sub failed "+t.subId+": "+t.reason),y.DeltaClientLib.removeSubscriptions(t.clientId+":"+t.subId);else{if("209"===t.class){if(this.subscriptionId!==t.clientId+":"+t.subId)return y.Log.Warn(this.logPrefix()+"sub stray persisting: "+t.clientId+":"+t.subId),void y.DeltaClientLib.removeSubscriptions(t.clientId+":"+t.subId)}else{if("210"===t.class)return;if("com.fd.business.querymanager.subscriptions.ManagedSubscription"===t.class||"com.fd.business.querymanager.subscriptions.StreamingSubscription"===t.class)return}this.onExecuteSuccess(t.dataSet||t,e,n,i)}},T.prototype.onMaterialChange=function(){this.trigger("materialChange")},T.prototype.onModelChange=function(t,e){var t=_.keys(t.changed),n=_.intersection(t,T.PAGING_ATTRIBUTES);_.find(t,function(t){return 0===t.indexOf("_")})&&(this.determineMaterialChange(),_.some(t,function(t){return 0===t.indexOf("_")&&!_.includes(["_layout","_mappings"],t)})&&(this.isDirty=!0),_.includes(t,T.AUTO_EXECUTE)&&this.updateParameters(),n)&&n.length&&(this.paramChanged=this.paramChanged.concat(n),this.stop(),this.isDirty=!0,this.forceInternalReset=!0,this.debouncedParameterChange())},T.prototype.onParameterChange=function(t,e,n){this.isDirty||eo.increaseDataPendingCounter(this.path);n={runApply:!(!n||!n.runApply)||!!this.get("_pivotType"),modelPath:t.path,previous:t.previous("value"),new:e};this.paramChanged.push(n),y.Log.Info(this.logPrefix()+"parameter change",n),this.stop(),this.isDirty=!0,this.forceInternalReset=!0,this.get("_pagingType")!==T.DEFAULT_PAGING&&0!==this.get("_pagingNum")&&this.set("_pagingNum",0),this.debouncedParameterChange()},T.prototype.onPivotSettingChange=function(t,e){this.onParameterChange(t,e,{runApply:!0})},T.prototype.onQuerySettingChange=function(t,e,n){n=_.extend(!0,{runApply:!0},n),this.onParameterChange(t,e,n)},T.prototype.parseViewState=function(t,e){if("string"==typeof t)return e?this.getViewState().getByPath(t):(e=t.match(T.PARAMETER_RX))?this.getViewState().getByPath(e[0].substring(2,e[0].length-2)):void 0},T.prototype.postCommand=function(t,e){return this.root.postCommand(this,e)},T.prototype.removeSubscriptions=function(){this.stop(),this.group&&this.values().forEach(function(t){return t.removeSubscriptions()})},T.prototype.replaceViewStateParams=function(t){var i=this;return"string"==typeof t?t.replace(T.PARAMETER_RX,function(t,e){var n=i.getViewState().getByPath(e);return n?void 0===(n=n.get("value"))?null:n:(y.Log.Error(i.logPrefix()+"replace parameter: "+e+" not found"),"")}):t},T.prototype.reset=function(){this.dataMapper&&(this.dataMapper.cleanUp(),delete this.dataMapper),this.dataSet&&(this.dataSet.cleanUp(),delete this.dataSet),this.dataSet2&&(this.dataSet2.cleanUp(),delete this.dataSet2),this.deferredUpdate=void 0,this.isDirty=!0,this.isPending=!1,this.dataExecuteSuccessCount=0,this.onExecuteBeginCount=0},T.prototype.setLastRunInfo=function(t){this.lastRunInfo=t},T.prototype.start=function(){var t,e,n=this;0===this.agent.subscriberCount()?y.Log.Info(this.logPrefix()+"start: no subscriptions"):(t=this.formatValue(this.getViewStateAttribute("_subscriptionInterval"),"_subscriptionInterval"),"polling"===(e=this.get("_subscriptionType"))?this.pollingEvent?(y.Log.Info(this.logPrefix()+"start: already polling!"),this.stop(),this.start()):(y.Log.Info(this.logPrefix()+"start: polling now..."),this.pollingEvent=setInterval(function(){n.isPending||(y.Log.Info(n.logPrefix()+"poll"),n.execute({intervalQuery:!0}))},t),this.execute()):"subscription"===e||"streaming"===e?"insightsStreaming"===this.get("_dataType")&&T.DASH_ENGINE.isIEMode()?this.streamManager||this.execute():this.subscriptionId||this.execute():this.isDirty&&!this.isPending&&(this.startExecuted||(this.startExecuted=!0,"virtual"!==this.get("_dataType"))||_.isEmpty(this.virtualSubscriptions)||!_.some(this.virtualSubscriptions,"isPending")?_.isEmpty(this.pendingVirtualSubscriptions)&&this.execute():(this.pendingVirtualSubscriptions={},_.each(this.virtualSubscriptions,function(t,e){t.isPending&&(n.pendingVirtualSubscriptions[e]=!0)}),this.set({queryStatus:{type:"Loading"}}))))},T.prototype.stop=function(){var t;this.pollingEvent&&(clearInterval(this.pollingEvent),this.pollingEvent=null),this.subscriptionId&&(y.DeltaClientLib.removeSubscriptions(this.subscriptionId),y.Log.Info(this.logPrefix()+" unsubcribed "+this.subscriptionId),this.subscriptionId=null),null!=(t=this.streamManager)&&t.destroy(),this.streamManager=null},T.prototype.subscribe=function(t,e,n,i){this.agent.subscribe(t,e,n)?(eo.increaseDataPendingCounter(this.path),y.Log.Info(this.logPrefix()+"subscribed "+t),i?this.set(i,{silent:!0}):this.has("_lazyLoading")&&(this.unset("_lazyLoading"),this.dataSet&&(this.dataSet.lazyLoading=!1),this.set({_pagingType:"NONE",_pageNum:0},{silent:!0})),this.dataSet?(n||this.dataSet.collection.isEmpty()&&this.dataSet.columns.isEmpty()?this.dataSet2&&!this.dataSet2.columns.isEmpty()?n?this.dataSet2.onDataRefresh(e):(i=y.ipc.Table.toLegacy(_.mapValues(_.keyBy(this.dataSet2.columns.map(function(t){return t.attributes}),"id"),"kdbType"),this.dataSet2.columns.map(function(t){return t.id}),this.dataSet2.cols),this.dataSet.onData({breakdownColumns:this.dataSet2.breakdownColumns,columns:T.convertDeltaClientColumnSpecToMeta(i)},i.rows,!0,void 0)):n&&!this.dataSet.columns.isEmpty()&&this.apply():(this.dataSet.onDataRefresh(e),eo.decreaseDataPendingCounter()),this.trigger("change:queryStatus",this,this.get("queryStatus"))):this.apply(),this.start()):y.Log.Error(this.logPrefix()+"subscribe: already subscribed",t)},T.prototype.toJSON=function(){var i=this,o={};return _.keys(this.attributes).forEach(function(t){var e=i.attributes[t],n={};_.isObject(e)&&e.has&&e.has("_dataType")?(_.each(_.filter(_.keys(e.attributes),function(t){return 0===t.indexOf("_")&&!_.includes(["_pageSort","_pagingNum"],t)}),function(t){e.get(t)instanceof f.Model?n[t]={_dashboardsType:"viewstate",value:e.get(t).path}:n[t]=e.get(t)}),o[t]=n):e instanceof y.DocumentViewModel?o[t]={_dashboardsType:"viewstate",value:e.path}:(_.isObject(e)&&"Error"===e.type&&(e.options={}),o[t]=e)}),o},T.prototype.triggerCallbacks=function(e){void 0===e&&(e=null),this.callbacks.forEach(function(t){t({success:!e,error:e})}),this.callbacks=[]},T.prototype.unsubscribe=function(t){this.agent.unsubscribe(t)?(y.Log.Info(this.logPrefix()+"unsubscribed "+t),0===this.agent.subscriberCount()&&(this.stop(),this.reset(),this.clearVirtualSubscriptionsAll(),y.Log.Info(this.logPrefix()+"0 subscribers, data source reset"))):y.Log.Warn("unsubscribe not found",t,this)},T.prototype.updateParameterPath=function(t,e,n,i){void 0===i&&(i=!1);var o=new RegExp("^<%"+e+(i?"/":"%>$")),s="<%"+n+(i?"/":"%>"),a=new RegExp("^"+e+(i?"/":"$")),r=n+(i?"/":"");"vs"===t?(_.each([this.get("_analyticParams"),this.get("_queryParams"),this.get("_updateQueryParams")],function(t){_.each(t,function(t){t.isViewState&&(t.value=t.value.replace(o,s))})}),_.each(this.get("_virtualParams"),function(t){"viewstate"===t.type&&(t.value=t.value.replace(a,r))})):"ds"===t&&_.each(this.get("_virtualParams"),function(t){"datasource"===t.type&&(t.value=t.value.replace(a,r))})},T.prototype.updateParameters=function(t){var e,n,i,o,s=this,a=[];_.each(_.filter(_.keys(s.attributes),function(t){return 0===t.indexOf("_")}),function(t){"string"==typeof s.get(t)&&s.get(t).replace(T.PARAMETER_RX,function(t,e){return a.push(e),""})}),s.get("_queryParams")&&0<s.get("_queryParams").length?_.each(s.get("_queryParams"),function(t){"string"==typeof t.value&&((e=t.value.match(T.PARAMETER_RX))&&(a.push(e[0].substring(2,e[0].length-2)),i=s.viewState.getByPath(e[0].substring(2,e[0].length-2))),i)&&"dict"===i.get("_type")&&_.each(i.get("value"),function(t,e){var n;t instanceof f.Model?a.push(t.path):_.isObject(t)&&t.value?(n=t.value,_.isString(n)&&n.match(T.PARAMETER_RX)&&a.push(n.substring(2,n.length-2))):_.isString(t)&&t.match(T.PARAMETER_RX)&&a.push(t.substring(2,t.length-2))})}):s.get("_updateQueryParams")&&0<s.get("_updateQueryParams").length?_.each(s.get("_updateQueryParams"),function(t){"string"==typeof t.value&&((e=t.value.match(T.PARAMETER_RX))&&(a.push(e[0].substring(2,e[0].length-2)),i=s.viewState.getByPath(e[0].substring(2,e[0].length-2))),i)&&"dict"===i.get("_type")&&_.each(i.get("value"),function(t,e){var n;t instanceof f.Model?a.push(t.path):_.isObject(t)&&t.value?(n=t.value,_.isString(n)&&n.match(T.PARAMETER_RX)&&a.push(n.substring(2,n.length-2))):_.isString(t)&&t.match(T.PARAMETER_RX)&&a.push(t.substring(2,t.length-2))})}):s.get("_analyticParams")&&0<s.get("_analyticParams").length?_.each(s.get("_analyticParams"),function(t){"string"==typeof t.value?((e=t.value.match(T.PARAMETER_RX))&&(a.push(e[0].substring(2,e[0].length-2)),i=s.viewState.getByPath(e[0].substring(2,e[0].length-2))),i&&"dict"===i.get("_type")&&_.each(i.get("value"),function(t,e){var n;t instanceof f.Model?a.push(t.path):_.isObject(t)&&t.value?(n=t.value,_.isString(n)&&n.match(T.PARAMETER_RX)&&a.push(n.substring(2,n.length-2))):_.isString(t)&&t.match(T.PARAMETER_RX)&&a.push(t.substring(2,t.length-2))})):"object"==typeof t.value&&"dict"===t.type&&_.each(t.value,function(t){!_.has(t,"_isKdbReady")&&(n="object"==typeof t?t.value:"<%"+t+"%>",e="string"==typeof n&&n.match(T.PARAMETER_RX))&&a.push(e[0].substring(2,e[0].length-2))})}):_.isArray(o=s.get("_streamingParameters"))&&0<o.length?_.each(o,function(t){"string"==typeof t.value&&(e=t.value.match(T.PARAMETER_RX))&&(t=e[0].substring(2,e[0].length-2),a.push(t),i=s.viewState.getByPath(t))}):s.get("_virtualParams")&&0<s.get("_virtualParams").length&&_.each(s.get("_virtualParams"),function(t){(e=t.value)&&"viewstate"===t.type&&(a.push(e),i=s.viewState.getByPath(e)),i&&"dict"===i.get("_type")&&_.each(i.get("value"),function(t,e){var n;t instanceof f.Model?a.push(t.path):_.isObject(t)&&t.value?(n=t.value,_.isString(n)&&n.match(T.PARAMETER_RX)&&a.push(n.substring(2,n.length-2))):_.isString(t)&&t.match(T.PARAMETER_RX)&&a.push(t.substring(2,t.length-2))})}),s.parameterModels&&_.each(s.parameterModels,function(t){t&&s.stopListening(t,"change:value",s.onParameterChange)}),s.parameterModels=[],s.get(T.AUTO_EXECUTE)&&_.each(a,function(t){t=s.getViewState().getByPath(t);t&&(s.listenTo(t,"change:value",s.onParameterChange),s.parameterModels.push(t))})},T.prototype.updateVirtualSubscriptions=function(){var n,o=this,i=[];"virtual"!==this.get("_dataType")?this.clearVirtualSubscriptionsAll():(_.each(this.get("_virtualParams"),function(t){var e=t.value;e&&"datasource"===t.type&&i.push(e)}),n=_.keys(this.virtualSubscriptions),_.each(i,function(t){var e,i=o.path+"_"+t;o.get("isSourceDataDialog")&&(i+="#edit"),_.includes(n,i)?n=_.without(n,i):(e=o.root?o.root.getByPath(t):e)&&!o.virtualSubscriptions[i]&&((o.virtualSubscriptions[i]=e).unsubscribe(i),e.subscribe(i,{key:i,onData:function(t,e,n){o.pendingVirtualSubscriptions[i]&&delete o.pendingVirtualSubscriptions[i],o.onParameterChange({path:"#virtual",previous:_.noop.bind(o)},Math.random(),{})},source:e}))}),this.clearVirtualSubscriptions(n))},T.prototype.wrapWithErrorHandler=function(t,e,n){var i=this;return function(){try{t.apply(i,arguments)}catch(t){i.onError(e,$.extend(!0,{},n),t,"Error",Array.prototype.slice.call(3,arguments))}}},T.DEFAULT_MAX_ROWS=null,T.DEFAULT_PAGE_SIZE=2e3,T.DEFAULT_PAGING="NONE",T.IMMATERIAL_ATTRIBUTES=["error","queryStatus"],T.NO_DATA_ERROR_TEXT="No data returned from selected data source",T.PAGING_ATTRIBUTES=["_pagingNum","_pageSize","_pagingType","_pageSort","_serverPaging"],T.PARAMETER_RX=new RegExp("<%([^<>%]+?)%>","g"),T.TYPES_TO_PARSE=["date","datetime","guid","minute","month","second","time","timespan","timestamp"],T.SUPPORTED_DATA_SOURCES=["api","analytic","streaming","pivot","query","virtual","builder","sql","pykx","insightsStreaming"],T.VIEW_STATE_ATTRIBUTES={analytic:{_subscriptionInterval:"onQuerySettingChange"},pivot:{_aggregateCols:"onPivotSettingChange",_aggregateFns:"onPivotSettingChange",_aggregateLabels:"onPivotSettingChange",_breakdownCols:"onPivotSettingChange"},query:{_subscriptionInterval:"onQuerySettingChange"}},T.VIRTUAL_QUERY_REGEX=/^\s*(function(?: )?\()([a-z0-9A-Z,\w\/ ]+?)(,(?: +)?callback\)(?: ){)([\s\S]+)(\})$/,T.AGGREGATE_COLS_PROP="_aggregateCols",T.AGGREGATE_LABELS_PROP="_aggregateLabels",T.AUTO_EXECUTE="_autoExecute",T.OLD_THRESHOLD=2e3,T.FAST_THRESHOLD=10,y.DocumentDataModel=T,Ki=A=A||{},C.setCalendarPath=function(t){t=_.filter(t,function(t){return"QuickBase"===t.key}),t=void 0===t||_.get(t,"0.value")?_.get(t,"0.value"):"QuickBase",t=location.origin+location.pathname.replace("/edit","")+"/modules/"+t+"/calendar/";C.HOLIDAY_CALENDAR_FILE=t+"holidayCalendar.csv",C.WORK_WEEK_FILE=t+"workweek.csv"},C.convertRollingToDate=function(t,e){var n,i,o=Ki.Tools.convertValueToMoment(null,e);if(t=(t=t||"NOW").toUpperCase(),"duration"===Ki.Tools.getTypeCategory(e)&&(o=Ki.Tools.convertValueToDuration(o.formatNano("HH:mm:ss.SSS"),e)),"T"===t)_.includes(["date","datetime","timestamp","month"],e)&&o.set({hour:0,minute:0,second:0,millisecond:0});else if(t.toString().match(Ki.RTTI.REGEX_ROLLING)){if(i=t.toString().match(/^(T|NOW)([\+|\-][\d:]+)/)){var s=i[2];if(-1!==s.indexOf(":")&&-1===s.indexOf("@"))o.add(h.duration(s));else if(n=parseInt(s,10))switch(e){case"date":case"datetime":case"timestamp":if(o.set({hour:0,minute:0,second:0,millisecond:0}),t)if(t.toString().includes("WD")){for(var a=n/Math.abs(n),r=(o.add(a*Math.floor(Math.abs(n)/5)*7,"days"),n%5),l=n/Math.abs(n);0!==r;)o.add(l,"days"),0!==(p=o.day())&&6!==p&&(r-=l);for(;0===o.day()||6===o.day();)o.subtract(l,"days")}else if(t.toString().includes("BD"))if(_.isNil(C.WORK_WEEK_FILE))console.error("Unable to calculate business days - calendar file path is not defined.");else if(C.workWeekFileAccessFail&&$.ajax({url:C.WORK_WEEK_FILE,async:!1,dataType:"text"}).done(function(t){if(0<t.length){t=(t=t.replace(/"/gm,"")).replace(/(\r\n|\n|\r")/gm,",").split(",");for(var e=0,n=0;n<t.length&&e<7;n++){var i=parseInt(t[n])-1;!isNaN(i)&&0<=i&&i<7&&(e++,C.workWeekDays.includes(i)||C.workWeekDays.push(i))}}C.workWeekFileAccessFail=!1}).fail(function(t){console.log(t.responseText)}),_.isEmpty(C.workWeekDays))console.log("No business days defined by ".concat(C.WORK_WEEK_FILE));else{C.holidayCalendarFileAccessFail&&$.ajax({url:C.HOLIDAY_CALENDAR_FILE,async:!1,dataType:"text"}).done(function(t){0<t.length&&(t=t.replace(/(\r\n|\n|\r")/gm,",").split(","),_.forEach(t,function(t){t=h(t);t.isValid()&&!C.holidays.includes(t.format("YYYY-MM-DD"))&&C.holidays.push(t.format("YYYY-MM-DD"))})),C.holidayCalendarFileAccessFail=!1}).fail(function(t){console.log(t.responseText)});for(var u=n/Math.abs(n),c=n;0!==c;){o.add(u,"days");var p=o.day(),d=o.format("YYYY-MM-DD");C.workWeekDays.includes(p)&&!C.holidays.includes(d)&&(c-=u)}}else o.add(n,"days");break;case"time":case"minute":o.add(n,"minutes");break;case"second":o.add(n,"seconds");break;case"month":o.add(n,"months")}}(i=t.toString().match(/(?:@)(.+)$/))&&(s=Ki.Tools.convertUserInputToMoment(i[1],"HH:mm:ss.SSS")).isValid()&&!h.isDuration(o)&&(o.set({hour:s.hour(),minute:s.minute(),second:s.second(),millisecond:s.millisecond()}),s.nanosecond())&&o.nanosecond(s.nanosecond())}return o.toDashString()},C.convertViewSchemaToBackbone=function(e){var n=this,i={};return _.each(_.keys(e),function(t){_.isObject(e[t])?i[t]=n.convertViewSchemaToBackbone(e[t]):i[t]=e[t]}),f.Model.extend({defaults:function(){var e={};return _.each(_.keys(i),function(t){e[t]="function"==typeof i[t]?new i[t]:i[t]}),e}})},C.getGUID=function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},C.preventBackspaceBack=function(){$(document).on("keydown",function(t){var e,n=!1;(n=8===t.which?!("INPUT"===(e=t.srcElement||t.target).tagName.toUpperCase()&&!_.includes(["RADIO","CHECKBOX"],e.type.toUpperCase())||"TEXTAREA"===e.tagName.toUpperCase()||$(e).hasClass("nicEdit-main"))||e.readOnly||e.disabled:n)&&t.preventDefault()})},C.validateGuid=function(t){return!!_.isString(t)&&t.match(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i)},C.workWeekDays=[],C.holidays=[],C.holidayCalendarFileAccessFail=!0,C.workWeekFileAccessFail=!0,Ki.Helpers=C,Qi=A=A||{},zi=Qi.CommandoModel,e(D,zi),D.prototype.postInitialize=function(n){void 0===n&&(n=new Map);var i=this;_.each(i.getViewStateList(),function(t){"dict"===t.model.get("_type")&&(t.model.set("_default",_.mapValues(t.model.get("_default"),function(t,e){var n;return _.isString(t)&&0===t.indexOf("<%")?n=i.getByPath(t.substring(2,t.length-2)):_.isObject(t)&&(t._viewType?t=t.value:t.isViewState&&(n=i.getByPath(t.name))),n||t}),{silent:!0}),t.model.set("value",t.model.get("_default")));var e=n.get(t.path);e&&t.model.set("value",e.get("value"))})},D.prototype.clone=function(){return new D(this.attributes,{root:this.root,path:this.path},this.parent)},D.prototype.destroyOnServer=function(e){e=e?_.clone(e):{};function n(){a.trigger("destroy",a,a.collection,e)}var i,o,s,a=this,r=e.success,l=e.wait,t=!(e.success=function(t){l&&n(),r&&r.call(e.context,a,t,e),a.isNew()||a.trigger("sync",a,t,e)});return this.isNew()?_.defer(e.success):(i=this,s=(o=e).error,o.error=function(t){s&&s.call(o.context,i,t,o),i.trigger("error",i,t,o)},t=this.sync("delete",this,e)),l||n(),t},D.prototype.doCommand=function(t,e){var n;if(0<t.length)return n=t.reverse().join("/"),this.getByPath(n).doCommand(t,e)},D.prototype.getByPath=function(t){var e;if(t)return _.isObject(t)?(console.warn("getByPath is deprecated, please update component."),t):(t=_.filter(t.split("/"),function(t){return t&&0<t.length}),e=this,_.each(t,function(t){e&&e.get&&(e=e.get(t))}),e)},D.prototype.getViewStateExport=function(a){function r(e,n){var i,o,s,t;if(e&&e.attributes)return t=a?_.without.apply(_,st([_.keys(e.attributes)],["_settings",".settings"],!1)):_.keys(e.attributes),_.each(t,function(t){s=n?n+"/"+t:t,o=e.get(t),_.isObject(o)&&_.isFunction(o.get)&&(o.get("_viewType")?_.isEqual(o.get("value"),o.get("_default"))||(l[s]=o.get("value")):".settings"===s?(i=_.mapValues(o.attributes,function(t){return t.omit("version")}),_.isEmpty(i)||(l[".csettings"]=Qi.Tools.encodeToBase64(Qi.Tools.compress(JSON.stringify(i))))):r(o,s))}),l}var l={};return r(this,void 0)},D.prototype.getViewStateList=function(t){return this.viewStates=[],this.getViewStates(this),this.viewStates},D.prototype.getViewStates=function(e,n,i){var o,s,a=this;e.attributes&&_.each(_.keys(e.attributes),function(t){s=n?n+"/"+t:t,o=e.get(t),!i&&".settings"===t||(_.isObject(o)&&_.isFunction(o.get)&&o.get("_viewType")&&"."!==t.substr(0,1)?a.viewStates.push({model:o,path:s}):a.getViewStates(o,s,i))})},D.prototype.isGroup=function(){return!this.has("_type")},D.prototype.onChange=function(){var n=this;_.each(this.changedAttributes(),function(t,e){void 0===n.previous(e)&&t instanceof D?(n.stopListening(t,"change materialChange"),n.listenTo(t,"change",n.onChildModelChange),n.listenTo(t,"materialChange",n.onMaterialChange)):void 0===t&&n.previous(e)instanceof D&&(n.stopListening(n.previous(e),"change"),n.stopListening(n.previous(e),"materialChange"))}),this.changed&&_.some(this.MATERIAL_ATTRIBUTES,function(t){return n.hasChanged(t)})&&this.trigger("materialChange")},D.prototype.onChildModelChange=function(t,e){this.trigger("change",t,e)},D.prototype.postCommand=function(t,e){return e.path.push(this.id),this.parent.postCommand(this,e)},D.prototype.onMaterialChange=function(){this.trigger("materialChange")},D.prototype.setModelValue=function(i){var o=this,s=!1;"dict"===this.get("_type")&&_.each(_.pickBy(i,function(t,e){return o.get("value")[e]instanceof Qi.DocumentViewModel}),function(t,e){t=_.includes(_.keys(t),"value")?t.value:t;var n=o.get("value")[e];n.get("value")!==t&&(s=!0),n.setModelValue(t),i[e]=n}),this.set("value",i),s&&_.isEmpty(this.changed)&&this.trigger("change:value",this,i)},D.prototype.toJSON=function(o){var s=this,a={},t=_.keys(s.attributes);return o=!0===o||this.root&&this.root.withAllProperties,s.get("_rolling")&&Qi.Helpers.convertRollingToDate(s.get("_default"),s.get("_type"))===s.get("value")&&(t=_.without(t,"value")),_.each(t,function(t){var e,n=s.attributes[t],i={};if(".settings"===t)for(e in a[t]=n.toJSON(),a[t])a[t].hasOwnProperty(e)&&(a[t][e]=a[t][e].toJSON());else _.isObject(n)&&n.has&&n.has("_viewType")?(_.each(_.filter(_.keys(n.attributes),function(t){return!!o||0===t.indexOf("_")}),function(t){i[t]=n.get(t)}),"dict"===i._type&&(i._default=_.mapValues(n.get("_default"),function(t,e){return t instanceof D?"<%"+t.path+"%>":t}),i.value=_.mapValues(n.get("value"),function(t,e){return t instanceof D?"<%"+t.path+"%>":t})),a[t]=i):a[t]=n}),a},D.prototype.parse=function(t){var e;if(t&&t[".settings"]&&!((e=t[".settings"])instanceof f.Model)){for(var n in e)e.hasOwnProperty(n)&&(e[n]=new f.Model(e[n]));t[".settings"]=new f.Model(e)}return t},D.prototype.updateBinding=function(t,e,n,i,o){var s=_.isString(t)?this.getByPath(t):t;e.stopListening(n,"change:"+i),t&&s&&(o.push(s),n.set(i,s.get("value")),e.listenTo(s,"change:value",function(t,e){n.set(i,e)}),e.listenTo(n,"change:"+i,function(t,e){s.set("value",e)}))},D.prototype.updateBindingDeep=function(t,e,n,i,o){var s=this.get(t);e.stopListening(n,"change:"+i),t&&s&&(o.push(s),n.set(i,s.get("value")),e.listenTo(s,"change:value",function(t,e){n.set(i,e)}),e.listenTo(n,"change:"+i,function(t,e){s.set("value",e)}))},D.prototype.updateSchema=function(){var t=Qi.RTTI.getByName(this.get("_type")).editor;this.schema._default=t,this.schema.value=t},D.prototype.silentCast=function(t,e,n){this.get(t)instanceof e||this.set(t,new e(this.get(t),n),{silent:!0})},D.DATA_TYPES_ALL=["boolean","byte","char","date","datetime","dict","double","float","guid","int","list","long","minute","month","second","short","string","symbol","time","timespan","timestamp"],D.DATA_TYPES_ROLLING=["date","datetime","minute","month","second","time","timestamp"],D.KXDASHBOARD_WITH_VIEWSTATE_NAMED_ID="KXDASHBOARDS_DISTINCT_VIEWSTATE_id",Qi.DocumentViewModel=D;var _o=A=A||{};To=_o.CommandoModel,e(Co,To),Co.prototype.clone=function(){var t=this.toJSON(),e=(delete t.id,t.widgets=t.widgets.clone(),new Co(t,{},this.parent));return t.widgets.setParent(e),e},Co.prototype.defaults=function(){return{id:null,name:"Screen 1",thumb:null,widgets:new _o.WidgetCollection([],{},this),relativeHeight:void 0,rowCount:void 0,rowHeight:void 0,colCount:36,floatable:!0}},Co.prototype.commandSet=function(t){var n=this,e=_.mapValues(t,function(t,e){return n.previous(e)});this.postCommand(this,new _o.Command("Set Screen",[],[new _o.Todo(_o.CommandOp.Set,"",t)],[new _o.Todo(_o.CommandOp.Set,"",e)]))},Co.prototype.determineMaterialChange=function(){this.changed&&!_.isEmpty(_.omit(this.changed,this.IMMATERIAL_ATTRIBUTES))&&this.trigger("materialChange")},Co.prototype.doCommand=function(t,e){var n=this;if(0<t.length){var i=t.pop();if("widgets"===i)return this.get(i).doCommand(t,e);throw"Unsupported command key"}e.forEach(function(t){n.set(t.payload)})},Co.prototype.getComponents=function(){return this.get("widgets").getComponents()},Co.prototype.onMaterialChange=function(){this.trigger("materialChange")},Co.prototype.parseCastAndListen=function(t,e,n,i){!t||!t[e]||t[e]instanceof n||(t[e]=new n(t[e],{},this),this.listenTo(t[e],i,function(){this.trigger("change",this)}))},Co.prototype.parse=function(t){return this.parseCastAndListen(t,"widgets",_o.WidgetCollection,"change add remove"),t},Co.prototype.postCommand=function(t,e){return t instanceof _o.WidgetCollection&&e.path.push("widgets"),e.path.push(this.id),this.parent&&this.parent.postCommand(this,e)},Co.prototype.silentCast=function(t,e){this.get(t)instanceof e||this.set(t,new e(this.get(t),{},this),{silent:!0})};var To,ze=Co;function Co(t,e,n){t=To.call(this,t,e,n)||this;return t.IMMATERIAL_ATTRIBUTES=["isDefault","thumb","widgets"],t.get("id")||t.set({id:_o.Helpers.getGUID()},{silent:!0}),t.get("widgets")&&(t.silentCast("widgets",_o.WidgetCollection),t.listenTo(t.get("widgets"),"change add remove",function(t){this.trigger("change")})),t.listenTo(t,"change",t.determineMaterialChange.bind(t)),t.listenTo(t.get("widgets"),"materialChange",t.onMaterialChange.bind(t)),t}_o.Screen=ze,Do=_o.ComandoCollection,e(Eo,Do);var Do,c=Eo;function Eo(){var t=null!==Do&&Do.apply(this,arguments)||this;return t.descriptor="Screen",t}(_o.ScreenCollection=c).prototype.model=ze;var Mo=A=A||{};Po=Mo.CommandoModel,e(Ao,Po),Ao.prototype.convertPathsToModels=function(o){var e=this;_.each(this.attributes,function(i,t){i instanceof Array&&_.each(i,function(t,n){_.each(t,function(t,e){"viewstate"===t._dashboardsType&&(i[n][e]=o.getByPath(t.value))})}),"viewstate"===i._dashboardsType&&e.set(t,o.getByPath(i.value),{silent:!0})})},Ao.prototype.defaults=function(){return{visible:!1,dialogName:"",dialogTitle:"",dialogHeight:0,dialogWidth:0,modal:!1,resizable:!1,widgets:new Mo.WidgetCollection([],{},this),id:Mo.Helpers.getGUID()}},Ao.prototype.doCommand=function(t,e){var n=this;if(0<t.length){var i=t.pop();if("widgets"===i)return this.get(i).doCommand(t,e);throw"Unsupported command key"}e.forEach(function(t){t=_.isArray(t.payload)?_.find(t.payload,{id:n.id}):t.payload;t&&n.set(t)})},Ao.prototype.getComponents=function(){return this.get("widgets").getComponents()},Ao.prototype.postCommand=function(t,e){return t instanceof Mo.WidgetCollection&&e.path.push("widgets"),e.path.push(this.id),this.parent.postCommand(this,e)},Ao.prototype.onMaterialChange=function(){this.trigger("materialChange")},Ao.prototype.transformToWidgetCollection=function(){var t=this.get("widgets");t instanceof Mo.WidgetCollection||(t=new Mo.WidgetCollection(t?t[0]:[],{},this),this.set("widgets",t,{silent:!0}))};var Po,Io=Ao;function Ao(t,e,n){t=Po.call(this,t,e,n)||this;return t.idAttribute="id",t.get("id")||t.set({id:Mo.Helpers.getGUID()},{silent:!0}),t.transformToWidgetCollection(),t.listenTo(t,"change",t.onMaterialChange.bind(t)),t.listenTo(t.get("widgets"),"add remove materialChange",t.onMaterialChange.bind(t)),t}Mo.Popup=Io,ko=Mo.ComandoCollection,e(xo,ko),xo.prototype.commandSet=function(t){var n=this,e=[],i=this.toJSON(),o=[],e=_.differenceBy(t,i,function(t){return t.id}),s=_.filter(t,function(t){var e=n.get(t.id);return!!e&&e.changedAttributes(t)}),o=_.differenceBy(i,t,function(t){return t.id});e.length&&this.commandAdd(e.map(function(t){return new Io(t,{},n)})),_.each(s,function(t){n.postCommand(n,new Mo.Command(n.getCommandDescription(Mo.CommandOp.Set,t),[t.id],[new Mo.Todo(Mo.CommandOp.Set,"",t)],[new Mo.Todo(Mo.CommandOp.Set,"",i)]))}),o.length&&this.commandRemove(o.map(function(t){return n.get(t.id)||new Io(t,{},n)}))},xo.prototype.postInitialize=function(e){this.each(function(t){t.convertPathsToModels(e)}),this.trigger("viewStatesParsed"),this.listenTo(this,"add remove reset",function(){this.trigger("materialChange")})};var ko,n=xo;function xo(){var t=null!==ko&&ko.apply(this,arguments)||this;return t.descriptor="Popup",t}(Mo.PopupCollection=n).prototype.model=Io;var E=A=A||{};No=f.Model,e(M,No),M.reorganizePopupsAndMappers=function(d,h){var g={"Basics.DialogHeight":"dialogHeight","Basics.DialogTitle":"dialogTitle","Basics.DialogWidth":"dialogWidth","Basics.Modal":"modal","Basics.Resizable":"resizable","Basics.Visible":"visible","Basics.DialogName":"dialogName"},m=function(t){var n=[],p=function(e){var n,i,o,s,a,t,r,l,u=e.get("components"),c=e.get("widgets");e&&"Popup"===e.get("key")?(r=(t=e).get("options"),l={},_.each(g,function(t,e){e=r.get(e);_.isObject(e)&&"viewstate"===e._dashboardsType?l[t]=d.get("viewState").getByPath(e.value):l[t]=e}),l.widgets=t.get("widgets"),d.get("popups").add(l),h&&m(l.widgets)):e&&"QueryMapper"===e.get("key")?(o=(t=e).get("options").get("Basics.Mapping"),t=t.get("options").get("Basics.Data"),s={key:void 0,value:void 0,mappings:void 0},a=_.uniqueId("queryMapperUpgrade_"),(n=_.isObject(t)&&"data"===t._dashboardsType?d.get("data").getByPath(t.value):n)&&o&&o.length&&(i=n.get("_mappings")||{},n.subscribe(a,{onData:function(t,e){t=t.columns.collection.map("id");n.unsubscribe(a),s.key=t[0]||"",s.value=t[1]||"",s.mappings=i.mappings||{},_.each(o,function(t){t.Viewstate instanceof f.Model?s.mappings[t.Key]={_dashboardsType:"viewstate",value:t.Viewstate.path}:s.mappings[t.Key]=t.Viewstate||""}),n.set("_mappings",s),n.apply()}},!1))):u&&!u.isEmpty()?u.each(function(t){e&&_.includes(["Popup","QueryMapper"],e.get("key"))&&u.remove(t),p(t)}):c&&!c.isEmpty()&&m(c)};t.each(function(t){var e;(e=(t=t).get("component"))&&(_.includes(["Popup","QueryMapper"],e.get("key"))&&n.push(t),p(e))}),t.remove(n)};d.get(h?"popups":"screens").each(function(t){m(t.get("widgets"))})},M.renameCookie=function(t){_.each({viewStateDialogSize:"dashboard-viewStateDialog-size",viewStateDialogPosition:"dashboard-viewStateDialog-position",viewStateDialogWeights:"dashboard-viewStateDialog-weights","kx-datadialog-settings":"dashboard-datadialog-settings"},function(t,e){var n=$.cookie(e);$.removeCookie(e,{path:"/;SameSite=Strict"}),$.cookie(t,n,{secure:"https:"===_.get(window,"location.protocol"),path:"/;SameSite=Strict"})})},M.prototype.commandSet=function(t){var n=this,e=_.mapValues(t,function(t,e){return n.previous(e)}),t=new E.Command("Set Options",[],[new E.Todo(E.CommandOp.Set,"",t)],[new E.Todo(E.CommandOp.Set,"",e)]);this.postCommand(this,t)},M.prototype.defaults=function(){var t=new E.DocumentViewModel({selected:{_viewType:!0,_default:"0",value:""},".settings":new f.Model},{root:!0},this),e=new E.ScreenCollection([],{},this);return e.add(new E.Screen({isDefault:!0},{},e)),{id:null,name:"My New Dashboard",creationDate:null,lastUpdateDate:null,thumb:null,screenDetails:[],screens:e,popups:new E.PopupCollection([],{},this),tags:[],dashboardTheme:_.capitalize(($.cookie("dashboard-theme")||"dark").replace(/(kx-|room)/g,"")),themeSwitchable:!0,saveTimestamp:null,relativeHeight:void 0,rowCount:void 0,rowHeight:void 0,colCount:36,floatable:!0,viewState:t,data:new E.DocumentDataModel({},null,"",t,!0),permissionEntity:null,worksheetPadding:10,widgetsSpacing:0,borderColor:"000000",borderBackground:"000000",transparentBackground:!0,borderWidth:0,borderRounding:0,borderSpacing:0,borderShadow:!1,saveViewerState:"enabled",hostnameAccess:"",hidePdfGlobalVS:!1,hierarchicalRules:{ChartHierarchicalRules:[],GridHierarchicalRules:[]},hash:"",enableShareDashboard:!1,notifications:null,showLoadingIndicators:!0,unsavedViewerPrompt:!1,mainMenuButton:void 0,advancedCss:"",cssClasses:"",version:"v2.16.0"}},M.prototype.doCommand=function(t,e){var n=this;if(0<t.length){var i=t.pop();if(-1!=["screens","popups","data","viewState"].indexOf(i))return this.get(i).doCommand(t,e);throw"Unsupported command key"}e.forEach(function(t){n.set(t.payload)})},M.prototype.determineMaterialChange=function(){this.changed&&!_.isEmpty(_.omit(this.changed,this.IMMATERIAL_ATTRIBUTES))&&this.trigger("materialChange")},M.prototype.getComponents=function(){return this.get("screens").getComponents().concat(this.get("popups").getComponents())},M.prototype.onViewStateInit=function(t){void 0===t&&(t=!1),this.addSystemViewStates();var e=new Map,t=(t&&((null==(t=this.previous("viewState"))?void 0:t.viewStates)||[]).filter(function(t){return!t.path.startsWith("_settings")}).forEach(function(t){e.set(t.path,t.model)}),this.get("viewState").postInitialize(e),this.get("cssClasses"));t&&"viewstate"===t._dashboardsType&&this.set("cssClasses",this.get("viewState").getByPath(t.value),{silent:!0}),this.get("popups").postInitialize(this.get("viewState")),this.viewStateInit=!0},M.prototype.addSystemViewStates=function(){if(this.get("viewState").has("_settings")){var t,e=this.get("viewState").get("_settings"),n={dashboardAvailableMemoryThreshold:{_viewType:!0,_type:"int",_default:0}};for(t in n)e.has(t)||e.set(t,new E.DocumentViewModel(n[t],{}))}else this.get("viewState").set("_settings",new E.DocumentViewModel({dashboardUser:{_viewType:!0,_type:"symbol",_default:""},dashboardTimezone:{_viewType:!0,_type:"symbol",_default:""},dashboardUrl:{_viewType:!0,_type:"string",_default:""},dashboardTitle:{_viewType:!0,_type:"symbol",_default:""},dashboardStartTimestamp:{_viewType:!0,_type:"timestamp",_default:"",_rolling:!0},dashboardAvailableMemoryThreshold:{_viewType:!0,_type:"int",_default:0}},{path:"_settings",root:!0},this))},M.prototype.saveDelayed=function(t){var e=this;this.saveTimeout&&clearTimeout(this.saveTimeout),this.saveTimeout=setTimeout(function(){return e.saveNow(t)},this.SAVE_DELAY)},M.prototype.saveNow=function(t,e){var n,i=this,o=[];_.isEmpty(this.get("screens").models)?(t("Document is empty, skipping save."),E.Log.Warn("Document is empty, skipping save.")):(this.saveTimeout&&clearTimeout(this.saveTimeout),E.Log.Info("SAVE",this.id),this.set({lastUpdateDate:(new Date).toUTCString()},{silent:!0}),_.each(this.get("screens").models,function(t){o.push({label:t.get("name"),value:t.id})}),this.set({screenDetails:o}),this.set({thumb:0<this.get("screens").models.length?this.get("screens").models[0].get("thumb"):null},{silent:!0}),n=$.extend(!0,{},this.attributes),this.setDataProperties(n.notifications),this.setDataProperties(n.shortcuts),n.popups.each(function(t){t.set(i.setDataProperties(_.omit(t.attributes,"widgets")),{silent:!0})}),n.cssClasses=this.setViewStateProperty(n.cssClasses),this.save(n,{error:t,success:function(t){E.Log.Info("success",arguments),i.trigger("documentSaved"),i.set("wasChanged",!1),e&&e(t)}}))},M.prototype.silentCast=function(t,e,n){this.get(t)instanceof e||this.set(t,new e(this.get(t),n,this),{silent:!0})},M.prototype.setDataProperties=function(t){if(t){for(var e in t)t[e]&&t[e].path?t[e]instanceof E.DocumentDataModel?t[e]={_dashboardsType:"data",value:t[e].path}:t[e]instanceof E.DocumentViewModel&&(t[e]={_dashboardsType:"viewstate",value:t[e].path}):"object"==typeof t[e]&&(t[e]=this.setDataProperties(t[e]));return t}},M.prototype.setViewStateProperty=function(t){return t=t instanceof E.DocumentViewModel?{_dashboardsType:"viewstate",value:t.path}:t},M.prototype.toJSON=function(){var e=this,t=$.extend(!0,{},this.attributes);return this.setDataProperties(t.notifications),this.setDataProperties(t.shortcuts),t.popups.each(function(t){t.set(e.setDataProperties(_.omit(t.attributes,"widgets")))}),t.cssClasses=this.setViewStateProperty(t.cssClasses),t},M.prototype.toJSONClone=function(){var e=this,t=_.cloneDeep(this.attributes);return this.setDataProperties(t.notifications),this.setDataProperties(t.shortcuts),t.popups.each(function(t){t.attributes=_.extend(e.setDataProperties(_.omit(t.attributes,"widgets")),{widgets:t.get("widgets")})}),t.cssClasses=this.setViewStateProperty(t.cssClasses),t},M.prototype.parseCastAndListen=function(t,e,n,i,o){!t||!t[e]||t[e]instanceof n||(t[e]=o?o(t[e]):new n(t[e],{},this))},M.prototype.postCommand=function(t,e){return t instanceof E.ScreenCollection?e.path.push("screens"):t instanceof E.PopupCollection?e.path.push("popups"):t instanceof E.DocumentDataModel?e.path.push("data"):t instanceof E.DocumentViewModel&&e.path.push("viewState"),this.trigger("postCommand"),this.set("wasChanged",!0),M.parent&&M.parent.postCommand(this,e)},M.prototype.parse=function(n){var t=this.get("cssClasses");return t&&"viewstate"===t._dashboardsType&&this.set("cssClasses",this.get("viewState").getByPath(t.value)),this.parseCastAndListen(n,"viewState",E.DocumentViewModel,"change",function(t){return new E.DocumentViewModel(t,{root:!0},this)}),this.parseCastAndListen(n,"data",E.DocumentDataModel,"change",function(t){return new E.DocumentDataModel(t,null,"",n.viewState,!0)}),this.parseCastAndListen(n,"screens",E.ScreenCollection,"change add remove"),this.parseCastAndListen(n,"popups",E.PopupCollection,"change add remove"),this.viewStateInit&&this.get("popups").postInitialize(this.get("viewState")),_.each(n.shortcuts,function(t){var e=t.Data;e&&"data"===e._dashboardsType&&(t.Data=n.data.getByPath(e.value))}),n},M.prototype.upgrade=function(){var t,e;if(0<_.keys(this.attributes).length)for(t=E.Document.upgrades.indexOf(_.find(E.Document.upgrades,{version:this.get("version")}))+1;t<E.Document.upgrades.length;t+=1)(e=E.Document.upgrades[t]).fn(this),this.set("version",e.version)},M.upgrades=[{version:"4.3.0",fn:function(n){_.each(n.get("viewState").getViewStateList(),function(t){function e(t){return t=t instanceof E.DocumentViewModel?t.path:_.isObject(t)?t.name:t,n.get("viewState").getByPath(t)}"dict"===t.model.get("_type")&&(t.model.set("_default",_.mapValues(t.model.get("_default"),e)),t.model.set("value",_.mapValues(t.model.get("value"),e)))})}},{version:"4.4.0",fn:function(t){M.reorganizePopupsAndMappers(t,!1)}},{version:"4.4.0p7",fn:function(t){M.reorganizePopupsAndMappers(t,!0)}},{version:"4.6.0",fn:function(t){t.set("saveViewerState",!1===t.get("enableSaveViewState")?"disabled":"enabled")}},{version:"4.6.0P1",fn:function(t){M.renameCookie(t)}},{version:"4.7.3",fn:function(t){var e=t.get("hostnameAccess");t.set("hostnameAccess",_.isNil(e)?"":e)}},{version:"4.7.4",fn:function(t){var e=t.get("hash");t.set("hash",e||t.id)}},{version:"4.7.7",fn:function(t){M.reorganizePopupsAndMappers(t,!0)}},{version:"v2.3.0",fn:function(t){var e=t.get("hidePdfGlobalVS");t.set("hidePdfGlobalVS",_.isNil(e)?"":e)}},{version:"v2.12.0",fn:function(n){var i=n.get("hierarchicalRules");Array.isArray(i)&&(i.forEach(function(t,e){"Column"!==t.RuleType&&t.RuleType||void 0!==n.get("hierarchicalRules."+e+".UsePalette")||(i[e].UsePalette=!1)}),n.set("hierarchicalRules",i))}},{version:"v2.14.0",fn:function(t){var e=t.get("hierarchicalRules");Array.isArray(e)&&t.set("hierarchicalRules",{ChartHierarchicalRules:e,GridHierarchicalRules:[]})}},{version:"v2.16.0",fn:function(t){var e=t.get("mainMenuButton");t.set("mainMenuButton",_.isNil(e)?"Hide (End User only)":e)}}];var No,i=M;function M(t,e){var t=No.call(this,t,e)||this,n=(t.IMMATERIAL_ATTRIBUTES=["data","viewState","wasChanged"],t.sampleData=null,t.SAVE_DELAY=3e4,t.saveTimeout=null,t.viewStateInit=!1,t);return t.get("id")||(e=E.Helpers.getGUID(),t.set({id:e,hash:e},{silent:!0})),t.silentCast("viewState",E.DocumentViewModel,{root:!0}),t.silentCast("popups",E.PopupCollection),t.silentCast("screens",E.ScreenCollection),t.get("data")instanceof E.DocumentDataModel||t.set("data",new E.DocumentDataModel(t.get("data"),null,"",t.get("viewState"),!0),{silent:!0}),t.listenTo(t,"view-state-init",t.onViewStateInit),t.listenTo(t,"change",t.determineMaterialChange),t.listenTo(t.get("screens"),"change add remove",function(t){n.trigger("change",arguments)}),t.has("showLoadingIndicators")||t.set("showLoadingIndicators",!0,{silent:!0}),t}E.Document=i,Lo=f.Collection,e(Ro,Lo),Ro.prototype.getSortedDocuments=function(){return this.sortBy(function(t){return 3-(2*(_.includes(t.get("tags"),"defaultdash")?1:0)+(_.includes(t.get("tags"),"starred")?1:0))+t.get("name")})},Ro.requiredAccessLevel=null;var Lo,u=Ro;function Ro(t,e){t=Lo.call(this,t,e)||this;if(Ro.singleton)throw"Singleton Error! DocumentCollection() invoked 2x.";return Ro.singleton=t}function P(){return null!==Wi&&Wi.apply(this,arguments)||this}function Vo(){}function Oo(t){var e,n=this;(n=Gi.call(this,t)||this).cssClass=t.cssClass,n.anchorEl=t.anchorEl,n.data=t.data||{},n.text=t.text,n.position=t.position,n.$el.addClass("generic-tooltip "+n.cssClass);for(var i=t.anchorEl;i&&(null==(e=i.classList)||!e.contains("ui-dialog"));)i=i.parentNode;return null!=(t=null==i?void 0:i.classList)&&t.contains("ui-dialog")?n.$el.appendTo(i):n.$el.appendTo("#appdiv"),n.compileTemplate(),n}function Bo(){}function $o(){}function Uo(){}(E.DocumentCollection=u).prototype.model=i,v=A=A||{},Wi=v.DCBase,e(P,Wi),P.createLog=function(t,e,n){var i,o,s,a;this.deltaClient&&this.deltaClient.clientLoggingEnabled()&&(a=[],_.isString(t)&&(a=t.split("<--\x3e")),t=this.username,i=a[0]||"",o=a[1]||"",s=a[2]||"",a=a[3]||"",this.deltaClient.request("ClientLoggerAPI.log",function(t){_.isFunction(e)&&e()},function(t){console.log("Client logging FAILED\n\n"),null==t?console.log("Client logging: "+s+"failed. Data is null"):console.log("Client logging:",t.toString()),_.isFunction(n)&&n()},t,o,i,s,a))},P.deleteComponent=function(t,e,n){this.deltaClient.request("ComponentAPI.deleteComponent",function(t){e(t)},function(t){n(t)},t)},P.connectionCollectionSync=function(t,e,n){if("read"!==t)throw"data operation not supported for DocumentCollection";P.deltaClient.request("ConnectionAPI.getConnections",P.generateSuccessCallback(n),P.generateErrorCallback(n,"Error reading connections"))},P.testConnection=function(t,e,n){P.deltaClient.request("ConnectionAPI.updateConnections",e,n,[t],[])},P.deleteConnection=function(t){P.deltaClient.request("ConnectionAPI.updateConnections",function(){},function(){},[],[t])},P.connectionSync=function(t,e,n){var i,o=this;switch(t){case"update":(i=new win.ConnectionEntity).originalName=o.get("originalName");case"create":(i=i||new win.ConnectionEntity).name=o.id,i.host=o.get("host"),i.port=o.get("port"),i.user=o.get("user"),i.password=o.get("password"),i.type=o.get("type"),i.driver=o.get("driver"),i.tls=o.get("tls"),P.deltaClient.request("ConnectionAPI.updateConnections",P.generateSuccessCallback(n),P.generateErrorCallback(n,"Error "+t.substring(0,5)+"ing connection"),[i],[]);break;case"delete":P.deltaClient.request("ConnectionAPI.updateConnections",P.generateSuccessCallback(n),P.generateErrorCallback(n,"Error deleting connection"),[],[o.id]);break;default:throw"data operation not supported for Document"}},P.connectionGroupCollectionSync=function(t,e,n){if("read"!==t)throw"data operation not supported for ConnectionGroup Collection";P.deltaClient.request("ConnectionAPI.getConnectionGroups",P.generateSuccessCallback(n),P.generateErrorCallback(n,"Error reading connection groups"))},P.connectionGroupSync=function(t,e,n){var i;switch(t){case"create":(i=new win.ConnectionGroupEntity).name=this.id,i.type=this.get("type"),i.connections=this.get("connections"),i.connectionsType=this.get("connectionsType"),P.deltaClient.request("ConnectionAPI.createConnectionGroup",P.generateSuccessCallback(n),P.generateErrorCallback(n,"Error creating connection group"),i);break;case"update":(i=new win.ConnectionGroupEntity).name=this.id,i.type=this.get("type"),i.connections=this.get("connections");for(var o=0;o<i.connections.length;o+=1)i.connectionsType.push("default");P.deltaClient.request("ConnectionAPI.updateConnectionGroup",P.generateSuccessCallback(n),P.generateErrorCallback(n,"Error updating connection group"),i);break;case"delete":P.deltaClient.request("ConnectionAPI.deleteConnectionGroup",P.generateSuccessCallback(n),P.generateErrorCallback(n,"Error deleting connection group"),this.id);break;default:throw"data operation not supported for Connection Group"}},P.documentCollectionSync=function(t,e,n){if("read"!==t)throw"data operation not supported for DashCollection";P.deltaClient.request("ProjectAPI.getDashboards",function(t){var s=[];_.each(t,function(e){if(!e.accessLevel||!v.DocumentCollection.requiredAccessLevel||e.accessLevel===v.DocumentCollection.requiredAccessLevel)try{var t=JSON.parse(e.description),n=this.location.hostname,i=t.hostnameAccess,o=t.hash||"";(!i||0<=i.indexOf(n))&&s.push(new v.Document({id:e.name,name:e.displayName,creationDate:t.creationDate,lastUpdateDate:t.lastUpdateDate||t.creationDate,screenDetails:t.screenDetails||[],thumb:t.thumb||null,tags:t.tags||[],hostnameAccess:i,hash:o}))}catch(t){v.Log.Error("Error parsing dashboard description",e)}}),n.success&&n.success(s)},function(t){alert("Retrieve Dashboards FAILED"),n.error&&n.error(t)})},P.documentSync=function(t,e,n){function i(t){P.deltaClient.request("ProjectAPI.deleteDashboard",function(t){t?n.success&&n.success():n.error&&n.error()},function(t){n.error&&n.error(t)},t.id)}var o,s=this;switch(t){case"read":P.deltaClient.request("ProjectAPI.getDashboard",function(t){var e;t?((e=JSON.parse(t.dataJSON)).permissionEntity=t.permissionEntity,n.success&&n.success(e)):n.error&&n.error()},function(t){n.error&&n.error(t)},s.id);break;case"update":var a=s.get("hash"),r=s.id;a&&r!==a&&(i(s),s.set("id",a),e.set("id",a)),o={id:a||s.id,name:a||s.id,displayName:s.get("name"),description:JSON.stringify({creationDate:s.get("creationDate"),lastUpdateDate:s.get("lastUpdateDate"),tags:s.get("tags"),screenDetails:s.get("screenDetails"),thumb:s.get("thumb"),hostnameAccess:s.get("hostnameAccess"),hash:a},null,2),dataJSON:JSON.stringify(_.omit(s.attributes,["permissionEntity"]),null,2),class:"api.entity.DashboardEntity",permissionEntity:{permissions:s.get("permissionEntity")?s.get("permissionEntity").permissions:{}}},P.deltaClient.request("ProjectAPI.setDashboard",function(t){t?n.success&&(n.success(s.attributes),a)&&r!==a&&(window.location.hash="#"+a,window.location.reload()):n.error&&n.error()},function(t){n.error&&n.error(t)},o);break;case"delete":i(s);break;default:throw"data operation not supported for Document"}},P.documentViewSync=function(t,e,n){var i,o=this;switch(t){case"read":i=P.generateErrorCallback(n,"Error reading viewstate"),P.deltaClient.request("UserSettingsAPI.readUserSetting",function(t){var e;t?n.success&&(t&&t[0]&&(e=JSON.parse(t[0].jsonData)),n.success(e)):i()},i,o.id);break;case"create":case"update":i=P.generateErrorCallback(n,"Error updating viewstate"),P.deltaClient.request("UserSettingsAPI.updateUserSetting",function(t){t?n.success&&n.success(o.attributes):i()},i,{class:"api.entity.UserSettingEntity",id:o.id,type:"dashboard_view_state",jsonData:o.attributes});break;case"delete":i=P.generateErrorCallback(n,"Error deleting viewstate"),P.deltaClient.request("UserSettingsAPI.deleteUserSetting",function(t){t?n.success&&n.success():i()},i,o.id);break;default:throw"data operation not supported for user settings: "+t}},P.exportAnalyticData=function(t,e,n,i,o,s,a){var r=[],l=null;n=n||[],_.keys(o).length&&(l=this.processExportParams(o)),this.createParamsObj(r,n),P.exportData(i,t,r,l,e,s,a)},P.exportQueryData=function(t,e,n,i,o,s,a){var r=[],e=kdb.KDBQuery.create(e,void 0,void 0,!0);n&&(this.createParamsObj(r,n),e.parameters=r,_.keys(o).length)&&(e.uiParams=this.processExportParams(o)),P.exportData(i,e,null,null,t,s,a)},P.exportPivotData=function(t,e,n){var i,o=t.pivotSource,s=t.queryParams,a=[],r={},l="";t&&(t.exportName&&(l=t.exportName),t.exportParams)&&(r=t.exportParams),i=v.Pivot.constructPivotQuery(t),i=kdb.KDBQuery.create(i,void 0,void 0,!0),"query"===o&&(this.createParamsObj(a,s),i.parameters=a,_.keys(r).length)&&(i.uiParams=this.processExportParams(r)),P.exportData(l,i,null,null,t.connection,e,n)},P.exportData=function(n,t,e,i,o,s,a){var r=this,a=["ExportAPI.export"+(n?"ToFile":""),function(t){var e;_.isFunction(s)&&(e=t+"/"+(t=(n||t)+".zip"),t=r.deltaClient.connection.url+"/FileDownloadServlet?client="+r.deltaClient.base64DeltaClient()+"&filename="+t+"&filepath="+e,s(t))},a,t];e&&a.push(e),i&&a.push(i),a.push(o),n&&a.push(n),this.deltaClient.request.apply(this.deltaClient.request,a)},P.generateSuccessCallback=function(e){return function(t){e.success&&e.success(t)}},P.generateErrorCallback=function(e,n){return function(t){v.Log.Error(n,t),e.error&&e.error(t)}},P.getComponents=function(e,n){v.Log.Info("Running Get Components"),this.deltaClient.request("ComponentAPI.getComponents",function(t){e(t)},function(t){n(t)})},P.getDeltaAnalytics=function(e){this.deltaClient.request("AnalyticAPI.getAnalytics",function(t){e&&e(t)},function(){v.Log.Error("Failed to retrieve Analytics\n\n")})},P.getDeltaInstances=function(e){this.deltaClient.request("ConnectionAPI.getProcessInstances",function(t){e&&e(t)},function(){v.Log.Error("Failed to retrieve Instances\n\n")})},P.getPivotData=function(t,i,e,o){var n=t.connection,s=t.pivotSource,a=t.queryParams,r=[],l=t.maxRows||null,u=v.Pivot.constructPivotQuery(t),u=kdb.KDBQuery.create(u,l);"query"===s&&(this.createParamsObj(r,a),u.parameters=r),o&&o.trigger("serverStart"),this.deltaClient.request("QueryAPI.runQueryBA",function(t,e){o&&o.trigger("serverEnd");var n=v.deserialize(e);i&&i(n,e)},function(){e&&e(arguments)},u,n),"subscription"===t.subscriptionType&&(o&&o.trigger("serverStart"),this.deltaClient.request("SubscriptionAPI.addSubscription",function(t,e){i&&(o&&o.trigger("serverEnd"),e&&e.byteLength&&(t.dataSet=v.deserialize(e)),i(t,e))},function(t){e&&e(t)},u,n,1e3*t.subscriptionInterval))},P.getPolledSubscription=function(i){var t=this.deltaClient.connection.oobupdate;return{subscribe:function(n){var e=null==t?void 0:t.subscribe(function(t){var e;"QRPolledMessage"===(null==t?void 0:t.type)&&(null==(e=null==t?void 0:t.data)?void 0:e[0])===i&&n(t)});return{unsubscribe:function(){var t;null!=(t=null==e?void 0:e.unsubscribe)&&t.call(e)}}}}},P.getQueryData=function(t,e,n,i,o,s,a,r,l){P.getQueryData2(t,e,n,i,P.legacyRowCallback(o),s,a,r,l)},P.getQueryData2=function(t,n,e,i,o,s,a,r,l){var u,c,p,d,h=[],g=a&&0!=a?Number(a):null;r&&n&&_.includes(P.PAGING_TYPES,r.type)||(r={type:"NONE"}),"sql"===t?this.getSqlQueryData(n,this.strip(e),i,o,s,a):"pyKX"!==t&&(r&&"NONE"!==r.type?(c=new kdb.QDict,_.each(r.sorting,function(t,e){c.add(e,!0===t,kdb.KDB.BOOLEAN)}),(u=kdb.KDBQuery.createPaged(this.strip(e),r.type,r.num,r.size,c)).unlimitedRows=-1===r.size):u=kdb.KDBQuery.create(this.strip(e),g),i&&(this.createParamsObj(h,i),u.parameters=h),v.Log.Info("QUERY: ",u),p=this,a=[n?"QueryAPI.runQueryBA":"QueryAPI.runQuery",function(t,e){l&&l.trigger("serverEnd"),p.deltaClient.connection.removeResponder(_.get(d,"uid")?d.uid:null);t=n?v.deserialize(e):t;o&&o(t,e)},function(){p.deltaClient.connection.removeResponder(_.get(d,"uid")?d.uid:null),s&&s(arguments)},u],n&&a.push(n),l&&l.trigger("serverStart"),d=this.deltaClient.request.apply(this.deltaClient.request,a))},P.getConfigAPIDataWithProfile=function(t,e,n,i,o,s,a,r){n=[n,function(t){t&&a&&a(t)},function(){r&&r(arguments)},i,o,s];e&&n.push(e),this.deltaClient.request.apply(this.deltaClient.request,n)},P.getConfigAPIData=function(t,e,n,i,o,s){n=[n,function(t){t&&o&&o(t)},function(){s&&s(arguments)},i];e&&n.push(e),this.deltaClient.request.apply(this.deltaClient.request,n)},P.getConfigAPIDataNoParam=function(t,e,n,i,o){n=[n,function(t){t&&i&&i(t)},function(){o&&o(arguments)}];e&&n.push(e),this.deltaClient.request.apply(this.deltaClient.request,n)},P.getAPIQueryData=function(t,n,e,i,o,s){var a=[],r=kdb.APIQuery.create(e);r.lambda=e,this.createParamsObj(a,i),r.parameters=a,e=[n?"QueryAPI.runQueryBA":"QueryAPI.runQuery",function(t,e){t=n?v.deserialize(e):t;o&&o(t,e)},function(){s&&s(arguments)},r],n&&e.push(n),this.deltaClient.request.apply(this.deltaClient.request,e)},P.getSqlQueryData=function(t,e,n,i,o,s){var a,r=[],s=s||2e3;e=$.trim(e),n?(a=kdb.SQLQuery.create(e,s),this.createSqlParamsObj(r,n),a.parameters=r):a=kdb.SQLQuery.create(e,s),n&&(a=kdb.SQLQuery.create(e,s),this.createSqlParamsObj(r,n),a.parameters=r),this.deltaClient.request("QueryAPI.runQuery",function(t){i&&i(t)},function(){o&&o(arguments)},a,t)},P.isConnectionAlive=function(t){return this.deltaClient.request("ConnectionAPI.isAlive",function(t){v.Log.Info(t)},function(t){v.Log.Info(t)},t)},P.legacyRowCallback=function(n){return function(t,e){n&&(e&&e.byteLength&&(t.dataSet?t.dataSet=v.ipc.Parse.reshape(t.dataSet,e).toLegacy():t=v.ipc.Parse.reshape(t,e).toLegacy()),n(t))}},P.logout=function(){this.deltaClient?this.deltaClient.logout():($.removeCookie("deltaToken",{path:"/;SameSite=Strict"}),location.reload())},P.processExportParams=function(o){var s=new kdb.QDict;return _.each({columnLabel:"SYMBOL",dateFormat:"STRING"},function(e,t){var n,i;o[t]&&o[t].length&&(n=new kdb.QDict,i=o[t].split("&&"),_.each(i,function(t){t=t.trim().split("#");n.add(t[0],t[1],kdb.KDB[e])}),s.add(t,n,kdb.KDB.DICT))}),s},P.runAnalytic=function(t,e,n,i,o,s,a,r){P.runAnalytic2(t,e,n,P.legacyRowCallback(i),o,s,a,r)},P.runAnalytic2=function(e,n,t,i,o,s,a,r){var l,u,c=[],s=s&&0!=s?Number(s):null,p=this;t=t||[],n=n||"ds_rdb_fx_eval",a&&n&&_.includes(P.PAGING_TYPES,a.type)||(a={type:"NONE"}),this.createParamsObj(c,t),a&&"NONE"!==a.type?(r&&r.trigger("serverStart"),l=this.deltaClient.request(n?"AnalyticAPI.runPagedBA":"AnalyticAPI.runPaged",function(t,e){r&&r.trigger("serverEnd"),p.deltaClient.connection.removeResponder(_.get(l,"uid")?l.uid:null);t=n?v.deserialize(e):t;i&&i(t,e)},function(t){p.deltaClient.connection.removeResponder(_.get(l,"uid")?l.uid:null),v.Log.Error("Analytic run failed ("+e+")",t),o&&o(t)},e,c,n,a.type,a.num,a.size,_.keys(a.sorting)[0]||"",_.values(a.sorting)[0]||!1)):(r&&r.trigger("serverStart"),u=this.deltaClient.request(n?"AnalyticAPI.runBA":"AnalyticAPI.run",function(t,e){r&&r.trigger("serverEnd"),p.deltaClient.connection.removeResponder(_.get(u,"uid")?u.uid:null);t=n?v.deserialize(e):t;i&&i(t,e)},function(t){p.deltaClient.connection.removeResponder(_.get(u,"uid")?u.uid:null),v.Log.Error("Analytic run failed ("+e+")",t),o&&o(t)},e,c,n,s))},P.runApiFunction=function(n,t,e,i,o){var s=_.once(function(t,e){t?e&&i&&i(e):(v.Log.Error("Api Analytic run failed ("+n+")",e),o&&o(e)),clearTimeout(this.timeout)});this.timeout=_.delay(function(){s&&s(!1,"timed out")},this.DEFAULT_TIMEOUT),e=_.flatten([n,_.partial(s,!0,_),_.partial(s,!1,_),e]),this.deltaClient.request.apply(this.deltaClient,e)},P.servicesSync=function(t,e,n){throw"data operation not supported for Service"},P.servicesCollectionSync=function(t,e,n){if("read"!==t)throw"data operation not supported for Service Collection";P.deltaClient.request("ConnectionAPI.getServiceClasses",P.generateSuccessCallback(n),P.generateErrorCallback(n,"Error reading services data"))},P.setComponent=function(e,t,n,i,o,s){this.deltaClient.request("ComponentAPI.setComponent",function(t){v.Log.Info("Save component "+e+" successful",t),o(t)},function(t){v.Log.Error("Save Dashboard "+e+" FAILED"),s(t)},{name:e,displayName:t,description:n,dataJSON:i,class:"api.entity.ComponentEntity"})},P.startManagedAnalytic=function(t,e,n,i,o,s,a,r){P.startManagedAnalytic2(t,e,n,P.legacyRowCallback(i),o,s,a,r)},P.startManagedAnalytic2=function(n,i,t,e,o,s,a,r){var l=this,u=[],c=e||_.noop,p=a||null;this.createParamsObj(u,t=t||[]),r&&r.trigger("serverStart"),this.deltaClient.request(i?"AnalyticAPI.runBA":"AnalyticAPI.run",function(t,e){r&&r.trigger("serverEnd"),t=t||{},e&&e.byteLength&&(t=v.deserialize(e)),c(t,e),l.deltaClient.request("AnalyticAPI.startPolled",function(t,e){"com.fd.delta.stream.queryrouter.entity.QRResponseMessage"==t.class&&t.success?c({class:"207",add:!0,subId:t.runID,clientId:"polled"},void 0):o(t),P.getPolledSubscription(t.runID).subscribe(function(t){t.data[1]||o("Analytic Failed: "+t.data),r&&r.trigger("serverEnd"),t.appMsg&&t.appMsg.byteLength&&(t.data.class="209",t.data.subId=t.data[0],t.data.clientId="polled",t.data.dataSet=v.deserialize(t.appMsg)),c(t.data,t.appMsg)})},function(t){v.Log.Error("Managed Analytic run failed.",t),o&&o(t)},n,u,i,s,p)},function(t){v.Log.Error("Analytic run failed.",t),o&&o(t)},n,u,i,p)},P.startLegacyManagedQuery=function(t,e,n,i,o,s,a,r,l){P.startLegacyManagedQuery2(t,e,n,P.legacyRowCallback(i),o,s,a,r,l)},P.startLegacyManagedQuery2=function(t,e,n,i,o,s,a,r,l){var u,c,p=this,d=i||_.noop,i=[],a=a&&0!=a?Number(a):null,r=(r=r&&t&&_.includes(P.PAGING_TYPES,r.type)?r:{type:"NONE"})&&"NONE"!==r.type?(u=new kdb.QDict,_.each(r.sorting,function(t,e){u.add(e,!0===t,kdb.KDB.BOOLEAN)}),kdb.KDBQuery.createPaged(this.strip(e),r.type,r.num,r.size,u)):kdb.KDBQuery.create(this.strip(e),a);n&&(this.createParamsObj(i,n),r.parameters=i),e=[t?"QueryAPI.runQueryBA":"QueryAPI.runQuery",function(t,e){t=t||{},l&&l.trigger("serverEnd"),e&&e.byteLength&&(t=v.deserialize(e)),d(t,e),p.deltaClient.request.apply(p.deltaClient.request,c)},function(){o&&o(arguments)},r,t],c=["SubscriptionAPI.addSubscription",function(t,e){d&&(e&&e.byteLength&&(t.dataSet=v.deserialize(e)),d(t,e))},function(t){o&&o(t)},r,t,s],l&&l.trigger("serverStart"),this.deltaClient.request.apply(this.deltaClient.request,e)},P.startManagedQuery=function(t,e,n,i,o,s,a,r,l){P.startManagedQuery2(t,e,n,P.legacyRowCallback(i),o,s,a,r,l)},P.startManagedQuery2=function(t,e,n,i,o,s,a,r,l){var u,c=i||_.noop,i=[],a=a&&0!=a?Number(a):null,r=(r=r&&t&&_.includes(P.PAGING_TYPES,r.type)?r:{type:"NONE"})&&"NONE"!==r.type?(u=new kdb.QDict,_.each(r.sorting,function(t,e){u.add(e,!0===t,kdb.KDB.BOOLEAN)}),kdb.KDBQuery.createPaged(this.strip(e),r.type,r.num,r.size,u)):kdb.KDBQuery.create(this.strip(e),a);n&&(this.createParamsObj(i,n),r.parameters=i),l&&l.trigger("serverStart"),this.deltaClient.request("QueryAPI.startPolledQuery",function(t){"com.fd.delta.stream.queryrouter.entity.QRResponseMessage"==t.class&&t.success?c({class:"207",add:!0,subId:t.runID,clientId:"polled"},void 0):o(t),P.getPolledSubscription(t.runID).subscribe(function(t){if(l&&l.trigger("serverEnd"),!t.data[1])return o("Query Failed: "+t.data);t.appMsg&&t.appMsg.byteLength&&(t.data.class="209",t.data.subId=t.data[0],t.data.clientId="polled",t.data.dataSet=v.deserialize(t.appMsg)),c(t.data,t.appMsg)})},function(){o&&o(arguments)},r,t,s)},P.startStreamingAnalytic=function(t,e,n,i,o,s){P.startStreamingAnalytic2(t,e,n,P.legacyRowCallback(i),o,s)},P.startStreamingAnalytic2=function(n,t,e,i,o,s){var a=[];this.createParamsObj(a,e||[]),s&&s.trigger("serverStart"),this.deltaClient.request("AnalyticAPI.startStreaming",function(t,e){s&&s.trigger("serverEnd"),e&&e.byteLength&&(t.dataSet=v.deserialize(e)),e&&10===e.byteLength&&101===new DataView(e).getInt8(8)?v.Log.Info("Streaming "+n+" returned unary primitive!"):i&&i(t,e)},function(t){v.Log.Info("Analytic run failed.",t),o&&o(t)},n,a,t)},P.strip=function(t){var e;return _.isNil(t)||0===t.trim().length||!t.startsWith(P.PYKX_API)&&!t.startsWith(P.SQL_API)&&(t=t.replace(/((^|\s+)\/.*$)|^\s+|\s*\n/gm," "),e=/^\{(.*)\}\s*\[\]\s*$/g.exec(t))&&(t=e[1]),t},P.removeSubscriptions=function(t){function i(t){t&&r.deltaClient.connection.removeResponder(t)}var e,o,s,a,n,r=this;t?(o=t.startsWith("polled:"),s=o?t.substring(7):t.split(":")[1],a=r.deltaClient.request(o?"QueryAPI.stopPolledQuery":"SubscriptionAPI.removeSubscription",function(t){var e,n;o&&null!=(e=null==(n=P.getPolledSubscription(s).subscribe(function(){}))?void 0:n.unsubscribe)&&e.call(n),i(null==a?void 0:a.uid),v.Log.Info("Stop Subscriptions succeeded.",t)},function(t){var e;i(null!=(e=null==a?void 0:a.uid)?e:null),v.Log.Error("Stop Subscriptions failed",t)},o?[s]:t),i(s)):(n=r.deltaClient.request("SubscriptionAPI.removeSubscriptions",function(t){i(null==n?void 0:n.uid),v.Log.Info("Stop Subscriptions succeeded.",t)},function(t){var e;i(null!=(e=null==n?void 0:n.uid)?e:null),v.Log.Error("Stop Subscriptions failed",t)}),null!=(e=null==(t=r.deltaClient.connection.oobupdate.filter(function(t){return"QRPolledMessage"===t.type}))?void 0:t.unsubscribe)&&e.call(t))},P.updateTable=function(n,t,e){for(var i=this,o=[],s=0;s<3;s+=1)o[s]={type:"dict",value:{},index:s};_.each(n.updateParams,function(t){o.push(t)}),_.each(o,function(t,e){t.index=e}),_.each(n.addedDict.items,function(t,e){o[0].value[e]={type:i.updateTableGetListType(n.typeConfig[e],t),value:t}}),_.each(n.updatedDict.items,function(t,e){o[1].value[e]={type:i.updateTableGetListType(n.typeConfig[e],t),value:t}}),_.each(n.deletedDict.items,function(t,e){o[2].value[e]={type:i.updateTableGetListType(n.typeConfig[e],t),value:t}}),"analytic"===n.updateType?n.updateAnalytic&&i.runAnalytic(n.updateAnalytic,n.connection,o,t,e):i.getQueryData("kdb",n.connection,n.query,o,t,e)},P.updateTableGetListType=function(t,e){var n;switch(t){case 0:return n=_.isArray(e)?_.isBoolean(e[0])?"listlistboolean":_.isString(e[0])?"listliststring":"listlistsymbol":_.isString(e)?"string[]":"symbol[]";case 1:return"boolean[]";case 2:return"guid[]";case 4:return"byte[]";case 5:return"short[]";case 6:return"int[]";case 7:return"long[]";case 8:return"real[]";case 9:return"float[]";case 10:return n="char[]",_.each(e,function(t){1<t.length&&(n="string[]")}),n;case 11:return"symbol[]";case 12:return"timestamp[]";case 13:return"month[]";case 14:return"date[]";case 15:return"datetime[]";case 16:return"timespan[]";case 17:return"minute[]";case 18:return"second[]";case 19:return"time[]";default:return"symbol[]"}},P.createDeltaObj=function(n){function i(t){return _.has(t,"i")||"string"!=typeof t?t:(10<(t=t.replace("D","T").replace(/(\d\d\d\d)\.(\d\d)\.(\d\d)/,"$1-$2-$3")).length&&(t+="Z"),v.Tools.convertISODatetimeToKDBLikeObject(t))}var o,s,a,e;switch(n.type.toLowerCase()){case"boolean":(o=new kdb.QBoolean).setValue("string"==typeof n.value?"1b"==n.value:n.value);break;case"guid":o=new kdb.QGUID,e="string"==typeof n.value?n.value.match(/"G"\$"(.+)"$/):n.value,o.value=e?e[1]:"0Ng"==n.value?null:n.value;break;case"symbol":o=new kdb.QSymbol,e="string"==typeof n.value?n.value.match(/`\$"(.*)"$/):n.value,o.value=e?e[1]:n.value;break;case"byte":(o=new kdb.QByte).value="string"==typeof n.value?parseInt(n.value):n.value;break;case"short":(o=new kdb.QShort).value=parseInt(n.value,10);break;case"int":case"integer":(o=new kdb.QInt).value=parseInt(n.value,10);break;case"long":(o=new kdb.QLong).value="number"==typeof n.value?n.value:parseInt(n.value,10);break;case"real":(o=new kdb.QReal).value=parseFloat(n.value);break;case"float":case"double":(o=new kdb.QFloat).value=parseFloat(n.value);break;case"char":(o=new kdb.QChar).setValue(n.value);break;case"timestamp":o=new kdb.QTimeStamp,null!==n.value&&(a=i(n.value),o.setValue(a.i),a)&&a.n&&(o.nanoValue=a.n);break;case"month":o=new kdb.QMonth,null!==n.value&&o.setValue(_.has(n.value,"i")?n.value.i:n.value);break;case"date":o=new kdb.QDate,null!==n.value&&o.setValue(i(n.value).i);break;case"datetime":o=new kdb.QDateTime,null!==n.value&&o.setValue(i(n.value).i);break;case"timespan":(o=new kdb.QTimeSpan).setValue(_.has(n.value,"i")?n.value.i:n.value);break;case"minute":(o=new kdb.QMinute).setValue(_.has(n.value,"i")?n.value.i:n.value);break;case"second":(o=new kdb.QSecond).setValue(_.has(n.value,"i")?n.value.i:n.value);break;case"time":(o=new kdb.QTime).setValue(_.has(n.value,"i")?n.value.i:n.value);break;case"string":(o=new kdb.QString).setValue(n.value);break;case"string[]":o=new kdb.QList,s=[],_.each(n.value,function(t){(a=new kdb.QString).setValue(t),s.push(a)}),o.value=s;break;case"symbol[]":case"liststring":case"list":o=new kdb.QList,s=[],"string"==typeof n.value&&(e=n.value.match(/^\((.+)\)$/),n.value=e?e[1].split(";"):[n.value]),_.each(n.value,function(t){e="string"==typeof t?/`\$"(.*)"$/.exec(t):null,(a=new kdb.QSymbol).setValue(e?e[1]:t),s.push(a)}),o.value=s;break;case"listobject":o=new kdb.QList,s=[],_.each(n.value,_.bind(function(t){_.isEmpty(t)||(t=this.createDeltaObj(t),s.push(t))},this)),o.value=s;break;case"listlistsymbol":(o=new kdb.QList).value=_.map(n.value,function(t){var e=new kdb.QList;return e.value=_.map(t,function(t){var e=new kdb.QSymbol;return e.setValue(t),e}),e});break;case"listlistboolean":(o=new kdb.QList).value=_.map(n.value,function(t){var e=new kdb.QList;return e.value=_.map(t,function(t){var e=new kdb.QBoolean;return e.setValue(t),e}),e});break;case"listliststring":(o=new kdb.QList).value=_.map(n.value,function(t){var e=new kdb.QList;return e.value=_.map(t,function(t){var e=new kdb.QString;return e.setValue(t),e}),e});break;case"listlong":o=new kdb.QList,s=[],_.each(n.value,function(t){(a=new kdb.QLong).setValue(t),s.push(a)}),o.value=s;break;case"listtimestamp":o=new kdb.QList,s=[],_.each(n.value,function(t){var e=new kdb.QTimeStamp;null===t?e.setValue("0Np"):(a=i(t),e.setValue(a.i),a&&a.n&&(e.nanoValue=a.n)),s.push(e)}),o.value=s;break;case"dict":o=new kdb.QDict,_.each(n.value,_.bind(function(t,e){var n=t;_.isString(t)&&(n={type:"symbol",value:t}),t=this.createDeltaObj(n),o.values.push(t),o.fields.push(e)},this));break;case"table":o=new kdb.QFlip,_.each(n.value.columns,function(t,e){o.fields.push(t),o.values.push(this.createDeltaObj({type:n.value.types[e]+"[]",value:n.value.values[e]}))}.bind(this));break;case"nulltype":o=new kdb.QDict;break;case"listdate":o=new kdb.QList,s=[],_.each(n.value,function(t){var e=new kdb.QDate;null===t?e.setValue("0Nd"):e.setValue(i(t).i),s.push(e)}),o.value=s;break;default:-1<n.type.toLowerCase().indexOf("[]")&&(o=new kdb.QList,s=[],_.each(n.value,_.bind(function(t,e){s.push(this.createDeltaObj({type:n.type.toLowerCase().replace("[]",""),value:t,index:e}))},this)),o.value=s)}return o.orderIndex=n.index,o},P.createParamsObj=function(e,t){var n,i=0;t.attributes?n=t.attributes:t&&(n=t),n&&(_.each(n,_.bind(function(t){t.type&&"t"!==t.type&&("symbol[]"===t.type&&(t.type="list"),e[i]=this.createDeltaObj(t),i+=1)},this)),e.sort(function(t,e){return t.orderIndex-e.orderIndex}))},P.createSqlParamsObj=function(e,t){var i,o,s,n,a,r=0;t.attributes?n=t.attributes:t&&(n=t),a=function(t){var n;switch(t.type.toLowerCase()){case"boolean":(n=new kdb.SQLBoolean).value=t.value;break;case"guid":case"symbol":(n=new kdb.SQLVarChar).value=t.value;break;case"byte":(n=new kdb.SQLByte).value=t.value;break;case"short":(n=new kdb.SQLShort).value=t.value;break;case"int":case"integer":(n=new kdb.SQLInt).value=parseInt(t.value,10);break;case"long":(n=new kdb.SQLLong).value=t.value;break;case"real":(n=new kdb.SQLFloat).value=t.value;break;case"float":(n=new kdb.SQLFloat).value=parseFloat(t.value);break;case"double":(n=new kdb.SQLDouble).setValue(t.value);break;case"char":(n=new kdb.SQLVarChar).value=t.value;break;case"timestamp":(n=new kdb.SQLTime).setValue(t.value);break;case"month":(n=new kdb.SQLInt).setValue(t.value);break;case"date":case"datetime":(n=new kdb.SQLTime).setValue(new Date(t.value));break;case"timespan":(n=new kdb.SQLTime).setValue(t.value);break;case"minute":case"second":(n=new kdb.SQLInt).setValue(t.value);break;case"time":(n=new kdb.SQLTime).setValue(t.value);break;case"string":n=new kdb.SQLList,s=t.value.split(""),i=[],_.each(s,function(t){(o=new kdb.SQLVarChar).value=t,i.push(o)}),n.value=i;break;case"list":n=new kdb.SQLList,i=[],_.each(t.value,function(t){(o=new kdb.SQLVarChar).setValue(t),i.push(o)}),n.value=i;break;case"symbol[]":n=new kdb.SQLList,i=[],_.each(t.value,function(t){(o=new kdb.SQLVarChar).setValue(t),i.push(o)}),n.value=i;break;case"listtimestamp":n=new kdb.SQLList,i=[],_.each(t.value,function(t){(o=new kdb.SQLTime).setValue(t),i.push(o)}),n.value=i;break;case"dict":n=new kdb.SQLDict,_.each(t.value,function(t,e){t=a(t);n.values.push(t),n.fields.push(e)});break;case"nulltype":n=new kdb.SQLDict}return n.orderIndex=t.index,n.setName(t.name),n},n&&(_.each(n,function(t){t.type&&"t"!==t.type&&("symbol[]"===t.type&&(t.type="list"),e[r]=a(t),r+=1)}),e.sort(function(t,e){return t.orderIndex-e.orderIndex}))},P.parameterRx=new RegExp("<%([^<>%]+?)%>","g"),P.DEFAULT_NULL_VAL=-0x8000000000000000,P.PAGING_TYPES=["OFFSET","OFFSET_NOCACHE","PAGENO","PAGENO_NOCACHE"],P.PYKX_API=".pykx.dash",P.SQL_API=".s.e",v.DeltaClientLib=P,qe=A=A||{},Vo.clearAll=function(t){t?$("body .field-error").fadeOut():$("body .field-error").remove()},Vo.clear=function(t,e){t&&(e?t.fadeOut():t.remove())},Vo.show=function(t,e,n){if(t&&e)return(t=$("<div></div>",{text:t}).addClass("field-error").appendTo("body")).position({of:$(e),my:n?"right center":"left center",at:n?"left center":"right center",collision:"flip fit",using:function(t,e){"right"===e.horizontal?$(this).addClass("error-left-side"):$(this).removeClass("error-left-side"),$(this).css({left:t.left+"px",top:t.top+"px"})}}),t},qe.ErrorTooltip=Vo,Ye=A=A||{},Gi=f.View,e(Oo,Gi),Oo.prototype.remove=function(){return f.View.prototype.remove.call(this)},Oo.prototype.renderTemplate=function(t){try{var e,n,i=!this.anchorEl||!(!this.anchorEl.offsetWidth||!this.anchorEl.offsetHeight);i&&this.anchorEl&&(e=document.getElementsByClassName("document-view")[0].getBoundingClientRect(),i=(n=this.anchorEl.getBoundingClientRect()).bottom>=e.top&&n.top<=e.bottom),this.el.style.display=i?"":"none",i&&(this.el.innerHTML="<div>"+this.templateFn(_.extend({},this.data,t))+"</div>",this.updatePosition(this.position))}catch(t){console.log(this.cssClass+" handlebars render error.",t)}},Oo.prototype.updateCSS=function(t){return this.$el.css(_.reduce(t,function(t,e,n){return t[n]=e,t},{})),this},Oo.prototype.updatePosition=function(t){var a,r=this,l=document.getElementsByClassName("document-view")[0].getBoundingClientRect();return this.anchorEl&&(a=this.anchorEl.getBoundingClientRect()),this.updateCSS(_.mapValues(_.pickBy(t,function(t){return!_.isNil(t)}),function(t,e){var t=Math.max(0,t),n=(t+=a?a[e]:0,$(window).width()),i=$(window).height(),o=r.$el.outerHeight(),s=r.$el.outerWidth();return("left"===e||"right"===e)&&n<t+s?t=n-s:"top"!==e&&"bottom"!==e||(i<t+o?t=i-o:l&&t<l.top&&(t=l.top)),t+"px"}))},Oo.prototype.updateTooltip=function(t){var n=this;return _.each(t,function(t,e){n[e]=t}),this},Oo.prototype.compileTemplate=function(){try{this.templateFn=s.compile(this.text)}catch(t){console.log(this.cssClass+" handlebars compile error.",t)}},Oo.directions=["left","right","top","bottom"],Ye.GenericTooltip=Oo,Ke=A=A||{},Bo.getTooltip=function(t,e){t=t?Bo.TOOLTIP_DESCRIPTIONS[t]:null;return e?e+":\n\n"+t:t},Bo.TOOLTIP_DESCRIPTIONS={Name:"A user-defined name that can be used to uniquely identify this component.",Label:"Text label for the component",AcceptEmptyValues:"When checked, a null value is available for selection.",AcceptEmptyValuesNote:"\n\nNOTE: The data column for the dropdown requires a null value to be present.\nOtherwise, a null value will not be added to the list.",ShowSearch:"Includes a search box for filtering results",AdvancedSearch:"Supports wildcard searches using an asterisk (*) to match any character,\na logical and/or using the text ' and ', or using the text ' or ' followed\nby another search pattern, or items can be omitted from the search\nresults by using a dash (-) followed by the search pattern for exclusion.\ne.g.:\n\tEUR and GBP\n\tEUR or GBP\n\tEUR -*GBP",FieldSummaryThreshold:"Presents summarized selection in the input field when the number of\nselected items exceeds this value.",TooltipSummaryThreshold:"Maximum number of selected items that can appear in the tooltip",SortListBySelected:"When the dropdown is expanded, the selected values will be displayed\nat the top of the list."},Ke.ComponentPropertyTooltip=Bo,(w=A=A||{}).getComponentDefinitionCollection=function(){return new w.ComponentDefinitionCollection},w.getDocumentCollection=function(t,e){return w.DocumentCollection.singleton||new w.DocumentCollection(t,e)},w.getDocument=function(t){return new w.Document(t)},w.getDocumentView=function(t){return w.Dash.DashEngine.activator(t.appModel,t.viewModel),new w.DocumentView(t)},w.getBackboneModel=function(t){return new f.Model(t)},w.InitializeQuickbase=function(i){var o;this.initialized?i():(this.initialized=!0,$.ui.tabs.prototype._isLocal=function(){return!0},o=$.cookie("dashboard-language")||"en",require.config({paths:{cldr:"./locale/cldr","cldr-data":"./locale/cldr-data",globalize:"./locale/globalize",locales:"./locale/locales"}}),require(["json!locales/messages.json"],function(t){function e(t){return n[t]||t||""}var n=t[o||"en"]||{};window.t=e,s.registerHelper("moment",function(t,e,n){if(null!=t||!e){if(null==t&&null==e)return h.locale("en"),h().format("MMMM DD, YYYY");var i={lang:"en",date:new Date},i=_.extend({},i,t,e,n);if(i=_.extend({},i,i.hash),h.locale(i.lang),"string"==typeof t&&"string"==typeof e)return h(t).format(e);if(w.Tools.isKDBTemporal(t))return n=w.Tools.convertKDBTemporalToMoment(t),h.isDuration(n)?n.formatNano(e):n.format(e);if(i.hash){i.context&&_.extend(i.hash,i.context);var o,s=h(t);for(o in i.hash){if(s[o])return s[o](i.hash[o]);console.log('moment.js does not support "'+o+'"')}}return"object"==typeof t?h(t).format(e):"string"!=typeof t||e?h(t).format(e):h().format(t)}}),s.registerHelper("t",e),s.registerHelper("typeOf",function(t){var e=Object.prototype.toString,n=function(t){return t.constructor?t.constructor.name:null};if(void 0===t)return"undefined";if(null===t)return"null";var i=typeof t;if("boolean"===i)return"boolean";if("string"===i)return"string";if("number"===i)return"number";if("symbol"===i)return"symbol";if("function"===i)return"GeneratorFunction"===n(t)?"generatorfunction":"function";if(w.Tools.isKDBTemporal(t))return w.Tools.Types.kdbToDashboard[t.class];if(_.isArray(t))return"array";if(_.isBuffer(t))return"buffer";if(_.isArguments(t))return"arguments";if(_.isDate(t))return"date";if(_.isError(t))return"error";if(_.isRegExp(t))return"regexp";switch(n(t)){case"Symbol":return"symbol";case"Promise":return"promise";case"WeakMap":return"weakmap";case"WeakSet":return"weakset";case"Map":return"map";case"Set":return"set";case"Int8Array":return"int8array";case"Uint8Array":return"uint8array";case"Uint8ClampedArray":return"uint8clampedarray";case"Int16Array":return"int16array";case"Uint16Array":return"uint16array";case"Int32Array":return"int32array";case"Uint32Array":return"uint32array";case"Float32Array":return"float32array";case"Float64Array":return"float64array"}if("function"==typeof(n=t).throw&&"function"==typeof n.return&&"function"==typeof n.next)return"generator";switch(i=e.call(t)){case"[object Object]":return"object";case"[object Map Iterator]":return"mapiterator";case"[object Set Iterator]":return"setiterator";case"[object String Iterator]":return"stringiterator";case"[object Array Iterator]":return"arrayiterator"}return i.slice(8,-1).toLowerCase().replace(/\s/g,"")}),s.registerHelper("isNull",function(t,e){return!0!==e&&_.isString(t)?0===t.length:_.isNull(t)}),s.registerHelper("encodeURI",function(t){return null==t?"":encodeURI(t)}),s.registerHelper("encodeURIComponent",function(t){return null==t?"":encodeURIComponent(t)}),s.registerHelper("toISOString",function(t){return w.Tools.convertKDBToViewstateValue(t)}),s.registerHelper("UTCtoTimeZone",function(t,e,n){if(null!=t)return e="string"==typeof e?e:"YYYY-MM-DD HH:mm:ss.SSSSSSSSS",w.Tools.convertValueToMoment(t)[(n=!!_.isNil(n)||n)?"formatNano":"format"](e)}),s.registerHelper("formatTimestamps",function(t,n){var i,e;if(!_.isNil(t))return n="string"==typeof n?n:"YYYY-MM-DD HH:mm:ss.SSSSSSSSS",!(e=(i=t).match(/\d{4}.\d{2}.\d{2}D\d{2}:\d{2}:\d{2}.\d{9}/gm))||e.length<0?new s.SafeString(t):(_.forEach(e,function(t){var e=t.replace(/\./,"-").replace(/\./,"-").replace(/D/,"T").concat("Z"),e=w.Tools.dateUTCSafeFormatFromJsDate(e,n,!0);i=i.replace(t,e)}),new s.SafeString(i))}),s.registerHelper("smartNumber",function(t){t=parseFloat(t);return isNaN(t)?t:w.Tools.smartFormatNumber(t,0)}),s.registerHelper("each_with_sort",function(t,e,n,i){var o=s.createFrame((null==i?void 0:i.data)||{}),t=_.sortBy(t,function(t){t=null==t?void 0:t[e];return"number"==typeof t||isNaN(Number(t))?t:Number(t)});return(t="desc"===n?t.reverse():t).reduce(function(t,e,n){return o&&(o.index=n),t+i.fn(e,{data:o})},"")}),_.isFunction(i)&&i({globalize:void 0,language:o})}))},w.initializeEmbedded=function(o,t,e,s){require(["jquery","underscore","backbone","select2","jqueryui"],function(){$.cookie("dashboard-viewer-theme","kx-light",{expires:30,path:"/;SameSite=Strict",secure:"https:"===_.get(window,"location.protocol")}),$.cookie("dashboard-theme","kx-light",{expires:30,path:"/;SameSite=Strict",secure:"https:"===_.get(window,"location.protocol")});var n=$.fn.select2,t=($.fn.select2=function(t){var e;return t&&void 0===t.dropdownParent&&(e=$(".dialog-panel>.document"),t.dropdownParent=e),n.call(this,t)},$.fn.select2.amd=n.amd,$.fn.select2.defaults=n.defaults,w.Tools.timezone="UTC",w.DashClientLib),e=w.DocumentSyncHelpers.buildDocumentSync(o.config.parameters.documentAPI,t.documentSync),i=w.DocumentSyncHelpers.buildDocumentCollectionSync(o.config.parameters.documentAPI);w.Helpers.preventBackspaceBack(),w.Document.prototype.sync=e,w.DocumentCollection.prototype.sync=i,w.DocumentCollection.requiredAccessLevel="update",w.Connection.prototype.sync=t.connectionSync,w.ConnectionCollection.prototype.sync=t.connectionCollectionSync,Object.assign(w.DocumentDataModel.prototype,t),w.DeltaClientLib.PIVOT_SOURCE_CODE=w.DashClientLib.PIVOT_SOURCE_CODE,w.DashClient.client=o.dashClient,w.DeltaClientLib=w.DashClient,w.getDocumentCollection(null,null).fetch({success:function(){$(o.dashClient).trigger("DeltaClientConnect"),$(o.dashClient).trigger("DeltaClientLogin"),w.InitializeQuickbase(function(){s()})}})}),require(["css!css/font-awesome-4.7.0/css/font-awesome.min.css","css!css/material-icons/css/material-icons.min.css","css!css/jquery-ui-fa.css","css!kx-darkroom","css!kx-light","css!QuickView/css/main.css"]),o.config.appConfig.hasPermission(w.CustomAPIPermission.canExportData)||require(["css!QuickBase/css/user.css"])},w.processIncomingSession=function(n,t,e){var i=t.get("incomingSession");i&&e&&w.DashClient.runAPI(".api.getViewstateSessions","gw",[{type:"symbol",value:i}],function(t){console.log("Successfully retrieved Session Viewstates with ID ".concat(i," from Session Table."));var t=_.get(t,"rows.0.viewstates");t&&(t=JSON.parse(t))&&_.each(t,function(t,e){e=n.get("viewState").getByPath(e);e&&e.set("value",t.value)})},function(t){w.Log.Error("ERROR: Unable to retrieve Session Viewstates with ID ".concat(i," from the Session Table."),t)})},w.processIncomingViewState=function(n,t){var e=t.get("incomingViewState");e&&(_.each(e,function(t,e){var i=n.get("viewState").getByPath(e);i&&(".settings"===e?_.each(t,function(t,e){var n=i.get(e);n?n.set(t):(n=new f.Model(t),i.set(e,n))}):i.set("value",t))}),t.unset("incomingViewState"))},w.getViewStateExport=function(t,e,n){void 0===e&&(e=[]),void 0===n&&(n=!0);var i=t.get("viewState").getViewStateExport();return e.forEach(function(t){i[t]=void 0}),i?(t=JSON.stringify(i),n?encodeURIComponent(t):t):""},w.getViewstateFromQueryString=function(t){var t=/(^|&|\?)viewstate=([^&;]+?)(&|;|$)/.exec(t),e=null;return t&&(e=JSON.parse(decodeURIComponent(t[2])))[".csettings"]&&(e[".settings"]=JSON.parse(w.Tools.decompress(w.Tools.decodeFromBase64(e[".csettings"]))),delete e[".csettings"]),e},c=(c=A=A||{}).ipc||(c.ipc={}),$o.getType=function(t){return $o.typeDict[t]},$o.mergeTypedArraysUnsafe=function(t,e){var n=new t.constructor(t.length+e.length);return n.set(t),n.set(e,t.length),n},$o.fromHexString=function(t){return new Uint8Array(((t||"").match(/.{1,2}/g)||[]).map(function(t){return parseInt(t,16)}))},$o.toHexString=function(t){for(var e="",n=0;n<t.length;n++){var i=t[n].toString(16);e+=1===i.length?"0"+i:i}return e},$o.pack=function(t){for(var e=[],n=0,i=t.length;n<i;)e.push((255&t[n++])<<8|255&t[n++]);return String.fromCharCode.apply(null,e)},$o.base64=function(t){return btoa(String.fromCharCode.apply(null,t))},$o.toMessage=function(t){var e=$o.createBuffer(8);return e.wi(1),e.wi(t.length+8),$o.mergeTypedArraysUnsafe(e.data,t)},$o.createBuffer=function(t){var e={data:new Uint8Array(t),i:0,wb:function(t){e.data[e.i++]=t},wi:function(t){_.times(4,function(){e.wb(255&t),t>>=8})}};return e},$o.typeDict={10:c.QString,0:c.List,"-1":c.Boolean,"-2":c.Symbol,"-4":c.Byte,"-5":c.Short,"-6":c.Int,"-7":c.QLong,"-8":c.Float,"-9":c.Double,"-10":c.Char,"-11":c.Symbol,"-12":c.Timestamp,"-13":c.Month,"-14":c.QDate,"-15":c.DateTime,"-16":c.Timespan,"-17":c.Minute,"-18":c.Second,"-19":c.Time},c.Util=$o,ze=A=A||{},Uo.getFunctionList='kys: raze (raze k!{@[{ {".",(string y),".",string x}[;x] each key[`$".",string x] };x;{`}]} each k: (key `) except `j`q`Q`h`o`u; string key `.); select name,parameters:{flip `name`type!(x 1;`Symbol)} each parameters from ({`name`parameters!((`$x);(value (value x))) } each exec name from ({ `name`t!(x;type value x) } each kys) where (not (name like "*.")) and t=100h)',Uo.getFunctions=".api.getFunctions",Uo.executeSql=".s.e",Uo.getTables='raze (raze k!{@[{ {".",(string y),".",string x}[;x] each tables[`$".",string x] };x;{`}]} each k: key `; tables `.)',Uo.isSqlSupported="`e in key `.s",Uo.isPyKxSupported="`dash in key `.pykx",Uo.testConnectionQuery="1+1",ze.KdbQuery=Uo;n=A=A||{};qo=f.Model,e(Ho,qo),Ho.prototype.defaults=function(){return{listViewThumb:null,ghostViewThumb:null,buildViewThumb:null,appKey:null,appArgs:null,name:null,description:null}};var qo,Fo,Yo=Ho;function Ho(){return null!==qo&&qo.apply(this,arguments)||this}function Ko(){var t=null!==Fo&&Fo.apply(this,arguments)||this;return t.model=Yo,t}n.ComponentDefinition=Yo,Fo=f.Collection,e(Ko,Fo),n.ComponentDefinitionCollection=Ko,f.emulateHTTP=!0;u=A=A||{};Qo=f.Model,e(Go,Qo),Go.prototype.defaults=function(){return{name:"default",type:"kdb",connections:[],connectionsType:[]}};var Qo,zo,Wo=Go;function Go(){return null!==Qo&&Qo.apply(this,arguments)||this}function jo(){var t=null!==zo&&zo.apply(this,arguments)||this;return t.model=Wo,t}(u.ConnectionGroup=Wo).prototype.idAttribute="name",zo=f.Collection,e(jo,zo),u.ConnectionGroupCollection=jo,f.emulateHTTP=!0;i=A=A||{};Xo=f.Model,e(ts,Xo),ts.prototype.defaults=function(){return{name:"default",type:"q",host:"localhost",port:"80",tls:"false",user:"",password:""}};var Xo,Zo,Jo=ts;function ts(){return null!==Xo&&Xo.apply(this,arguments)||this}function es(){var t=null!==Zo&&Zo.apply(this,arguments)||this;return t.model=Jo,t}function ns(t,e){t=Xi.call(this,t,e)||this;return ji.Document.parent=t,eo.init(!t.get("buildMode")),t.listenTo(t,"change:selectedDocumentId",t.resetCommands.bind(t)),t}function is(){}function os(e){var n=Ji.call(this,e)||this;return n.$dialog=null,n.$nameInput=null,n.container=null,n.appModel=null,n.viewModel=null,n.appModel=e.appModel,n.container=e.container,n.viewModel=e.viewModel,n.el.className="quick-base window dashboard-name-prompt",n.$el.html(Zi.T.AboutDialog(_.extend({DeltaClientHost:location.hostname,DeltaClientPort:location.port||("https:"==location.protocol?443:80)},n.appModel.toJSON()))),n.$nameInput=n.$el.find(".name-input"),n.$dialog=n.$el.dialog(_.extend({appendTo:n.container,classes:{"ui-dialog":"quick-base about-dialog"},title:t("About"),resizable:!0,height:329,width:470,modal:!0,autoOpen:!0,draggable:!0,open:function(){$('<i class="fa fa-info-circle" ></i>').insertBefore(n.$el.parent().find(".ui-dialog-title"))},close:function(){n.remove()}},e)),n}function ss(t){var n=to.call(this)||this;return n.HEADING_HEIGHT=28,n.onUpdate=t.onUpdate,n.sections=t.sections||[],n.$el=t.el,n.$el.addClass("dash-accordion accordion"),n.sections.forEach(function(t,e){t.$el&&(t.$heading=t.$el.find(t.$heading),t.$content=t.$el.find(t.$content),t.$el.addClass("section"),t.$heading.click(function(){n.onClick(t)}))}),n.debouncedRemoveAnimate=_.debounce(function(){n.$el.removeClass("animate"),n.onUpdate&&n.onUpdate(n.sections)},300),n.updateLayout(!1),n}function as(){_.extend(this,f.Events)}(i.Service=Jo).prototype.idAttribute="name",Zo=f.Collection,e(es,Zo),i.ServiceCollection=es,ji=A=A||{},Xi=f.Model,e(ns,Xi),ns.GetModel=function(t){return new ns(t)},ns.prototype.defaults=function(){return{commands:[],commandIndex:-1,buildMode:!0,isInspecting:!1,selectedDocumentId:null,selectedScreenId:null,selectedWidgetId:null,selectedSubComponent:null,userConfigurable:!1,componentsPanel:new f.Model({search:null})}},ns.prototype.goToCommandIndex=function(t){var e=this.get("commandIndex"),n=this.get("commands"),i=ji.DocumentCollection.singleton.get(this.get("selectedDocumentId"));if(t===e&&(t-=1),e<t)for(var o=e+1;o<=t;o++)0<=o&&o<n.length&&i.doCommand(_.clone(n[o].path),n[o].todo);else if(t<e)for(o=e;t<o;o--)0<=o&&o<n.length&&i.doCommand(_.clone(n[o].path),n[o].undo);this.set("commandIndex",t)},ns.prototype.doCommand=function(t,e){},ns.prototype.postCommand=function(t,e){var n=this.get("commands"),i=this.get("commandIndex");i<n.length-1&&n.splice(i+1,n.length-i-1),n.push(e),ji.Log.Info("AppViewModel::onCommand",this.get("commands")),this.goToCommandIndex(i+1)},ns.prototype.redo=function(){this.goToCommandIndex(this.get("commandIndex")+1)},ns.prototype.resetCommands=function(){this.set("commands",[],{silent:!0}),this.set("commandIndex",-1,{silent:!0}),this.trigger("change:commandIndex","RESET")},ns.prototype.undo=function(){this.goToCommandIndex(this.get("commandIndex")-1)},ji.AppViewModel=ns,qe=A=A||{},is.AboutDialog=s.template({1:function(t,e,n,i,o){var s,a=t.lambda,r=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"            <tr>\n                <td>Delta Control Host:</td>\n                <td>"+r(a(null!=(s=null!=e?t(e,"dashboardControlDetails"):e)?t(s,"dchost"):s,e))+"</td>\n            </tr>\n            <tr>\n                <td>Delta Control Port:</td>\n                <td>"+r(a(null!=(s=null!=e?t(e,"dashboardControlDetails"):e)?t(s,"dcport"):s,e))+"</td>\n            </tr>\n            <tr>\n                <td>Delta Control TLS:</td>\n                <td>"+r(a(null!=(s=null!=e?t(e,"dashboardControlDetails"):e)?t(s,"dctls"):s,e))+"</td>\n            </tr>\n            <tr>\n                <td>KDB Banner:</td>\n                <td>"+r(a(null!=(s=null!=e?t(e,"dashboardControlDetails"):e)?t(s,"bannerText"):s,e))+"</td>\n            </tr>\n            <tr>\n                <td>KDB Version:</td>\n                <td>"+r(a(null!=(s=null!=e?t(e,"dashboardControlDetails"):e)?t(s,"kdbVersion"):s,e))+"</td>\n            </tr>\n            <tr>\n                <td>KDB Release Date:</td>\n                <td>"+r(a(null!=(s=null!=e?t(e,"dashboardControlDetails"):e)?t(s,"releaseDate"):s,e))+"</td>\n            </tr>\n            <tr>\n                <td>KDB Update Date:</td>\n                <td>"+r(a(null!=(s=null!=e?t(e,"dashboardControlDetails"):e)?t(s,"updateDate"):s,e))+"</td>\n            </tr>\n"},3:function(t,e,n,i,o){var s,a=null!=e?e:t.nullContext||{},r=t.hooks.helperMissing,l=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"            <tr>\n                <td>"+l("function"==typeof(s=null!=(s=t(n,"key")||(null!=e?t(e,"key"):e))?s:r)?s.call(a,{name:"key",hash:{},data:o,loc:{start:{line:63,column:20},end:{line:63,column:27}}}):s)+":</td>\n                <td>"+l("function"==typeof(s=null!=(s=t(n,"value")||(null!=e?t(e,"value"):e))?s:r)?s.call(a,{name:"value",hash:{},data:o,loc:{start:{line:64,column:20},end:{line:64,column:29}}}):s)+"</td>\n            </tr>\n"},compiler:[8,">= 4.3.0"],main:function(t,e,n,i,o){var s=null!=e?e:t.nullContext||{},a=t.hooks.helperMissing,r="function",l=t.escapeExpression,u=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]},l='<div class="splash">\n    <div class="version">'+l(typeof(c=null!=(c=u(n,"PackageName")||(null!=e?u(e,"PackageName"):e))?c:a)==r?c.call(s,{name:"PackageName",hash:{},data:o,loc:{start:{line:2,column:25},end:{line:2,column:40}}}):c)+'</div>\n    <div class="scroll">\n        <p>Copyright in KX Dashboards belongs to FD Technologies plc.  FD Technologies plc 2009-2018. All rights reserved. Use of the software is subject to the terms of FD Technologies plcs license agreement. KX and kdb+ are trademarks of KX Systems Inc.<br>KX Systems Inc. is a subsidiary of FD Technologies plc. Portions of the KX Dashboards software use code and/or materials under license from third-party suppliers.</p>\n        <table style="width: 100%;">\n            <tr>\n                <td>'+l((u(n,"t")||e&&u(e,"t")||a).call(s,"User Name",{name:"t",hash:{},data:o,loc:{start:{line:7,column:20},end:{line:7,column:37}}}))+":</td>\n                <td>"+l(typeof(c=null!=(c=u(n,"userName")||(null!=e?u(e,"userName"):e))?c:a)==r?c.call(s,{name:"userName",hash:{},data:o,loc:{start:{line:8,column:20},end:{line:8,column:32}}}):c)+"</td>\n            </tr>\n            \x3c!--\n            <tr>\n                <td>"+l((u(n,"t")||e&&u(e,"t")||a).call(s,"Delta Client Host",{name:"t",hash:{},data:o,loc:{start:{line:12,column:20},end:{line:12,column:45}}}))+":</td>\n                <td>"+l(typeof(c=null!=(c=u(n,"DeltaClientHost")||(null!=e?u(e,"DeltaClientHost"):e))?c:a)==r?c.call(s,{name:"DeltaClientHost",hash:{},data:o,loc:{start:{line:13,column:20},end:{line:13,column:39}}}):c)+"</td>\n            </tr>\n            <tr>\n                <td>"+l((u(n,"t")||e&&u(e,"t")||a).call(s,"Delta Client Port",{name:"t",hash:{},data:o,loc:{start:{line:16,column:20},end:{line:16,column:45}}}))+":</td>\n                <td>"+l(typeof(c=null!=(c=u(n,"DeltaClientPort")||(null!=e?u(e,"DeltaClientPort"):e))?c:a)==r?c.call(s,{name:"DeltaClientPort",hash:{},data:o,loc:{start:{line:17,column:20},end:{line:17,column:39}}}):c)+"</td>\n            </tr>\n            <tr>\n                <td>&nbsp;</td>\n            </tr>\n            <tr>\n                <td>"+l((u(n,"t")||e&&u(e,"t")||a).call(s,"Delta Control",{name:"t",hash:{},data:o,loc:{start:{line:23,column:20},end:{line:23,column:41}}}))+":</td>\n            </tr>--\x3e\n"+(null!=(p=u(n,"unless").call(s,null!=e?u(e,"isLite"):e,{name:"unless",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:25,column:12},end:{line:54,column:23}}}))?p:"")+"            <tr>\n                <td>&nbsp;</td>\n            </tr>\n            <tr>\n                <td>"+l((u(n,"t")||e&&u(e,"t")||a).call(s,"UI Components",{name:"t",hash:{},data:o,loc:{start:{line:59,column:20},end:{line:59,column:41}}}))+":</td>\n            </tr>\n",c=null!=(c=u(n,"paths")||(null!=e?u(e,"paths"):e))?c:a,a={name:"paths",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o,loc:{start:{line:61,column:12},end:{line:66,column:22}}},p=typeof c==r?c.call(s,a):c;return null!=(p=u(n,"paths")?p:t.hooks.blockHelperMissing.call(e,p,a))&&(l+=p),l+"        </table>\n    </div>\n</div>"},useData:!0}),is.AreYouSureDialog=s.template({1:function(t,e,n,i,o){var s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<p>\n    "+t.escapeExpression("function"==typeof(n=null!=(n=s(n,"message")||(null!=e?s(e,"message"):e))?n:t.hooks.helperMissing)?n.call(null!=e?e:t.nullContext||{},{name:"message",hash:{},data:o,loc:{start:{line:3,column:4},end:{line:3,column:15}}}):n)+"\n</p>\n"},3:function(t,e,n,i,o){var s,a=null!=e?e:t.nullContext||{},r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<p>\n    Components "+(null!=(s=r(n,"if").call(a,null!=e?r(e,"dashChanged"):e,{name:"if",hash:{},fn:t.program(4,o,0),inverse:t.noop,data:o,loc:{start:{line:8,column:15},end:{line:8,column:46}}}))?s:"")+"have unsaved changes:\n    <ul>\n"+(null!=(s=r(n,"each").call(a,null!=e?r(e,"components"):e,{name:"each",hash:{},fn:t.program(6,o,0),inverse:t.noop,data:o,loc:{start:{line:10,column:8},end:{line:12,column:17}}}))?s:"")+"    </ul>\n</p>\n"},4:function(t,e,n,i,o){return"also "},6:function(t,e,n,i,o){var s=t.lambda,a=t.escapeExpression,r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'        <li><span title="'+a(s(null!=e?r(e,"widget"):e,e))+'">'+a(s(null!=e?r(e,"component"):e,e))+"</span>"+(null!=(a=r(n,"if").call(null!=e?e:t.nullContext||{},null!=e?r(e,"message"):e,{name:"if",hash:{},fn:t.program(7,o,0),inverse:t.noop,data:o,loc:{start:{line:11,column:67},end:{line:11,column:112}}}))?a:"")+"</li>\n"},7:function(t,e,n,i,o){var s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return": "+t.escapeExpression(t.lambda(null!=e?s(e,"message"):e,e))},compiler:[8,">= 4.3.0"],main:function(t,e,n,i,o){var s,a=null!=e?e:t.nullContext||{},r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(s=r(n,"if").call(a,null!=e?r(e,"dashChanged"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:1,column:0},end:{line:5,column:7}}}))?s:"")+(null!=(s=r(n,"if").call(a,null!=e?r(e,"components"):e,{name:"if",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o,loc:{start:{line:6,column:0},end:{line:15,column:7}}}))?s:"")+'<p>Would you like to save?</p>\n<div class="error-info" style="color: red;">\n    There was an error saving this dashboard.\n\n    <ul class="error-list"></ul>\n</div>'},useData:!0}),is.ColorPickr=s.template({compiler:[8,">= 4.3.0"],main:function(t,e,n,i,o){return'\n<div class="color-pickr-container">\n    <div class="color-pickr">\n    </div>\n</div>'},useData:!0}),is.ComponentView=s.template({compiler:[8,">= 4.3.0"],main:function(t,e,n,i,o){var s=null!=e?e:t.nullContext||{},a=t.hooks.helperMissing,r=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="border-div">\n    <div class="expand-btn-div"></div>\n    <div class="title-div"></div>\n    <div class="app-div dashboard-dark"></div>\n</div>\n\n<div class="errorMessage ui-state-header">\n    <div class="errorPanel ui-state-error">\n        <div class="errorTitle"><i class="fa fa-exclamation-triangle"></i><span>'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"Error",{name:"t",hash:{},data:o,loc:{start:{line:9,column:80},end:{line:9,column:93}}}))+'</span></div>\n        <span class="errorText"></span>\n    </div>\n    <div class="errorPanel ui-state-warning">\n        <div class="errorTitle"><i class="fa fa-exclamation-circle"></i><span>'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"Warning",{name:"t",hash:{},data:o,loc:{start:{line:13,column:78},end:{line:13,column:93}}}))+'</span></div>\n        <span class="errorText"></span>\n    </div>\n    <div class="errorPanel ui-state-highlight">\n        <div class="errorTitle"><i class="fa fa-info-circle"></i><span>'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"Info",{name:"t",hash:{},data:o,loc:{start:{line:17,column:71},end:{line:17,column:83}}}))+'</span></div>\n        <span class="errorText"></span>\n    </div>\n</div>\n\n<div class="queryStatus ui-state-header">\n    <div class="statusPanel Error ui-state-error">\n        <div class="statusTitle"><i class="fa fa-exclamation-triangle"></i><span>'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"Error",{name:"t",hash:{},data:o,loc:{start:{line:24,column:81},end:{line:24,column:94}}}))+'</span></div>\n        <span class="statusText"></span>\n    </div>\n    <div class="statusPanel Warning ui-state-warning">\n        <div class="statusTitle"><i class="fa fa-exclamation-circle"></i><span>'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"Warning",{name:"t",hash:{},data:o,loc:{start:{line:28,column:79},end:{line:28,column:94}}}))+'</span></div>\n        <span class="statusText"></span>\n    </div>\n    <div class="statusPanel Info ui-state-highlight">\n        <div class="statusTitle"><i class="fa fa-info-circle"></i><span>'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"Info",{name:"t",hash:{},data:o,loc:{start:{line:32,column:72},end:{line:32,column:84}}}))+'</span></div>\n        <span class="statusText"></span>\n    </div>\n    <div class="statusPanel Loading ui-state-highlight">\n        <div class="statusTitle"><i class="fa fa-spinner fa-pulse"></i><span>'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"Loading",{name:"t",hash:{},data:o,loc:{start:{line:36,column:77},end:{line:36,column:92}}}))+'</span></div>\n        <span class="statusText"></span>\n    </div>\n<div class="statusPanel NoResults ui-state-highlight">\n        <div class="statusTitle"><i class="fa fa-info-circle"></i><span>'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"No Results",{name:"t",hash:{},data:o,loc:{start:{line:40,column:72},end:{line:40,column:90}}}))+'</span></div>\n        <span class="statusText"></span>\n    </div>\n</div>\n\n<div class="progress-bar-div" style="width: 100%; height: 100%; overflow: hidden; position: absolute; left: 0; top: 0; z-index: 999;">\n    <div class="loading" style="display: table; width: 100%; height: 100%; max-height: 100%; opacity: 0.9; overflow: hidden;">\n        <div style="display: table-cell; width: 100%; height: 100%; max-height: 100%; vertical-align: middle; text-align: center;">\n            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" width="32" height="32" fill="#ffffff">\n                <circle cx="16" cy="3" r="0">\n                    <animate attributeName="r" values="0;3;0;0" dur="1s" repeatCount="indefinite" begin="0" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" calcMode="spline" ></animate>\n                </circle>\n                <circle transform="rotate(45 16 16)" cx="16" cy="3" r="0">\n                    <animate attributeName="r" values="0;3;0;0" dur="1s" repeatCount="indefinite" begin="0.125s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" calcMode="spline" ></animate>\n                </circle>\n                <circle transform="rotate(90 16 16)" cx="16" cy="3" r="0">\n                    <animate attributeName="r" values="0;3;0;0" dur="1s" repeatCount="indefinite" begin="0.25s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" calcMode="spline" ></animate>\n                </circle>\n                <circle transform="rotate(135 16 16)" cx="16" cy="3" r="0.567031">\n                    <animate attributeName="r" values="0;3;0;0" dur="1s" repeatCount="indefinite" begin="0.375s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" calcMode="spline" ></animate>\n                </circle>\n                <circle transform="rotate(180 16 16)" cx="16" cy="3" r="1.82452">\n                    <animate attributeName="r" values="0;3;0;0" dur="1s" repeatCount="indefinite" begin="0.5s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" calcMode="spline" ></animate>\n                </circle>\n                <circle transform="rotate(225 16 16)" cx="16" cy="3" r="2.88475">\n                    <animate attributeName="r" values="0;3;0;0" dur="1s" repeatCount="indefinite" begin="0.625s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" calcMode="spline" ></animate>\n                </circle>\n                <circle transform="rotate(270 16 16)" cx="16" cy="3" r="2.1029">\n                    <animate attributeName="r" values="0;3;0;0" dur="1s" repeatCount="indefinite" begin="0.75s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" calcMode="spline" ></animate>\n                </circle>\n                <circle transform="rotate(315 16 16)" cx="16" cy="3" r="0.60761">\n                    <animate attributeName="r" values="0;3;0;0" dur="1s" repeatCount="indefinite" begin="0.875s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" calcMode="spline" ></animate>\n                </circle>\n                <circle transform="rotate(180 16 16)" cx="16" cy="3" r="1.82452">\n                    <animate attributeName="r" values="0;3;0;0" dur="1s" repeatCount="indefinite" begin="0.5s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" calcMode="spline" ></animate>\n                </circle>\n            </svg>\n            <div class="loadingText" style="font-weight: bold; margin-top: 7px; font-size: 11px; letter-spacing: 1px;">\n                '+r((t(n,"t")||e&&t(e,"t")||a).call(s,"loading",{name:"t",hash:{},data:o,loc:{start:{line:78,column:16},end:{line:78,column:31}}}))+" "+r("function"==typeof(r=null!=(r=t(n,"componentName")||(null!=e?t(e,"componentName"):e))?r:a)?r.call(s,{name:"componentName",hash:{},data:o,loc:{start:{line:78,column:32},end:{line:78,column:49}}}):r)+"...\n            </div>\n        </div>\n    </div>\n</div>"},useData:!0}),is.DocumentSelector=s.template({1:function(t,e,n,i,o){var s,a=null!=e?e:t.nullContext||{},r=t.hooks.helperMissing,l=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <option value="'+l("function"==typeof(s=null!=(s=t(n,"id")||(null!=e?t(e,"id"):e))?s:r)?s.call(a,{name:"id",hash:{},data:o,loc:{start:{line:3,column:19},end:{line:3,column:25}}}):s)+'">'+l("function"==typeof(s=null!=(s=t(n,"name")||(null!=e?t(e,"name"):e))?s:r)?s.call(a,{name:"name",hash:{},data:o,loc:{start:{line:3,column:27},end:{line:3,column:35}}}):s)+"</option>\n"},compiler:[8,">= 4.3.0"],main:function(t,e,n,i,o){return"<select>\n"+(null!=(n=(t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]})(n,"each").call(null!=e?e:t.nullContext||{},e,{name:"each",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:2,column:4},end:{line:4,column:13}}}))?n:"")+"</select>\n"},useData:!0}),is.DocumentView=s.template({compiler:[8,">= 4.3.0"],main:function(t,e,n,i,o){return'<div class="screen-view-div">\n</div>\n\n'},useData:!0}),is.InBrowserNotification=s.template({1:function(t,e,n,i,o){var s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <i class="icon fa fa-'+t.escapeExpression("function"==typeof(n=null!=(n=s(n,"icon")||(null!=e?s(e,"icon"):e))?n:t.hooks.helperMissing)?n.call(null!=e?e:t.nullContext||{},{name:"icon",hash:{},data:o,loc:{start:{line:3,column:25},end:{line:3,column:33}}}):n)+'"></i>\n'},3:function(t,e,n,i,o){var s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <div class="ttl">'+t.escapeExpression("function"==typeof(n=null!=(n=s(n,"title")||(null!=e?s(e,"title"):e))?n:t.hooks.helperMissing)?n.call(null!=e?e:t.nullContext||{},{name:"title",hash:{},data:o,loc:{start:{line:7,column:21},end:{line:7,column:30}}}):n)+"</div>\n"},5:function(t,e,n,i,o){var s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <div class="msg">'+(null!=(s="function"==typeof(n=null!=(n=s(n,"message")||(null!=e?s(e,"message"):e))?n:t.hooks.helperMissing)?n.call(null!=e?e:t.nullContext||{},{name:"message",hash:{},data:o,loc:{start:{line:11,column:21},end:{line:11,column:34}}}):n)?s:"")+"</div>\n"},compiler:[8,">= 4.3.0"],main:function(t,e,n,i,o){var s,a=null!=e?e:t.nullContext||{},r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="inBrowserNotification">\n'+(null!=(s=r(n,"if").call(a,null!=e?r(e,"icon"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:2,column:4},end:{line:4,column:11}}}))?s:"")+"\n"+(null!=(s=r(n,"if").call(a,null!=e?r(e,"title"):e,{name:"if",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o,loc:{start:{line:6,column:4},end:{line:8,column:11}}}))?s:"")+"\n"+(null!=(s=r(n,"if").call(a,null!=e?r(e,"message"):e,{name:"if",hash:{},fn:t.program(5,o,0),inverse:t.noop,data:o,loc:{start:{line:10,column:4},end:{line:12,column:11}}}))?s:"")+'\n    <i class="fa fa-times-circle"></i>\n</div>'},useData:!0}),is.LoginDialog=s.template({compiler:[8,">= 4.3.0"],main:function(t,e,n,i,o){var s=null!=e?e:t.nullContext||{},a=t.hooks.helperMissing,r=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="login-container quick-base login-dialog ui-widget ui-widget-content ui-corner-all ui-front">\n    <div class="logo"></div>\n    <div class="login-form user-login-form open">\n\n        <div class="input-container" style="margin-top: 7px">\n\n            <label for="username-input">'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"User",{name:"t",hash:{},data:o,loc:{start:{line:7,column:40},end:{line:7,column:52}}}))+':\n            </label>\n            <span>\n                <input class="username" tabindex="0" type="text" name="username" id="username-input" autocomplete="new-username"></input>\n            </span>\n\n        </div>\n        <div class="input-container" style="margin-top: 11px;">\n            <label for="password-input">'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"Password",{name:"t",hash:{},data:o,loc:{start:{line:15,column:40},end:{line:15,column:56}}}))+':\n            </label>\n            <span>\n                <input class="password" tabindex="0" type="password" name="password" id="password-input" autocomplete="new-password"></input>\n            </span>\n        </div>\n        <div class="forgot-info-container">\n            <span class="forgot-info" tabindex="0">'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"forgot password",{name:"t",hash:{},data:o,loc:{start:{line:22,column:51},end:{line:22,column:74}}}))+'?</span>\n        </div>\n        <div class="loginErrorPanel">'+r((t(n,"t")||e&&t(e,"t")||a).call(s,null!=e?t(e,"An"):e,null!=e?t(e,"error"):e,null!=e?t(e,"has"):e,null!=e?t(e,"occurred"):e,e,{name:"t",hash:{},data:o,loc:{start:{line:24,column:37},end:{line:24,column:65}}}))+'</div>\n    </div>\n    <div class="login-form forgot-password-form">\n        <div class="form-text">Reset Password</div>\n        <div class="input-container">\n            <label for="reset-input">'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"User",{name:"t",hash:{},data:o,loc:{start:{line:29,column:37},end:{line:29,column:49}}}))+':\n            </label>\n            <span>\n                <input class="reset-username" type="text" id="reset-input"></input>\n            </span>\n        </div>\n        <div class="reset-password-error">'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"Please enter valid user name",{name:"t",hash:{},data:o,loc:{start:{line:35,column:42},end:{line:35,column:78}}}))+'</div>\n    </div>\n    <div class="login-form password-reset-info">\n        <div class="recovery-response form-text"></div>\n    </div>\n    <div class="login-button-panel ui-dialog-buttonpane ui-helper-clearfix">\n        <button class="login-btn ui-button ui-widget" tabindex="0" ></button>\n        <button class="reset-btn ui-button ui-widget" tabindex="0"></button>\n        <button class="back-btn ui-button ui-widget" tabindex="0"></button>\n    </div>\n</div>'},useData:!0}),is.MainMenu=s.template({compiler:[8,">= 4.3.0"],main:function(t,e,n,i,o){return'<div class="quickdash-menu">\n\t<div class="component-header">DASHBOARDS</div>\n\t<hr>\n\t<ul role="menu">\n\t\t<li class="toolbar-menu-item" data-menu-option="newDash" role="menuitem" aria-label="New Dashboard"><span><i class="iconMenu fa fa-fw fa-file-o"></i></span>New</li>\n\t\t<li class="toolbar-menu-item" data-menu-option="saveDash" role="menuitem" aria-label="Save Dashboard"><span><i class="iconMenu fa fa-fw fa-floppy-o"></i></span>Save</li>\n\t\t<li class="toolbar-menu-item" data-menu-option="saveDashAs" role="menuitem" aria-label="Dashboard Save As"><span><i class="iconMenu fa fa-fw fa-floppy-o"></i></span>Save As</li>\n\t\t<li class="toolbar-menu-item" data-menu-option="manageDash" role="menuitem" aria-label="Manage Dashboards"><span><i class="iconMenu fa fa-fw fa-binoculars"></i></span>Manage</li>\n\t\t<li class="toolbar-menu-item" data-menu-option="exportDash" role="menuitem" aria-label="Export Dashboard"><span><i class="iconMenu fa fa-fw fa-download"></i></span>Export</li>\n\t</ul>\n\t<br>\n</div>\n\n<div class="quickdash-menu design-mode-only">\n\t<div class="component-header">QUERIES</div>\n\t<hr>    \n\t<ul role="menu">\n\t\t<li class="toolbar-menu-item" data-menu-option="openDataDialog" role="menuitem" aria-label="New/Manage Queries"><span><i class="iconMenu fa fa-fw fa-database"></i></span>New / Manage</li>\n\t\t<li class="toolbar-menu-item" data-menu-option="openConnectionsDialog" role="menuitem" aria-label="Connections"><span><i class="iconMenu fa fa-fw fa-cogs"></i></span>Connections</li>\n\t</ul>\n\t<br>\n</div>\n\n<div class="quickdash-menu design-mode-only">\n\t<div class="component-header">VIEW STATES</div>\n\t<hr>\n\t<ul role="menu">\t\n\t\t<li class="toolbar-menu-item" data-menu-option="openViewStateDialog" role="menuitem" aria-label="New/Manage View States"><span><i class="iconMenu fa fa-fw fa-eye"></i></span>New / Manage</li>\n\t</ul>\n\t<br>\n</div>\n\n<div class="quickview-menu">\n\t<div class="component-header">VIEW STATES</div>\n\t<hr>\n\t<ul role="menu">\t\n\t\t<li class="toolbar-menu-item" data-menu-option="saveViewStates" role="menuitem" aria-label="Save View States"><span><i class="iconMenu fa fa-fw fa-floppy-o"></i></span>Save</li>\n\t\t<li class="toolbar-menu-item" data-menu-option="resetViewStates" role="menuitem" aria-label="Reset View States to Default"><span><i class="iconMenu fa fa-fw fa-undo"></i></span>Reset to Default</li>\n\t</ul>\n\t<br>\n</div>\n\n<div class="quickdash-menu design-mode-only">\n\t<div class="component-header">DOCUMENT DATA GRAPH</div>\n\t<hr>\n\t<ul role="menu">\n\t\t<li class="toolbar-menu-item" data-menu-option="showDocumentGraph" role="menuitem" aria-label="View Document Data Graph"><span><i class="iconMenu fa fa-fw fa-sitemap"></i></span>View</li>\n\t</ul>\n\t<br>\n</div>\n\n<div class="quickdash-menu">\n\t<div class="component-header">DOCUMENTATION</div>\n\t<hr>\n\t<ul role="menu">\n\t\t<li class="toolbar-menu-item" data-menu-option="showDocumentation" role="menuitem" aria-label="View Documentation"><span><i class="iconMenu fa fa-fw fa-question-circle"></i></span>View</li>\n\t</ul>\t\n\t<br>\n</div>'},useData:!0}),is.ProfileMenu=s.template({1:function(t,e,n,i,o){var s=t.escapeExpression,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'            <option value="'+s(t.lambda(null!=e?a(e,"id"):e,e))+'">'+s((a(n,"t")||e&&a(e,"t")||t.hooks.helperMissing).call(null!=e?e:t.nullContext||{},null!=e?a(e,"name"):e,{name:"t",hash:{},data:o,loc:{start:{line:11,column:40},end:{line:11,column:55}}}))+"</option>\n"},3:function(t,e,n,i,o){var s=t.lambda,a=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                <option value="'+a(s(null!=e?t(e,"value"):e,e))+'">'+a(s(null!=e?t(e,"label"):e,e))+"</option>\n"},5:function(t,e,n,i,o){var s,a=null!=e?e:t.nullContext||{},r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'            <optgroup label="'+t.escapeExpression("function"==typeof(s=null!=(s=r(n,"key")||o&&r(o,"key"))?s:t.hooks.helperMissing)?s.call(a,{name:"key",hash:{},data:o,loc:{start:{line:58,column:29},end:{line:58,column:37}}}):s)+'">\n'+(null!=(s=r(n,"each").call(a,e,{name:"each",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o,loc:{start:{line:59,column:16},end:{line:61,column:25}}}))?s:"")+"            </optgroup>\n"},7:function(t,e,n,i,o){var s=t.lambda,a=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'            <option value="'+a(s(null!=e?t(e,"value"):e,e))+'">'+a(s(null!=e?t(e,"label"):e,e))+"</option>\n"},9:function(t,e,n,i,o){var s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <li\n        data-options="document-breadcrumbs"\n        class="breadcrumbs '+(null!=(n=s(n,"if").call(null!=e?e:t.nullContext||{},null!=e?s(e,"showBreadcrumbs"):e,{name:"if",hash:{},fn:t.program(10,o,0),inverse:t.noop,data:o,loc:{start:{line:86,column:27},end:{line:86,column:64}}}))?n:"")+'"\n    >\n        <div>\n            <label>Show Selection Breadcrumb</label>\n            <i class="fa fa-check ui-checkboxradio-icon"></i>\n        </div>\n    </li>\n    '},10:function(t,e,n,i,o){return"checked"},12:function(t,e,n,i,o){var s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'\n    <li class="ext-link" data-options="open-viewer">\n        <div>'+t.escapeExpression((s(n,"t")||e&&s(e,"t")||t.hooks.helperMissing).call(null!=e?e:t.nullContext||{},"Open Viewer",{name:"t",hash:{},data:o,loc:{start:{line:95,column:13},end:{line:95,column:32}}}))+'<i class="fa fa-external-link" aria-hidden="true"></i></div>\n    </li>\n    '},14:function(t,e,n,i,o){var s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return" "+(null!=(n=s(n,"if").call(null!=e?e:t.nullContext||{},null!=e?s(e,"isLite"):e,{name:"if",hash:{},fn:t.program(15,o,0),inverse:t.noop,data:o,loc:{start:{line:97,column:13},end:{line:101,column:11}}}))?n:"")+" "},15:function(t,e,n,i,o){var s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'\n    <li class="ext-link" data-options="open-editor">\n        <div>'+t.escapeExpression((s(n,"t")||e&&s(e,"t")||t.hooks.helperMissing).call(null!=e?e:t.nullContext||{},"Open Editor",{name:"t",hash:{},data:o,loc:{start:{line:99,column:13},end:{line:99,column:32}}}))+'<i class="fa fa-external-link" aria-hidden="true"></i></div>\n    </li>\n    '},17:function(t,e,n,i,o){var s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'\n    <li data-options="login-history"><div>'+t.escapeExpression((s(n,"t")||e&&s(e,"t")||t.hooks.helperMissing).call(null!=e?e:t.nullContext||{},"Login History",{name:"t",hash:{},data:o,loc:{start:{line:102,column:42},end:{line:102,column:63}}}))+"</div></li>\n"},19:function(t,e,n,i,o){var s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <li data-options="helpguide"><div>'+t.escapeExpression((s(n,"t")||e&&s(e,"t")||t.hooks.helperMissing).call(null!=e?e:t.nullContext||{},"Help",{name:"t",hash:{},data:o,loc:{start:{line:106,column:38},end:{line:106,column:50}}}))+"</div></li>\n    "},21:function(t,e,n,i,o){var s=null!=e?e:t.nullContext||{},a=t.hooks.helperMissing,r=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'\n    <li data-options="logout-local"><div>'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"Local Logout",{name:"t",hash:{},data:o,loc:{start:{line:108,column:41},end:{line:108,column:61}}}))+'</div></li>\n    <li data-options="logout-global"><div>'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"Global Logout",{name:"t",hash:{},data:o,loc:{start:{line:109,column:42},end:{line:109,column:63}}}))+"</div></li>\n    "},23:function(t,e,n,i,o){var s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return" "+(null!=(n=s(n,"unless").call(null!=e?e:t.nullContext||{},null!=e?s(e,"isLite"):e,{name:"unless",hash:{},fn:t.program(24,o,0),inverse:t.noop,data:o,loc:{start:{line:110,column:13},end:{line:113,column:15}}}))?n:"")+" "},24:function(t,e,n,i,o){var s=null!=e?e:t.nullContext||{},a=t.hooks.helperMissing,r=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'\n    <li data-options="change-password"><div>'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"Change Password",{name:"t",hash:{},data:o,loc:{start:{line:111,column:44},end:{line:111,column:67}}}))+'</div></li>\n    <li data-options="logout"><div>'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"Logout",{name:"t",hash:{},data:o,loc:{start:{line:112,column:35},end:{line:112,column:49}}}))+"</div></li>\n    "},compiler:[8,">= 4.3.0"],main:function(t,e,n,i,o){var s,a=null!=e?e:t.nullContext||{},r=t.hooks.helperMissing,l=t.escapeExpression,u=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="row theme">\n    <label class="label" id="editor-theme-label">'+l((u(n,"t")||e&&u(e,"t")||r).call(a,"Editor Theme",{name:"t",hash:{},data:o,loc:{start:{line:2,column:49},end:{line:2,column:69}}}))+'</label>\n    <div class="control">\n        <select\n            style="width: 100%"\n            class="select-theme"\n            tabindex="0"\n            aria-labelledby="editor-theme-label"\n        >\n'+(null!=(s=u(n,"each").call(a,null!=e?u(e,"themes"):e,{name:"each",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:10,column:12},end:{line:12,column:21}}}))?s:"")+'        </select>\n    </div>\n</div>\n<div class="row viewer-theme">\n    <label class="label" id="viewer-theme-label">'+l((u(n,"t")||e&&u(e,"t")||r).call(a,"Theme",{name:"t",hash:{},data:o,loc:{start:{line:17,column:49},end:{line:17,column:62}}}))+'</label>\n    <div class="control">\n        <select\n            style="width: 100%"\n            class="select-viewer-theme"\n            tabindex="0"\n            aria-labelledby="viewer-theme-label"\n        >\n'+(null!=(s=u(n,"each").call(a,null!=e?u(e,"themes"):e,{name:"each",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:25,column:12},end:{line:27,column:21}}}))?s:"")+'        </select>\n    </div>\n</div>\n\x3c!-- <div class="row language">\n    <label class="label" id="language-label">'+l((u(n,"t")||e&&u(e,"t")||r).call(a,"Language",{name:"t",hash:{},data:o,loc:{start:{line:32,column:45},end:{line:32,column:61}}}))+'</label>\n    <div class="control">\n        <select style="width: 100%" class="select-language" tabindex="0" aria-labelledby="language-label">\n            <option value="en">'+l((u(n,"t")||e&&u(e,"t")||r).call(a,"English",{name:"t",hash:{},data:o,loc:{start:{line:35,column:31},end:{line:35,column:46}}}))+'</option>\n            <option value="zh-HK">'+l((u(n,"t")||e&&u(e,"t")||r).call(a,"Chinese HK",{name:"t",hash:{},data:o,loc:{start:{line:36,column:34},end:{line:36,column:52}}}))+'</option>\n            <option value="de">'+l((u(n,"t")||e&&u(e,"t")||r).call(a,"German",{name:"t",hash:{},data:o,loc:{start:{line:37,column:31},end:{line:37,column:45}}}))+'</option>\n            <option value="ja">'+l((u(n,"t")||e&&u(e,"t")||r).call(a,"Japanese",{name:"t",hash:{},data:o,loc:{start:{line:38,column:31},end:{line:38,column:47}}}))+'</option>\n            <option value="ar">'+l((u(n,"t")||e&&u(e,"t")||r).call(a,"Arabic",{name:"t",hash:{},data:o,loc:{start:{line:39,column:31},end:{line:39,column:45}}}))+'</option>\n        </select>\n    </div>\n</div> --\x3e\n<div class="row timezone">\n    <label class="label" id="timezone-label">'+l((u(n,"t")||e&&u(e,"t")||r).call(a,"Timezone",{name:"t",hash:{},data:o,loc:{start:{line:44,column:45},end:{line:44,column:61}}}))+'</label>\n    <div class="control">\n        <select\n            style="width: 100%"\n            class="select-timezone"\n            tabindex="0"\n            aria-labelledby="timezone-label"\n        >\n            <optgroup label="Major">\n'+(null!=(s=u(n,"each").call(a,null!=e?u(e,"majorTimezones"):e,{name:"each",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o,loc:{start:{line:53,column:16},end:{line:55,column:25}}}))?s:"")+"            </optgroup>\n"+(null!=(s=u(n,"each").call(a,null!=e?u(e,"timezones"):e,{name:"each",hash:{},fn:t.program(5,o,0),inverse:t.noop,data:o,loc:{start:{line:57,column:12},end:{line:63,column:21}}}))?s:"")+'        </select>\n    </div>\n</div>\n<div class="row log-level">\n    <label class="label" id="log-level-label">'+l((u(n,"t")||e&&u(e,"t")||r).call(a,"Log Level",{name:"t",hash:{},data:o,loc:{start:{line:68,column:46},end:{line:68,column:63}}}))+'</label>\n    <div class="control">\n        <select\n            style="width: 100%"\n            class="select-log-level"\n            tabindex="0"\n            aria-labelledby="log-level-label"\n        >\n'+(null!=(s=u(n,"each").call(a,null!=e?u(e,"logLevel"):e,{name:"each",hash:{},fn:t.program(7,o,0),inverse:t.noop,data:o,loc:{start:{line:76,column:12},end:{line:78,column:21}}}))?s:"")+'        </select>\n    </div>\n</div>\n<ul class="buttonset">\n'+(null!=(s=u(n,"if").call(a,null!=e?u(e,"editor"):e,{name:"if",hash:{},fn:t.program(9,o,0),inverse:t.noop,data:o,loc:{start:{line:83,column:4},end:{line:93,column:11}}}))?s:"")+" "+(null!=(s=u(n,"if").call(a,null!=e?u(e,"editor"):e,{name:"if",hash:{},fn:t.program(12,o,0),inverse:t.program(14,o,0),data:o,loc:{start:{line:93,column:12},end:{line:101,column:19}}}))?s:"")+" "+(null!=(s=u(n,"unless").call(a,null!=e?u(e,"isLite"):e,{name:"unless",hash:{},fn:t.program(17,o,0),inverse:t.noop,data:o,loc:{start:{line:101,column:20},end:{line:103,column:15}}}))?s:"")+'    <li data-options="about"><div>'+l((u(n,"t")||e&&u(e,"t")||r).call(a,"About",{name:"t",hash:{},data:o,loc:{start:{line:104,column:34},end:{line:104,column:47}}}))+"</div></li>\n"+(null!=(s=u(n,"if").call(a,null!=e?u(e,"editor"):e,{name:"if",hash:{},fn:t.program(19,o,0),inverse:t.noop,data:o,loc:{start:{line:105,column:4},end:{line:107,column:11}}}))?s:"")+" "+(null!=(s=u(n,"if").call(a,null!=e?u(e,"saml"):e,{name:"if",hash:{},fn:t.program(21,o,0),inverse:t.program(23,o,0),data:o,loc:{start:{line:107,column:12},end:{line:113,column:23}}}))?s:"")+"\n</ul>\n"},useData:!0}),is.fileExporter=s.template({compiler:[8,">= 4.3.0"],main:function(t,e,n,i,o){var s=null!=e?e:t.nullContext||{},a=t.hooks.helperMissing,r=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="pnlButtons">\n    <span class="lnksExport link-disabled">\n        <i class="fa fa-fw fa-download" title="'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"Data",{name:"t",hash:{},data:o,loc:{start:{line:3,column:47},end:{line:3,column:59}}}))+'"></i>\n        <a class="lnkExcelExport" title="'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"Download the current dataset in Excel format",{name:"t",hash:{},data:o,loc:{start:{line:4,column:41},end:{line:4,column:93}}}))+'">'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"Excel",{name:"t",hash:{},data:o,loc:{start:{line:4,column:95},end:{line:4,column:108}}}))+'</a>\n        <a class="lnkCsvExport" title="'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"Download the current dataset in CSV format",{name:"t",hash:{},data:o,loc:{start:{line:5,column:39},end:{line:5,column:89}}}))+'">'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"CSV",{name:"t",hash:{},data:o,loc:{start:{line:5,column:91},end:{line:5,column:102}}}))+'</a>\n        <a class="lnkFullExport" title="'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"Download the full dataset from the server",{name:"t",hash:{},data:o,loc:{start:{line:6,column:40},end:{line:6,column:89}}}))+'">'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"Full",{name:"t",hash:{},data:o,loc:{start:{line:6,column:91},end:{line:6,column:103}}}))+'</a>\n        <a class="lnkDownloadScreenshot" title="'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"Download a PNG image of the chart",{name:"t",hash:{},data:o,loc:{start:{line:7,column:48},end:{line:7,column:89}}}))+'">'+r((t(n,"t")||e&&t(e,"t")||a).call(s,"PNG",{name:"t",hash:{},data:o,loc:{start:{line:7,column:91},end:{line:7,column:102}}}))+"</a>\n    </span> \n</div> \n"},useData:!0}),is.popup=s.template({compiler:[8,">= 4.3.0"],main:function(t,e,n,i,o){return'<div class="dialog">\n    <div class="content-panel" tabindex="1"></div>\n</div>'},useData:!0}),qe.T=is,Zi=A=A||{},Ji=f.View,e(os,Ji),os.prototype.remove=function(){return this.stopListening(),this.$el.off(),f.View.prototype.remove.call(this)},Zi.AboutDialog=os,Ye=A=A||{},to=f.View,e(ss,to),ss.prototype.adjustWeights=function(t,n){var i=this.sum(_.map(t,function(t){return t.weight})),o=this.sum(n);_.each(t,function(t,e){t.weight=i*(n[e]/o)})},ss.prototype.onClick=function(t){t.isExpanded=!t.isExpanded,this.updateLayout(!0)},ss.prototype.onSectionResize=function(t,e,n){for(var i,o,s=0,a=t.$el.height(),r=a-n.originalSize.height,l=[t],u=[a],c=this.sections.indexOf(t)+1;c<this.sections.length&&(!(i=this.sections[c]).isExpanded||i.fixed||(o=Math.max(this.HEADING_HEIGHT,i.startHeight-(r-s)),s+=Math.min(i.startHeight-this.HEADING_HEIGHT,r-s),i.$el.height(o+"px"),l.push(i),u.push(o),s!==r));c+=1);this.adjustWeights(l,u)},ss.prototype.resize=function(){this.updateLayout(!1)},ss.prototype.setExpanded=function(t,e,n){n=n||!0,this.sections[t].isExpanded=e,this.updateLayout(n)},ss.prototype.sum=function(t){return _.reduce(t,function(t,e){return t+e},0)},ss.prototype.updateLayout=function(t){var n,e,i=this,o=i.$el.height();i.$el.toggleClass("animate",t),e=_.filter(i.sections,{isExpanded:!0}),o=(o-=(i.sections.length-e.length)*i.HEADING_HEIGHT)-this.sum(_.map(_.filter(e,function(t){return t.isExpanded&&t.fixed}),function(t){return t.fixed})),e=this.sum(_.map(e,function(t){return t.weight})),n=o/e,_.each(i.sections,function(t,e){t.$el.toggleClass("expanded",t.isExpanded),t.isExpanded?t.$el.height((t.fixed||t.weight*n)+"px"):t.$el.height(0),t.resize&&t.resize(),t.isResizable&&t.isExpanded&&!t.fixed&&e<i.sections.length-1&&_.some(i.sections.slice(e+1),function(t){return t.isExpanded&&!t.fixed})?t.resizeable=t.$el.resizable({handles:"s",resize:$.proxy(i.onSectionResize,i,t),start:function(){_.each(i.sections,function(t){t.startHeight=t.$el.height()}),t.$el.resizable("option","maxHeight",i.$el.height()-(i.sections.length-1)*i.HEADING_HEIGHT)},stop:function(){i.updateLayout()}}):t.resizeable&&(t.$el.resizable("destroy"),delete t.resizeable)}),t?this.debouncedRemoveAnimate():i.onUpdate&&i.onUpdate(i.sections)},Ye.AccordionView=ss,Ke=A=A||{},as.prototype.on=function(t,e,n){},as.prototype.off=function(t,e,n){},as.prototype.trigger=function(t){for(var e=1;e<arguments.length;e++)e-1,0},as.prototype.bind=function(t,e,n){},as.prototype.unbind=function(t,e,n){},as.prototype.once=function(t,e,n){},as.prototype.listenTo=function(t,e,n){},as.prototype.listenToOnce=function(t,e,n){},as.prototype.stopListening=function(t,e,n){},Ke.CustomEvents=as;ra.getComponentViewStates=function(t,n){void 0===n&&(n=!0);function i(e){e&&(e instanceof A.Component?(n&&(e.get("components").each(function(t){i(t)}),e.get("widgets").each(function(t){i(t.get("component"))})),i(e.get("options"))):e instanceof A.Popup?i(_.omit(e.attributes,"widgets")):_.isArray(e)?_.each(e,function(t){i(t)}):e.attributes?e.path?e.get("_dataSource")||_.includes(o,e.path)||(o.push(e.path),"dict"===e.get("_type")&&_.each(e.get("_default"),function(t){t instanceof A.DocumentViewModel&&o.push(t.path)})):i(e.attributes):!_.isObject(e)||e instanceof f.View||("viewstate"===e._dashboardsType?_.includes(o,e.value)||o.push(e.value):_.each(_.keys(e),function(t){i(e[t])})))}var o=[];return i(t),o},ra.mergeViewStates=function(t,s){var a;t&&s&&(_.each(t,function(t,e){if(!s.get("viewState").getByPath(e)){var n=e.split("/"),i=null,e=void 0;if(n.length<=1)a=n[0],i=new A.DocumentViewModel(t,null);else{for(var i=s.get("viewState"),o=0;o<n.length-1;o+=1)i.set(n[o],i.get(n[o])||new A.DocumentViewModel(null,null)),i=i.get(n[o]),a=0===o?n[o]:n.slice(0,o).join("/"),i.path=a;a=n.join("/"),e=new A.DocumentViewModel(t,null),i.set(n[n.length-1],e),e.path=a}s.get("viewState").getByPath(a)||(i.path=a,s.get("viewState").set(a,i))}}),s.get("viewState").postInitialize())},ra.getMappingDataSources=function(n,t){var i=[];return t.get("data").getTreeList().forEach(function(e){e.get("_mappings")&&_.each(e.get("_mappings").mappings,function(t){_.includes(n,t.value)&&(i[e.path]=e.toJSON())})}),i},ra.mergeDataSources=function(t,r){var l;t&&(l=r.get("data"),_.each(t,function(t,e){for(var n,i=_.filter(e.split("/"),function(t){return t&&0<t.length}),o=l,s="",a=0;a<i.length;a+=1)s=(s+=0===a?"":"/")+i[a],n=new A.DocumentDataModel(a!==i.length-1?{}:t,l,s,r.get("viewState"),a!==i.length-1),o=r.get("data").getByPath(s)?r.get("data").getByPath(s):(o.set(i[a],n),n.viewState=r.attributes.viewState,n)}))},ra.getComponentDataSources=function(t,n,i,o){void 0===o&&(o=!0);var s,a={},r={},l=function(t){return t._cpKey||(_.isObject(t)||_.isArray(t))&&(Object.defineProperty(t,"_cpKey",{enumerable:!1,writable:!0}),t._cpKey=_.uniqueId("_cpKey_")),t._cpKey||null},u=function(e){!e||(s=l(e))&&r[s]||(s&&(r[s]=!0),!o&&(e instanceof A.WidgetCollection||e instanceof A.ComponentCollection))||(_.isArray(e)?_.each(e,function(t){u(t)}):e.attributes?(e.attributes._dataType&&_.includes(A.DocumentDataModel.SUPPORTED_DATA_SOURCES,e.attributes._dataType)&&(_.each(e.getViewStateDict(),function(t){_.includes(n,t.path)||(n.push(t.path),"dict"===t.get("_type")&&_.each(t.get("_default"),function(t){t instanceof A.DocumentViewModel&&n.push(t.path)}))}),"virtual"===e.attributes._dataType&&_.each(e.get("_virtualParams"),function(t){var e;"datasource"===t.type&&(e=i.getByPath(t.value))&&(_.each(e.getViewStateDict(),function(t){_.includes(n,t.path)||n.push(t.path)}),a[t.value]=e.toJSON())}),a[e.path]=e.toJSON()),u(e.attributes)):!_.isObject(e)||e instanceof f.View||("data"===e._dashboardsType?a[e.value]||u(i.getByPath(e.value)):_.each(_.keys(e),function(t){u(e[t])})))};return u(t),a};var rs,ls,us,cs,ps,ds,hs,gs,ms,fs,ys,vs,bs,Ss,ws,_s,Ts,Cs,Ds,Es,Ms,Ps,Is,As,ks,xs,Ns,Ls,Rs,Vs,Os,Bs,$s,Us,qs,Fs,Ys,Hs,Ks,Qs,zs,Ws,I,Gs,js,Xs,Zs,Js,ta,ea,na,ia,A,oa,sa,aa=ra;function ra(t){}function k(t,e,n,i,o,s,a){var r=ls.call(this)||this;return r.nodes={},r.edges={},r.edgesR={},r.subscriptions={},r.activeViewStateToSubscriptions={},r.getDataSourceByPath=s,r.viewState=t,r.dataSources=e,r.componentDefs=i,r.isEmbedded=o,r.onNodeUpdate=a,r.viewState.getViewStateList().forEach(function(t){var e=r.addNode("vs",t.path,t.model);"dict"===t.model.get("_type")&&_.each(t.model.get("value"),function(t){t&&t.path&&(t=r.addNode("vs",t.path,t),r.addEdge({fromNodeId:t,toNodeId:e}))})}),_.each(r.dataSources.flatten(),function(e){var n;e&&e.path&&(n=r.addNode("ds",e.path,e),_.each(e.getViewStateDict(),function(t){t&&t.path&&r.addEdge({fromNodeId:"vs:"+t.path,toNodeId:n})}),_.each(e.getMappedViewStates(),function(t){t&&t.path&&r.addEdge({fromNodeId:n,toNodeId:"vs:"+t.path})}),"virtual"===e.get("_dataType"))&&_.each(_.filter(e.get("_virtualParams"),{type:"datasource"}).map(function(t){return t.value}),function(t){r.getDataSourceByPath(t)?(t=r.addNode("ds",t,e),r.addEdge({fromNodeId:t,toNodeId:n})):rs.Log.Warn("DocumentGraph: "+e.path+" has invalid source parameter  "+e.path)})}),_.isUndefined(r.hierarchical)&&(r.hierarchical=_.keys(r.nodes).length<20),_.each(n,function(t){var e,n,i,o=aa.getComponentViewStates(t,!1),s=aa.getComponentDataSources(t,o,r.dataSources,!1);!o.length&&_.isEmpty(s)||(e=r.getComponentName(t),n=r.getComponentInfo(t),i=r.addNode(n.group,n.key+"-"+t.get("_cpKey").substring(7),t,e),_.each(o,function(t){r.addEdge({fromNodeId:"vs:"+t,toNodeId:i})}),_.each(s,function(t,e){r.addEdge({fromNodeId:"ds:"+e,toNodeId:i})}))}),r}rs=A=A||{},ls=rs.CustomEvents,e(k,ls),k.prototype.getComponentName=function(t){return t instanceof rs.Popup?t.get("dialogName"):(t=t.get("options").get("Basics")?t.get("options").get("Basics"):t.get("options").get("Basic"))?(t=t.Name)instanceof rs.DocumentViewModel&&_.isFunction(t.get)?t.get("value"):t:""},k.prototype.getComponentInfo=function(e){var t,n={group:"",key:""};return e instanceof rs.Popup?(n.group=_.find(this.componentDefs,function(t){return"Popup"===t.get("appKey")}).get("id"),n.key="Popup"):0<(t=this.componentDefs.filter(function(t){return t.get("id").toString()===e.get("definitionId")})).length?(n.group=t[0].get("id"),n.key=t[0].get("componentName")):0<(t=this.componentDefs.filter(function(t){return t.get("appKey")===e.get("key")})).length&&(n.group=t[t.length-1].get("id"),n.key=t[t.length-1].get("componentName")),n},k.addEdgeToCollection=function(t,e,n){var i=t[e];i?-1===i.indexOf(n)&&i.push(n):t[e]=[n]},k.prototype.getFormDataSources=function(t,e,n){var i=this,o=this.getRelatedDataSources(_.map(t,function(t){return"vs:"+t}),this.edges),t=this.getRelatedDataSources(_.map(t,function(t){return"vs:"+t}),this.edgesR),e=this.getRelatedDataSources(_.map(e,function(t){return"ds:"+t}),this.edgesR),n=this.getRelatedDataSources(_.map(n,function(t){return"vs:"+t}),this.edgesR);return _.map(_.union(_.intersection(o,e),_.intersection(o,t),n),function(t){return i.nodes[t].model})},k.prototype.getIsolatedNodes=function(t,e){var n=this;return _.filter(t,function(t){t=e+t.path;return!n.edges[t]&&!n.edgesR[t]})},k.prototype.getConnectedNodes=function(t,e){var n=this;return _.filter(t,function(t){t=e+t.path;return!!n.edges[t]||!!n.edgesR[t]})},k.prototype.getIsolatedDataSources=function(){return this.getIsolatedNodes(this.dataSources.flatten(),"ds:")},k.prototype.getConnectedDataSources=function(){return this.getConnectedNodes(this.dataSources.flatten(),"ds:")},k.prototype.getDataSourcesConnectedToComponents=function(){var e=this,t=this.dataSources.flatten();return _.filter(t,function(t){t="ds:"+t.path;return!!_.find(e.edges[t],function(t){return!t.startsWith("ds:")&&!t.startsWith("vs:")})})},k.prototype.getDataSourcesNotConnectedToComponents=function(){var e=this.getDataSourcesConnectedToComponents();return _.filter(this.dataSources.flatten(),function(t){return!e.includes(t)})},k.prototype.getIsolatedViewStates=function(){return this.getIsolatedNodes(this.viewState.getViewStateList().filter(function(t){return!t.path.startsWith("_settings/")}),"vs:")},k.prototype.getConnectedViewStates=function(){return this.getConnectedNodes(this.viewState.getViewStateList().filter(function(t){return!t.path.startsWith("_settings/")}),"vs:")},k.prototype.onSearch=function(t,e){var n=this;_.each(this.nodes,function(t){t.searched=!1}),e?this.topLevelSearch(t):_.each(t,function(t){n.depthFirstSearch(t)})},k.prototype.unsubscribeAll=function(){var e=this;_.each(this.subscriptions,function(t){return e.unsubscribe(t.source)}),_.each(this.activeViewStateToSubscriptions,function(t){return e.unsubscribeViewStates(t)})},k.prototype.addEdge=function(t){var e=t.fromNodeId,t=t.toNodeId;k.addEdgeToCollection(this.edges,e,t),k.addEdgeToCollection(this.edgesR,t,e)},k.prototype.addNode=function(t,e,n,i){var o=t+":"+e;return this.nodes[o]||(this.nodes[o]={id:o,label:_.isEmpty(i)?e:i,model:n,visited:!1,searched:!1}),this.onNodeUpdate&&("ds"!==t||!n.agent.subscriberCount()&&this.isEmbedded||this.subscribe(n,this.onNodeUpdate(o),o,!0),"vs"===t)&&(this.activeViewStateToSubscriptions[n.path]=n,this.listenTo(n,"change:value",this.onNodeUpdate(o))),o},k.prototype.breadthFirstSearch=function(t,e){return _.each(this.nodes,function(t){t.visited=!1}),this.visitAndMeetNeighbors(t,e)},k.prototype.depthFirstSearch=function(t){var e=this,n=this.edges[t]||[],i=this.edgesR[t]||[];this.nodes[t].searched=!0,_.each(n.concat(i),function(t){e.nodes[t].searched||e.depthFirstSearch(t)})},k.prototype.topLevelSearch=function(t){var e=this,n=this.edges[t]||[],i=this.edgesR[t]||[];this.nodes[t].searched=!0,_.each(n.concat(i),function(t){e.nodes[t].searched=!0})},k.prototype.getDataSourceKey=function(t){if(t)return t.path||t.cid},k.prototype.getRelatedDataSources=function(t,n){var i=this,t=_.reduce(t,function(t,e){return t.concat(i.breadthFirstSearch(e,n))},[]);return _.uniq(t.filter(function(t){return 0===t.indexOf("ds")}))},k.prototype.subscribe=function(t,e,n,i,o){var s=this.getDataSourceKey(t);return this.subscriptions[s]?(this.subscriptions[s].callback=e,!1):(this.subscriptions[s]={source:t,onData:e},this.subscriptions[s].key=_.uniqueId(n+"_"),t.subscribe(this.subscriptions[s].key,this.subscriptions[s],i,o),!0)},k.prototype.unsubscribe=function(t){var e=this.getDataSourceKey(t);this.subscriptions[e]&&(t.unsubscribe(this.subscriptions[e].key),delete this.subscriptions[e])},k.prototype.unsubscribeViewStates=function(i){var o=this;_.each(this.activeViewStateToSubscriptions,function(t,e){var n=i.getByPath(e);o.stopListening(n,"change:value"),delete o.activeViewStateToSubscriptions[e]})},k.prototype.visitAndMeetNeighbors=function(t,n){var i=this,e=[];return e=this.nodes[t]&&!this.nodes[t].visited&&(this.nodes[t].visited=!0,e.push(t),t=n[t])?_.reduce(t,function(t,e){return t.concat(i.visitAndMeetNeighbors(e,n))},e):e},rs.DocumentGraph=k;c=A=A||{};function la(t){this.datasources={},this.templates={},this.triggers=[],this.sendNotification=t}la.prototype.onTriggerChange=function(t){var o=this,e=(this.triggers=t).map(function(t){if(t.source)return t.source.cid});t.forEach(function(t){var e=t.template,n=t.source,i=t.icon,t=t.sound;n&&!o.datasources[n.cid]?o.datasources[n.cid]=new ua(n,e,i,t,o.sendNotification):n&&o.datasources[n.cid].updateTemplate(e,i,t)}),Object.keys(this.datasources).filter(function(t){return-1===e.indexOf(t)}).forEach(function(t){o.datasources[t].unsubscribe(),o.datasources[t]=void 0,delete o.datasources[t]})},c.DatasourceNotifier=la,ca.prototype.updateTemplate=function(t,e,n){this.template=s.compile(t),this.icon=e,this.sound=n},ca.prototype.subscribe=function(){this.source.subscribe("notifications",this),this.source.dataSet.noBackground=!0},ca.prototype.unsubscribe=function(){this.source.unsubscribe("notifications")},ca.prototype.onData=function(t,e){var o=this;e.add&&e.add.length&&e.add.forEach(function(t){t=_.omit(t,["_rowIndex"]);var t=o.template(t),e=o.source.path,n=o.sound,i=o.icon;o.sendNotification("datasource-notifications",{title:e,message:t,icon:i},{sound:n})})};var ua=ca;function ca(t,e,n,i,o){this.source=t,this.sound=i,this.icon=n,this.template=s.compile(e),this.sendNotification=o,this.subscribe()}function x(){}function N(t){var e,n,i,o,s=ps.call(this)||this,a=(s.saveSettingsNowDebounced=_.debounce(s.saveSettingsNow.bind(s),100),s.activeViewStateToPropertyPaths={},s.propertyPathsToViewStates={},s.activeViewStateToSubscriptions={},s.subscriptionsToViewStates={},s.viewStateSubscriptions={},s.interface={},s.subscriptions={},s.getTemplateViewStates=function(t){return this.processTemplateViewStates(this.getViewStates(this.extractTemplateViewStates(t)))},s.notifyViewStateSubscriber=function(t){var e=this.viewStateSubscriptions[t],t=this.subscriptionsToViewStates[t];_.isFunction(e)&&e(this.getViewStates(t))},s.subscribe=function(t,e,n,i){var o;if("data"===this.getSourceType(t)){if(o=this.getDataSourceKey(t),this.subscriptions[o])return this.subscriptions[o].callback=e,!1;this.subscriptions[o]={key:this.getSubscriptionKey(t.path),source:t,onData:e},t.subscribe(this.subscriptions[o].key,this.subscriptions[o],n,i)}else cs.Log.Warn("Source type not implemented")},s.subscribeTemplateViewStates=function(t,e){var n=this;return this.subscribeViewStates(this.extractTemplateViewStates(t),function(t){e(n.processTemplateViewStates(t))})},s.subscribeViewStates=function(t,e){var n=this,i=_.uniqueId("vs_");return this.viewStateSubscriptions[i]=e,this.subscriptionsToViewStates[i]=[],_.each(t,function(t){t=n.docViewModel.getByPath(t);t&&(n.subscriptionsToViewStates[i].push(t.path),n.activeViewStateToSubscriptions[t.path]?-1===n.activeViewStateToSubscriptions[t.path].indexOf(i)&&n.activeViewStateToSubscriptions[t.path].push(i):(n.activeViewStateToSubscriptions[t.path]=[i],n.listenTo(t,"change:value",function(t,e){var n=this;_.each(this.activeViewStateToSubscriptions[t.path],function(t){n.notifyViewStateSubscriber(t)})})))}),this.notifyViewStateSubscriber(i),i},s.unsubscribe=function(t){var e;switch(this.getSourceType(t)){case"data":e=this.getDataSourceKey(t),this.subscriptions[e]&&(t.unsubscribe(this.subscriptions[e].key),delete this.subscriptions[e]);break;case"viewstate":this.stopListening(t,"change:value")}},s.unsubscribeAll=function(){var i=this;_.each(this.subscriptions,function(t,e){t.source.unsubscribe(t.key),delete i.subscriptions[e]}),_.defer(function(){_.each(i.activeViewStateToPropertyPaths,function(t,e){var n=i.docViewModel.getByPath(e);i.stopListening(n,"change:value"),delete i.activeViewStateToPropertyPaths[e]}),_.each(i.activeViewStateToSubscriptions,function(t,e){var n=i.docViewModel.getByPath(e);i.stopListening(n,"change:value"),delete i.activeViewStateToSubscriptions[e]})})},s.unsubscribeViewStates=function(n){var i=this;this.viewStateSubscriptions[n]&&(_.each(this.subscriptionsToViewStates[n],function(t){var e;i.activeViewStateToSubscriptions[t]=_.without(i.activeViewStateToSubscriptions[t],n),_.isEmpty(i.activeViewStateToSubscriptions[t])&&_.isEmpty(i.activeViewStateToPropertyPaths[t])&&(e=i.docViewModel.getByPath(t),i.stopListening(e,"change:value"),delete i.activeViewStateToSubscriptions[t])}),delete this.subscriptionsToViewStates[n],delete this.viewStateSubscriptions[n])},s.unsubscribeTemplateViewStates=function(t){this.unsubscribeViewStates(t)},[]);return s.appKey=t.appKey,s.componentId=t.componentId,s.dashboardAppModel=t.dashboardAppModel,s.dashboardViewModel=t.dashboardViewModel,s.deltaClient=t.deltaClient,s.deltaClientLib=t.deltaClientLib,s.docDataModel=t.docDataModel,s.docViewModel=t.docViewModel,s.settingsModel=t.settingsModel,s.quickView=t.quickView,s.widgetId=t.widgetId,s.isEmbedded=!!t.dashboardAppModel.get("embedded"),s.activeViewStateToPropertyPaths={},s.propertyPathsToViewStates={},s.interface={},s.subscriptions={},a=_.union(a,N.API_METHODS),t.advancedMethods&&(a=_.union(a,N.ADVANCED_METHODS)),_.each(a,_.bind(function(t){_.isFunction(this[t])?this.interface[t]=_.bind(this[t],this):_.isUndefined(this[t])||(this.interface[t]=this[t])},s)),t.docViewModel&&t.docViewModel.viewStates&&t.dashboardAppModel.get("documents")&&(a=t.docViewModel.viewStates.filter(function(t){return t.path.startsWith("_settings/")}),e=_.get(t,"deltaClientLib.username")||s.dashboardAppModel.get("userName"),s.isEmbedded&&(n=t.dashboardAppModel.get("userData"))&&(e=n.username),n=t.dashboardViewModel.get("selectedDocumentId"),t=t.dashboardAppModel.get("documents").get(n),i=_.isNil(t)?"":t.get("name"),o=_.get(cs,"Tools.timezone"),_.each(a,function(t){switch(t.path.slice("_settings/".length)){case"dashboardUser":e&&t.model.set("value",e,{silent:!0});break;case"dashboardUrl":_.get(document,"URL")&&t.model.set("value",document.URL,{silent:!0});break;case"dashboardTitle":i&&t.model.set("value",i,{silent:!0});break;case"dashboardTimezone":o&&t.model.set("value",o,{silent:!0})}})),s.listenTo(s.docViewModel,"change",function(t,e){var n,i,o,s,a=this;e&&e.unset?(this.renamingViewState=(t.path?t.path+"/":"")+_.first(_.keys(t.changed)),_.defer(_.bind(function(){this.renamingViewState=null},this))):(this.renamingViewState&&(e=this.renamingViewState,n=_.first(_.keys(t.changed)),e!==(s=(t.path?t.path+"/":"")+n))&&(t=t.get(n).isGroup(),i=new RegExp("^"+e+(t?"/":"$")),o=s+(t?"/":""),_.each(this.activeViewStateToPropertyPaths,function(t,e){var n;e&&e.match(i)&&(n=e.replace(i,o),a.activeViewStateToPropertyPaths[n]=t,delete a.activeViewStateToPropertyPaths[e])}),_.each(this.activeViewStateToSubscriptions,function(t,e){var n;e&&e.match(i)&&(n=e.replace(i,o),a.activeViewStateToSubscriptions[n]=t,delete a.activeViewStateToSubscriptions[e])}),_.each(this.propertyPathsToViewStates,function(t,e){t&&t.match(i)&&(t=t.replace(i,o),a.propertyPathsToViewStates[e]=t)}),_.each(this.subscriptionsToViewStates,function(t,n){_.each(t,function(t,e){t&&t.match(i)&&(t=t.replace(i,o),a.subscriptionsToViewStates[n][e]=t)})})),this.renamingViewState=null)}),s}function pa(t){var e=hs.call(this,t)||this;return e.$appDiv=null,e.app=null,e.appOnSettingsChange=null,t.el||e.el.classList.add("component-build-view"),_.extend(e,_.pick(t,pa.COMMON_OPTIONS)),t.key?(e.componentId=t.namespace||_.uniqueId("component_"),e.appOptions=t.appOptions,e.key=t.key,e.settingsModel=t.settings instanceof f.Model?t.settings:new ds.ComponentOptions(t.settings,{},null)):(e.componentId=e.model.id,e.key=e.model.get("key"),e.settingsModel=e.model.get("options")),e.initializeApi(),e.render(),e.requireApp(),e}function da(t){var e=ms.call(this,t)||this;return e.isCancel=!1,e.options=t,e.preRender(),e.render(),e.postRender(),e.resizeListener=e.onResize.bind(e),$(window).on("resize",e.resizeListener),e}function ha(t){return ys.call(this,_.extend({iconClass:"fa-asterisk",dialogTitle:"Save Changes",minHeight:110,width:300},t,{userClass:"areyousure-dialog"+(t.userClass?" "+t.userClass:"")}))||this}function ga(e){var n=bs.call(this,e)||this,i=(n.MESSAGE_TYPES=["error","success","warning"],n.clicked=!1,f.Model.extend({schema:{username:{title:t("Username")},oldpassword:{title:t("Current Password"),type:"Password",validators:["required"]},password1:{title:t("New Password"),type:"Password",validators:["required"]},password2:{title:t("Re-Enter"),type:"Password",validators:[{type:"match",field:"password1",message:"Passwords must match!"},"required"]}}}));return n.boundToggleCaps=n.toggleCapsLockMsg.bind(n),n.model=new i({username:void 0}),delete n.model.schema.username,n.form=new f.Form({model:n.model}).render(),n.$el.append(n.form.el),n.$el.append('<div class="message-box">'),$(n.form.el).submit($.proxy(n.onSubmit,n)),n.$messageBox=n.$el.find(".message-box"),e.message?n.showMessage(e.message):n.showMessage(),n.onChangeSuccess=e.onChangeSuccess,n.$dialog=n.$el.dialog(_.extend({appendTo:e.container,classes:{"ui-dialog":"quick-base change-password-dialog"},title:t("Change Password"),resizable:!1,height:262,width:320,modal:!0,autoOpen:!0,draggable:!0,buttons:[{text:t("OK"),click:$.proxy(n.onSubmit,n),icon:"fa fa-check"},{text:t("Cancel"),click:$.proxy(n.close,n),icon:"fa fa-times"}],open:function(){$('<i class="fa fa-check"></i>').insertBefore(n.$el.parent().find(".ui-dialog-title")),$(".quick-base").addClass("disturbed"),n.$okBtn=$(n).parent().find(".ui-dialog-buttonpane button").first(),n.$el.find(".old-password-input").focus()},close:function(){$(".quick-base").removeClass("disturbed"),vs.ErrorTooltip.clearAll(),_.isFunction(e.onClose)&&e.onClose(),n.onRemove(),_.isFunction(e.onDialogClose)&&e.onDialogClose()}},e)),$(n.form.el).find("input").on("keydown",function(t){13===t.which&&n.onSubmit()}),$(n.form.el).find("input").on("keypress",function(e){vs.LoginDialog.checkCapslockOn(e.originalEvent)?n.showMessage('<i class="fa fa-warning"></i>'+t("Caps Lock is on"),"warning"):n.showMessage()}),window.addEventListener("keydown",n.boundToggleCaps,!0),n}function ma(t){var e=Ss.call(this,_.extend({iconClass:"fa-trash-o",dialogTitle:"Confirm Delete",minHeight:110,width:275},t,{userClass:"confirm-dialog"+(t.userClass?" "+t.userClass:"")}))||this;return _.isFunction(t.renderTemplate)&&(e.renderTemplate=t.renderTemplate),e}function fa(t){return ws.call(this,_.extend({iconClass:"fa-exclamation-triangle",dialogTitle:"Error",minHeight:110,width:275},t,{userClass:"error-dialog"+(t.userClass?" "+t.userClass:"")}))||this}function ya(t){return Ts.call(this,_.extend({dialogTitle:"Warning"},t,{userClass:"warning-dialog"+(t.userClass?" "+t.userClass:"")}))||this}function L(t){var e=Ds.call(this,t)||this;return e.COMPONENT_SAVE_TIMEOUT=2e3,e.QUERY_STATUS_DELAY=200,e.QUERY_STATUS_FADE=3e3,e.showNoResultsIndicators=!1,e.customErrorClass="",e.showExpandButton=!1,e.model.set("upgrading",!0,{silent:!0}),L._instances.push(e),e.webGLContextAndCanvas=t.webGLContextAndCanvas,e.showExpandButton=t.expandButton,e.basePanel=t.basePanel,e}function R(t){t=Ms.call(this,t)||this;return t.widgetClass="component-drop-widget",t}function va(t){var e=Is.call(this,t)||this;return e.appModel=null,e.availableHeight=0,e.documentsList=null,e.documentTypeMap=null,e.showManage=!1,e.viewModel=null,e.RECENT_DOCUMENT_COUNT=3,e.appModel=t.appModel,e.viewModel=t.viewModel,e.showManage=t.showManage,e.debouncedRender=_.debounce(e.render,100),e.initializeEvents(),e}function ba(t){var e=ks.call(this,t)||this,n=(e.cssClasses=null,e.customCss=null,e.$customCss=null,e.popups=[],e.prevCssViewModel=null,e.appModel=t.appModel,e.viewModel=t.viewModel,e.quickView=t.quickView,e.model.upgrade(),e.el.className="document-view",e.$el.html(As.T.DocumentView({})),e.initializeEvents(),e.applyCustomCss(),e.onCssClassesChanged(),e.onSelectedScreenChanged(),e.quickView||e.onResetPopups(),[{rule:" ",theme:"none",color:"none"}]);if(!t.appModel.get("embedded"))try{Array.prototype.forEach.call(_.get(document,"styleSheets"),function(t){if(t.href&&!t.href.startsWith(location.origin))return!1;_.each(_.get(t,"cssRules"),function(t){var e;_.get(t,"selectorText")&&0<=_.get(t,"selectorText").indexOf("palette_")&&(e=_.get(t,"selectorText").split(" "),n.push({rule:e&&0<=e.length?e[0]:"",theme:e&&0<e.length?e[1]:"",color:_.get(t,"style.color")}))})})}catch(t){console.log("Failed to read the 'cssRules' property",t)}return e.appModel.set("globalPalettes",n),e}function Sa(t){var e=Ns.call(this,t)||this;return e.errorMessage=t.errorMessage,e.appModel=t.appModel,e.container=t.container,e.doLogin=t.doLogin,e.container.html(e.render().$el),e.boundCapsLockFn=$.proxy(e.onWindowCapsLockClick,e),e.initializeEvents(),e.setCookiesToSameSite("Strict"),e}function wa(){}function _a(t){var e=Rs.call(this,t)||this;return e.isQuickView=!1,e.el.className="main-menu ui-widget ui-widget-content",e.mainMenuButton=t.mainMenuButton,e.appModel=t.appModel,e.viewModel=t.viewModel,e.isQuickView=t.isQuickView,e.menuClickHandler=e.onMenuItemClick.bind(e),e.mouseOverMenuItemHandler=e.onMouseOverMenuItem.bind(e),e.keyDownHandler=e.onKeyDown.bind(e),e.documentMouseDownHandler=e.onDocumentMouseDown.bind(e),e.renderView(),e.initializeEvents(),e}function Ta(t){var e=Os.call(this,t)||this;return e.MAJOR_TIMEZONES=[{label:"UTC / Unaltered",value:"UTC"},{label:"Frankfurt",value:"Europe/Berlin"},{label:"London",value:"Europe/London"},{label:"New York",value:"America/New_York"},{label:"Sydney",value:"Australia/Sydney"},{label:"Tokyo",value:"Asia/Tokyo"}],e.logLevels=[{label:"None",value:0},{label:"Errors",value:1},{label:"Handled/Warnings",value:2},{label:"Log & Debugs",value:3},{label:"All",value:4}],e.dialogContainer=null,e.isQuickView=!1,e.el.className="account-menu ui-widget ui-widget-content",e.appModel=t.appModel,e.dialogContainer=t.dialogContainer,e.themes=t.themes,e.viewModel=t.viewModel,e.isQuickView=!!t.isQuickView,e.$el.click(function(t){$(t.target).hasClass("ui-menu-item-wrapper")||t.stopPropagation()}),e.listenTo(e.viewModel,"change:themeSwitchable",e.onThemeSwitchableChange),e.getTimezones(),e.render(),e}function Ca(t){var e=$s.call(this,t)||this;return e.viewStateListeners={},e.appModel=t.appModel,e.viewModel=t.viewModel,e.quickView=t.quickView,e.isEditing=t.isEditing,e.$el.html(Bs.T.popup({})),e.$dialog=e.$el.find(".dialog"),e.$contentPanel=e.$dialog.find(".content-panel"),t.container?e.$dialogContainer=t.container:e.$dialogContainer=$(".quick-dash > .content-panel > .document-view"),e.onDialogAttributeChange=_.debounce(e.initializeDialog,100),e.initializeDialog(),e.initializeEvents(),e.initializeVisible(),e}function Da(t){var e=qs.call(this,t)||this;return e.isCancel=!1,e.options=t,e.initColorPicker(e.options.path),e}function Ea(){}function Ma(){}function Pa(t){return Hs.call(this,_.extend({iconClass:"fa-keyboard-o",dialogTitle:"Simple Input",userClass:"simpleinput-dialog",width:275,height:140},t,{userClass:"simpleinput-dialog"+(t.userClass?" "+t.userClass:"")}))||this}function Ia(t){this.csvExportDelimiter=t.csvExportDelimiter,this.dataSet=t.dataSet,this.metaData=t.metaData,this.configSets=t.configSets,this.workSheetTitle=t.workSheetTitle,this.fileFormat=t.fileFormat,this.fileName=t.fileName,this.actions=t.actions,this.selectedDashboard=t.selectedDashboard,this.isPreserveKDBTypes=null==t?void 0:t.isPreserveKDBTypes,this.bookType={".xlsx":"xlsx",".xls":"xlml",".csv":"csv"}[t.fileFormat]}function Aa(t){var e=zs.call(this,t)||this;return e.DATA_SOURCE_PROPERTY="Basics.Data",e.EXPORT_PROPERTY_OBJECT="FileExport",e.EXPORT_PROPERTY_KEYS=["ShowExportCsvButton","ShowExportExcelButton","ShowFullExportButton","ShowClipboard","ShowScreenshot"],_.extend(e,_.pick(t,e.SETTINGS)),e.isIE=HTMLCanvasElement&&HTMLCanvasElement.prototype&&HTMLCanvasElement.prototype.msToBlob,e.$el.html(Qs.T.fileExporter({})),e.$root=e.$el.find(">.pnlButtons"),e.$lnksExport=e.$el.find(".lnksExport"),e.$lnkCsvExport=e.$el.find("a.lnkCsvExport"),e.$lnkExcelExport=e.$el.find("a.lnkExcelExport"),e.$lnkFullExport=e.$el.find("a.lnkFullExport"),e.$lnksScreenshot=e.$el.find(".lnksScreenshot"),e.$lnkCopyScreenshot=e.$el.find("a.lnkCopyScreenshot"),e.$lnkDownloadScreenshot=e.$el.find("a.lnkDownloadScreenshot"),e.initializeEvents(),e}function ka(){}function xa(){}function Na(){}function V(){}function La(){}function Ra(){}function Va(t){this.mode=t}function Oa(t,e,n){return!(!e||!e.isTargeting_insightsSDK())}function Ba(t,e,n){return!(!e||e.isTargeting_insightsSDK())}function $a(t,e,n){return!(!(t=t.get("hasPermission"))||!t("canEditStream"))}function Ua(t,e,n){return t.get("isSqlEditorVisible")}function qa(t,e){this.connName=t,this.getAssemblyInfo=e,this.cacheCleanupIntervalMiliseconds=1e4}function Fa(t){this.getAssemblyInfo=t,this.cacheMap=new Map}function O(t,e){this.appModel=t,this.appViewModel=e,this._isActivated=!1;e=t.attributes;this._mode=e.embedded?sa.Mode.IE:e.isLite?sa.Mode.Direct:sa.Mode.Delta,this._datasourceEditorLayoutManager=new sa.DatasourceEditorLayoutManager(this._mode)}us=A=A||{},x.generateAggregatedMessage=function(t){var e=[];return _.each(t,function(t){t&&t[1]&&(t=t[1].message||"",e.push(37<t.length?t.substring(0,37)+" ..":t))}),e.join("\r\n")},x.generateAudio=function(t){var e=_.now(),n=x.suspendedAudioNotifications[t];return void 0===n||n<e?(x.suspendedAudioNotifications[t]=e+5e3,new Audio(x.MEDIA_LOCATION+t+".mp3")):null},x.notify=function(t,e,n){var i=x.currentSettings.Notifications;if(t!==x.AGGREGATED_ID&&x.getPropertyValue(i.Grouping)&&x.getPropertyValue(i.GroupingInterval))0===x.pendingNotifications.length&&(x.pendingNotificationsTimeoutId=setTimeout(function(){1<x.pendingNotifications.length?x.notify(x.AGGREGATED_ID,{title:x.pendingNotifications.length+" alerts received",message:x.generateAggregatedMessage(x.pendingNotifications)},!0):(x.pendingNotifications[0][0]=x.AGGREGATED_ID,x.notify.apply(x,x.pendingNotifications[0])),x.pendingNotificationsTimeoutId=void 0,x.pendingNotifications=[]},1e3*x.getPropertyValue(i.GroupingInterval))),x.pendingNotifications.push(_.concat([],arguments));else{if(n&&x.getPropertyValue(i.SoundVolume)&&"Audio"in window)try{var o=void 0;_.isBoolean(n)&&"none"!==i.Sound?o=x.generateAudio(i.Sound):"none"!=n.sound&&(o=x.generateAudio(n.sound)),o&&(o.volume=x.getPropertyValue(i.SoundVolume)/100,o.play().then(function(){}).catch(function(){x.hasNotified||(x.notify("Notification API",{icon:"fa-volume-off",message:"Your browser is blocking notification audio, interact with the page to enable audio.",title:"Notification Audio Error"}),x.hasNotified=!0)}))}catch(t){us.Log.Error("Audio API ERROR",arguments)}if(e){var s,o=x.getPropertyValue(i.InBrowserNotifications)||!("Notification"in window)||"denied"===Notification.permission,a=e.title||"Alert",r=e.message||"",l=e.icon||("none"!==i.Icon?i.Icon:null);if("object"==typeof(l="string"==typeof l?l.substring(3):l)&&(l=null==(s=null==l?void 0:l.attributes)?void 0:s.value.substring(3)),o)x.$pnlNotifications||(s=function(){var t=$(this).closest(".inBrowserNotification"),e=t.data("fadeOutId");e&&clearTimeout(e),t.remove()},(x.$pnlNotifications=$("<div></div>",{class:"pnlInBrowserNotifications"}).appendTo($(".document-view"))).on("click","i",s),x.$pnlNotifications.on("dblclick",".inBrowserNotification",s)),x.positionPanel(x.$pnlNotifications,i.Position),x.$pnlNotifications.children().length>=x.getPropertyValue(i.MaxVisibleCount)&&x.$pnlNotifications.children().first().remove(),o=$(us.T.InBrowserNotification({title:a,message:r.replace(/\r\n/g,"<br>"),icon:l})).appendTo(x.$pnlNotifications),x.getPropertyValue(i.FadeOut)&&o.data("fadeOutId",setTimeout(o.remove.bind(o),1e3*x.getPropertyValue(i.FadeOut)));else try{var u,c=new Notification(a,{body:r,icon:l?x.isWindows10()?x.ICON_LOCATION_LIGHT+l+".png":x.ICON_LOCATION+l+".png":void 0,silent:!0});x.getPropertyValue(i.FadeOut)&&(u=function(){c.close(),window.removeEventListener("beforeunload",u)},c.onshow=function(){setTimeout(u,1e3*x.getPropertyValue(i.FadeOut))},window.addEventListener("beforeunload",u))}catch(t){us.Log.Error("Notification API ERROR",arguments)}}}},x.positionPanel=function(t,e){e={"Top Left":"","Top Center":"position_center","Top Right":"position_right","Center Left":"position_middle","Center Center":"position_middle position_center","Center Right":"position_middle position_right","Bottom Left":"position_bottom","Bottom Center":"position_bottom position_center","Bottom Right":"position_bottom position_right"}[e];t.removeClass("position_middle position_bottom position_center position_right").addClass(e)},x.isWindows10=function(){return 0<=window.navigator.userAgent.search(/(Windows 10.0)|(Windows NT 10.0)/)},x.setOptions=function(t){x.currentSettings=t,x.datasourceNotifier.onTriggerChange(t.Notifications.triggers||[]),x.pendingNotificationsTimeoutId&&(clearTimeout(x.pendingNotificationsTimeoutId),x.pendingNotificationsTimeoutId=void 0,x.pendingNotifications=[])},x.show=function(t,e,n){var i,o=this,s=null==(s=x.currentSettings)?void 0:s.Notifications;null!=s&&s.Enabled&&x.getPropertyValue(s.Enabled)&&(x.getPropertyValue(s.InBrowserNotifications)||!("Notification"in window)||"granted"===Notification.permission||"denied"===Notification.permission?x.notify(t,e,n):(i=arguments,Notification.requestPermission(function(){x.show.apply(o,i)})))},x.upgradeConfig=function(e){var t;e?(t=void 0,e.Notifications._Version!==(t=x.DEFAULT_JSON.Notifications._Version)&&(e.Notifications._Version=t)):e=x.DEFAULT_JSON;return["Enabled","FadeOut","Grouping","GroupingInterval","InBrowserNotifications","MaxVisibleCount","SoundVolume","Icon"].forEach(function(t){t="Notifications.".concat(t);"viewstate"===_.get(e,"".concat(t,"._dashboardsType"))&&x.viewStateModel&&_.set(e,t,x.viewStateModel.getByPath(_.get(e,"".concat(t,".value"))))}),e.Notifications.triggers=e.Notifications.triggers?e.Notifications.triggers.map(function(t){var e=t.source;return at(at({},t),{source:"data"===_.get(e,"_dashboardsType")?x.documentDataModel.getByPath(e.value):e,icon:"viewstate"===_.get(null==t?void 0:t.icon,"_dashboardsType")?x.viewStateModel.getByPath(null==(e=null==t?void 0:t.icon)?void 0:e.value):t.icon})}):[],e},x.setDocumentDataModel=function(t){this.documentDataModel=t},x.setViewStateModel=function(t){this.viewStateModel=t},x.getPropertyValue=function(t){return"boolean"==typeof t||"number"==typeof t||"string"==typeof t?t:null==(t=null==t?void 0:t.attributes)?void 0:t.value},x.pendingNotifications=[],x.AGGREGATED_ID="AGGREGATED_NOTIFICATION",x.hasNotified=!1,x.suspendedAudioNotifications={},x.MEDIA_LOCATION=require.toUrl("QuickBase").replace("/main","")+"/notifications/",x.ICON_LOCATION=require.toUrl("QuickBase").replace("/main","")+"/images/black/",x.ICON_LOCATION_LIGHT=require.toUrl("QuickBase").replace("/main","")+"/images/white/",x.SCHEMA={type:"object",title:"Properties",properties:{Notifications:{type:"object",title:"Notifications",options:{collapsed:!0},properties:{_Version:{type:"string",default:"4.2.0s2",options:{hidden:!0}},Enabled:{title:"Enabled",propertyOrder:100,type:"booleanViewState",format:"checkbox",default:!0},InBrowserNotifications:{title:"InBrowser",propertyOrder:110,type:"booleanViewState",format:"checkbox",default:!1},Position:{title:"Position",propertyOrder:120,type:"string",enum:["Top Left","Top Center","Top Right","Center Left","Center Center","Center Right","Bottom Left","Bottom Center","Bottom Right"],default:"Bottom Right"},MaxVisibleCount:{title:"Max Count",propertyOrder:130,type:"numberViewState",minimum:1,default:3},FadeOut:{title:"FadeOut (s)",propertyOrder:140,type:"numberViewState",minimum:0,default:5},Icon:{title:"Icon",propertyOrder:150,type:"icon",default:"fa-bell-o",iconTypes:"fa"},Sound:{title:"Sound",propertyOrder:160,type:"string",enum:x.NOTIFICATION_SOUNDS=["beep","beepbeep","ding","exquisite","long-expected","festive","job-done","arcade","echo","case-closed","none","application-ready","arcade-beep","arcade-beep-double","atm","bells-echo","doorbell-double","doorbell-single","harp","horn-car","horn-double","horn-funny","meow","moo","notification-fast","popup","quick-chime","quick-tone","quick-tone-double","stopwatch","whistle"],default:"beep"},SoundVolume:{title:"Sound Volume",propertyOrder:170,type:"numberViewState",format:"range",minimum:0,maximum:100,default:100},Grouping:{title:"Group Notifications",propertyOrder:180,type:"booleanViewState",format:"checkbox",default:!1},GroupingInterval:{title:"Grouping Interval (s)",propertyOrder:190,type:"numberViewState",minimum:0,default:1},triggers:{title:"Additional Triggers",type:"array",items:{type:"object",id:"arrItem",additionalProperties:!1,options:{collapsed:!0},title:"Datasource Trigger",properties:{source:{type:"data",propertyOrder:100,title:"Datasource"},template:{type:"tooltipTemplate",propertyOrder:101,title:"Notification Template",default:"{{#each this}}{{@key}}: {{this}}\n{{/each}}"},sound:{title:"Sound",propertyOrder:103,type:"string",enum:x.NOTIFICATION_SOUNDS,default:"beep"},icon:{title:"Icon",iconTypes:"fa",propertyOrder:102,type:"icon",default:"fa-bell-o"}}}}}}}},x.DEFAULT_JSON={Notifications:_.mapValues(x.SCHEMA.properties.Notifications.properties,"default")},x.currentSettings=x.DEFAULT_JSON,x.datasourceNotifier=new us.DatasourceNotifier(x.show),x.CONFIG={SCHEMA:x.SCHEMA,upgradeConfig:x.upgradeConfig},us.NotificationManager=x,cs=A=A||{},ps=cs.CustomEvents,e(N,ps),N.prototype.getDataSourceMap=function(t,e,n){var i=this.dashboardViewModel.get("selectedDocumentId"),i=this.dashboardAppModel.get("documents").get(i);try{return new cs.DocumentGraph(i.get("viewState"),i.get("data"),i.getComponents(),this.dashboardAppModel.get("components").models,this.isEmbedded,i.get("data").getByPath.bind(i.get("data")),null).getFormDataSources(t,e,n)}catch(t){console.error("ComponentApi.getDataSourceMap error",t)}},N.prototype.convertPathsToModels=function(t,e,a){var r,l=f.DeepModel.keyPathSeparator;if(!t)return!1;switch(t){case"data":r=$.proxy(this.docDataModel.getByPath,this.docDataModel);break;case"viewstate":r=$.proxy(this.docViewModel.getByPath,this.docViewModel)}t=this.getPropertiesByType(t,e.properties,e.definitions),_.each(t,function(t){var n,i,o,s,e,t=t.replace(/\.properties/g,"");1<(e=(t=t.replace(/\.oneOf\.\d+/g,"")).split(".items.")).length?(o=e[0],s=e[1],e=a.get(o),_.each(e,function(t,e){(i=function(t,e){e=e.split(".");for(var n=t,i=0;i<e.length;i++)n=n&&n[e[i]];return n}(t,s))&&"string"==typeof(i=i._dashboardsType?i.value:i)&&(n=(n=r(i))||{},a.set(o+l+e+l+s,n,{silent:!0}))})):(i=a.get(t))&&"string"==typeof(i=i._dashboardsType?i.value:i)&&(n=(n=r(i))||{},a.set(t,n,{silent:!0}))})},N.prototype.humanFileSize=function(t,e,n){void 0===n&&(n=1);var i=(e=void 0===e?!0:e)?1e3:1024;if(Math.abs(t)<i)return t+" B";for(var o=e?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],s=-1,a=Math.pow(10,n);t/=i,++s,Math.round(Math.abs(t)*a)/a>=i&&s<o.length-1;);return t.toFixed(n)+" "+o[s]},N.prototype.destroySettings=function(){var t;this.quickView&&(t=this.docViewModel.get(".settings"))&&t.unset(this.componentId)},N.prototype.exportData=function(o,s,a,r){var l=this;"data"===this.getSourceType(o)?o.exportData(function(t){var e,n,i;(-1<navigator.userAgent.toLowerCase().indexOf("firefox")||-1<navigator.userAgent.toLowerCase().indexOf("safari"))&&-1===navigator.userAgent.toLowerCase().indexOf("chrome")?((e=document.createElement("a")).setAttribute("href",t),e.setAttribute("download",""),document.body.appendChild(e),e.click(),document.body.removeChild(e)):(window.open(t,"_blank","noopener,noreferrer,resizable"),e=t,n=function(t){t=l.humanFileSize(t);try{l.onTransferAction(r,a.exportName,_.get(o,"dataSet.columnDict"),"success","zip",t,"download")}catch(t){l.onTransferAction(r,a.exportName,_.get(o,"dataSet.columnDict"),"failed","zip",0,"download")}},(i=new XMLHttpRequest).open("HEAD",e,!0),i.onreadystatechange=function(){this.readyState===this.DONE&&n(parseInt(i.getResponseHeader("Content-Length")))},i.send()),_.isFunction(s)&&s(t)},function(t){t="Export Data error"+(t?": "+t.toString():"");l.onTransferAction(r,a.exportName,_.get(o,"dataSet.columnDict"),t,"zip",0,"download"),cs.Log.Error(t),cs.ErrorDialog.ShowError(t),_.isFunction(s)&&s()},a):_.isFunction(s)&&s()},N.prototype.onTransferAction=function(i,o,s,a,r,l,u){_.each(_.get(i,"actions"),function(t){var e=_.get(t,"EventType"),n="success"===a,e="all"===e||"onSuccess"===e&&n||"onFail"===e&&!n;_.get(t,"Result.attributes")&&e&&t.Result.set("value",{component:_.get(i,"component"),dashboard:{dashboardId:_.get(i,"dashboardId"),dashboardName:_.get(i,"dashboardName")},fileRowLength:_.get(i,"fileLength")?_.get(i,"fileLength"):"na",fileMetaData:_.isNil(s)?"na":s,fileName:o,size:l,fileType:r,isSuccess:n,status:a,timestamp:Date.now(),type:_.isNil(u)?"download":u,username:cs.DeltaClientLib.username})})},N.prototype.getDashboardName=function(e){var t=this.dashboardAppModel.get("documents").models,t=_.filter(t,function(t){return t.get("id")===e});return 0<t.length?t[0].get("name"):""},N.prototype.doActionsAsync=function(r,l,u){return rt(this,void 0,void 0,function(){var i,e,o,n,s,a;return lt(this,function(t){switch(t.label){case 0:e=function(e){var n;return lt(this,function(t){switch(t.label){case 0:if(!e.Async)return[3,9];switch(e=o.setActionType(e),n=e._PropertyIndex||i,n=(u||"Actions")+"."+n,e._Type){case"map":return[3,1];case"nav":return[3,3];case"query":return[3,4];case"rollingOrDefault":return[3,6];case"url":return[3,7]}return[3,8];case 1:return l=o.doActionViewstate(n,e,l),[4,o.waitForData(o,e.DataSource,250)];case 2:return t.sent(),[3,8];case 3:return l=o.doActionNav(n,e,l),[3,8];case 4:return e.DataSource&&e.DataSource.forceExecute(void 0,function(){e.callback}),[4,o.waitForData(o,e.DataSource)];case 5:return t.sent(),[3,8];case 6:return o.doActiosRolling(e,n),[3,8];case 7:return o.doActionsURL(e),[3,8];case 8:o.actionNavigate(l),t.label=9;case 9:return i+=1,[2]}})},o=this,n=i=0,s=r,t.label=1;case 1:return n<s.length?(a=s[n],[5,e(a)]):[3,4];case 2:t.sent(),t.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},N.prototype.doActionsSync=function(t,e,n){for(var i=0,o=0,s=t;o<s.length;o++){if(!(a=s[o]).Async){var a,r=(n||"Actions")+"."+((a=this.setActionType(a))._PropertyIndex||i);switch(a._Type){case"map":e=this.doActionViewstate(r,a,e);break;case"nav":e=this.doActionNav(r,a,e);break;case"query":a.DataSource.forceExecute(void 0,a.callback);break;case"rollingOrDefault":this.doActiosRolling(a,r);break;case"url":this.doActionsURL(a)}this.actionNavigate(e)}i+=1}},N.prototype.doActiosRolling=function(t,e){_.isEmpty(t.ViewState)||(t=(t=this.getPropertyMeta(e+".ViewState")).isRolling?cs.Helpers.convertRollingToDate(t.defaultValue,t.viewstateType):t.defaultValue,this.setProperty(e+".ViewState",t))},N.prototype.doActionsURL=function(t){var e,n=t.Url;/\S+/g.test(n)&&(/^https?:\/\//i.test(n)||(n="//"+n),console.log("Action to OPen ",t),"_tab"===t.Target?(e=window.open("about:blank","noopener,noreferrer"),fetch("/api/validate").then(function(t){return t.json()}).then(function(t){e.location=n,e.focus()}).catch(function(t){e.close()})):"_blank"===t.Target?window.open(n,"_blank","noopener,noreferrer,resizable"):window.open(n,"_self","noopener,noreferrer,resizable"))},N.prototype.doActionViewstate=function(t,e,n){var i=this.getPropertyMeta(t+".Current"),o=this.getPropertyMeta(t+".Target");return n.viewstate||(n.viewstate={}),i&&(i=_.has(e,"Value")?e.Value:"viewstate"===i.type?i.value:e.Current,cs.Tools.isKDBTemporal(i)&&(i=cs.Tools.convertKDBTemporalToMoment(i).toDashString()),o&&"viewstate"===o.type&&o.path?this.setProperty(t+".Target",i):n.viewstate[e.Target]=i),n},N.prototype.doActionNav=function(t,e,n){t=this.getPropertyMeta(t+".SelectDashboardScreen"),t="viewstate"===t.type?t.value:e.SelectDashboardScreen;return _.isString(t)?(n.dashboard=t,n.screen=null):_.isObject(e)&&(e["SelectDashboardScreen._dashboardsType"]?_.extend(n,{dashboard:e["SelectDashboardScreen.dashboard"],screen:e["SelectDashboardScreen.screen"]}):_.isObject(t)&&_.extend(n,t)),e.Target&&(n.target=e.Target),n},N.prototype.setActionType=function(t){return t._Type||(_.isObject(t)?t._Type="nav":t={_Type:"nav",Value:t}),t},N.prototype.actionNavigate=function(t){"<none>"===t.dashboard&&"<none>"===t.screen||this.navigate(t)},N.prototype.doActions=function(t,e){var n={dashboard:"<none>",screen:"<none>",target:""};this.doActionsAsync(t,n,e),this.doActionsSync(t,n,e)},N.prototype.removeTooltip=function(){var t;this.unsubscribeTemplateViewStates(this.tooltipSubscriptionKey),this.tooltipSubscriptionKey="",null!=(t=this.genericTooltip)&&t.remove(),delete this.genericTooltip},N.prototype.setTooltip=function(t){var e=this;return this.genericTooltip?this.genericTooltip.updateTooltip(t):this.genericTooltip=new cs.GenericTooltip(_.extend(t,{cssClass:this.appKey+"-tooltip"})),this.unsubscribeTemplateViewStates(this.tooltipSubscriptionKey),this.tooltipSubscriptionKey=this.subscribeTemplateViewStates(this.genericTooltip.text,function(t){e.genericTooltip.renderTemplate(t)}),this.genericTooltip},N.prototype.extractTemplateViewStates=function(t){var e=this,t=t.match(/\$[^$]*\$/gi);return _.map(_.uniq(t),function(t){t=e.docViewModel.getByPath(t.substring(1,t.length-1).replace(/\./g,"/"));if(t)return t.path})},N.prototype.getDashboardId=function(e){var t="<none>"===e?null:e&&"<this>"!==e?this.dashboardAppModel.get("documents").find(function(t){return t.get("name")===e}):this.dashboardAppModel.get("documents").get(this.dashboardViewModel.get("selectedDocumentId"));return t?t.id:"<none>"},N.prototype.getScreenId=function(t,e){var n,i,o,t=this.dashboardAppModel.get("documents").get(t);return t&&(e&&"<none>"!==e?t.has("screens")?(o=t.get("screens").find(function(t){return t.get("name")===e}))&&(i=o.id):(n=_.find(t.get("screenDetails"),function(t){return t.label===e}))&&(i=n.value):(n=t.get("screenDetails")[0])&&(i=n.value)),i||"<none>"},N.prototype.getDataSourceKey=function(t){return!!t&&(t.path||t.cid)},N.prototype.getDictValue=function(t){var i=this,o={};return"dict"!==t.get("_type")||"object"!=typeof t.get("value")?t.get("value"):(_.each(t.get("value"),function(t,e){var n;t instanceof cs.DocumentViewModel?n=t.path:t instanceof f.Model?o[e]=t.get("value"):_.isObject(t)&&t.name?n=t.name:_.isString(t)&&t.match(cs.DocumentDataModel.PARAMETER_RX)&&(n=t.substring(2,t.length-2)),n?(n=i.docViewModel.getByPath(n),o[e]=n?n.get("value"):t):o[e]=t}),o)},N.prototype.getPropertiesByType=function(n,t,i,o,s){var a=this,r=f.DeepModel.keyPathSeparator;return o=o||"",i=i||{},s=s||[],t&&(t.type===n?s.push(o):t&&t.constructor===Object?_.each(t,function(t,e){"$ref"===e?a.getPropertiesByType(n,i[t.replace("#/definitions/","")],i,o,s):a.getPropertiesByType(n,t,i,(o?o+r:"")+e,s)}):t&&t.constructor===Array&&_.each(t,function(t,e){a.getPropertiesByType(n,t,i,(o?o+r:"")+e,s)})),_.uniq(s)},N.prototype.getProperty=function(t){var e,n;if(!t)return null;switch(e=this.settingsModel.get(t),this.getSourceType(e)){case"data":n=null;break;case"viewstate":n=this.getPropertyValue(e);break;default:n=e}return n},N.prototype.getPropertyMeta=function(t){var e,n,i,o,s;if(!t)return null;if(null==(e=this.settingsModel.get(t)))return null;switch(t=this.getSourceType(e)){case"data":s=null;break;case"viewstate":s=this.getPropertyValue(e),n=e.get("_default"),i=e.get("_type"),o=e.get("_rolling");break;default:s=e}return{path:e.path||null,type:t,value:s,viewstateType:i||null,defaultValue:n||null,isRolling:o||!1}},N.prototype.getPropertyValue=function(t){return"viewstate"===this.getSourceType(t)?"dict"===t.get("_type")?this.getDictValue(t):t.get("value"):t},N.prototype.getSourceType=function(t){return t?t instanceof cs.DocumentViewModel||t.get&&t.get("_viewType")||t.has&&t.has("_default")&&t.has("value")?"viewstate":t instanceof cs.DocumentDataModel||t.subscribe&&t.unsubscribe?"data":null:null},N.prototype.getSubscriptionKey=function(t){var e=this.appKey?this.appKey+" ":"";return e+=t||this.widgetId,_.uniqueId(e+":")},N.prototype.getViewState=function(t){return!(!t||!t.attributes)&&t.get("value")},N.prototype.getViewStates=function(t){var e=this;return _.zipObject(t,_.map(t,function(t){t=e.docViewModel.getByPath(t);if(t)return t.get("value")}))},N.prototype.hasPermission=function(t){var e=this.dashboardAppModel.get("hasPermission");return"function"==typeof e&&e(t)},N.prototype.hideErrorMessage=function(){this.trigger("hideErrorMessage")},N.prototype.hideQueryStatus=function(){this.trigger("hideQueryStatus")},N.prototype.isBuildMode=function(){return this.dashboardViewModel.get("buildMode")&&!this.quickView},N.prototype.isSelected=function(){var t=this.dashboardViewModel.get("selectedWidget");return!!t&&t.id===this.widgetId},N.prototype.loadApp=function(t,e,n,i,o,s){t&&e&&(s=s||t,new cs.AppView(_.extend({},{el:e,key:t,settings:n,appOptions:i,callback:function(t){_.isFunction(o)&&o(t)},namespace:this.componentId+N.NAMESPACE_SEPARATOR+s},_.pick(this,cs.AppView.COMMON_OPTIONS))))},N.prototype.loadSetting=function(t,e){var n,i;return t&&this.quickView&&(i=this.docViewModel.get(".settings"),n=this.componentId,e&&(n+=N.NAMESPACE_SEPARATOR+e),i)&&(e=i.get(n))?e.get(t):null},N.prototype.navigate=function(t){var e,n,i=null,o=null,s=null,a=null,r=null,l="";_.isString(t)?(n=t,s=this.dashboardAppModel.get("documents").get(n)?n:this.getDashboardId(n),r="<none>"):_.isObject(t)&&(i=t.dashboard,a=t.screen,e=t.viewstate,i instanceof f.Model?i=i.get("value"):_.isObject(i)&&i.id&&(i=i.id),a instanceof f.Model?a=a.get("value"):_.isObject(a)&&a.id&&(a=a.id),"<this>"===i&&(i=this.dashboardViewModel.get("selectedDocumentId")),(o=this.dashboardAppModel.get("documents").get(i))?s=i:(s=this.getDashboardId(i),o=this.dashboardAppModel.get("documents").get(s)),o)&&(r=_.isEmpty(o.get("screenDetails"))&&cs.Helpers.validateGuid(a)||_.find(o.get("screenDetails"),function(t){return t.value===a})?a:this.getScreenId(s,a)),_.isObject(e)&&!_.isEmpty(e)&&(l="?viewstate="+encodeURIComponent(JSON.stringify(e))),s&&r&&"<none>"!==s&&(i=null==(n=this.dashboardAppModel.get("embeddedAPI"))?void 0:n.openDashboard,"_blank"===t.target||"FSBL"in window&&s!==window.finApi.documentId?(o=(o="#"+s)+("<none>"!==r&&r?"/"+r:"")+(l||""),i?i("_blank",s,"<none>"!==r&&r?r:"",l):window.open(o)):"<none>"===r?i?i("_self",s,void 0,l):this.dashboardAppModel.get("router").navigate(s+l,{trigger:!0}):i?i("_self",s,r,l):this.dashboardAppModel.get("router").navigate(s+"/"+r+l,{trigger:!0}))},N.prototype.page=function(t,e){if(!_.isObject(e)||"data"!==this.getSourceType(t))return!1;e=_.pick(e,"_pagingType","_pagingNum","_pageSize","_pageSort"),t.set(e)},N.prototype.processSettings=function(t,u){var c=this,p=f.DeepModel.keyPathSeparator,d=function(e,n,i,o){var s,a,r,l,t;if(n=n||"",o=o||{},l=_.isUndefined(i)?n:i,e&&e.constructor===Object&&!_.isEmpty(e))_.each(e,function(t,e){d(r=t,a=(n?n+p:"")+e,s=(i?i+p:"")+e,o)});else if(e&&e.constructor===Array&&!_.isEmpty(e))_.keys(e).length<e.length?_.each(_.keys(e),function(t){r=e[t],d(r,a=(n?n+p:"")+t,s=(i?i+p:"")+t,o)}):_.each(e,function(t,e){o[l]||(o[l]=[]),r=t,a=(n?n+p:"")+e,s="",o[l][e]=d(r,a,s,null)});else if("viewstate"===c.getSourceType(e)&&(c.activeViewStateToPropertyPaths[e.path]?-1===c.activeViewStateToPropertyPaths[e.path].indexOf(n)&&c.activeViewStateToPropertyPaths[e.path].push(n):(c.activeViewStateToPropertyPaths[e.path]=[n],c.listenTo(e,"change:value",function(t,e){var n=c.activeViewStateToPropertyPaths[t.path],t=("dict"===t.get("_type")&&(e=_.transform(e,function(t,e,n){t[n]=c.getPropertyValue(e)})),_.zipObject(n,_.times(n.length,_.constant(e))));u&&u(t)})),c.propertyPathsToViewStates[n]=e.path),t=c.getPropertyValue(e),!_.isUndefined(t)){if(!l)return t;o[l]=t}return o},t=d(t);return _.each(c.activeViewStateToPropertyPaths,function(t,e){var t=_.filter(t,function(t){return c.propertyPathsToViewStates[t]===e&&"viewstate"===c.getSourceType(c.settingsModel.get(t))});0<t.length?c.activeViewStateToPropertyPaths[e]=t:(t=c.docViewModel.getByPath(e),c.stopListening(t,"change:value"),delete c.activeViewStateToPropertyPaths[e])}),t},N.prototype.processTemplateViewStates=function(t){return _.mapKeys(t,function(t,e){return"$"+e.replace(/\//g,".")+"$"})},N.prototype.saveSetting=function(t,e,n,i){var o;!this.dashboardViewModel.get("disableAutosave")&&t&&this.quickView&&(o=this.componentId,n&&(o+=N.NAMESPACE_SEPARATOR+n),(n=this.docViewModel.get(".settings"))||(n=new f.Model,this.docViewModel.set(".settings",n)),(n=n.get(o))||(n=new f.Model,this.docViewModel.get(".settings").set(o,n),n.set("version",0)),n.set(t,e),this.autosaveDashboardId=this.getDashboardId(null),i?this.setDocumentViewModelSettings(i):this.saveSettingsNowDebounced())},N.prototype.setDocumentViewModelSettings=function(n){var e=this.docViewModel.get(".settings");new cs.DocumentViewModel({id:n},null).fetch({success:function(t){t.set(".settings",e),console.log("Current Settings",e),t.save({},{error:function(){cs.Log.Error("Autosave user settings FAILED",n)},success:function(){cs.Log.Info("Autosave user settings SUCCEEDED",n)}})}.bind(this),error:function(t,e){this.dashboardAppModel.get("isLite")&&"Record Not Found"===e?new cs.DocumentViewModel({id:n},null).save({},{success:function(){this.saveSettingsNow()}.bind(this)}):cs.Log.Error("Unable to fetch user settings for Autosave",n)}.bind(this)})},N.prototype.saveSettingsNow=function(){var t=this.getDashboardId(null);this.dashboardViewModel.get("disableAutosave")||this.autosaveDashboardId!==t||this.setDocumentViewModelSettings(t)},N.prototype.setProperty=function(t,e,n){var i;t&&(i=this.settingsModel.get(t),"viewstate"===this.getSourceType(i)?i.setModelValue(e):this.settingsModel.set(t,e,_.extend({},n,{propertyPath:t})))},N.prototype.setViewState=function(t,e){return!(!t||!t.attributes)&&t.set("value",e)},N.prototype.showErrorMessage=function(t){this.trigger("showErrorMessage",t)},N.prototype.showNotification=function(t,e){cs.NotificationManager.show(this.widgetId,t,e)},N.prototype.showQueryStatus=function(t){this.trigger("showQueryStatus",t)},N.prototype.updateTable=function(t,e,n,i){"data"===this.getSourceType(t)&&(e.query=t?t.get("_updateQueryString"):"",e.connection=t?t.get("_connection"):"",e.updateType=t?t.get("_updateType"):"",e.updateAnalytic=t?t.get("_updateAnalytic"):"",e.updateParams=t.bindViewStateToKdbParams(t.get("_updateQueryParams")),cs.DeltaClientLib.updateTable(e,function(){n(),t.isDirty=!0,t.forceInternalReset=!0,t.execute()},i))},N.prototype.waitForData=function(s,a,t){return void 0===t&&(t=1e4),new Promise(function(e){var n=!1;function i(t){n||(n=!0,clearTimeout(o),s.stopListening(a,"DataRecieved",i),e(t))}s.listenTo(a,"DataRecieved",i);var o=setTimeout(function(){n||(n=!0,s.stopListening(a,"DataRecieved",i),e(null))},t)})},N.ADVANCED_METHODS=["deltaClient"],N.NAMESPACE_SEPARATOR=":",N.API_METHODS=["destroySettings","doActions","onTransferAction","exportData","getProperty","getPropertyMeta","getDataSourceMap","getViewState","getTemplateViewStates","getDashboardName","hasPermission","hideErrorMessage","hideQueryStatus","humanFileSize","isBuildMode","isSelected","loadApp","loadSetting","navigate","page","removeTooltip","saveSetting","setProperty","setTooltip","setViewState","showErrorMessage","showNotification","showQueryStatus","subscribe","subscribeTemplateViewStates","unsubscribe","unsubscribeTemplateViewStates","updateTable"],cs.ComponentApi=N,ds=A=A||{},hs=f.View,e(pa,hs),pa.prototype.initializeApi=function(){this.componentApi=new ds.ComponentApi(_.extend({},_.pick(this,pa.COMMON_OPTIONS),{advancedMethods:!0,appKey:this.key,componentId:this.componentId,deltaClient:this.deltaClient?this.deltaClient.deltaClient:null,deltaClientLib:this.deltaClient,settingsModel:this.settingsModel}))},pa.prototype.initalizeEvents=function(){this.settingsModel&&this.listenTo(this.settingsModel,"change",this.onSettingsModelChange)},pa.prototype.initializeOnSettingsChange=function(){var t=!1;this.app&&_.isFunction(this.app.onSettingsChange)&&(this.appOnSettingsChange=_.bind(this.app.onSettingsChange,this.app)),this.appOnSettingsChange&&_.isFunction(this.settingsModel.toFlat)&&(this.appOnSettingsChange(this.componentApi.processSettings(this.settingsModel.toFlat(),this.appOnSettingsChange)),"BasicComponents"!==this.key||_.isFunction(this.app.$view.onSettingsChange))&&(t=!0),this.model&&(t?this.model.set("hasOnSettingsChange",!0,{silent:!0}):this.model.unset("hasOnSettingsChange"))},pa.prototype.onSettingsModelChange=function(s,t){try{var e,a=s.changedAttributes(null,t&&t.propertyPath?t.propertyPath:null);_.each(a,function(t,e){var n,i;function o(t,e){var n,i=/^(\w+)((?:\.\w+)+)$/.exec(e);return i?(n=_.isArray(t)?Number(i[1]):i[1],_.isObject(t)?o(t[n],i[2].substring(1)):t):_.isObject(t)?t[e]:t}n=o(s.attributes,e),i=o(s.previousAttributes(),e),_.isEqual(i,n)&&delete a[e]}),e=this.componentApi.processSettings(a,this.appOnSettingsChange),this.appOnSettingsChange&&!_.isEmpty(e)&&this.appOnSettingsChange(e)}catch(t){ds.Log.Error("AppView Settings Error",t,this)}},pa.prototype.onResize=function(t){this.app&&this.app.onResize&&this.app.onResize(t)},pa.prototype.onResizeStart=function(t){this.app&&this.app.onResizeStart&&this.app.onResizeStart(t)},pa.prototype.onResizeStop=function(t){this.app&&this.app.onResizeStop&&this.app.onResizeStop(t)},pa.prototype.onScroll=function(){this.app&&this.app.onScroll&&this.app.onScroll()},pa.prototype.remove=function(){return this.app&&_.isFunction(this.app.remove)&&this.app.remove(),this.componentApi&&(this.componentApi.removeTooltip(),this.componentApi.unsubscribeAll()),f.View.prototype.remove.apply(this)},pa.prototype.render=function(){return this.$appDiv=this.$el,this},pa.prototype.requireApp=function(){var e=this;requirejs([e.key],function(t){try{e.initializeApi(),e.app=new t(_.extend({el:e.$appDiv,viewModel:e.docViewModel,dataModel:e.docDataModel,dashboardAppModel:e.dashboardAppModel,dashboardViewModel:e.dashboardViewModel,settingsModel:e.settingsModel,websiteUrl:e.dashboardAppModel.get("websiteUrl"),DeltaClientLib:e.deltaClient,api:e.componentApi.interface,widgetId:e.widgetId},e.appOptions)),e.initalizeEvents(),e.initializeOnSettingsChange(),_.isFunction(e.callback)&&e.callback(e.app)}catch(t){ds.Log.Error("loading app error, require key: "+e.key,t),_.isFunction(e.callback)&&e.callback(t)}},function(t){ds.Log.Error("ComponentView:loadApp require error",t),_.isFunction(e.callback)&&e.callback(t)})},pa.COMMON_OPTIONS=["callback","dashboardAppModel","dashboardViewModel","deltaClient","docDataModel","docViewModel","widgetId","quickView"],ds.AppView=pa,gs=A=A||{},ms=f.View,e(da,ms),da.prototype.dialogClass=function(){return"dialog-base "+(this.options.userClass||"")},da.prototype.dialogButtons=function(){var t=this;return[{text:"Cancel",click:function(){return t.dialogClose()},icon:"fa fa-times"}]},da.prototype.dialogClose=function(){function t(){e.$dialog&&e.$dialog.dialog("close")}var e=this;this.isCancel?(this.options.cancelBtnCallback&&this.options.cancelBtnCallback(),t()):this.options.requireSuccess?this.options.callback&&this.options.callback(this.model,t,function(t,e){gs.ErrorDialog.ShowError(e||"Unspecified Error")}):(this.options.callback&&this.options.callback(this.model),t())},da.prototype.dialogOpen=function(){},da.prototype.onResize=function(){var t=.95*$(window).height()-(this.$dialogTitlebar.outerHeight(!0)+this.$dialogButtonpane.outerHeight(!0));this.$dialog.css("max-height",t),this.$dialogRoot.position({of:$(window)})},da.prototype.preRender=function(){},da.prototype.postRender=function(){},da.prototype.remove=function(){return this.$dialog&&this.$dialog.dialog("destroy"),this.options=null,this.$dialog=null,this.$dialogTitlebar=null,this.$dialogButtonpane=null,this.$dialogRoot=null,$(window).off("resize",this.resizeListener),f.View.prototype.remove.apply(this)},da.prototype.openDialog=function(){this.$el.dialog("open")},da.prototype.render=function(){var t=this,e={};return this.options.container&&(e.appendTo=this.options.container),this.preRender(),this.$el.html((this.options.renderTemplate?this.options:this).renderTemplate()),this.$dialog=this.$el.dialog(_.extend({classes:{"ui-dialog":this.dialogClass()},title:this.options.dialogTitle,resizable:!1,minHeight:this.options.minHeight||300,width:this.options.width||"57em",height:this.options.height||"auto",modal:!0,autoOpen:!0,draggable:this.options.draggable||!1,closeOnEscape:!0,buttons:this.dialogButtons(),position:this.options.position||{my:"center",at:"center",of:$(window)},open:function(){t.$el.parent().find(".titleIcon").remove(),$('<i class="titleIcon fa '+t.options.iconClass+'" />').insertBefore(t.$el.parent().find(".ui-dialog-title")),t.$dialogRoot=$(".ui-dialog.dialog-base"),t.$dialogTitlebar=t.$dialogRoot.find(".ui-dialog-titlebar"),t.$dialogButtonpane=t.$dialogRoot.find(".ui-dialog-buttonpane"),t.dialogOpen(),t.$dialogButtonpane.find(".ui-dialog-buttonpane > div > button:nth-child(1)").focus(),t.options.onOpen&&t.options.onOpen()},close:function(){t.trigger("closing"),t.options.onClose&&t.options.onClose(),t.remove()},resize:$.proxy(this.onResize,this)},e)),this},da.prototype.renderTemplate=function(){return""},gs.DialogBase=da,fs=A=A||{},ys=fs.DialogBase,e(ha,ys),ha.prototype.dialogButtons=function(){return[{text:"Save",click:_.bind(this.onClickSave,this),icon:"fa fa-floppy-o"},{text:"Don't Save",click:_.bind(this.onClickDontSave,this),icon:"fa fa-ban"},{text:"Cancel",click:_.bind(this.onClickCancel,this),icon:"fa fa-times"}]},ha.prototype.doSave=function(){var t=$.Deferred();return this.model.saveNow(t.reject,t.resolve),t.promise()},ha.prototype.onKeyDown=function(t){switch(t.stopPropagation(),t.keyCode){case $.ui.keyCode.ESCAPE:this.onClickCancel();break;case 78:this.onClickDontSave();break;case 83:case 89:this.onClickSave()}},ha.prototype.onClickCancel=function(){this.isCancel=!0,this.closeArgs="cancel",this.dialogClose()},ha.prototype.onClickDontSave=function(){this.options&&this.options.noSaveCb&&this.options.noSaveCb(),this.dialogClose()},ha.prototype.onClickSave=function(){this.options&&this.options.saveCb?(this.options.saveCb(),this.dialogClose()):(this.$firstBtn.button("disable"),this.$firstBtn.next().button("disable"),this.$firstBtn.next().next().button("disable"),this.doSave().done(_.bind(this.onSaveDone,this)).fail(_.bind(this.onSaveFail,this)))},ha.prototype.onSaveDone=function(){var n,i=this,o=[];_.isEmpty(this.options.components)?this.dialogClose():(n=_.after(this.options.components.length,function(){_.isEmpty(o)?i.dialogClose():(i.$errorInfo.show(),i.$errorList.empty(),_.each(o,function(t){var e=$("<li></li>"),n=$("<span></span>");n.attr("title",t.widget),n.text(t.component),e.text(": "+t.message),e.prepend(n),i.$errorList.append(e)}),i.$firstBtn.button("enable"),i.$firstBtn.next().button("enable"),i.$firstBtn.next().next().button("enable"))}),_.each(this.options.components,function(e){_.isFunction(e.callback)&&e.callback(function(t){t&&o.push(_.extend({message:t},_.pick(e,["component","widget"]))),n()})}))},ha.prototype.onSaveFail=function(){this.$errorInfo.show(),this.$firstBtn.button("enable"),this.$firstBtn.next().button("enable"),this.$firstBtn.next().next().button("enable")},ha.prototype.getPromptMessage=function(){return this.options.message||"There are unsaved changes in this dashboard."},ha.prototype.postRender=function(){$(window).on("keydown.AreYouSureDialog",_.bind(this.onKeyDown,this)),this.$errorInfo=this.$(".error-info"),this.$errorList=this.$(".error-list"),this.$firstBtn=this.$dialog.next().find("button").first(),this.$errorInfo.hide()},ha.prototype.renderTemplate=function(){return fs.T.AreYouSureDialog({dashChanged:this.options.dashChanged,components:this.options.components,message:this.getPromptMessage()})},ha.prototype.remove=function(){return $(window).off(".AreYouSureDialog"),this.trigger("close",this.closeArgs),fs.DialogBase.prototype.remove.apply(this)},fs.AreYouSureDialog=ha,vs=A=A||{},bs=f.View,e(ga,bs),ga.prototype.close=function(){this.$dialog.dialog("close")},ga.prototype.onSubmit=function(e){var n,i,o,s,a=this;e&&e.stopPropagation(),this.clicked||(s=this.form.commit(),_.isEmpty(s)&&(this.clicked=!0,this.$messageBox.hide(),o=function(){n.button("option","icon","fa fa-check"),n.button("option","label",t("OK")),i.button("enable"),a.clicked=!1,vs.DeltaClientLib.changingPassword=!1},(n=$(e.currentTarget)).button("option","icon","fa fa-spinner fa-pulse"),n.button("option","label",t("wait")+"..."),(i=n.next()).button("disable"),vs.DeltaClientLib.changeUserPassword(a.model.get("oldpassword"),a.model.get("password1"),function(){vs.Log.Info("Password changed successfully"),a.showMessage("Password changed successfully","success"),_.isFunction(a.onChangeSuccess)&&a.onChangeSuccess(),_.delay(function(){a.close()},1e3)},function(t){vs.Log.Error("Password change failed"),a.showMessage(t),o()})))},ga.prototype.onRemove=function(){$(this.form.el).find("input").off(),window.removeEventListener("keydown",this.boundToggleCaps,!0),this.remove()},ga.prototype.showMessage=function(t,e){t?(this.$messageBox.html(t),this.$messageBox.removeClass(this.MESSAGE_TYPES.join(" ")).addClass(e||"error"),this.$messageBox.show()):(this.$messageBox.html(),this.$messageBox.removeClass(this.MESSAGE_TYPES.join(" ")),this.$messageBox.hide())},ga.prototype.toggleCapsLockMsg=function(e){20===e.which&&(e.getModifierState("CapsLock")?this.showMessage('<i class="fa fa-warning"></i>'+t("Caps Lock is on"),"warning"):this.showMessage())},vs.ChangePasswordDialog=ga,ze=A=A||{},Ss=ze.DialogBase,e(ma,Ss),ma.prototype.dialogButtons=function(){var t=this;return[{text:"OK",click:function(){t.dialogClose()},icon:"fa fa-check"},{text:"Cancel",click:function(){t.isCancel=!0,t.dialogClose()},icon:"fa fa-times"}]},ma.prototype.renderTemplate=function(){return t("Are you sure you want to delete this item?")},ma.ShowDelete=function(t,e){new ma(_.extend({iconClass:"fa-trash-o",dialogTitle:"Confirm Delete",callback:t},e?{renderTemplate:function(){return e}}:{}))},ma.ShowConfirm=function(e){var n=e.txt||"",i=e.container?{container:e.container}:{};new ma(_.extend({iconClass:e.iconClass||"fa-question-circle",dialogTitle:e.dialogTitle||"Confirmation",callback:e.callback,cancelBtnCallback:e.cancelBtnCallback||_.noop,renderTemplate:e.renderTemplate||function(){return n+t("<br></br>Are you sure you want to reload the Application?")}},i))},ze.ConfirmDialog=ma,n=A=A||{},ws=n.DialogBase,e(fa,ws),fa.prototype.dialogButtons=function(){var t=this;return[{text:"OK",click:function(){t.dialogClose()},icon:"fa fa-check"}]},fa.prototype.renderTemplate=function(){return t("Are you sure you want to delete this item?")},fa.ShowError=function(t,e){new fa(_.extend({callback:_.isFunction(e)?e:_.noop},t?{renderTemplate:function(){return t}}:{}))},n.ErrorDialog=fa,_s=A=A||{},Ts=_s.ErrorDialog,e(ya,Ts),ya.ShowWarning=function(e,n){new _s.ErrorDialog(_.extend({dialogTitle:"Warning",callback:_.isFunction(n)?n:_.noop},e?{renderTemplate:function(){return t(e)}}:{}))},_s.WarningDialog=ya,Cs=A=A||{},Ds=Cs.AppView,e(L,Ds),L.getInstances=function(){return L._instances},L.prototype.initalizeEvents=function(){var n=this,t=this.getContainerDocument();Cs.AppView.prototype.initalizeEvents.apply(this,arguments),this.listenTo(this.model,"beforeRemove",this.beforeRemove),this.listenTo(this.dashboardViewModel,"change:buildMode",this.onBuildModeChanged),this.listenTo(this.componentApi,"hideErrorMessage",this.hideErrorMessage),this.listenTo(this.componentApi,"hideQueryStatus",this.hideQueryStatus),this.listenTo(this.componentApi,"showErrorMessage",this.showErrorMessage),this.listenTo(this.componentApi,"showQueryStatus",this.showQueryStatus),this.listenTo(t,"change:borderBackground",function(t,e){return n.setOptionsValue("format",{tileBackgroundColor:"#"+e})}),this.listenTo(t,"change:transparentBackground",function(t,e){return n.setOptionsValue("format",{tileTransparentBackground:e})}),this.listenTo(t,"change:borderColor",function(t,e){return n.setOptionsValue("format",{tileBorderColor:"#"+e})}),this.listenTo(t,"change:borderRounding",function(t,e){return n.setOptionsValue("format",{tileBorderRounding:e})}),this.listenTo(t,"change:borderSpacing",function(t,e){return n.setOptionsValue("Alignment",{innerPaddingLeft:e,innerPaddingRight:e,innerPaddingTop:e,innerPaddingBottom:e,titlePaddingLeft:e,titlePaddingRight:e,titlePaddingTop:e})}),this.listenTo(t,"change:borderWidth",function(t,e){return n.setOptionsValue("format",{tileBorderWidth:e})}),this.listenTo(t,"change:widgetsSpacing",function(t,e){return n.setOptionsValue("Alignment",{paddingLeft:e,paddingRight:e,paddingTop:e,paddingBottom:e})}),this.listenTo(t,"change:borderShadow",function(t,e){return n.setOptionsValue("format",{tileShadow:e})}),this.listenTo(t,"change:showLoadingIndicators",this.onShowLoadingIndicatorsChanged),this.debouncedOnFormatChanged=_.debounce(this.onFormatChanged,240),this.listenTo(this.model.get("options"),"change:format",this.debouncedOnFormatChanged),this.debouncedOnAlignmentChanged=_.debounce(this.onAlignmentChanged,240),this.listenTo(this.model.get("options"),"change:Alignment",this.debouncedOnAlignmentChanged)},L.prototype.applyCustomCss=function(t){t?(this.$customCss&&this.$customCss.length?this.$customCss.html(t):this.$customCss=$("<style></style>",{"data-widgetid":this.widgetId,html:t,type:"text/css"}).appendTo(document.head),this.customCss=t):this.$customCss&&(this.$customCss.remove(),this.$customCss=null,this.customCss=null)},L.prototype.applyCssClasses=function(t){this.$appDiv.removeClass(this.cssClasses),t?(_.isString(t)?this.cssClasses=t:this.cssClasses=_.reduce(t,function(t,e){return t+" "+e}),this.$appDiv.addClass(this.cssClasses)):this.cssClasses=null},L.prototype.applyDashboardStyleSettings=function(){var t=this.dashboardViewModel.get("selectedDocumentId"),t=this.dashboardAppModel.get("documents").get(t),e=this.model.get("options").get("format"),n=this.model.get("options").get("Alignment");null===e.tileBackgroundColor&&(e.tileBackgroundColor="#"+t.get("borderBackground")),null===e.tileBorderColor&&(e.tileBorderColor="#"+t.get("borderColor")),null===e.tileBorderRounding&&(e.tileBorderRounding=t.get("borderRounding")),null===e.tileBorderWidth&&(e.tileBorderWidth=t.get("borderWidth")),null===e.tileTransparentBackground&&(e.tileTransparentBackground=t.get("transparentBackground")),null===e.tileShadow&&(e.tileShadow=t.get("borderShadow")),this.model.get("options").set("format",e),null===n.innerPaddingLeft&&(n.innerPaddingLeft=t.get("borderSpacing")),null===n.innerPaddingRight&&(n.innerPaddingRight=t.get("borderSpacing")),null===n.innerPaddingTop&&(n.innerPaddingTop=t.get("borderSpacing")),null===n.innerPaddingBottom&&(n.innerPaddingBottom=t.get("borderSpacing")),null===n.titlePaddingLeft&&(n.titlePaddingLeft=t.get("borderSpacing")),null===n.titlePaddingRight&&(n.titlePaddingRight=t.get("borderSpacing")),null===n.titlePaddingTop&&(n.titlePaddingTop=t.get("borderSpacing")),null===n.titlePaddingBottom&&(n.titlePaddingBottom=0),null===n.paddingLeft&&(n.paddingLeft=t.get("widgetsSpacing")),null===n.paddingRight&&(n.paddingRight=t.get("widgetsSpacing")),null===n.paddingTop&&(n.paddingTop=t.get("widgetsSpacing")),null===n.paddingBottom&&(n.paddingBottom=t.get("widgetsSpacing")),this.model.get("options").set("Alignment",n)},L.prototype.beforeRemove=function(){var i,t,e,o=this;if(this.app&&_.isFunction(this.app.beforeRemove)&&((e=this.app.beforeRemove())&&(_.isFunction(e)?i=e:_.isFunction(e.callback)&&(i=e.callback,t=e.message)),i))return{callback:function(t){var e=_.once(t),n=_.delay(function(){e("Timed out")},o.COMPONENT_SAVE_TIMEOUT);try{i(function(t){clearTimeout(n),e(t)})}catch(t){Cs.Log.Error("Save error",t),clearTimeout(n),e("Save error")}},component:o.model.get("key"),message:t,widget:o.model.id}},L.prototype.getComponentName=function(){var t=this.dashboardAppModel.get("components").get(this.model.get("definitionId"))||this.dashboardAppModel.get("components").find({appKey:this.model.get("key")});return t?t.get("componentName"):""},L.prototype.getContainerDocument=function(){var t=this.dashboardViewModel.get("selectedDocumentId");return this.dashboardAppModel.get("documents").get(t)},L.prototype.hideErrorMessage=function(){this.$errorMessage.hide()},L.prototype.hideQueryStatus=function(){var t=this;clearTimeout(this.queryStatusTimer),clearInterval(this.loadingTimer),this.queryStatusRemoveTimer=_.delay(function(){t.$queryStatus.hide()},200)},L.prototype.updateExpandedButton=function(t,e){this.showExpandButton=t;t=this.model.get("options").get("Alignment");e&&t&&this.onAlignmentChanged()},L.prototype.onAlignmentChanged=function(t){var e,n=0,i={"margin-left":this.getAlignmentValue("paddingLeft"),"margin-right":this.getAlignmentValue("paddingRight"),"margin-top":this.getAlignmentValue("paddingTop"),"margin-bottom":this.getAlignmentValue("paddingBottom")},i=(this.$borderDiv.css(i),{"margin-left":this.getAlignmentValue("titlePaddingLeft"),"margin-right":this.getAlignmentValue("titlePaddingRight"),"padding-top":this.getAlignmentValue("titlePaddingTop"),"padding-bottom":this.getAlignmentValue("titlePaddingBottom")}),i=(this.$titleDiv.css(i),this.getTitleDivHeight(this.$titleDiv,this.getFormatValue("titleFontSize"),this.getAlignmentValue("titlePaddingTop"),this.getAlignmentValue("titlePaddingBottom"))),i=(this.getFormatValue("widgetTitle")?e=i+this.getAlignmentValue("innerPaddingTop"):(e=this.getAlignmentValue("innerPaddingTop"),n=this.showExpandButton?15:0),{left:this.getAlignmentValue("innerPaddingLeft"),right:this.getAlignmentValue("innerPaddingRight"),top:e+n,bottom:this.getAlignmentValue("innerPaddingBottom")});this.$appDiv.css(i),t||this.onResize()},L.prototype.onBuildModeChanged=function(t,e,n){this.dashboardViewModel.get("buildMode")?this.$el.removeClass("build-off"):this.$el.addClass("build-off")},L.prototype.getTitleDivHeight=function(t,e,n,i){return 1<t.outerHeight(!0)&&t.is(":visible")?t.outerHeight(!0):1.2*(n+i+e)},L.prototype.getFormatValue=function(t){var e=null==(e=null==(e=this.model)?void 0:e.get("options"))?void 0:e.get("format");if(e){var n=e[t];if(void 0!==n)return this.componentApi.getPropertyValue(n);"widgetTitle"!==t&&console.warn("Format key '".concat(t,"' not found"),{format:e})}else console.warn("Format options missing")},L.prototype.getAlignmentValue=function(t){var e=this.model.get("options").get("Alignment");return _.isNil(e)||_.isNil(e[t])?0:Number(this.componentApi.getPropertyValue(e[t]))},L.prototype.onFormatChanged=function(t){var e,n={"border-width":this.getFormatValue("tileBorderWidth"),"border-radius":this.getFormatValue("tileBorderRounding"),"border-color":this.getFormatValue("tileBorderColor"),"background-color":this.getFormatValue("tileTransparentBackground")?"transparent":this.getFormatValue("tileBackgroundColor"),"box-shadow":this.getFormatValue("tileShadow")?"rgba(0, 0, 0, 0.78) 2px 2px 5px":"none"},n=(this.$borderDiv.css(n),{"font-size":this.getFormatValue("titleFontSize"),"font-weight":this.getFormatValue("titleFontBold")?"bold":"normal","text-align":this.getFormatValue("titleHorizontal"),color:this.getFormatValue("titleColor"),"background-color":this.getFormatValue("titleTransparentBackground")?"transparent":this.getFormatValue("titleBackgroundColor"),"border-bottom-width":this.getFormatValue("titleBottomBorderWidth"),"text-shadow":this.getFormatValue("titleShadow")?"rgba(0, 0, 0, 0.5) 2px 2px 3px":"none"}),i=0;0<this.getFormatValue("tileBorderRounding")&&(i=.85*this.getFormatValue("tileBorderRounding")-this.getFormatValue("tileBorderWidth")/4),this.$titleDiv.css("border-top-left-radius",i),this.$titleDiv.css("border-top-right-radius",i),i=this.model.get("options").get("Alignment"),(e=this.getFormatValue("widgetTitle"))?(this.$titleDiv.css(n),this.$titleDiv.text(e),this.$titleDiv.show(),n=this.getTitleDivHeight(this.$titleDiv,this.getFormatValue("titleFontSize"),this.getAlignmentValue("titlePaddingTop"),this.getAlignmentValue("titlePaddingBottom")),this.$appDiv.css("top",i.innerPaddingTop+n)):(this.$titleDiv.hide(),this.$appDiv.css("top",i.innerPaddingTop)),t||this.onResize()},L.prototype.onShowLoadingIndicatorsChanged=function(t,e){this.showLoadingIndicators=e},L.prototype.onShowNoResultsIndicatorsChanged=function(t,e){this.showNoResultsIndicators=e},L.prototype.onStyleChanged=function(){function t(t){return e.componentApi.getPropertyValue(n[t])}var e=this,n=this.model.get("options").get("Style"),i=t("advanced"),i=(i!==this.customCss&&this.applyCustomCss(i),t("cssClasses"));i!==this.cssClasses&&this.applyCssClasses(i)},L.prototype.postComponentLoad=function(n,i){var t,o=this;this.appOnSettingsChange=function(t){var e=Object.keys(t);o.quickStart(n.appArgs.quickStart),_.find(e,function(t){return 0===t.indexOf("Style")})&&o.onStyleChanged(),_.find(e,function(t){return 0===t.indexOf("format")})&&o.onFormatChanged(),_.find(e,function(t){return 0===t.indexOf("Alignment")})&&o.onAlignmentChanged(),i?i.settings=t:o.app&&_.isFunction(o.app.onSettingsChange)&&o.app.onSettingsChange(t)},this.appOnSettingsChange&&this.model.get("options").toFlat&&(t=this.componentApi.processSettings(this.model.get("options").toFlat(),this.appOnSettingsChange),i?(i.settings=t,this.quickStart(n.appArgs.quickStart)):(this.app&&_.isFunction(this.app.onSettingsChange)&&(this.app.onSettingsChange(t),this.quickStart(n.appArgs.quickStart)),_.isFunction(this.app.onSettingsChange)&&("BasicComponents"!==this.model.get("key")||_.isFunction(this.app.$view.onSettingsChange))?this.model.set("hasOnSettingsChange",!0,{silent:!0}):this.model.unset("hasOnSettingsChange",{silent:!0}))),this.model.trigger("componentLoaded")},L.prototype.processComponentDefinition=function(t,e){var n=this;t&&t.set(_.omit(e,"id","componentName","componentDescription","appKey","buildModeOnly","listViewThumb")),e.buildModeOnly&&this.$el.addClass("build-mode-only"),this.dashboardViewModel.get("buildMode")||this.$el.addClass("build-off"),this.updateComponentDefinition(e,this.model),$.isEmptyObject(this.model.get("options").attributes)&&e?this.model.get("options").set(e.appArgs.json):(this.model.get("options").set("Alignment",_.extend({},e.appArgs.json.Alignment,this.model.get("options").get("Alignment")),{silent:!0}),this.model.get("options").set("Style",_.extend({},e.appArgs.json.Style,this.model.get("options").get("Style")),{silent:!0}),delete(t=_.extend({},e.appArgs.json.format,this.model.get("options").get("format"))).titlePaddingLeft,delete t.titlePaddingRight,delete t.titlePaddingTop,delete t.titlePaddingBottom,this.model.get("options").set({format:null},{silent:!0}),this.model.get("options").set({format:t},{silent:!0})),this.componentApi.convertPathsToModels("data",e.appArgs.schema,this.model.get("options")),this.componentApi.convertPathsToModels("viewstate",e.appArgs.schema,this.model.get("options")),Cs.Component.convertDashboardTypesToModels(this.model.get("options"),function(t){return n.docDataModel.getByPath(t)},function(t){return n.docViewModel.getByPath(t)}),this.applyDashboardStyleSettings(),this.model.unset("upgrading",{silent:!0}),this.onStyleChanged(),this.onFormatChanged(),this.onAlignmentChanged()},L.prototype.quickStart=function(e){var i=this;_.each(e,function(e){var n;if(!i.settingsModel.get(e.path)&&!i.quickView)return n=e.message||"populate widget",i.showErrorMessage({error:t("Click to ")+" <b> "+n+"</b>",type:"QuickStart",onClick:function(){i.dashboardViewModel.get("selectedWidgetId")!==i.widgetId&&i.$el.trigger("click"),i.model.get("options").trigger("quickStart",e.path)}}),!1;i.hideErrorMessage()})},L.prototype.remove=function(){this.$customCss&&this.$customCss.remove(),L._instances=_.without(L._instances,this),Cs.AppView.prototype.remove.apply(this,arguments)},L.prototype.render=function(){var t=this.getContainerDocument().get("showLoadingIndicators");return this.$el.html(Cs.T.ComponentView(this.model.toJSON())),this.$errorMessage=this.$el.find(".errorMessage"),this.$queryStatus=this.$el.find(".queryStatus"),this.$titleDiv=this.$el.find(".title-div"),this.$borderDiv=this.$el.find(".border-div"),this.$appDiv=this.$el.find(".app-div"),this.widgetId&&(this.$customCss=$("head style[data-widgetid='"+this.widgetId+"']")),this.$progressBarDiv=this.$el.find(".progress-bar-div"),this.onShowLoadingIndicatorsChanged(null,t),this.model.set("upgrading",!0,{silent:!0}),this},L.prototype.requireApp=function(){var t,e,n=this,i=this,o=i.model.get("key"),s=i.dashboardAppModel.get("components").get(i.model.get("definitionId"));(s=s||i.dashboardAppModel.get("components").find({appKey:o}))?(t=s.get("customElement"))&&customElements.get(t)?(e=document.createElement(t),i.$appDiv.append(e),e.addEventListener("componentDefinition",function(t){t=t.detail;e.componentApi=n.componentApi.interface,n.processComponentDefinition(s,t),n.initalizeEvents(),e.theme=n.dashboardViewModel.get("DashboardTheme"),n.listenTo(i.dashboardViewModel,"change:DashboardTheme",function(){e.theme=n.dashboardViewModel.get("DashboardTheme")}),n.listenTo(i.dashboardViewModel,"change:buildMode",function(){return e.resize=""}),n.postComponentLoad(t,e)}),_.delay(function(){e.options={api:i.componentApi.interface,componentId:parseInt(i.model.get("definitionId"),10),componentModel:i.model,dashboardAppModel:i.dashboardAppModel,dashboardViewModel:i.dashboardViewModel,dataModel:i.docDataModel,settingsModel:i.model.get("options"),viewModel:i.docViewModel,websiteUrl:i.dashboardAppModel.get("websiteUrl")},n.$progressBarDiv.fadeOut(0,function(){$(this).remove()})},1e3)):(eo.increaseAppPendingCounter(o),requirejs([o],function(t){try{i.$progressBarDiv.fadeOut(0,function(){$(this).remove()}),t.mergeWithDefault&&i.model.set("options",t.mergeWithDefault(i.model.get("options")),{silent:!0}),t.getDefaultJSONTemplates&&(i.model.get("options")._templates=t.getDefaultJSONTemplates(),i.model.get("options")._templates.Defaults=_.extend({},i.model.get("options")._templates.Defaults));var e=_.isFunction(t.getComponentDefinition)?t.getComponentDefinition({api:i.componentApi.interface,componentId:parseInt(i.model.get("definitionId"),10),componentModel:i.model,dashboardAppModel:i.dashboardAppModel,dashboardViewModel:i.dashboardViewModel,dataModel:i.docDataModel,settingsModel:i.model.get("options"),viewModel:i.docViewModel,websiteUrl:i.dashboardAppModel.get("websiteUrl")}):_.cloneDeep({appArgs:{json:{},schema:{properties:{},type:"object"}}}),n=i.dashboardAppModel.get("transformComponentDefinition");_.isFunction(n)&&n(e),i.processComponentDefinition(s,e),i.app=new t({el:i.$appDiv[0],viewModel:i.docViewModel,dataModel:i.docDataModel,dashboardAppModel:i.dashboardAppModel,dashboardViewModel:i.dashboardViewModel,settingsModel:i.model.get("options"),websiteUrl:i.dashboardAppModel.get("websiteUrl"),componentModel:i.model,DeltaClientLib:i.deltaClient,api:i.componentApi.interface,widgetId:i.widgetId,quickView:i.quickView,webGLContextAndCanvas:i.webGLContextAndCanvas,basePanel:i.basePanel}),i.initalizeEvents(),i.postComponentLoad(e),_.isFunction(i.callback)&&i.callback(i.app)}catch(t){Cs.Log.Error("loading app error, require key: "+i.model.get("key"),t),_.isFunction(i.callback)&&i.callback(t)}finally{eo.decreaseAppPendingCounter()}},function(t){eo.decreaseAppPendingCounter(),Cs.Log.Error("ComponentView:loadApp require error",t),_.isFunction(i.callback)&&i.callback(t)})):console.warn("Unsupported Component: Can not load the ".concat(o," component"))},L.prototype.showErrorMessage=function(n){var e=this,i=n.type||"Error",o=n.error,s=this.$errorMessage.find(".errorText");0===o.indexOf("0.0")&&(o=o.substring(4)),this.$errorMessage.removeClass("Error Warning Info QuickStart").addClass(i),this.$errorMessage.find(".errorTitle span").text(t(i)),s.html(o),this.$errorMessage.show(),this.fadeTimer&&clearTimeout(this.fadeTimer),this.$errorMessage.off("click"),n.onClick&&this.$errorMessage.click(function(t){var e=$(t.target);(e.hasClass("errorPanel")||e.parents(".errorPanel").length)&&(t.stopPropagation(),n.onClick(t))}),"Info"===i&&(this.fadeTimer=_.delay(function(){return e.$errorMessage.fadeOut("slow")},3e3))},L.prototype.showQueryStatus=function(e){var n,i=this,o=e.message||e.error||"",e=e.type||"Error";if(i.customErrorClass&&(i.$queryStatus.removeClass(i.customErrorClass),i.customErrorClass=""),clearInterval(i.loadingTimer),"Loading"===e){var s,a=h();if(!i.showLoadingIndicators)return;o="0s",i.loadingTimer=setInterval(function(){s=h.duration(h().diff(a)),o=s.format("m[m] s[s]"),i.$queryStatus.find(".statusText").html(o)},1e3)}n="NoResults"===e?"No Results":e,0===o.indexOf("0.0")&&(o=o.substring(4)),i.$queryStatus.css("margin",i.$borderDiv.css("border-width")),i.$queryStatus.css("border-radius",i.$borderDiv.css("border-radius")),i.$queryStatus.removeClass("Error Warning Info Loading NoResults").addClass(e),i.$queryStatus.find(".statusTitle span").text(t(n)+(o&&"Loading"!==e?": ":"")),"Error"===e&&(n=/(.*)cssClass:"(.*)":(.*)/m.exec(o))&&(i.customErrorClass=n[2],i.$queryStatus.addClass(i.customErrorClass),o=n[3]),i.$queryStatus.find(".statusText").html(o),clearTimeout(i.queryStatusTimer),clearTimeout(i.queryStatusRemoveTimer),i.queryStatusTimer=_.delay(function(){i.$queryStatus.show()},i.QUERY_STATUS_DELAY),i.fadeTimer&&clearTimeout(i.fadeTimer),"Info"===e&&(i.fadeTimer=_.delay(function(){i.$queryStatus.fadeOut("slow")},i.QUERY_STATUS_FADE))},L.prototype.updateComponentDefinition=function(t,e){var n=At(),i=t.appArgs.schema.properties.Alignment,o=t.appArgs.schema.properties.format,s=t.appArgs.schema.properties.Style,a=t.appArgs.json.Style;s?_.each(n.appArgs.schema.properties.Style.properties,function(t,e){s.properties[e]=t}):t.appArgs.schema.properties.Style=n.appArgs.schema.properties.Style,t.appArgs.json.Style=a?_.extend({},n.appArgs.json.Style,a):_.clone(n.appArgs.json.Style),i?_.each(n.appArgs.schema.properties.Alignment.properties,function(t,e){i.properties[e]=t}):t.appArgs.schema.properties.Alignment=n.appArgs.schema.properties.Alignment,a=t.appArgs.json.Alignment,t.appArgs.json.Alignment=a?_.extend({},n.appArgs.json.Alignment,a):_.clone(n.appArgs.json.Alignment),o?(_.each(n.appArgs.schema.properties.format.properties,function(t,e){o.properties[e]=t}),delete o.properties.titlePaddingLeft,delete o.properties.titlePaddingRight,delete o.properties.titlePaddingTop,delete o.properties.titlePaddingBottom):t.appArgs.schema.properties.format=n.appArgs.schema.properties.format,(a=t.appArgs.json.format)?(t.appArgs.json.format=_.extend({},n.appArgs.json.format,a),delete t.appArgs.json.format.titlePaddingLeft,delete t.appArgs.json.format.titlePaddingRight,delete t.appArgs.json.format.titlePaddingTop,delete t.appArgs.json.format.titlePaddingBottom):t.appArgs.json.format=_.clone(n.appArgs.json.format)},L.prototype.setOptionsValue=function(t,e){var n=this.model.get("options").get(t);this.model.get("options").set(t,_.extend({},n,e))},L._instances=[],Cs.ComponentView=L,Es=A=A||{},Ms=f.View,e(R,Ms),R.prototype.initialize=function(t){this.$el.addClass("component-drop"),this.dashboardAppModel=t.dashboardAppModel,this.dashboardViewModel=t.dashboardViewModel,this.DeltaClientLib=t.DeltaClientLib,this.quickView=t.quickView,this.websiteUrl=t.websiteUrl,this.widgetsCollection=this.widgetsCollection||t.widgets,this.widgets=this.widgets||[],this.ignoreWidgetSelect=!1,this.widgetClass="component-drop-widget",this.initializeEvents(),this.initializeEvents_widgetCollection(),this.quickView?this.switchOffBuildMode():this.switchBuildMode(this.dashboardViewModel.get("buildMode")),this.applyCurrentWidgets()},R.prototype.initializeEvents=function(){this.listenTo(this.dashboardViewModel,"change:buildMode",this.onBuildModeChanged),this.listenTo(this.dashboardViewModel,"change:selectedWidget",this.onSelectedWidgetChanged),this.listenTo(this.dashboardAppModel,"change:pendingSelectionWidgetId",this.onSelectingWidget)},R.prototype.initializeEvents_widgetCollection=function(){this.listenTo(this.widgetsCollection,"add",this.onWidgetCollectionAdd),this.listenTo(this.widgetsCollection,"remove",this.onWidgetCollectionRemove)},R.prototype.events=function(){return{dragenter:"onDragEnter",dragleave:"onDragLeave",dragover:"onDragOver",drop:"onDrop"}},R.prototype.addComponentToWidget=function(t,e,n){var i=this.dashboardAppModel.get("components").get(e),i=this.getAppKey(i),o=t.get("component"),s=this.findWidgetItem(t.id),e=this.createNewComponent(e,i,t);o?"Tabs"===(i=o.get("key"))?((o=o.getInnermostComponents(i)).add(e),e.setParent(o)):(s&&s.view&&(s.view.remove(),s.view=null),n?t.commandSet({component:e}):t.set("component",e)):n?t.commandSet({component:e}):t.set("component",e)},R.prototype.addWidget=function(e,t,n,i,o,s){var a=this,r=this,l=e.id,u=this.renderWidget(e),c=$(document.createElement("div")),p=(c.addClass("fa fa-times remove-btn"),c.appendTo(u),c.click(function(t){t.preventDefault(),t.stopPropagation(),e.trigger("removeWidget")}),u.addClass(this.getWidgetClass(n,l)),u.attr("data-widgetid",l),this.dashboardViewModel.get("buildMode")||u.addClass("build-off"),this.addWidgetEvents(u),{$remove:c,$widget:u,widgetId:l,model:e,view:null});return this.widgets.push(p),e.get("component")&&this.renderComponent(p,t?function(){}:function(){return a.selectWidget(p)},i,o,s),r.stopListening(e,"change:component"),r.listenTo(e,"change:component",_.bind(function(){p.view&&(p.view.remove(),p.view=null),p.$widget.find(".grid-stack-item-content").remove(),r.renderComponent(p,function(){return r.selectWidget(p)},i,o,s)},r,p)),r.stopListening(e,"removeWidget"),r.listenTo(e,"removeWidget",r.onRemoveWidget.bind(r,e)),p},R.prototype.addNewWidget=function(t,e,n){return t=t||new Es.Widget({},{},this.widgetsCollection),e&&!n&&this.addComponentToWidget(t,e,!1),this.widgetsCollection.commandAdd(t,n?"Paste":null),_.findLast(this.widgets,{widgetId:t.id})},R.prototype.addWidgetEvents=function(t){var e,n=this;if(!(t instanceof $))throw"Wrong parameter.";_.each(t,function(t){(e=$(t)).off("click"),e.on("click",$.proxy(n.onWidgetClick,n))})},R.prototype.applyCurrentWidgets=function(){var e=this;_.each(this.widgetsCollection.models,function(t){e.addWidget(t,!0,null)})},R.prototype.clearWidgets=function(t){this.deselectCurrentWidget(),0<this.widgets.length&&(_.each(this.widgets,function(t){t.view&&_.isFunction(t.view.remove)&&t.view.remove()}),this.widgets=[]),t&&t()},R.prototype.createComponentView=function(t,e,n,i,o){var s=t.model.get("component"),a=this.getSelectedDocument(),s=(this.listenToOnce(s,"componentLoaded",function(){t.model.trigger("componentLoaded")}),new Es.ComponentView({model:s,callback:e,dashboardAppModel:this.dashboardAppModel,dashboardViewModel:this.dashboardViewModel,deltaClient:this.dashboardAppModel.get("isLite")?Es.DashClient:Es.DeltaClientLib,docViewModel:a.get("viewState"),docDataModel:a.get("data"),quickView:this.quickView,websiteUrl:this.websiteUrl,widgetId:t.widgetId,webGLContextAndCanvas:i,expandButton:o,basePanel:n}));return(t.view=s).model&&(t.$widget.attr("data-componentid",s.model.get("key")),t.$remove.attr("title",s.getComponentName())),s},R.prototype.createNewComponent=function(t,e,n){n=new Es.Component({},{},n);return n.set({definitionId:t,key:e}),n},R.prototype.deselectCurrentWidget=function(){this.dashboardViewModel.set("selectedWidget",null),this.dashboardViewModel.set("selectedWidgetView",null,{silent:!0})},R.prototype.disableWidgetSelect=function(t){t&&t.stopPropagation&&t.stopPropagation(),this.ignoreWidgetSelect=!0},R.prototype.enableWidgetSelect=function(){this.ignoreWidgetSelect=!1},R.prototype.findWidgetItem=function(e){return e?_.find(this.widgets,function(t){return t.widgetId===e}):null},R.prototype.getAppKey=function(t){var e=t.get("appKey");return e=t.get("user")&&!e.match(/^(?:[a-z]+:)?\/\/|^\//)?e.replace(/\.js$/,""):e},R.prototype.getSafeDragNDropHandler=function(e){return function(t){return!(!this.isDragValid()&&!this.isDraggingSupportedFile(t))&&e.apply(this,arguments)}.bind(this)},R.prototype.getSelectedDocument=function(){return this.dashboardAppModel.get("documents").get(this.dashboardViewModel.get("selectedDocumentId"))},R.prototype.getWidgetClass=function(t,e){return this.widgetClass},R.prototype.isDragValid=function(){return this.dashboardAppModel.has("draggedComponentId")&&!this.quickView},R.prototype.isDraggingSupportedFile=function(t){return!!t.originalEvent.dataTransfer&&_.includes(t.originalEvent.dataTransfer.types,"Files")&&!this.quickView&&(void 0===t.originalEvent.dataTransfer.items||_.some(t.originalEvent.dataTransfer.items,function(t){return _.includes(["application/json","text/xml"],t.type)}))},R.prototype.onBuildModeChanged=function(t,e,n){this.switchBuildMode(this.dashboardViewModel.get("buildMode"),n.userInitiated)},R.prototype.onDragEnter=function(t){return this.isDragValid()&&this.userCan("addNew")&&this.$el.addClass("drop-target"),!1},R.prototype.onDragLeave=function(t){this.isDragValid()&&this.$el.removeClass("drop-target")},R.prototype.onDragOver=function(t){return this.isDragValid()&&!this.$el.hasClass("drop-target")&&this.$el.addClass("drop-target"),!1},R.prototype.onDrop=function(t){var e,n,i;if(this.isDragValid()){if(this.$el.removeClass("drop-target"),!(n=t.originalEvent.dataTransfer?t.originalEvent.dataTransfer.getData("text"):n))return!1;if(e=this.dashboardAppModel.get("components").get(n),t=$(t.currentTarget).find(".component-drop-widget").first().attr("data-widgetid"),!e)return!1;t&&(i=this.findWidgetItem(t),this.deselectCurrentWidget()),i?this.addComponentToWidget(i.model,n,!0):this.addNewWidget(new Es.Widget({},{},this.widgetsCollection),n,!1)}return!1},R.prototype.onRemoveWidget=function(t){this.widgetsCollection.commandRemove(t)},R.prototype.onResizeStart=function(){_.each(this.widgets,function(t){t.view.onResizeStart&&t.view.onResizeStart(!0)})},R.prototype.onResize=function(t){_.each(this.widgets,function(t){t.view.onResize&&t.view.onResize(!0)})},R.prototype.onResizeStop=function(){_.each(this.widgets,function(t){t.view.onResizeStop&&t.view.onResizeStop(!0)}),this.userCan()?this.$el.find(".component-build-view").removeClass("build-off"):this.$el.find(".component-build-view").addClass("build-off")},R.prototype.onSelectedWidgetChanged=function(t,e){this.selected&&this.selected.$widget.removeClass("selected"),e?(e=this.findWidgetItem(e.id))&&(this.selected=e,this.selected.$widget.addClass("selected")):this.selected=null},R.prototype.onSelectingWidget=function(t,e){t&&(this.onWidgetClick(null,e),this.dashboardAppModel.set("pendingSelectionWidgetId",null,{silent:!0}))},R.prototype.getRepeatableParent=function(t){for(;t&&t.parent;){if(_.get(t,"attributes.Repeated"))return t;t=t.parent}return null},R.prototype.onWidgetClick=function(t,e){var n;document.querySelector(Es.ComponentDropView.ADVANCED_CSS_WIDGET)||(t&&(e=$(t.currentTarget).attr("data-widgetid")),n=this.findWidgetItem(e),!_.isNil(_.get(n,"model"))&&this.getRepeatableParent(n.model))||!n||!e&&$(t.target).is(n.$remove)||this.ignoreWidgetSelect||(t&&t.stopPropagation&&t.stopPropagation(),t&&$(t.target).parent().hasClass("QuickStart"))||(this.dashboardViewModel.get("selectedWidget")===n.model?(this.dashboardViewModel.set("selectedWidget",null),this.dashboardViewModel.set("selectedWidgetView",null,{silent:!0})):(this.dashboardViewModel.set("selectedWidget",n.model),this.dashboardViewModel.set("selectedWidgetView",n.view,{silent:!0})))},R.prototype.onWidgetCollectionAdd=function(t,e,n){this.addWidget(t,!1,null)},R.prototype.onWidgetCollectionRemove=function(t,e,n){this.removeWidget(t)},R.prototype.remove=function(){return this.clearWidgets(),f.View.prototype.remove.apply(this)},R.prototype.removeWidget=function(t){t=_.find(this.widgets,{model:t});t&&(this.selected&&this.selected===t&&this.deselectCurrentWidget(),this.widgets=_.without(this.widgets,t),t.$widget.css({border:"none",background:"none","box-shadow":"none","pointer-events":"none"}),t.view&&_.isFunction(t.view.remove)&&t.view.remove(),t.$widget.off(),t.$widget.remove())},R.prototype.renderComponent=function(t,e,n,i,o){e=this.createComponentView(t,e,n,i,o);t.$widget.append(e.$el),this.$el.append(t.$widget)},R.prototype.renderWidget=function(t){return $("<div></div>")},R.prototype.selectWidget=function(t){this.ignoreWidgetSelect||this.getRepeatableParent(t.model)||(this.dashboardViewModel.set("selectedWidget",t.model),this.dashboardViewModel.set("selectedWidgetView",t.view,{silent:!0}))},R.prototype.setTheme=function(e){_.each(this.widgets,function(t){t.view&&t.view.app&&_.isFunction(t.view.app.setTheme)&&t.view.app.setTheme(e)})},R.prototype.showReplaceConfirmationDialog=function(e,n){var i=_.get(this.dashboardAppModel.get("components").get(_.get(n,"model.attributes.component.attributes.definitionId",null)),"attributes.componentName","");Es.ConfirmDialog.ShowConfirm({dialogTitle:"Confirm Replace",renderTemplate:function(){return t("Are you sure you would like to replace this ".concat(i," component?"))},callback:e})},R.prototype.switchBuildMode=function(t,e){t?this.switchOnBuildMode(e):this.switchOffBuildMode(e)},R.prototype.switchOffBuildMode=function(t){this.disableWidgetSelect(),this.dashboardAppModel.set("showBreadcrumbs",!1),_.each(this.widgets,function(t){t.$widget&&t.$widget.addClass("build-off")})},R.prototype.switchOnBuildMode=function(t){this.enableWidgetSelect(),this.dashboardAppModel.set("showBreadcrumbs",!0),_.each(this.widgets,function(t){t.$widget&&t.$widget.removeClass("build-off")})},R.prototype.userCan=function(t){return this.dashboardViewModel.get("buildMode")&&!this.quickView},R.ADVANCED_CSS_WIDGET=".ui-widget-content > .ui-widget-header  >.fa-css3",Es.ComponentDropView=R,Ps=A=A||{},Is=f.View,e(va,Is),va.prototype.initializeEvents=function(){var t=this.appModel.get("documents");this.listenTo(t,"reset",this.onDocumentsReset),this.listenTo(t,"add",this.onDocumentsAdd),this.listenTo(t,"remove",this.onDocumentsRemove),this.listenTo(this.viewModel,"change:selectedDocumentId",this.onViewModelSelectedChanged)},va.prototype.blurSelect=function(){this.select2.data("select2").$container.find(".select2-selection").blur()},va.prototype.getDocuments=function(){var e=this,n=[],i=[],o=[];this.documentTypeMap={},_.sortBy(this.appModel.get("documents").map(function(t){return t.attributes}),function(t){return-Date.parse(t.lastUpdateDate)}).forEach(function(t){e.appModel.get("quickview")&&0===t.name.indexOf("Draft:")||(_.includes(t.tags,"starred")?(o.push(t),e.documentTypeMap[t.id]="starred"):i.length<e.RECENT_DOCUMENT_COUNT?(i.push(t),e.documentTypeMap[t.id]="recent"):(n.push(t),e.documentTypeMap[t.id]="other"))}),o=_.sortBy(o,function(t){return t.name.toLowerCase()}),n=_.sortBy(n,function(t){return t.name.toLowerCase()}),this.documentsList=i.concat(o,n)},va.prototype.onDocumentsAdd=function(t){this.listenTo(t,"change:name",this.render),0<this.$el.find("select").length&&(this.$el.find("select").select2("close"),this.render())},va.prototype.onDocumentsRemove=function(t){this.stopListening(t),this.render()},va.prototype.onDocumentsReset=function(t,e){var n=this;_.each(e.previousModels,function(t){n.stopListening(t)}),t.each(function(t){n.listenTo(t,"change:name",n.render)}),this.render()},va.prototype.onResize=function(){this.availableHeight=.4*$("body").height()},va.prototype.onViewModelSelectedChanged=function(t,e){e!==this.$el.find("select").val()&&this.selectDocument(e)},va.prototype.render=function(){var i=this,o=this;return this.getDocuments(),this.$el.html(Ps.T.DocumentSelector(this.documentsList)),this.select2=this.$el.find("select").select2({language:{noResults:function(){return"No Dashboards found"}},templateResult:function(t,e){var n;switch(o.documentTypeMap[t.id]){case"starred":n=$('<span><i class="dashboard-selector-icon fa fa-star" title="Starred"></i>'+_.escape(t.text)+"</span>"),$(e).addClass("starred");break;case"recent":n=$('<span><i class="dashboard-selector-icon fa fa-clock-o" title="Recent"></i>'+_.escape(t.text)+"</span>"),$(e).addClass("recent");break;default:n=$("<span>"+_.escape(t.text)+"</span>")}return n},theme:"document-selector",width:"225px"}),this.onResize(),this.select2.on("select2:open",function(){var e,n=$(".select2-container--document-selector .select2-dropdown");i.showManage&&0==n.find(".manage").length&&((e=$('<a class="manage" tabindex="0" title="'+t("Manage Dashboards")+'">'+t("Manage Dashboards")+"</a>")).button({icon:"fa fa-share-square-o"}).click(function(){e.removeClass("ui-state-hover"),i.select2.select2("close"),i.trigger("manage")}),n.append("<hr>"),n.append(e)),n.find(".select2-results > ul").css("max-height",i.availableHeight+"px"),Ps.Tools.isIE()||$(".select2-search__field").attr("placeholder","Search...")}),this.select2.on("select2:close",function(){_.defer(function(){o.blurSelect()})}),this.select2.on("select2:select",function(){var t=o.select2.val();if(t!==o.viewModel.get("selectedDocumentId"))try{o.appModel.get("router").onNavCancel=function(){o.select2.val(o.viewModel.get("selectedDocumentId")).trigger("change")},o.appModel.get("router").navigate(t,{trigger:!0})}catch(t){Ps.Log.Error("Select Document Error:",t)}o.blurSelect()}),this.selectDocument(this.viewModel.get("selectedDocumentId")),this},va.prototype.selectDocument=function(t){var e=this.$el.find("select"),n=this.appModel.get("documents").get(t);e.val(t).trigger("change"),n&&this.$el.find("input").val(n.get("name"))},Ps.DocumentSelector=va,As=A=A||{},ks=f.View,e(ba,ks),ba.prototype.initializeEvents=function(){this.listenTo(this.model.get("popups"),"reset viewStatesParsed",this.onResetPopups),this.listenTo(this.model.get("popups"),"add",this.onAddPopup),this.listenTo(this.model.get("popups"),"remove",this.onRemovePopup),this.listenTo(this.model,"change:advancedCss",this.applyCustomCss),this.listenTo(this.model,"change:cssClasses",this.onCssClassesChanged),this.listenTo(this.viewModel,"change:selectedScreenId",this.onSelectedScreenChanged),this.listenTo(this.viewModel,"change:DashboardTheme",function(t){this.applyTheme(t.get("DashboardTheme"))}),$(window).on("keydown",this.onKeyDown.bind(this))},ba.prototype.applyCustomCss=function(){var t=this.model.get("advancedCss");t?t!==this.customCss&&(this.$customCss&&this.$customCss.length?this.$customCss.html(t):this.$customCss=$("<style></style>",{documentid:this.model.id,html:t,type:"text/css"}).appendTo(document.head),this.customCss=t):this.$customCss&&(this.$customCss.remove(),this.$customCss=null,this.customCss=null)},ba.prototype.applyCssClasses=function(t){t?(t=_.isArray(t)?_.reduce(t,function(t,e){return t+" "+e}):t)!==this.cssClasses&&(this.$el.removeClass(this.cssClasses),this.$el.addClass(t),this.cssClasses=t):(this.$el.removeClass(this.cssClasses),this.cssClasses=null)},ba.prototype.applyDataSources=function(){_.each(this.model.get("data").flatten(),function(t){t.isMapping()&&t.get(As.DocumentDataModel.AUTO_EXECUTE)&&t.apply()})},ba.prototype.applyTheme=function(e){var n=this;this.screenView&&_.each(this.screenView.widgets,function(t){n.applyThemeToWidget(t,e)})},ba.prototype.applyThemeToWidget=function(t,e){t.view.app&&t.view.app.setTheme&&t.view.app.setTheme(e)},ba.prototype.changeScreen=function(e){this.screenView&&this.screenView.remove();var n=$(document.createElement("div"));n.addClass("screen-view"),n.appendTo(this.$el.find(".screen-view-div")),this.screenView=null,this.quickView&&eo.reset(e),require(["Panel"],function(t){this.screenView||(this.applyDataSources(),this.passScreenPropertiesToDocumentModel(e,this.model),this.screenView=new t({el:n,model:e,dashboardAppModel:this.appModel,documentModel:this.model,dashboardViewModel:this.viewModel,websiteUrl:this.appModel.get("websiteUrl"),DeltaClientLib:this.deltaClient,api:{},isBasePanel:!0,quickView:this.quickView}))}.bind(this))},ba.prototype.createPopup=function(t){return new As.PopupView({viewModel:this.viewModel,appModel:this.appModel,container:this.$el,quickView:this.quickView,model:t})},ba.prototype.onAddPopup=function(){this.popups.push(this.createPopup(arguments[0]))},ba.prototype.onRemovePopup=function(e){var t=_.find(this.popups,function(t){return t.model.get("id")===e.get("id")});this.popups.splice(this.popups.indexOf(t),1),t.remove()},ba.prototype.onResetPopups=function(){var e=this;_.each(this.popups,function(t){t.remove()}),this.popups=[],this.model.get("popups").each(function(t){e.popups.push(e.createPopup(t))})},ba.prototype.onKeyDown=function(t){var e,n=t.keyCode;(t.ctrlKey||t.metaKey)&&(t=this.model.get("shortcuts"),e=String.fromCharCode(n).toLowerCase(),n=_.find(t,function(t){return t.Key===e}))&&n.Data&&n.Data.forceExecute()},ba.prototype.onCssClassesChanged=function(){var t=this.model.get("cssClasses");t&&t._dashboardsType||(this.prevCssViewModel&&(this.stopListening(this.prevCssViewModel),this.prevCssViewModel=null),t instanceof f.Model&&(this.listenTo(t,"change:value",function(t,e){this.applyCssClasses(e)}),t=(this.prevCssViewModel=t).get("value")),this.applyCssClasses(t))},ba.prototype.onResize=function(){this.screenView&&this.screenView.onResize(!0)},ba.prototype.onSelectedScreenChanged=function(){var t,e=!1,n=this.viewModel.get("selectedScreenId");n&&(t=this.model.get("screens").get(n))&&(this.changeScreen(t),e=!0),e||((t=this.model.get("screens").findWhere({isDefault:!0}))?this.viewModel.set("selectedScreenId",t.id):(t=this.model.get("screens").first())&&(t.set("isDefault",!0),this.viewModel.set("selectedScreenId",t.id)))},ba.prototype.passScreenPropertiesToDocumentModel=function(t,e){var n=t.get("relativeHeight"),i=t.get("rowCount")||24,o=t.get("rowHeight")||25;void 0===n&&void 0===(n=e.get("relativeHeight"))&&(n=!0),t.set(n={relativeHeight:n,rowCount:i,rowHeight:o}),e.set(_.extend(n,{colCount:t.get("colCount"),floatable:t.get("floatable")})),e.trigger("basePanelLayoutChanged")},ba.prototype.pasteWidget=function(t){this.screenView&&!this.quickView&&this.screenView.pasteWidget(t)},ba.prototype.remove=function(){var t;return this.stopListening(),this.screenView&&this.screenView.remove(),_.each(this.popups,function(t){t.remove()}),this.$customCss&&this.$customCss.remove(),(t=this.model.get("data"))&&(t.stopPolledQueries&&t.stopPolledQueries(),t.removeSubscriptions)&&t.removeSubscriptions(),$(window).off("keydown"),f.View.prototype.remove.call(this)},As.DocumentView=ba,xs=A=A||{},Ns=f.View,e(Sa,Ns),Sa.checkCapslockOn=function(t){var e=/Mac/.test(navigator.platform),n=t.charCode,i=t.shiftKey,o=!1;return 97<=n&&n<=122?o=i:!(65<=n&&n<=90)||i&&e?122<n&&t.getModifierState("CapsLock")&&(o=!0):o=!i,o},Sa.prototype.onWindowCapsLockClick=function(t){20===t.which&&(t.getModifierState("CapsLock")?this.setErrorMessage("capsLock","#ffc800"):this.$el.find(".loginErrorPanel").css("visibility","hidden"))},Sa.prototype.render=function(){var e=this;return this.$el.html(xs.T.LoginDialog({})),$(".quick-base").addClass("disturbed"),$(document).find(".loadingScreen svg").hide(),$(document).find(".loading-info svg").hide(),e.$userLoginForm=this.$el.find(".user-login-form"),e.$forgotPasswordForm=this.$el.find(".forgot-password-form"),e.$forgotPasswordBtn=this.$el.find(".forgot-info"),e.$passwordResetInfo=this.$el.find(".password-reset-info"),e.$recoveryResponse=this.$el.find(".recovery-response"),e.$resetUserName=this.$el.find(".reset-username"),this.$restPasswordError=this.$el.find(".reset-password-error"),e.$dialog=this.$el.find(".login-form"),e.$buttonPanel=this.$el.find(".login-button-panel"),this.$el.find(".login-btn").button({label:t("Login"),icon:"fa fa-check"}),this.$el.find(".back-btn").button({label:t("Back"),icon:"fa fa-arrow-left"}),this.$el.find(".reset-btn").button({icon:"fa fa-undo",label:t("Reset")}),e.$loginBtn=this.$el.find(".login-btn"),e.$backBtn=this.$el.find(".back-btn"),e.$backBtn.hide(),e.$resetBtn=this.$el.find(".reset-btn"),e.$resetBtn.hide(),(e=$.cookie("deltaLoginError"))?$.removeCookie("deltaLoginError",{path:"/;SameSite=Strict"}):e=this.errorMessage,e&&this.setErrorMessage(e),this},Sa.prototype.initializeEvents=function(){var e=this;e.$el.find(".password, .username").on("keydown",function(t){13===t.which&&e.onLoginButtonClick(t)}),window.addEventListener("keydown",this.boundCapsLockFn,!0),e.$el.find(".password").on("keypress",function(t){Sa.checkCapslockOn(t.originalEvent)?e.setErrorMessage("capsLock","#ffc800"):e.$el.find(".loginErrorPanel").css("visibility","hidden")}),e.$forgotPasswordBtn.on("click",function(){e.showForgotPasswordForm()}),e.$forgotPasswordBtn.on("keydown",function(t){" "!==t.key&&"Enter"!==t.key||e.showForgotPasswordForm()}),e.$loginBtn.on("click",function(t){t.preventDefault(),e.onLoginButtonClick(t)}),e.$backBtn.on("click",function(t){t.preventDefault(),e.hideForgotPasswordForm()}),e.$resetBtn.on("click",function(t){t.preventDefault(),e.onResetButtonClick()}),$(xs.DeltaClientLib).one("DeltaClientLogin",$.proxy(e.onLoginSuccess,e))},Sa.prototype.clickLoginButton=function(){this.onLoginButtonClick({currentTarget:$(".login-button-panel .login-btn")})},Sa.prototype.onLoginButtonClick=function(e){var n,i,o=this;this.clicked||(n=this.$el.find(".username").val(),i=this.$el.find(".password").val(),n&&i?(this.setErrorMessage("Connecting please wait...","#fff"),this.clicked=!0,e&&(this.$loginBtn.button("option","icon","fa fa-spinner fa-pulse"),this.$loginBtn.button("option","label",t("wait")+"...")),this.$el.find("input").attr("disabled","disabled"),_.isFunction(o.doLogin)&&o.doLogin(n,i,function(t){o.setErrorMessage(t)})):(this.setErrorMessage("Please enter your username and password."),e.preventDefault()))},Sa.prototype.onLoginSuccess=function(){this.appModel.set("userName",xs.DeltaClientLib.deltaClient.user()),$.cookie("deltaToken",xs.DeltaClientLib.deltaClient.tokenKey(),{expires:30,path:"/;SameSite=Strict",secure:"https:"===_.get(window,"location.protocol")}),$(".quick-base").removeClass("disturbed"),this.onRemove()},Sa.prototype.onRemove=function(){this.$loginBtn.off(),this.$backBtn.off(),this.$resetBtn.off(),this.$forgotPasswordBtn.off(),$(document).find(".loadingScreen svg").show(),$(document).find(".loading-info svg").show(),$(xs.DeltaClientLib).off("DeltaClientLogin",this.onLoginSuccess),window.removeEventListener("keydown",this.boundCapsLockFn,!0),this.remove()},Sa.prototype.onResetButtonClick=function(){var t,n=this;this.$restPasswordError.css("visibility","hidden"),this.$userLoginForm.removeClass("open"),(t=this.$resetUserName.val())&&0<t.length?(this.showPasswordResetInfo(),$.get("/kxuseradmin?operation=request&data="+t).done(function(t){n.$recoveryResponse.text(t)}).fail(function(t){var e="Error";_.isString(t)?e+=": "+t:t&&t.statusText&&(e+=": "+t.statusText),n.$recoveryResponse.text(e)})):this.$restPasswordError.css("visibility","visible")},Sa.prototype.setErrorMessage=function(e,n){var i=this;this.$el.find(".loginErrorPanel").removeClass("warning"),"#fff"===n?this.$el.find(".loginErrorPanel").addClass("info"):"#ffc800"===n?this.$el.find(".loginErrorPanel").addClass("warning"):this.$el.find(".loginErrorPanel").removeClass("info"),"locked"===e?e=t("Account is locked; please contact your administrator"):"capsLock"===e&&(e='<i class="fa fa-warning"></i>'+t("Caps Lock is on")),this.$el.find(".loginErrorPanel").css({}),this.$el.find(".loginErrorPanel").html(e).css("visibility","visible"),i.clicked=!1,"fa fa-spinner fa-pulse"===this.$loginBtn.button("option","icon")&&(this.$loginBtn.button("option","icon","fa fa-check"),this.$loginBtn.button("option","label",t("Login"))),i.$el.find("input").removeAttr("disabled"),"Please reset password"!==e&&"Your password has expired"!==e||i.changePasswordDialog||(i.changePasswordDialog=new xs.ChangePasswordDialog({appModel:i.appModel,container:i.container,message:e,onChangeSuccess:function(){i.$el.find(".loginErrorPanel").css("visibility","hidden"),i.$el.data("uiDialog")&&i.$el.dialog("close")},onDialogClose:_.bind(function(){i.changePasswordDialog=null},i)}))},Sa.prototype.showForgotPasswordForm=function(){this.$userLoginForm.removeClass("open"),this.$forgotPasswordForm.addClass("open"),this.$passwordResetInfo.removeClass("open"),this.$loginBtn.hide(),this.$backBtn.show(),this.$resetBtn.show()},Sa.prototype.showPasswordResetInfo=function(){this.$userLoginForm.removeClass("open"),this.$forgotPasswordForm.removeClass("open"),this.$passwordResetInfo.addClass("open"),this.$loginBtn.hide(),this.$resetBtn.hide(),this.$backBtn.show()},Sa.prototype.hideForgotPasswordForm=function(){this.$forgotPasswordForm.removeClass("open"),this.$passwordResetInfo.removeClass("open"),this.$userLoginForm.addClass("open"),this.$loginBtn.show(),this.$backBtn.hide(),this.$resetBtn.hide()},Sa.prototype.setCookiesToSameSite=function(t){["Strict","Lax","None"].includes(t=void 0===t?"Strict":t)?document.cookie.split(";").forEach(function(t){var e,t=t.split("=").map(function(t){return t.trim()}),n=t[0],t=t[1];n&&t&&0<=n.indexOf("dashboard")&&(e="https:"===window.location.protocol?"; Secure":"",document.cookie="".concat(n,"=").concat(t,"; Path=/;  SameSite=Strict").concat(e))}):console.error('Invalid SameSite value. Use "Strict", "Lax", or "None".')},Sa.prototype.parseJSON=function(e){try{return JSON.parse(e)}catch(t){return e}},xs.LoginDialog=Sa,u=A=A||{},wa.getStringColumns=function(t){t=t.source||t;return _.filter(t.dataSet.columns.models,function(t){return 11===Number(t.get("kdbType"))}).map(function(t){return t.id})},wa.getScalarColumns=function(t){t=t.source||t;return _.filter(t.dataSet.columns.models,function(t){t=Number(t.get("kdbType"));return 3<t&&t<11||11<t&&t<20}).map(function(t){return t.id})},wa.getNumericColumns=function(t){t=t.source||t;return _.filter(t.dataSet.columns.models,function(t){t=Number(t.get("kdbType"));return 3<t&&t<11}).map(function(t){return t.id})},wa.getTimeColumns=function(t){t=t.source||t;return _.filter(t.dataSet.columns.models,function(t){t=Number(t.get("kdbType"));return 11<t&&t<20}).map(function(t){return t.id})},wa.getListColumns=function(t){t=t.source||t;return _.filter(t.dataSet.columns.models,function(t){return 0===Number(t.get("kdbType"))}).map(function(t){return t.id})},u.HeuristicHelpers=wa,Ls=A=A||{},Rs=f.View,e(_a,Rs),_a.prototype.updateQuickViewSave=function(t){this.el.querySelectorAll('[data-menu-option="saveViewStates"]')[0].style.display="disabled"===t?"none":"block"},_a.prototype.renderView=function(){var e=this,t=(this.el.innerHTML=Ls.T.MainMenu(),this.el.querySelectorAll(".quickview-menu"));return _.forEach(t,function(t){t.style.display=e.isQuickView?"block":"none"}),this.isQuickView&&(t=this.el.querySelectorAll(".quickdash-menu"),_.forEach(t,function(t){t.style.display="none"})),this.el.tabIndex=-1,this.hide(),this},_a.prototype.show=function(){this.isQuickView||this.updateViewOnBuildMode();var t=this.mainMenuButton.getBoundingClientRect(),t=(this.el.style.left=t.x+"px",this.el.style.top=t.y+t.height+"px",this.el.style.display="block",this.getFirstVisibleMenuItem());(_.isNull(t)?this.el:(t.tabIndex=0,t)).focus(),document.addEventListener("mousedown",this.documentMouseDownHandler)},_a.prototype.hide=function(){for(var t=0,e=this.el.querySelectorAll(".toolbar-menu-item");t<e.length;t++)e[t].tabIndex=-1;this.el.style.display="none",document.removeEventListener("mousedown",this.documentMouseDownHandler)},_a.prototype.remove=function(){return this.removeEventListeners(),f.View.prototype.remove.apply(this)},_a.prototype.getFirstVisibleMenuItem=function(){for(var t=0,e=this.el.querySelectorAll(".toolbar-menu-item");t<e.length;t++){var n=e[t];if($(n).is(":visible"))return n}return null},_a.prototype.updateViewOnBuildMode=function(){var e=this.viewModel.get("buildMode"),t=this.el.querySelectorAll(".design-mode-only");_.forEach(t,function(t){t.style.display=e?"block":"none"})},_a.prototype.initializeEvents=function(){var e=this,t=this.el.querySelectorAll(".toolbar-menu-item");_.forEach(t,function(t){t.addEventListener("click",e.menuClickHandler),t.addEventListener("mouseover",e.mouseOverMenuItemHandler)}),this.el.addEventListener("keydown",this.keyDownHandler)},_a.prototype.removeEventListeners=function(){var e=this,t=this.el.querySelectorAll(".toolbar-menu-item");_.forEach(t,function(t){t.removeEventListener("click",e.menuClickHandler),t.removeEventListener("mouseover",e.mouseOverMenuItemHandler)}),this.el.removeEventListener("keydown",this.keyDownHandler),document.removeEventListener("mousedown",this.documentMouseDownHandler)},_a.prototype.onMenuItemClick=function(t){var t=t.target.closest(".toolbar-menu-item"),e=t.getAttribute("data-menu-option");t.tabIndex=-1,e&&this.trigger(e,e)},_a.prototype.onDocumentMouseDown=function(t){var e=this.el.getBoundingClientRect();(t.clientX<e.left||t.clientX>e.right||t.clientY<e.top||t.clientY>e.bottom)&&this.hide()},_a.prototype.onMouseOverMenuItem=function(t){t=t.target.closest(".toolbar-menu-item");document.activeElement!==t&&document.activeElement.classList.contains("toolbar-menu-item")&&(document.activeElement.tabIndex=-1),t.tabIndex=0,t.focus()},_a.prototype.onKeyDown=function(e){var t,n=e.target,i=-1,o=$(".toolbar-menu-item:visible");switch(-1<(i=n.classList.contains("toolbar-menu-item")?_.findIndex(o,function(t){return t===e.target}):i)&&(o[i].tabIndex=-1),e.key){case"ArrowDown":case"ArrowUp":"ArrowDown"===e.key?t=i+1>=o.length?0:i+1:"ArrowUp"===e.key&&(t=i-1<0?o.length-1:i-1),o[t].tabIndex=0,o[t].focus();break;case"Tab":e.shiftKey&&this.hide();break;case"Enter":case" ":e.preventDefault(),n.dispatchEvent(new Event("click"));break;case"Escape":this.hide(),this.mainMenuButton.focus();break;default:return}},Ls.MainMenu=_a,(A||(A={})).HelpDialog=f.View.extend({$dialog:null,appModel:null,className:"quick-base window",viewModel:null,initialize:function(t){this.appModel=t.appModel,this.container=t.container,this.viewModel=t.viewModel,this.tag=t.tag,this.render()},remove:function(){this.$el.dialog("destroy").remove(),this.stopListening(),this.$el.off(),this.$el.remove()},render:function(){var e=this,n=$(document),i=this.appModel.get("DocsUrl"),o=this.appModel.get("websiteUrl").replace("/edit",""),i=void 0!==i?i:o+"docs/",o=this.appModel.get("isHelpDialogTabbed")||!1,i=void 0!==this.tag?i+"/"+this.tag:i;o?window.open(i,"_blank","noopener,noreferrer,resizable"):(this.$el.html($("<iframe></iframe>").attr("src",i)),this.$dialog=this.$el.dialog(_.extend({appendTo:this.container,classes:{"ui-dialog":"quick-base help-dialog"},title:t("Help"),resizable:!0,height:.8*n.height(),width:.8*n.width(),modal:!0,autoOpen:!0,draggable:!0,open:function(){$('<i class="fa fa-question-circle"></i>').insertBefore(e.$el.parent().find(".ui-dialog-title"))},close:function(){e.remove()}},this.options)))}}),Vs=A=A||{},Os=f.View,e(Ta,Os),Ta.prototype.getTimezones=function(){this.timezones=_.map(h.tz.names(),function(t){return{group:t.substr(0,t.indexOf("/")),label:t.substr(t.indexOf("/")+1),value:t}}),this.timezones=_.groupBy(this.timezones,"group")},Ta.prototype.onAbout=function(){new Vs.AboutDialog({appModel:this.appModel,container:this.dialogContainer,viewModel:this.viewModel})},Ta.prototype.onHelp=function(){new Vs.HelpDialog({appModel:this.appModel,container:this.dialogContainer,viewModel:this.viewModel,tag:"home.htm"})},Ta.prototype.onChangeLanguage=function(){var t=this.$selectLanguage.val();t&&t!==$.cookie("dashboard-language")&&($.cookie("dashboard-language",t,{expires:90,path:"/;SameSite=Strict",secure:"https:"===_.get(window,"location.protocol")}),window.location.reload(!1))},Ta.prototype.onChangeLogLevel=function(){var t=this.$selectLogLevel.val();t&&t!==$.cookie("dashboard-log-level")&&$.cookie("dashboard-log-level",t,{expires:90,path:"/;SameSite=Strict",secure:"https:"===_.get(window,"location.protocol")}),Vs.Log.trace(t.toString())},Ta.prototype.onChangePassword=function(){new Vs.ChangePasswordDialog({appModel:this.appModel,container:this.dialogContainer})},Ta.prototype.onChangeTheme=function(){var t=this.$selectTheme.val();t&&t!==$.cookie("dashboard-theme")&&($.cookie("dashboard-theme",t,{expires:90,path:"/;SameSite=Strict",secure:"https:"===_.get(window,"location.protocol")}),this.trigger("themeChange",t))},Ta.prototype.onChangeViewerTheme=function(){var t=this.$selectViewerTheme.val();t&&t!==$.cookie("dashboard-viewer-theme")&&($.cookie("dashboard-viewer-theme",t,{expires:90,path:"/;SameSite=Strict",secure:"https:"===_.get(window,"location.protocol")}),this.trigger("themeChange",t))},Ta.prototype.onChangeTimezone=function(){var t=this.$selectTimezone.val();t&&t!==$.cookie("dashboard-timezone")&&($.cookie("dashboard-timezone",t,{expires:90,path:"/;SameSite=Strict",secure:"https:"===_.get(window,"location.protocol")}),window.location.reload(!1))},Ta.prototype.onLogout=function(){var e=this,n=this.viewModel.get("selectedDocumentId"),i=this.appModel.get("documents").find(function(t){return t.id===n});!(this.isQuickView?i&&i.get("viewState").wasChanged:i&&i.get("wasChanged"))||this.isQuickView&&!i.get("unsavedViewerPrompt")?Vs.DeltaClientLib.logout():new Vs.AreYouSureDialog({userClass:this.isQuickView?"quick-view":"quick-dash",container:this.dialogContainer,noSaveCb:_.bind(Vs.DeltaClientLib.logout,Vs.DeltaClientLib),saveCb:function(){var t;e.isQuickView?((t=i.get("viewState")).withAllProperties=!0,Vs.ViewStateModelHelpers.renameViewStateAttrNamedID(t),i.get("viewState").save({id:n},{success:_.bind(Vs.DeltaClientLib.logout,Vs.DeltaClientLib)}),t.withAllProperties=!1,Vs.ViewStateModelHelpers.restoreViewStateAttrNamedID(t)):i.saveNow($.noop,_.bind(Vs.DeltaClientLib.logout,Vs.DeltaClientLib))}})},Ta.prototype.onThemeSwitchableChange=function(){this.viewModel.get("themeSwitchable")?this.$selectViewerTheme.prop("disabled",!1):this.$selectViewerTheme.prop("disabled",!0)},Ta.prototype.render=function(){var t,n=this;return this.$el.html(Vs.T.ProfileMenu({majorTimezones:this.MAJOR_TIMEZONES,saml:this.appModel.get("saml"),isLite:this.appModel.get("isLite"),logLevel:this.logLevels,themes:this.themes,timezones:this.timezones,editor:!this.isQuickView,showBreadcrumbs:this.appModel.get("showBreadcrumbs")})),this.$buttonset=this.$el.find(".buttonset"),this.$selectLanguage=this.$el.find(".select-language"),this.$selectLogLevel=this.$el.find(".select-log-level"),this.$selectTheme=this.$el.find(".select-theme"),this.$selectTimezone=this.$el.find(".select-timezone"),this.$selectViewerTheme=this.$el.find(".select-viewer-theme"),this.$breadcrumbs=this.$el.find(".breadcrumbs"),this.$buttonset.menu({select:function(t){var e=$(t.currentTarget).attr("data-options");switch(e=" "!==t.key&&"Enter"!==t.key?e:$(t.currentTarget).find(".ui-state-active").parent().attr("data-options")){case"change-password":n.onChangePassword();break;case"about":n.onAbout();break;case"helpguide":n.onHelp();break;case"logout":n.onLogout();break;case"login-history":n.trigger("login-history");break;case"logout-local":n.ssoLogout("local");break;case"logout-global":n.ssoLogout("global");break;case"open-editor":window.open("./edit#"+Vs.Tools.getHash(),"_blank","noopener,noreferrer,resizable");break;case"open-viewer":window.open("../#"+Vs.Tools.getHash(),"_blank","noopener,noreferrer,resizable");break;case"document-breadcrumbs":n.toggleBreadcrumbs()}}}),t=[{$el:this.$selectLanguage,value:$.cookie("dashboard-language")||"en",options:{},callback:this.onChangeLanguage},{$el:this.$selectLogLevel,value:$.cookie("dashboard-log-level")||"4",options:{minimumResultsForSearch:10},callback:this.onChangeLogLevel},{$el:this.$selectTheme,value:$.cookie("dashboard-theme")||"kx-darkroom",options:{minimumResultsForSearch:3},callback:this.onChangeTheme},{$el:this.$selectViewerTheme,value:$.cookie("dashboard-viewer-theme")||"kx-darkroom",options:{minimumResultsForSearch:3},callback:this.onChangeViewerTheme},{$el:this.$selectTimezone,value:Vs.Tools.timezone,options:{},callback:this.onChangeTimezone}],_.each(t,function(t){t.$el.val(t.value),t.$el.select2(_.extend({theme:"dashboards"},t.options)),t.$el.on("select2:select",_.bind(t.callback,n)),t.$el.on("select2:open",function(){$("body > .select2-container--dashboards.select2-container--open").addClass("select2--environment"),$(".select2-search__field").on("click",function(t){t.stopPropagation()})}),t.$el.on("select2:close",function(){$(".select2-search__field").off()})}),(this.isQuickView?this.$el.find(".row.theme"):this.$el.find(".row.viewer-theme")).css("display","none"),this},Ta.prototype.ssoLogout=function(t){Vs.DeltaClientLib.ssoLogout(t)},Ta.prototype.toggleBreadcrumbs=function(){this.appModel.set("showBreadcrumbs",!this.appModel.get("showBreadcrumbs")),this.appModel.get("showBreadcrumbs")?this.$breadcrumbs.addClass("checked"):this.$breadcrumbs.removeClass("checked")},Vs.ProfileMenu=Ta,Bs=A=A||{},$s=f.View,e(Ca,$s),Ca.prototype.initializeEvents=function(){this.listenTo(this.viewModel,"change:buildMode",this.onBuildModeChange),this.listenTo(this.model,"change:dialogTitle change:dialogWidth change:dialogHeight change:modal change:resizable",this.onDialogAttributeChange),this.listenTo(this.model,"change:visible",this.initializeVisible)},Ca.prototype.destroyDialog=function(){this.$dialog.dialog("instance")&&this.$dialog.dialog("destroy")},Ca.prototype.initializeComponentDrop=function(){var t;this.componentDropView||(t=$("<div></div>",{class:"component-drop"}),this.$contentPanel.append(t),this.componentDropView=new Bs.ComponentDropView({el:t,dashboardAppModel:this.appModel,dashboardViewModel:this.viewModel,DeltaClientLib:Bs.DeltaClientLib,quickView:this.quickView,widgets:this.model.get("widgets")}))},Ca.prototype.popupPosition=function(){var t,e=this.model.get("dialogTop"),n=this.model.get("dialogLeft"),i=$(".main-toolbar").height()||34;return!e&&0!==e||!n&&0!==n||((t=localStorage.getItem("popupDialog-"+this.model.get("id")))&&(e=(t=JSON.parse(t)).top,n=t.left),e=parseFloat(e)-i,n=parseFloat(n)),{top:e,left:n}},Ca.prototype.initializeDialog=function(){var o=this,t=!1,e=this.processSettings(),n=this.popupPosition(),i={my:"center",at:"center",of:this.$dialogContainer},s={appendTo:this.$dialogContainer,autoOpen:!1,close:function(){var t=o.model.get("visible");!o.isEditing&&t instanceof f.Model&&!1!==t.get("value")&&t.set("value",!1),o.doActions(o.model.get("Actions")),o.isEditing?o.remove():o.removeComponentDropView()},classes:{"ui-dialog":"popup-dialog"},drag:function(t,e){localStorage.setItem("popupDialog-"+o.model.get("id"),JSON.stringify(e.offset))},dragStop:function(t,e){var n=_.get(e,"offset"),i=_.get(e,"offset.top"),e=_.get(e,"offset.left");_.isNil(n)&&(_.isNil(i)||o.model.get("dialogTop").set("value",i),_.isNil(e)||o.model.get("dialogLeft").set("value",e),localStorage.setItem("popupDialog-"+o.model.get("id"),JSON.stringify(n)))},open:function(){o.componentDropView&&o.componentDropView.onResize(),o.$dialog.dialog("option",{position:i});var t=o.$dialog.parent();t.attr("data-widgetid",o.widgetId),(n=o.popupPosition()).top&&n.left&&t.css({top:n.top,left:n.left}),o.isEditing&&$("<div></div>").addClass("popup-mask ui-widget-overlay").appendTo(o.$dialogContainer).click(function(){o.$dialog.dialog("close")})},position:i,resizeStop:function(){o.componentDropView&&o.componentDropView.onResize()},title:e.dialogName||e.dialogTitle};_.assign(s,this.getAdjustedSize(e)),this.isEditing?(s.modal=!1,s.resizable=!1):(s.modal=!0===e.modal,s.resizable=!0===e.resizable),this.$dialog.dialog("instance")?(this.$dialog.dialog("option","modal")!==s.modal&&(t=this.$dialog.dialog("isOpen")),this.$dialog.dialog("option",s),t&&(this.$dialog.dialog("close"),this.$dialog.dialog("open"))):this.$dialog.dialog(s),(n=this.popupPosition()).top&&n.left&&this.$dialog.parent().css({top:n.top,left:n.left})},Ca.prototype.initializeVisible=function(){var t=this.model.get("visible");this.visibleListener&&this.stopListening(this.visibleListener),t instanceof Bs.DocumentViewModel&&(this.listenTo(t,"change:value",this.onVisibleChange),this.visibleListener=t),this.onVisibleChange()},Ca.prototype.onBuildModeChange=function(){this.isEditing?this.remove():this.viewModel.get("buildMode")?this.$dialog.dialog("close"):(this.initializeDialog(),this.onVisibleChange())},Ca.prototype.getAdjustedSize=function(t){return{height:Math.min(t.dialogHeight,this.$dialogContainer.height())||.8*this.$dialogContainer.height(),width:Math.min(t.dialogWidth,this.$dialogContainer.width())||.8*this.$dialogContainer.width()}},Ca.prototype.onVisibleChange=function(){var t=this,e=this.model.get("visible");this.viewModel.get("buildMode")||(e instanceof Bs.DocumentViewModel&&(e=e.get("value")),this.$dialog.dialog("instance")&&_.defer(function(){t.toggleDialog(e)}))},Ca.prototype.pasteWidget=function(t){var e=t.get("component").get("definitionId"),n=this.componentDropView.widgetsCollection.first();n?((t=t.clone(n.get("id"))).setParent(this.componentDropView.widgetsCollection),n.commandSet({component:t.get("component")})):(t.setParent(this.componentDropView.widgetsCollection),this.componentDropView.addNewWidget(t,e,!0))},Ca.prototype.processSettings=function(){var n=this,t=_.omit(this.model.attributes,"visible"),i={};return _.each(this.viewStateListeners,function(t){n.stopListening(t,"change:value")}),this.viewStateListeners={},_.each(t,function(t,e){t instanceof Bs.DocumentViewModel?(i[e]=t.get("value"),n.viewStateListeners[t.path]||(n.listenTo(t,"change:value",function(){n.$dialog.dialog("instance")&&n.$dialog.dialog("isOpen")&&("height"===t.path||"width"===t.path)?n.$dialog.dialog(n.getAdjustedSize(n.processSettings())):n.initializeDialog()}),n.viewStateListeners[t.path]=t)):i[e]=t}),i},Ca.prototype.remove=function(){return this.isEditing&&this.$dialogContainer.find(".popup-mask").remove(),this.onDialogAttributeChange.cancel(),this.destroyDialog(),this.removeComponentDropView(),this.viewStateListeners={},f.View.prototype.remove.apply(this)},Ca.prototype.removeComponentDropView=function(){this.componentDropView&&(this.componentDropView.remove(),this.componentDropView=null)},Ca.prototype.stringToBoolean=function(t){if("boolean"==typeof t)return t;if(!t)return!1;var e=t.toString();switch(e.toLowerCase().trim()){case"true":case"yes":case"1":return!0;case"false":case"no":case"0":case null:return!1;default:return Boolean(e)}},Ca.prototype.toggleDialog=function(t){var t=_.isUndefined(t)?!this.$dialog.dialog("isOpen"):t;this.$dialog.dialog("instance")&&(this.stringToBoolean(t)?(this.initializeComponentDrop(),t=_.pick(this.$dialog.dialog("option"),["width","height"]),0!==Number(t.width)&&0!==Number(t.height)||this.$dialog.dialog("option",this.getAdjustedSize(this.processSettings())),this.$dialog.dialog("open"),this.viewModel.get("buildMode")&&(this.viewModel.set("selectedWidget",this.model),this.viewModel.set("selectedWidgetView",this,{silent:!0}))):this.$dialog.dialog("close"))},Ca.prototype.doActions=function(t){var s=this;_.each(t,function(t,e){var n,i,o;"map"===t._Type?(n=s.getPropertyMeta(e,"Current"),i=s.getPropertyMeta(e,"Target"),n&&(o="viewstate"===n.type?n.value:t.Current,Bs.Tools.isKDBTemporal(o)&&(o=Bs.Tools.convertKDBTemporalToMoment(o).toDashString()),i)&&"viewstate"===i.type&&i.path&&s.model.get("Actions")[e].Target.set("value",o)):"rollingOrDefault"!==t._Type||_.isEmpty(t.ViewState)||(n=s.getPropertyMeta(e,"ViewState"),i=s.model.get("Actions")[e].ViewState,o=n.isRolling?Bs.Helpers.convertRollingToDate(n.defaultValue,n.viewstateType):n.defaultValue,i.set("value",o))})},Ca.prototype.getPropertyMeta=function(t,e){var n,i,o,s,t=this.model.get("Actions")[t][e];return _.isNil(t)?null:("viewstate"===(e=this.getSourceType(t))?(o=t.get("value"),n=t.get("_default"),i=t.get("_type"),s=t.get("_rolling")):o=t,{path:t.path||null,type:e,value:o,viewstateType:i||null,defaultValue:n||null,isRolling:s||!1})},Ca.prototype.getSourceType=function(t){return t&&(t instanceof Bs.DocumentViewModel||t.get&&t.get("_viewType")||t.has&&t.has("_default")&&t.has("value"))?"viewstate":null},Bs.PopupView=Ca,Us=A=A||{},qs=Us.DialogBase,e(Da,qs),Da.prototype.dialogButtons=function(){return[{text:"OK",icon:"fa fa-check",click:this.onSave.bind(this)},{text:"Cancel",icon:"fa fa-times",click:this.onCancel.bind(this)}]},Da.prototype.preRender=function(){this.options.minHeight=250,this.options.width=325,this.options.dialogTitle="Color",this.options.userClass="quick-dash color-pickr-dialog",this.options.position={my:"left top",at:"left bottom",collision:"flip flip",of:$(this.options.target)}},Da.prototype.renderTemplate=function(){return Us.T.ColorPickr()},Da.prototype.postRender=function(){this.cPickerDiv=this.el.querySelectorAll(".color-pickr")[0]},Da.prototype.initColorPicker=function(t){var i=this,t=this.cPickr=new B({el:this.cPickerDiv,inline:!0,showAlways:!0,useAsButton:!0,theme:"classic",default:t,defaultRepresentation:"HEXA",swatches:null,lockOpacity:"false"===this.options.noColor,components:{preview:!0,opacity:"true"===this.options.noColor,hue:!0,interaction:{hex:!0,rgba:!0,hsla:!0,hsva:!1,cmyk:!1,input:!0,clear:!1,save:!1}}});document.querySelector(".pcr-result").classList.add("ui-widget","ui-state-default","ui-corner-all"),document.querySelectorAll(".pcr-type").forEach(function(t){t.classList.add("ui-widget","ui-state-default","ui-corner-all")}),this.initOverlayClick(),t.on("save",function(t,e){var n=i.options.selectCallback,t=t.toHEXA().toString();n&&n(t)}),t.show()},Da.prototype.initOverlayClick=function(){this.overlay=this.el.parentElement.parentElement.querySelector(".ui-widget-overlay:last-child"),this.overlay.addEventListener("click",this.onCancel.bind(this))},Da.prototype.onCancel=function(){this.overlay.removeEventListener("click",this.onCancel.bind(this)),this.isCancel=!0,this.dialogClose()},Da.prototype.onSave=function(){this.cPickr.applyColor(),this.dialogClose()},Us.ColorPickr=Da,Fs=A=A||{},Ea.applyFormatToValue=function(t,e,n,i,o){var s={1:"Boolean",2:"String",4:"Number",5:"Number",6:"Number",7:"Number",8:"Number",9:"Number",10:"String",11:"String",12:"Timestamp",13:"Month",14:"Date",15:"Datetime",16:"Timespan",17:"Minute",18:"Second",19:"Time"}[i],i=3<i&&i<10?"Number":11<i&&i<20?"DateTime":"String";return"TO_STRING"==e?t.toString():e?Ea._applyFormat(t,e,n,s,o,i):Ea._applyDefaultFormat(t,n,s,o,i)},Ea._applyFormat=function(t,e,n,i,o,s){var a=t.toString();switch(i=0===e.indexOf("SmartNumber")?"Smart Number":i){case"Smart Number":"DateTime"===s&&(u=Fs.Tools.convertKDBTemporalToMoment(t),t=_.escape(u)),r=-1!==e.indexOf(".")?e.split(".")[1].length:0,a=Fs.Tools.smartFormatNumber(t,r,!o);break;case"Number":!_.isNaN(Number(t))&&_.isFinite(Number(t))&&Number.MAX_SAFE_INTEGER>Number(t)&&(a=XLSX.SSF.format(e,Number(t)),o)&&(a=Ea._hideTrailingZeroes(a));break;case"Date":case"Month":case"Timestamp":case"Datetime":case"Timespan":case"Minute":case"Second":case"Time":var r="Time"===n,l="DateTime"===n,u=Fs.Tools.convertKDBTemporalToMoment(t);"Number"===n?(a=_.escape(u),!_.isNaN(Number(a))&&_.isFinite(Number(a))&&(a=XLSX.SSF.format(e,Number(a)),o)&&(a=Ea._hideTrailingZeroes(a))):a=_.isFunction(u.isValid)&&!u.isValid()?_.escape(u):r||l?u.formatNano(e,{trim:!1,trimNano:!1}):u.formatNano(e);break;default:a=t.toString()}return a},Ea._applyDefaultFormat=function(t,e,n,i,o){var s=t.toString(),a=null;return Fs.Tools.isKDBTemporal(t)&&(a=Fs.Tools.convertKDBTemporalToMoment(t)),"DateTime"===o?"Number"===e?s=_.escape(a):a&&_.isFunction(a.format)?s=a.format():_.isFunction(t.toString)&&(s=t.toString()):"Number"===o&&i&&(s=Ea._hideTrailingZeroes(s)),s},Ea._hideTrailingZeroes=function(t){var e=t;if(0<=e.indexOf(".")){for(e[e.length-1],0;"0"===e[e.length-1];)e=e.slice(0,-1);"."===e[e.length-1]&&(e=e.slice(0,-1)),e+=""}return e},Fs.RawDataFormatter=Ea,Ys=A=A||{},Ma.getFormData=function(s,t,a,r){var e=[],l=[];e.push(_.map(t,function(t,e){t=t.colName||t.colId;return s.length||(l[e]={isStringType:!1,format:"",type:"String"}),{formattedVal:t,value:t,type:"String"}}));for(var u=0;u<s.length;u++){var c=[];_.each(t,function(t,e){var n,i,o=s[u][t.colId];null!=o?(i=Ma.generateExportData(t,o,e,a,l,r),null!=(n=null==t?void 0:t.template)&&n.trim()&&null!=t&&t.formatter&&null!=t&&t.columnConfig&&!t.isRawFormat&&(n=t.formatter(u,e,o,t.columnConfig,s[u],void 0,!1),(o=document.createElement("div")).innerHTML=n,n=o.textContent||"",i.formattedVal=n,l[e].isStringType=!0,l[e].type="String"),c.push(i)):(l[e]=l[e]||{isStringType:!1,format:t.dataFormat,type:t.dataType},c.push({formattedVal:"",value:"",type:null}),console.log("Cell value is either undefined or null: "+t.colId))}),e.push(c)}return{data:e,columnHeaders:l}},Ma.generateExportData=function(t,e,n,i,o,s){var a,r=t.dataFormat,l=t.dataKdbType,u=t.dataType,c=t.hideTrailingZeroes,p=t.prefix,t=t.suffix,d={},h=Ma.checkIfFormatXLSXCompatible(r,s),h=!("Boolean"===u||r&&h);return o[n]=o[n]||{isStringType:!1,format:r,type:u},""!==e?(l=Ys.RawDataFormatter.applyFormatToValue(e,r,u,l,c),"csv"===i&&/^[-\+=@]/.test(l)&&(l="'"+l),h?(d={formattedVal:l,value:p+l+t},o[n].type="Text"===u?"Text":"String"):"Boolean"===u?d={formattedVal:l,value:"true"===l}:"Number"===u&&"%"===t?(a=0<(h=100*Number(e))-Math.floor(h)?h.toFixed(2):h.toFixed(0),l=h+"%",r=-1!==a.indexOf(".")?"0.00%":"0%",16<a.length&&(o[n].isStringType=!0),d={formattedVal:l,value:Number(e),format:r}):_.includes(["Date","Time","DateTime","Boolean"],u)||!p&&!t?d=Ma._convertToExportFormat(n,l,e,u,r,i,c,o,s):(d={formattedVal:l,value:p+l+t},o[n].type="String")):d={formattedVal:"",value:"",type:"String"},d},Ma.checkIfFormatXLSXCompatible=function(t,e){return!(e?Ma.EXCEL_INCOMPATIBLE_FORMATS_PRESERVE_KDB_TYPES:Ma.EXCEL_INCOMPATIBLE_FORMATS).includes(t)&&!t.includes(".SSS")},Ma._convertToExportFormat=function(t,e,n,i,o,s,a,r,l){var u,c,p={format:void 0,formattedVal:e,value:"",type:void 0};switch("Number"===i&&(isNaN(Number(n))||!_.isFinite(Number(n))?p.type=i="String":_.isString(e)&&16<e.length&&(i="String",r[t].isStringType=!0)),i){case"Number":a&&!/[%]/.test(o)&&(c=(c=-1!==e.indexOf(".")?e.split(".")[1].length:0)?"."+Array(c+1).join("0"):"",(c=(-1!==o.indexOf(".")?o.split(".")[0]:o)+c)!==o)&&(p.format=c),u=Number(n);break;case"Date":"csv"!==s&&h.utc(e,o).isValid()&&"Invalid date"!==h.utc(e,o).format()?u=h.utc(e,o).format():"csv"===s?(u=e,r[t].type="String"):(u=e,r[t].isStringType=!0);break;case"Time":l?(u=Ma.convertToExcelTime(e,o),r[t].type="Time"):u=e;break;case"DateTime":u=e,r[t].type="String";break;case"Text":l&&(r[t].type="Text"),u=e;break;default:u=e}return p.value=u,p},Ma.convertToExcelTime=function(e,n){try{var t=e.split(":"),i=0;if("HH:mm"===n||"HH:mm:ss"===n)var o=t[0],s=t[1],a=t[2],r=void 0===a?"0":a,l=parseInt(o,10),u=parseInt(s,10),c=0,i=3600*l+60*u+(c=3===t.length?parseInt(r,10):c);else if("mm:ss"===n){s=t[0],r=t[1];i=60*(u=parseInt(s,10))+(c=parseInt(r,10))}else{if("ss"!==n)return e;i=parseInt(t[0],10)}return i/86400}catch(t){return console.warn("Time parsing error:",{rawValue:e,format:n,err:t}),e}},Ma.EXCEL_INCOMPATIBLE_FORMATS_PRESERVE_KDB_TYPES=(Ma.EXCEL_INCOMPATIBLE_FORMATS=["","SmartNumber","SmartNumber.0","SmartNumber.00","SmartNumber.000","SmartNumber.0000","SmartNumber.00000","SmartNumber.000000","SmartNumber.0000000","SmartNumber.00000000","SmartNumber.000000000","SmartNumber.0000000000","HH:mm","HH:mm:ss","HH:mm:ss.SSS","HH:mm:ss.SSSSSS","HH:mm:ss.SSSSSSSSS","YYYY-MM-DD HH:mm:ss.SSS","YYYY-MM-DD HH:mm:ss.SSSSSS","YYYY-MM-DD HH:mm:ss.SSSSSSSSS","mm:ss","mm:ss.SSS","Mm:ss.SSSSSS","mm:ss.SSSSSSSSS","ss","ss.SSS","ss.SSSSSS","ss.SSSSSSSSS"]).filter(function(t){return"HH:mm"!==t&&"HH:mm:ss"!==t&&"mm:ss"!==t&&"ss"!==t}),Ys.FileExportDataGenerator=Ma,i=A=A||{},Hs=i.DialogBase,e(Pa,Hs),Pa.prototype.dialogButtons=function(){var t=this;return[{text:"OK",click:function(){t.options&&(t.options.showLoading?(t.showLoadingSpinner(),_.defer(function(){t.dialogClose()})):t.dialogClose())},icon:"fa fa-check"},{text:"Cancel",click:function(){t.isCancel=!0,t.dialogClose()},icon:"fa fa-times"}]},Pa.prototype.postRender=function(){var e=this;this.$("input").val(this.options.inputValue),this.$("input").on("input",function(t){e.options.inputValue=e.inputValue=$(t.target).val()})},Pa.prototype.renderTemplate=function(){return t("<span>what?</span><input>")},Pa.prototype.showLoadingSpinner=function(){var t=this.$dialogButtonpane.find("span.fa.fa-check");t.removeClass("fa-check"),t.addClass("fa-spinner fa-pulse")},Pa.ShowInput=function(e,n,i,o,s,a,r){return new Pa(_.extend({iconClass:o,dialogTitle:n,callback:e,inputValue:s,userClass:a,showLoading:r},i?{renderTemplate:function(){return t("<div>"+i+"</div><input style='width: 100%; box-sizing: border-box;'>")}}:{}))},i.SimpleInputDialog=Pa,Ks=A=A||{},Ia.prototype.createExportOfCurrentData=function(n){var i,o,s=this,t=s.configSets,e=s.dataSet,a=s.metaData,r=[],l={SheetNames:[],Sheets:{}},u=s.bookType,c=null==s?void 0:s.isPreserveKDBTypes,p=",";t&&_.keys(t).length?_.each(t,function(t){r.push(Ks.FileExportDataGenerator.getFormData(t.dataSet,t.metaData,u,c))}):e&&e.length&&a&&a.length&&(r[0]=Ks.FileExportDataGenerator.getFormData(e,a,u,c)),r.length&&r[0].data.length?(_.each(r,function(t,e){var n=s.workSheetTitle||"Work_sheet";n+=1<r.length?"_"+e:"",e=s.convertDataToWorksheet(t.data,t.columnHeaders),l.SheetNames.push(n),l.Sheets[n]=e}),"csv"!==u?(i=XLSX.write(l,{bookType:u,bookSST:!1,type:"binary",cellDates:!0}),t=Ia.s2ab(i),s.downloadExportFile(n,t)):(o=1,s.csvExportDelimiter&&s.csvExportDelimiter.length&&(p=s.csvExportDelimiter),_.each(l.Sheets,function(t){var e=1<r.length?n.slice(0,-4)+"part"+o+".csv":n;try{i=XLSX.utils.sheet_to_csv(t,{FS:p}),s.onTransferAction(s.actions,"success",n)}catch(t){return s.onTransferAction(s.actions,t,n),void console.log("Error",t)}0===i.indexOf("ID")&&(/[-\+\{\}\[\]\?\^\*\.\|\$]/.test(p)&&(p="\\"+p),t=new RegExp("(ID[^"+p+"\n]*)"),i=i.replace(t,'"$1"')),s.downloadExportFile(e,i),o+=1}))):(s.onTransferAction(s.actions,e="Data formatter function returned invalid parameter or no data",n),console.error(e))},Ia.prototype.downloadExportFile=function(t,e){var n,i,o="application/octet-stream",s=document.createElement("a");window.Blob?(n=new Blob([e],{type:o}),window.navigator.msSaveOrOpenBlob?s.onclick=function(){window.navigator.msSaveOrOpenBlob(n,t)}:void 0!==s.download&&s.setAttribute("href",URL.createObjectURL(n)),i=this.humanFileSize(n.size)):s.setAttribute("href",encodeURI(o+","+e)),void 0!==s.download&&s.setAttribute("download",t),document.body.appendChild(s),s.click(),document.body.removeChild(s),this.onTransferAction(this.actions,"success",t,i)},Ia.prototype.humanFileSize=function(t,e,n){void 0===n&&(n=1);var i=(e=void 0===e?!0:e)?1e3:1024;if(Math.abs(t)<i)return t+" B";for(var o=e?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],s=-1,a=Math.pow(10,n);t/=i,++s,Math.round(Math.abs(t)*a)/a>=i&&s<o.length-1;);return t.toFixed(n)+" "+o[s]},Ia.prototype.onTransferAction=function(t,i,o,s){var a=this,r=this.dataSet,l=this.metaData;"ChartGL"===this.workSheetTitle&&(r=_.get(this,"configSets.chartGLExport.dataSet"),l=_.get(this,"configSets.chartGLExport.metaData")),_.each(t,function(t){var e=_.get(t,"EventType"),n="success"===i,e="all"===e||"onSuccess"===e&&n||"onFail"===e&&!n;_.get(t,"Result.attributes")&&e&&t.Result.set("value",{component:a.workSheetTitle,dashboard:a.selectedDashboard,fileRowLength:r?r.length:"na",fileMetaData:_.isNil(l)?"na":l,fileName:o,fileType:a.bookType,isSuccess:n,status:i,timestamp:Date.now(),username:Ks.DeltaClientLib.username,size:s})})},Ia.prototype.showDialog=function(){var e=this,n=e.fileFormat,i={".csv":"Csv",".xlsx":"Excel"}[n],o=e.fileName+n;Ks.SimpleInputDialog.ShowInput(function(){var t=this.inputValue;t=(t=""+t||Ks.ExportTools.getDefaultExportFileName(i,!0)).replace(/:/g,"-").replace(/[^\w \.\-]/g,""),new RegExp(n+"$").test(t)||(t+=n),e.createExportOfCurrentData(t)},t("Export file"),t("Please enter the filename"),"fa fa-download",o,"",!0)},Ia.prototype.convertDataToWorksheet=function(t,e){for(var n={},i={s:{c:1e7,r:1e7},e:{c:0,r:0}},o=0;o!=t.length;++o)for(var s=0;s!=t[o].length;++s){i.s.r>o&&(i.s.r=o),i.s.c>s&&(i.s.c=s),i.e.r<o&&(i.e.r=o),i.e.c<s&&(i.e.c=s);var a=t[o][s],r=(void 0!==a.type&&""!==a.type?a:e[s]).type,l=a.format||e[s].format,u={};if(null!==r){e[s].isStringType&&(r="String",a.value=a.formattedVal||a.value);var c=XLSX.utils.encode_cell({c:s,r:o});switch(r){case"Number":l?(u.t="n",u.z=l):u.t="s";break;case"Boolean":u.t="b";break;case"Date":case"DateTime":u.t="d",u.z=l;break;case"Time":this.isPreserveKDBTypes?(u.t="n",u.z="HH:mm"===l?"[hh]:mm":"HH:mm:ss"===l?"[hh]:mm:ss":"mm:ss"===l?"[mm]:ss":"ss"===l?"[ss]":l):u.t="s";break;case"Text":this.isPreserveKDBTypes&&(u.z="@"),u.t="s";break;default:u.t="s"}u.s={alignment:{horizontal:"top"}},u.v=a.value,n[c]=u}}return i.s.c<1e7&&(n["!ref"]=XLSX.utils.encode_range(i)),n},Ia.s2ab=function(t){for(var e=new ArrayBuffer(t.length),n=new Uint8Array(e),i=0;i!=t.length;++i)n[i]=255&t.charCodeAt(i);return e},Ks.FileExport=Ia,Qs=A=A||{},zs=f.View,e(Aa,zs),Aa.prototype.initializeEvents=function(){this.listenTo(this.appViewModel,"change:"+this.EXPORT_PROPERTY_OBJECT+this.EXPORT_PROPERTY_KEYS.concat(" change:"+this.EXPORT_PROPERTY_OBJECT),this.displayChoiceLinkButtons),this.$lnkCsvExport.click(_.bind(this.fileExport,this,".csv")),this.$lnkExcelExport.click(_.bind(this.fileExport,this,".xlsx")),this.$lnkFullExport.click(_.bind(this.apiExport,this)),this.$lnkDownloadScreenshot.click(_.bind(this.downloadImage,this))},Aa.prototype.apiExport=function(){var e=this,n=this.getExportConfig(),n=Qs.ExportTools.getExportFileName(n.fileName,n.altFileName,"FullExport"),i=$("<span></span>").addClass("export-spinner fa fa-spinner fa-pulse").attr("title",t("Download in progress")).appendTo(this.$lnkFullExport);e.$lnkFullExport.addClass("export-in-progress"),e.api.exportData(this.appViewModel.get(e.DATA_SOURCE_PROPERTY),function(){i.remove(),e.$lnkFullExport.removeClass("export-in-progress")},{exportName:n})},Aa.prototype.displayChoiceLinkButtons=function(){var t=!1,e=!1,n=this.appViewModel.get(this.EXPORT_PROPERTY_OBJECT);n&&(n.changed&&(t=!0),this.api.hasPermission(Qs.CustomAPIPermission.canExportData)&&(n.ShowExportCsvButton||n.ShowExportExcelButton||n.ShowFullExportButton||n.ShowScreenshot&&!this.isIE)?(this.$lnksExport.hasClass("link-disabled")&&t&&(e=!0),this.$lnksExport.removeClass("link-disabled"),this.$lnkCsvExport.toggleClass("link-disabled",!n.ShowExportCsvButton),this.$lnkExcelExport.toggleClass("link-disabled",!n.ShowExportExcelButton),this.$lnkFullExport.toggleClass("link-disabled",!n.ShowFullExportButton),this.$lnkDownloadScreenshot.toggleClass("link-disabled",!(n.ShowScreenshot&&!this.isIE)),this.trigger("enable-links")):(this.$lnksExport.addClass("link-disabled"),t&&(e=!0),this.trigger("disable-links")),e)&&this.trigger("redraw-chart")},Aa.prototype.downloadImage=function(){var e=this,n=this.getFileName(),n=_.isString(n)&&n.length?n:"Screenshot";n+=".png";var i=this.appViewModel.get(this.EXPORT_PROPERTY_OBJECT).ScreenshotButton;this.generateImage(function(t){-1<i.indexOf("Export Png")&&Qs.Tools.fileSave(n,t),-1<i.indexOf("Copy to Clipboard")&&t&&Qs.Tools.copyToClipboard(t,"Bipartite Chart",e.api)})},Aa.prototype.generateImage=function(t,e){void 0===e&&(e=3);var n,i=this.getSvgNode(),o=i.getBoundingClientRect(),s=Math.round(o.width),a=Math.round(o.height),r=s*e,l=a*e,u=document.createElement("canvas"),c=u.getContext("2d"),p=new Image,o=(u.width=r,u.height=l,u.style.width="".concat(s,"px"),u.style.height="".concat(a,"px"),function(t){var t=function(t){for(var e=t,t=t.cloneNode(!0),n=(t.style.cssText=d(e),e.getElementsByTagName("*")),i=t.getElementsByTagName("*"),o=n.length;o--;){var s=n[o];i[o].style.cssText=d(s)}return t}(t),e=(new XMLSerializer).serializeToString(t);if(e=(e=(e=e.replace(/<svg([^>]*?)>/,'<svg$1 width="'.concat(r,'" height="').concat(l,'" viewBox="0 0 ').concat(s," ").concat(a,'">'))).replace(/(\w+)?:?xlink=/g,"xmlns:xlink=")).replace(/NS\d+:href/g,"xlink:href"),/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor))for(var n=void 0;n=/(<rect[^>]*) style="[^>]*"([^>]*>)/.exec(e);)e=e.replace(n[0],n[1]+n[2]);return e}(i));function d(t){var n=document.defaultView.getComputedStyle(t,"");try{return n.cssText||Array.from(n).reduce(function(t,e){return t+e+": "+n[e]+"; "},"").trim()}catch(t){return""}}this.isIE?alert("This feature is not supported in your browser"):(c.clearRect(0,0,r,l),c.fillStyle=function t(e){var n=document.defaultView.getComputedStyle(e)["background-color"];return/^rgb\(/.test(n)?n:t(e.parentNode)}(i),c.fillRect(0,0,r,l),e=new Blob([o],{type:"image/svg+xml;charset=utf-8"}),n=URL.createObjectURL(e),p.onload=function(){URL.revokeObjectURL(n),c.drawImage(p,0,0,r,l),u.toBlob(t)},p.onerror=function(t){console.error("Error loading SVG for export",t),URL.revokeObjectURL(n)},p.src=n)},Aa.prototype.getButtonSettings=function(){},Aa.prototype.getFileName=function(){var t=this.getExportConfig(),e="";return e=_.isObject(t)&&(_.isArray(t.fileName)&&t.fileName.length||t.altFileName)?Qs.ExportTools.getExportFileName(t.fileName,t.altFileName,""):e},Aa.prototype.remove=function(){return this.$lnkCsvExport.off(),this.$lnkExcelExport.off(),this.$lnkFullExport.off(),this.$lnkCopyScreenshot.off(),this.$lnkDownloadScreenshot.off(),f.View.prototype.remove.apply(this,arguments)},Aa.prototype.showExportError=function(t){t=t||"Export of .csv or .xlsx for pivot charts is not supported.";Qs.ErrorDialog.ShowError(t)},qe=Aa,(Qs.FileExporterView=qe).prototype.SETTINGS=["api","appViewModel"],Ws=A=A||{},ka.resolveChartColumnFormatAndType=function(t,e,n){var i=ka.CHARTS_DATA_FORMAT_MAP[e],o=!!ka.CHARTS_DATE_FORMAT_MAP[i],s=8===n||9===n,a=11<n&&n<20,r=3<n&&n<10;return 3===n||n<1||19<n?(n=11,i="TO_STRING",t="String"):void 0===(i=o||s||-1===i.indexOf(".")?i:i.split(".")[0])?(console.log("Invalid format: "+i+" or kdbType: "+n+". Exporting with default formats as String type"),i="",t="String"):("String"===t?i="":(!a||"Number"!==t&&o)&&(a||!o&&"Date"!==t)?"Number"!==t||r||(t="String"):(t="String",i="",console.log("!ExportTools format mismatch, using default format.Params, value kdbType : "+n+", col type: "+t+", format: "+e)),"Date"===t&&o&&(t=ka.getTemporalTypeFromFormat(i)),0===i.indexOf("SmartNumber")&&(t="String")),{dataType:t=1===n?"Boolean":t,dataFormat:i,dataKdbType:n}},ka.getExportFileName=function(t,e,n){return t=(t=(t=t&&_.isObject(t)?_.map(t,function(t){t=t.FileNamePart;return(t=null!==t&&!_.isObject(t)?t:"").toString()}).join(""):t)?ka.getDefaultExportFileName(t,!0):e||ka.getDefaultExportFileName(n,!1)).replace(/:/g,"-").replace(/[^\w \.\-]/g,"")},ka.getDefaultExportFileName=function(t,e){function n(t){return t=1===(t=""+t).length?"0"+t:t}var i=new Date,o=i.getMonth()+1,s=i.getDate(),a=i.getHours(),r=i.getMinutes(),l=i.getSeconds();return e?t.replace(/{{now}}/g,i.getFullYear()+n(o)+n(s)+"_"+n(a)+n(r)+n(l)):(t?t+"_":"")+i.getFullYear()+n(o)+n(s)},ka.onQueryChange=function(e,n){var i;e&&(i=e.get("_dataType"),e=e.get("_subscriptionType"),"virtual"===i||"streaming"===e?(n.toggleClass("events-disabled",!0),n.attr("title",t("Full export is not supported in Virtual and Streaming queries"))):(n.toggleClass("events-disabled",!1),n.attr("title",t("Download the full dataset from the server"))))},ka.openFileExportDialog=function(t){var e,n={};try{if(!(4<=_.keys(t).length))throw"Incorrect number of FileExport parameters expected 5, got: "+t.length;if(t.configSets&&_.keys(t.configSets).length)n.configSets=t.configSets;else{if(!(t.dataSet&&_.isArray(t.dataSet)&&_.isObject(t.dataSet[0])))throw"Missing or invalid dataSet parameter";if(n.dataSet=t.dataSet,!t.metaData||!_.isArray(t.metaData))throw"Missing or invalid metaData parameter";if(e=t.metaData,!_.every(e,function(t){var e=0===_.difference(_.keys(t),["colId","dataType","dataKdbType","dataFormat","hideTrailingZeroes","prefix","suffix","template","columnConfig","formatter","isRawFormat","colName"]).length,t=0<t.dataKdbType&&t.dataKdbType<20&&3!==t.dataKdbType;return e&&t}))throw"Invalid metaData properities.";n.metaData=t.metaData}if(void 0===t.fileFormat||!_.isString(t.fileFormat)||!_.includes([".xlsx",".xls",".csv"],t.fileFormat))throw"Invalid file format property";if(n.fileFormat=t.fileFormat,void 0===t.fileName||!_.isString(t.fileName))throw"Invalid file name property";if(n.fileName=t.fileName,void 0===t.workSheetTitle||!_.isString(t.workSheetTitle))throw"Invalid workSheetTitle property";n.workSheetTitle=t.workSheetTitle,void 0!==t.csvExportDelimiter&&_.isString(t.csvExportDelimiter)&&(n.csvExportDelimiter=t.csvExportDelimiter),n.actions=t.actions||[],n.selectedDashboard=t.selectedDashboard||{},n.isPreserveKDBTypes=void 0!==t.isPreserveKDBTypes?t.isPreserveKDBTypes:void 0,new Ws.FileExport(n).showDialog()}catch(t){console.error("FileConverterTools validation error: ",t)}},ka.getTemporalTypeFromFormat=function(t){var e,n="";return t&&(e=!!/[M,Y,D,d,Q]/.test(t),t=!!/[H,h,k,m,S,s]/.test(t),e?n=t?"DateTime":"Date":t&&(n="Time")),n},ka.regExValidateColumnIDs=function(t,e){var t=t.startsWith("/")&&t.endsWith("/")?t.substring(1,t.length-1):"^"+t.replace(/\*/g,"(.*)")+"$",n=new RegExp(t);return _.filter(e,function(t){return t.match(n)})},ka.FileExporterView=Ws.FileExporterView,ka.CHARTS_DATETIME_FORMAT_MAP={"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD HH:mm:ss","YYYY-MM-DD hh:mm:ss":"YYYY-MM-DD hh:mm:ss","YYYY-MM-DD kk:mm:ss":"YYYY-MM-DD kk:mm:ss","YYYY-MM-DD HH:mm:ss.SSS":"YYYY-MM-DD HH:mm:ss.SSS","YYYY-MM-DD HH:mm:ss.SSSSSS":"YYYY-MM-DD HH:mm:ss.SSSSSS","YYYY-MM-DD HH:mm:ss.SSSSSSSSS":"YYYY-MM-DD HH:mm:ss.SSSSSSSSS"},ka.TIME_FORMAT_MAP={"HH:mm":"HH:mm","HH:mm:ss":"HH:mm:ss","hh:mm:ss":"hh:mm:ss","kk:mm:ss":"kk:mm:ss","hh:mm:ss.SS":"hh:mm:ss.SS","HH:mm:ss.SSS":"HH:mm:ss.SSS","HH:mm:ss.SSSSSS":"HH:mm:ss.SSSSSS","HH:mm:ss.SSSSSSSSS":"HH:mm:ss.SSSSSSSSS","mm:ss":"mm:ss","kk:mm":"kk:mm","mm:ss.SS":"mm:ss.SS","mm:ss.SSS":"mm:ss.SSS","mm:ss.SSSSSS":"mm:ss.SSSSSS","mm:ss.SSSSSSSSS":"mm:ss.SSSSSSSSS",ss:"ss","ss.SSS":"ss.SSS","ss.SSSSSS":"ss.SSSSSS","ss.SSSSSSSSS":"ss.SSSSSSSSS"},ka.DATE_FORMAT_MAP={"YYYY-MM-DD":"YYYY-MM-DD","DD.MM.YYYY":"DD.MM.YYYY","YYYY-MMM-DD":"YYYY-MMM-DD","YYYY-MMMM-DD":"YYYY-MMMM-DD","YYYY-MM":"YYYY-MM","YYYY-MMM":"YYYY-MMM","YYYY-MMMM":"YYYY-MMMM","MM/DD/YYYY":"MM/DD/YYYY","DD/MM/YYYY":"DD/MM/YYYY","D/M/YYYY":"D/M/YYYY","M/D/YYYY":"M/D/YYYY","D/M/YY":"D/M/YY","M/D/YY":"M/D/YY","D MMM":"D MMM","D MMM YYYY":"D MMM YYYY","MMM D":"MMM D","MMM DD":"MMM DD","MMM Do":"MMM Do","MMM D, YYYY":"MMM D, YYYY","MM/YYYY":"MM/YYYY","M/YY":"M/YY","MMM YYYY":"MMM YYYY"},ka.CHARTS_DATE_FORMAT_MAP=_.extend({},ka.DATE_FORMAT_MAP,ka.TIME_FORMAT_MAP,ka.CHARTS_DATETIME_FORMAT_MAP),ka.CHARTS_NUMBERS_FORMAT_MAP={"no decimal":"0","No Decimal Point":"0",0:"0",1:"#0.0","1 decimal":"#0.0","1 Decimal Points":"#0.0",2:"#0.00","2 decimal":"#0.00","2 Decimal Points":"#0.00",3:"#0.000","3 decimal":"#0.000","3 Decimal Points":"#0.000",4:"#0.0000","4 decimal":"#0.0000","4 Decimal Points":"#0.0000",5:"#0.00000","5 Decimal Points":"#0.00000",6:"#0.000000","6 Decimal Points":"#0.000000","no decimal + seperator":"#,##0","1 decimal + seperator":"#,##0.0","2 decimal + seperator":"#,##0.00","3 decimal + seperator":"#,##0.000","4 decimal + seperator":"#,##0.0000","Smart Number":"SmartNumber",Logarithmic:"","no format":""},ka.CHARTS_DATA_FORMAT_MAP=_.extend({},ka.CHARTS_DATE_FORMAT_MAP,ka.CHARTS_NUMBERS_FORMAT_MAP),Ws.ExportTools=ka,Ye=A=A||{},xa.buildDocumentSync=function(i,o){return function(t,e,n){if(e.get("isDemo"))o.apply(e,[t,e,n]);else switch(t){case"read":i.read(e.get("id")).then(function(t){n.success&&n.success(t)});break;case"update":e.set("thumb",e.get("thumb")?e.get("thumb"):""),e.get("notSavedYet")?(delete e.attributes.notSavedYet,i.create(e.attributes).then(function(t){n.success&&n.success(t)})):i.update(e.attributes).then(function(t){n.success&&n.success(t)});break;case"delete":i.delete(e.get("id")).then(function(t){n.success&&n.success(t)});break;default:throw"data operation not supported for Document"}}},xa.buildDocumentCollectionSync=function(i){return function(t,e,n){if("read"!==t)throw"data operation not supported for DashCollection";i.readAll().then(function(t){n.success&&n.success(t.map(function(t){return t.data||t}))})}},Ye.DocumentSyncHelpers=xa,Ke=(Ke=A=A||{}).Dash||(Ke.Dash={}),Na.convertMetaToAssemblyInfo=function(t){var n=_.cloneDeep(t),i=_.keys(_.get(n,"rc[0].labels[0]",{})),o=(0===n.api.length&&(n.assembly.push({assembly:Na.GETDATA_API_DUMMY_ASSEMBLY_NAME}),n.api=_.cloneDeep(Na.GETDATA_API_SNAPSHOT),n.api[0].isMissing=!0),Na.addTimeRangeParams(n.api));return Na.addPreviewAPI_limitParamValue(o),Na.addScopeParam(o),Na.addAggFnParam(o),_.map(n.assembly,function(t){var e=t.assembly;return{confirmPassword:"",database:"",dapInstances:_.map(_.filter(n.dap,function(t){return t.assembly===e}),"instance"),dbtype:"json",host:"",name:e,databaseName:t.kxname||e.replace(/-qe$/,""),password:"",port:"",tls:"",type:"api",user:"",tableSchemas:_.keyBy(_.filter(n.schema,function(t){return _.includes(t.assembly,e)}),"table"),assemblyLabels:_.pick(t,i),api:o}})},Na.addAggFnParam=function(t){_.each(t,function(t){!_.includes([".kxi.getData",".kxi.ping",".kxi.preview"],t.api)&&_.isArray(_.get(t,"metadata.params"))&&t.metadata.params.push({name:"aggFn",type:-11,isReq:!1,description:"Agg function (optional)"})})},Na.addScopeParam=function(t){_.each(t,function(t){!_.includes([".kxi.ping",".kxi.preview"],t.api)&&_.isArray(_.get(t,"metadata.params"))&&(t=t.metadata.params,_.find(t,{name:"scope"})||t.push({name:"scope",type:-99,isReq:!1,description:"Provides a distinguished request parameter that is used in routing decisions"}))})},Na.addTimeRangeParams=function(t){return _.each(t,function(t){!_.includes([".kxi.getData",".kxi.ping",".kxi.preview"],t.api)&&_.isArray(_.get(t,"metadata.params"))&&t.metadata.params.unshift({name:"startTS",type:-12,isReq:!1,description:"Inclusive start time for period of interest."},{name:"endTS",type:-12,isReq:!1,description:"Exclusive end time for period of interest."})}),t},Na.addPreviewAPI_limitParamValue=function(t){var e=_.find(t,{api:".kxi.preview"});return e&&(e=_.find(e.metadata.params,{name:"limit",type:-7}))&&(e.value=(e.default||1e3).toString()),t},Na.getAvailableTableNames=function(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=!1);var i=[];return(t||[]).forEach(function(t){_.each(t.tableSchemas,function(t,e){i.push(e),n&&t.columns.forEach(function(t){return i.push(t.column)})})}),e?i.reduce(function(t,e){return t[e]=e,t},{}):i},Na.GETDATA_API_DUMMY_ASSEMBLY_NAME="GETDATA_API_DUMMY_ASSEMBLY",Na.GETDATA_API_SNAPSHOT=[{api:".kxi.getData",aggFn:".sgagg.getData",custom:!1,full:!0,metadata:{description:"Get timeseries and splayed data from data access processes.",params:[{name:"table",type:-11,isReq:!0,description:"Table to select from."},{name:"startTS",type:-12,isReq:!1,description:"Inclusive start time for period of interest."},{name:"endTS",type:-12,isReq:!1,description:"Exclusive end time for period of interest."},{name:"filter",type:0,isReq:!1,default:"",description:"Custom filter."},{name:"groupBy",type:[-11,11],isReq:!1,default:"",description:"Column(s) to determine aggregation grouping"},{name:"agg",type:[-11,11,0],isReq:!1,default:"",description:"Column(s) to return or aggregations to perform (where ` returns all columns)."},{name:"sortCols",type:[-11,11],isReq:!1,default:"",description:"Column names to sort response payload on."},{name:"limit",type:[5,-5,6,-6,7,-7],isReq:!1,description:"Limit parameter."},{name:"slice",type:[18,19],isReq:!1,default:"",description:"Timerange to grab from each date in request range"},{name:"fill",type:-11,isReq:!1,default:"",description:"Fills option to apply to null data"},{name:"temporality",type:-11,isReq:!1,default:"",description:"How to interpret time range, as continuous or as slice"}],return:{type:0,description:"Triple consisting of sort columns (symbol[]), return columns (symbol[]), and table data (table)"},misc:{safe:!0},aggReturn:{type:98,description:"Returns the raze of the tables."}},procs:[]}],Ke.MetaHelpers=Na,((I=A=A||{}).CustomAPIPermission||(I.CustomAPIPermission={})).canExportData="canExportData",V.initMultiClient=function(p,e){function i(){var t=p.get("documents").get(e.get("selectedDocumentId"));return!(!t||!t.get("isDemo"))}var t,d=this,h=(V.originalGetQ||(t=I.DashClient,V.originalGetQ=t.getQueryData2.bind(t),V.originalGetA=t.runAnalytic2.bind(t)),p.get("dashEngine"));I.DashClient.getQueryData2=function(s,a,r,l,u,c,t,e,n){s!==I.Dash.DATA_SOURCE_insightsSDK&&(i()||h.isDirectMode_AND_isConnectionNotTargeting_insightsSDK(a))?V.originalGetQ(s,a,r,l,u,c,t,e,n):s===I.Dash.DATA_SOURCE_insightsSDK&&r===I.KdbQuery.testConnectionQuery?u(null,null):"kdb"===s&&r===I.KdbQuery.isSqlSupported?u({rows:[{boolean:!0}]},null):"kdb"===s&&r===I.KdbQuery.isPyKxSupported?u({rows:[{boolean:!1}]},null):r===I.KdbQuery.getTables?(h.isDirectMode()?p.get("getAssemblyInfo")(a):d.getAssemblyInfoCached(p)).then(function(t){u({rows:[I.Dash.MetaHelpers.getAvailableTableNames(t,!0)]},null)}).catch(function(t){u({rows:[{}]},null)}):(h.isDirectMode()?p.get("getAssemblyInfo")(a):d.getAssemblyInfoCached(p)).then(function(t){var n=void 0;if("q"===s||"kdb"===s){if(!a)return void c("Select a target");var n="qsql",e=I.DashClient.parametersToString(l),e=(e&&(r=r+"["+e+"]"),h.parseConnElements(a)),i=e.assembly,e=e.target,o={query:r,assembly:i,target:e}}else o="sql"===s?(n="sql",{query:r=I.DocumentDataModel.prototype.toSQLString(r,l)}):d.convertParamsToJson(t,l);p.get("getData")(a,o,n).then(function(t){if(t.error)c(t.error);else{var e=t.table;if(e)u(e,null,o);else{e=t.arrayBuffer,t=void 0;try{t=I.deserialize(e)}catch(t){throw c(t="Unsupported type"===t?"Unable to deserialize, check syntax":t),t}"sql"===n&&(t=t.values[1]),u(t,e,o)}}},function(t){c(t||"API call failed")})}).catch(function(t){c(I.Dash.DashEngine.ERROR_MSG_TARGET_DOWN)})},I.DashClient.runAnalytic2=function(s,a,r,l,u,t,e,n){i()||h.isDirectMode_AND_isConnectionNotTargeting_insightsSDK(a)?V.originalGetA(s,a,r,l,u,t,e,n):s===I.KdbQuery.getFunctions?l&&l({qtype:101},new ArrayBuffer(0)):s===I.KdbQuery.executeSql&&r&&1===r.length?I.DashClient.getQueryData2("sql",a,r[0].value,null,l,u,t,e,n):(h.isDirectMode()?p.get("getAssemblyInfo")(a):d.getAssemblyInfoCached(p)).then(function(t){var n,e=!1,i=void 0,o=void 0;"getData"===s?(e=!0,r=d.sanitizeGetDataParams(r)):"preview"===s?(e=!0,i=s):(e=_.map(_.get(t,"0.api",[]),"api").includes(s),i="api",o=s),e?(n=d.convertParamsToJson(t,r),p.get("getData")(a,n,i,o).then(function(t){var e;t.error?u(t.error):(e=t.table)?l(e,null,n):(e=t.arrayBuffer,t=(t=I.deserialize(e))instanceof I.qDict?t:t.values[1],l(t,e,n))},function(t){u(t||"ServiceGateway API call failed")})):u("api not available / supported")}).catch(function(t){u(I.Dash.DashEngine.ERROR_MSG_TARGET_DOWN)})}},V.convertParameterValue=function(t,e){return _.includes(["timestamp","datetime"],e)?t.replace("Z",""):_.includes(["timespan","time"],e)?t.substr(11).replace("Z",""):"second"===e?t.substr(11,8).replace("Z",""):"minute"===e?t.substr(11,5).replace("Z",""):t},V.replaceInlineParameters=function(t,e,n,i){void 0===i&&(i=!1);var o=e.id+V.SUBPARAMETER_SEPARATOR,s=new Map,a=(n.forEach(function(t){0===t.id.indexOf(o)&&s.set(t.id,t)}),new Map);return t=t.replace(V.SUBPARAMETER_REGEX,function(t,e){var n;return a.has(e)||(t=t,(n=s.get(o+e))&&(t=V.convertParameterValue(n.value,n.type),i)&&_.isArray(t)&&(t=JSON.stringify(t)),a.set(e,t)),a.get(e)})},V.replaceSubparameter=function(t,e,n){if(_.isString(t)){var i=Array.from(t.matchAll(V.SUBPARAMETER_REGEX));if(i.length){e=e.id+V.SUBPARAMETER_SEPARATOR+i[0][1],i=_.find(n,{id:e});if(i)return V.convertParameterValue(i.value,i.type)}}return t},V.convertParamsToJson=function(t,c){function e(t,o,r){var l=[];function u(t,e){e=o[e];{if(e){if("byte"===e)return parseInt(t);var n=t,i=n.toUpperCase().match(I.RTTI.REGEX_ROLLING);if(i||n.match(/\d\d\d\d[\.\-]\d\d[\.\-]\d\d[DT ]\d/)){if(i)switch(n=I.Helpers.convertRollingToDate(n,e),e){case"timespan":n=n.substr(11,18);break;case"time":n=n.substr(11,12);break;case"second":n=n.substr(11,8);break;case"minute":n=n.substr(11,5)}else n=_.trim(n.replace("D"," ").replace("Z","")),n=I.Tools.convertUserInputToMoment(n,void 0).toDashString();n=n.replace("T"," ").replace("Z","")}return n}return i=t,i=_.includes(["true","false","1b","0b"],i)?"true"===i||"1b"===i:i}}return _.each(t,function(t){function e(t){return V.replaceInlineParameters(t,r,c)}var n,i,o,s=t.split(/[`;]+/).filter(Boolean),a=e(s[0]);_.includes(V.ALLOWED_SQL_OPERATORS,a)?(n=e(s[1]),i=s[2],_.includes(["in","within"],a)?(s=t.match(/[\w<>=\{\}]+;[\w\- \{\}]+;(.+)/))&&s[1]&&(i=(i=s[1]).replace(/[\(\)\[\]]/g,"").split(/[ ,;`]+/),_.each(i,function(t,e){i[e]=(e=n,(t=t).match(V.SUBPARAMETER_REGEX)?V.replaceInlineParameters(t,r,c):u(t,e))}),i)&&i.length&&(i=i.join("").replace(/[\(\)\[\]]/g,"").split(/[ ,;`]+/)):(t=i,s=n,o=Array.from(t.matchAll(V.SUBPARAMETER_REGEX)),i=o.length?1<o.length?V.replaceInlineParameters(t,r,c):V.replaceSubparameter(o[0][0],r,c):u(t,s)),l.push([a,n,i])):console.warn("The SQL operator ".concat(a," is not supported."))}),l}var i={},o={},a=void 0,r=void 0,n=(_.each(c,function(e){var n,t,s;"list"===e.type?e.id===e.name&&("labels"===e.name?(_.each(e.value,function(t){t=t.split(/[:,;]/);t[0]=V.replaceInlineParameters(t[0],e,c),t[1]=V.replaceInlineParameters(t[1],e,c),o[t[0]]=t[1]||""}),_.extend(i,{labels:o})):"filter"===e.name?_.isEmpty(e.value)||(a=e.value,r=e):"agg"===e.name?_.isEmpty(e.value)||(t=e.value.map(function(t){return V.replaceInlineParameters(t,e,c)}),s=[],_.each(t,function(t){var e=t.split(/[`;]+/).filter(Boolean),n=e[0],i=e[1],o=e[2],e=e[3];_.includes(V.ALLOWED_AGG_OPERATORS,i)?s.push(e?[n,i,o,e]:[n,i,o||n]):i||o?(e='The agg parameter "'.concat(t,'" contains unsupported operator "').concat(i,'". It will not be sent to the API call.'),console.warn(e)):s.push(n)}),t=s,_.isEmpty(t))||(i[e.name]=t):"limit"===e.name?_.isEmpty(e.value)||"on"!==e.value[2]||(i[e.name]=Number(e.value[1])):_.isEmpty(e.value)||(i[e.name]=e.value.map(function(t){return V.replaceInlineParameters(t,e,c)}))):_.isNil(e.value)||""===e.value||e.id!==e.name||(t=(n=function(t){return _.isPlainObject(t)?"dict"===t.type?_.mapValues(t.value,n):V.convertParameterValue(t.value,t.type):t instanceof I.DocumentViewModel?V.convertParameterValue(t.get("value"),t.get("_type")):t})(e),"dict"===e.type&&_.isEmpty(t))||(i[e.name]=t)}),i.table);return n&&a&&(t=V.getColumnMetaToConvert(t,n,o),n=e(a,t,r),_.isEmpty(n)||(i.filter=n)),I.Log.Log("getData/UDA params",i),i},V.getAssemblyInfoCached=function(e){var t=V;return t.assemblyInfoCache=t.assemblyInfoCache||new I.Dash.AssemblyInfoCache("kdbInsightsEnterpriseConnection",function(t){return e.get("getAssemblyInfo")(null)}),t.assemblyInfoCache.getCache()},V.getColumnMetaToConvert=function(t,e,n){var i={},t=_.filter(t,function(t){return _.has(t.tableSchemas,e)});return 1===(t=1<t.length?_.filter(t,function(t){return _.find([t.assemblyLabels],n)}):t).length&&_.each(t[0].tableSchemas[e].columns,function(t){var e=V.getTypeToConvert(Math.abs(t.typ));e&&(i[t.column]=e)}),i},V.getTypeToConvert=function(t){return{4:"byte",12:"timestamp",13:"month",14:"date",15:"datetime",16:"timespan",17:"minute",18:"second",19:"time"}[t]},V.modifyAPI=function(t){var i=t.get("getAssemblyInfo"),s=t.get("getData");t.set("getAssemblyInfo",function(t,n){return void 0===n&&(n=!1),new Promise(function(e){_.isFunction(i)?i(n).then(function(t){t=I.Dash.MetaHelpers.convertMetaToAssemblyInfo(t);e(t)}):e([])})},{silent:!0}),t.set("getData",function(t,n,i,o){return new Promise(function(e,t){_.isFunction(s)?s(n,i,o).then(function(t){e({error:t.error||"",table:t.table,arrayBuffer:t.arrayBuffer})},t):e(null)})},{silent:!0})},V.sanitizeGetDataParams=function(t){return _.reject(t,function(t){return"slice"===t.id||"temporality"===t.id&&!t.value||"fill"===t.id&&!t.value})},V.upgradeDocumentDataModel=function(e){e&&"api"===e.get("_dataType")&&["_analyticParameters","_analyticParams"].forEach(function(t){t=e.get(t);t&&_.isArray(t)&&t.forEach(function(t){!["startTS","endTS"].includes(t.id)||!t.isViewState||"useRollingSyntax"in t||(t.useRollingSyntax=!0)})})},V.ALLOWED_AGG_OPERATORS=["all","any","avg","cor","count","cov","dev","distinct","first","last","max","min","prd","sdev","scov","sum","svar","var","wavg","wsum"],V.ALLOWED_SQL_OPERATORS=["in","within","<",">","like","<=",">=","=","<>","not"],V.SUBPARAMETER_REGEX=/\{\{([^{}}]+)\}\}/g,V.SUBPARAMETER_SEPARATOR=".",I.CustomAPIHelpers=V,c=A=A||{},La.print=function(t){var e=window.location.pathname.startsWith("/app-")?"/"+window.location.pathname.split("/")[1]:"",e=at(at({},t),{urlBase:"".concat(window.location.origin).concat(e,"/view/share")}),t=(_.isEmpty(t.viewState)||(e.viewState=JSON.stringify(t.viewState)),0<$(".pdf-expandable").length&&(e.documentHeight=1080,e.documentWidth=1920),"function"==typeof crypto.randomUUID?crypto.randomUUID():"".concat((new Date).getTime(),"-").concat(Math.floor(1e6*Math.random()))),t="".concat(window.location.origin,"/print/generate-pdf/").concat(t),e=btoa(JSON.stringify(e));window.open("".concat(t,"?target=").concat(e),"_blank","noopener,noreferrer,resizable")},c.EmbeddedPrintHelper=La,Gs=A=A||{},Ra.renameViewStateAttrNamedID=function(t){t.has("id")&&t.get("id")instanceof Gs.DocumentViewModel&&(t.set(Gs.DocumentViewModel.KXDASHBOARD_WITH_VIEWSTATE_NAMED_ID,t.get("id"),{silent:!0}),t.unset("id",{silent:!0}))},Ra.restoreViewStateAttrNamedID=function(t){t.has(Gs.DocumentViewModel.KXDASHBOARD_WITH_VIEWSTATE_NAMED_ID)&&(t.set("id",t.get(Gs.DocumentViewModel.KXDASHBOARD_WITH_VIEWSTATE_NAMED_ID),{silent:!0}),t.unset(Gs.DocumentViewModel.KXDASHBOARD_WITH_VIEWSTATE_NAMED_ID,{silent:!0}))},Gs.ViewStateModelHelpers=Ra,(ze=(ze=(ze=A=A||{}).Dash||(ze.Dash={})).Mode||(ze.Mode={})).Direct="Direct",ze.Delta="Delta",ze.IE="IE",n=A=A||{},js=n.Dash||(n.Dash={}),Va.prototype.changeLayout=function(n,i,o,s){var a=this.getConfig();_.forEach(na,function(t,e){e=n.find(e),t=_.get(a,t);_.isFunction(t)&&(t=t(i,o,s)),e.toggle(t)})},Va.prototype.getConfig=function(){var t=Zs;switch(this.mode){case js.Mode.Direct:t=this.mergeCfgs(Zs,ea);break;case js.Mode.Delta:t=this.mergeCfgs(Zs,Js);break;case js.Mode.IE:t=this.mergeCfgs(Zs,ta)}return t},Va.prototype.mergeCfgs=function(t,e){var n=_.cloneDeep(t);return _.forEach(e,function(t,e){_.set(n,e,t)}),n},js.DatasourceEditorLayoutManager=Va,Zs={mode:null,connection:{visible:!1,edit:{visible:!1},qeWarning:{text:"Uses the Query Environment to query data",visible:!1}},editor:{api:{visible:!1},sql:{visible:!1},kdbq:{visible:!1,target:{visible:!1}},queryGraphBuilder:{visible:!1},analytic:{visible:!1},pyKx:{visible:!1},streaming:{visible:!1},insightsStreaming:{visible:!1,editable:!1},virtual:{visible:!1}}},Js={mode:"Delta","editor.sql.visible":Ua,"editor.kdbq.visible":!0,"editor.queryGraphBuilder.visible":function(t,e,n){return t.get("isQueryGraphBuilderVisible")},"editor.analytic.visible":!0,"editor.pyKx.visible":!0,"editor.streaming.visible":!0,"editor.virtual.visible":!0},ta={mode:"IE","connection.qeWarning.text":function(t,e,n){return!(!n||!["sql","query"].includes(n.get("_dataType")))},"editor.api.visible":!0,"editor.sql.visible":!0,"editor.kdbq.visible":!0,"editor.insightsStreaming.visible":!0,"editor.insightsStreaming.editable":$a,"editor.virtual.visible":!0},ea={mode:"Direct","editor.api.visible":Oa,"editor.kdbq.visible":!0,"editor.sql.visible":(Xs=[Ua,Oa],function(e,n,i){return _.some(Xs,function(t){return t(e,n,i)})}),"editor.queryGraphBuilder.visible":Ba,"editor.analytic.visible":Ba,"editor.pyKx.visible":Ba,"editor.streaming.visible":Ba,"editor.insightsStreaming.visible":Oa,"editor.insightsStreaming.editable":$a,"editor.virtual.visible":!0},na={".lblAPI":"editor.api.visible",".lblSql":"editor.sql.visible",".lblKdb":"editor.kdbq.visible",".lblBuilder":"editor.queryGraphBuilder.visible",".lblAnalytic":"editor.analytic.visible",".lblPyKx":"editor.pyKx.visible",".lblStreaming":"editor.streaming.visible",".lblInsightsStreaming":"editor.insightsStreaming.visible",".lblVirtual":"editor.virtual.visible"},u=(u=A=A||{}).Dash||(u.Dash={}),qa.prototype.cleanup=function(){var t=Date.now();void 0!==this.cacheTimestamp&&t-this.cacheTimestamp>this.cacheCleanupIntervalMiliseconds&&this.resetCache()},qa.prototype.destroy=function(){this.stopRunningCleanupTimer(),this.resetCache()},qa.prototype.getCache=function(){var i,o=this;return this.cachedAssemblyInfo&&this.cleanup(),this.cachedAssemblyInfo?Promise.resolve(this.cachedAssemblyInfo):this.pendingAssemblyInfoPromise||(i=new Promise(function(e,n){o.getAssemblyInfo(o.connName).then(function(t){i===o.pendingAssemblyInfoPromise&&(o.cachedAssemblyInfo=t,o.pendingAssemblyInfoPromise=void 0,o.cacheTimestamp=Date.now(),o.runCleanupTimer(),e(t))}).catch(function(t){n(t)})}),this.pendingAssemblyInfoPromise=i)},qa.prototype.resetCache=function(){this.cachedAssemblyInfo=void 0,this.pendingAssemblyInfoPromise=void 0,this.cacheTimestamp=void 0},qa.prototype.runCleanupTimer=function(){var t=this;this.timeoutId=setTimeout(function(){t.cleanup()},this.cacheCleanupIntervalMiliseconds)},qa.prototype.stopRunningCleanupTimer=function(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=void 0)},ia=qa,u.AssemblyInfoCache=ia,Fa.prototype.destroy=function(){this.cacheMap.forEach(function(t){t.destroy()}),this.cacheMap.clear()},Fa.prototype.getCache=function(t){var e;return(this.cacheMap.has(t)?this.cacheMap.get(t):(e=new ia(t,this.getAssemblyInfo),this.cacheMap.set(t,e),e)).getCache()},u.MultiAssemblyInfoCache=Fa,oa=A=A||{},sa=oa.Dash||(oa.Dash={}),Object.defineProperty(O.prototype,"datasourceEditorLayoutManager",{get:function(){return this._datasourceEditorLayoutManager},enumerable:!1,configurable:!0}),Object.defineProperty(O.prototype,"mode",{get:function(){return this._mode},enumerable:!1,configurable:!0}),O.activator=function(t,e){t=new O(t,e);t.activate(),oa.DocumentDataModel.DASH_ENGINE=t},O.prototype.activate=function(){this._isActivated||(this._isActivated=!0,this.adjustAppModel())},O.prototype.adjustAppModel=function(){var t=this,e=this.appModel.attributes;e.dashEngine=this,e.dashMode=this.mode,this.mode!==sa.Mode.Delta&&(this.mode===sa.Mode.Direct&&(e.quickview?(oa.ConnectionCollection.prototype.sync=oa.DashClientLib.connectionCollectionSync,e.connections=new oa.ConnectionCollection):this.setupRouting_DashClientLib_testConnection(),this.appModel.on("change:ClientLoginTimestamp",function(){t.loadPrerequisities()})),oa.CustomAPIHelpers.initMultiClient(this.appModel,this.appViewModel),this.mode===sa.Mode.IE&&oa.CustomAPIHelpers.modifyAPI(this.appModel),this.mode===sa.Mode.Direct)&&(e.getAssemblyInfo=this.getAssemblyInfo.bind(this),e.getData=this.getData.bind(this),e.getPipelineSubscribers=this.getPipelineSubscribers.bind(this),this.initMultiAssemblyInfoCache())},O.prototype.initMultiAssemblyInfoCache=function(){var o=this;this._multiAssemblyInfoCache_ipc=new oa.Dash.MultiAssemblyInfoCache(function(t){return o.getPromise_for_insightsSDK_qIpcCall(t,O.QAPI_META)}),this._multiAssemblyInfoCache_http=new oa.Dash.MultiAssemblyInfoCache(function(n){return new Promise(function(i,e){var t=o.getConnectionHostname(n);fetch(t+"/meta",{headers:o.getFetchHeaders(!0)}).then(function(n){return rt(o,void 0,void 0,function(){var e;return lt(this,function(t){switch(t.label){case 0:return[4,n.json()];case 1:return e=t.sent().payload,e=sa.MetaHelpers.convertMetaToAssemblyInfo(e),i(e),[2]}})})}).catch(function(t){t=t instanceof Error?t.message:t;e(t)})})})},O.prototype.getPipelineSubscribers=function(t){return this.getPromise_for_insightsSDK_qIpcCall(t,O.QAPI_SUBSCRIBER_NODES)},O.prototype.getAssemblyInfo=function(t,e){return(this.useQipc_forTargeting_insightsSDK(t)?this._multiAssemblyInfoCache_ipc:this._multiAssemblyInfoCache_http).getCache(t)},O.prototype.getPromise_for_insightsSDK_qIpcCall=function(e,a,n){var i=this;return new Promise(function(o,s){var t={conid:{type:"string",value:i.parseConnElements(e).connection},api:{type:"string",value:a}};n&&(t.payload={type:"string",value:JSON.stringify(n)}),oa.DashClient.runAPI_InsightsSDK([{type:"dict",value:t}],function(t,e){var n,i,e=e.slice(t.offset,t.offset+t.length);a===O.QAPI_META?(n=oa.u16u8(new Uint8Array(e)),i=JSON.parse(n),t=sa.MetaHelpers.convertMetaToAssemblyInfo(i.payload),o(t)):a===O.QAPI_SUBSCRIBER_NODES?(n=oa.u16u8(new Uint8Array(e)),(i=JSON.parse(n))&&i.length?o(i):s(sa.DashEngine.ERROR_MSG_PIPELINES_NOT_PRESENT)):(oa.IPCisCompressed(e)&&(e=oa.IPCuncompress(e)),o({error:"",arrayBuffer:e}))},function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];s(a===O.QAPI_SUBSCRIBER_NODES?sa.DashEngine.ERROR_MSG_PIPELINES_NOT_PRESENT:t[0])})})},O.prototype.get_insightsSDK_qIpcCallName=function(t,e,n){var i;return"api"===e?(i=n,null!=t&&t.aggFn&&(t.opts={aggFn:t.aggFn},delete t.aggFn)):i={getData:".kxi.getData",sql:".kxi.sql",qsql:".kxi.qsql",preview:".kxi.preview"}[e||"getData"],i},O.prototype.getData=function(i,s,a,r){var l=this;return this.useQipc_forTargeting_insightsSDK(i)?this.getPromise_for_insightsSDK_qIpcCall(i,this.get_insightsSDK_qIpcCallName(s,a,r),s):new Promise(function(o,e){var t=[l.getConnectionHostname(i),s],n=l.fetch_getData;"sql"===a?n=l.fetch_getDataSql:"qsql"===a?n=l.fetch_getDataQSql:"api"===a?(t.push(r),n=l.fetch_getDataApi):"preview"===a&&(n=l.fetch_getDataPreview),n.apply(l,t).then(function(i){return rt(l,void 0,void 0,function(){var e,n;return lt(this,function(t){switch(t.label){case 0:return[4,i.arrayBuffer()];case 1:if(e=t.sent(),i.ok)return oa.IPCisCompressed(e)&&(e=oa.IPCuncompress(e)),o({error:"",arrayBuffer:e}),[2];throw n=oa.deserialize(e),(null==(n=oa.ipc.Parse.reshape(n.values[0],e).toLegacy().rows)?void 0:n.reduce(function(t,e){return t[e.Property]=e.Value,t},{})).ai}})})}).catch(function(t){e(t||"API call failed")})})},O.prototype.getFetchHeaders=function(t){var e={"Content-Type":"application/json"};return t||(e.Accept="application/octet-stream"),e},O.prototype.fetch_getData=function(t,e){return fetch(t+"/data",{method:"POST",headers:this.getFetchHeaders(),body:JSON.stringify(e)})},O.prototype.fetch_getDataPreview=function(t,e){return fetch(t+"/preview",{method:"POST",headers:this.getFetchHeaders(),body:JSON.stringify(e)})},O.prototype.fetch_getDataSql=function(t,e){return fetch(t+"/sql",{method:"POST",headers:this.getFetchHeaders(),body:JSON.stringify(e)})},O.prototype.fetch_getDataApi=function(t,e,n){n=n.replace(/\./g,"/");return 0!==n.indexOf("/")&&(n="/"+n),null!=e&&e.aggFn&&(e.opts={aggFn:e.aggFn},delete e.aggFn),fetch(t+n,{method:"POST",headers:this.getFetchHeaders(),body:JSON.stringify(e)})},O.prototype.fetch_getDataQSql=function(t,e){return fetch(t+"/qsql",{method:"POST",headers:this.getFetchHeaders(),body:JSON.stringify(e)})},O.prototype.loadPrerequisities=function(){this.mode===sa.Mode.Direct&&this.appModel.get("connections").fetch()},O.prototype.setupRouting_DashClientLib_testConnection=function(){var a=this,r=oa.DashClientLib.testConnection.bind(oa.DashClientLib);oa.DashClientLib.testConnection=function(t,i,e){if(t.type===oa.Dash.DATA_SOURCE_insightsSDK){var n=t.qipcport,o=t.name;if(n&&""!==n)r(t,function(){a.getPromise_for_insightsSDK_qIpcCall(o,O.QAPI_META).then(i).catch(function(t){e(t),oa.DashClientLib.deleteConnection(o)})},e);else{var n=t.port,n=("on"===t.tls?"https://":"http://")+t.host+(n?":"+n:""),s="Response with invalid format";try{fetch(n+"/meta",{headers:a.getFetchHeaders(!0)}).then(function(n){return rt(a,void 0,void 0,function(){var e;return lt(this,function(t){switch(t.label){case 0:return n.ok&&200===n.status?[4,n.json()]:[3,2];case 1:if(e=t.sent(),_.get(e,"header.api")===O.QAPI_META)return i(),[2];throw s;case 2:throw"Response status "+n.status}})})}).catch(function(t){e(t instanceof SyntaxError?s:t instanceof Error?t.message:t)})}catch(t){e("Fetch error")}}}else r(t,i,e)}},O.prototype.useQipc_forTargeting_insightsSDK=function(t){var e=!1;return e=this.mode===sa.Mode.Direct&&(t=this.parseConnElements(t).connection,t=this.appModel.get("connections").get(t))&&t.isTargeting_insightsSDK()?!(!(t=t.get("qipcport"))||""===t):e},O.prototype.getConnectionHostname=function(t){var e,n="";return this.mode===sa.Mode.Direct&&(t=this.parseConnElements(t).connection,t=this.appModel.get("connections").get(t))&&t.isTargeting_insightsSDK()&&(e=t.get("port"),n=("on"===t.get("tls")?"https://":"http://")+t.get("host")+(e?":"+e:"")),n},O.prototype.isConnectionTargeting_insightsSDK=function(t){if(t){t=this.parseConnElements(t).connection,t=this.appModel.get("connections").get(t);if(t&&t.isTargeting_insightsSDK())return!0}return!1},O.prototype.isDeltaMode=function(){return this.mode===sa.Mode.Delta},O.prototype.isDirectMode=function(){return this.mode===sa.Mode.Direct},O.prototype.isIEMode=function(){return this.mode===sa.Mode.IE},O.prototype.isDirectMode_AND_isConnectionTargeting_insightsSDK=function(t){return this.isDirectMode()&&this.isConnectionTargeting_insightsSDK(t)},O.prototype.isDirectMode_AND_isConnectionNotTargeting_insightsSDK=function(t){return this.isDirectMode()&&!this.isConnectionTargeting_insightsSDK(t)},O.prototype.parseConnElements=function(t){t=(t||"").split("|");return 2===t.length&&t.unshift(""),{connection:t[0],assembly:t[1]||"",target:t[2]||""}},O.ERROR_MSG_TARGET_DOWN="Target not available",O.ERROR_MSG_PIPELINES_NOT_PRESENT="Pipelines not present",O.QAPI_SUBSCRIBER_NODES="ws.v1.subscriber.nodes",O.QAPI_META=".kxi.getMeta",sa.DashEngine=O,A.BigInteger=ut.BigInteger;i={language:$.cookie("dashboard-language")||"en",logLevel:$.cookie("dashboard-log-level")||1,theme:$.cookie("dashboard-theme")||"kx-darkroom",viewerTheme:$.cookie("dashboard-viewer-theme")||"kx-darkroom"};return $.cookie("dashboard-language",i.language,{expires:30,path:"/;SameSite=Strict",secure:"https:"===_.get(window,"location.protocol")}),$.cookie("dashboard-log-level",i.logLevel,{expires:30,path:"/;SameSite=Strict",secure:"https:"===_.get(window,"location.protocol")}),$.cookie("dashboard-theme",i.theme,{expires:30,path:"/;SameSite=Strict",secure:"https:"===_.get(window,"location.protocol")}),$.cookie("dashboard-viewer-theme",i.viewerTheme,{expires:30,path:"/;SameSite=Strict",secure:"https:"===_.get(window,"location.protocol")}),_.extend(f.History.prototype,{decodeFragment:function(t){return t}}),A});