function k(g){var h;return function(){h&&clearTimeout(h);h=setTimeout(function(){h=void 0;g()},15E3)}}var l=console.log.bind(console,"%s",function(){function g(){}g.toString=function(){var h=new Date,g=""+h.getMilliseconds();return"INFO\t"+h.toTimeString().substring(0,8)+"."+(2===g.length?"0":"")+g+"\t"};return g}()),n;
(function(g){var h=function(){return function(b,a,d,c,e){this.v=b;this.l=a;this.query=d;this.j=c;this.m=e;this.timestamp=(new Date).getTime()}}();g.M=h;var r=function(){function b(a,d,c){this.f={};this.a=null;this.K=1;this.c=k(this.A.bind(this));this.s=c;this.o(c);this.u=a;this.i=d}b.prototype.unsubscribe=function(a){delete this.f[a];this.g(new h(4),a)};b.prototype.g=function(a,d){if(this.a&&this.a.readyState===WebSocket.OPEN){d=d||this.K++;this.f[d]=a;var c=[];a.l&&a.query&&a.m&&(c.push(a.l),c.push(a.query),
c.push(a.m));var e=24;c.forEach(function(a){e+=null===a?0:a.length});var b=new Uint8Array(e),f=new DataView(b.buffer);f.setInt32(0,1,!0);f.setInt32(4,e,!0);f.setUint8(8,0);f.setUint8(9,0);f.setInt32(10,2+c.length,!0);f.setUint8(14,250);f.setInt32(15,d,!0);f.setUint8(19,250);f.setInt32(20,a.v,!0);var p=24;c.forEach(function(a){null!==a&&(b.set(a,p),p+=a.byteLength)});this.a.send(b.buffer);this.c();return d}return 0};b.prototype.h=function(){if(this.a)try{this.a.onopen=this.a.onclose=this.a.onmessage=
function(){},this.a.close(),this.a=null}catch(a){this.a=null}};b.prototype.o=function(a){try{var d="file:"===location.protocol?"ws://localhost:10001/":("https:"===location.protocol?"wss://":"ws://")+location.host+location.pathname.replace(/modules.*worker.js/,"");"/api/ws";var c=0<=navigator.userAgent.toLowerCase().indexOf("win");l(b.b+d);this.a=c||"kxnodeflate"!==a?new WebSocket(d):new WebSocket(d,["kxnodeflate"]);this.a.binaryType="arraybuffer";this.a.onopen=this.J.bind(this);this.a.onclose=this.G.bind(this);
this.a.onerror=this.H.bind(this);this.a.onmessage=this.I.bind(this)}catch(e){l(b.b+"Create Err",e),this.i("create websocket error",e)}this.c()};b.prototype.A=function(){this.a?this.g(new h(0)):(console.log("No Def",this.s),this.o(this.s))};b.prototype.L=function(a){for(var d="",c,e,b,f=0;f<a.length;f++)switch((c=a[f])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:d+=String.fromCharCode(c);break;case 12:case 13:e=a[++f];d+=String.fromCharCode((c&31)<<6|e&63);break;case 14:e=a[++f],b=
a[++f],d+=String.fromCharCode((c&15)<<12|(e&63)<<6|(b&63)<<0)}return d};b.prototype.G=function(a){l(b.b+"Closed",a);this.u(this.a?this.a.readyState:WebSocket.CLOSED,a.reason||a.type);this.h();this.c()};b.prototype.H=function(a){l(b.b+"Error",a);this.i(a);this.h();this.c()};b.prototype.I=function(a){var d=new DataView(a.data),c=d.getInt32(15,!0),b=d.getUint8(20),m=this.f[c];m?(3!==m.v&&delete this.f[c],m.j&&(d.setFloat64(0,(new Date).getTime(),!0),m.j(d.buffer))):5===b?(this.i(this.L(new Uint8Array(a.data.slice(27)))),
this.h(),this.c()):console.log("Stray Response "+c)};b.prototype.J=function(a){l(b.b+"Open",a);this.u(this.a?this.a.readyState:WebSocket.CLOSED,a.type)};b.b="Socket ";return b}(),t=function(){function b(a){this.ports=[];this.scope=a;this.client=new r(this.F.bind(this),this.C.bind(this),a.name)}b.prototype.B=function(a){var d=this,c=a.ports[0];this.ports.push(c);var b={};c.onmessage=function(a){function f(a){(new DataView(a)).setInt32(15,e,!0);c.postMessage(a,[a]);3!==g&&delete b[e]}var e=a.data[0],
g=a.data[1];switch(g){case 1:case 2:case 3:b[e]=d.client.g(new h(g,a.data[2],a.data[3],f,a.data[4]));break;case 4:d.client.unsubscribe(b[e]);delete b[e];break;case 6:"Closing"===a.data[1]&&(Object.keys(b).forEach(function(a){return d.client.unsubscribe(b[Number(a)])}),d.ports.splice(d.ports.indexOf(c),1),c.close());break;default:debugger}};this.client&&this.client.a&&this.client.a.readyState===WebSocket.OPEN&&c.postMessage([6,WebSocket.OPEN,null])};b.prototype.C=function(a){this.ports.forEach(function(b){try{b.postMessage([5,
a||"WS Error"])}catch(c){}})};b.prototype.D=function(a){function b(a){(new DataView(a)).setInt32(15,g,!0);postMessage(a,[a]);3!==f&&delete e[g]}var c=this,e={},g=a.data[0],f=a.data[1];switch(f){case 1:case 2:case 3:e[g]=this.client.g(new h(f,a.data[2],a.data[3],b,a.data[4]));break;case 4:this.client.unsubscribe(e[g]);delete e[g];break;case 6:"Closing"===a.data[1]&&Object.keys(e).forEach(function(a){return c.client.unsubscribe(e[Number(a)])})}};b.prototype.F=function(a,b){for(var c=0;c<this.ports.length;c++)try{this.ports[c].postMessage([6,
a,b||null])}catch(e){debugger}};return b}();g.w=t})(n||(n={}));var q=new n.w(this);void 0!==this.onconnect?this.addEventListener("connect",q.B.bind(q)):(q.ports.push(this),this.onmessage=q.D.bind(q));
