define(["backbone","jqueryui","moment","purify","QuickBase","Handlebars","flatpickr","rangePlugin","confirmDatePlugin","css!./css/app.css"],function(Backbone,jqui,moment,DOMPurify,QuickBase,Handlebars,flatpickr,rangePlugin,confirmDatePlugin){var __awaiter=this&&this.__awaiter||function(t,o,l,r){return new(l=l||Promise)(function(i,e){function n(t){try{a(r.next(t))}catch(t){e(t)}}function s(t){try{a(r.throw(t))}catch(t){e(t)}}function a(t){var e;t.done?i(t.value):((e=t.value)instanceof l?e:new l(function(t){t(e)})).then(n,s)}a((r=r.apply(t,o||[])).next())})},__generator=this&&this.__generator||function(n,s){var a,o,l,r={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(i){return function(t){var e=[i,t];if(a)throw new TypeError("Generator is already executing.");for(;r;)try{if(a=1,o&&(l=2&e[0]?o.return:e[0]?o.throw||((l=o.return)&&l.call(o),0):o.next)&&!(l=l.call(o,e[1])).done)return l;switch(o=0,(e=l?[2&e[0],l.value]:e)[0]){case 0:case 1:l=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++,o=e[1],e=[0];continue;case 7:e=r.ops.pop(),r.trys.pop();continue;default:if(!(l=0<(l=r.trys).length&&l[l.length-1])&&(6===e[0]||2===e[0])){r=0;continue}if(3===e[0]&&(!l||e[1]>l[0]&&e[1]<l[3]))r.label=e[1];else if(6===e[0]&&r.label<l[1])r.label=l[1],l=e;else{if(!(l&&r.label<l[2])){l[2]&&r.ops.pop(),r.trys.pop();continue}r.label=l[2],r.ops.push(e)}}e=s.call(n,r)}catch(t){e=[6,t],o=0}finally{a=l=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}}},__spreadArray=this&&this.__spreadArray||function(t,e,i){if(i||2===arguments.length)for(var n,s=0,a=e.length;s<a;s++)!n&&s in e||((n=n||Array.prototype.slice.call(e,0,s))[s]=e[s]);return t.concat(n||Array.prototype.slice.call(e))},Tools=QuickBase.Tools,RTTI=QuickBase.RTTI,Form=Backbone.View.extend({events:{submit:function(t){this.trigger("submit",t)}},initialize:function(t){var e=this,i=(t=this.options=_.extend({resetButton:!1,submitButton:!1},t),this.schema=t.schema?_.result(t,"schema"):(n=t.model)&&n.schema?_.result(n,"schema"):e.schema?_.result(e,"schema"):{}),n=(_.extend(this,_.pick(t,"model","data","idPrefix","templateData","viewStates","base64")),this.constructor),e=(this.template=t.template||this.template||n.template,this.Fieldset=t.Fieldset||this.Fieldset||n.Fieldset,this.Field=t.Field||this.Field||n.Field,this.NestedField=t.NestedField||this.NestedField||n.NestedField,this.selectedFields=t.fields||_.keys(i)),s=this.fields={},t=(_.each(e,_.bind(function(t){var e=i[t];s[t]=this.createField(t,e)},this)),t.fieldsets||_.result(this,"fieldsets")||_.result(this.model,"fieldsets")||[e]);this.fieldsets=[];_.each(t,_.bind(function(t){this.fieldsets.push(this.createFieldset(t))},this)),this.resizeEnd=_.debounce(function(){this.validate(),this.resizeStart=!0},300)},createFieldset:function(t){t={schema:t,fields:this.fields,legend:t.legend||null};return new this.Fieldset(t)},createField:function(t,e){e={form:this,key:t,schema:e,idPrefix:this.idPrefix},this.model?e.model=this.model:this.data?e.value=this.data[t]:e.value=null,t=new this.Field(e);return this.listenTo(t.editor,"all",this.handleEditorEvent),t},handleEditorEvent:function(t,e){var i,n=e.key+":"+t;switch(this.trigger.call(this,n,this,e,Array.prototype.slice.call(arguments,2)),t){case"change":this.trigger("change",this,e);break;case"focus":this.hasFocus||this.trigger("focus",this);break;case"blur":this.hasFocus&&(i=this,setTimeout(function(){_.find(i.fields,function(t){return t.editor.hasFocus})||i.trigger("blur",i)},0));break;case"changeList":this.trigger("changeList",this)}},templateData:function(){var t=this.options;return{resetButton:t.resetButton,submitButton:t.submitButton}},onResize:function(){this.resizeStart&&_.each(this.fields,function(t){t.onResize()}),this.resizeEnd(),this.resizeStart=!1},render:function(){var n=this,s=this.fields,a=Backbone.$,t=a(a.trim(this.template(_.result(this,"templateData"))));return t.find("[data-editors]").add(t).each(function(t,e){var i=a(e),e=i.attr("data-editors");_.isUndefined(e)||(e="*"==e?n.selectedFields||_.keys(s):e.split(","),_.each(e,function(t){t=s[t];i.append(t.editor.render().el)}))}),t.find("[data-fields]").add(t).each(function(t,e){var i=a(e),e=i.attr("data-fields");_.isUndefined(e)||(e="*"==e?n.selectedFields||_.keys(s):e.split(","),_.each(e,function(t){t=s[t];i.append(t.render().el)}))}),t.find("[data-fieldsets]").add(t).each(function(t,e){var i=a(e),e=i.attr("data-fieldsets");_.isUndefined(e)||_.each(n.fieldsets,function(t){i.append(t.render().el)})}),this.setElement(t),t.addClass(this.className),this},validate:function(i){var t,n=this.fields,e=this.model,s={};return i=i||{},_.each(n,function(t){var e=t.validate(i);e&&(s[t.key]=e)}),!i.skipModelValidate&&e&&e.validate&&(e=e.validate(this.getValue()))&&((t=_.isObject(e)&&!_.isArray(e))||(s._others=s._others||[],s._others.push(e)),t)&&_.each(e,function(t,e){var i;n[e]&&!s[e]?(n[e].setError(t),s[e]=t):(s._others=s._others||[],(i={})[e]=t,s._others.push(i))}),_.isEmpty(s)?null:s},commit:function(t){var i,e={skipModelValidate:!(t=t||{}).validate,appendToBody:!1},e=this.validate(e);return e||(e=_.extend({error:function(t,e){i=e}},t),this.model.set(this.getValue(),e),i)||void 0},getValue:function(t){var e;return t?this.fields[t].getValue():(e={},_.each(this.fields,function(t){e[t.key]=t.getValue()}),e)},setValue:function(t,e){var i,n={};for(i in"string"==typeof t?n[t]=e:n=t,this.schema)void 0!==n[i]&&this.fields[i].setValue(n[i])},getEditor:function(t){var e=this.fields[t];if(e)return e.editor;throw new Error("Field not found: "+t)},focus:function(){var t;this.hasFocus||(t=this.fieldsets[0].getFieldAt(0))&&t.editor.focus()},blur:function(){var t;this.hasFocus&&(t=_.find(this.fields,function(t){return t.editor.hasFocus}))&&t.editor.blur()},trigger:function(t){return"focus"===t?this.hasFocus=!0:"blur"===t&&(this.hasFocus=!1),Backbone.View.prototype.trigger.apply(this,arguments)},remove:function(){return _.each(this.fieldsets,function(t){t.remove()}),_.each(this.fields,function(t){t.remove()}),Backbone.View.prototype.remove.apply(this,arguments)}},{editors:{}}),FormsModal=(Form.Editor=Form.editors.Base=Backbone.View.extend({MSG_CANNOT_UNCHECK_ROLLING:"Cannot remove rolling syntax while it is being used by a data source",defaultValue:null,hasFocus:!1,initialize:function(t){if((t=t||{}).model){if(!t.key)throw new Error("Missing option: 'key'");this.model=t.model,this.value=this.model.get(t.key)}else void 0!==t.value&&(this.value=t.value);void 0===this.value&&(this.value=this.defaultValue),_.extend(this,_.pick(t,"key","form"));var e=this.schema=t.schema||{};this.validators=t.validators||e.validators,this.$el.attr("id",this.id),this.$el.attr("name",this.getName()),e.editorClass&&this.$el.addClass(e.editorClass),e.editorAttrs&&this.$el.attr(e.editorAttrs),this.listenTo(this.model,"change:"+t.key,this.onModelValueChange)},getName:function(){return(this.key||"").replace(/\./g,"_")},getValue:function(){return this.value},onModelValueChange:function(t,e){try{this.setValue(e)}catch(t){console.log("BBForm on change error",t)}},setValue:function(t){this.value=t},focus:function(){throw new Error("Not implemented")},blur:function(){throw new Error("Not implemented")},commit:function(t){var i=this.validate();return i||(this.listenTo(this.model,"invalid",function(t,e){i=e}),this.model.set(this.key,this.getValue(),t),i)||void 0},validate:function(){this.$el;var e=null,i=this.model,n=this.getValue(),s=this.form?this.form.getValue():{},t=this.validators,a=this.getValidator;return t&&_.every(t,function(t){return!(e=a(t)(n,s,i))}),e},trigger:function(t){return"focus"===t?this.hasFocus=!0:"blur"===t&&(this.hasFocus=!1),Backbone.View.prototype.trigger.apply(this,arguments)},getValidator:function(t){var e=Form.validators;if(_.isRegExp(t))return e.regexp({regexp:t});if(_.isString(t)){if(e[t])return e[t]();throw new Error('Validator "'+t+'" not found')}if(_.isFunction(t))return t;if(_.isObject(t)&&t.type)return e[t.type](t);throw new Error("Invalid validator: "+t)}}),Form.editors.Checkbox=Form.editors.Base.extend({defaultValue:!1,tagName:"input",events:{click:function(t){this.trigger("change",this)},focus:function(t){this.trigger("focus",this)},blur:function(t){this.trigger("blur",this)}},initialize:function(t){Form.editors.Base.prototype.initialize.call(this,t),this.$el.attr("type","checkbox")},render:function(){return this.setValue(this.value),this},getValue:function(){return this.$el.prop("checked")},setValue:function(t){t?this.$el.prop("checked",!0):this.$el.prop("checked",!1),this.value=!!t},focus:function(){this.hasFocus||this.$el.focus()},blur:function(){this.hasFocus&&this.$el.blur()}}),!function(u){function e(r,t){var c=this;c.options=r,c.$element=u(t),c.tooltip=c.options.tooltip,c.applyTooltip=function(t,e){e.prop("title",_.isFunction(c.tooltip)?c.tooltip(t.text):t.text)},u.fn.select2.amd.require(["select2/dropdown/closeOnSelect","select2/dropdown/attachBody","select2/dropdown","select2/keys","select2/dropdown/search","select2/selection/single","select2/utils"],function(t,e,i,n,s,a,o){function l(){}i=!(l.prototype.update=function(t,e){a.prototype.update.apply(this,[e]),c.applyTooltip(e,this.$selection.find(".select2-selection__rendered"))})===r.showSearch?i:o.Decorate(i,s),i=o.Decorate(o.Decorate(i,e),t),s=o.Decorate(a,l),c.select2=c.$element.select2({ajax:r.ajax,closeOnSelect:!0,dropdownAdapter:i,matcher:r.matcher||u.fn.select2.defaults.defaults.matcher,minimumResultsForSearch:!1===r.showSearch?-1:0,selectionAdapter:s,templateResult:r.templateResult,templateSelection:r.templateSelection,theme:r.theme,width:r.width,wrapClass:"wrap"}).data("select2"),r.scrollIntoView&&c.select2.on("open",function(){!function(){__awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return[4,new Promise(function(t){return window.setTimeout(t,200)})];case 1:return t.sent(),e=c.select2.$dropdown,_.get(e,"0")&&e[0].querySelector('[aria-selected="true"]')&&e[0].querySelector('[aria-selected="true"]').scrollIntoView(),[2]}})})}()}),c.select2.$selection.find("span.select2-selection__arrow").hide(),e=u("<i />").addClass("fa fa-caret-down select2-dropdown-arrow"),c.select2.$selection.append(e),c.select2.$container.css("width",c.width),_.isFunction(r.initCallback)&&r.initCallback(c.select2)})}u.fn.extend({dashSingleSelect:function(){var t=u.extend({wrapClass:"wrap"},arguments[0]);this.each(function(){new e(t,this)})}})}(jQuery),Form.editors.Select=Form.editors.Base.extend({tagName:"select",pageSize:100,paginationThreshold:500,previousValue:"",templateResult:function(){},openDropdownOnFocus:!1,matcher:null,showSearch:null,events:{keyup:"determineChange",keypress:function(t){var e=this;setTimeout(function(){e.determineChange()},0)},change:function(t){this.trigger("change",this)},focus:function(t){this.trigger("focus",this)},blur:function(t){this.trigger("blur",this)}},initialize:function(t){if(Form.editors.Base.prototype.initialize.call(this,t),_.isObject(t)&&_.isObject(t.schema)&&!_.isUndefined(t.schema.acceptEmptyValues)&&(this.acceptEmptyValues=t.schema.acceptEmptyValues),t&&t.schema&&t.schema.enforceValue&&(this.enforceValue=t.schema.enforceValue),this.multiSelect=!!(t&&t.schema&&t.schema.multiSelect)&&t.schema.multiSelect,t&&t.schema&&t.schema.sortListBySelected&&(this.sortListBySelected=t.schema.sortListBySelected),this.modelKey=t.schema.modelKey||"SelectedValue",t&&t.schema&&_.isFunction(t.schema.matcher)&&(this.matcher=t.schema.matcher),t&&t.schema&&_.isBoolean(t.schema.showSearch)&&(this.showSearch=t.schema.showSearch),t&&t.schema&&t.schema.width&&(this.width=t.schema.width),t&&t.schema&&t.schema.tooltip&&(this.tooltip=t.schema.tooltip),t&&t.schema&&t.schema.templateResult&&(this.templateResult=t.schema.templateResult),!this.schema||!this.schema.options)throw new Error("Missing required 'schema.options'")},blur:function(){this.hasFocus&&this.$el.blur()},determineChange:function(t){var e=this.getValue();e!==this.previousValue&&(this.previousValue=e,this.trigger("change",this))},focus:function(){var t=this;this.hasFocus||(this.$el.focus(),_.defer(function(){t.openDropdownOnFocus&&t.$el.select2("open")}))},getPaginationSettings:function(o,t){var l,r=this;return o&&o.length>this.paginationThreshold?(l=r.matcher?function(t,e){return r.matcher({term:e},{text:t})}:t&&t.caseInsensitiveSort?function(t,e){return-1!==t.indexOf(e)}:function(t,e){return-1!==t.toLowerCase().indexOf(e.toLowerCase())},{ajax:{data:function(t){return{search:t.term,page:t.page||1}},transport:function(t,e,i){var n=t.data.page||1,s=t.data.search,t=(n-1)*r.pageSize,n=n*r.pageSize,a=s?_.filter(o,function(t){var e;return _.isString(t)?e=t:_.isObject(t)&&(e=t.label&&_.isFunction(t.label.toString)?t.label.toString():t.label||t.val),l(e,s)}):o;e({results:_.map(a,function(t){var e,i;return _.isString(t)?i=e=t:_.isObject(t)&&(e=t.label&&_.isFunction(t.label.toString)?t.label.toString():t.label||t.val,i=t.val),{id:i,text:e}}).slice(t,n),pagination:{more:a.length>n}})}}}):{}},getValue:function(){return"list"===this.schema.viewstateType?[this.$el.val()]:this.$el.val()},populateSelect:function(t,e){var i,n,s=this,a=this.value;if(this.availableOptions={},this.renderedOptions={},_.isString(e))t.html(e),$.each(t.find("option"),function(t,e){s.availableOptions[e.value]=e.label}),this.renderedOptions=this.availableValues;else{if(0<(i=!1===s.acceptEmptyValues?_.filter(this._getOptionsArray(e),function(t){return!(null==t.val||0===t.val.length)}):this._getOptionsArray(e)).length&&this.sortListBySelected){var e=this.model.get(this.modelKey);if(!_.isEmpty(e)){var o=this.multiSelect?_.isString(e)?[e]:e:_.isArray(e)?e:[e],e=i.length;if(!this.multiSelect&&1<o.length&&(o.length=1),o.length<e)for(var l=o.length-1;0<=l;l--)!function(e){var t=i.findIndex(function(t){return t.val===o[e]});-1<t&&i.unshift(i.splice(t,1)[0])}(l)}}i.length>this.paginationThreshold?(n=_.isArray(a)?_.filter(i,function(t){return-1!==a.indexOf(t.val)}):(n=_.find(i,{val:a}))&&[n],_.isEmpty(n)&&(n=i.slice(0,1))):n=i,e=this._arrayToHtml(n),t.html(e),_.each(i,function(t){_.isObject(t)&&t.hasOwnProperty("val")?s.availableOptions[t.val]=t.label||t.val:t.group&&t.options?_.each(t.options,function(t){s.availableOptions[t.val]=t.label||t.val}):s.availableOptions[t]=t}),_.each(n,function(t){_.isObject(t)&&t.hasOwnProperty("val")?s.renderedOptions[t.val]=t.label||t.val:s.renderedOptions[t]=t})}},getSelectedValuesForListReorder:function(t){t=_.isArray(t)?t:[t];return 1<t.length&&(t.length=1),t},preRender:function(){return this},remove:function(){return this.$el.data("select2")&&(this.$el.select2("close"),this.$el.select2("destroy")),Backbone.View.prototype.remove.apply(this,arguments)},render:function(){return this.setOptions(this.schema.options),this},renderOptions:function(n){var t,e=this,i=this.$el,s=!1;function a(e){if(e.text){var t,i=_.some(n,"group")?_.flatMap(n,"options"):n,i=_.filter(i,function(t){return t.val===e.id});if(0<i.length&&(t=i[0].Icon,i=i[0].IconColor,t))return $('<span class="'+t+'" style="color:'+i+';padding-right: 5px;"> </span><span>'+e.text+"</span>")}return e.text}this.currentOptions=n,this.populateSelect(i,n),e.schema.editorAttrs&&(s=e.schema.editorAttrs.caseInsensitiveSort,e.schema.editorAttrs.selectOnClose,e.openDropdownOnFocus=e.schema.editorAttrs.openDropdownOnFocus),t={initCallback:function(t){e.form&&e.form.options&&"environment"===e.form.options.theme&&t.on("open",function(){$("body > .select2-container--dashboards.select2-container--open").addClass("select2--environment")})},matcher:e.matcher,showSearch:e.showSearch,theme:"dashboards",tooltip:e.tooltip,width:e.width},_.extend(t,this.getPaginationSettings(n,{caseInsensitiveSort:s})),_.isBoolean(e.showSearch)&&(t.minimumResultsForSearch=e.showSearch?0:-1),s&&_.extend(t,{sorter:function(t){return t.sort(function(t,e){return t.text.toLowerCase().localeCompare(e.text.toLowerCase())})}}),t.templateSelection=a,t.templateResult=a,t.escapeMarkup=function(t){return t},i.dashSingleSelect(t),e.setValue(e.value),_.isUndefined(e.width)||e.setWidth(e.width)},setOptions:function(e){var t,i=this;e instanceof Backbone.Collection?0<(t=e).length?this.renderOptions(e):t.fetch({success:function(t){i.renderOptions(e)}}):_.isFunction(e)?e(function(t){i.renderOptions(t)},i):this.renderOptions(e)},setValue:function(t){var e=!1;!this.enforceValue||_.has(this.renderedOptions,t)?e=!0:_.has(this.availableOptions,t)&&(this.$el.append(new Option(this.availableOptions[t],t,!0,!0)),this.renderedOptions[t]=this.availableOptions[t],e=!0),e&&(this.value=t,this.$el.val(t).trigger("change.select2"))},setWidth:function(t){var e=this.$el.data("select2");this.width=t,e&&e.$container.css("width",this.width)},_arrayToHtml:function(t){var n="",s=this;return _.each(t,function(t,e){var i;_.isObject(t)?t.group?(i='<optgroup label="'+t.group+'">'+s._getOptionsHtml(t.options)+"</optgroup>",n+=i):(i=t.val||0===t.val?t.val:"",n+='<option value="'+i+'">'+t.label+"</option>"):n+="<option>"+t+"</option>"},this),n},_collectionToArray:function(t){var e=[];return t.each(function(t){e.push({val:t.id,label:t.toString()})}),e},_getOptionsArray:function(t){var e,t=_.isFunction(t)?(t(function(t){e=t},this),this._getOptionsArray(e)):_.isArray(t)?t:t instanceof Backbone.Collection?this._collectionToArray(t):this._objectToArray(t);return t},_getOptionsHtml:function(t,e){t=_.isString(t)?t:(t=this._getOptionsArray(t),this._arrayToHtml(t));return t},_objectToArray:function(t){var e,i=[];for(e in t)t.hasOwnProperty(e)&&i.push({val:e,label:t[e]});return i}}),Form.editors.Checkboxes=Form.editors.Select.extend({tagName:"ul",groupNumber:0,events:{"click input[type=checkbox]":function(){this.trigger("change",this)},"focus input[type=checkbox]":function(){this.hasFocus||this.trigger("focus",this)},"blur input[type=checkbox]":function(){var t;this.hasFocus&&(t=this,setTimeout(function(){t.$("input[type=checkbox]:focus")[0]||t.trigger("blur",t)},0))}},getValue:function(){var t=[];return this.$("input[type=checkbox]:checked").each(function(){t.push($(this).val())}),t},setValue:function(t){_.isArray(t)||(t=[t]),this.value=t,this.$("input[type=checkbox]").val(t)},focus:function(){this.hasFocus||this.$("input[type=checkbox]").first().focus()},blur:function(){this.hasFocus&&this.$("input[type=checkbox]:focus").blur()},_arrayToHtml:function(t){var s=$(),a=this;return _.each(t,function(t,e){var i,n=$("<li>");_.isObject(t)?t.group?(i=a.id,a.id+="-"+a.groupNumber++,n=(n=$('<fieldset class="group">').append($("<legend>").text(t.group))).append(a._arrayToHtml(t.options)),a.id=i,close=!1):(i=t.val||0===t.val?t.val:"",n.append($('<input type="checkbox" name="'+a.getName()+'" id="'+a.id+"-"+e+'" >').val(i)),t.labelHTML?n.append($('<label for="'+a.id+"-"+e+'">').html(t.labelHTML)):n.append($('<label for="'+a.id+"-"+e+'">').text(t.label))):(n.append($('<input type="checkbox" name="'+a.getName()+'" id="'+a.id+"-"+e+'">').val(t)),n.append($('<label for="'+a.id+"-"+e+'">').text(t))),s=s.add(n)}),s}}),Form.editors.DateTimeBase=Form.editors.Base.extend({initialize:function(t,e){Form.editors.Base.prototype.initialize.call(e,t)},onKeyDown:function(){var n=!0,s=this;this.$input.off("keydown"),this.$input.on("keydown",function(t){var e,i=$(this).val();s.setSelection(this.selectionStart),(65!==t.keyCode&&86!==t.keyCode&&67!==t.keyCode||!0!==t.ctrlKey&&!0!==t.metaKey)&&(-1!==[9,13].indexOf(t.keyCode)?s.$dateTimeInput?s.$dateTimeInput.datetimepicker("hide"):s.$dateInput?s.$dateInput.datepicker("hide"):t.currentTarget===s.endDateInput&&setTimeout(function(){s.fp.isOpen&&null===s.focusedField&&s.fp.close()},10):_.get(t.target,"readOnly")||-1===[33,34,38,40].indexOf(t.keyCode)&&(-1!==[35,36,37,39].indexOf(t.keyCode)?setTimeout(function(){s.updateSelection()},100):(-1!==[48,49,50,51,52,53,54,55,56,57,96,97,98,99,100,101,102,103,104,105].indexOf(t.keyCode)?(/^[0-9]$/.test(i[s.lastSelection])||s.lastSelection++,e=-1!==[48,49,50,51,52,53,54,55,56,57].indexOf(t.keyCode)?String(t.keyCode-48):String(t.keyCode-96),s.lastSelection<i.length&&(i=s.replaceAt(i,s.lastSelection,e),$(this).val(i)),"range"===s.schema.options.mode&&i.length<10?n=!1:(this.setSelectionRange(s.lastSelection+1,s.lastSelection+1),s.setSelection(s.lastSelection+1))):8===t.keyCode?(e=this.selectionStart===this.selectionEnd?Math.max(0,this.selectionStart-1):this.selectionStart,s.setSelection(e),$(this).val(s.zeroSelection(i,e,this.selectionEnd)),this.setSelectionRange(s.lastSelection,s.lastSelection)):46===t.keyCode&&(/^[0-9]$/.test(i[s.lastSelection])||s.lastSelection++,s.lastSelection<i.length&&(i=s.replaceAt(i,s.lastSelection,"0"),$(this).val(i)),this.setSelectionRange(s.lastSelection+1,s.lastSelection+1),s.setSelection(s.lastSelection+1)),n&&t.preventDefault(),n=!0)))})},render:function(t){this.$input=t,this.onKeyDown()},replaceAt:function(t,e,i){return t.substr(0,e)+i+t.substr(e+i.length)},setSelection:function(t){var e,i;switch(this.lastSelection=t,":"===(i=(e=this.options.timeFormat||"HH:mm:ss.SSSSSSSSS").substring(t,t+1))?i=e.substr(t-1,1):t>=e.length&&(i=e.substr(-1,1)),"S"===(i=_.includes(["H","m","s","S"],i)?i:null)&&(i="S1",t!==e.length)&&(15<=t?i="S3":12<=t&&(i="S2")),i){case"H":0;break;case"m":0;break;case"s":0;break;case"S1":0;break;case"S2":0}},updateSelection:function(){this.element&&this.setSelection(this.element[0].selectionStart)},zeroSelection:function(t,e,i){for(var n=t.substr(e,i),s=0;s<n.length;s++)/^[0-9]$/.test(n[s])&&(n=this.replaceAt(n,s,"0"));return this.replaceAt(t,e,n)}}),Form.editors.DatePicker=Form.editors.DateTimeBase.extend({initialize:function(t){var i=this,e=(Form.editors.DateTimeBase.prototype.initialize.call(this,t=t||{},this),Form.editors.Date,new Date);this.options=_.extend({},t),this.schema=$.extend(!0,{options:{yearStart:e.getFullYear()-100,yearEnd:e.getFullYear(),availableDates:null,closeText:"Close",changeMonth:!0,changeYear:!0,dateFormat:"yy-mm-dd",showAnim:"slideDown",showOn:"focus"}},t.schema||{}),this.schema.options.minDate=_.isEmpty(this.schema.options.availableDates)?null:_.min(this.schema.options.availableDates),this.schema.options.maxDate=_.isEmpty(this.schema.options.availableDates)?null:_.max(this.schema.options.availableDates),this.schema.options.onClose=function(t,e){i.trigger("close",i)},this.momentFormat=this.schema.options.dateFormat?this.schema.options.dateFormat.replace("yy","YYYY").toUpperCase():"YYYY/MM/DD",this.value&&!_.isDate(this.value)&&(this.value=new Date(this.value)),this.value&&this.value instanceof Date||((e=new Date).setSeconds(0),e.setMilliseconds(0),this.value=e),this.template=t.template||this.constructor.template},initializeEvents:function(){var n=this;Form.editors.DateTimeBase.prototype.render.call(this,this.$dateInput),this.$dateInput.on("change",function(){n.updateHidden(),n.trigger("change",n)}),this.$dateInput.on("focus",function(){n.hasFocus||n.trigger("focus",n)}),this.$dateInput.on("blur",function(){n.hasFocus&&setTimeout(function(){n.$("input:focus")[0]||n.trigger("blur",n)},0)}),this.$dateInput.on("keyup",function(t){var e=n.$dateInput.val(),i=Tools.convertUserInputToMoment(e,n.momentFormat);_.includes([37,38,39,40],t.keyCode)||(i.isValid()&&moment(e,n.momentFormat,!0).isValid()?n.isInAvailableDatesList(e)?(t=i.toDashString(),n.setValue(t),n.trigger("change",n)):n.trigger("unavailable",n):n.trigger("invalid",n))})},blur:function(){this.hasFocus&&this.$dateInput.first().blur()},convertISOStringToDate:function(t){var e;if(_.isDate(t)){if(_.isNaN(t.getTime()))return null;t=t.toISOString()}return t?!!(e="string"==typeof t?/^(\d\d\d\d)-(\d\d)-(\d\d)$/.exec(t.substr(0,10)):e)&&new Date(Number(e[1]),Number(e[2])-1,Number(e[3])):null},focus:function(){this.hasFocus||this.$dateInput.first().focus()},getValue:function(){var t=this.$dateInput.datepicker("getDate");return $.datepicker.formatDate("yy-mm-dd",t)},getWidth:function(){return this.schema.options.width},hide:function(){return this.$dateInput.datepicker("hide")},render:function(){var t=this.options,e=this.schema,i=Backbone.$,n=t.id,t=(!n&&t.item&&(n=t.item.cid),i(this.template({key:n})));return this.$dateInput=t.find("input"),this.$dateInput.addClass("ui-state-default"),e.editorClass&&this.$dateInput.addClass(e.editorClass),this.$dateInput.datepicker(_.extend({defaultDate:this.value},e.options)),_.set(this.$dateInput.datepicker(),"0.readOnly",_.get(this.schema,"options.readOnly")),this.$hidden=i('<input type="hidden" name="'+this.key+'" >'),t.append(this.$hidden),this.setValue(this.value),this.setElement(t),this.$el.attr("name",this.getName()),this.hasFocus&&this.trigger("blur",this),this.initializeEvents(),this},setValue:function(t){var e,i=this.schema&&this.schema.options&&this.schema.options.ignoreTimezone;(t="string"==typeof t&&0===t.indexOf("T")?QuickBase.Helpers.convertRollingToDate(t,"date"):t)&&10<t.length&&(t=Tools.convertValueToMoment(t).format("YYYY-MM-DD")),e=this.convertISOStringToDate(t),i=Tools.convertValueToMoment(t,void 0,i),e&&i.isValid()?this.isInAvailableDatesList(t)?(this.$dateInput.datepicker("setDate",e),this.previousDate=t,this.updateHidden()):this.trigger("unavailable",this):this.trigger("invalid",this)},isInAvailableDatesList:function(t){return!!_.isEmpty(this.schema.options.availableDates)||(t=Tools.convertValueToMoment(t,"1214",!0).toDashString(),_.includes(this.schema.options.availableDates,t))},setAvailableDates:function(t){this.schema.options.availableDates=t,this.schema.options.minDate=_.isEmpty(t)?null:_.min(t),this.schema.options.maxDate=_.isEmpty(t)?null:_.max(t),this.$dateInput.datepicker("option",{minDate:this.schema.options.minDate,maxDate:this.schema.options.maxDate})},setWidth:function(t){var e=0<this.$el.closest(".datepicker-container").find(".timestamp-extended").length?2:1,i=this.$el.closest(".datepicker-input"),n=this.$el.closest(".datepicker-container").find(".datepicker-button");n.length&&(n=n[0].getBoundingClientRect().width,i.width(t-n-e))},show:function(){return this.$dateInput.datepicker("show")},updateHidden:function(){var t=this.getValue();_.isDate(t)&&!_.isNaN(t.getTime())&&(t=t.toISOString()),this.$hidden.val(t)},updateDateInputField:function(t){var e;_.isEmpty(t)||(e=this.schema&&this.schema.options&&this.schema.options.ignoreTimezone,(t="string"==typeof t&&0===t.indexOf("T")?QuickBase.Helpers.convertRollingToDate(t,"date"):t)&&10<t.length&&(t=Tools.convertValueToMoment(t).format("YYYY-MM-DD")),dateObject=this.convertISOStringToDate(t),dateCheck=Tools.convertValueToMoment(t,void 0,e),dateObject&&dateCheck.isValid()?(e=Tools.convertValueToMoment(t,"1214",!0).toDashString(),this.$dateInput.datepicker("option",{minDate:null,maxDate:null}),this.$dateInput.val(e),e=this.$dateInput[0].value,this.$dateInput.datepicker("option",{minDate:this.schema.options.minDate,maxDate:this.schema.options.maxDate}),this.$dateInput[0].value=e):"string"==typeof t&&(this.$dateInput[0].value=t))}}),Form.editors.Slider=Form.editors.Base.extend({defaultValue:"",handlebarsTemplate:"",previousValue:"",tagName:"div",showTooltip:!0,showTicks:!1,keys:[],events:{slidechange:function(){this.trigger("change",this)}},initialize:function(t){Form.editors.Base.prototype.initialize.call(this,t=t||{}),this.showTicks=t.schema.ticks,this.showTooltip=t.schema.tooltip,this.handlebarsTemplate=t.schema.tooltipFormatter,this.range=t.schema.range,this.template=t.template||this.constructor.template,this.tooltipMin=$('<div class="sliderTooltip" id="tooltip'+t.id+'"></div>').hide(),this.tooltipMax=$('<div class="sliderTooltip" id="tooltip'+t.id+'"></div>').hide(),this.options=_.extend({},t)},render:function(){var t=this.options,t=(this.keyId=t.id,this.setValue(this.model.get(this.key)),!this.keyId&&t.item&&(this.keyId=t.item.cid),this.$el.html(this.template({key:this.keyId})),this.$el.attr("type","slider"),this.getSliderValue());return this.slideritem=this.$el.find(".slider").slider(this.getOptions(t)),this.showTooltip&&this.setTooltips(),this.showTicks&&this.setSliderTicks(),this.setValue(this.value),this},setTooltips:function(){var t=this;this.slideritem.find(".ui-slider-handle:nth(0)").first().append(this.tooltipMin).hover(function(){t.showTooltip&&(t.tooltipMin.show(),t.tooltipMax.show())},function(){t.tooltipMin.hide(),t.tooltipMax.hide()}),this.range&&this.slideritem.find(".ui-slider-handle:nth(1)").first().append(this.tooltipMax).hover(function(){t.showTooltip&&(t.tooltipMin.show(),t.tooltipMax.show())},function(){t.tooltipMin.hide(),t.tooltipMax.hide()})},getOptions:function(t){var i=this,n=0<this.keys.length,e={range:!!this.range||"max",min:0,max:n?this.keys.length-1:0,values:t,slide:function(t,e){n&&(i.range?i.setValue([e.values?i.keys[e.values[0]]:i.keys[0],e.values?i.keys[e.values[1]]:i.keys[i.keys.length-1]]):i.setValue(_.isNil(e.value)?"":i.keys[e.value]))}};return this.range?e.values=t:e.value=t,e},getValue:function(){return this.value},getSliderValue:function(){var t,e,i=this.getValue();if(Array.isArray(i))return t=this.keys.indexOf(i[0]),e=this.keys.indexOf(i[i.length-1]),[_.isNil(t)?"":t,_.isNil(e)?"":e];if(_.isString(i)){var n=i.split(",");if(1<n.length)return t=this.keys.indexOf(n[0]),e=this.keys.indexOf(n[n.length-1]),[_.isNil(t)?"":t,_.isNil(e)?"":e]}return this.keys.indexOf(i)},setKeys:function(t,e){this.keys=t,this.setValue(e),this.render()},setValue:function(t){var e;this.range?1<(e=_.isString(t)?t.split(","):t).length?(this.value=t,this.tooltipMin.text(_.isNil(e[0])?"":this.formatter(e[0].toString())),this.tooltipMax.text(_.isNil(e[e.length-1])?"":this.formatter(e[e.length-1].toString()))):this.value=",":(this.value=_.isArray(t)?_.first(t):t,this.tooltipMin.text(_.isNil(this.value)?"":this.formatter(this.value.toString())))},formatter:function(t){var e=this.handlebarsTemplate,i=Handlebars.compile(e);return e?i(Object.assign({thisValue:t,value:t,data:t},Object.assign.apply(Object,__spreadArray([{}],this.form.viewStates.map(function(t){var e={};return e[t.path]=t.model.get("value"),e}),!1)))):t},focus:function(){this.hasFocus||this.$el.focus()},setSliderTicks:function(){var t=this.keys.length-1,e=100/t,i='<span class="ui-slider-tick-mark"></span>';this.slideritem.find(".ui-slider-tick-mark").remove();for(var n=0;n<t;n++)$(i).css("left",e*n+"%").appendTo(this.slideritem);$(i).css("left","100%").appendTo(this.slideritem)},blur:function(){this.hasFocus&&this.$el.blur()}}),!function(t){t(jQuery)}(function($){var Timepicker,isEmptyObject,extendRemove,detectSupport,convert24to12,computeEffectiveSetting,splitDateTime,parseDateTimeInternal,selectLocalTimezone;$.ui.timepicker=$.ui.timepicker||{},$.ui.timepicker.version||($.extend($.ui,{timepicker:{version:"1.6.1"}}),Timepicker=function(){this.regional=[],this.regional[""]={currentText:"Now",closeText:"Done",amNames:["AM","A"],pmNames:["PM","P"],timeFormat:"HH:mm",timeSuffix:"",timeOnlyTitle:"Choose Time",timeText:"Time",hourText:"Hour",minuteText:"Minute",secondText:"Second",millisecText:"Millisecond",microsecText:"Microsecond",timezoneText:"Time Zone",isRTL:!1},this._defaults={showButtonPanel:!0,timeOnly:!1,timeOnlyShowDate:!1,showHour:null,showMinute:null,showSecond:null,showMillisec:null,showMicrosec:null,showTimezone:null,showTime:!0,stepHour:1,stepMinute:1,stepSecond:1,stepMillisec:1,stepMicrosec:1,hour:0,minute:0,second:0,millisec:0,microsec:0,timezone:null,hourMin:0,minuteMin:0,secondMin:0,millisecMin:0,microsecMin:0,hourMax:23,minuteMax:59,secondMax:59,millisecMax:999,microsecMax:999,minDateTime:null,maxDateTime:null,maxTime:null,minTime:null,onSelect:null,hourGrid:0,minuteGrid:0,secondGrid:0,millisecGrid:0,microsecGrid:0,alwaysSetTime:!0,separator:" ",altFieldTimeOnly:!0,altTimeFormat:null,altSeparator:null,altTimeSuffix:null,altRedirectFocus:!0,pickerTimeFormat:null,pickerTimeSuffix:null,showTimepicker:!0,timezoneList:null,addSliderAccess:!1,sliderAccessArgs:null,controlType:"slider",oneLine:!1,defaultValue:null,parse:"strict",afterInject:null},$.extend(this._defaults,this.regional[""])},$.extend(Timepicker.prototype,{$input:null,$altInput:null,$timeObj:null,inst:null,hour_slider:null,minute_slider:null,second_slider:null,millisec_slider:null,microsec_slider:null,timezone_select:null,maxTime:null,minTime:null,hour:0,minute:0,second:0,millisec:0,microsec:0,timezone:null,hourMinOriginal:null,minuteMinOriginal:null,secondMinOriginal:null,millisecMinOriginal:null,microsecMinOriginal:null,hourMaxOriginal:null,minuteMaxOriginal:null,secondMaxOriginal:null,millisecMaxOriginal:null,microsecMaxOriginal:null,ampm:"",formattedDate:"",formattedTime:"",formattedDateTime:"",timezoneList:null,units:["hour","minute","second","millisec","microsec"],support:{},control:null,setDefaults:function(t){return extendRemove(this._defaults,t||{}),this},_newInst:function($input,opts){var tp_inst=new Timepicker,inlineSettings={},fns={},overrides,i,attrName;for(attrName in this._defaults)if(this._defaults.hasOwnProperty(attrName)){var attrValue=$input.attr("time:"+attrName);if(attrValue)try{inlineSettings[attrName]=eval(attrValue)}catch(err){inlineSettings[attrName]=attrValue}}for(i in overrides={beforeShow:function(t,e){if($.isFunction(tp_inst._defaults.evnts.beforeShow))return tp_inst._defaults.evnts.beforeShow.call($input[0],t,e,tp_inst)},onChangeMonthYear:function(t,e,i){$.isFunction(tp_inst._defaults.evnts.onChangeMonthYear)&&tp_inst._defaults.evnts.onChangeMonthYear.call($input[0],t,e,i,tp_inst)},onClose:function(t,e){!0===tp_inst.timeDefined&&""!==$input.val()&&tp_inst._updateDateTime(e),$.isFunction(tp_inst._defaults.evnts.onClose)&&tp_inst._defaults.evnts.onClose.call($input[0],t,e,tp_inst)}},overrides)overrides.hasOwnProperty(i)&&(fns[i]=opts[i]||this._defaults[i]||null);tp_inst._defaults=$.extend({},this._defaults,inlineSettings,opts,overrides,{evnts:fns,timepicker:tp_inst}),tp_inst.amNames=$.map(tp_inst._defaults.amNames,function(t){return t.toUpperCase()}),tp_inst.pmNames=$.map(tp_inst._defaults.pmNames,function(t){return t.toUpperCase()}),tp_inst.support=detectSupport(tp_inst._defaults.timeFormat+(tp_inst._defaults.pickerTimeFormat||"")+(tp_inst._defaults.altTimeFormat||"")),"string"==typeof tp_inst._defaults.controlType?("slider"===tp_inst._defaults.controlType&&void 0===$.ui.slider&&(tp_inst._defaults.controlType="select"),tp_inst.control=tp_inst._controls[tp_inst._defaults.controlType]):tp_inst.control=tp_inst._defaults.controlType;var timezoneList=[-720,-660,-600,-570,-540,-480,-420,-360,-300,-270,-240,-210,-180,-120,-60,0,60,120,180,210,240,270,300,330,345,360,390,420,480,525,540,570,600,630,660,690,720,765,780,840],tzl=(null!==tp_inst._defaults.timezoneList&&(timezoneList=tp_inst._defaults.timezoneList),timezoneList.length),tzi=0,tzv=null;if(0<tzl&&"object"!=typeof timezoneList[0])for(;tzi<tzl;tzi++)tzv=timezoneList[tzi],timezoneList[tzi]={value:tzv,label:$.timepicker.timezoneOffsetString(tzv,tp_inst.support.iso8601)};return tp_inst._defaults.timezoneList=timezoneList,tp_inst.timezone=null!==tp_inst._defaults.timezone?$.timepicker.timezoneOffsetNumber(tp_inst._defaults.timezone):-1*(new Date).getTimezoneOffset(),tp_inst.hour=tp_inst._defaults.hour<tp_inst._defaults.hourMin?tp_inst._defaults.hourMin:tp_inst._defaults.hour>tp_inst._defaults.hourMax?tp_inst._defaults.hourMax:tp_inst._defaults.hour,tp_inst.minute=tp_inst._defaults.minute<tp_inst._defaults.minuteMin?tp_inst._defaults.minuteMin:tp_inst._defaults.minute>tp_inst._defaults.minuteMax?tp_inst._defaults.minuteMax:tp_inst._defaults.minute,tp_inst.second=tp_inst._defaults.second<tp_inst._defaults.secondMin?tp_inst._defaults.secondMin:tp_inst._defaults.second>tp_inst._defaults.secondMax?tp_inst._defaults.secondMax:tp_inst._defaults.second,tp_inst.millisec=tp_inst._defaults.millisec<tp_inst._defaults.millisecMin?tp_inst._defaults.millisecMin:tp_inst._defaults.millisec>tp_inst._defaults.millisecMax?tp_inst._defaults.millisecMax:tp_inst._defaults.millisec,tp_inst.microsec=tp_inst._defaults.microsec<tp_inst._defaults.microsecMin?tp_inst._defaults.microsecMin:tp_inst._defaults.microsec>tp_inst._defaults.microsecMax?tp_inst._defaults.microsecMax:tp_inst._defaults.microsec,tp_inst.ampm="",tp_inst.$input=$input,tp_inst._defaults.altField&&(tp_inst.$altInput=$(tp_inst._defaults.altField),!0===tp_inst._defaults.altRedirectFocus)&&tp_inst.$altInput.css({cursor:"pointer"}).focus(function(){$input.trigger("focus")}),0!==tp_inst._defaults.minDate&&0!==tp_inst._defaults.minDateTime||(tp_inst._defaults.minDate=new Date),0!==tp_inst._defaults.maxDate&&0!==tp_inst._defaults.maxDateTime||(tp_inst._defaults.maxDate=new Date),void 0!==tp_inst._defaults.minDate&&tp_inst._defaults.minDate instanceof Date&&(tp_inst._defaults.minDateTime=new Date(tp_inst._defaults.minDate.getTime())),void 0!==tp_inst._defaults.minDateTime&&tp_inst._defaults.minDateTime instanceof Date&&(tp_inst._defaults.minDate=new Date(tp_inst._defaults.minDateTime.getTime())),void 0!==tp_inst._defaults.maxDate&&tp_inst._defaults.maxDate instanceof Date&&(tp_inst._defaults.maxDateTime=new Date(tp_inst._defaults.maxDate.getTime())),void 0!==tp_inst._defaults.maxDateTime&&tp_inst._defaults.maxDateTime instanceof Date&&(tp_inst._defaults.maxDate=new Date(tp_inst._defaults.maxDateTime.getTime())),tp_inst.$input.bind("focus",function(){tp_inst._onFocus()}),tp_inst},_addTimePicker:function(t){var e=$.trim(this.$altInput&&this._defaults.altFieldTimeOnly?this.$input.val()+" "+this.$altInput.val():this.$input.val());this.timeDefined=this._parseTime(e),this._limitMinMaxDateTime(t,!1),this._injectTimePicker(),this._afterInject()},_parseTime:function(e,i){if(this.inst||(this.inst=$.datepicker._getInst(this.$input[0])),!i&&this._defaults.timeOnly)return!!(i=$.datepicker.parseTime(this._defaults.timeFormat,e,this._defaults))&&($.extend(this,i),!0);i=$.datepicker._get(this.inst,"dateFormat");try{var t=parseDateTimeInternal(i,this._defaults.timeFormat,e,$.datepicker._getFormatConfig(this.inst),this._defaults);if(!t.timeObj)return!1;$.extend(this,t.timeObj)}catch(t){return $.timepicker.log("Error parsing the date/time string: "+t+"\ndate/time string = "+e+"\ntimeFormat = "+this._defaults.timeFormat+"\ndateFormat = "+i),!1}return!0},_afterInject:function(){var t=this.inst.settings;$.isFunction(t.afterInject)&&t.afterInject.call(this)},_injectTimePicker:function(){var t,e=this.inst.dpDiv,i=this.inst.settings,s=this,a="",n="",o=null,l={},r={},c=0,u=0;if(0===e.find("div.ui-timepicker-div").length&&i.showTimepicker){for(var h=" ui_tpicker_unit_hide",d='<div class="ui-timepicker-div'+(i.isRTL?" ui-timepicker-rtl":"")+(i.oneLine?" ui-timepicker-oneLine":"")+'"><dl><dt class="ui_tpicker_time_label'+(i.showTime?"":h)+'">'+i.timeText+'</dt><dd class="ui_tpicker_time '+(i.showTime?"":h)+'"><input class="ui_tpicker_time_input" '+(i.timeInput?"":"disabled")+"></dd>",c=0,u=this.units.length;c<u;c++){if(o=null!==i["show"+(n=(a=this.units[c]).substr(0,1).toUpperCase()+a.substr(1))]?i["show"+n]:this.support[a],l[a]=parseInt(i[a+"Max"]-(i[a+"Max"]-i[a+"Min"])%i["step"+n],10),r[a]=0,d+='<dt class="ui_tpicker_'+a+"_label"+(o?"":h)+'">'+i[a+"Text"]+'</dt><dd class="ui_tpicker_'+a+(o?"":h)+'"><div class="ui_tpicker_'+a+"_slider"+(o?"":h)+'"></div>',o&&0<i[a+"Grid"]){if(d+='<div style="padding-left: 1px"><table class="ui-tpicker-grid-label"><tr>',"hour"===a)for(var m=i[a+"Min"];m<=l[a];m+=parseInt(i[a+"Grid"],10)){r[a]++;var p=$.datepicker.formatTime(this.support.ampm?"hht":"HH",{hour:m},i);d+='<td data-for="'+a+'">'+p+"</td>"}else for(var f=i[a+"Min"];f<=l[a];f+=parseInt(i[a+"Grid"],10))r[a]++,d+='<td data-for="'+a+'">'+(f<10?"0":"")+f+"</td>";d+="</tr></table></div>"}d+="</dd>"}var g=null!==i.showTimezone?i.showTimezone:this.support.timezone,v=(d+='<dt class="ui_tpicker_timezone_label'+(g?"":h)+'">'+i.timezoneText+"</dt>",$(d=d+('<dd class="ui_tpicker_timezone'+(g?"":h)+'"></dd>')+"</dl></div>"));for(!0===i.timeOnly&&(v.prepend('<div class="ui-widget-header ui-helper-clearfix ui-corner-all"><div class="ui-datepicker-title">'+i.timeOnlyTitle+"</div></div>"),e.find(".ui-datepicker-header, .ui-datepicker-calendar").hide()),c=0,u=s.units.length;c<u;c++)o=null!==i["show"+(n=(a=s.units[c]).substr(0,1).toUpperCase()+a.substr(1))]?i["show"+n]:this.support[a],s[a+"_slider"]=s.control.create(s,v.find(".ui_tpicker_"+a+"_slider"),a,s[a],i[a+"Min"],l[a],i["step"+n]),o&&0<i[a+"Grid"]&&(t=100*r[a]*i[a+"Grid"]/(l[a]-i[a+"Min"]),v.find(".ui_tpicker_"+a+" table").css({width:t+"%",marginLeft:i.isRTL?"0":t/(-2*r[a])+"%",marginRight:i.isRTL?t/(-2*r[a])+"%":"0",borderCollapse:"collapse"}).find("td").click(function(t){var e=$(this),i=e.html(),n=parseInt(i.replace(/[^0-9]/g),10),i=i.replace(/[^apm]/gi),e=e.data("for");"hour"===e&&(-1!==i.indexOf("p")&&n<12?n+=12:-1!==i.indexOf("a")&&12===n&&(n=0)),s.control.value(s,s[e+"_slider"],a,n),s._onTimeChange(),s._onSelectHandler()}).css({cursor:"pointer",width:100/r[a]+"%",textAlign:"center",overflow:"hidden"}));this.timezone_select=v.find(".ui_tpicker_timezone").append("<select></select>").find("select"),$.fn.append.apply(this.timezone_select,$.map(i.timezoneList,function(t,e){return $("<option></opttion>").val("object"==typeof t?t.value:t).text("object"==typeof t?t.label:t)})),void 0!==this.timezone&&null!==this.timezone&&""!==this.timezone?-1*new Date(this.inst.selectedYear,this.inst.selectedMonth,this.inst.selectedDay,12).getTimezoneOffset()===this.timezone?selectLocalTimezone(s):this.timezone_select.val(this.timezone):void 0!==this.hour&&null!==this.hour&&""!==this.hour?this.timezone_select.val(i.timezone):selectLocalTimezone(s),this.timezone_select.change(function(){s._onTimeChange(),s._onSelectHandler(),s._afterInject()});var _,y,g=e.find(".ui-datepicker-buttonpane");g.length?g.before(v):e.append(v),this.$timeObj=v.find(".ui_tpicker_time_input"),this.$timeObj.change(function(){var t=s.inst.settings.timeFormat,t=$.datepicker.parseTime(t,this.value),e=new Date;t?(e.setHours(t.hour),e.setMinutes(t.minute),e.setSeconds(t.second),$.datepicker._setTime(s.inst,e)):(this.value=s.formattedTime,this.blur())}),null!==this.inst&&(g=this.timeDefined,this._onTimeChange(),this.timeDefined=g),this._defaults.addSliderAccess&&(_=this._defaults.sliderAccessArgs,y=this._defaults.isRTL,_.isRTL=y,setTimeout(function(){var a;0===v.find(".ui-slider-access").length&&(v.find(".ui-slider:visible").sliderAccess(_),a=v.find(".ui-slider-access:eq(0)").outerWidth(!0))&&v.find("table:visible").each(function(){var t=$(this),e=t.outerWidth(),i=t.css(y?"marginRight":"marginLeft").toString().replace("%",""),n=e-a,s={width:n,marginRight:0,marginLeft:0};s[y?"marginRight":"marginLeft"]=i*n/e+"%",t.css(s)})},10)),s._limitMinMaxDateTime(this.inst,!0)}},_limitMinMaxDateTime:function(t,e){var i,n,s=this._defaults,a=new Date(t.selectedYear,t.selectedMonth,t.selectedDay);this._defaults.showTimepicker&&(null!==$.datepicker._get(t,"minDateTime")&&void 0!==$.datepicker._get(t,"minDateTime")&&a&&(n=$.datepicker._get(t,"minDateTime"),i=new Date(n.getFullYear(),n.getMonth(),n.getDate(),0,0,0,0),null!==this.hourMinOriginal&&null!==this.minuteMinOriginal&&null!==this.secondMinOriginal&&null!==this.millisecMinOriginal&&null!==this.microsecMinOriginal||(this.hourMinOriginal=s.hourMin,this.minuteMinOriginal=s.minuteMin,this.secondMinOriginal=s.secondMin,this.millisecMinOriginal=s.millisecMin,this.microsecMinOriginal=s.microsecMin),t.settings.timeOnly||i.getTime()===a.getTime()?(this._defaults.hourMin=n.getHours(),this.hour<=this._defaults.hourMin?(this.hour=this._defaults.hourMin,this._defaults.minuteMin=n.getMinutes(),this.minute<=this._defaults.minuteMin?(this.minute=this._defaults.minuteMin,this._defaults.secondMin=n.getSeconds(),this.second<=this._defaults.secondMin?(this.second=this._defaults.secondMin,this._defaults.millisecMin=n.getMilliseconds(),this.millisec<=this._defaults.millisecMin?(this.millisec=this._defaults.millisecMin,this._defaults.microsecMin=n.getMicroseconds()):(this.microsec<this._defaults.microsecMin&&(this.microsec=this._defaults.microsecMin),this._defaults.microsecMin=this.microsecMinOriginal)):(this._defaults.millisecMin=this.millisecMinOriginal,this._defaults.microsecMin=this.microsecMinOriginal)):(this._defaults.secondMin=this.secondMinOriginal,this._defaults.millisecMin=this.millisecMinOriginal,this._defaults.microsecMin=this.microsecMinOriginal)):(this._defaults.minuteMin=this.minuteMinOriginal,this._defaults.secondMin=this.secondMinOriginal,this._defaults.millisecMin=this.millisecMinOriginal,this._defaults.microsecMin=this.microsecMinOriginal)):(this._defaults.hourMin=this.hourMinOriginal,this._defaults.minuteMin=this.minuteMinOriginal,this._defaults.secondMin=this.secondMinOriginal,this._defaults.millisecMin=this.millisecMinOriginal,this._defaults.microsecMin=this.microsecMinOriginal)),null!==$.datepicker._get(t,"maxDateTime")&&void 0!==$.datepicker._get(t,"maxDateTime")&&a&&(i=$.datepicker._get(t,"maxDateTime"),n=new Date(i.getFullYear(),i.getMonth(),i.getDate(),0,0,0,0),null!==this.hourMaxOriginal&&null!==this.minuteMaxOriginal&&null!==this.secondMaxOriginal&&null!==this.millisecMaxOriginal||(this.hourMaxOriginal=s.hourMax,this.minuteMaxOriginal=s.minuteMax,this.secondMaxOriginal=s.secondMax,this.millisecMaxOriginal=s.millisecMax,this.microsecMaxOriginal=s.microsecMax),t.settings.timeOnly||n.getTime()===a.getTime()?(this._defaults.hourMax=i.getHours(),this.hour>=this._defaults.hourMax?(this.hour=this._defaults.hourMax,this._defaults.minuteMax=i.getMinutes(),this.minute>=this._defaults.minuteMax?(this.minute=this._defaults.minuteMax,this._defaults.secondMax=i.getSeconds(),this.second>=this._defaults.secondMax?(this.second=this._defaults.secondMax,this._defaults.millisecMax=i.getMilliseconds(),this.millisec>=this._defaults.millisecMax?(this.millisec=this._defaults.millisecMax,this._defaults.microsecMax=i.getMicroseconds()):(this.microsec>this._defaults.microsecMax&&(this.microsec=this._defaults.microsecMax),this._defaults.microsecMax=this.microsecMaxOriginal)):(this._defaults.millisecMax=this.millisecMaxOriginal,this._defaults.microsecMax=this.microsecMaxOriginal)):(this._defaults.secondMax=this.secondMaxOriginal,this._defaults.millisecMax=this.millisecMaxOriginal,this._defaults.microsecMax=this.microsecMaxOriginal)):(this._defaults.minuteMax=this.minuteMaxOriginal,this._defaults.secondMax=this.secondMaxOriginal,this._defaults.millisecMax=this.millisecMaxOriginal,this._defaults.microsecMax=this.microsecMaxOriginal)):(this._defaults.hourMax=this.hourMaxOriginal,this._defaults.minuteMax=this.minuteMaxOriginal,this._defaults.secondMax=this.secondMaxOriginal,this._defaults.millisecMax=this.millisecMaxOriginal,this._defaults.microsecMax=this.microsecMaxOriginal)),null!==t.settings.minTime&&(s=new Date("01/01/1970 "+t.settings.minTime),this.hour<s.getHours()?(this.hour=this._defaults.hourMin=s.getHours(),this.minute=this._defaults.minuteMin=s.getMinutes()):this.hour===s.getHours()&&this.minute<s.getMinutes()?this.minute=this._defaults.minuteMin=s.getMinutes():this._defaults.hourMin<s.getHours()?(this._defaults.hourMin=s.getHours(),this._defaults.minuteMin=s.getMinutes()):this._defaults.hourMin===s.getHours()===this.hour&&this._defaults.minuteMin<s.getMinutes()?this._defaults.minuteMin=s.getMinutes():this._defaults.minuteMin=0),null!==t.settings.maxTime&&(n=new Date("01/01/1970 "+t.settings.maxTime),this.hour>n.getHours()?(this.hour=this._defaults.hourMax=n.getHours(),this.minute=this._defaults.minuteMax=n.getMinutes()):this.hour===n.getHours()&&this.minute>n.getMinutes()?this.minute=this._defaults.minuteMax=n.getMinutes():this._defaults.hourMax>n.getHours()?(this._defaults.hourMax=n.getHours(),this._defaults.minuteMax=n.getMinutes()):this._defaults.hourMax===n.getHours()===this.hour&&this._defaults.minuteMax>n.getMinutes()?this._defaults.minuteMax=n.getMinutes():this._defaults.minuteMax=59),void 0!==e)&&!0===e&&(a=parseInt(this._defaults.hourMax-(this._defaults.hourMax-this._defaults.hourMin)%this._defaults.stepHour,10),i=parseInt(this._defaults.minuteMax-(this._defaults.minuteMax-this._defaults.minuteMin)%this._defaults.stepMinute,10),s=parseInt(this._defaults.secondMax-(this._defaults.secondMax-this._defaults.secondMin)%this._defaults.stepSecond,10),t=parseInt(this._defaults.millisecMax-(this._defaults.millisecMax-this._defaults.millisecMin)%this._defaults.stepMillisec,10),n=parseInt(this._defaults.microsecMax-(this._defaults.microsecMax-this._defaults.microsecMin)%this._defaults.stepMicrosec,10),this.hour_slider&&(this.control.options(this,this.hour_slider,"hour",{min:this._defaults.hourMin,max:a,step:this._defaults.stepHour}),this.control.value(this,this.hour_slider,"hour",this.hour-this.hour%this._defaults.stepHour)),this.minute_slider&&(this.control.options(this,this.minute_slider,"minute",{min:this._defaults.minuteMin,max:i,step:this._defaults.stepMinute}),this.control.value(this,this.minute_slider,"minute",this.minute-this.minute%this._defaults.stepMinute)),this.second_slider&&(this.control.options(this,this.second_slider,"second",{min:this._defaults.secondMin,max:s,step:this._defaults.stepSecond}),this.control.value(this,this.second_slider,"second",this.second-this.second%this._defaults.stepSecond)),this.millisec_slider&&(this.control.options(this,this.millisec_slider,"millisec",{min:this._defaults.millisecMin,max:t,step:this._defaults.stepMillisec}),this.control.value(this,this.millisec_slider,"millisec",this.millisec-this.millisec%this._defaults.stepMillisec)),this.microsec_slider)&&(this.control.options(this,this.microsec_slider,"microsec",{min:this._defaults.microsecMin,max:n,step:this._defaults.stepMicrosec}),this.control.value(this,this.microsec_slider,"microsec",this.microsec-this.microsec%this._defaults.stepMicrosec))},_onTimeChange:function(){var t,e,i,n,s,a,o,l,r,c,u;this._defaults.showTimepicker&&(c=!!this.hour_slider&&this.control.value(this,this.hour_slider,"hour"),u=!!this.minute_slider&&this.control.value(this,this.minute_slider,"minute"),t=!!this.second_slider&&this.control.value(this,this.second_slider,"second"),e=!!this.millisec_slider&&this.control.value(this,this.millisec_slider,"millisec"),i=!!this.microsec_slider&&this.control.value(this,this.microsec_slider,"microsec"),n=!!this.timezone_select&&this.timezone_select.val(),a=(s=this._defaults).pickerTimeFormat||s.timeFormat,o=s.pickerTimeSuffix||s.timeSuffix,"object"==typeof u&&(u=!1),"object"==typeof t&&(t=!1),"object"==typeof e&&(e=!1),"object"==typeof i&&(i=!1),"object"==typeof n&&(n=!1),!1!==(c="object"==typeof c?!1:c)&&(c=parseInt(c,10)),!1!==u&&(u=parseInt(u,10)),!1!==t&&(t=parseInt(t,10)),!1!==e&&(e=parseInt(e,10)),!1!==i&&(i=parseInt(i,10)),!1!==n&&(n=n.toString()),l=s[c<12?"amNames":"pmNames"][0],(r=c!==parseInt(this.hour,10)||u!==parseInt(this.minute,10)||t!==parseInt(this.second,10)||e!==parseInt(this.millisec,10)||i!==parseInt(this.microsec,10)||0<this.ampm.length&&c<12!=(-1!==$.inArray(this.ampm.toUpperCase(),this.amNames))||null!==this.timezone&&n!==this.timezone.toString())&&(!1!==c&&(this.hour=c),!1!==u&&(this.minute=u),!1!==t&&(this.second=t),!1!==e&&(this.millisec=e),!1!==i&&(this.microsec=i),!1!==n&&(this.timezone=n),this.inst||(this.inst=$.datepicker._getInst(this.$input[0])),this._limitMinMaxDateTime(this.inst,!0)),this.support.ampm&&(this.ampm=l),this.formattedTime=$.datepicker.formatTime(s.timeFormat,this,s),this.$timeObj&&(c=this.$timeObj[0].selectionStart,u=this.$timeObj[0].selectionEnd,a===s.timeFormat?this.$timeObj.val(this.formattedTime+o):this.$timeObj.val($.datepicker.formatTime(a,this,s)+o),this.$timeObj[0].setSelectionRange(c,u)),this.timeDefined=!0,r)&&this._updateDateTime()},_onSelectHandler:function(){var t=this._defaults.onSelect||this.inst.settings.onSelect,e=this.$input?this.$input[0]:null;t&&e&&t.apply(e,[this.formattedDateTime,this])},_updateDateTime:function(t){var e,i=0<(t=this.inst||t).currentYear?new Date(t.currentYear,t.currentMonth,t.currentDay):new Date(t.selectedYear,t.selectedMonth,t.selectedDay),i=$.datepicker._daylightSavingAdjust(i),n=$.datepicker._get(t,"dateFormat"),s=$.datepicker._getFormatConfig(t),a=null!==i&&this.timeDefined,n=(this.formattedDate=$.datepicker.formatDate(n,null===i?new Date:i,s),this.formattedDate);""===t.lastVal&&(t.currentYear=t.selectedYear,t.currentMonth=t.selectedMonth,t.currentDay=t.selectedDay),!0===this._defaults.timeOnly&&!1===this._defaults.timeOnlyShowDate?n=this.formattedTime:(!0!==this._defaults.timeOnly&&(this._defaults.alwaysSetTime||a)||!0===this._defaults.timeOnly&&!0===this._defaults.timeOnlyShowDate)&&(n+=this._defaults.separator+this.formattedTime+this._defaults.timeSuffix),this.formattedDateTime=n,this._defaults.showTimepicker?this.$altInput&&!1===this._defaults.timeOnly&&!0===this._defaults.altFieldTimeOnly?(this.$altInput.val(this.formattedTime),this.$input.val(this.formattedDate)):this.$altInput?(this.$input.val(n),t="",a=null!==this._defaults.altSeparator?this._defaults.altSeparator:this._defaults.separator,e=null!==this._defaults.altTimeSuffix?this._defaults.altTimeSuffix:this._defaults.timeSuffix,this._defaults.timeOnly||(t=this._defaults.altFormat?$.datepicker.formatDate(this._defaults.altFormat,null===i?new Date:i,s):this.formattedDate)&&(t+=a),null!==this._defaults.altTimeFormat?t+=$.datepicker.formatTime(this._defaults.altTimeFormat,this,this._defaults)+e:t+=this.formattedTime+e,this.$altInput.val(t)):this.$input.val(n):this.$input.val(this.formattedDate),this.$input.trigger("change")},_onFocus:function(){if(!this.$input.val()&&this._defaults.defaultValue){this.$input.val(this._defaults.defaultValue);var t=$.datepicker._getInst(this.$input.get(0)),e=$.datepicker._get(t,"timepicker");if(e&&e._defaults.timeOnly&&t.input.val()!==t.lastVal)try{$.datepicker._updateDatepicker(t)}catch(t){$.timepicker.log(t)}}},_controls:{slider:{create:function(i,t,n,e,s,a,o){var l=i._defaults.isRTL;return t.prop("slide",null).slider({orientation:"horizontal",value:l?-1*e:e,min:l?-1*a:s,max:l?-1*s:a,step:o,slide:function(t,e){i.control.value(i,$(this),n,l?-1*e.value:e.value),i._onTimeChange()},stop:function(t,e){i._onSelectHandler()}})},options:function(t,e,i,n,s){var a;return t._defaults.isRTL?"string"==typeof n?"min"===n||"max"===n?void 0!==s?e.slider(n,-1*s):Math.abs(e.slider(n)):e.slider(n):(t=n.min,a=n.max,n.min=n.max=null,void 0!==t&&(n.max=-1*t),void 0!==a&&(n.min=-1*a),e.slider(n)):"string"==typeof n&&void 0!==s?e.slider(n,s):e.slider(n)},value:function(t,e,i,n){return t._defaults.isRTL?void 0!==n?e.slider("value",-1*n):Math.abs(e.slider("value")):void 0!==n?e.slider("value",n):e.slider("value")}},select:{create:function(e,t,i,n,s,a,o){for(var l='<select class="ui-timepicker-select ui-state-default ui-corner-all" data-unit="'+i+'" data-min="'+s+'" data-max="'+a+'" data-step="'+o+'">',r=e._defaults.pickerTimeFormat||e._defaults.timeFormat,c=s;c<=a;c+=o)l=(l+='<option value="'+c+'"'+(c===n?" selected":"")+">")+("hour"===i?$.datepicker.formatTime($.trim(r.replace(/[^ht ]/gi,"")),{hour:c},e._defaults):"millisec"===i||"microsec"===i||10<=c?c:"0"+c.toString())+"</option>";return l+="</select>",t.children("select").remove(),$(l).appendTo(t).change(function(t){e._onTimeChange(),e._onSelectHandler(),e._afterInject()}),t},options:function(t,e,i,n,s){var a={},o=e.children("select");if("string"==typeof n){if(void 0===s)return o.data(n);a[n]=s}else a=n;return t.control.create(t,e,o.data("unit"),o.val(),0<=a.min?a.min:o.data("min"),a.max||o.data("max"),a.step||o.data("step"))},value:function(t,e,i,n){e=e.children("select");return void 0!==n?e.val(n):e.val()}}}}),$.fn.extend({timepicker:function(t){t=t||{};var e=Array.prototype.slice.call(arguments);return"object"==typeof t&&(e[0]=$.extend(t,{timeOnly:!0})),$(this).each(function(){$.fn.datetimepicker.apply($(this),e)})},datetimepicker:function(e){e=e||{};var i=arguments;return"string"==typeof e?"getDate"===e||"option"===e&&2===i.length&&"string"==typeof i[1]?$.fn.datepicker.apply($(this[0]),i):this.each(function(){var t=$(this);t.datepicker.apply(t,i)}):this.each(function(){var t=$(this);t.datepicker($.timepicker._newInst(t,e)._defaults)})}}),$.datepicker.parseDateTime=function(t,e,i,n,s){t=parseDateTimeInternal(t,e,i,n,s);return t.timeObj&&(e=t.timeObj,t.date.setHours(e.hour,e.minute,e.second,e.millisec),t.date.setMicroseconds(e.microsec)),t.date},$.datepicker.parseTime=function(e,i,n){function s(t,e,a){var i="^"+t.toString().replace(/([hH]{1,2}|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|'.*?')/g,function(t){var e,i,n,s=t.length;switch(t.charAt(0).toLowerCase()){case"h":case"m":case"s":return 1===s?"(\\d?\\d)":"(\\d{"+s+"})";case"l":case"c":return"(\\d?\\d?\\d)";case"z":return"(z|[-+]\\d\\d:?\\d\\d|\\S+)?";case"t":return e=a.amNames,i=a.pmNames,n=[],e&&$.merge(n,e),i&&$.merge(n,i),"("+(n=$.map(n,function(t){return t.replace(/[.*+?|()\[\]{}\\]/g,"\\$&")})).join("|")+")?";default:return"("+t.replace(/\'/g,"").replace(/(\.|\$|\^|\\|\/|\(|\)|\[|\]|\?|\+|\*)/g,function(t){return"\\"+t})+")?"}}).replace(/\s/g,"\\s?")+a.timeSuffix+"$",t=function(t){var e=t.toLowerCase().match(/(h{1,2}|m{1,2}|s{1,2}|l{1}|c{1}|t{1,2}|z|'.*?')/g),i={h:-1,m:-1,s:-1,l:-1,c:-1,t:-1,z:-1};if(e)for(var n=0;n<e.length;n++)-1===i[e[n].toString().charAt(0)]&&(i[e[n].toString().charAt(0)]=n+1);return i}(t),n="",e=e.match(new RegExp(i,"i")),i={hour:0,minute:0,second:0,millisec:0,microsec:0};return!!e&&(-1!==t.t&&(void 0===e[t.t]||0===e[t.t].length?i.ampm=n="":(n=-1!==$.inArray(e[t.t].toUpperCase(),$.map(a.amNames,function(t,e){return t.toUpperCase()}))?"AM":"PM",i.ampm=a["AM"===n?"amNames":"pmNames"][0])),-1!==t.h&&("AM"===n&&"12"===e[t.h]?i.hour=0:"PM"===n&&"12"!==e[t.h]?i.hour=parseInt(e[t.h],10)+12:i.hour=Number(e[t.h])),-1!==t.m&&(i.minute=Number(e[t.m])),-1!==t.s&&(i.second=Number(e[t.s])),-1!==t.l&&(i.millisec=Number(e[t.l])),-1!==t.c&&(i.microsec=Number(e[t.c])),-1!==t.z&&void 0!==e[t.z]&&(i.timezone=$.timepicker.timezoneOffsetNumber(e[t.z])),i)}n=extendRemove(extendRemove({},$.timepicker._defaults),n||{});e.replace(/\'.*?\'/g,"").indexOf("Z");if("function"==typeof n.parse)return n.parse(e,i,n);if("loose"!==n.parse)return s(e,i,n);try{var t=new Date("2012-01-01 "+i);if(isNaN(t.getTime())&&(t=new Date("2012-01-01T"+i),isNaN(t.getTime()))&&(t=new Date("01/01/2012 "+i),isNaN(t.getTime())))throw"Unable to parse time with native Date: "+i;return{hour:t.getHours(),minute:t.getMinutes(),second:t.getSeconds(),millisec:t.getMilliseconds(),microsec:t.getMicroseconds(),timezone:-1*t.getTimezoneOffset()}}catch(t){try{return s(e,i,n)}catch(t){$.timepicker.log("Unable to parse \ntimeString: "+i+"\ntimeFormat: "+e)}}return!1},$.datepicker.formatTime=function(t,e,i){i=i||{},i=$.extend({},$.timepicker._defaults,i),e=$.extend({hour:0,minute:0,second:0,millisec:0,microsec:0,timezone:null},e);var n=i.amNames[0],s=parseInt(e.hour,10);return 11<s&&(n=i.pmNames[0]),t=t.replace(/(?:HH?|hh?|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|'.*?')/g,function(t){switch(t){case"HH":return("0"+s).slice(-2);case"H":return s;case"hh":return("0"+convert24to12(s)).slice(-2);case"h":return convert24to12(s);case"mm":return("0"+e.minute).slice(-2);case"m":return e.minute;case"ss":return("0"+e.second).slice(-2);case"s":return e.second;case"l":return("00"+e.millisec).slice(-3);case"c":return("00"+e.microsec).slice(-3);case"z":return $.timepicker.timezoneOffsetString((null===e.timezone?i:e).timezone,!1);case"Z":return $.timepicker.timezoneOffsetString((null===e.timezone?i:e).timezone,!0);case"T":return n.charAt(0).toUpperCase();case"TT":return n.toUpperCase();case"t":return n.charAt(0).toLowerCase();case"tt":return n.toLowerCase();default:return t.replace(/'/g,"")}})},$.datepicker._base_selectDate=$.datepicker._selectDate,$.datepicker._selectDate=function(t,e){var i=this._getInst($(t)[0]),n=this._get(i,"timepicker");n&&i.settings.showTimepicker?(n._limitMinMaxDateTime(i,!0),n=i.inline,i.inline=i.stay_open=!0,this._base_selectDate(t,e),i.inline=n,i.stay_open=!1,this._notifyChange(i),this._updateDatepicker(i)):this._base_selectDate(t,e)},$.datepicker._base_updateDatepicker=$.datepicker._updateDatepicker,$.datepicker._updateDatepicker=function(t){var e,i,n=t.input[0];$.datepicker._curInst&&$.datepicker._curInst!==t&&$.datepicker._datepickerShowing&&$.datepicker._lastInput!==n||("boolean"==typeof t.stay_open&&!1!==t.stay_open||(this._base_updateDatepicker(t),(n=this._get(t,"timepicker"))&&(i=e=0,n.$timeObj&&(e=n.$timeObj[0].selectionStart,i=n.$timeObj[0].selectionEnd),n._addTimePicker(t),n.$timeObj)&&n.$timeObj[0].setSelectionRange(e,i)),$.datepicker._datepickerShowing&&(t=$("#ui-datepicker-div"),this.$closeButton=$('<button type="button" class="ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all">Close</button>'),0===t.find(".ui-datepicker-close").length)&&(t.find(".ui-datepicker-buttonpane").append(this.$closeButton),this.$closeButton.on("click",function(){$($.datepicker._lastInput).datepicker("hide")})))},$.datepicker._base_doKeyPress=$.datepicker._doKeyPress,$.datepicker._doKeyPress=function(t){var e,i,n=$.datepicker._getInst(t.target),s=$.datepicker._get(n,"timepicker");if(s&&$.datepicker._get(n,"constrainInput"))return e=s.support.ampm,i=null!==s._defaults.showTimezone?s._defaults.showTimezone:s.support.timezone,n=$.datepicker._possibleChars($.datepicker._get(n,"dateFormat")),e=s._defaults.timeFormat.toString().replace(/[hms]/g,"").replace(/TT/g,e?"APM":"").replace(/Tt/g,e?"AaPpMm":"").replace(/tT/g,e?"AaPpMm":"").replace(/T/g,e?"AP":"").replace(/tt/g,e?"apm":"").replace(/t/g,e?"ap":"")+" "+s._defaults.separator+s._defaults.timeSuffix+(i?s._defaults.timezoneList.join(""):"")+s._defaults.amNames.join("")+s._defaults.pmNames.join("")+n,i=String.fromCharCode(void 0===t.charCode?t.keyCode:t.charCode),t.ctrlKey||i<" "||!n||-1<e.indexOf(i);return $.datepicker._base_doKeyPress(t)},$.datepicker._base_updateAlternate=$.datepicker._updateAlternate,$.datepicker._updateAlternate=function(t){var e,i,n,s,a,o,l,r=this._get(t,"timepicker");r?(e=r._defaults.altField)&&(r._defaults.altFormat||r._defaults.dateFormat,i=this._getDate(t),n=$.datepicker._getFormatConfig(t),s="",a=r._defaults.altSeparator||r._defaults.separator,o=r._defaults.altTimeSuffix||r._defaults.timeSuffix,l=null!==r._defaults.altTimeFormat?r._defaults.altTimeFormat:r._defaults.timeFormat,s+=$.datepicker.formatTime(l,r,r._defaults)+o,r._defaults.timeOnly||r._defaults.altFieldTimeOnly||null===i||(s=r._defaults.altFormat?$.datepicker.formatDate(r._defaults.altFormat,i,n)+a+s:r.formattedDate+a+s),$(e).val(t.input.val()?s:"")):$.datepicker._base_updateAlternate(t)},$.datepicker._base_doKeyUp=$.datepicker._doKeyUp,$.datepicker._doKeyUp=function(t){var e,i=$.datepicker._getInst(t.target),n=0,s=i.input.val(),a=$.datepicker._get(i,"timepicker");if(a&&s!==i.lastVal)if(a._defaults.timeOnly)try{$.datepicker._updateDatepicker(i)}catch(t){$.timepicker.log(t)}else{e=new Date(s),(s=/\.\d{3}(\d+)$/g.exec(s))&&2===s.length&&a._defaults.hasNano&&(n=Number((s[1]+"000000").substr(0,6))),a.hour=e.getHours(),a.minute=e.getMinutes(),a.second=e.getSeconds(),a.millisec=e.getMilliseconds(),a.microsec=e.getMicroseconds(),a.nanosec=n,a._limitMinMaxDateTime(i,!0),a._onTimeChange(!0);try{$.datepicker._updateDatepicker(i)}catch(t){$.timepicker.log(t)}}return $.datepicker._base_doKeyUp(t)},$.datepicker._base_gotoToday=$.datepicker._gotoToday,$.datepicker._gotoToday=function(t){var e=this._getInst($(t)[0]),t=(this._base_gotoToday(t),this._get(e,"timepicker")),i=$.timepicker.timezoneOffsetNumber(t.timezone),n=new Date;n.setMinutes(n.getMinutes()+n.getTimezoneOffset()+i),this._setTime(e,n),this._setDate(e,n),t._onSelectHandler()},$.datepicker._disableTimepickerDatepicker=function(t){var e,i=this._getInst(t);i&&(e=this._get(i,"timepicker"),$(t).datepicker("getDate"),e)&&(i.settings.showTimepicker=!1,e._defaults.showTimepicker=!1,e._updateDateTime(i))},$.datepicker._enableTimepickerDatepicker=function(t){var e,i=this._getInst(t);i&&(e=this._get(i,"timepicker"),$(t).datepicker("getDate"),e)&&(i.settings.showTimepicker=!0,e._defaults.showTimepicker=!0,e._addTimePicker(i),e._updateDateTime(i))},$.datepicker._setTime=function(t,e){var i,n=this._get(t,"timepicker");n&&(i=n._defaults,n.hour=e?e.getHours():i.hour,n.minute=e?e.getMinutes():i.minute,n.second=e?e.getSeconds():i.second,n.millisec=e?e.getMilliseconds():i.millisec,n.microsec=e?e.getMicroseconds():i.microsec,n.nanosec=e&&e.getNanoseconds?e.getNanoseconds():i.nanosec,n._limitMinMaxDateTime(t,!0),n._onTimeChange(!0),n._updateDateTime(t))},$.datepicker._setTimeDatepicker=function(t,e,i){var n,s,t=this._getInst(t);t&&(n=this._get(t,"timepicker"))&&(this._setDateFromField(t),e)&&("string"==typeof e?(n._parseTime(e,i),(s=new Date).setHours(n.hour,n.minute,n.second,n.millisec),s.setMicroseconds(n.microsec),s.setNanoseconds(n.nanosec)):((s=new Date(e.getTime())).setMicroseconds(e.getMicroseconds()),s.setNanoseconds(e.getNanoseconds())),"Invalid Date"===s.toString()&&(s=void 0),this._setTime(t,s))},$.datepicker._base_setDateDatepicker=$.datepicker._setDateDatepicker,$.datepicker._setDateDatepicker=function(t,e){var i,n,s=this._getInst(t),a=e;s&&("string"!=typeof e||(a=new Date(e)).getTime()||(this._base_setDateDatepicker.apply(this,arguments),a=$(t).datepicker("getDate")),i=this._get(s,"timepicker"),a instanceof Date?((n=new Date(a.getTime())).setMicroseconds(a.getMicroseconds()),n.setNanoseconds(a.getNanoseconds())):n=a,i&&n&&(i.support.timezone||null!==i._defaults.timezone||(i.timezone=-1*n.getTimezoneOffset()),a=$.timepicker.timezoneAdjust(a,i.timezone),n=$.timepicker.timezoneAdjust(n,i.timezone)),this._updateDatepicker(s),this._base_setDateDatepicker.apply(this,arguments),this._setTimeDatepicker(t,n,!0))},$.datepicker._base_getDateDatepicker=$.datepicker._getDateDatepicker,$.datepicker._getDateDatepicker=function(t,e){var i,n,s,a=this._getInst(t);if(a)return(i=this._get(a,"timepicker"))?(void 0===a.lastVal&&this._setDateFromField(a,e),n=this._getDate(a),s=$.trim(i.$altInput&&i._defaults.altFieldTimeOnly?i.$input.val()+" "+i.$altInput.val():i.$input.val()),n&&i._parseTime(s,!a.settings.timeOnly)&&(n.setHours(i.hour,i.minute,i.second,i.millisec),n.setMicroseconds(i.microsec),n.setNanoseconds(i.nanosec),null!=i.timezone)&&(i.support.timezone||null!==i._defaults.timezone||(i.timezone=-1*n.getTimezoneOffset()),n=$.timepicker.timezoneAdjust(n,i.timezone)),n):this._base_getDateDatepicker(t,e)},$.datepicker._base_parseDate=$.datepicker.parseDate,$.datepicker.parseDate=function(e,i,n){var s;try{s=this._base_parseDate(e,i,n)}catch(t){if(!(0<=t.indexOf(":")))throw t;s=this._base_parseDate(e,i.substring(0,i.length-(t.length-t.indexOf(":")-2)),n),$.timepicker.log("Error parsing the date string: "+t+"\ndate string = "+i+"\ndate format = "+e)}return s},$.datepicker._base_formatDate=$.datepicker._formatDate,$.datepicker._formatDate=function(t,e,i,n){var s=this._get(t,"timepicker");return s?(s._updateDateTime(t),s.$input.val()):this._base_formatDate(t)},$.datepicker._base_optionDatepicker=$.datepicker._optionDatepicker,$.datepicker._optionDatepicker=function(t,e,i){var n,s=this._getInst(t);if(!s)return null;s=this._get(s,"timepicker");if(s){var a,o=null,l=null,r=null,c=s._defaults.evnts,u={};if("string"==typeof e){if("minDate"===e||"minDateTime"===e)o=i;else if("maxDate"===e||"maxDateTime"===e)l=i;else if("onSelect"===e)r=i;else if(c.hasOwnProperty(e)){if(void 0===i)return c[e];u[e]=i,n={}}}else if("object"==typeof e)for(a in e.minDate?o=e.minDate:e.minDateTime?o=e.minDateTime:e.maxDate?l=e.maxDate:e.maxDateTime&&(l=e.maxDateTime),c)c.hasOwnProperty(a)&&e[a]&&(u[a]=e[a]);for(a in u)u.hasOwnProperty(a)&&(c[a]=u[a],delete(n=n||$.extend({},e))[a]);if(n&&isEmptyObject(n))return;if(o?(o=0===o?new Date:new Date(o),s._defaults.minDate=o,s._defaults.minDateTime=o):l?(l=0===l?new Date:new Date(l),s._defaults.maxDate=l,s._defaults.maxDateTime=l):r&&(s._defaults.onSelect=r),o||l)return r=(s=$(t)).datetimepicker("getDate"),o=this._base_optionDatepicker.call($.datepicker,t,n||e,i),s.datetimepicker("setDate",r),o}return void 0===i?this._base_optionDatepicker.call($.datepicker,t,e):this._base_optionDatepicker.call($.datepicker,t,n||e,i)},isEmptyObject=function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0},extendRemove=function(t,e){for(var i in $.extend(t,e),e)null!==e[i]&&void 0!==e[i]||(t[i]=e[i]);return t},detectSupport=function(t){function e(t,e){return-1!==t.indexOf(e)}var i=t.replace(/'.*?'/g,"").toLowerCase();return{hour:e(i,"h"),minute:e(i,"m"),second:e(i,"s"),millisec:e(i,"l"),microsec:e(i,"c"),timezone:e(i,"z"),ampm:e(i,"t")&&e(t,"h"),iso8601:e(t,"Z")}},convert24to12=function(t){return 0===(t%=12)&&(t=12),String(t)},computeEffectiveSetting=function(t,e){return(t&&t[e]?t:$.timepicker._defaults)[e]},splitDateTime=function(t,e){var i=computeEffectiveSetting(e,"separator"),e=computeEffectiveSetting(e,"timeFormat").split(i).length,n=t.split(i),s=n.length;return 1<s?{dateString:n.splice(0,s-e).join(i),timeString:n.splice(0,e).join(i)}:{dateString:t,timeString:""}},parseDateTimeInternal=function(t,e,i,n,s){i=splitDateTime(i,s),t=$.datepicker._base_parseDate(t,i.dateString,n);if(""===i.timeString)return{date:t};if(n=$.datepicker.parseTime(e,i.timeString,s))return{date:t,timeObj:n};throw"Wrong time format"},selectLocalTimezone=function(t,e){t&&t.timezone_select&&(e=e||new Date,t.timezone_select.val(-e.getTimezoneOffset()))},$.timepicker=new Timepicker,$.timepicker.timezoneOffsetString=function(t,e){var i;return!(isNaN(t)||840<t||t<-720)&&(i=t%60,e=e?":":"","+00:00"==(t=(0<=t?"+":"-")+("0"+Math.abs((t-i)/60)).slice(-2)+e+("0"+Math.abs(i)).slice(-2)))?"Z":t},$.timepicker.timezoneOffsetNumber=function(t){var e=t.toString().replace(":","");return"Z"===e.toUpperCase()?0:/^(\-|\+)\d{4}$/.test(e)?("-"===e.substr(0,1)?-1:1)*(60*parseInt(e.substr(1,2),10)+parseInt(e.substr(3,2),10)):t},$.timepicker.timezoneAdjust=function(t,e){e=$.timepicker.timezoneOffsetNumber(e);return isNaN(e)||t.setMinutes(t.getMinutes()+-t.getTimezoneOffset()-e),t},$.timepicker.timeRange=function(t,e,i){return $.timepicker.handleRange("timepicker",t,e,i)},$.timepicker.datetimeRange=function(t,e,i){$.timepicker.handleRange("datetimepicker",t,e,i)},$.timepicker.dateRange=function(t,e,i){$.timepicker.handleRange("datepicker",t,e,i)},$.timepicker.handleRange=function(o,l,r,c){c=$.extend({},{minInterval:0,maxInterval:0,start:{},end:{}},c);var t=!1;function i(t,e){var i,n,s=l[o]("getDate"),a=r[o]("getDate"),t=t[o]("getDate");null!==s&&(i=new Date(s.getTime()),n=new Date(s.getTime()),i.setMilliseconds(i.getMilliseconds()+c.minInterval),n.setMilliseconds(n.getMilliseconds()+c.maxInterval),0<c.minInterval&&a<i?r[o]("setDate",i):0<c.maxInterval&&n<a?r[o]("setDate",n):a<s&&e[o]("setDate",t))}function e(t,e,i){t.val()&&(null!==(t=t[o].call(t,"getDate"))&&0<c.minInterval&&("minDate"===i&&t.setMilliseconds(t.getMilliseconds()+c.minInterval),"maxDate"===i)&&t.setMilliseconds(t.getMilliseconds()-c.minInterval),t.getTime)&&e[o].call(e,"option",i,t)}return"timepicker"===o&&(t=!0,o="datetimepicker"),$.fn[o].call(l,$.extend({timeOnly:t,onClose:function(t,e){i($(this),r)},onSelect:function(t){e($(this),r,"minDate")}},c,c.start)),$.fn[o].call(r,$.extend({timeOnly:t,onClose:function(t,e){i($(this),l)},onSelect:function(t){e($(this),l,"maxDate")}},c,c.end)),i(l,r),e(l,r,"minDate"),e(r,l,"maxDate"),$([l.get(0),r.get(0)])},$.timepicker.log=function(){window.console&&window.console.log.apply(window.console,Array.prototype.slice.call(arguments))},$.timepicker._util={_extendRemove:extendRemove,_isEmptyObject:isEmptyObject,_convert24to12:convert24to12,_detectSupport:detectSupport,_selectLocalTimezone:selectLocalTimezone,_computeEffectiveSetting:computeEffectiveSetting,_splitDateTime:splitDateTime,_parseDateTimeInternal:parseDateTimeInternal},Date.prototype.getMicroseconds||(Date.prototype.microseconds=0,Date.prototype.getMicroseconds=function(){return this.microseconds},Date.prototype.setMicroseconds=function(t){return this.setMilliseconds(this.getMilliseconds()+Math.floor(t/1e3)),this.microseconds=t%1e3,this}),$.timepicker.version="1.6.1")}),!function(t){t(jQuery)}(function($){var Timespinner,isEmptyObject,extendRemove,detectSupport,convert24to12,computeEffectiveSetting,splitDateTime,parseDateTimeInternal,selectLocalTimezone;$.ui.timespinner=$.ui.timespinner||{},$.ui.timespinner.version||($.extend($.ui,{timespinner:{version:"1.6.1"}}),Timespinner=function(){this.regional=[],this.regional[""]={currentText:"Now",closeText:"Done",amNames:["AM","A"],pmNames:["PM","P"],timeFormat:"HH:mm",timeSuffix:"",timeOnlyTitle:"Choose Time",timeText:"Time",hourText:"Hour",minuteText:"Minute",secondText:"Second",millisecText:"Millisecond",microsecText:"Microsecond",timezoneText:"Time Zone",isRTL:!1},this._defaults={showButtonPanel:!0,timeOnly:!1,timeOnlyShowDate:!1,showHour:null,showMinute:null,showSecond:null,showMillisec:null,showMicrosec:null,showTimezone:null,showTime:!0,stepHour:1,stepMinute:1,stepSecond:1,stepMillisec:1,stepMicrosec:1,hour:0,minute:0,second:0,millisec:0,microsec:0,nanosec:0,timezone:null,hourMin:0,minuteMin:0,secondMin:0,millisecMin:0,microsecMin:0,hourMax:23,minuteMax:59,secondMax:59,millisecMax:999,microsecMax:999,minDateTime:null,maxDateTime:null,maxTime:null,minTime:null,onSelect:null,hourGrid:0,minuteGrid:0,secondGrid:0,millisecGrid:0,microsecGrid:0,alwaysSetTime:!0,separator:" ",altFieldTimeOnly:!0,altTimeFormat:null,altSeparator:null,altTimeSuffix:null,altRedirectFocus:!0,pickerTimeFormat:null,pickerTimeSuffix:null,showTimespinner:!0,timezoneList:null,addSliderAccess:!1,sliderAccessArgs:null,controlType:"slider",oneLine:!1,defaultValue:null,parse:"strict",afterInject:null},$.extend(this._defaults,this.regional[""])},$.extend(Timespinner.prototype,{$input:null,$altInput:null,$timeObj:null,inst:null,hour_slider:null,minute_slider:null,second_slider:null,millisec_slider:null,microsec_slider:null,timezone_select:null,maxTime:null,minTime:null,hour:0,minute:0,second:0,millisec:0,microsec:0,timezone:null,hourMinOriginal:null,minuteMinOriginal:null,secondMinOriginal:null,millisecMinOriginal:null,microsecMinOriginal:null,hourMaxOriginal:null,minuteMaxOriginal:null,secondMaxOriginal:null,millisecMaxOriginal:null,microsecMaxOriginal:null,ampm:"",formattedDate:"",formattedTime:"",formattedDateTime:"",timezoneList:null,units:["hour","minute","second","millisec","microsec"],support:{},control:null,cursorLocation:null,setDefaults:function(t){return extendRemove(this._defaults,t||{}),this},_newInst:function($input,opts){var tp_inst=new Timespinner,inlineSettings={},fns={},overrides,i,attrName;for(attrName in this._defaults)if(this._defaults.hasOwnProperty(attrName)){var attrValue=$input.attr("time:"+attrName);if(attrValue)try{inlineSettings[attrName]=eval(attrValue)}catch(err){inlineSettings[attrName]=attrValue}}for(i in overrides={beforeShow:function(t,e){if($.isFunction(tp_inst._defaults.evnts.beforeShow))return tp_inst._defaults.evnts.beforeShow.call($input[0],t,e,tp_inst)},onChangeMonthYear:function(t,e,i){$.isFunction(tp_inst._defaults.evnts.onChangeMonthYear)&&tp_inst._defaults.evnts.onChangeMonthYear.call($input[0],t,e,i,tp_inst)},onClose:function(t,e){!0===tp_inst.timeDefined&&""!==$input.val()&&tp_inst._updateDateTime(e),$.isFunction(tp_inst._defaults.evnts.onClose)&&tp_inst._defaults.evnts.onClose.call($input[0],t,e,tp_inst)}},overrides)overrides.hasOwnProperty(i)&&(fns[i]=opts[i]||this._defaults[i]||null);tp_inst._defaults=$.extend({},this._defaults,inlineSettings,opts,overrides,{evnts:fns,timepicker:tp_inst}),tp_inst.amNames=$.map(tp_inst._defaults.amNames,function(t){return t.toUpperCase()}),tp_inst.pmNames=$.map(tp_inst._defaults.pmNames,function(t){return t.toUpperCase()}),tp_inst.support=detectSupport(tp_inst._defaults.timeFormat+(tp_inst._defaults.pickerTimeFormat||"")+(tp_inst._defaults.altTimeFormat||"")),"string"==typeof tp_inst._defaults.controlType?("slider"===tp_inst._defaults.controlType&&void 0===$.ui.slider&&(tp_inst._defaults.controlType="select"),tp_inst.control=tp_inst._controls[tp_inst._defaults.controlType]):tp_inst.control=tp_inst._defaults.controlType;var timezoneList=[-720,-660,-600,-570,-540,-480,-420,-360,-300,-270,-240,-210,-180,-120,-60,0,60,120,180,210,240,270,300,330,345,360,390,420,480,525,540,570,600,630,660,690,720,765,780,840],tzl=(null!==tp_inst._defaults.timezoneList&&(timezoneList=tp_inst._defaults.timezoneList),timezoneList.length),tzi=0,tzv=null;if(0<tzl&&"object"!=typeof timezoneList[0])for(;tzi<tzl;tzi++)tzv=timezoneList[tzi],timezoneList[tzi]={value:tzv,label:$.timespinner.timezoneOffsetString(tzv,tp_inst.support.iso8601)};return tp_inst._defaults.timezoneList=timezoneList,tp_inst.timezone=null!==tp_inst._defaults.timezone?$.timespinner.timezoneOffsetNumber(tp_inst._defaults.timezone):-1*(new Date).getTimezoneOffset(),tp_inst.hour=tp_inst._defaults.hour<tp_inst._defaults.hourMin?tp_inst._defaults.hourMin:tp_inst._defaults.hour>tp_inst._defaults.hourMax?tp_inst._defaults.hourMax:tp_inst._defaults.hour,tp_inst.minute=tp_inst._defaults.minute<tp_inst._defaults.minuteMin?tp_inst._defaults.minuteMin:tp_inst._defaults.minute>tp_inst._defaults.minuteMax?tp_inst._defaults.minuteMax:tp_inst._defaults.minute,tp_inst.second=tp_inst._defaults.second<tp_inst._defaults.secondMin?tp_inst._defaults.secondMin:tp_inst._defaults.second>tp_inst._defaults.secondMax?tp_inst._defaults.secondMax:tp_inst._defaults.second,tp_inst.millisec=tp_inst._defaults.millisec<tp_inst._defaults.millisecMin?tp_inst._defaults.millisecMin:tp_inst._defaults.millisec>tp_inst._defaults.millisecMax?tp_inst._defaults.millisecMax:tp_inst._defaults.millisec,tp_inst.nanosec=tp_inst._defaults.nanosec<tp_inst._defaults.nanosecMin?tp_inst._defaults.nanosecMin:tp_inst._defaults.nanosec>tp_inst._defaults.nanosecMax?tp_inst._defaults.nanosecMax:tp_inst._defaults.nanosec,tp_inst.ampm="",tp_inst.$input=$input,tp_inst._defaults.altField&&(tp_inst.$altInput=$(tp_inst._defaults.altField),!0===tp_inst._defaults.altRedirectFocus)&&tp_inst.$altInput.css({cursor:"pointer"}).focus(function(){$input.trigger("focus")}),0!==tp_inst._defaults.minDate&&0!==tp_inst._defaults.minDateTime||(tp_inst._defaults.minDate=new Date),0!==tp_inst._defaults.maxDate&&0!==tp_inst._defaults.maxDateTime||(tp_inst._defaults.maxDate=new Date),void 0!==tp_inst._defaults.minDate&&tp_inst._defaults.minDate instanceof Date&&(tp_inst._defaults.minDateTime=new Date(tp_inst._defaults.minDate.getTime())),void 0!==tp_inst._defaults.minDateTime&&tp_inst._defaults.minDateTime instanceof Date&&(tp_inst._defaults.minDate=new Date(tp_inst._defaults.minDateTime.getTime())),void 0!==tp_inst._defaults.maxDate&&tp_inst._defaults.maxDate instanceof Date&&(tp_inst._defaults.maxDateTime=new Date(tp_inst._defaults.maxDate.getTime())),void 0!==tp_inst._defaults.maxDateTime&&tp_inst._defaults.maxDateTime instanceof Date&&(tp_inst._defaults.maxDate=new Date(tp_inst._defaults.maxDateTime.getTime())),tp_inst.$input.bind("focus",function(){tp_inst._onFocus()}),tp_inst},_addTimePicker:function(t){this.cursorLocation=this.$input[0].selectionStart;var e=$.trim(this.$altInput&&this._defaults.altFieldTimeOnly?this.$input.val()+" "+this.$altInput.val():this.$input.val());this.timeDefined=this._parseTime(e),this._injectTimeSpinner(),this._afterInject()},_parseTime:function(e,i){if(this.inst||(this.inst=$.datepicker._getInst(this.$input[0])),!i&&this._defaults.timeOnly)return!!(i=$.datepicker.parseTime(this._defaults.timeFormat,e,this._defaults))&&($.extend(this,i),!0);i=$.datepicker._get(this.inst,"dateFormat");try{var t=parseDateTimeInternal(i,this._defaults.timeFormat,e,$.datepicker._getFormatConfig(this.inst),this._defaults);if(!t.timeObj)return!1;$.extend(this,t.timeObj)}catch(t){return $.timespinner.log("Error parsing the date/time string: "+t+"\ndate/time string = "+e+"\ntimeFormat = "+this._defaults.timeFormat+"\ndateFormat = "+i),!1}return!0},_afterInject:function(){var t=this.inst.settings;$.isFunction(t.afterInject)&&t.afterInject.call(this)},_injectTimeSpinner:function(){var t,e,i=this.inst.dpDiv,n=this.inst.settings,s=this;0===i.find("div.ui-timespinner-div").length&&n.showTimespinner&&(t=$(' <div class="ui-timespinner-div"><input type="text" value=""></div>'),(e=i.find(".ui-datepicker-buttonpane")).length?e.before(t):i.append(t),this.$timeObj=t.find("input"),this.$timeObj.timespinner(n),this.$timeObj.timespinner("value",s.formattedTime),this.$timeObj.on("change input",function(){var t=s.inst.settings.timeFormat,t=moment(this.value,t).toObject(),e=(s.$timeObj&&(e=s.$timeObj.timespinner("value").toString(),e=(n.hasNano?e.substring(e.length-6,e.length):"")||0,e=n.hasNano?Number(e/1e6).toFixed(6).substring(2,8):"",t.nanoseconds=n.hasNano?Number(e/1e6).toFixed(6).substring(2,8):""),new Date);t?(e.setHours(t.hours),e.setMinutes(t.minutes),e.setSeconds(t.seconds),e.setMilliseconds(t.milliseconds),e.setNanoseconds(t.nanoseconds),$.datepicker._setTime(s.inst,e)):(this.value=s.formattedTime,this.blur()),s.forceCaret()}),null!==this.inst)&&(e=this.timeDefined,this._onTimeChange(!0),this.timeDefined=e)},forceCaret:function(){this.$timeObj&&this.$timeObj.is(":focus")&&_.debounce(function(){var t,e,i=this,n=this.inst.settings;i.$timeObj&&(t=i.$timeObj[0].selectionStart,e=i.$timeObj[0].selectionEnd,n.onSelect(),i.$timeObj[0].focus(),i.$timeObj[0].setSelectionRange(t,e))},500)},_limitMinMaxDateTime:function(t,e){},_onTimeChange:function(t){var e,i,n,s,a,o,l,r;this._defaults.showTimespinner&&(i="",l=((r=(o=this._defaults).timeFormat||"HH:mm:ss.SSS").match(/S/g)||[]).length-3,r=r.replace(/S{3,9}/,"SSS"),t?(e=moment({hours:this.hour,minutes:this.minute,seconds:this.second,milliseconds:this.millisec,nanoseconds:this.nanosec}),i=o.hasNano?Number(this.nanosec/Math.pow(10,l)).toFixed(l).substring(2,2+l):""):(t=this.$timeObj.timespinner("value").toString(),e=(o.hasNano?t.substring(0,t.length-l):t)||0,i=(o.hasNano?t.substring(t.length-l,t.length):"")||0,e=moment(e,"x"),i=o.hasNano?Number(i/Math.pow(10,l)).toFixed(l).substring(2,2+l):"",e=moment(this.$timeObj.val(),r)),e.isValid())&&(o=(t=e.toObject()).hours,l=t.minutes,n=t.seconds,t=t.milliseconds,s=Number(i)||0,(a=o!==parseInt(this.hour,10)||l!==parseInt(this.minute,10)||n!==parseInt(this.second,10)||t!==parseInt(this.millisec,10)||s!==parseInt(this.nanosec,10))&&(!1!==o&&(this.hour=o),!1!==l&&(this.minute=l),!1!==n&&(this.second=n),!1!==t&&(this.millisec=t),!1!==s&&(this.nanosec=s),this.inst||(this.inst=$.datepicker._getInst(this.$input[0]))),this.formattedTime=e.format(r)+i,this.$timeObj&&(o=this.$timeObj[0].selectionStart,l=this.$timeObj[0].selectionEnd,this.$timeObj.val(this.formattedTime),this.$timeObj[0].setSelectionRange(o,l)),a)&&this._updateDateTime()},_onSelectHandler:function(){var t=this._defaults.onSelect||this.inst.settings.onSelect,e=this.$input?this.$input[0]:null;t&&e&&t.apply(e,[this.formattedDateTime,this])},_updateDateTime:function(t){var e=0<(t=this.inst||t).currentYear?new Date(t.currentYear,t.currentMonth,t.currentDay):new Date(t.selectedYear,t.selectedMonth,t.selectedDay),e=$.datepicker._daylightSavingAdjust(e),i=$.datepicker._get(t,"dateFormat"),t=$.datepicker._getFormatConfig(t),n=null!==e&&this.timeDefined,i=(this.formattedDate=$.datepicker.formatDate(i,null===e?new Date:e,t),this.formattedDate);!0===this._defaults.timeOnly&&!1===this._defaults.timeOnlyShowDate?i=this.formattedTime:(!0!==this._defaults.timeOnly&&(this._defaults.alwaysSetTime||n)||!0===this._defaults.timeOnly&&!0===this._defaults.timeOnlyShowDate)&&(i+=this._defaults.separator+this.formattedTime+this._defaults.timeSuffix),this.formattedDateTime=i,this._defaults.showTimespinner?this.$input.val(i):this.$input.val(this.formattedDate),this.$input.trigger("change"),this.forceCaret()},_onFocus:function(){if(!this.$input.val()&&this._defaults.defaultValue){this.$input.val(this._defaults.defaultValue);var t=$.datepicker._getInst(this.$input.get(0)),e=$.datepicker._get(t,"timepicker");if(e&&e._defaults.timeOnly&&t.input.val()!==t.lastVal)try{$.datepicker._updateDatepicker(t)}catch(t){$.timespinner.log(t)}}},_controls:{slider:{},select:{}}}),$.fn.extend({datetimespinner:function(e){e=e||{};var i=arguments;return"string"==typeof e?"getDate"===e||"option"===e&&2===i.length&&"string"==typeof i[1]?$.fn.datepicker.apply($(this[0]),i):this.each(function(){var t=$(this);t.datepicker.apply(t,i)}):this.each(function(){var t=$(this);t.datepicker($.timespinner._newInst(t,e)._defaults)})}}),isEmptyObject=function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0},extendRemove=function(t,e){for(var i in $.extend(t,e),e)null!==e[i]&&void 0!==e[i]||(t[i]=e[i]);return t},detectSupport=function(t){function e(t,e){return-1!==t.indexOf(e)}var i=t.replace(/'.*?'/g,"").toLowerCase();return{hour:e(i,"h"),minute:e(i,"m"),second:e(i,"s"),millisec:e(i,"l"),microsec:e(i,"c"),timezone:e(i,"z"),ampm:e(i,"t")&&e(t,"h"),iso8601:e(t,"Z")}},convert24to12=function(t){return 0===(t%=12)&&(t=12),String(t)},computeEffectiveSetting=function(t,e){return(t&&t[e]?t:$.timespinner._defaults)[e]},splitDateTime=function(t,e){var i=computeEffectiveSetting(e,"separator"),e=computeEffectiveSetting(e,"timeFormat").split(i).length,n=t.split(i),s=n.length;return 1<s?{dateString:n.splice(0,s-e).join(i),timeString:n.splice(0,e).join(i)}:{dateString:t,timeString:""}},parseDateTimeInternal=function(t,e,i,n,s){i=splitDateTime(i,s),s=$.datepicker._base_parseDate(t,i.dateString,n);if(""===i.timeString)return{date:s};if(t=moment(i.timeString,e).format(e))return{date:s,timeObj:t};throw"Wrong time format"},selectLocalTimezone=function(t,e){t&&t.timezone_select&&(e=e||new Date,t.timezone_select.val(-e.getTimezoneOffset()))},$.timespinner=new Timespinner,$.timespinner.timezoneOffsetString=function(t,e){var i;return!(isNaN(t)||840<t||t<-720)&&(i=t%60,e=e?":":"","+00:00"==(t=(0<=t?"+":"-")+("0"+Math.abs((t-i)/60)).slice(-2)+e+("0"+Math.abs(i)).slice(-2)))?"Z":t},$.timespinner.timezoneOffsetNumber=function(t){var e=t.toString().replace(":","");return"Z"===e.toUpperCase()?0:/^(\-|\+)\d{4}$/.test(e)?("-"===e.substr(0,1)?-1:1)*(60*parseInt(e.substr(1,2),10)+parseInt(e.substr(3,2),10)):t},$.timespinner.timezoneAdjust=function(t,e){e=$.timespinner.timezoneOffsetNumber(e);return isNaN(e)||t.setMinutes(t.getMinutes()+-t.getTimezoneOffset()-e),t},$.timespinner.timeRange=function(t,e,i){return $.timespinner.handleRange("timespinner",t,e,i)},$.timespinner.datetimeRange=function(t,e,i){$.timespinner.handleRange("datetimespinner",t,e,i)},$.timespinner.dateRange=function(t,e,i){$.timespinner.handleRange("datepicker",t,e,i)},$.timespinner.handleRange=function(o,l,r,c){c=$.extend({},{minInterval:0,maxInterval:0,start:{},end:{}},c);var t=!1;function i(t,e){var i,n,s=l[o]("getDate"),a=r[o]("getDate"),t=t[o]("getDate");null!==s&&(i=new Date(s.getTime()),n=new Date(s.getTime()),i.setMilliseconds(i.getMilliseconds()+c.minInterval),n.setMilliseconds(n.getMilliseconds()+c.maxInterval),0<c.minInterval&&a<i?r[o]("setDate",i):0<c.maxInterval&&n<a?r[o]("setDate",n):a<s&&e[o]("setDate",t))}function e(t,e,i){t.val()&&(null!==(t=t[o].call(t,"getDate"))&&0<c.minInterval&&("minDate"===i&&t.setMilliseconds(t.getMilliseconds()+c.minInterval),"maxDate"===i)&&t.setMilliseconds(t.getMilliseconds()-c.minInterval),t.getTime)&&e[o].call(e,"option",i,t)}return"timespinner"===o&&(t=!0,o="datetimespinner"),$.fn[o].call(l,$.extend({timeOnly:t,onClose:function(t,e){i($(this),r)},onSelect:function(t){e($(this),r,"minDate")}},c,c.start)),$.fn[o].call(r,$.extend({timeOnly:t,onClose:function(t,e){i($(this),l)},onSelect:function(t){e($(this),l,"maxDate")}},c,c.end)),i(l,r),e(l,r,"minDate"),e(r,l,"maxDate"),$([l.get(0),r.get(0)])},$.timespinner.log=function(){window.console&&window.console.log.apply(window.console,Array.prototype.slice.call(arguments))},$.timespinner._util={_extendRemove:extendRemove,_isEmptyObject:isEmptyObject,_convert24to12:convert24to12,_detectSupport:detectSupport,_selectLocalTimezone:selectLocalTimezone,_computeEffectiveSetting:computeEffectiveSetting,_splitDateTime:splitDateTime,_parseDateTimeInternal:parseDateTimeInternal},Date.prototype.getNanoseconds||(Date.prototype.nanoseconds=0,Date.prototype.getNanoseconds=function(){return this.nanoseconds},Date.prototype.setNanoseconds=function(t){return t=t||0,this.setMilliseconds(this.getMilliseconds()+Math.floor(t/1e6)),this.nanoseconds=t%1e6,this}),$.timespinner.version="1.6.1")}),Form.editors.DateTimePicker=Form.editors.DateTimeBase.extend({initialize:function(t){var e,i=this;Form.editors.DateTimeBase.prototype.initialize.call(this,t=t||{},this),this.options=t,this.schema=$.extend(!0,{options:{dateFormat:"yy-mm-dd",timeInput:!0,timeFormat:"HH:mm",closeText:"Close",changeMonth:!0,changeYear:!0,showAnim:"slideDown",showOn:"focus",availableDates:null}},t.schema||{}),this.schema.options.minDate=_.isEmpty(this.schema.options.availableDates)?null:_.min(this.schema.options.availableDates),this.schema.options.maxDate=_.isEmpty(this.schema.options.availableDates)?null:_.max(this.schema.options.availableDates),this.schema.options.isTimestamp&&(this.schema.options.max=86399999999999),this.schema.options.onSelect=function(t,e){e&&(e.inline=!0),i.trigger("valid",i),i.updateHidden()},this.schema.options.onClose=function(t,e){e.inline=!1,i.$dateTimeInput.trigger("keyup"),i.trigger("close",i)},this.momentFormat=(this.schema.options.dateFormat?this.schema.options.dateFormat.replace("yy","YYYY").toUpperCase():"")+" "+this.schema.options.timeFormat,this.value||((e=new Date).setSeconds(0),e.setMilliseconds(0),this.value=e),this.template=t.template||this.constructor.template},initializeEvents:function(){var n=this;Form.editors.DateTimeBase.prototype.render.call(this,this.$dateTimeInput),this.$dateTimeInput.on("focus",function(){n.hasFocus||n.trigger("focus",n)}),this.$dateTimeInput.on("keyup",function(t){var e=n.$dateTimeInput.val(),i=Tools.convertUserInputToMoment(e,n.momentFormat);_.includes([37,38,39,40],t.keyCode)||(i.isValid()&&moment(e,n.momentFormat,!0).isValid()?n.isInAvailableDatesList(e)?(t=i.toDashString(),n.setValue(t),n.trigger("change",n)):n.trigger("unavailable",n):n.trigger("invalid",n))}),this.$dateTimeInput.on("blur",function(){n.hasFocus&&setTimeout(function(){n.$("input:focus")[0]||n.trigger("blur",n)},0)})},blur:function(){this.hasFocus&&this.$dateTimeInput.first().blur()},convertISOStringToDate:function(t){var e,i;return _.isDate(t)?t:!!(i=/^(?:\d\d\d\d-\d\d-\d\dT)?(\d{2}:\d{2}:\d{2}.(?:\d{9}|\d{3}))(?:Z)?$/.exec(t))&&(e=new Date(t),i[1]&&"string"==typeof t&&(t=i[1].substring(12,6),e.nanoseconds=Number(t)),e)},focus:function(){this.hasFocus||this.$dateTimeInput.first().focus()},getValue:function(){var t=this.schema&&this.schema.options&&this.schema.options.ignoreTimezone,t=Tools.convertUserInputToMoment(this.$dateTimeInput.val(),this.momentFormat,t);return this.schema.options.hasNano?t.toISOStringNano():t.toISOString()},getWidth:function(){return this.schema.options.width},hide:function(){return this.$dateTimeInput.datetimespinner("hide")},render:function(){var t=this.options,e=this.schema,s=Backbone.$,i=t.id,t=(!i&&t.item&&(i=t.item.cid),s(this.template({key:i})));return this.$dateTimeInput=t.find("input"),this.$dateTimeInput.addClass("ui-state-default"),e.editorClass&&this.$dateTimeInput.addClass(e.editorClass),this.$dateTimeInput.datetimespinner(e.options),s.datepicker._gotoToday=function(t){var e=this._getInst(s(t)[0]),i=(this._base_gotoToday(t),this._get(e,"timepicker")),n=Tools.convertMomentToDatePicker(Tools.convertValueToMoment());this._setTime(e,n),this._setDate(e,n),i._onSelectHandler(),this._setDateDatepicker(s(t)[0],n)},_.set(this.$dateTimeInput.datetimespinner(),"0.readOnly",_.get(this.schema,"options.readOnly")),this.$hidden=s('<input type="hidden" name="'+this.key+'">'),t.append(this.$hidden),this.setValue(this.value),this.setElement(t),this.$el.attr("name",this.getName()),this.hasFocus&&this.trigger("blur",this),this.initializeEvents(),this},setValue:function(t){var e=this.schema&&this.schema.options&&this.schema.options.ignoreTimezone,i=t;(t=t&&10===t.length?Tools.convertUserInputToMoment(t+"T00:00:00.000",void 0,e):_.isString(t)&&"1970-01-01"===t.substr(0,10)?Tools.convertUserInputToMoment(t.replace("Z",""),void 0,e):""===t?Tools.convertValueToMoment():Tools.convertValueToMoment(t,void 0,e))&&t.isValid()?this.isInAvailableDatesList(t)?(this.$dateTimeInput.datetimespinner("setDate",Tools.convertMomentToDatePicker(t,e)),this.updateHidden(),this.previousDate=i):this.trigger("unavailable",this):this.trigger("invalid",this)},setAvailableDates:function(t){this.schema.options.availableDates=t,this.schema.options.minDate=_.isEmpty(t)?null:_.min(t),this.schema.options.maxDate=_.isEmpty(t)?null:_.max(t),this.$dateTimeInput.datetimespinner("option",{minDate:this.schema.options.minDate,maxDate:this.schema.options.maxDate})},isInAvailableDatesList:function(t){return!!_.isEmpty(this.schema.options.availableDates)||(t=Tools.convertValueToMoment(t,"1214",!0).toDashString(),_.includes(this.schema.options.availableDates,t))},setWidth:function(t){var e=0<this.$el.closest(".datepicker-container").find(".timestamp-extended").length?2:1,i=this.$el.closest(".datepicker-input"),n=this.$el.closest(".datepicker-container").find(".datepicker-button");n.length&&(n=n[0].getBoundingClientRect().width,i.width(t-n-e))},show:function(){return this.$dateTimeInput.datetimespinner("show")},updateHidden:function(){var t=this.getValue();_.isDate(t)&&!_.isNaN(t.getTime())&&(t=t.toISOString()),this.$hidden.val(t)},updateDateInputField:function(t){var e=this.schema&&this.schema.options&&this.schema.options.ignoreTimezone,i=t;(t=t&&10===t.length?Tools.convertUserInputToMoment(t+"T00:00:00.000",void 0,e):_.isString(t)&&"1970-01-01"===t.substr(0,10)?Tools.convertUserInputToMoment(t.replace("Z",""),void 0,e):""===t?Tools.convertValueToMoment():Tools.convertValueToMoment(t,void 0,e))&&t.isValid()?(this.$dateTimeInput.datetimespinner("option",{minDate:null,maxDate:null}),this.$dateTimeInput.datetimespinner("setDate",Tools.convertMomentToDatePicker(t,e)),t=this.$dateTimeInput[0].value,this.$dateTimeInput.datetimespinner("option",{minDate:this.schema.options.minDate,maxDate:this.schema.options.maxDate}),this.$dateTimeInput[0].value=t):"string"==typeof i&&(this.$dateTimeInput[0].value=i)}}),Form.editors.DateRangePicker=Form.editors.DateTimeBase.extend({initialize:function(t){var e,i,n=this;Form.editors.DateTimeBase.prototype.initialize.call(this,t=t||{},this),new Date;this.options=_.extend({fpDateFormat:"Y-m-d"},t),this.schema=$.extend(!0,{options:{closeOnSelect:!1,mode:"range"}},t.schema||{}),this.schema.options.minDate=_.isEmpty(this.schema.options.availableDates)?null:_.min(this.schema.options.availableDates),this.schema.options.maxDate=_.isEmpty(this.schema.options.availableDates)?null:_.max(this.schema.options.availableDates),this.schema.options.onClose=function(){n.isInvalidRangeStart=!1,n.trigger("close")},this.momentFormat="YYYY-MM-DD",this.value&&!_.isDate(this.value)&&(this.value=new Date(this.value)),this.value&&this.value instanceof Array||((e=new Date).setHours(0,0,0,0),(i=new Date).setHours(24,0,0,0),this.value=[e,i]),this.template=t.template||this.constructor.template,this.previousDate=void 0,this.focusedField=null,this.isInvalidRangeStart=!1},initializeEvents:function(){Form.editors.DateTimeBase.prototype.render.call(this,$(this.startDateInput)),Form.editors.DateTimeBase.prototype.render.call(this,$(this.endDateInput)),this.startDateInput.addEventListener("change",this.onDateInputsChange.bind(this)),this.endDateInput.addEventListener("change",this.onDateInputsChange.bind(this)),this.startDateInput.addEventListener("keyup",this.onDateInputsKeyUp.bind(this)),this.endDateInput.addEventListener("keyup",this.onDateInputsKeyUp.bind(this)),this.startDateInput.addEventListener("focus",this.onDateInputsFocus.bind(this)),this.endDateInput.addEventListener("focus",this.onDateInputsFocus.bind(this)),this.startDateInput.addEventListener("blur",this.onDateInputsBlur.bind(this)),this.endDateInput.addEventListener("blur",this.onDateInputsBlur.bind(this))},onDateInputsFocus:function(t){this.focusedField=t.currentTarget,this.trigger("focus",this)},onDateInputsBlur:function(t){var e=this;this.focusedField&&!this.fp.calendarContainer.contains(t.relatedTarget)&&(this.focusedField===this.startDateInput&&(this.isInvalidRangeStart=!1),(this.focusedField===this.endDateInput&&this.fp.isOpen&&!this.el.contains(t.relatedTarget)||this.focusedField===this.startDateInput&&this.fp.isOpen&&!this.el.contains(t.relatedTarget))&&setTimeout(function(){e.fp.close()},5),this.focusedField=null)},onDateInputsChange:function(t){var e,i,n,s,a,o=this;this.fp.isOpen&&null!==this.focusedField?(e=!this.focusedField||this.focusedField===this.startDateInput,t=(this.focusedField||t.currentTarget).value,n=!1,this.isKeyUpEvent||""!==t||(s=this.fp.formatDate(this.fp.latestSelectedDateObj,this.options.fpDateFormat))!==t&&(t=s,n=!0),s=(e?this.endDateInput:this.startDateInput).value,i="",this.previousVisibleDateRange&&(i=e?this.previousVisibleDateRange[1]:this.previousVisibleDateRange[0]),n=n||s!==i,(a=this.getErrors(s=e?[t,i]:[i,t])).length||n?this.updateDateInputField(s):(this.updateHidden(),this.trigger("change",this)),this.isKeyUpEvent||(e?!a.length&&this.isInvalidRangeStart?(this.isInvalidRangeStart=!1,setTimeout(function(){o.fp.close()},5)):(this.endDateInput.focus(),a.length&&_.filter(a,function(t){return"invalid-range"===t.type}).length&&(a[0].type="invalid-range-end",this.triggerErrorEvents(a))):a.length?setTimeout(function(){o.startDateInput.focus(),o.focusedField=o.startDateInput,_.filter(a,function(t){return"invalid-range"===t.type}).length&&(a[0].type="invalid-range-start",a[0].inputField=o.startDateInput,o.isInvalidRangeStart=!0,o.triggerErrorEvents(a))},5):setTimeout(function(){o.fp.close()},10))):(this.updateHidden(),this.trigger("change",this))},onDateInputsKeyUp:function(t){var e,i=t.currentTarget,n=i.value,s=i===this.startDateInput,a=i.selectionStart,o=i.selectionEnd,l=Tools.convertUserInputToMoment(n,this.momentFormat).toDashString();_.includes([37,38,39,40,9],t.keyCode)||(27===t.keyCode?(i.blur(),this.fp.close()):(t=(s?this.endDateInput:this.startDateInput).value,this.previousVisibleDateRange&&(s?this.previousVisibleDateRange[1]:this.previousVisibleDateRange[0]),e=this.getErrors(t=s?[n,t]:[t,n]),this.isKeyUpEvent=!0,e.length&&_.filter(e,function(t){return"invalid-range"===t.type}).length?this.fp.setDate(t=[n,n],!0,this.options.fpDateFormat):this.updateDateInputField(t),!e.length&&s&&this.fp.jumpToDate(l,!0),i.setSelectionRange(a,o),this.isKeyUpEvent=!1))},convertISOStringToDate:function(t){var e;if(_.isDate(t)){if(_.isNaN(t.getTime()))return null;t=t.toISOString()}return t?!!(e="string"==typeof t?/^(\d\d\d\d)-(\d\d)-(\d\d)$/.exec(t.substring(0,10)):e)&&new Date(Number(e[1]),Number(e[2])-1,Number(e[3])):null},closeOnInputKeyEnter:function(t){var e=this;13===t.keyCode&&(t.stopImmediatePropagation(),t.currentTarget.dispatchEvent(new Event("keyup")),setTimeout(function(){e.fp.close()},10))},getValue:function(){var e=this,t=_.map(this.fp.selectedDates,function(t){return e.fp.formatDate(t,e.options.fpDateFormat)});return 1===t.length&&t.push(t[0]),t},getWidth:function(){return this.schema.options.width},setTheme:function(t){this.fp&&("Light"===t?this.fp.calendarContainer.classList.add("Light"):this.fp.calendarContainer.classList.remove("Light"))},remove:function(){return this.startDateInput.removeEventListener("keydown",this.closeOnInputKeyEnter.bind(this)),this.endDateInput.removeEventListener("keydown",this.closeOnInputKeyEnter.bind(this)),this.startDateInput.removeEventListener("change",this.onDateInputsChange.bind(this)),this.endDateInput.removeEventListener("change",this.onDateInputsChange.bind(this)),this.startDateInput.removeEventListener("keyup",this.onDateInputsKeyUp.bind(this)),this.endDateInput.removeEventListener("keyup",this.onDateInputsKeyUp.bind(this)),this.startDateInput.removeEventListener("focus",this.onDateInputsFocus.bind(this)),this.endDateInput.removeEventListener("focus",this.onDateInputsFocus.bind(this)),this.startDateInput.removeEventListener("blur",this.onDateInputsBlur.bind(this)),this.endDateInput.removeEventListener("blur",this.onDateInputsBlur.bind(this)),this.fp&&(this.focusedField=null,this.fp.close(),this.fp.destroy()),Backbone.View.prototype.remove.apply(this,arguments)},render:function(){var t=this.options,e=this.schema,i=(Backbone.$,t.id);return!i&&t.item&&(i=t.item.cid),this.el.innerHTML=T.DateRangePicker({key:i}),this.startDateInput=this.el.querySelectorAll("input")[0],this.endDateInput=this.el.querySelectorAll("input")[1],this.startDateInput.addEventListener("keydown",this.closeOnInputKeyEnter.bind(this)),this.endDateInput.addEventListener("keydown",this.closeOnInputKeyEnter.bind(this)),this.startDateInput.classList.add("ui-state-default","hasDateRangePicker"),this.endDateInput.classList.add("ui-state-default","hasDateRangePicker"),e.editorClass&&(this.startDateInput.classList.add(e.editorClass),this.endDateInput.classList.add(e.editorClass)),this.fp=flatpickr(this.startDateInput,_.extend({plugins:[new rangePlugin({input:this.endDateInput}),new confirmDatePlugin({confirmIcon:"",confirmText:"Close",showAlways:!0})]},e.options,{dateFormat:"Y-m-d"})),_.isEmpty(this.schema.options.availableDates)||this.fp.set("enable",this.schema.options.availableDates),this.hidden=document.createElement("input"),this.hidden.setAttribute("type","hidden"),this.hidden.setAttribute("name",this.key),this.el.appendChild(this.hidden),this.setValue(this.value),this.setElement(this.el),this.el.setAttribute("id",this.id),this.el.setAttribute("name",this.getName()),this.initializeEvents(),this},setValue:function(t){var e;_.every(t,function(t){return""===t})||((e=this.getErrors(t)).length?this.triggerErrorEvents(e):(this.fp.setDate(t,!0,this.options.fpDateFormat),2===(e=this.getValue()).length&&(this.previousDate=e),this.updateHidden()))},getErrors:function(t){var i,n,s=this,a=this.schema&&this.schema.options&&this.schema.options.ignoreTimezone,o=[];return _.forEach(t,function(t,e){t&&10<t.length&&(t=Tools.convertValueToMoment(t).format("YYYY-MM-DD")),i=s.convertISOStringToDate(t),n=Tools.convertValueToMoment(t,void 0,a),i&&n.isValid()?s.isInAvailableDatesList(t)||o.push({type:"unavailable",inputField:0===e?s.startDateInput:s.endDateInput}):o.push({type:"invalid",inputField:0===e?s.startDateInput:s.endDateInput})}),0===o.length&&moment(t[0]).valueOfNano()>moment(t[1]).valueOfNano()&&o.push({type:"invalid-range",inputField:this.endDateInput}),o},triggerErrorEvents:function(t){this.trigger("date-range-error",t)},isInAvailableDatesList:function(t){return!!_.isEmpty(this.schema.options.availableDates)||(t=Tools.convertValueToMoment(t,"1214",!0).toDashString(),_.includes(this.schema.options.availableDates,t))},setInputFieldWidth:function(t){this.startDateInput.style.width=t+"px",this.endDateInput.style.width=t+"px"},updateHidden:function(){var t=this.getValue();2===t.length&&(t instanceof Array&&_.forEach(t,function(t){_.isDate(t)&&!_.isNaN(t.getTime())&&t.toISOString()}),this.previousVisibleDateRange=t,this.hidden.value=t.toString())},updateDateInputField:function(t){_.every(t,function(t){return _.isEmpty(t)})?_.isEmpty(this.schema.options.availableDates)||this.updateDateInputField(this.value):(this.getErrors(t),this.fp.clear(!1),"string"==typeof t[0]?this.startDateInput.value=t[0]:"object"==typeof t[0]&&_.isDate(t[0])&&(this.startDateInput.value=this.fp.formatDate(t[0],this.options.fpDateFormat)),"string"==typeof t[1]?this.endDateInput.value=t[1]:"object"==typeof t[1]&&_.isDate(t[1])&&(this.endDateInput.value=this.fp.formatDate(t[1],this.options.fpDateFormat)),this.previousVisibleDateRange=[this.startDateInput.value,this.endDateInput.value],this.setValue(this.previousVisibleDateRange))}}),Form.editors.DatePickerRolling=Form.editors.DatePicker.extend({initialize:function(t){Form.editors.Base.prototype.initialize.call(this,t=t||{});Form.editors.Date;var e=new Date;this.options=t,this.editorModel=this.options.schema.options.editorModel,this.schema=$.extend(!0,{options:{yearStart:e.getFullYear()-100,yearEnd:e.getFullYear(),closeText:"Close",changeMonth:!0,changeYear:!0,dateFormat:"yy-mm-dd",showAnim:"slideDown",showOn:"focus"}},t.schema||{}),this.editorModel.get("rolling")||(this.value&&!_.isDate(this.value)?this.value=new Date(this.value):((e=new Date).setSeconds(0),e.setMilliseconds(0),this.value=e)),this.template=t.template||this.constructor.template},initializeEvents:function(){var t=this;Form.editors.DatePicker.prototype.initializeEvents.call(this),this.$rollingInput.on("keyup",function(){t.determineRollingChange()}),this.$rollingCheckbox.on("change",function(){t.$rollingCheckbox.is(":checked")?t.editorModel.set("rolling",!0):t.editorModel.set("rolling",!1)}),this.listenTo(this.editorModel,"change:rolling",function(){t.updateFieldType()})},determineRollingChange:function(t){this.$rollingInput.val(this.$rollingInput.val().toUpperCase());var e=this.$rollingInput.val();e!==this.previousValue&&(this.previousValue=e,this.trigger("change",this))},getValue:function(){return this.editorModel.get("rolling")?this.$rollingInput.val():Form.editors.DatePicker.prototype.getValue.call(this)},render:function(){var t=this,e=(this.options,this.schema),i=Backbone.$,n=i(this.template({key:this.options.id}));return this.$dateInput=n.find("input#date_"+this.options.id+"_date"),this.$dateInput.addClass("ui-state-default"),this.$dateInput.after("<span class='ui-icon fa fa-calendar rolling'></span>").parent().css("position","relative"),this.$dateInput.datepicker(_.extend({defaultDate:this.value},e.options)),this.$rollingCheckbox=n.find("input#date_"+this.options.id+"_checkbox"),this.$rollingInput=n.find("input#date_"+this.options.id+"_rolling"),this.$hidden=i('<input type="hidden" name="'+this.key+'">'),n.append(this.$hidden),_.defer(function(){t.setDefaultInputValues()}),this.setValue(this.value),this.$rollingCheckbox.attr("disabled",!this.editorModel.get("enableRollingCheckbox")),this.$rollingCheckbox.attr("disabled")&&this.$rollingCheckbox.attr("title",this.MSG_CANNOT_UNCHECK_ROLLING),this.setElement(n),this.$el.attr("id",this.id),this.$el.attr("name",this.getName()),this.$el.addClass("rolling"),this.hasFocus&&this.trigger("blur",this),this.initializeEvents(),this.updateFieldType(),this},setValue:function(t){if(!this.editorModel.get("rolling"))return Form.editors.DatePicker.prototype.setValue.call(this,t);this.$rollingInput.val(t),this.updateHidden()},setDefaultInputValues:function(){var t;this.value&&this.value instanceof Date||((t=new Date).setSeconds(0),t.setMilliseconds(0),this.$dateInput.datepicker("setDate",t)),this.value&&this.value.toString().match(Form.RTTI.REGEX_ROLLING)?this.$rollingInput.val(this.value):this.$rollingInput.val("NOW"),this.determineRollingChange()},updateFieldType:function(){this.editorModel.get("rolling")?(this.$dateInput.hide(),this.$rollingInput.show(),this.$rollingCheckbox.attr("checked",!0)):(this.$dateInput.show(),this.$rollingInput.hide(),this.$rollingCheckbox.attr("checked",!1))}}),Form.editors.DateTimePickerRolling=Form.editors.DateTimePicker.extend({initialize:function(t){var i=this,e=(Form.editors.Base.prototype.initialize.call(this,t=t||{}),Form.editors.Date,new Date);this.options=t,this.schema=$.extend(!0,{options:{yearStart:e.getFullYear()-100,yearEnd:e.getFullYear(),closeText:"Close",changeMonth:!0,changeYear:!0,dateFormat:"yy-mm-dd",showAnim:"slideDown",showOn:"focus",timeFormat:"HH:mm"}},t.schema||{}),this.schema.options.isTimestamp&&(this.schema.options.max=86399999999999),this.editorModel=this.options.schema.options.editorModel,this.schema.options.onSelect=function(t,e){e&&(e.inline=!0),i.updateHidden()},this.schema.options.onClose=function(t,e){e.inline=!1,i.trigger("change",i)},this.momentFormat=(this.schema.options.dateFormat?this.schema.options.dateFormat.replace("yy","YYYY").toUpperCase():"")+" "+this.schema.options.timeFormat,this.template=t.template||this.constructor.template},initializeEvents:function(){var t=this;Form.editors.DateTimePicker.prototype.initializeEvents.call(this),this.$rollingInput.on("keyup",function(){t.determineRollingChange()}),this.$rollingCheckbox.on("change",function(){t.$rollingCheckbox.is(":checked")?t.editorModel.set("rolling",!0):t.editorModel.set("rolling",!1)}),this.listenTo(this.editorModel,"change:rolling",function(){t.updateFieldType()})},determineRollingChange:function(t){this.$rollingInput.val(this.$rollingInput.val().toUpperCase());var e=this.$rollingInput.val();e!==this.previousValue&&(this.previousValue=e,this.trigger("change",this))},getValue:function(){return this.editorModel.get("rolling")?this.$rollingInput.val():Tools.convertUserInputToMoment(this.$dateTimeInput.val(),this.momentFormat).toISOStringNano()},render:function(){var t=this,e=(this.options,this.schema),i=Backbone.$,n=i(this.template({key:this.options.id}));return this.$dateTimeInput=n.find("input#date_"+this.options.id+"_date"),this.$dateTimeInput.addClass("ui-state-default"),this.$dateTimeInput.datetimespinner(e.options),this.$rollingCheckbox=n.find("input#date_"+this.options.id+"_checkbox"),this.$rollingInput=n.find("input#date_"+this.options.id+"_rolling"),this.$hidden=i('<input type="hidden" name="'+this.key+'" >'),n.append(this.$hidden),_.defer(function(){t.setDefaultInputValues()}),this.setValue(this.value),this.$rollingCheckbox.attr("disabled",!this.editorModel.get("enableRollingCheckbox")),this.$rollingCheckbox.attr("disabled")&&this.$rollingCheckbox.attr("title",this.MSG_CANNOT_UNCHECK_ROLLING),this.setElement(n),this.$el.attr("id",this.id),this.$el.attr("name",this.getName()),this.$el.addClass("rolling"),this.hasFocus&&this.trigger("blur",this),this.initializeEvents(),this.updateFieldType(),this},setDefaultInputValues:function(){this.value&&this.value.toString().match(Form.RTTI.REGEX_ROLLING)?this.$rollingInput.val(this.value):this.$rollingInput.val("NOW"),this.determineRollingChange()},setValue:function(t){if(!this.editorModel.get("rolling"))return Form.editors.DateTimePicker.prototype.setValue.call(this,t);this.$rollingInput.val(t),this.updateHidden()},updateFieldType:function(){this.editorModel.get("rolling")?(this.$dateTimeInput.hide(),this.$rollingInput.show(),this.$rollingCheckbox.attr("checked",!0)):(this.$dateTimeInput.show(),this.$rollingInput.hide(),this.$rollingCheckbox.attr("checked",!1))}}),!function(c){var u,h,t=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],e="onwheel"in document||9<=document.documentMode?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],d=Array.prototype.slice;if(c.event.fixHooks)for(var i=t.length;i;)c.event.fixHooks[t[--i]]=c.event.mouseHooks;var m=c.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var t=e.length;t;)this.addEventListener(e[--t],n,!1);else this.onmousewheel=n;c.data(this,"mousewheel-line-height",m.getLineHeight(this)),c.data(this,"mousewheel-page-height",m.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var t=e.length;t;)this.removeEventListener(e[--t],n,!1);else this.onmousewheel=null;c.removeData(this,"mousewheel-line-height"),c.removeData(this,"mousewheel-page-height")},getLineHeight:function(t){var t=c(t),e=t["offsetParent"in c.fn?"offsetParent":"parent"]();return e.length||(e=c("body")),parseInt(e.css("fontSize"),10)||parseInt(t.css("fontSize"),10)||16},getPageHeight:function(t){return c(t).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};function n(t){var e,i=t||window.event,n=d.call(arguments,1),s=0,a=0,o=0,l=0,r=0;if((t=c.event.fix(i)).type="mousewheel","detail"in i&&(o=-1*i.detail),"wheelDelta"in i&&(o=i.wheelDelta),"wheelDeltaY"in i&&(o=i.wheelDeltaY),"wheelDeltaX"in i&&(a=-1*i.wheelDeltaX),"axis"in i&&i.axis===i.HORIZONTAL_AXIS&&(a=-1*o,o=0),s=0===o?a:o,"deltaY"in i&&(s=o=-1*i.deltaY),"deltaX"in i&&(a=i.deltaX,0===o)&&(s=-1*a),0!==o||0!==a)return 1===i.deltaMode?(s*=e=c.data(this,"mousewheel-line-height"),o*=e,a*=e):2===i.deltaMode&&(s*=e=c.data(this,"mousewheel-page-height"),o*=e,a*=e),e=Math.max(Math.abs(o),Math.abs(a)),(!h||e<h)&&f(i,h=e)&&(h/=40),f(i,e)&&(s/=40,a/=40,o/=40),s=Math[1<=s?"floor":"ceil"](s/h),a=Math[1<=a?"floor":"ceil"](a/h),o=Math[1<=o?"floor":"ceil"](o/h),m.settings.normalizeOffset&&this.getBoundingClientRect&&(i=this.getBoundingClientRect(),l=t.clientX-i.left,r=t.clientY-i.top),t.deltaX=a,t.deltaY=o,t.deltaFactor=h,t.offsetX=l,t.offsetY=r,t.deltaMode=0,n.unshift(t,s,a,o),u&&clearTimeout(u),u=setTimeout(p,200),(c.event.dispatch||c.event.handle).apply(this,n)}function p(){h=null}function f(t,e){return m.settings.adjustOldDeltas&&"mousewheel"===t.type&&e%120==0}c.fn.extend({mousewheel:function(t){return t?this.bind("mousewheel",t):this.trigger("mousewheel")},unmousewheel:function(t){return this.unbind("mousewheel",t)}})}($),!function(T){var n,t=navigator.userAgent,x=/iphone/i.test(t),D=/chrome/i.test(t),w=/android/i.test(t);T.mask={definitions:{t:"[0-5]",h:"[0-1]",9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},autoclear:!0,dataName:"rawMaskFn",placeholder:"_"},T.fn.extend({caret:function(t,e){var i;if(0!==this.length&&!this.is(":hidden"))return"number"==typeof t?(e="number"==typeof e?e:t,this.each(function(){this.setSelectionRange?this.setSelectionRange(t,e):this.createTextRange&&((i=this.createTextRange()).collapse(!0),i.moveEnd("character",e),i.moveStart("character",t),i.select())})):(this[0].setSelectionRange?(t=this[0].selectionStart,e=this[0].selectionEnd):document.selection&&document.selection.createRange&&(i=document.selection.createRange(),t=0-i.duplicate().moveStart("character",-1e5),e=t+i.text.length),{begin:t,end:e})},unmask:function(){return this.trigger("unmask")},mask:function(e,r){var i,_,c,y,b,k,$,t;return!e&&0<this.length?(t=T(this[0]).data(T.mask.dataName))?t():void 0:(r=T.extend({autoclear:T.mask.autoclear,placeholder:T.mask.placeholder,completed:null},r),i=T.mask.definitions,_=[],c=k=e.length,y=null,T.each(e.split(""),function(t,e){"?"==e?(k--,c=t):i[e]?(_.push(new RegExp(i[e])),null===y&&(y=_.length-1),t<c&&(b=_.length-1)):_.push(null)}),this.trigger("unmask").each(function(){function u(){if(r.completed){for(var t=y;t<=b;t++)if(_[t]&&v[t]===h(t))return;r.completed.call(g)}}function h(t){return r.placeholder.charAt(t<r.placeholder.length?t:0)}function d(t){for(;++t<k&&!_[t];);return t}function m(t,e){var i,n;if(!(t<0)){for(i=t,n=d(e);i<k;i++)if(_[i]){if(!(n<k&&_[i].test(v[n])))break;v[i]=v[n],v[n]=h(n),n=d(n)}f(),g.caret(Math.max(y,t))}}function s(){a(),g.val()!=l&&g.change()}function p(t,e){for(var i=t;i<e&&i<k;i++)_[i]&&(v[i]=h(i))}function f(){g.val(v.join(""))}function a(t){for(var e,i=g.val(),n=-1,s=0,a=0;s<k;s++)if(_[s]){for(v[s]=h(s);a++<i.length;)if(e=i.charAt(a-1),_[s].test(e)){v[s]=e,n=s;break}if(a>i.length){p(s+1,k);break}}else v[s]===i.charAt(a)&&a++,s<c&&(n=s);return t?f():n+1<c?r.autoclear||v.join("")===o?(g.val()&&g.val(""),p(0,k)):f():(f(),g.val(g.val().substring(0,n+1))),c?s:y}var g=T(this),v=T.map(e.split(""),function(t,e){return"?"!=t?i[t]?h(e):t:void 0}),o=v.join(""),l=g.val();g.data(T.mask.dataName,function(){return T.map(v,function(t,e){return _[e]&&t!=h(e)?t:null}).join("")}),g.one("unmask",function(){g.off(".mask").removeData(T.mask.dataName)}).on("focus.mask",function(){var t;g.prop("readonly")||(clearTimeout(n),l=g.val(),t=a(),n=setTimeout(function(){g.get(0)===document.activeElement&&(f(),t==e.replace("?","").length?g.caret(0,t):g.caret(t))},10))}).on("blur.mask",s).on("keydown.mask",function(t){var e,i,n;g.prop("readonly")||(n=t.which||t.keyCode,$=g.val(),8===n||46===n||x&&127===n?(e=(i=g.caret()).begin,(i=i.end)-e==0&&(e=46!==n?function(t){for(;0<=--t&&!_[t];);return t}(e):i=d(e-1),i=46===n?d(i):i),p(e,i),m(e,i-1),t.preventDefault()):13===n?s.call(this,t):27===n&&(g.val(l),g.caret(0,a()),t.preventDefault()))}).on("keypress.mask",function(t){if(!g.prop("readonly")){var e,i,n,s=t.which||t.keyCode,a=g.caret();if(!(t.ctrlKey||t.altKey||t.metaKey||s<32)&&s&&13!==s){if(a.end-a.begin!=0&&(p(a.begin,a.end),m(a.begin,a.end-1)),(e=d(a.begin-1))<k&&(i=String.fromCharCode(s),_[e].test(i))){for(var o,l,r=e,c=h(e);r<k;r++)if(_[r]){if(o=d(r),l=v[r],v[r]=c,!(o<k&&_[o].test(l)))break;c=l}v[e]=i,f(),n=d(e),w?setTimeout(function(){T.proxy(T.fn.caret,g,n)()},0):g.caret(n),a.begin<=b&&u()}t.preventDefault()}}}).on("input.mask paste.mask",function(){g.prop("readonly")||setTimeout(function(){var t=a(!0);g.caret(t),u()},0)}),D&&w&&g.off("input.mask").on("input.mask",function(){var t=g.val(),e=g.caret();if($&&$.length&&$.length>t.length){for(a(!0);0<e.begin&&!_[e.begin-1];)e.begin--;if(0===e.begin)for(;e.begin<y&&!_[e.begin];)e.begin++}else for(a(!0);e.begin<k&&!_[e.begin];)e.begin++;g.caret(e.begin,e.begin),u()}),a()}))}})}($),$.widget("ui.timespinner",$.ui.spinner,{options:{min:0,max:86399999e6,stop:function(t,e){function i(t){var e=moment.utc("1970-01-01T"+t+"Z");switch(t.length){case 5:return r(e,2);case 8:return r(e,3);case 12:return r(e,4);case 18:for(var i=t,n=new RegExp(/(\d{2}):(\d{2}):(\d{2}).(\d{3})(\d{3})(\d{3})/),s=new RegExp(/^0+/),a=i.match(n),o="",l=0;l<a.length;l++)o=0==a[l]?"0":"",a[l]=a[l].replace(s,o);return c({hour:a[1],minute:a[2],second:a[3],millisecond:a[4],microsecond:a[5],nanosecond:a[6]},"Time must be between 0 and 99:59:59.999999999")}}var n=$(this).timespinner("getSel"),a=t.originalEvent?t.originalEvent.keyCode:void 0,t=$(this).val(),s=moment("1970-01-01T"+t+"Z");Number(s.format("x")),s.minutes(),s.hours(),t.substring(12,18).length&&Number(t.substring(12,18)),void 0!==a&&-1!==[8,35,36,37,39,46,48,49,50,51,52,53,54,55,56,57,96,97,98,99,100,101,102,103,104,105].indexOf(a)||$(this)[0].setSelectionRange(n,n);function r(t,e){var i,n={},s=[{hour:t.hours()},{minute:t.minutes()},{second:t.seconds()},{millisecond:t.milliseconds()}];for(i in s)i<e&&_.merge(n,s[i]);return c(n,"Time must be between 0 and 23:59:59.999")}function c(t,e){var i,n,s="";for(a in t){if(isNaN(t[a]))return e;s+=(n=t[i=a],"".concat(n," ").concat(i).concat(1!==n?"s ":" "))}return s}void 0===$(this).closest(".bbf-field").attr("title")&&$(this).attr("title",i(t))}},_adjustValue:function(t){var e=this.options;return null!==e.max&&0<t.compareTo(new QuickBase.BigInteger(e.max.toString()))?new QuickBase.BigInteger(e.max.toString()):null!==e.min&&t.compareTo(new QuickBase.BigInteger(e.min.toString()))<0?new QuickBase.BigInteger(e.min.toString()):t},_create:function(){var n=this;this._super(),this.element.on("click focus",function(t){n._setSelection(this.selectionStart),$(this).parent().toggleClass("focused",!0)}),this.element.on("blur",function(t){$(this).parent().toggleClass("focused",!1)}),this.element.on("keydown",function(t){var e,i=$(this).val();-1===[33,34,38,40].indexOf(t.keyCode)&&(n._setSelection(this.selectionStart),-1===[9].indexOf(t.keyCode))&&(-1!==[35,36,37,39].indexOf(t.keyCode)?setTimeout(function(){n._updateSelection()},100):(-1!==[48,49,50,51,52,53,54,55,56,57,96,97,98,99,100,101,102,103,104,105].indexOf(t.keyCode)?(/^[0-9]$/.test(i[n.lastSelection])||n.lastSelection++,e=-1!==[48,49,50,51,52,53,54,55,56,57].indexOf(t.keyCode)?String(t.keyCode-48):String(t.keyCode-96),n.lastSelection<i.length&&(i=n._replaceAt(i,n.lastSelection,e),$(this).val(i)),this.setSelectionRange(n.lastSelection+1,n.lastSelection+1),n._setSelection(n.lastSelection+1)):8===t.keyCode?(e=this.selectionStart===this.selectionEnd?Math.max(0,this.selectionStart-1):this.selectionStart,n._setSelection(e),$(this).val(n._zeroSelection(i,e,this.selectionEnd)),this.setSelectionRange(n.lastSelection,n.lastSelection)):46===t.keyCode&&(/^[0-9]$/.test(i[n.lastSelection])||n.lastSelection++,n.lastSelection<i.length&&(i=n._replaceAt(i,n.lastSelection,"0"),$(this).val(i)),this.setSelectionRange(n.lastSelection+1,n.lastSelection+1),n._setSelection(n.lastSelection+1)),t.preventDefault()))}),this.element.on("keyup",function(t){$(this).trigger("change")})},_replaceAt:function(t,e,i){return t.substr(0,e)+i+t.substr(e+i.length)},_zeroSelection:function(t,e,i){for(var n=t.substr(e,i),s=0;s<n.length;s++)/^[0-9]$/.test(n[s])&&(n=this._replaceAt(n,s,"0"));return this._replaceAt(t,e,n)},getSel:function(){return this.lastSelection},_updateSelection:function(){this._setSelection(this.element[0].selectionStart)},_setSelection:function(t){var e,i,n=1;switch(this.lastSelection=t,":"===(i=(e=this.options.timeFormat||"HH:mm:ss.SSS").substr(t,1))||"."===i?i=e.substr(t-1,1):t>=e.length&&(i=e.substr(-1,1)),"S"===(i=_.includes(["H","m","s","S"],i)?i:null)&&(i="S1",t!==e.length)&&(15<=t?i="S3":12<=t&&(i="S2")),i){case"H":n=36e11;break;case"m":n=6e10;break;case"s":n=1e9;break;case"S1":n=1e6;break;case"S2":n=1e3}n!==this.options.step&&this._setOption("step",n)},_format:function(t){t=t.toString(),t={class:this.options.hasNano?"1216":"1219",i:this.options.hasNano?Number(t):Math.floor(Number(t)/1e6)};return Tools.convertKDBTemporalToMoment(t).formatNano(this.options.timeFormat||"HH:mm:ss.SSS",{trim:!1,trimNano:!this.options.hasNano})},_parse:function(t){var e,i=this.options.timeFormat||"HH:mm:ss.SSS";return"string"==typeof t&&0<t.length?(i=t.substr(t.indexOf("T")+1,12)||moment(0).format(i),"Z"===(e=(this.options.hasNano?t.substr(t.indexOf("T")+13,6):"")||"000000")&&(e="000000"),-1===t.indexOf(".")&&(e=""),i=Tools.convertValueToDuration(i+e).valueOfNano().toString(),new QuickBase.BigInteger(i)):t||new QuickBase.BigInteger("0")},_spin:function(t,e){var i=this.value()||0;if(_.get(this,"element.0.disabled"))return i;this.counter||(this.counter=1),i=this._adjustValue(i.add(new QuickBase.BigInteger((t*this._increment(this.counter)).toString()))),this.spinning&&!1===this._trigger("spin",e,{value:i})||(this._value(i),this.counter++,$(this.element).trigger("change"))},value:function(t){var e=this.element[0].selectionStart;if(!arguments.length)return this._parse(this.element.val());this._value.call(this,t),e&&e!==this.element[0].value.length&&(this.element[0].selectionStart=e,this.element[0].selectionEnd=e)}}),Form.editors.TimePicker=Form.editors.DateTimeBase.extend({initialize:function(t){var e=this;Form.editors.DateTimeBase.prototype.initialize.call(this,t=t||{},this),this.options=t,this.schema=$.extend(!0,{options:{value:0,step:1e3,page:60,spin:function(){e.determineChange()}}},t.schema||{}),this.schema.options.isTimespan&&(this.schema.options.max=359999999999999),this.schema.options.onSelect=function(){e.updateHidden(),e.trigger("change",e)},this.value||(this.value="T00:00:00.000000000Z"),this.template=t.template||this.constructor.template},initializeEvents:function(){var e=this;Form.editors.DateTimeBase.prototype.render.call(this,this.$timeInput),this.$timeInput.on("focus",function(){e.hasFocus||e.trigger("focus",e)}),this.$timeInput.on("blur",function(){e.hasFocus&&setTimeout(function(){e.$("input:focus")[0]||e.trigger("blur",e)},0)}),this.$timeInput.on("change input",function(t){e.determineChange(t)})},blur:function(){this.hasFocus&&this.$timeInput.first().blur()},determineChange:function(t){var e=this.$timeInput.val();e!==this.previousValue&&(this.previousValue=e,this.trigger("change",this))},focus:function(){this.hasFocus||this.$timeInput.first().focus()},getWidth:function(){return this.schema.options.width},getValue:function(){var t,e=this.schema.options.isDuration?Tools.convertValueToDuration(this.$timeInput.val()):(e=moment().toISOString().substring(0,10),Tools.convertValueToMoment(e+" "+this.$timeInput.val()));return(t=Number(this.$timeInput.val().substring(12,30)))&&!_.isNaN(t)?(e.nanoseconds(t),"1970-01-01T"+e.formatNano("HH:mm:ss.SSSSSSSSS",{trim:!1,trimNano:!this.schema.options.hasNano})+"Z"):"1970-01-01T"+e.formatNano("HH:mm:ss.SSS",{trim:!1,trimNano:!this.schema.options.hasNano})+"Z"},render:function(){var t=$(this.template({key:this.options.id}));return this.$timeInput=t.find("input"),this.$timeInput.timespinner(this.schema.options),this.schema.editorClass&&this.$timeInput.addClass(this.schema.editorClass),this.$hidden=$('<input type="hidden" name="'+this.key+'" >'),t.append(this.$hidden),this.setValue(this.value),this.setElement(t),this.$el.attr("name",this.getName()),this.hasFocus&&this.trigger("blur",this),this.initializeEvents(),this},setValue:function(t){var e=t&&"1970-01-01"===t.substring(0,10)?t.substring(11).replace("Z",""):Tools.convertValueToMoment(t).formatNano("HH:mm:ss.SSSSSSSSS",{trim:!1,trimNano:!this.schema.options.hasNano}),e="T"+(this.schema.options.isDuration?Tools.convertValueToDuration(e):Tools.convertValueToMoment(t)).formatNano(this.schema.options.hasNano?"HH:mm:ss.SSSSSSSSS":"HH:mm:ss.SSS",{trim:!1,trimNano:!this.schema.options.hasNano})+"Z";this.$timeInput.timespinner("value",e),this.updateHidden()},setWidth:function(t){this.$el.parents().closest(".datepicker-input").width(t)},updateHidden:function(){var t=this.getValue();this.$hidden.val(t)}}),Form.editors.TimePickerRolling=Form.editors.TimePicker.extend({initialize:function(t){var e=this;Form.editors.Base.prototype.initialize.call(this,t=t||{}),this.options=t,this.schema=$.extend(!0,{options:{value:0,step:1e3,page:60,spin:function(){e.determineChange()}}},t.schema||{}),this.schema.options.isTimespan&&(this.schema.options.max=359999999999999),this.editorModel=this.options.schema.options.editorModel,this.schema.options.onSelect=function(){e.updateHidden(),e.trigger("change",e)},this.value||(this.value="T00:00:00.000000000Z"),this.template=t.template||this.constructor.template},initializeEvents:function(){var e=this;this.$timeInput.on("focus",function(){e.hasFocus||e.trigger("focus",e)}),this.$timeInput.on("blur",function(){e.hasFocus&&setTimeout(function(){e.$("input:focus")[0]||e.trigger("blur",e)},0)}),this.$timeInput.on("change input",function(t){e.determineChange(t)}),this.$rollingInput.on("keyup",function(){e.determineRollingChange()}),this.$rollingCheckbox.on("change",function(){e.$rollingCheckbox.is(":checked")?e.editorModel.set("rolling",!0):e.editorModel.set("rolling",!1)}),this.listenTo(this.editorModel,"change:rolling",function(){e.updateFieldType()})},determineRollingChange:function(t){this.$rollingInput.val(this.$rollingInput.val().toUpperCase());var e=this.$rollingInput.val();e!==this.previousValue&&(this.previousValue=e,this.trigger("change",this))},getValue:function(){return this.editorModel.get("rolling")?this.$rollingInput.val():Form.editors.TimePicker.prototype.getValue.call(this)},render:function(){var t=this,e=$(this.template({key:this.options.id}));return this.$timeInput=e.find("input#time_"+this.options.id+"_time"),this.spinner=this.$timeInput.timespinner(this.schema.options),this.$rollingCheckbox=e.find("input#time_"+this.options.id+"_checkbox"),this.$rollingInput=e.find("input#time_"+this.options.id+"_rolling"),this.$hidden=$('<input type="hidden" name="'+this.key+'">'),e.append(this.$hidden),this.setValue(this.value),_.defer(function(){t.setDefaultInputValues()}),this.$rollingCheckbox.attr("disabled",!this.editorModel.get("enableRollingCheckbox")),this.$rollingCheckbox.attr("disabled")&&this.$rollingCheckbox.attr("title",this.MSG_CANNOT_UNCHECK_ROLLING),this.setElement(e),this.$el.attr("id",this.id),this.$el.attr("name",this.getName()),this.$el.addClass("rolling"),this.hasFocus&&this.trigger("blur",this),this.initializeEvents(),this.updateFieldType(),this},setDefaultInputValues:function(){this.value&&this.value.toString().match(Form.RTTI.REGEX_ROLLING)?this.$rollingInput.val(this.value):this.$rollingInput.val("NOW"),this.determineRollingChange()},setValue:function(t){if(!this.editorModel.get("rolling"))return Form.editors.TimePicker.prototype.setValue.call(this,t);this.$rollingInput.val(t),this.updateHidden()},updateFieldType:function(){this.editorModel.get("rolling")?(this.$timeInput.parent().hide(),this.$rollingInput.show(),this.$rollingCheckbox.attr("checked",!0)):(this.$timeInput.parent().css("display","inline-block"),this.$rollingInput.hide(),this.$rollingCheckbox.attr("checked",!1))}}),Form.editors.Text=Form.Editor.extend({tagName:"input",defaultValue:"",previousValue:"",events:{keyup:"determineChange",keypress:function(t){var e=this;setTimeout(function(){return e.determineChange()},0)},paste:function(t){var e=this;setTimeout(function(){return e.determineChange()},0)},select:function(t){this.trigger("select",this)},focus:function(t){this.trigger("focus",this)},blur:function(t){this.trigger("blur",this)}},initialize:function(t){Form.editors.Base.prototype.initialize.call(this,t);t=this.schema;this.inputType="text",t&&t.editorAttrs&&t.editorAttrs.type&&(this.inputType=t.editorAttrs.type),t&&t.dataType&&(this.inputType=t.dataType),this.previousValue=this.value,this.$el.attr("type",this.inputType),this.$el.on("change",_.debounce($.proxy(this.determineChange,this),200))},render:function(){return this.setValue(this.value),this},determineChange:function(t){var e=this.$el.val();e!==this.previousValue&&(this.previousValue=e,this.trigger("change",this))},getValue:function(){var t=DOMPurify.sanitize(this.$el.val(),{ADD_ATTR:["target"]});return(new DOMParser).parseFromString("<!doctype html><body>"+t,"text/html").body.textContent},setValue:function(t){var e,i;"text"===this.inputType&&(e=this.$el[0].selectionEnd,i=this.$el[0].selectionStart),this.value=t,this.$el.val(t),"text"===this.inputType&&i!==e&&this.$el[0].setSelectionRange(i,e)},focus:function(){this.hasFocus||this.$el.focus()},blur:function(){this.hasFocus&&this.$el.blur()},select:function(){this.$el.select()}}),Form.editors.Hidden=Form.editors.Text.extend({defaultValue:"",noField:!0,initialize:function(t){Form.editors.Text.prototype.initialize.call(this,t),this.$el.attr("type","hidden")},focus:function(){},blur:function(){}}),Form.editors.Month=Form.editors.Base.extend({events:{"change select":function(){this.updateHidden(),this.isChanging||this.trigger("change",this)},"focus select":function(){this.hasFocus||this.trigger("focus",this)},"blur select":function(){var t;this.hasFocus&&(t=this,setTimeout(function(){t.$("select:focus")[0]||t.trigger("blur",t)},0))}},initialize:function(t){Form.editors.Base.prototype.initialize.call(this,t=t||{});var e=Form.editors.Month,i=new Date;this.options=_.extend({monthNames:e.monthNames,showMonthNames:e.showMonthNames},t),this.schema=_.extend({yearStart:i.getFullYear()-100,yearEnd:i.getFullYear()+100},t.schema||{}),this.value&&!_.isDate(this.value)&&(this.value=this.convertStringToDate(this.value)),this.value||((e=new Date).setSeconds(0),e.setMilliseconds(0),this.value=e),this.template=t.template||this.constructor.template},render:function(){var e=this.options,t=this.schema,i=Backbone.$,n=_.map(_.range(0,12),function(t){return{name:e.showMonthNames?e.monthNames[t]:t+1,value:t}}),t=t.yearStart<t.yearEnd?_.range(t.yearStart,t.yearEnd+1):_.range(t.yearStart,t.yearEnd-1,-1),t=_.map(t,function(t){return{name:t,value:t}}),n=i(i.trim(this.template({months:n,years:t})));return this.$month=n.find('[data-type="month"]'),this.$year=n.find('[data-type="year"]'),this.$hidden=i('<input type="hidden" name="'+this.key+'" >'),n.append(this.$hidden),this.setValue(this.value),this.setElement(n),this.$el.attr("id",this.id),this.$el.attr("name",this.getName()),this.$el.addClass("bff-month-editor"),this.hasFocus&&this.trigger("blur",this),this.$month.dashSingleSelect({initCallback:function(t){t.$container.addClass("bff-month-input bff-month"),self.form&&self.form.options&&"environment"===self.form.options.theme&&t.on("open",function(){i("body > .select2-container--dashboards.select2-container--open").addClass("select2--environment")})},showSearch:self.showSearch,scrollIntoView:!0,theme:"dashboards",tooltip:self.tooltip,width:self.width}),this.$year.dashSingleSelect({initCallback:function(t){t.$container.addClass("bff-month-input bff-year"),self.form&&self.form.options&&"environment"===self.form.options.theme&&t.on("open",function(){i("body > .select2-container--dashboards.select2-container--open").addClass("select2--environment")})},showSearch:self.showSearch,openDropdownOnFocus:!0,scrollIntoView:!0,theme:"dashboards",tooltip:self.tooltip,width:self.width}),this},convertStringToDate:function(t){var e,t=/(\d{4})-(\d{1,2})/.exec(t);return t&&3===t.length?(e=Number(t[1]),t=Math.min(Math.max(0,Number(t[2])-1),11),new Date(e,t)):new Date},getValue:function(){var t=this.$year.val(),e=Number(this.$month.val())+1;return t&&e?t+"-"+("00"+e).slice(-2):null},setValue:function(t){_.isDate(t)||(t=this.convertStringToDate(t)),this.value=t,this.$month.val(t.getMonth()),this.$year.val(t.getFullYear()),this.isChanging=!0,this.$month.trigger("change"),this.$year.trigger("change"),this.isChanging=!1,this.updateHidden()},setWidth:function(t){var e=this.$el.find(".bff-month-input"),i=t/2-2;this.$el.parent().width(t),_.each(e,function(t){$(t).width(i)})},focus:function(){this.hasFocus||this.$("select").first().focus()},blur:function(){this.hasFocus&&this.$("select:focus").blur()},updateHidden:function(){var t=this.getValue();_.isDate(t)&&!_.isNaN(t.getTime())&&(t=t.toISOString()),this.$hidden.val(t)}},{showMonthNames:!0,monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"]}),Form.editors.MonthRolling=Form.editors.Month.extend({events:{"change select":function(){this.updateHidden(),this.isChanging||this.trigger("change",this)},"focus select":function(){this.hasFocus||this.trigger("focus",this)},"blur select":function(){var t;this.hasFocus&&(t=this,setTimeout(function(){t.$("select:focus")[0]||t.trigger("blur",t)},0))}},initialize:function(t){Form.editors.Base.prototype.initialize.call(this,t=t||{});var e=Form.editors.Month,i=new Date;this.options=_.extend({monthNames:e.monthNames,showMonthNames:e.showMonthNames},t),this.editorModel=this.options.schema.options.editorModel,this.schema=_.extend({yearStart:i.getFullYear()-100,yearEnd:i.getFullYear()+100},t.schema||{}),this.editorModel.get("rolling")||(this.value&&!_.isDate(this.value)&&(this.value=this.convertStringToDate(this.value)),this.value)||((e=new Date).setSeconds(0),e.setMilliseconds(0),this.value=e),this.template=t.template||this.constructor.template},initializeEvents:function(){var t=this;this.$rollingInput.on("keyup",function(){t.determineRollingChange()}),this.$rollingCheckbox.on("change",function(){t.$rollingCheckbox.is(":checked")?t.editorModel.set("rolling",!0):t.editorModel.set("rolling",!1)}),this.listenTo(this.editorModel,"change:rolling",function(){t.updateFieldType()})},determineRollingChange:function(t){this.$rollingInput.val(this.$rollingInput.val().toUpperCase());var e=this.$rollingInput.val();e!==this.previousValue&&(this.previousValue=e,this.trigger("change",this))},getValue:function(){return this.editorModel.get("rolling")?this.$rollingInput.val():Form.editors.Month.prototype.getValue.call(this)},render:function(){var e=this,i=this.options,t=this.schema,n=Backbone.$,s=_.map(_.range(0,12),function(t){return{name:i.showMonthNames?i.monthNames[t]:t+1,value:t}}),t=t.yearStart<t.yearEnd?_.range(t.yearStart,t.yearEnd+1):_.range(t.yearStart,t.yearEnd-1,-1),t=_.map(t,function(t){return{name:t,value:t}}),s=n(n.trim(this.template({key:this.options.id,months:s,years:t})));return this.$dateDiv=s.find(".bbf-date"),this.$month=s.find('[data-type="month"]'),this.$year=s.find('[data-type="year"]'),this.$rollingCheckbox=s.find("input#date_"+this.options.id+"_checkbox"),this.$rollingInput=s.find("input#date_"+this.options.id+"_rolling"),this.$hidden=n('<input type="hidden" name="'+this.key+'" >'),s.append(this.$hidden),this.setValue(this.value),_.defer(function(){e.setDefaultInputValues()}),this.setValue(this.value),this.$rollingCheckbox.attr("disabled",!this.editorModel.get("enableRollingCheckbox")),this.$rollingCheckbox.attr("disabled")&&this.$rollingCheckbox.attr("title",this.MSG_CANNOT_UNCHECK_ROLLING),this.setElement(s),this.$el.attr("id",this.id),this.$el.attr("name",this.getName()),this.$el.addClass("rolling"),this.hasFocus&&this.trigger("blur",this),this.$month.dashSingleSelect({initCallback:function(t){t.$container.addClass("bff-month-input bff-month"),e.form&&e.form.options&&"environment"===e.form.options.theme&&t.on("open",function(){n("body > .select2-container--dashboards.select2-container--open").addClass("select2--environment")})},showSearch:e.showSearch,theme:"dashboards",tooltip:e.tooltip,width:e.width}),this.$year.dashSingleSelect({initCallback:function(t){t.$container.addClass("bff-month-input bff-year"),e.form&&e.form.options&&"environment"===e.form.options.theme&&t.on("open",function(){n("body > .select2-container--dashboards.select2-container--open").addClass("select2--environment")})},showSearch:e.showSearch,theme:"dashboards",tooltip:e.tooltip,width:e.width}),this.initializeEvents(),this.updateFieldType(),this},setValue:function(t){if(!this.editorModel.get("rolling"))return Form.editors.Month.prototype.setValue.call(this,t);this.$rollingInput.val(t),this.updateHidden()},setDefaultInputValues:function(){this.value&&this.value.toString().match(Form.RTTI.REGEX_ROLLING)?this.$rollingInput.val(this.value):this.$rollingInput.val("NOW"),this.determineRollingChange()},updateFieldType:function(){this.editorModel.get("rolling")?(this.$dateDiv.hide(),this.$rollingInput.show(),this.$rollingCheckbox.attr("checked",!0)):(this.$dateDiv.show(),this.$rollingInput.hide(),this.$rollingCheckbox.attr("checked",!1))}}),Form.editors.Dict=Form.editors.Base.extend({initialize:function(t){var e=Form.editors,i=(e.Base.prototype.initialize.call(this,t=t||{}),this.schema.listItemTemplate="listKeyValueItem",this.schema);if(!i)throw new Error("Missing required option 'schema'");this.openViewStateDialog=t.form.options.openViewStateDialog,this.template=t.template||this.constructor.template,this.model?this.value=this.setValueFromModel(t.key):void 0!==t.value&&(this.value=t.value),this.Editor=(t=i.itemType)?e.Dict[t]||e[t]:e.Text;var a=this,o=new RegExp(/^((_default|value)_.+)$/);$(document).on("dnd_stop.vakata",function(t,e){var i,n,s=$(e.event.target);s.closest(".jstree").length||s.closest(".viewstate-control").length&&(s=s.closest(".viewstate-control"),i=o.exec(s.data("key")),e=e.data.origin.get_path(e.data.nodes[0]),e=_.takeRight(e,e.length-1).join("/"),e=_.find(a.form.viewStates,{path:e}),n=a.form.fields[i[2]])&&n.editor&&e&&"dict"!==e.model.get("_type")&&(n=_.find(n.editor.items,{key:i[1]}))&&($(s).hasClass("dict-default")?n.editorDefault:n.editorValue).setModel(e.model)}),this.items=[],this.elementHeight},render:function(){function e(){event.preventDefault(),t.setAddButton(this),t.setLabelAdd(),t.addItem(null,"",!0)}var t=this,i=Backbone.$,i=i(i.trim(this.template()));this.$list=i.is("[data-items]")?i:i.find("[data-items]"),this.populateListFromValue(),this.setElement(i),this.$el.attr("id",this.id),this.$el.attr("name",this.key),this.hasFocus&&this.trigger("blur",this);return i.find('[data-action="add"]').click(e),i.find('[data-action="add"]').keypress(function(t){13==t.which&&e()}),this},addItem:function(t,e,i){function n(){s.items.push(o),s.$list.append(o.$el),o.on("changeKey",function(){var t=o.editorKey.getValue();t!==o.previousKey&&(s.value&&s.value.hasOwnProperty(o.previousKey)?(_.extend(s.value,o.getValue()),delete s.value[o.previousKey]):_.extend(s.value,o.getValue()),o.previousKey=t),s.trigger("change",s)}),o.on("changeValue",function(){s.value||(s.value={}),_.extend(s.value,o.getValue()),s.trigger("change",s)},s),o.on("remove",function(){s.removeItem(Item),s.trigger("change",s)}),o.editorKey.on("focus",function(){this.hasFocus||this.trigger("focus",this)},s),o.editorKey.on("blur",function(){var t;this.hasFocus&&(t=this,setTimeout(function(){_.find(t.items,function(t){return t.hasFocus})||t.trigger("blur",t)},0))},s),(i||t)&&(o.addEventTriggered=!0)}var s=this,a={},o=(a[e]=t,e=void 0===e?"":e,t=void 0===t?"":t,this.createDictItem(a));return this.Editor.isAsync?o.editorValue.on("readyToAdd",n,this):(n(),i&&o.editorKey.focus()),o},createDictItem:function(t){return new Form.editors.Dict.Item({list:this,form:this.form,schema:this.schema,value:t,Editor:this.Editor,key:this.key+"_"+this.items.length,index:this.items.length,openViewStateDialog:this.openViewStateDialog}).render()},onModelValueChange:function(t,e){try{this.setValue(_.clone(this.model.get(this.key)),t.forceRender),t.forceRender=!1}catch(t){console.log("BBForm on change error",t)}},populateListFromValue:function(){var i=this,t=this.value||[];_.each(_.clone(this.items),function(t){i.removeItem(t)}),this.items=[],this.$list.empty(),_.isEmpty(t)?this.Editor.isAsync||this.addItem():_.defer(function(){_.each(t,function(t,e){i.addItem(t,e)})})},removeItem:function(t){var e=this.schema.confirmDelete;e&&!confirm(e)||(e=_.indexOf(this.items,t),this.items[e].remove(),this.items.splice(e,1),t.addEventTriggered&&(this.trigger("remove",this,t.editor),this.trigger("change",this)),this.items.length)||this.Editor.isAsync||this.addItem()},getValue:function(){var e={};return _.each(this.items,function(t){$.extend(e,t.getValue())}),e},setAddButton:function(t){$(t).closest(".bbf-field").css("margin-bottom","0px"),$(t).css("left",0)},setLabelAdd:function(){var t=$(this.el).closest("div.bbf-editor"),e=$(this.el).closest("li.bbf-field").find("label");this.elementHeight=this.elementHeight||$(this.el).closest("li.bbf-field").find("div.bbf-dict").first().outerHeight(!0),"inline"===t.css("display")&&(t=$(this.el).closest("li.bbf-field").find(".bbf-dict").length,e.height((t+1)*this.elementHeight))},setValueFromModel:function(t){var i={};return _.each(this.model.get(t),function(t,e){t&&(!(t instanceof Backbone.Model)&&_.isObject(t)&&t.name?i[e]=t.name:i[e]=t)}),i},setValue:function(t,e){this.value=t,e&&this.populateListFromValue()},focus:function(){this.hasFocus||this.items[0]&&this.items[0].editorKey.focus()},blur:function(){var t;this.hasFocus&&(t=_.find(this.items,function(t){return t.editorKey.hasFocus}))&&t.editorKey.blur()},remove:function(){_.invokeMap(this.items,"remove"),Form.editors.Base.prototype.remove.call(this)},validate:function(){var t;return this.validators&&(t=_.map(this.items,function(t){return t.validate()}),!!_.compact(t).length)?{type:"list",message:"Some of the items in the list failed validation",errors:t}:null}}),Form.editors.Dict.Item=Form.editors.Base.extend({events:{'click [data-action="remove"]':function(t){t.preventDefault(),1<this.list.items.length&&this.setLabelRemove(),this.list.removeItem(this)},'keypress [data-action="remove"]':function(t){13==t.which&&(t.preventDefault(),1<this.list.items.length&&this.setLabelRemove(),this.list.removeItem(this))}},initialize:function(t){this.list=t.list,this.schema=t.schema||this.list.schema,this.value=t.value,this.Editor=t.Editor||Form.editors.Text,this.key=t.key,this.index=t.index,this.template=t.template||this.schema.itemTemplate||this.constructor.template,this.errorClassName=t.errorClassName||this.constructor.errorClassName,this.form=t.form,this.openViewStateDialog=t.form.openViewStateDialog,this.viewStates=t.form.viewStates,this.elementHeight},render:function(){var t,e,i=Backbone.$,n=this.schema,n=(n.options=_.map(_.filter(this.viewStates,function(t){return"dict"!==t.model.get("_type")}),function(t){return t.path}),t=this.value&&Object.keys(this.value)?Object.keys(this.value)[0]:"",e=(e=this.value&&Object.keys(this.value)?this.value[Object.keys(this.value)[0]]:"")||n.options[0],!_.isObject(e)||!e.type||e instanceof Backbone.Model||(e=e.value),this.editorKey=new Form.editors.Text({key:this.key+"_key",schema:this.schema,value:t,list:this.list,item:this,model:new Backbone.Model}).render(),this.editorValue=new Form.editors.TextViewState({key:this.key+"_value",schema:n,value:e,list:this.list,item:this,model:new Backbone.Model,openViewStateDialog:this.form.options.openViewStateDialog}).render(),this.previousKey=t,this.editorKey.on("change",function(){this.trigger("changeKey",this)},this),this.editorValue.on("change",function(){this.trigger("changeValue",this)},this),this.editorKey.el.className="dict-key",this.editorValue.el.className="dict-value viewstate-control",this.editorValue.el.setAttribute("data-key",this.key),i(i.trim(this.template())));return n.find(".bbf-tmp-key").replaceWith(this.editorKey.el),n.find(".bbf-tmp-value").replaceWith(this.editorValue.el),this.setElement(n),"undefined"!=t?this.editorKey.setValue(t):this.editorKey.setValue(""),this.setEditorValue(this.editorValue,this.valueViewState,e),this},getValue:function(){var t={};return t[this.editorKey.getValue()]=this.editorValue.getValue(),t},setEditorValue:function(t,e,i){e&&(this.stopListening(e),e=null),(e=_.find(this.viewStates,function(t){return t.path===i}))&&e.model?e.model instanceof Backbone.Model?t.setModel(e.model):(t.setValue({type:this.viewState.model.get("_type"),IsKdbParam:!0,isViewState:!0,name:i,orderIndex:this.orderIndex,value:this.viewState.model.get("value")}),t.$el.val(i)):t.setValue(i)},setLabelRemove:function(){var t=$(this.el).closest("div.bbf-editor"),e=$(this.el).closest("li.bbf-field").find("label");this.elementHeight=this.elementHeight||$(this.el).closest("li.bbf-field").find("div.bbf-dict").first().outerHeight(!0),"inline"===t.css("display")&&(t=$(this.el).closest("li.bbf-field").find(".bbf-dict").length,e.height((t-1)*this.elementHeight))},setValue:function(t,e){this.editorValue.setValue(t),_.isUndefined(e)||this.editorKey.setValue(e)},focus:function(){this.editorKey.focus()},blur:function(){this.editorKey.blur()},remove:function(){this.editorKey.remove(),this.editorValue.remove(),Backbone.View.prototype.remove.call(this)},validate:function(){var e,i=this.getValue(),n=this.list.form?this.list.form.getValue():{},t=this.schema.validators,s=this.getValidator;return t&&(e=null,_.every(t,function(t){return!(e=s(t)(i,n))}),e?this.setError(e):this.clearError(),e)||null},setError:function(t){this.$el.addClass(this.errorClassName),this.$el.attr("title",t.message)},clearError:function(){this.$el.removeClass(this.errorClassName),this.$el.attr("title",null)}},{errorClassName:"error"}),Form.editors.ThreeColumnDict=Form.editors.Dict.extend({initialize:function(t){Form.editors.Dict.prototype.initialize.call(this,t),this.listenTo(this.model,"change:_default",this.onModelValueChange),this.listenTo(this.model,"change:value",this.onModelValueChange)},createDictItem:function(t){return new Form.editors.ThreeColumnDict.Item({list:this,form:this.form,schema:this.schema,value:t,Editor:this.Editor,key:this.key+"_"+this.items.length,index:this.items.length,openViewStateDialog:this.openViewStateDialog}).render()},setValueFromModel:function(t){var i,e,n;if(this.model)return i=this.model.get("_default"),e=this.model.get("value"),n={},_.each(e,function(t,e){n[e]={_default:i[e],value:t}}),n},setValue:function(t,e){this.value=this.setValueFromModel(),e&&this.populateListFromValue()}}),Form.editors.ThreeColumnDict.Item=Form.editors.Dict.Item.extend({events:{'click [data-action="remove"]':function(t){t.preventDefault(),1<this.list.items.length&&this.setLabelRemove(),this.list.removeItem(this)}},render:function(){var t,e,i,n=Backbone.$,s=this.schema,s=(s.options=_.map(_.filter(this.viewStates,function(t){return"dict"!==t.model.get("_type")}),function(t){return t.path}),t=this.value&&Object.keys(this.value)?Object.keys(this.value)[0]:"",i=(i=this.value&&Object.keys(this.value)?this.value[Object.keys(this.value)[0]]:"")?(e=i._default,i.value):(e=s.options[0],s.options[0]),!_.isObject(i)||!i.type||i instanceof Backbone.Model||(i=i.value),!_.isObject(e)||!e.type||e instanceof Backbone.Model||(e=e.value),this.editorKey=new Form.editors.Text({key:this.key+"_key",schema:this.schema,value:t,list:this.list,item:this,model:new Backbone.Model}).render(),this.editorValue=new Form.editors.TextViewState({key:this.key+"_value",schema:s,value:i,list:this.list,item:this,model:new Backbone.Model,openViewStateDialog:this.form.options.openViewStateDialog}).render(),this.editorDefault=new Form.editors.TextViewState({key:this.key+"_default",schema:s,value:e,list:this.list,item:this,model:new Backbone.Model,openViewStateDialog:this.form.options.openViewStateDialog}).render(),this.previousKey=t,this.editorKey.on("change",function(){this.trigger("changeKey",this)},this),this.editorValue.on("change",function(){this.trigger("changeValue",this)},this),this.editorDefault.on("change",function(){this.trigger("changeValue",this)},this),this.editorKey.el.className="dict-key three-items",this.editorValue.el.className="dict-value viewstate-control three-items",this.editorValue.el.setAttribute("data-key",this.key),this.editorDefault.el.className="dict-default viewstate-control three-items",this.editorDefault.el.setAttribute("data-key",this.key),n(n.trim(this.template())));return s.find(".bbf-tmp-key").replaceWith(this.editorKey.el),s.find(".bbf-tmp-value").replaceWith(this.editorValue.el),s.find(".bbf-tmp-default").replaceWith(this.editorDefault.el),this.setElement(s),"undefined"!=t?this.editorKey.setValue(t):this.editorKey.setValue(""),this.setEditorValue(this.editorValue,this.valueViewState,i),this.setEditorValue(this.editorDefault,this.defaultViewState,e),this},getValue:function(){var t={};return t[this.editorKey.getValue()]={_default:this.editorDefault.getValue(),value:this.editorValue.getValue()},t},setValue:function(t,e){this.editorDefault.setValue(t._default),this.editorValue.setValue(t.value),_.isUndefined(e)||this.editorKey.setValue(e)}}),Backbone.View.extend({tagName:"form",$dialog:null,callback:null,initialize:function(e){var i=this;this.options=_.extend({classes:{"ui-dialog":"quick-base login-dialog"},title:t("List Editor"),resizable:!1,minHeight:260,width:300,modal:!0,autoOpen:!1,draggable:!1,buttons:[{text:t("OK"),click:function(){i.trigger("ok"),i.callback&&i.callback(),this._preventClose||i.$dialog.close()},icon:"fa fa-check"},{text:t("Cancel"),click:function(){i.trigger("cancel"),this._preventClose||i.$dialog.close()},icon:"fa fa-close"}],open:function(){$('<i class="fa fa-list" />').insertBefore(i.$el.parent().find(".ui-dialog-title")),$(".quick-base.main-app").addClass("disturbed"),_.defer(function(){i.trigger("shown")})},close:function(){i.trigger("hidden"),i.remove()}},e)},render:function(){return this.options.template&&this.$el.render(this.options.template()),this.$dialog=this.$el.dialog(this.options),this.isRendered=!0,this},open:function(t){this.callback=t,this.isRendered||this.render(),this.$dialog.open()},close:function(){var i=this,n=this.$el;this._preventClose?this._preventClose=!1:(n.one("hidden.bs.modal",function t(e){if(e.target!==e.currentTarget)return n.one("hidden",t);i.remove(),i.options.content&&i.options.content.trigger&&i.options.content.trigger("hidden",i),i.trigger("hidden")}),n.modal("hide"),FormsModal.count--)},preventClose:function(){this._preventClose=!0}},{count:0})),TagEditorView=(Form.editors.List=Form.editors.Base.extend({events:{'click [data-action="add"]':function(t){t.preventDefault(),this.addItem(void 0,!0)}},initialize:function(t){var e=Form.editors,i=(e.Base.prototype.initialize.call(this,t=t||{}),this.schema);if(!i)throw new Error("Missing required option 'schema'");this.schema=_.extend({addLabel:"Add"},i),this.template=t.template||i.listTemplate||this.constructor.template,this.Editor=(t=i.itemType)?e.List[t]||(_.isString(t)?e[t]:t):e.Text,this.ListItem=i.itemClass||e.List.Item,this.items=[]},render:function(){var e=this,t=this.value||[],i=Backbone.$,i=i(i.trim(this.template({addLabel:this.schema.addLabel})));return this.$list=i.is("[data-items]")?i:i.find("[data-items]"),(t=t instanceof Backbone.Collection?t.toJSON():t).length?_.each(t,function(t){e.addItem(t)}):this.Editor.isAsync&&this.addItem(),this._checkMaxCardinalityReached(i),this.setElement(i),this.$el.attr("id",this.id),this.$el.attr("name",this.key),this.hasFocus&&this.trigger("blur",this),this},_checkMaxCardinalityReached:function(t){this.schema.maxListLength&&this.items.length>=this.schema.maxListLength&&t.find('button[data-action="add"]').hide()},addItem:function(t,e){function i(){n.items.push(a),n.$list.append(a.el),n._checkMaxCardinalityReached(n.$el),a.editor.on("all",function(t){var e;"change"!==t&&((e=_.toArray(arguments))[0]="item:"+t,e.splice(1,0,n),s.List.prototype.trigger.apply(this,e))},n),a.editor.on("change",function(){a.addEventTriggered||(a.addEventTriggered=!0,this.trigger("add",this,a.editor)),this.trigger("item:change",this,a.editor),this.trigger("change",this)},n),a.editor.on("focus",function(){this.hasFocus||this.trigger("focus",this)},n),a.editor.on("blur",function(){var t;this.hasFocus&&(t=this,setTimeout(function(){_.find(t.items,function(t){return t.editor.hasFocus})||t.trigger("blur",t)},0))},n),(e||t)&&(a.addEventTriggered=!0),e&&(n.trigger("add",n,a.editor),n.trigger("change",n))}var n=this,s=Form.editors,a=new this.ListItem({list:this,form:this.form,schema:this.schema,value:t,Editor:this.Editor,key:this.key}).render();return this.Editor.isAsync?a.editor.on("readyToAdd",i,this):(i(),a.editor.focus()),a},removeItem:function(t){var e=this.schema.confirmDelete;e&&!confirm(e)||(e=_.indexOf(this.items,t),this.items[e].remove(),this.items.splice(e,1),t.addEventTriggered&&(this.trigger("remove",this,t.editor),this.trigger("change",this)),!this.items.length&&this.Editor.isAsync&&this.addItem(),this.schema.maxListLength&&this.items.length<this.schema.maxListLength&&this.$el.find('button[data-action="add"]').show())},getValue:function(){var t=_.map(this.items,function(t){return t.getValue()});return _.without(t,void 0,"")},setValue:function(t){this.value=t,this.render()},focus:function(){this.hasFocus||this.items[0]&&this.items[0].editor.focus()},blur:function(){var t;this.hasFocus&&(t=_.find(this.items,function(t){return t.editor.hasFocus}))&&t.editor.blur()},remove:function(){_.invokeMap(this.items,"remove"),Form.editors.Base.prototype.remove.call(this)},validate:function(){var t=_.map(this.items,function(t){return t.validate()});return!_.compact(t).length?null:{type:"list",message:"Some of the items in the list failed validation",errors:t}}}),Form.editors.List.Item=Form.editors.Base.extend({events:{'click [data-action="remove"]':function(t){t.preventDefault(),this.list.removeItem(this)},"keydown input[type=text]":function(t){13===t.keyCode&&(t.preventDefault(),this.list.addItem(),this.list.$list.find("> li:last input").focus())}},initialize:function(t){this.list=t.list,this.schema=t.schema||this.list.schema,this.value=t.value,this.Editor=t.Editor||Form.editors.Text,this.key=t.key,this.template=t.template||this.schema.itemTemplate||this.constructor.template,this.errorClassName=t.errorClassName||this.constructor.errorClassName,this.form=t.form},render:function(){var t=Backbone.$,t=(this.editor=new this.Editor({key:this.key,schema:this.schema,value:this.value,list:this.list,item:this,form:this.form}).render(),t(t.trim(this.template())));return t.find("[data-editor]").append(this.editor.el),this.setElement(t),this},getValue:function(){return this.editor.getValue()},setValue:function(t){this.editor.setValue(t)},focus:function(){this.editor.focus()},blur:function(){this.editor.blur()},remove:function(){this.editor.remove(),Backbone.View.prototype.remove.call(this)},validate:function(){var e,i=this.getValue(),n=this.list.form?this.list.form.getValue():{},t=this.schema.validators,s=this.getValidator;return this.editor.nestedForm&&this.editor.nestedForm.validate?this.editor.nestedForm.validate():t&&(e=null,_.every(t,function(t){return!(e=s(t)(i,n))}),e?this.setError(e):this.clearError(),e)||null},setError:function(t){this.$el.addClass(this.errorClassName),this.$el.attr("title",t.message)},clearError:function(){this.$el.removeClass(this.errorClassName),this.$el.attr("title",null)}},{errorClassName:"error"}),Form.editors.List.Modal=Form.editors.Base.extend({events:{click:"openEditor"},initialize:function(t){if(Form.editors.Base.prototype.initialize.call(this,t=t||{}),!Form.editors.List.Modal.ModalAdapter)throw new Error("A ModalAdapter is required");if(this.form=t.form,!t.form)throw new Error('Missing required option: "form"');this.template=t.template||this.constructor.template},render:function(){var t=this;return _.isEmpty(this.value)?this.openEditor():(this.renderSummary(),setTimeout(function(){t.trigger("readyToAdd")},0)),this.hasFocus&&this.trigger("blur",this),this},renderSummary:function(){this.$el.html($.trim(this.template({summary:this.getStringValue()})))},itemToString:function(i){i=i||{};var n=[];return _.each(this.nestedSchema,function(t,e){t=t.title||Form.Field.prototype.createTitle.call({key:e}),e=i[e];(_.isUndefined(e)||_.isNull(e))&&(e=""),n.push(t+": "+e)}),n.join("<br>")},getStringValue:function(){var t=this.schema,e=this.getValue();return _.isEmpty(e)?"[Empty]":(t.itemToString?t:this).itemToString(e)},openEditor:function(){var t=this.form.constructor,t=this.modalForm=new t({schema:this.nestedSchema,data:this.value}),t=this.modal=new Form.editors.List.Modal.ModalAdapter({content:t,animate:!0});t.open(),this.trigger("open",this),this.trigger("focus",this),t.on("cancel",this.onModalClosed,this),t.on("ok",_.bind(this.onModalSubmitted,this))},onModalSubmitted:function(){var t=this.modal,e=this.modalForm,i=!this.value;if(e.validate())return t.preventClose();this.value=e.getValue(),this.renderSummary(),i&&this.trigger("readyToAdd"),this.trigger("change",this),this.onModalClosed()},onModalClosed:function(){this.modal=null,this.modalForm=null,this.trigger("close",this),this.trigger("blur",this)},getValue:function(){return this.value},setValue:function(t){this.value=t},focus:function(){this.hasFocus||this.openEditor()},blur:function(){this.hasFocus&&this.modal&&this.modal.trigger("cancel")}},{ModalAdapter:FormsModal,isAsync:!0}),Form.editors.List.Object=Form.editors.List.Modal.extend({initialize:function(){Form.editors.List.Modal.prototype.initialize.apply(this,arguments);var t=this.schema;if(!t.subSchema)throw new Error('Missing required option "schema.subSchema"');this.nestedSchema=t.subSchema}}),Form.editors.List.NestedModel=Form.editors.List.Modal.extend({initialize:function(){Form.editors.List.Modal.prototype.initialize.apply(this,arguments);var t=this.schema;if(!t.model)throw new Error('Missing required option "schema.model"');t=t.model.prototype.schema;this.nestedSchema=_.isFunction(t)?t():t},getStringValue:function(){var t=this.schema,e=this.getValue();return _.isEmpty(e)?null:t.itemToString?t.itemToString(e):new t.model(e).toString()}}),jQuery.fn.caret=function(t){var e,i=this[0],n="true"===i.contentEditable;if(0!=arguments.length)return-1==t&&(t=this[n?"text":"val"]().length),window.getSelection?n?(i.focus(),window.getSelection().collapse(i.firstChild,t)):i.setSelectionRange(t,t):document.body.createTextRange&&(n?((a=document.body.createTextRange()).moveToElementText(i),a.moveStart("character",t),a.collapse(!0)):(a=i.createTextRange()).move("character",t),a.select()),n||i.focus(),t;if(window.getSelection)return n?(i.focus(),(s=(e=window.getSelection().getRangeAt(0)).cloneRange()).selectNodeContents(i),s.setEnd(e.endContainer,e.endOffset),s.toString().length):i.selectionStart;if(document.selection){if(i.focus(),n)return e=document.selection.createRange(),(s=document.body.createTextRange()).moveToElementText(i),s.setEndPoint("EndToEnd",e),s.text.length;var s,t=0,a=i.createTextRange(),n=(s=document.selection.createRange().duplicate()).getBookmark();for(a.moveToBookmark(n);0!==a.moveStart("character",-1);)t++;return t}return i.selectionStart||0},!function(v){v.fn.tagEditorInput=function(){var e=" ",i=v(this),n=parseInt(i.css("fontSize")),s=v("<span></span>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:i.css("fontSize"),fontFamily:i.css("fontFamily"),fontWeight:i.css("fontWeight"),letterSpacing:i.css("letterSpacing"),whiteSpace:"nowrap"});return s.insertAfter(i),i.bind("keyup keydown focus",function(){var t;e!==(e=i.val())&&(s.text(e),(t=(t=s.width()+n)<20?20:t)!=i.width())&&i.width(t)})},v.fn.tagEditor=function(n,s,a){function p(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}var f,o,g=v.extend({},v.fn.tagEditor.defaults,n);return g.dregex=new RegExp("["+g.delimiter.replace("-","-")+"]","g"),"string"==typeof n?(o=[],this.each(function(){var t=v(this),e=t.data("options"),i=t.next(".tag-editor");if("getTags"==n)o.push({field:t[0],editor:i,tags:i.data("tags")});else if("addTag"==n){if(e.maxTags&&i.data("tags").length>=e.maxTags)return!1;v('<li><div class="tag-editor-spacer">&nbsp;'+e.delimiter[0]+'</div><div class="tag-editor-tag"></div><div class="tag-editor-delete"><i></i></div></li>').appendTo(i).find(".tag-editor-tag").html('<input type="text" maxlength="'+e.maxLength+'">').addClass("active").find("input").val(s).blur(),a?v(".placeholder",i).remove():i.click()}else"removeTag"==n?(v(".tag-editor-tag",i).filter(function(){return v(this).text()==s}).closest("li").find(".tag-editor-delete").click(),a||i.click()):"destroy"==n&&t.removeClass("tag-editor-hidden-src").removeData("options").off("focus.tag-editor").next(".tag-editor").remove()}),"getTags"==n?o:this):(window.getSelection&&v(document).off("keydown.tag-editor").on("keydown.tag-editor",function(t){if(8==t.which||46==t.which||t.ctrlKey&&88==t.which){try{var e=getSelection(),n="INPUT"!=document.activeElement.tagName?v(e.getRangeAt(0).startContainer.parentNode).closest(".tag-editor"):0}catch(t){n=0}if(0<e.rangeCount&&n&&n.length){var s=[],a=e.toString().split(n.prev().data("options").dregex);for(i=0;i<a.length;i++){var o=v.trim(a[i]);o&&s.push(o)}return v(".tag-editor-tag",n).each(function(){~v.inArray(v(this).text(),s)&&v(this).closest("li").find(".tag-editor-delete").click()}),!1}}}),this.each(function(){var e,i,r=v(this),c=[],u=v("<ul "+(g.clickDelete?'oncontextmenu="return false;" ':"")+'class="tag-editor"></ul>').insertAfter(r),h=(r.addClass("tag-editor-hidden-src").data("options",g).on("focus.tag-editor",function(){u.click()}),u.append('<li style="width:1px">&nbsp;</li>'),'<li><div class="tag-editor-spacer">&nbsp;'+g.delimiter[0]+'</div><div class="tag-editor-tag"></div><div class="tag-editor-delete"><i></i></div></li>');function s(){!g.placeholder||c.length||v(".deleted, .placeholder, input",u).length||u.append('<li class="placeholder"><div>'+g.placeholder+"</div></li>")}function d(t){var e=c.toString();c=v(".tag-editor-tag:not(.deleted)",u).map(function(t,e){e=v.trim(v(this).hasClass("active")?v(this).find("input").val():v(e).text());if(e)return e}).get(),u.data("tags",c),r.val(c.join(g.delimiter[0])),t||e!=c.toString()&&g.onChange(r,u,c),s()}function a(t){for(var e,i=t.closest("li"),n=t.val().replace(/ +/," ").split(g.dregex),s=t.data("old_tag"),a=c.slice(0),o=!1,l=0;l<n.length;l++)if(m=v.trim(n[l]).slice(0,g.maxLength),g.forceLowercase&&(m=m.toLowerCase()),e=g.beforeTagSave(r,u,a,s,m),m=e||m,!1!==e&&m&&(g.removeDuplicates&&~v.inArray(m,a)&&v(".tag-editor-tag",u).each(function(){v(this).text()==m&&v(this).closest("li").remove()}),a.push(m),i.before('<li><div class="tag-editor-spacer">&nbsp;'+g.delimiter[0]+'</div><div class="tag-editor-tag">'+p(m)+'</div><div class="tag-editor-delete"><i></i></div></li>'),g.maxTags)&&a.length>=g.maxTags){o=!0;break}t.attr("maxlength",g.maxLength).removeData("old_tag").val(""),o?t.blur():t.focus(),d()}u.click(function(n,s){var a,o,l=99999;if(!window.getSelection||""==getSelection())return g.maxTags&&u.data("tags").length>=g.maxTags?u.find("input").blur():(f=!0,v("input:focus",u).blur(),f&&(f=!0,v(".placeholder",u).remove(),s&&s.length?o="before":v(".tag-editor-tag",u).each(function(){var t=v(this),e=t.offset(),i=e.left,e=e.top;n.pageY>=e&&n.pageY<=e+t.height()&&(a=n.pageX<i?(o="before",i-n.pageX):(o="after",n.pageX-i-t.width()))<l&&(l=a,s=t)}),("before"==o?v(h).insertBefore(s.closest("li")):"after"==o?v(h).insertAfter(s.closest("li")):v(h).appendTo(u)).find(".tag-editor-tag").click())),!1}),u.on("click",".tag-editor-delete",function(t){var e,i;return v(this).prev().hasClass("active")?v(this).closest("li").find("input").caret(-1):(i=(e=v(this).closest("li")).find(".tag-editor-tag"),!1!==g.beforeTagDelete(r,u,c,i.text())&&(i.addClass("deleted").animate({width:0},g.animateDelete,function(){e.remove(),s()}),d())),!1}),g.clickDelete&&u.on("mousedown",".tag-editor-tag",function(t){var e;if(t.ctrlKey||1<t.which)return t=(e=v(this).closest("li")).find(".tag-editor-tag"),!1!==g.beforeTagDelete(r,u,c,t.text())&&(t.addClass("deleted").animate({width:0},g.animateDelete,function(){e.remove(),s()}),d()),!1}),u.on("click",".tag-editor-tag",function(t){var e,i,n;return g.clickDelete&&(t.ctrlKey||1<t.which)||v(this).hasClass("active")||(i=v(this).text(),t=Math.abs((v(this).offset().left-t.pageX)/v(this).width()),t=parseInt(i.length*t),(e=v(this).html('<input type="text" maxlength="'+g.maxLength+'" value="'+p(i)+'">').addClass("active").find("input")).data("old_tag",i).tagEditorInput().focus().caret(t),g.autocomplete&&(i=v.extend({},g.autocomplete),n="select"in i?g.autocomplete.select:"",i.select=function(t,e){n&&n(t,e),setTimeout(function(){u.trigger("click",[v(".active",u).find("input").closest("li").next("li").find(".tag-editor-tag")])},20)},e.autocomplete(i))),!1}),u.on("blur","input",function(t){t.stopPropagation();var e=v(this),i=e.data("old_tag"),n=v.trim(e.val().replace(/ +/," ").replace(g.dregex,g.delimiter[0]));if(n){if(0<=n.indexOf(g.delimiter[0]))return void a(e);if(n!=i)if(g.forceLowercase&&(n=n.toLowerCase()),cb_val=g.beforeTagSave(r,u,c,i,n),n=cb_val||n,!1===cb_val){if(i)return e.val(i).focus(),f=!1,void d();try{e.closest("li").remove()}catch(t){}i&&d()}else g.removeDuplicates&&v(".tag-editor-tag:not(.active)",u).each(function(){v(this).text()==n&&v(this).closest("li").remove()})}else{if(i&&!1===g.beforeTagDelete(r,u,c,i))return e.val(i).focus(),f=!1,void d();try{e.closest("li").remove()}catch(t){}i&&d()}e.parent().html(p(n)).removeClass("active"),n!=i&&d(),s()}),u.on("paste","input",function(t){v(this).removeAttr("maxlength"),e=v(this),setTimeout(function(){a(e)},30)}),u.on("keypress","input",function(t){0<=g.delimiter.indexOf(String.fromCharCode(t.which))&&(i=v(this),setTimeout(function(){a(i)},20))}),u.on("keydown","input",function(t){var e,i,n=v(this);if((37==t.which||!g.autocomplete&&38==t.which)&&!n.caret()||8==t.which&&!n.val())return(e=n.closest("li").prev("li").find(".tag-editor-tag")).length?e.click().find("input").caret(-1):!n.val()||g.maxTags&&u.data("tags").length>=g.maxTags||v(h).insertBefore(n.closest("li")).find(".tag-editor-tag").click(),!1;if((39==t.which||!g.autocomplete&&40==t.which)&&n.caret()==n.val().length)return(i=n.closest("li").next("li").find(".tag-editor-tag")).length?i.click().find("input").caret(0):n.val()&&u.click(),!1;if(9==t.which){if(t.shiftKey)if((e=n.closest("li").prev("li").find(".tag-editor-tag")).length)e.click().find("input").caret(0);else{if(!n.val()||g.maxTags&&u.data("tags").length>=g.maxTags)return r.attr("disabled","disabled"),void setTimeout(function(){r.removeAttr("disabled")},30);v(h).insertBefore(n.closest("li")).find(".tag-editor-tag").click()}else if((i=n.closest("li").next("li").find(".tag-editor-tag")).length)i.click().find("input").caret(0);else{if(!n.val())return;u.click()}return!1}if(!(46!=t.which||v.trim(n.val())&&n.caret()!=n.val().length))return(i=n.closest("li").next("li").find(".tag-editor-tag")).length?i.click().find("input").caret(0):n.val()&&u.click(),!1;if(13==t.which)return u.trigger("click",[n.closest("li").next("li").find(".tag-editor-tag")]),g.maxTags&&u.data("tags").length>=g.maxTags&&u.find("input").blur(),!1;if(36!=t.which||n.caret()){if(35==t.which&&n.caret()==n.val().length)u.find(".tag-editor-tag").last().click();else if(27==t.which)return n.val(n.data("old_tag")?n.data("old_tag"):"").blur(),!1}else u.find(".tag-editor-tag").first().click()});for(var t=g.initialTags.length?g.initialTags:r.val().split(g.dregex),n=0;n<t.length&&!(g.maxTags&&n>=g.maxTags);n++){var m=v.trim(t[n].replace(/ +/," "));m&&(g.forceLowercase&&(m=m.toLowerCase()),c.push(m),u.append('<li><div class="tag-editor-spacer">&nbsp;'+g.delimiter[0]+'</div><div class="tag-editor-tag">'+p(m)+'</div><div class="tag-editor-delete"><i></i></div></li>'))}d(!0),g.sortable&&v.fn.sortable&&u.sortable({distance:5,cancel:".tag-editor-spacer, input",helper:"clone",update:function(){d()}})}))},v.fn.tagEditor.defaults={initialTags:[],maxTags:0,maxLength:50,delimiter:",;",placeholder:"",forceLowercase:!0,removeDuplicates:!0,clickDelete:!1,animateDelete:175,sortable:!0,autocomplete:null,onChange:function(){},beforeTagSave:function(){},beforeTagDelete:function(){}}}(jQuery),Backbone.View.extend({tagName:"textarea",className:"tagEditor",preventModelUpdate:!1,tagsList:[],initialize:function(t){this.$el.addClass(this.className),this.$el.tagEditor("destroy"),this.$el.val(""),this.$el.tagEditor({initialTags:t.tagsList,forceLowercase:!1,animateDelete:0,delimiter:"",maxLength:1e4,sortable:!0,removeDuplicates:t.removeDuplicates||!1,onChange:$.proxy(this.onTagsChanged,this)})},addMultipleTags:function(t){var e=this;_.each(t,function(t){e.$el.tagEditor("addTag",t,!0)})},onTagsChanged:function(t,e,i){this.trigger("changeList",i)},refreshTags:function(t){this.preventModelUpdate=!0,this.removeAllTags(),this.addMultipleTags(t),this.preventModelUpdate=!1},removeAllTags:function(){var e=this,t=e.$el.tagEditor("getTags")[0].tags;_.each(t,function(t){e.$el.tagEditor("removeTag",t,!0)})}})),ErrorTooltip=(Form.editors.CustomList=Form.editors.Base.extend({events:{},initialize:function(t){var e=Form.editors,i=(e.Base.prototype.initialize.call(this,t=t||{}),this.schema);if(!i)throw new Error("Missing required option 'schema'");this.template=t.template||this.constructor.template,this.Editor=(t=i.itemType)?e.List[t]||e[t]:e.Text,this.items=[]},render:function(){this.value;var t=Backbone.$,e=t(t.trim(this.template()));return this.$list=e.is("[data-items]")?e:e.find("[data-items]"),this.setElement(e),this.$el.attr("id",this.id),this.$el.attr("name",this.key),t("<textarea></textarea>").insertBefore(e.find(".bbf-actions")),this.tagEditor=new TagEditorView({el:e.find("textarea"),removeDuplicates:!1}),this.populateListFromValue(),this.hasFocus&&this.trigger("blur",this),this.$el.find('button[data-action="add"]').click(function(t){t.preventDefault(),this.addItem(null,!0)}.bind(this)),e.find("ul[data-items]").hide(),e.find("textarea li.ui-sortable-handle").remove(),e.find('button[data-action="add"]').hide(),this.schema.editorClass&&e.find("ul.tag-editor").addClass(this.schema.editorClass),this.listenTo(this.tagEditor,"changeList",function(t){this.items=[],_.each(t,function(t){t=new Form.editors.List.Item({list:this.items,form:this.form,schema:this.schema,value:t,Editor:this.Editor,key:this.key}).render();this.items.push(t)}.bind(this)),this.trigger("changeList",this)}),this},addItem:function(t,e){function i(){n.items.push(a),n.$list.append(a.$el),a.editor.on("all",function(t){var e;"change"!==t&&((e=_.toArray(arguments))[0]="item:"+t,e.splice(1,0,n),s.List.prototype.trigger.apply(this,e))},n),a.editor.on("change",function(){a.addEventTriggered||(a.addEventTriggered=!0),this.trigger("changeList",this)},n),a.on("changeList",function(){this.trigger("changeList",this)},n),a.editor.on("focus",function(){this.hasFocus||this.trigger("focus",this)},n),a.editor.on("blur",function(){var t;this.hasFocus&&(t=this,setTimeout(function(){_.find(t.items,function(t){return t.editor.hasFocus})||t.trigger("blur",t)},0))},n),(e||t)&&(a.addEventTriggered=!0),e&&(n.trigger("add",n,a.editor),n.trigger("changeList",this))}var n=this,s=Form.editors,a=new s.List.Item({list:this.items,form:this.form,schema:this.schema,value:t,Editor:this.Editor,key:this.key}).render();return this.Editor.isAsync?a.editor.on("readyToAdd",i,this):(i(),a.editor.focus()),a},onModelValueChange:function(t,e){e=e instanceof Backbone.Model?e:_.clone(e);try{this.setValue(e,t.forceRender),t.forceRender=!1}catch(t){console.log("BBForm on change error",t)}},populateListFromValue:function(){var e=this,t=this.value||[];this.items=[],this.$list.empty(),_.isArray(t)?_.each(t,function(t){e.addItem(t)}):_.isString(t)?e.addItem(t):this.Editor.isAsync||this.addItem(),t=1===this.items.length&&void 0===this.items[0].value?[]:this.items,this.tagEditor&&this.tagEditor.refreshTags(_.map(t,function(t){return t.value}))},removeItem:function(t){var e=this.schema.confirmDelete;e&&!confirm(e)||(e=_.indexOf(this.items,t),this.items[e].remove(),this.items.splice(e,1),t.addEventTriggered&&(this.trigger("remove",this,t.editor),this.trigger("change",this)),this.items.length)||this.Editor.isAsync||this.addItem()},getValue:function(){var t=_.map(this.items,function(t){return t.value});return _.without(t,void 0,"")},setValue:function(t,e){this.value=t,e&&this.populateListFromValue()},focus:function(){this.hasFocus||this.items[0]&&this.items[0].editor.focus()},blur:function(){var t;this.hasFocus&&(t=_.find(this.items,function(t){return t.editor.hasFocus}))&&t.editor.blur()},remove:function(){_.invokeMap(this.items,"remove"),Form.editors.Base.prototype.remove.call(this)},validate:function(){var t;return this.validators&&(t=_.map(this.items,function(t){return t.validate()}),!!_.compact(t).length)?{type:"list",message:"Some of the items in the list failed validation",errors:t}:null}}),Form.editors.CustomList.Item=Form.editors.Base.extend({events:{'click [data-action="remove"]':function(t){t.preventDefault(),-1<(t=this.list.indexOf(this))&&this.list.splice(t,1),this.remove(),this.trigger("changeList",this)},"keydown input[type=text]":function(t){13===t.keyCode&&t.preventDefault()}},initialize:function(t){this.list=t.list,this.schema=t.schema||this.list.schema,this.value=t.value,this.Editor=t.Editor||Form.editors.Text,this.key=t.key,this.template=t.template||this.schema.itemTemplate||this.constructor.template,this.errorClassName=t.errorClassName||this.constructor.errorClassName,this.form=t.form},render:function(){var t=Backbone.$,t=(this.editor=new this.Editor({key:this.key,schema:this.schema,value:this.value,list:this.list,item:this,form:this.form,model:new Backbone.Model}).render(),t(t.trim(this.template())));return t.find("[data-editor]").append(this.editor.el),this.setElement(t),t.find("input").val(this.value),this},getValue:function(){return this.editor.getValue()},setValue:function(t){this.editor.setValue(t)},focus:function(){this.editor.focus()},blur:function(){this.editor.blur()},remove:function(){this.editor.remove(),Backbone.View.prototype.remove.call(this)},validate:function(){var e,i=this.getValue(),n=this.list.form?this.list.form.getValue():{},t=this.schema.validators,s=this.getValidator;return t&&(e=null,_.every(t,function(t){return!(e=s(t)(i,n))}),e?this.setError(e):this.clearError(),e)||null},setError:function(t){this.$el.addClass(this.errorClassName),this.$el.attr("title",t.message)},clearError:function(){this.$el.removeClass(this.errorClassName),this.$el.attr("title",null)}},{errorClassName:"error"}),Form.editors.Long=Form.editors.Text.extend({defaultValue:"0",events:_.extend({},Form.editors.Text.prototype.events,{keypress:"onKeyPress",change:"onKeyPress"}),initialize:function(t){Form.editors.Text.prototype.initialize.call(this,t)},onKeyPress:function(t){function e(){setTimeout(function(){n.determineChange()},0)}var i,n=this;0===t.charCode||13===t.charCode||45===t.charCode||(i=this.$el.val().trim(),null!=t.charCode&&(i+=String.fromCharCode(t.charCode)),/^\-?[0-9]*?$/.test(i))||""===i?e():t.preventDefault()},getValue:function(){return this.$el.val()},setValue:function(t){_.isString(t)&&/^\-?[0-9]*?$/.test(t)||(t=null),Form.editors.Text.prototype.setValue.call(this,t)}}),!function(d){function e(c,t){var u,h=this;h.options=c,h.$element=d(t),h.dropdownId=c&&c.dropdownId?c.dropdownId:"",h.inputItemLimit=c&&_.isNumber(c.inputItemLimit)?c.inputItemLimit:5,h.tooltip=c.tooltip,h.tooltipItemLimit=c&&_.isNumber(c.tooltipItemLimit)?c.tooltipItemLimit:5,h.width=c&&_.isNumber(c.width)?c.width:"auto",u=h.$element.val(),h.applyTooltip=function(t,e){(items=_.map(t,function(t){return t.title||t.text}))&&_.isArray(items)?tooltip=items.slice(0,h.tooltipItemLimit||items.length).join(", "):items&&_.isString(items)&&(tooltip=items),items.length>h.tooltipItemLimit&&0!=h.tooltipItemLimit&&(tooltip+=" and "+(items.length-h.tooltipItemLimit)+" more"),e.prop("title",_.isFunction(h.tooltip)?h.tooltip(tooltip):tooltip)},d.fn.select2.amd.require(["select2/utils","select2/selection/multiple","select2/selection/eventRelay","select2/dropdown","select2/dropdown/attachBody","select2/dropdown/search"],function(r,n,t,e,i,s){var o;function a(){}function l(){}n.prototype.bind=function(t,e){var i=this;n.__super__.bind.apply(this,arguments),this.$selection.on("click",function(t){i.trigger("toggle",{originalEvent:t})}),this.$selection.on("click",".select2-selection__choice__remove",function(t){var e;i.options.get("disabled")||(e=d(this).parent().data("data"),i.trigger("unselect",{originalEvent:t,data:e}),t.stopPropagation())})},a.prototype.render=function(t){var e,i,a=this,t=t.call(this),o=_.keys(h.options.availableOptions);return getIconClass=function(t){var e="fa ";return t&&0!==t.length?_.isArray(t)&&t.length===o.length?e+="fa-check-square":e+="fa-minus-square":e+="fa-square",e+=" select2-select-all-checkbox"},e=d("<i />").addClass("fa fa-caret-down select2-dropdown-arrow"),i=d("<i />").addClass(getIconClass(a.$element.val())).attr("aria-selected",!1),t.append(e),t.prepend(i),a.$element.on("change",function(t){i[0].className=getIconClass(d(t.target).val())}),i.click(function(t){var e,i=a.$element.val()||[],n=d(".select2-search__field").val(),s=n?_.filter(o,function(t){return c.matcher({term:n},{text:t})}):o;_.isEmpty(_.difference(s,i))?(e=_.difference(i,s),a.$element.trigger("select-none")):(e=i.concat(s),a.$element.trigger("select-all")),a.$element.val(e).trigger("change"),t.stopPropagation()}),a.$element.width(h.width),t},a.prototype.update=function(t,e){var i,n,s,a;if(this.clear(),s=this.$selection.find(".select2-selection__rendered"),0===e.length&&0===h.inputItemLimit||e.length>h.inputItemLimit)i=this.display(n,a),s.empty().append('<div class="summary">'+i+"</div>");else{for(var o=[],l=0;l<e.length;l++)n=e[l],a=this.selectionContainer(),i=r.escapeMarkup(n.text),a.append(i),a.prop("title",n.title||n.text),a.data("data",n),o.push(a);r.appendMany(s,o)}h.applyTooltip(e,s)},e=!(l.prototype.render=function(t){t=t.call(this);return t.find(".select2-dropdown .select2-results").attr("id",h.dropdownId),t})===c.showSearch?e:r.Decorate(e,s),e=r.Decorate(r.Decorate(e,i),l),s=r.Decorate(r.Decorate(n,a),t),h.select2=h.$element.select2({ajax:c.ajax,closeOnSelect:!1,dropdownAdapter:e,matcher:c.matcher,minimumResultsForSearch:!1===c.showSearch?-1:0,placeholder:c.placeholder,selectionAdapter:s,theme:c.theme,templateSelection:function(){return h.options.templateSelection(h.$element.val()||[])},templateResult:function(e){var t,i,n,s;return void 0!==e.loading?e.text:(t="",e.text&&c.iconOptions&&!_.get(e,"children")&&(n=i="",s=_.flatMap(c.iconOptions,function(t){return _.get(t,"options")||t}),0<(s=_.filter(s,function(t){return t.val===e.id})).length)&&(i=s[0].Icon,n=s[0].IconColor,i)&&(t='<span class="'+i+'" style="color:'+n+';padding-right: 5px;"> </span>'),(_.get(e,"children")?(s="aria-selected",_.some(e.children,{selected:!1})||(s="aria-selected = 'true'"),d('<div class="groupRole" '+s+">")):d("<div>")).html(t+e.text).addClass(h.options.wrapClass))}}).data("select2"),h.select2.$container.css("width",h.width),h.select2.$results.off("mouseup").on("mouseup",".select2-results__option",(o=h.select2,function(i){var n,t=d(this),e=d(t.find(".groupRole")),s=d(t.children()),a=r.GetData(this,"data");_.some(a.children,{selected:!1})?e.attr("aria-selected",!1):e.attr("aria-selected",!0),d(i.target).hasClass("groupRole")?(n="true"===e.attr("aria-selected"),_.each(d(s[1]).find("li"),function(t,e){e=a.children[e];e.selected=!n,n?o.trigger("unselect",{originalEvent:i,data:e}):(o.$element.trigger("select",e),o.trigger("select",{originalEvent:i,data:e}))}),e.attr("aria-selected",!n),o.trigger("change"),o.$element.trigger("select",a)):("true"===t.attr("aria-selected")?o.trigger("unselect",{originalEvent:i,data:a}):(o.$element.trigger("select",a),o.trigger("select",{originalEvent:i,data:a})),t.addClass("select2-results__option--highlighted").siblings().removeClass("select2-results__option--highlighted"))})),h.$element.attr("multiple","multiple").val(u).trigger("change.select2"),_.isFunction(c.initCallback)&&c.initCallback(h.select2)})}d.fn.extend({dashMultiSelect:function(){var t=d.extend({templateSelection:function(t){return t.length+" selected"},wrapClass:"wrap"},arguments[0]);this.each(function(){new e(t,this)})}})}(jQuery),Form.editors.MultiSelect=Form.editors.Select.extend({inputItemLimit:5,tooltipItemLimit:10,matcher:null,tagName:"select",initialize:function(t){if(this.$el.prop("multiple","multiple"),t.schema&&(t.schema.dropdownId&&(this.dropdownId=t.schema.dropdownId),_.isNumber(t.schema.inputItemLimit)&&(this.inputItemLimit=t.schema.inputItemLimit),this.matcher=(_.isFunction(t.schema.matcher)?t.schema:$.fn.select2.defaults.defaults).matcher,t.schema.selectAllValue&&(this.selectAllValue=t.schema.selectAllValue),t.schema.tooltip&&(this.tooltip=t.schema.tooltip),_.isNumber(t.schema.tooltipItemLimit)&&(this.tooltipItemLimit=t.schema.tooltipItemLimit),_.isFunction(t.schema.onReadyCallback)&&(this.onReadyCallback=t.schema.onReadyCallback),t.schema.multiSelect&&(this.multiSelect=t.schema.multiSelect),this.viewstateType=t.schema.viewstateType||"list",t.schema.width)&&(this.width=t.schema.width),Form.editors.Select.prototype.initialize.call(this,t),!this.schema||!this.schema.options)throw new Error("Missing required 'schema.options'")},isEqualUnordered:function(t,e){return!(!_.isArray(t)||!_.isArray(e))&&t.length===e.length&&t.length===_.intersection(t,e).length},getValue:function(){var t;return!this.$el.data("select2")||this.renderingOptions?this.value||[]:(t=this.$el.val(),(t=this.isEqualUnordered(t,this.value)?this.value:t)&&t.length===_.keys(this.availableOptions).length&&this.selectAllValue?"list"===this.viewstateType?[this.selectAllValue]:this.selectAllValue:t||[])},getSelectedValuesForListReorder:function(t){return _.isString(t)?[t]:t},renderOptions:function(t){var e,i=this,n=this.$el;this.currentOptions=t,this.populateSelect(n,t),this.renderingOptions=!0,e={initCallback:function(t){var e=i.model.get(i.modelKey);i.renderingOptions=!1,i.form&&i.form.options&&"environment"===i.form.options.theme&&t.on("open",function(){$("body > .select2-container--dashboards.select2-container--open").addClass("select2--environment")}),t=i.multiSelect&&i.selectAllValue&&(e===i.selectAllValue||_.isArray(e)&&e[0]===i.selectAllValue)?i.selectAllValue:e,i.setValue(t),i.setWidth(i.width),i.onReadyCallback&&i.onReadyCallback(i.dropdownId)},availableOptions:i.availableOptions,iconOptions:t,dropdownId:i.dropdownId,inputItemLimit:i.inputItemLimit,matcher:i.matcher,showSearch:i.showSearch,templateSelection:function(t){return t.length<i.inputItemLimit?t.join(", "):t.length+" of "+_.keys(i.availableOptions).length+" selected"},theme:"dashboards",tooltip:i.tooltip,tooltipItemLimit:i.tooltipItemLimit,width:i.width},_.extend(e,this.getPaginationSettings(t)),n.dashMultiSelect(e),n.off("select-all.multiselect").on("select-all.multiselect",function(){var e=$(".select2-search__field").val(),t=e?_.filter(_.keys(i.availableOptions),function(t){return i.matcher({term:e},{text:t})}):_.keys(i.availableOptions);this.selectAllValue?i.$el.val(t):i.setValue(t),n.select2("close")}),n.off("select-none.multiselect").on("select-none.multiselect",function(){this.selectAllValue?i.$el.val([]):i.setValue([]),n.select2("close")}),n.off("select").on("select",function(t,e){i.renderedOptions[e.id]=e.text||e.id})},setUIValueOnce:function(t){(this.setUIValueOnce=_.once(function(t){this.value=t,this.$el.val(t).trigger("change.select2")}.bind(this)))(t)},setValue:function(t){var e,i,n,s,a,o=this;!this.$el.data("select2")||this.renderingOptions?this.value=t:(s=_.keys(this.availableOptions).sort(),a=(this.$el.val()||[]).slice().sort(),_.keys(this.renderedOptions).sort(),this.selectAllValue&&(t===this.selectAllValue||_.isArray(t)&&t[0]===this.selectAllValue)&&(t=s),s.length?(!_.isArray(t)&&_.includes(s,t)&&(t=[t]),s=_.intersection(t,s),this.model.get("Basics.GroupMapping.Group")||(e={},i=[],n=o.$el.find("option").toArray().map(function(t){return t.value}),_.each(_.difference(s,n),function(t){i.push(new Option(o.availableOptions[t],t)),e[t]=o.availableOptions[t]}),o.$el.append(i),o.renderedOptions=e),this.setUIValueOnce(s),this.isEqualUnordered(s,a)||(this.value=s,this.$el.val([]).val(this.value).trigger("change.select2"))):(this.value=t,this.$el.val([]).val(this.value).trigger("change.select2")))},setWidth:function(t){var e=this.$el.data("select2");this.width=t,e&&e.$container.css("width",this.width)}}),Form.editors.Object=Form.editors.Base.extend({hasNestedForm:!0,initialize:function(t){if(this.value={},Form.editors.Base.prototype.initialize.call(this,t),!this.form)throw new Error('Missing required option "form"');if(!this.schema.subSchema)throw new Error("Missing required 'schema.subSchema' option for Object editor")},render:function(){var t=this.form.constructor;return this.nestedForm=new t({schema:this.schema.subSchema,data:this.value,idPrefix:this.id+"_",Field:t.NestedField}),this._observeFormEvents(),this.$el.html(this.nestedForm.render().el),this.hasFocus&&this.trigger("blur",this),this},getValue:function(){return this.nestedForm?this.nestedForm.getValue():this.value},setValue:function(t){this.value=t,this.render()},focus:function(){this.hasFocus||this.nestedForm.focus()},blur:function(){this.hasFocus&&this.nestedForm.blur()},remove:function(){this.nestedForm.remove(),Backbone.View.prototype.remove.call(this)},validate:function(){var t=_.extend({},Form.editors.Base.prototype.validate.call(this),this.nestedForm.validate());return!_.isEmpty(t)&&t},_observeFormEvents:function(){this.nestedForm&&this.nestedForm.on("all",function(){var t=_.toArray(arguments);(t[1]=this).trigger.apply(this,t)},this)}}),Form.editors.NestedModel=Form.editors.Object.extend({initialize:function(t){if(Form.editors.Base.prototype.initialize.call(this,t),!this.form)throw new Error('Missing required option "form"');if(!t.schema.model)throw new Error('Missing required "schema.model" option for NestedModel editor')},render:function(){var t=this.form.constructor,e=this.value||{},i=(this.key,this.schema.model),i=e.constructor===i?e:new i(e);return this.nestedForm=new t({model:i,idPrefix:this.id+"_",fieldTemplate:"nestedField"}),this._observeFormEvents(),this.$el.html(this.nestedForm.render().el),this.hasFocus&&this.trigger("blur",this),this},commit:function(){var t=this.nestedForm.commit();return t?(this.$el.addClass("error"),t):Form.editors.Object.prototype.commit.call(this)}}),Form.editors.Number=Form.editors.Text.extend({defaultValue:0,events:_.extend({},Form.editors.Text.prototype.events,{keypress:"onKeyPress",change:"onKeyPress"}),initialize:function(t){Form.editors.Text.prototype.initialize.call(this,t);t=this.schema;t&&t.editorAttrs&&t.editorAttrs.step||this.$el.attr("step","any")},onKeyPress:function(t){function e(){setTimeout(function(){s.determineChange()},0)}var i,n,s=this,a=_.get(t,"target.selectionEnd"),o=this.$el.val().trim();if(45===t.charCode&&0===t.target.selectionEnd&&0===o.length)return"-";0===t.charCode||13===t.charCode||(void 0!==t.charCode&&(o=45===t.charCode&&0===a?String.fromCharCode(t.charCode)+o:o+String.fromCharCode(t.charCode)),i=(_.some(this.validators,function(t){return _.isFunction(t)&&"wholeNumber"===t.name})?/^\-?[0-9]*?$/:/^\-?[0-9]*\.?[0-9]*?$/).test(o),((n=o.toString().indexOf("."))<-1||n<a)&&this.atMaxDecimalsAllowed(o)&&t.preventDefault(),i)||""===o?e():t.preventDefault()},atMaxDecimalsAllowed:function(t){var e;return!_.isNil(_.get(this.schema,"useDecimalPlaces"))&&(e=_.get(this.schema,"decimalPlaces")?this.schema.decimalPlaces:2,!new RegExp("^-?(0|[1-9]\\d*)(\\.\\d{0,"+e+"})?$").test(t))},postRender:function(){var a=_.get(this.schema,"increment")?this.schema.increment:1;this.$el.spinner({classes:{"ui-spinner":"ui-corner-all"},step:a,spin:function(){return!1}}),this.$el.off("spin").on("spin",function(t,e){var i="-"===this.$el.val()?"0.0":this.$el.val(),i=parseFloat(i),n=_.get(this.schema,"useDecimalPlaces"),s=_.isNil(_.get(this.schema,"decimalPlaces"))?2:this.schema.decimalPlaces;_.isNaN(i)?this.$el.val(0):(i=this.floatingPointSum(i,a,e.value),n||(1<(e=""+i).split(".").length&&e.split(".")[1].length,s=Number.isInteger(i)?0:e.split(".")[1].length),this.$el.val(i.toFixed(s))),this.trigger("change",this)}.bind(this))},floatingPointSum:function(t,e,i){i=t<i?t+e:t-e;return 0===i||(t=Math.round(1e8*i)/1e8,1e-7<Math.abs(1-t/i))?i:t},getValue:function(){var t=this.$el.val();return"-"===t?"-":""===t?null:parseFloat(t,10)},setValue:function(t){t="-"===t||_.isNumber(t)?t:_.isString(t)&&""!==t?parseFloat(t,10):null,_.isNaN(t)&&(t=null),this.value=t,Form.editors.Text.prototype.setValue.call(this,t)}}),Form.editors.Password=Form.editors.Text.extend({initialize:function(t){Form.editors.Text.prototype.initialize.call(this,t),this.$el.attr("type","password")},getValue:function(){return this.$el.val()}}),Form.editors.Radio=Form.editors.Select.extend({tagName:"ul",events:{"change input[type=radio]":function(){this.trigger("change",this)},"focus input[type=radio]":function(){this.hasFocus||this.trigger("focus",this)},"blur input[type=radio]":function(){var t;this.hasFocus&&(t=this,setTimeout(function(){t.$("input[type=radio]:focus")[0]||t.trigger("blur",t)},0))}},getTemplate:function(){return this.schema.template||this.constructor.template},getValue:function(){return this.$("input[type=radio]:checked").val()},setValue:function(t){this.value=t,this.$("input[type=radio]").val([t])},focus:function(){var t;this.hasFocus||((t=this.$("input[type=radio]:checked"))[0]?t:this.$("input[type=radio]").first()).focus()},blur:function(){this.hasFocus&&this.$("input[type=radio]:focus").blur()},_arrayToHtml:function(t){var e=this.getTemplate(),i=this.getName(),n=this.id;return e({items:_.map(t,function(t,e){e={name:i,id:n+"-"+e};return _.isObject(t)?(e.value=t.val||0===t.val?t.val:"",e.label=t.label,e.labelHTML=t.labelHTML):(e.value=t,e.label=t),e})})}}),Form.editors.TextArea=Form.editors.Text.extend({tagName:"textarea",initialize:function(t){Form.editors.Base.prototype.initialize.call(this,t),this.previousValue=this.value}}),{clearAll:function(t){t?$("body .field-error").fadeOut():$("body .field-error").remove()},clear:function(t,e){t&&(e?t.fadeOut():t.remove())},show:function(t,e,i){if(t&&e)return i=i||{appendToBody:!0},$(e).position().left,$(e).position().top,(t=i.appendToBody?$("<div/>",{text:t}).addClass("field-error").appendTo("body"):$("<div/>",{text:t}).addClass("field-error").appendTo($(e).parent())).position({of:$(e),my:i.onLeft?"right center":"left center",at:i.onLeft?"left center":"right center",collision:"flip fit",using:function(t,e){var i=0,i="right"===e.horizontal?($(this).addClass("error-left-side"),-10):($(this).removeClass("error-left-side"),10);$(this).css({left:t.left+i+"px",top:t.top+"px"})}}),t}}),viewStateMethods=(Form.Field=Backbone.View.extend({initialize:function(t){t=t||{},_.extend(this,_.pick(t,"form","key","model","value","idPrefix")),this.base64=t.form.base64;var e=this.schema=this.createSchema(t.schema);this.template=t.template||e.template||this.template||this.constructor.template,this.errorClassName=t.errorClassName||this.errorClassName||this.constructor.errorClassName,this.editor=this.createEditor()},createSchema:function(t){return _.isString(t)&&(t={type:t}),(t=_.extend({type:"Text",title:t.fieldAttrs&&t.fieldAttrs.title?t.fieldAttrs.title:this.createTitle(),tooltipTitle:t.fieldAttrs&&t.fieldAttrs.tooltipTitle?t.fieldAttrs.tooltipTitle:this.createTooltipTitle()},t)).type=_.isString(t.type)?Form.editors[t.type]:t.type,t},createEditor:function(){var t=_.extend(_.pick(this,"schema","form","key","model","value"),{id:this.createEditorId()});return new this.schema.type(t)},createEditorId:function(){var t=this.idPrefix,e=(e=this.key).replace(/\./g,"_");return _.isString(t)||_.isNumber(t)?t+e:!_.isNull(t)&&this.model?this.model.cid+"_"+e:e},createTitle:function(){var t=this.key;return(t=(t=(t=(t=(t=-1<(t=this.base64?atob(t):t).indexOf("/")?t.split("/").pop():t).replace("_"," ")).trim()).replace(/([A-Z])/g," $1")).replace(/^./,function(t){return t.toUpperCase()})).trim()},createTooltipTitle:function(){var t=this.key;return t=this.base64?atob(t):t},getEditorElement:function(){var t=this.editor.$el;return t=this.editor.schema.options&&t.siblings(".select2").length?t.siblings(".select2"):t},getErrorClickEvent:function(){return"click.errorTooltip-"+this.editor.id},templateData:function(){var t=this.schema;return{help:t.help||"",title:t.title,titleHTML:t.titleHTML,tooltipTitle:t.tooltipTitle,fieldAttrs:t.fieldAttrs,editorAttrs:t.editorAttrs,key:this.key,editorId:this.editor.id}},render:function(){var t,e=this.schema,n=this.editor,i=this,s=Backbone.$;return!0===this.editor.noField?this.setElement(n.render().el):(t=s(s.trim(this.template(_.result(this,"templateData")))),e.fieldClass&&t.addClass(e.fieldClass),e.fieldAttrs&&t.attr(e.fieldAttrs),t.find("[data-editor]").add(t).each(function(t,e){var e=s(e),i=e.attr("data-editor");_.isUndefined(i)||(_.isFunction(n.preRender)?(e.append(n.preRender().el),n.render()):e.append(n.render().el),_.isFunction(n.postRender)&&n.postRender())}),t.click(function(t){i.clearError()}),this.setElement(t),this.setLabelId(),this)},setLabelId:function(){var i=this,t=this.el.getElementsByTagName("label")[0],n=_.uniqueId("label"),e=this.el.getElementsByTagName("select"),e=(e&&e[0]&&(t.setAttribute("id",n),e[0].setAttribute("aria-labelledby",n)),this.el.getElementsByClassName("tagEditor"));e&&e[0]&&(t.setAttribute("id",n),e[0].addEventListener("focus",function(t){var e=i.el.getElementsByTagName("input");e&&e[0].setAttribute("aria-labelledby",n)}))},disable:function(){_.isFunction(this.editor.disable)?this.editor.disable():($input=($input=this.editor.$el).is("input")?$input:$input.find("input")).attr("disabled",!0)},enable:function(){_.isFunction(this.editor.enable)?this.editor.enable():($input=($input=this.editor.$el).is("input")?$input:$input.find("input")).attr("disabled",!1)},validate:function(t){var e=this.editor.validate();return e?this.setError(e.message,t):this.clearError(),e},setError:function(t,e){var i=this.getEditorElement(),n=this.getErrorClickEvent();this.editor.hasNestedForm||(i.addClass(this.errorClassName),this.$errorTooltip&&ErrorTooltip.clear(this.$errorTooltip),this.$errorTooltip=ErrorTooltip.show(t,i,e),$("#appdiv").off(n),$("#appdiv").on(n,$.proxy(function(t){ErrorTooltip.clear(this.$errorTooltip)},this)))},clearError:function(){this.getEditorElement().removeClass(this.errorClassName),ErrorTooltip.clear(this.$errorTooltip),$("#appdiv").off(this.getErrorClickEvent())},commit:function(){return this.editor.commit()},getValue:function(){return this.editor.getValue()},setValue:function(t){this.editor.setValue(t)},focus:function(){this.editor.focus()},onResize:function(){this.$errorTooltip&&ErrorTooltip.clear(this.$errorTooltip)},blur:function(){this.editor.blur()},remove:function(){this.editor.remove(),this.$errorTooltip&&($("#appdiv").off(this.getErrorClickEvent()),this.$errorTooltip.remove()),Backbone.View.prototype.remove.call(this)}},{errorClassName:"error"}),Form.Fieldset=Backbone.View.extend({initialize:function(t){var e=this.schema=this.createSchema((t=t||{}).schema);this.fields=_.pick(t.fields,e.fields),this.template=t.template||e.template||this.template||this.constructor.template},createSchema:function(t){return(t=_.isArray(t)?{fields:t}:t).legend=t.legend||null,t},getFieldAt:function(t){t=this.schema.fields[t];return this.fields[t]},templateData:function(){return this.schema},render:function(){this.schema;var n=this.fields,s=Backbone.$,t=s(s.trim(this.template(_.result(this,"templateData"))));return t.find("[data-fields]").add(t).each(function(t,e){var i=s(e),e=i.attr("data-fields");_.isUndefined(e)||_.each(n,function(t){i.append(t.render().el)})}),this.setElement(t),this},remove:function(){_.each(this.fields,function(t){t.remove()}),Backbone.View.prototype.remove.call(this)}}),Form.NestedField=Form.Field.extend({}),Form.validators=function(){var n={};return n.errMessages={required:"Required",regexp:"Invalid",number:"Must be a number",range:Handlebars.compile("Must be a number between {{min}} and {{max}}"),email:"Invalid email address",url:"Invalid URL",match:Handlebars.compile('Must match field "{{field}}"')},n.required=function(i){return i=_.extend({type:"required",message:this.errMessages.required},i),function(t){i.value=t;var e={type:i.type,message:_.isFunction(i.message)?i.message(i):i.message};if(null==t||!1===t||""===t)return e}},n.regexp=function(i){if(i.regexp)return i=_.extend({type:"regexp",match:!0,message:this.errMessages.regexp},i),function(t){i.value=t;var e={type:i.type,message:_.isFunction(i.message)?i.message(i):i.message};if(null!=t&&""!==t)return"string"==typeof i.regexp&&(i.regexp=new RegExp(i.regexp,i.flags)),(i.match?!i.regexp.test(t):i.regexp.test(t))?e:void 0};throw new Error('Missing required "regexp" option for "regexp" validator')},n.number=function(t){return t=_.extend({type:"number",message:this.errMessages.number,regexp:/^\-?[0-9]*\.?[0-9]*?$/},t),n.regexp(t)},n.range=function(i){return i=_.extend({type:"range",message:this.errMessages.range,numberMessage:this.errMessages.number,min:0,max:100},i),function(t){i.value=t;var e={type:i.type,message:_.isFunction(i.message)?i.message(i):i.message};if(null!=t&&""!==t)return n.number({message:i.numberMessage})(t)||((t=parseFloat(i.value))<i.min||t>i.max?e:void 0)}},n.email=function(t){return t=_.extend({type:"email",message:this.errMessages.email,regexp:/^[\w\-]{1,}([\w\-\+.]{1,1}[\w\-]{1,}){0,}[@][\w\-]{1,}([.]([\w\-]{1,})){1,3}$/},t),n.regexp(t)},n.url=function(t){return t=_.extend({type:"url",message:this.errMessages.url,regexp:/^(http|https):\/\/[-a-zA-Z0-9@:%_\+.~#?&//=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=]*)?/gi},t),n.regexp(t)},n.match=function(n){if(n.field)return n=_.extend({type:"match",message:this.errMessages.match},n),function(t,e){n.value=t;var i={type:n.type,message:_.isFunction(n.message)?n.message(n):n.message};return null!=t&&""!==t&&t!==e[n.field]?i:void 0};throw new Error('Missing required "field" options for "match" validator')},n}(),function(i){return{initialize:function(t){i.prototype.initialize.apply(this,[t]),this.form=t.form,t.openViewStateDialog?this.quickdashOpenViewStateDialog=t.openViewStateDialog:t.form&&(this.quickdashOpenViewStateDialog=t.form.options.openViewStateDialog)},render:function(){var t,e;return this.form&&i.prototype.render.apply(this),this.cache={text:this.defaultValue||"",viewState:""},e=$(this.el),t=$("<div></div>"),this.$viewStateApply=$("<i></i>").addClass("fa fa-fw watermark fa-eye viewstate-apply"),this.$viewStateClear=$("<i></i>").addClass("fa fa-fw watermark fa-eraser viewstate-clear"),this.$viewStateContainer=$("<div></div>").addClass("viewstate-container"),this.$viewStateIcon=$("<i></i>").addClass("fa fa-fw watermark fa-eye viewstate-icon"),this.$viewStateInput=$("<input>").attr("type","text"),t.insertBefore(e),t.append(e),t.append(this.$viewStateApply),t.append(this.$viewStateContainer),t.addClass("viewstate-control"),this.$viewStateContainer.append(this.$viewStateClear),this.$viewStateContainer.append(this.$viewStateIcon),this.$viewStateContainer.append(this.$viewStateInput),this.$viewStateContainer.append(this.$viewStateToggle),this.$viewStateInput.attr("name",this.formname),this.$viewStateInput.attr("tabindex",-1),this.$viewStateClear.attr("tabindex",0),this.$viewStateInput.prop("readonly",!0),this.originalEl=this.el,this.el=t[0],this.isViewState=!1,this.applyControlState(),this.setValue(this.value),this},applyControlState:function(){var e,t=this,i=$(this.el);this.$viewStateApply.off("click"),this.$viewStateIcon.off("click"),this.$viewStateInput.off("click"),this.$viewStateClear.off("click"),this.isViewState?(i.addClass("is-viewstate"),this.$viewStateInput.click(function(){t.openViewStateDialog()}),this.$viewStateIcon.click(function(){t.openViewStateDialog()}),e=function(){t.isViewState=!1,t.model=null,t.$viewStateInput.val(""),t.setValue(t.cache.text),t.applyControlState()},this.$viewStateClear.keypress(function(t){13==t.which&&e()}),this.$viewStateClear.click(e)):(i.removeClass("is-viewstate"),this.$viewStateApply.click(function(){t.cache.text=t.value,t.openViewStateDialog()}))},destroy:function(){$(this.input).off("click"),this.$viewStateApply&&(this.$viewStateApply.off("click"),this.$viewStateApply=null),this.$viewStateIcon&&(this.$viewStateIcon.off("click"),this.$viewStateIcon=null),this.$viewStateInput&&(this.$viewStateInput.off("click"),this.$viewStateInput=null),this.$viewStateClear&&(this.$viewStateClear.off("click"),this.$viewStateClear=null),this._super()},determineChange:function(t){var e=this.getValue();e!==this.previousValue&&(this.previousValue=e,this.trigger("change",this))},formatValue:function(t){return t},getModel:function(){return this.model},getValue:function(){return this.isViewState?this.model||this.formatValue(""):this.formatValue(i.prototype.getValue.apply(this))},openViewStateDialog:function(){var e=this;this.quickdashOpenViewStateDialog&&this.quickdashOpenViewStateDialog(this.$viewStateInput.val(),function(t){e.isViewState=!0,e.setModel(t),e.applyControlState()})},setModel:function(t){var e=this.getModel()!==t,i=t?t.path:"";this.model=t,this.value=null,i!==this.$viewStateInput.val()&&this.$viewStateInput.val(i),this.isViewState||(this.isViewState=!0,this.applyControlState()),this.determineChange(e)},setTextValue:function(t){this.originalEl.value=t,this.value=t},setValue:function(t){var e,i,n;(_.isNull(t)||_.isUndefined(t))&&(t=""),e=this.value!==t,this.ignoreModelChanges||("viewstate"===(n=t,_.isObject(n)&&_.isFunction(n.get)?n.get("_viewType")?"viewstate":n.get("_dataType")?"datasource":void 0:"none")?(this.ignoreModelChanges=!0,this.setModel(t),i=(n=t).path,this.ignoreModelChanges=!1,this.value=n,this.$viewStateInput.val(i),i=!1===this.isViewState,this.isViewState=!0):(this.setTextValue(t),i=!0===this.isViewState,this.isViewState=!1)),i&&this.applyControlState(),this.determineChange(e)},validate:function(){return!this.isViewState&&i.prototype.validate.apply(this)}}}),T=(Form.editors.ViewState=Form.editors.Text.extend({initialize:function(t){Form.editors.Text.prototype.initialize.call(this,t),this.template=t.template||this.constructor.template,t.openViewStateDialog?this.baseOpenViewStateDialog=t.openViewStateDialog:t.form?this.baseOpenViewStateDialog=t.form.options.openViewStateDialog:this.baseOpenViewStateDialog=$.noop},initializeEvents:function(){this.$input.click(_.bind(this.openViewStateDialog,this))},getValue:function(){return this.value},openViewStateDialog:function(){var e=this,t=e.value instanceof Backbone.Model?e.value:null;e.baseOpenViewStateDialog(t,function(t){_.isEqual(t,e.value)||(e.setValue(t),e.trigger("change",e))})},setValue:function(t){var e=t?t.path:"";this.value=t,this.$input.val(e||"")},render:function(){var t=$(this.template());return this.$input=t.find("input"),this.setValue(this.value),this.setElement(t),this.initializeEvents(),this}}),function(){function t(){}return t.CustomList=Handlebars.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,n,s){return'<div class="bbf-customlist">\n    <ul data-items></ul>\n    <div class="bbf-actions"><button type="button" data-action="add"><i class="fa fa-plus"></i></button></div>\n</div>'},useData:!0}),t.DatePicker=Handlebars.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,n,s){var a,o=null!=e?e:t.nullContext||{},l=t.hooks.helperMissing,r="function",c=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div>\n    <input type="text" name="date_'+c(typeof(a=null!=(a=t(i,"key")||(null!=e?t(e,"key"):e))?a:l)==r?a.call(o,{name:"key",hash:{},data:s,loc:{start:{line:2,column:34},end:{line:2,column:41}}}):a)+'" id="'+c(typeof(a=null!=(a=t(i,"key")||(null!=e?t(e,"key"):e))?a:l)==r?a.call(o,{name:"key",hash:{},data:s,loc:{start:{line:2,column:47},end:{line:2,column:54}}}):a)+'" value="" >\n</div>'},useData:!0}),t.DatePickerRolling=Handlebars.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,n,s){var a,o=null!=e?e:t.nullContext||{},l=t.hooks.helperMissing,r="function",c=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div>\n    <label for="date_'+c(typeof(a=null!=(a=t(i,"key")||(null!=e?t(e,"key"):e))?a:l)==r?a.call(o,{name:"key",hash:{},data:s,loc:{start:{line:2,column:21},end:{line:2,column:28}}}):a)+'_checkbox"><i class="fa fa-info-circle" title="\nProvide an expression using one of the following forms: \n\n    NOW\n    NOW+x{BD|WD}  \n    NOW+hh:mm:ss.sss\n\nThe keyword NOW can be followed by a plus(+) or minus(-) sign, a number, and an optional qualifier for the type of day (BD or WD). \nThe number (x) refers to the number of days.\nThe qualifying day keyword BD refers to business days, and WD refers to weekdays.\n\n    "></i> Rolling</label>\n    <input type="checkbox" name="rolling" value="rolling" id="date_'+c(typeof(a=null!=(a=t(i,"key")||(null!=e?t(e,"key"):e))?a:l)==r?a.call(o,{name:"key",hash:{},data:s,loc:{start:{line:14,column:67},end:{line:14,column:74}}}):a)+'_checkbox">\n    <input type="text" name="date_'+c(typeof(a=null!=(a=t(i,"key")||(null!=e?t(e,"key"):e))?a:l)==r?a.call(o,{name:"key",hash:{},data:s,loc:{start:{line:15,column:34},end:{line:15,column:41}}}):a)+'" id="date_'+c(typeof(a=null!=(a=t(i,"key")||(null!=e?t(e,"key"):e))?a:l)==r?a.call(o,{name:"key",hash:{},data:s,loc:{start:{line:15,column:52},end:{line:15,column:59}}}):a)+'_date" value="" >\n    <input type="text" name="date_'+c(typeof(a=null!=(a=t(i,"key")||(null!=e?t(e,"key"):e))?a:l)==r?a.call(o,{name:"key",hash:{},data:s,loc:{start:{line:16,column:34},end:{line:16,column:41}}}):a)+'" id="date_'+c(typeof(a=null!=(a=t(i,"key")||(null!=e?t(e,"key"):e))?a:l)==r?a.call(o,{name:"key",hash:{},data:s,loc:{start:{line:16,column:52},end:{line:16,column:59}}}):a)+'_rolling" value="NOW" >\n</div>'},useData:!0}),t.DateRangePicker=Handlebars.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,n,s){var a,o=null!=e?e:t.nullContext||{},l=t.hooks.helperMissing,r="function",c=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="date-range-input-box date-range-input-box-row">\n    <div>\n        <input type="text" class="bbf-start" name="start_'+c(typeof(a=null!=(a=t(i,"key")||(null!=e?t(e,"key"):e))?a:l)==r?a.call(o,{name:"key",hash:{},data:s,loc:{start:{line:3,column:57},end:{line:3,column:64}}}):a)+'" id="start_'+c(typeof(a=null!=(a=t(i,"key")||(null!=e?t(e,"key"):e))?a:l)==r?a.call(o,{name:"key",hash:{},data:s,loc:{start:{line:3,column:76},end:{line:3,column:83}}}):a)+'" value="" >\n        <span class="fa fa-calendar calendar-span"></span>\n    </div>\n    <div>\n        <input type="text" class="bbf-end" name="end_'+c(typeof(a=null!=(a=t(i,"key")||(null!=e?t(e,"key"):e))?a:l)==r?a.call(o,{name:"key",hash:{},data:s,loc:{start:{line:7,column:53},end:{line:7,column:60}}}):a)+'" id="end_'+c(typeof(a=null!=(a=t(i,"key")||(null!=e?t(e,"key"):e))?a:l)==r?a.call(o,{name:"key",hash:{},data:s,loc:{start:{line:7,column:70},end:{line:7,column:77}}}):a)+'" value="" >\n        <span class="fa fa-calendar calendar-span"></span>\n    </div>\n</div>'},useData:!0}),t.DateTime=Handlebars.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,n,s){var a,o=null!=e?e:t.nullContext||{},l=t.hooks.helperMissing,r="function",c=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="bbf-datetime">\n    <div class="bbf-date-container" data-date></div>\n    <select data-type="hour">'+c(typeof(a=null!=(a=t(i,"hours")||(null!=e?t(e,"hours"):e))?a:l)==r?a.call(o,{name:"hours",hash:{},data:s,loc:{start:{line:3,column:29},end:{line:3,column:38}}}):a)+'</select>:\n    <select data-type="min">'+c(typeof(a=null!=(a=t(i,"mins")||(null!=e?t(e,"mins"):e))?a:l)==r?a.call(o,{name:"mins",hash:{},data:s,loc:{start:{line:4,column:28},end:{line:4,column:36}}}):a)+"</select>\n</div>\n"},useData:!0}),t.DateTimePicker=Handlebars.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,n,s){var a,o=null!=e?e:t.nullContext||{},l=t.hooks.helperMissing,r="function",c=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div>\n    <input type="text" name="date_'+c(typeof(a=null!=(a=t(i,"key")||(null!=e?t(e,"key"):e))?a:l)==r?a.call(o,{name:"key",hash:{},data:s,loc:{start:{line:2,column:34},end:{line:2,column:41}}}):a)+'" id="'+c(typeof(a=null!=(a=t(i,"key")||(null!=e?t(e,"key"):e))?a:l)==r?a.call(o,{name:"key",hash:{},data:s,loc:{start:{line:2,column:47},end:{line:2,column:54}}}):a)+'" value="" >\n</div>'},useData:!0}),t.DateTimePickerRolling=Handlebars.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,n,s){var a,o=null!=e?e:t.nullContext||{},l=t.hooks.helperMissing,r="function",c=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div>\n    <label for="date_'+c(typeof(a=null!=(a=t(i,"key")||(null!=e?t(e,"key"):e))?a:l)==r?a.call(o,{name:"key",hash:{},data:s,loc:{start:{line:2,column:21},end:{line:2,column:28}}}):a)+'_checkbox"><i class="fa fa-info-circle" title="\nProvide an expression using one of the following forms: \n\n    NOW\n    NOW+x{BD|WD}\n    NOW+hh:mm:ss.sss\n    NOW+x{BD|WD}@hh:mm:ss.sss\n\nThe keyword NOW can be followed by a plus(+) or minus(-) sign, a number, and an optional qualifier for the type of day (BD or WD). \nThe number (x) refers to the number of days.\nThe qualifying day keyword BD refers to business days, and WD refers to weekdays.\n\nNOTE: The \'@hh:mm:ss.sss\' specifies an exact time of day.\n    "></i> Rolling</label>\n    <input type="checkbox" name="rolling" value="rolling" id="date_'+c(typeof(a=null!=(a=t(i,"key")||(null!=e?t(e,"key"):e))?a:l)==r?a.call(o,{name:"key",hash:{},data:s,loc:{start:{line:16,column:67},end:{line:16,column:74}}}):a)+'_checkbox">\n    <input type="text" name="date_'+c(typeof(a=null!=(a=t(i,"key")||(null!=e?t(e,"key"):e))?a:l)==r?a.call(o,{name:"key",hash:{},data:s,loc:{start:{line:17,column:34},end:{line:17,column:41}}}):a)+'" id="date_'+c(typeof(a=null!=(a=t(i,"key")||(null!=e?t(e,"key"):e))?a:l)==r?a.call(o,{name:"key",hash:{},data:s,loc:{start:{line:17,column:52},end:{line:17,column:59}}}):a)+'_date" value="" >\n    <input type="text" name="date_'+c(typeof(a=null!=(a=t(i,"key")||(null!=e?t(e,"key"):e))?a:l)==r?a.call(o,{name:"key",hash:{},data:s,loc:{start:{line:18,column:34},end:{line:18,column:41}}}):a)+'" id="date_'+c(typeof(a=null!=(a=t(i,"key")||(null!=e?t(e,"key"):e))?a:l)==r?a.call(o,{name:"key",hash:{},data:s,loc:{start:{line:18,column:52},end:{line:18,column:59}}}):a)+'_rolling" value="NOW" >\n</div>\n'},useData:!0}),t.Dict=Handlebars.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,n,s){return'<div>\n    <ul data-items class="dict-items"></ul>\n    <i tabindex="0" class="fa fa-plus dict-button" data-action="add" title="Add" ></i>\n</div>'},useData:!0}),t.DictItem=Handlebars.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,n,s){return'<li>\n    <i tabindex="1" class="fa fa-trash dict-button" data-action="remove" title="Remove"></i>\n    <div class="bbf-dict">\n        <span class="bbf-tmp-key"></span>: <span class="bbf-tmp-default"></span\n        ><span class="bbf-tmp-value"></span>\n    </div>\n</li>\n'},useData:!0}),t.Field=Handlebars.template({1:function(t,e,i,n,s){var a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return t.escapeExpression("function"==typeof(i=null!=(i=a(i,"titleHTML")||(null!=e?a(e,"titleHTML"):e))?i:t.hooks.helperMissing)?i.call(null!=e?e:t.nullContext||{},{name:"titleHTML",hash:{},data:s,loc:{start:{line:2,column:72},end:{line:2,column:85}}}):i)},3:function(t,e,i,n,s){var a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return t.escapeExpression("function"==typeof(i=null!=(i=a(i,"title")||(null!=e?a(e,"title"):e))?i:t.hooks.helperMissing)?i.call(null!=e?e:t.nullContext||{},{name:"title",hash:{},data:s,loc:{start:{line:2,column:93},end:{line:2,column:102}}}):i)},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,s){var a,o=null!=e?e:t.nullContext||{},l=t.hooks.helperMissing,r="function",c=t.escapeExpression,u=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<li class="bbf-field field-'+c(typeof(a=null!=(a=u(i,"key")||(null!=e?u(e,"key"):e))?a:l)==r?a.call(o,{name:"key",hash:{},data:s,loc:{start:{line:1,column:27},end:{line:1,column:34}}}):a)+'">\n    <label for="'+c(typeof(a=null!=(a=u(i,"editorId")||(null!=e?u(e,"editorId"):e))?a:l)==r?a.call(o,{name:"editorId",hash:{},data:s,loc:{start:{line:2,column:16},end:{line:2,column:28}}}):a)+'" title="'+c(typeof(a=null!=(a=u(i,"tooltipTitle")||(null!=e?u(e,"tooltipTitle"):e))?a:l)==r?a.call(o,{name:"tooltipTitle",hash:{},data:s,loc:{start:{line:2,column:37},end:{line:2,column:53}}}):a)+'">'+(null!=(t=u(i,"if").call(o,null!=e?u(e,"titleHTML"):e,{name:"if",hash:{},fn:t.program(1,s,0),inverse:t.program(3,s,0),data:s,loc:{start:{line:2,column:55},end:{line:2,column:109}}}))?t:"")+'</label>\n    <div class="bbf-editor" data-editor></div>\n    <div class="bbf-help">'+c(typeof(a=null!=(a=u(i,"help")||(null!=e?u(e,"help"):e))?a:l)==r?a.call(o,{name:"help",hash:{},data:s,loc:{start:{line:4,column:26},end:{line:4,column:34}}}):a)+'</div>\n    <div class="bbf-error" data-error></div>\n</li>\n'},useData:!0}),t.Fieldset=Handlebars.template({1:function(t,e,i,n,s){var a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"    <legend>"+t.escapeExpression("function"==typeof(i=null!=(i=a(i,"legend")||(null!=e?a(e,"legend"):e))?i:t.hooks.helperMissing)?i.call(null!=e?e:t.nullContext||{},{name:"legend",hash:{},data:s,loc:{start:{line:3,column:12},end:{line:3,column:22}}}):i)+"</legend>\n"},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,s){var a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<fieldset>\n"+(null!=(i=a(i,"if").call(null!=e?e:t.nullContext||{},null!=e?a(e,"legend"):e,{name:"if",hash:{},fn:t.program(1,s,0),inverse:t.noop,data:s,loc:{start:{line:2,column:4},end:{line:4,column:11}}}))?i:"")+"    <ul data-fields></ul>\n</fieldset>"},useData:!0}),t.List=Handlebars.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,n,s){return'<div class="bbf-list">\n    <ul data-items></ul>\n    <div class="bbf-actions"><button type="button" data-action="add"><i class="fa fa-plus" ></i></button></div>\n</div>'},useData:!0}),t.ListItem=Handlebars.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,n,s){return'<li>\n    <button type="button" data-action="remove" class="bbf-remove"><i class="fa fa-close" ></i></button>\n    <div class="bbf-editor-container" data-editor></div>\n</li>'},useData:!0}),t.ListObject=Handlebars.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,n,s){var a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="bbf-list-modal">'+t.escapeExpression("function"==typeof(i=null!=(i=a(i,"summary")||(null!=e?a(e,"summary"):e))?i:t.hooks.helperMissing)?i.call(null!=e?e:t.nullContext||{},{name:"summary",hash:{},data:s,loc:{start:{line:1,column:28},end:{line:1,column:39}}}):i)+"</div>"},useData:!0}),t.Modal=Handlebars.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,n,s){var a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<div>"+t.escapeExpression("function"==typeof(i=null!=(i=a(i,"summary")||(null!=e?a(e,"summary"):e))?i:t.hooks.helperMissing)?i.call(null!=e?e:t.nullContext||{},{name:"summary",hash:{},data:s,loc:{start:{line:1,column:5},end:{line:1,column:16}}}):i)+"</div>"},useData:!0}),t.Month=Handlebars.template({1:function(t,e,i,n,s){var a=t.lambda,o=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                <option value="'+o(a(null!=e?t(e,"value"):e,e))+'">'+o(a(null!=e?t(e,"name"):e,e))+"</option>\n"},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,s){var a,o=null!=e?e:t.nullContext||{},l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <div class="bbf-date">\n        <select class="bbf-month" data-type="month">\n'+(null!=(a=l(i,"each").call(o,null!=e?l(e,"months"):e,{name:"each",hash:{},fn:t.program(1,s,0),inverse:t.noop,data:s,loc:{start:{line:3,column:12},end:{line:5,column:21}}}))?a:"")+'        </select>\n        <select class="bbf-year" data-type="year">\n'+(null!=(a=l(i,"each").call(o,null!=e?l(e,"years"):e,{name:"each",hash:{},fn:t.program(1,s,0),inverse:t.noop,data:s,loc:{start:{line:8,column:12},end:{line:10,column:21}}}))?a:"")+"        </select>\n    </div>"},useData:!0}),t.MonthRolling=Handlebars.template({1:function(t,e,i,n,s){var a=t.lambda,o=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                <option value="'+o(a(null!=e?t(e,"value"):e,e))+'">'+o(a(null!=e?t(e,"name"):e,e))+"</option>\n"},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,s){var a,o,l=null!=e?e:t.nullContext||{},r=t.hooks.helperMissing,c="function",u=t.escapeExpression,h=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div>\n    <label for="date_'+u(typeof(o=null!=(o=h(i,"key")||(null!=e?h(e,"key"):e))?o:r)==c?o.call(l,{name:"key",hash:{},data:s,loc:{start:{line:2,column:21},end:{line:2,column:28}}}):o)+'_checkbox"><i class="fa fa-info-circle" title="\nProvide an expression using one of the following forms: \n\n    NOW\n    NOW+x\n    NOW+hh:mm:ss.sss\n\nThe keyword NOW can be followed by a plus(+) or minus(-) sign and a number. \nThe number (x) represents a unit of measure that is equal to the data type\'s duration. \n\nNOTE: It is possible for the \'NOW+hh:mm:ss.sss\' expression to result in a different month.\n"></i> Rolling</label>\n    <input type="checkbox" name="rolling" value="rolling" id="date_'+u(typeof(o=null!=(o=h(i,"key")||(null!=e?h(e,"key"):e))?o:r)==c?o.call(l,{name:"key",hash:{},data:s,loc:{start:{line:14,column:67},end:{line:14,column:74}}}):o)+'_checkbox">\n    <div class="bbf-date">\n        <select class="bbf-month" data-type="month">\n'+(null!=(a=h(i,"each").call(l,null!=e?h(e,"months"):e,{name:"each",hash:{},fn:t.program(1,s,0),inverse:t.noop,data:s,loc:{start:{line:17,column:12},end:{line:19,column:21}}}))?a:"")+'        </select>\n        <select class="bbf-year" data-type="year">\n'+(null!=(a=h(i,"each").call(l,null!=e?h(e,"years"):e,{name:"each",hash:{},fn:t.program(1,s,0),inverse:t.noop,data:s,loc:{start:{line:22,column:12},end:{line:24,column:21}}}))?a:"")+'        </select>\n    </div>\n    <input type="text" name="date_'+u(typeof(o=null!=(o=h(i,"key")||(null!=e?h(e,"key"):e))?o:r)==c?o.call(l,{name:"key",hash:{},data:s,loc:{start:{line:27,column:34},end:{line:27,column:41}}}):o)+'" id="date_'+u(typeof(o=null!=(o=h(i,"key")||(null!=e?h(e,"key"):e))?o:r)==c?o.call(l,{name:"key",hash:{},data:s,loc:{start:{line:27,column:52},end:{line:27,column:59}}}):o)+'_rolling" value="NOW" >\n</div>\n\n\n\n'},useData:!0}),t.NestedField=Handlebars.template({1:function(t,e,i,n,s){var a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"        "+t.escapeExpression("function"==typeof(i=null!=(i=a(i,"titleHTML")||(null!=e?a(e,"titleHTML"):e))?i:t.hooks.helperMissing)?i.call(null!=e?e:t.nullContext||{},{name:"titleHTML",hash:{},data:s,loc:{start:{line:4,column:8},end:{line:4,column:21}}}):i)+"\n"},3:function(t,e,i,n,s){var a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"        "+t.escapeExpression("function"==typeof(i=null!=(i=a(i,"title")||(null!=e?a(e,"title"):e))?i:t.hooks.helperMissing)?i.call(null!=e?e:t.nullContext||{},{name:"title",hash:{},data:s,loc:{start:{line:6,column:8},end:{line:6,column:17}}}):i)+"\n"},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,s){var a,o=null!=e?e:t.nullContext||{},l=t.hooks.helperMissing,r="function",c=t.escapeExpression,u=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<li class="bbf-field bbf-nested-field field-'+c(typeof(a=null!=(a=u(i,"key")||(null!=e?u(e,"key"):e))?a:l)==r?a.call(o,{name:"key",hash:{},data:s,loc:{start:{line:1,column:44},end:{line:1,column:51}}}):a)+'">\n    <label for="'+c(typeof(a=null!=(a=u(i,"editorId")||(null!=e?u(e,"editorId"):e))?a:l)==r?a.call(o,{name:"editorId",hash:{},data:s,loc:{start:{line:2,column:16},end:{line:2,column:28}}}):a)+'">\n'+(null!=(t=u(i,"if").call(o,null!=e?u(e,"titleHTML"):e,{name:"if",hash:{},fn:t.program(1,s,0),inverse:t.program(3,s,0),data:s,loc:{start:{line:3,column:4},end:{line:7,column:11}}}))?t:"")+'    </label>\n    <div class="bbf-editor" data-editor></div>\n    <div class="bbf-help">'+c(typeof(a=null!=(a=u(i,"help")||(null!=e?u(e,"help"):e))?a:l)==r?a.call(o,{name:"help",hash:{},data:s,loc:{start:{line:10,column:26},end:{line:10,column:34}}}):a)+'</div>\n    <div class="bbf-error" data-error></div>\n</li>'},useData:!0}),t.NewObjectDialog=Handlebars.template({1:function(t,e,i,n,s){var a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div style="padding: 1em;">\n    '+t.escapeExpression("function"==typeof(i=null!=(i=a(i,"message")||(null!=e?a(e,"message"):e))?i:t.hooks.helperMissing)?i.call(null!=e?e:t.nullContext||{},{name:"message",hash:{},data:s,loc:{start:{line:3,column:4},end:{line:3,column:15}}}):i)+"\n</div>\n"},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,s){var a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(i=a(i,"if").call(null!=e?e:t.nullContext||{},null!=e?a(e,"message"):e,{name:"if",hash:{},fn:t.program(1,s,0),inverse:t.noop,data:s,loc:{start:{line:1,column:0},end:{line:5,column:7}}}))?i:"")+'<div class="bbForm-holder"></div>'},useData:!0}),t.Radio=Handlebars.template({1:function(t,e,i,n,s){var a,o=null!=e?e:t.nullContext||{},l=t.hooks.helperMissing,r="function",c=t.escapeExpression,u=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<li>\n<input type="radio" name="'+c(typeof(a=null!=(a=u(i,"name")||(null!=e?u(e,"name"):e))?a:l)==r?a.call(o,{name:"name",hash:{},data:s,loc:{start:{line:3,column:26},end:{line:3,column:34}}}):a)+'" value="'+c(typeof(a=null!=(a=u(i,"value")||(null!=e?u(e,"value"):e))?a:l)==r?a.call(o,{name:"value",hash:{},data:s,loc:{start:{line:3,column:43},end:{line:3,column:52}}}):a)+'" id="'+c(typeof(a=null!=(a=u(i,"id")||(null!=e?u(e,"id"):e))?a:l)==r?a.call(o,{name:"id",hash:{},data:s,loc:{start:{line:3,column:58},end:{line:3,column:64}}}):a)+'" >\n<label for="'+c(typeof(a=null!=(a=u(i,"id")||(null!=e?u(e,"id"):e))?a:l)==r?a.call(o,{name:"id",hash:{},data:s,loc:{start:{line:4,column:12},end:{line:4,column:18}}}):a)+'">'+(null!=(c=u(i,"if").call(o,null!=e?u(e,"labelHTML"):e,{name:"if",hash:{},fn:t.program(2,s,0),inverse:t.program(4,s,0),data:s,loc:{start:{line:4,column:20},end:{line:4,column:75}}}))?c:"")+"</label>\n</li>\n"},2:function(t,e,i,n,s){var a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return t.escapeExpression("function"==typeof(i=null!=(i=a(i,"labelHTML")||(null!=e?a(e,"labelHTML"):e))?i:t.hooks.helperMissing)?i.call(null!=e?e:t.nullContext||{},{name:"labelHTML",hash:{},data:s,loc:{start:{line:4,column:38},end:{line:4,column:51}}}):i)},4:function(t,e,i,n,s){var a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return t.escapeExpression("function"==typeof(i=null!=(i=a(i,"label")||(null!=e?a(e,"label"):e))?i:t.hooks.helperMissing)?i.call(null!=e?e:t.nullContext||{},{name:"label",hash:{},data:s,loc:{start:{line:4,column:59},end:{line:4,column:68}}}):i)},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,s){var a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=a(i,"each").call(null!=e?e:t.nullContext||{},null!=e?a(e,"items"):e,{name:"each",hash:{},fn:t.program(1,s,0),inverse:t.noop,data:s,loc:{start:{line:1,column:0},end:{line:6,column:9}}}))?i:""},useData:!0}),t.Slider=Handlebars.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,n,s){var a,o=null!=e?e:t.nullContext||{},l=t.hooks.helperMissing,r="function",c=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="slider" name="'+c(typeof(a=null!=(a=t(i,"name")||(null!=e?t(e,"name"):e))?a:l)==r?a.call(o,{name:"name",hash:{},data:s,loc:{start:{line:1,column:26},end:{line:1,column:34}}}):a)+'" value="'+c(typeof(a=null!=(a=t(i,"value")||(null!=e?t(e,"value"):e))?a:l)==r?a.call(o,{name:"value",hash:{},data:s,loc:{start:{line:1,column:43},end:{line:1,column:52}}}):a)+'" id="'+c(typeof(a=null!=(a=t(i,"id")||(null!=e?t(e,"id"):e))?a:l)==r?a.call(o,{name:"id",hash:{},data:s,loc:{start:{line:1,column:58},end:{line:1,column:64}}}):a)+'"></div>\n'},useData:!0}),t.ThreeColumnDict=Handlebars.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,n,s){return'<div>\n    <ul class="dict-legend"><li>Key</li><li>Default</li><li>Value</li></ul>\n    <ul data-items class="dict-items"></ul>\n    <i class="fa fa-plus dict-button" data-action="add" title="Add"></i>\n</div>'},useData:!0}),t.TimePicker=Handlebars.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,n,s){var a,o=null!=e?e:t.nullContext||{},l=t.hooks.helperMissing,r="function",c=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div>\n    <input type="text" name="date_'+c(typeof(a=null!=(a=t(i,"key")||(null!=e?t(e,"key"):e))?a:l)==r?a.call(o,{name:"key",hash:{},data:s,loc:{start:{line:2,column:34},end:{line:2,column:41}}}):a)+'" id="'+c(typeof(a=null!=(a=t(i,"key")||(null!=e?t(e,"key"):e))?a:l)==r?a.call(o,{name:"key",hash:{},data:s,loc:{start:{line:2,column:47},end:{line:2,column:54}}}):a)+'" value="">\n</div>'},useData:!0}),t.TimePickerRolling=Handlebars.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,n,s){var a,o=null!=e?e:t.nullContext||{},l=t.hooks.helperMissing,r="function",c=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div>\n    <div>\n        <label for="time_'+c(typeof(a=null!=(a=t(i,"key")||(null!=e?t(e,"key"):e))?a:l)==r?a.call(o,{name:"key",hash:{},data:s,loc:{start:{line:3,column:25},end:{line:3,column:32}}}):a)+'_checkbox">\n            <i class="fa fa-info-circle" title="\nProvide an expression using one of the following forms: \n\n    NOW\n    NOW+x\n    NOW+hh:mm:ss.sss\n\nThe keyword NOW can be followed by a plus(+) or minus(-) sign and a number. \nThe number (x) represents a unit of measure that is equal to the data type\'s duration. \n\nNOTE: \'x\' refers to minutes when the data type is \'time\'.\n"></i> \n            Rolling\n        </label>\n        <input type="checkbox" name="rolling" value="rolling" id="time_'+c(typeof(a=null!=(a=t(i,"key")||(null!=e?t(e,"key"):e))?a:l)==r?a.call(o,{name:"key",hash:{},data:s,loc:{start:{line:18,column:71},end:{line:18,column:78}}}):a)+'_checkbox">\n    </div>\n    <input type="text" name="time_'+c(typeof(a=null!=(a=t(i,"key")||(null!=e?t(e,"key"):e))?a:l)==r?a.call(o,{name:"key",hash:{},data:s,loc:{start:{line:20,column:34},end:{line:20,column:41}}}):a)+'" id="time_'+c(typeof(a=null!=(a=t(i,"key")||(null!=e?t(e,"key"):e))?a:l)==r?a.call(o,{name:"key",hash:{},data:s,loc:{start:{line:20,column:52},end:{line:20,column:59}}}):a)+'_time" value="">\n    <input type="text" name="time_'+c(typeof(a=null!=(a=t(i,"key")||(null!=e?t(e,"key"):e))?a:l)==r?a.call(o,{name:"key",hash:{},data:s,loc:{start:{line:21,column:34},end:{line:21,column:41}}}):a)+'" id="time_'+c(typeof(a=null!=(a=t(i,"key")||(null!=e?t(e,"key"):e))?a:l)==r?a.call(o,{name:"key",hash:{},data:s,loc:{start:{line:21,column:52},end:{line:21,column:59}}}):a)+'_rolling" value="NOW">\n</div>-'},useData:!0}),t.ViewState=Handlebars.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,n,s){return'<div class="viewstate-control is-viewstate">\n    <div class="viewstate-container">\n        <i class="fa fa-fw watermark fa-eye viewstate-icon"></i>\n        <input type="text" tabindex="-1" readonly >\n    </div>\n</div>'},useData:!0}),t.template=Handlebars.template({1:function(t,e,i,n,s){var a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <button type="button" class="reset">'+t.escapeExpression("function"==typeof(i=null!=(i=a(i,"resetButton")||(null!=e?a(e,"resetButton"):e))?i:t.hooks.helperMissing)?i.call(null!=e?e:t.nullContext||{},{name:"resetButton",hash:{},data:s,loc:{start:{line:4,column:40},end:{line:4,column:55}}}):i)+"</button>\n"},3:function(t,e,i,n,s){var a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <button type="submit">'+t.escapeExpression("function"==typeof(i=null!=(i=a(i,"submitButton")||(null!=e?a(e,"submitButton"):e))?i:t.hooks.helperMissing)?i.call(null!=e?e:t.nullContext||{},{name:"submitButton",hash:{},data:s,loc:{start:{line:7,column:26},end:{line:7,column:42}}}):i)+"</button>\n"},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,s){var a,o=null!=e?e:t.nullContext||{},l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<form class="bbf-form">\n    <div data-fieldsets></div>\n'+(null!=(a=l(i,"if").call(o,null!=e?l(e,"resetButton"):e,{name:"if",hash:{},fn:t.program(1,s,0),inverse:t.noop,data:s,loc:{start:{line:3,column:4},end:{line:5,column:11}}}))?a:"")+(null!=(a=l(i,"if").call(o,null!=e?l(e,"submitButton"):e,{name:"if",hash:{},fn:t.program(3,s,0),inverse:t.noop,data:s,loc:{start:{line:6,column:4},end:{line:8,column:11}}}))?a:"")+"</form>"},useData:!0}),t}()),NewObjectDialog=(Form.template=T.template,Form.Fieldset.template=T.Fieldset,Form.Field.template=T.Field,Form.NestedField.template=T.NestedField,Form.editors.DateTimePicker.template=T.DateTimePicker,Form.editors.DatePicker.template=T.DatePicker,Form.editors.DatePickerRolling.template=T.DatePickerRolling,Form.editors.DateTimePickerRolling.template=T.DateTimePickerRolling,Form.editors.Dict.template=T.Dict,Form.editors.Dict.Item.template=T.DictItem,Form.editors.ThreeColumnDict.template=T.ThreeColumnDict,Form.editors.ThreeColumnDict.Item.template=T.DictItem,Form.editors.Month.template=T.Month,Form.editors.MonthRolling.template=T.MonthRolling,Form.editors.Radio.template=T.Radio,Form.editors.TimePicker.template=T.TimePicker,Form.editors.TimePickerRolling.template=T.TimePickerRolling,Form.editors.ViewState.template=T.ViewState,Form.editors.Slider.template=T.Slider,Form.editors.DateRangePicker.template=T.DateRangePicker,Form.editors.List&&(Form.editors.List.template=T.List,Form.editors.List.Item.template=T.ListItem,Form.editors.List.Modal=T.Modal,Form.editors.List.Object.template=Form.editors.List.NestedModel.template=T.ListObject),Form.editors.CustomList&&(Form.editors.CustomList.template=T.CustomList,Form.editors.CustomList.Item.template=T.ListItem),QuickBase.DialogBase.extend({constructor:function(t){QuickBase.DialogBase.prototype.constructor.call(this,_.extend({iconClass:"fa-list-alt",width:400,minHeight:100},t)),this.options=t},dialogButtons:function(){var t=this;return[{text:this.options.okBtnLabel||"Add",click:this.onSave.bind(this),icon:this.options.okBtnIcon||"fa fa-plus"},{text:"Cancel",click:function(){t.isCancel=!0,t.dialogClose()},icon:"fa fa-times"}]},postRender:function(){this.model.schema=this.model.schema||this.appModel.get("dataStore").getFormSchema(this.schemaKey),this.model.schema&&(this.form=new Form({model:this.model}).render(),this.form.$el.keydown(function(t){if(13===t.which)return!1}),this.$el.find(".bbForm-holder").append(this.form.$el),this.onResize(),this.onFormRendered)&&this.onFormRendered()},renderTemplate:function(){var t=this.message||this.options.message;return t?T.NewObjectDialog({message:t}):T.NewObjectDialog()},onSave:function(){this.isCancel=!1,this.form.commit(),this.dialogClose()}})),App=Backbone.Form=Form;return Form.RTTI=RTTI,Form.editors.NumberViewState=Form.editors.Number.extend(viewStateMethods(Form.editors.Number)),Form.editors.TextViewState=Form.editors.Text.extend(viewStateMethods(Form.editors.Text)),Form.editors.TimePicker=Form.editors.TimePicker,Form.editors.ListViewState=Form.editors.CustomList.extend({defaultValue:[]}).extend(viewStateMethods(Form.editors.CustomList)).extend({setTextValue:function(t){this.value=t,this.model&&this.model.forceRender&&this.populateListFromValue()}}),Form.NewObjectDialog=NewObjectDialog,Form.ErrorTooltip=ErrorTooltip,App});