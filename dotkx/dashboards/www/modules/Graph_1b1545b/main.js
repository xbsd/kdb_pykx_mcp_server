define(["backbone","QuickBase","Handlebars","vis","moment","css!./css/app.css"],function(o,d,l,i,e){"use strict";var s,r=this&&this.__extends||(s=function(e,t){return(s=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function o(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),p=this&&this.__assign||function(){return(p=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++)for(var s in t=arguments[o])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)},n=(a.getComponentDefinition=function(e){var t={id:19,componentName:"Graph",componentDescription:"Graph",appKey:"Graph",css:"graphs",ghostViewThumb:null,buildViewThumb:null,appArgs:{quickStart:[{path:"Data.Nodes.Source",message:"populate Nodes Data Source"},{path:"Data.Edges.Source",message:"populate Edges Data Source"}],websiteUrl:e.websiteUrl,json:{version:"v2.2.8",Hidden:{NodeColumns:[],EdgeColumns:[]},Basic:{Name:"",Selected:"",SelectedEdge:"",Theme:"Dark"},Data:{Nodes:{Source:"",label:"",id:"",level:"",group:"",mass:"",color:{background:"",border:"",hover:{background:"",border:""},highlight:{background:"",border:""}},shape:{customShape:""}},Edges:{Source:"",from:"",to:"",id:""}},Layout:{randomLayoutPattern:!1,randomSeed:1111,hierarchical:{enabled:!0,levelSeparation:150,nodeSpacing:100,direction:"Left to Right"},clusterScale:0},Interaction:{dragNodes:!0,dragView:!0,selectConnectedEdges:!0},Physics:{enabled:!1,maxStepsBeforeRendering:1e3,haltPhysicsAfterRendering:!1,maxVelocity:50,minVelocity:.1,gravitationalConstant:2e3,centralGravity:.3,springLength:95,springConstant:.04},Actions:[],Tooltips:{tooltips:!1,tooltipsTemplate:""},Nodes:{borderWidth:1,borderWidthSelected:2,color:{border:"#999",background:"#97C2FC",highlight:{border:"#1795D3",background:"#FFFF7A"},hover:{border:"#2B7CE9",background:"#D2E5FF"}}},Edges:{width:1,selectionWidth:2,arrows:{to:{enabled:!0,scaleFactor:1},from:{enabled:!1,scaleFactor:1}},color:{color:"#999",highlight:"#0061FF",opacity:1}}},schema:{type:"object",title:"Properties",properties:{Hidden:{type:"object",options:{hidden:!0},properties:{NodeColumns:{type:"array",options:{hidden:!0}},EdgeColumns:{type:"array",options:{hidden:!0}}}},Basic:{type:"object",title:"Basic",options:{collapsed:!1},propertyOrder:200,properties:{Name:{title:"Name",type:"string",default:""},Selected:{type:"viewstate",title:"Selected Node",default:""},SelectedEdge:{type:"viewstate",title:"Selected Edge",default:""},Theme:{type:"string",title:"Theme",options:{hidden:!0},enum:["Dark","Light"]},DashboardTheme:{options:{hidden:!0}}}},Data:{type:"object",options:{collapsed:!0},propertyOrder:201,properties:{Nodes:{type:"object",properties:{Source:{type:"data",title:"Source"},label:{type:"string",title:"Label",enumSource:"possible_node",watch:{possible_node:"root.Hidden.NodeColumns"}},id:{type:"string",title:"ID (must be unique)",enumSource:"possible_node",watch:{possible_node:"root.Hidden.NodeColumns"}},level:{type:"string",title:"Level (optional)",enumSource:"possible_node",watch:{possible_node:"root.Hidden.NodeColumns"}},group:{type:"string",title:"Group (optional)",enumSource:"possible_node",watch:{possible_node:"root.Hidden.NodeColumns"}},mass:{type:"string",title:"Mass (optional)",tooltip:"Mass (optional):\n\nData source column that will be used to specify the mass of the individual nodes.\nIf no value is specified or the value is non-numeric, the minimum value of 1 will\nbe used. Larger values will increase the repulsion effect for that specific node.\n\nNOTE: To see the effect, this property requires Physics to be enabled.",enumSource:"possible_node",watch:{possible_node:"root.Hidden.NodeColumns"}},color:{title:"Node Color Sources",type:"object",options:{collapsed:!0},properties:{background:{type:"string",title:"Background Color",enumSource:"possible_node",watch:{possible_node:"root.Hidden.NodeColumns"}},border:{type:"string",title:"Border Color",enumSource:"possible_node",watch:{possible_node:"root.Hidden.NodeColumns"}},highlight:{type:"object",title:"Selected Node Color",options:{collapsed:!0},properties:{background:{type:"string",title:"Background Color",enumSource:"possible_node",watch:{possible_node:"root.Hidden.NodeColumns"}},border:{type:"string",title:"Border Color",enumSource:"possible_node",watch:{possible_node:"root.Hidden.NodeColumns"}}}},hover:{type:"object",title:"Node Hover Color",options:{collapsed:!0},properties:{background:{type:"string",title:"Background Color",enumSource:"possible_node",watch:{possible_node:"root.Hidden.NodeColumns"}},border:{type:"string",title:"Border Color",enumSource:"possible_node",watch:{possible_node:"root.Hidden.NodeColumns"}}}}}},shape:{title:"Shape",type:"object",options:{collapsed:!0},properties:{customShape:{type:"string",title:"Custom Shape",enumSource:"possible_node",watch:{possible_node:"root.Hidden.NodeColumns"}}}}}},Edges:{type:"object",properties:{Source:{type:"data",title:"Source"},from:{type:"string",title:"From",enumSource:"possible_edge",watch:{possible_edge:"root.Hidden.EdgeColumns"}},to:{type:"string",title:"To",enumSource:"possible_edge",watch:{possible_edge:"root.Hidden.EdgeColumns"}},id:{type:"string",title:"ID (optional)",enumSource:"possible_edge",watch:{possible_edge:"root.Hidden.EdgeColumns"}}}}}},Interaction:{type:"object",title:"User Interaction",options:{collapsed:!0},propertyOrder:202,properties:{dragNodes:{type:"boolean",title:"Draggable Nodes",default:!0,format:"checkbox"},dragView:{type:"boolean",title:"Draggable View",default:!0,format:"checkbox"},selectConnectedEdges:{type:"boolean",title:"Select Connected Edges",default:!0,format:"checkbox"}}},Physics:{type:"object",options:{collapsed:!0},propertyOrder:202,properties:{enabled:{type:"boolean",title:"Enable Physics",tooltip:"Enable Physics:\n\nWhen enabled, a physics algorithm is used to create the graph by simulating\nthe physical properties of nodes and edges while also being affected by gravity.",default:!1,format:"checkbox"},maxStepsBeforeRendering:{type:"number",min:1,title:"Max Steps Before Rendering",tooltip:"Max Steps Before Rendering:\n\nA step refers to a time duration where the position of one or more\nnodes may be affected by various forces (e.g. gravity, edge stiffness)\nand potentially traveling some distance given its velocity.\n\nThis value refers to the maximum number of steps taken before the\ngraph is visible.",default:1e3},haltPhysicsAfterRendering:{type:"boolean",title:"Halt Physics After Rendering",tooltip:"Halt Physics After Rendering:\n\nThis property determines whether physics will continue after the graph\nhas been rendered.\n\nWhen checked, after the initial rendering of the graph, the physics\nsimulation is paused.\n\nWhen unchecked, physics will continue to affect the layout of the graph\nuntil the 'Minimum Graph Speed' has been reached for all nodes.\n\nWhen unchecked, nodes repositioned by the user will cause the physics\nsimulation to continue until the 'Minimum Graph Speed' has been reached\nfor all nodes.",default:"false",format:"checkbox"},minVelocity:{type:"number",min:0,title:"Minimum Graph Speed",tooltip:"Minimum Graph Speed:\n\nOnce the speed of all the nodes is less than or equal to the minimum graph\nspeed, no further steps are taken to affect the position of the nodes.",default:.1},maxVelocity:{type:"number",min:0,title:"Maximum Node Velocity",tooltip:"Maximum Node Velocity:\n\nThe maximum speed at which the nodes are allowed to move.\nThis is a speed limit for the nodes.",default:50},gravitationalConstant:{type:"number",min:0,title:"Anti-Gravity Constant",tooltip:"Anti-Gravity Constant:\n\nThis value is used in a formula to quantify the effect of gravity\nfor the nodes as if it were a repelling force. It represents the\ngravitational constant as a negative value.\n\nHigher values increase the repulsion effect and lower values\napproaching zero will reduce it.",default:2e3},centralGravity:{type:"number",min:0,title:"Central Gravity Attractor",tooltip:"Central Gravity Attractor:\n\nA force pulling the entire network towards the center of the graph.\n\nThe higher the value, the stronger the pull towards the center.\nThe lower the value, the weaker the attraction towards the center.",default:.3},springLength:{type:"number",min:0,title:"Edge Length",tooltip:"Edge Length:\n\nThe edges of the graph are modelled as springs\nand this value determines their length at rest.",default:95},springConstant:{type:"number",min:0,title:"Edge Stiffness",tooltip:"Edge Stiffness:\n\nThe edges of the graph are modelled as springs.\nA larger value increases the minimum force\nrequired to affect the length of the edge.",default:.04}}},Actions:{type:"actions"},Tooltips:{type:"object",options:{collapsed:!0},propertyOrder:202,properties:{tooltips:{type:"boolean",title:"Show Tooltip",default:!1,format:"checkbox"},tooltipsTemplate:{type:"tooltipTemplate",title:"Template",default:"",templateItems:{values:{items:_.keyBy(["id","label","group","level","mass"]),type:"object"}}}}},Nodes:{type:"object",title:"Default Node Style",options:{collapsed:!0},propertyOrder:201,properties:{borderWidth:{type:"number",min:0,title:"Border Width",default:1},borderWidthSelected:{type:"number",title:"Selected Border Width",min:0,default:2},color:{type:"object",options:{collapsed:!0},properties:{background:{type:"gradient",options:{gradient:!1,noColor:!1},title:"Background Color",default:"#0061FF"},border:{type:"gradient",options:{gradient:!1,noColor:!1},title:"Border Color",default:"#999"},highlight:{type:"object",title:"Selected",options:{collapsed:!0},properties:{background:{type:"gradient",options:{gradient:!1,noColor:!1},title:"Background Color",default:"#FFFF7A"},border:{type:"gradient",options:{gradient:!1,noColor:!1},title:"Border Color",default:"#1795D3"}}},hover:{type:"object",title:"Hover",options:{collapsed:!0},properties:{background:{type:"gradient",options:{gradient:!1,noColor:!1},title:"Background Color",default:"#D2E5FF"},border:{type:"gradient",options:{gradient:!1,noColor:!1},title:"Border Color",default:"#2B7CE9"}}}}}}},Edges:{type:"object",title:"Default Edge Style",options:{collapsed:!0},propertyOrder:201,properties:{width:{type:"number",min:0,title:"Edge Width",default:1},selectionWidth:{type:"number",title:"Selected Edge Width",min:0,default:2},arrows:{type:"object",properties:{to:{type:"object",properties:{enabled:{type:"boolean",title:"Enabled",default:!0,format:"checkbox"},scaleFactor:{type:"number",title:"Arrow Size",default:1}}},from:{type:"object",properties:{enabled:{type:"boolean",title:"Enabled",default:!0,format:"checkbox"},scaleFactor:{type:"number",title:"Arrow Size",default:1}}}}},color:{type:"object",options:{collapsed:!0},properties:{color:{type:"gradient",options:{gradient:!1,noColor:!1},title:"Edge Color",default:"#999"},highlight:{type:"gradient",options:{gradient:!1,noColor:!1},title:"Selected Edge Color",default:"#0061FF"},opacity:{type:"number",title:"Opacity",min:0,max:1}}}}},Layout:{type:"object",options:{collapsed:!0},properties:{randomLayoutPattern:{type:"boolean",title:"Random Layout Pattern",default:!1,format:"checkbox"},randomSeed:{type:"number",title:"Layout Pattern",default:1111},clusterScale:{type:"number",title:"Group Zoom Threshold",tooltip:"Group Zoom Threshold:\n\nThe graph component will automatically zoom in/out when the window is resized and during the initial\nrendering so that all graph elements are within the visible boundary. The user can manually zoom \nin/out by using the mouse wheel or the touchpad pinch-zoom input method. Zooming in increases the\nzoom level, and zooming out decreases it.\n\nThe Group Zoom Threshold is a number between 0 and 100 and it is used to identify a threshold for\nwhen the graph will automatically transition between showing individual nodes versus the individual\ngroups for those nodes (groups have a circle shape).\n\nFor a given zoom level, if groups are displayed but the preference is to see individual nodes instead,\nthe value of the Group Zoom Threshold should be reduced.\n\nNOTE: Use of the Group Zoom Threshold requires the 'Data->Nodes->Group' property to be defined.",min:0,max:100,default:0},hierarchical:{type:"object",options:{collapsed:!1},properties:{enabled:{type:"boolean",title:"Enabled",format:"checkbox",default:"true"},levelSeparation:{type:"number",title:"Level Separation",default:150},nodeSpacing:{type:"number",title:"Node Spacing",default:100},direction:{type:"string",title:"Direction",enum:["Left to Right","Right to Left","Up to Down","Down to Up"],default:"Left to Right"}}}}}},_transform:function(t,o,e,i){var s,r;_.set(o,"properties.Layout.properties.randomSeed.hidden",t.Layout.randomLayoutPattern),"Layout.randomLayoutPattern"===e&&i(t,o),"Data.Nodes.Source"===e||"Data.Edges.Source"===e?(r=_.get(t,e),s=-1!==e.indexOf("Nodes")?"NodeColumns":"EdgeColumns",r?r.getMeta(function(e){t.Hidden[s]=_.concat([""],e.columns.collection.map("id")),i(t,o)}):(t.Hidden[s]=[],i(t,o))):"Physics.enabled"===e||"root"===e?(r=t.Physics.enabled,_.set(o,"properties.Physics.properties.maxStepsBeforeRendering.hidden",!r),_.set(o,"properties.Physics.properties.haltPhysicsAfterRendering.hidden",!r),_.set(o,"properties.Physics.properties.maxVelocity.hidden",!r),_.set(o,"properties.Physics.properties.minVelocity.hidden",!r),_.set(o,"properties.Physics.properties.gravitationalConstant.hidden",!r),_.set(o,"properties.Physics.properties.centralGravity.hidden",!r),_.set(o,"properties.Physics.properties.springLength.hidden",!r),_.set(o,"properties.Physics.properties.springConstant.hidden",!r),i(t,o)):i()}}}};if(0<_.keys(e.settingsModel.attributes).length)for(var o=a.upgrades.indexOf(_.find(a.upgrades,{version:e.settingsModel.get("version")}))+1;o<a.upgrades.length;o+=1){var i=a.upgrades[o];i.fn(e.settingsModel,e),e.settingsModel.set("version",i.version)}return t},a);function a(){}n.upgrades=[{version:0,fn:function(){}},{version:"4.2.1",fn:function(e){e.set("Tooltips",{tooltips:!1,tooltipsTemplate:""}),e.set("Nodes.color.hover",{border:"#2B7CE9",background:"#D2E5FF"}),e.set("Data.Nodes.color",{background:"",border:"",hover:{background:"",border:""},highlight:{background:"",border:""}})}},{version:"4.3.0d3",fn:function(e){e.get("Actions")||e.set("Actions",[]),e.get("Data.Nodes.group")||e.set("Data.Nodes.group","")}},{version:"4.3.1",fn:function(e){e.get("Data.Nodes.shape")||e.set("Data.Nodes.shape",[])}},{version:"4.4.0S2",fn:function(e){e.set("Style",{advanced:"",cssClasses:""})}},{version:"4.6.0d",fn:function(e){e.get("Basic.SelectedEdge")||e.set("Basic.SelectedEdge",""),e.get("Data.Edges.id")||e.set("Data.Edges.id","")}},{version:"4.6.1",fn:function(e){e.set("Physics.enabled",!1),e.set("Nodes.color.background","#97C2FC")}},{version:"4.7.7",fn:function(e){e.get("Basic.Name")||e.set("Basic.Name","")}},{version:"v2.2.8",fn:function(e){e.get("Data.Nodes.shape")&&!_.isArray(e.get("Data.Nodes.shape"))||(e.unset("Data.Nodes.shape"),e.set("Data.Nodes.shape",{customShape:""})),e.get("Data.Nodes.mass")||e.set("Data.Nodes.mass",""),e.get("Physics.maxVelocity")||e.set("Physics.maxVelocity",50),e.get("Physics.minVelocity")||e.set("Physics.minVelocity",.1),e.get("Physics.gravitationalConstant")||e.set("Physics.gravitationalConstant",2e3),e.get("Physics.centralGravity")||e.set("Physics.centralGravity",.3),e.get("Physics.springLength")||e.set("Physics.springLength",95),e.get("Physics.springConstant")||e.set("Physics.springConstant",.04),e.get("Physics.maxStepsBeforeRendering")||e.set("Physics.maxStepsBeforeRendering",1e3),e.get("Physics.haltPhysicsAfterRendering")||e.set("Physics.haltPhysicsAfterRendering",!1),e.get("Layout.randomLayoutPattern")||e.set("Layout.randomLayoutPattern",!1);var t=e.get("Layout.hierarchical.direction");["LR","RL","UD","DU"].includes(t)&&e.set("Layout.hierarchical.direction","UD"===t?"Up to Down":"DU"===t?"Down to Up":"RL"===t?"Right to Left":"Left to Right")}}];u.app=l.template({compiler:[8,">= 4.3.0"],main:function(e,t,o,i,s){return'<div class="graph-container">\n    <div class="graph" >\n    </div>\n</div>'},useData:!0});var h,c=u;function u(){}function g(e){var t=h.call(this,e)||this;return t.nodesData=[],t.edgesData=[],t.nodes=[],t.edges=[],t.network=void 0,t.ignoreOnSettingsChange=!1,t.errors={},t.listenersActive=!1,t.renderonResize=!1,t.isClustered=!1,t.groups=[],t.cachedPositions={},t.debug=!1,t.api=e.api,t.$el.html(c.app({})),t.$el.addClass("graph-app"),t.$graph=t.$el.find(".graph"),t.viewModel=new o.DeepModel({}),t.onDebouncedResize=_.debounce(t.onComponentResize.bind(t),800),t}return h=o.View,r(g,h),g.prototype.onComponentResize=function(){var e;null!=(e=this.network)&&e.fit()},g.prototype.onResizeStop=function(){this.renderonResize&&(this.renderGraph(),this.renderonResize=!1),0===this.$el.height()||0===this.$el.width()?this.renderonResize=!0:(this.network&&this.processCluster(this.network.getScale()),this.onDebouncedResize())},g.prototype.onSettingsChange=function(e){var o=this;if(_.each(e,function(e,t){o.viewModel.set(t,e)}),!this.ignoreOnSettingsChange&&Object.keys(e).filter(function(e){return-1===g.NORENDER_KEYS.indexOf(e)&&"string"==typeof e&&-1===g.NORENDER_KEYS.indexOf(e.split(".")[0])}).length)try{this.renderGraph()}catch(e){e instanceof Error&&d.Log.Warn(e.message)}else this.ignoreOnSettingsChange=!1;this.listenersActive||this.initializeListeners()},g.prototype.remove=function(){return this.destroyNetwork(),o.View.prototype.remove.apply(this)},g.prototype.initializeListeners=function(){var o=this;this.listenTo(this.viewModel,"change:Data.Nodes.Source",this.onNodesSourceChange.bind(this)),this.listenTo(this.viewModel,"change:Data.Edges.Source",this.onEdgesSourceChange.bind(this)),this.listenTo(this.viewModel,"change:Data.Nodes change:Tooltips",this.parseNodes.bind(this)),this.listenTo(this.viewModel,"change:Data.Edges",this.parseEdges.bind(this)),this.listenTo(this.viewModel,"change:Basic.Selected",function(e,t){return o.onSelectedNodeChange(t)}),this.listenTo(this.viewModel,"change:Basic.SelectedEdge",function(e,t){return o.onSelectedEdgeChange(t)}),this.listenTo(this.viewModel,"change:Layout.clusterScale",this.onClusterScaleChange.bind(this)),this.onNodesSourceChange(this.viewModel,this.viewModel.get("Data.Nodes.Source")),this.onEdgesSourceChange(this.viewModel,this.viewModel.get("Data.Edges.Source")),this.listenersActive=!0},g.prototype.debugLog=function(e){(this.debug||window.hasOwnProperty("debugGraph"))&&console.log("%cGraph: "+e,"background: #222; color: #bada55")},g.prototype.debugPerf=function(e,t){var o=performance.now();t(),this.debugLog("Graph Performance: "+e+" "+(performance.now()-o).toFixed(2)+"ms")},g.prototype.destroyNetwork=function(){this.network&&this.network.destroy()},g.prototype.listenToNetwork=function(){var e,s=this;this.network&&(this.viewModel.get("Physics.enabled")&&this.viewModel.get("Physics.haltPhysicsAfterRendering")&&this.network.on("stabilizationIterationsDone",function(){var e;s.network&&s.network.setOptions({physics:!1}),null!=(e=s.network)&&e.fit()}),this.network.on("select",e=function(e){s.ignoreOnSettingsChange=!0;var t=s.api.getPropertyMeta(g.PROP_SELECTED),t=(s.api.setProperty(g.PROP_SELECTED,"list"===t.viewstateType?e.nodes:_.first(e.nodes)||""),s.api.getPropertyMeta(g.PROP_SELECTED_EDGE));return s.api.setProperty(g.PROP_SELECTED_EDGE,"list"===t.viewstateType?e.edges:_.first(e.edges)||""),_.defer(function(){return s.api.doActions(s.viewModel.get("Actions"),"Actions")}),!0}),this.network.on("dragStart",e),this.viewModel.get("Tooltips.tooltips")&&(this.network.on("hoverNode",function(t){var e=_.find(s.nodesData,function(e){return e.id===t.node});s.updateNodeTooltip(e)}),this.network.on("hoverEdge",function(e){var t,o,i=s.dataSet.edges.get(e.edge);i?(i.from&&(o=_.find(s.nodesData,function(e){return e.id===i.from}),s.updateNodeTooltip(o)),i.to&&(o=_.find(s.nodesData,function(e){return e.id===i.to}),s.updateNodeTooltip(o))):e.edge&&e.edge.startsWith("clusterEdge")&&(o=null==(o=s.network)?void 0:o.clustering.getBaseEdges(e.edge),t=s.dataSet.edges.get(o[0]),e=void 0,o=s.dataSet.nodes.get(t.from),_.isEmpty(o.group)?e=_.find(s.nodesData,function(e){return e.id===t.from}):(o=s.dataSet.nodes.get(t.to),_.isEmpty(o.group)&&(e=_.find(s.nodesData,function(e){return e.id===t.to}))),e)&&s.updateNodeTooltip(e)})),this.network.on("zoom",function(e){e=e.scale;s.processCluster(e)}),this.network.once("afterDrawing",function(){var e;s.api.hideQueryStatus(),s.isClustered=!1,s.network&&s.processCluster(s.network.getScale()),null!=(e=s.network)&&e.setSelection({edges:s.getValidElements(s.viewModel.get(g.PROP_SELECTED_EDGE),g.ELEMENT_TYPE_EDGE),nodes:s.getValidElements(s.viewModel.get(g.PROP_SELECTED),g.ELEMENT_TYPE_NODE)})}))},g.prototype.updateNodeTooltip=function(e){var t,o,i,s,r,n;_.isNil(e)||(t=(i=this.viewModel.get("Data.Nodes")).label,o=i.id,i=i.group,r=(n=this.viewModel.get("Tooltips")).tooltips,n=n.tooltipsTemplate,s=this.api.getTemplateViewStates(n),r=r?l.compile(n):void 0,n=p(p({},s),{id:e[o],label:e[t],group:e[i],level:this.generateLevelFromNode(e),mass:this.generateMassFromNode(e)}),e.title=r?r(n):void 0,this.dataSet.nodes.update({id:e.id,title:e.title}))},g.prototype.onClusterScaleChange=function(){this.network&&this.processCluster(this.network.getScale())},g.prototype.processCluster=function(e){var t;""!==this.viewModel.get("Layout.clusterScale")&&((t=this.viewModel.get("Layout.clusterScale")/100)<e&&this.isClustered?(this.unclusterNodes(),this.isClustered=!1):e<t&&!this.isClustered&&(this.clusterNodes(),this.isClustered=!0))},g.prototype.clusterNodes=function(){this.cachePositions();for(var o=this,e=0;e<this.groups.length;e++)!function(e){var t=o.groups[e];t&&o.network&&o.network.cluster({clusterNodeProperties:{font:{size:75},id:t,label:t,shape:"circle",size:50,level:e},joinCondition:function(e){return e.group===t}})}(e)},g.prototype.unclusterNodes=function(){for(var e,t=0;t<this.groups.length;t++){var o=this.groups[t];this.network&&o&&null!=(e=this.network)&&e.isCluster(o)&&this.network.openCluster(o)}this.restoreCachedPositions()},g.prototype.cachePositions=function(){this.network&&(this.cachedPositions=this.network.getPositions())},g.prototype.restoreCachedPositions=function(){for(var e=Object.keys(this.cachedPositions),t=0;t<e.length;t++){var o=this.cachedPositions[e[t]],i=o.x,o=o.y;this.network&&this.network.moveNode(e[t],i,o)}},g.prototype.mapDataAttributes=function(){var t=this;return{edges:new i.DataSet(_.map(this.edges,function(e){return e=e,_.extend({},{arrows:{to:!0},labelHighlightBold:!1,selectionWidth:function(e){return e},shadow:!1,width:1},t.viewModel.get("Edges"),e)})),nodes:new i.DataSet(_.map(this.nodes,function(e){return e=e,_.merge({},{font:{face:"FontAwesome,Arial",size:12},labelHighlightBold:!1,shape:"box",shapeProperties:{borderRadius:3},mass:1},t.viewModel.get("Nodes"),e)}))}},g.prototype.onEdgesData=function(e,t,o){if(this.debugLog("onEdgesData Triggered"),o)return this.updateError("Edge Source",o);this.edgesData=t.items(),this.parseEdges()},g.prototype.onEdgesSourceChange=function(e,o){this.edgesSource&&(this.stopListening(this.edgesSource),this.api.unsubscribe(this.edgesSource)),this.edgesSource=o,this.edgesSource&&this.edgesSource.attributes?(this.updateError("Edge Source",void 0),this.api.subscribe(this.edgesSource,this.onEdgesData.bind(this))):(o=o&&o.path?o.path:"",_.isEmpty(o)||this.updateError("Edge Source",{error:t('Invalid Data Source: "')+o+'" '+t("selected"),type:"Warning"}))},g.prototype.onNodesData=function(e,t,o){if(this.debugLog("onNodesdata Triggered"),o)return this.updateError("Nodes Source",o);this.nodesData=t.items(),this.parseNodes()},g.prototype.onNodesSourceChange=function(e,o){this.nodesSource&&(this.stopListening(this.nodesSource),this.api.unsubscribe(this.nodesSource)),this.nodesSource=o,this.nodesSource&&this.nodesSource.attributes?(this.updateError("Node Source",void 0),this.api.subscribe(this.nodesSource,this.onNodesData.bind(this))):(o=o&&o.path?o.path:"",_.isEmpty(o)||this.updateError("Node Source",{error:t('Invalid Data Source: "')+o+'" '+t("selected"),type:"Warning"}))},g.prototype.isValueInNetwork=function(t,e){var o=this,i=e===g.ELEMENT_TYPE_EDGE?"Data.Edges.id":"Data.Nodes.id",e=e===g.ELEMENT_TYPE_EDGE?this.edgesData:this.nodesData;return!_.isNil(t)&&!_.isEmpty(this.viewModel.get(i))&&void 0!==_.find(e,function(e){return e[o.viewModel.get(i)].toString()===t.toString()})},g.prototype.getValidElements=function(e,t){var o=this;return _.isNil(e)?[]:(e=Array.isArray(e)?e:[e],_.filter(e,function(e){return o.isValueInNetwork(e,t)}))},g.prototype.onSelectedNodeChange=function(e){var t;this.network&&(_.isNil(e)?this.network.setSelection({edges:[],nodes:[]}):(e=this.getValidElements(e,g.ELEMENT_TYPE_NODE),t=this.network.getSelection().nodes,_.isEqual(t,e)||this.network.setSelection({edges:[],nodes:e})))},g.prototype.onSelectedEdgeChange=function(e){var t,o;this.network&&(_.isNil(e)?this.network.setSelection({edges:[],nodes:[]}):(t=this.getValidElements(this.api.getProperty(g.PROP_SELECTED),g.ELEMENT_TYPE_NODE),e=this.getValidElements(e,g.ELEMENT_TYPE_EDGE),o=this.network.getSelection().edges,_.isEqual(o,e)||this.network.setSelection({edges:e,nodes:t})))},g.prototype.parseEdges=function(){var e,o,i,s;this.edges=[],this.edgesData.length&&(e=this.viewModel.get("Data.Edges"),o=e.to,i=e.from,s=e.id,o&&i?this.edges=_.map(this.edgesData,function(e){var t=_.clone(e);return t.to=e[o],t.from=e[i],t.id=e[s],t}):d.Log.Warn("To & From are required fields.")),this.renderGraph()},g.prototype.parseNodes=function(){var o,i,s,e,t,r,n,a=this;this.nodes=[],this.nodesData.length&&(t=this.viewModel.get("Data.Nodes"),o=t.label,i=t.id,s=t.group,e=(t=this.viewModel.get("Tooltips")).tooltips,t=t.tooltipsTemplate,r=this.api.getTemplateViewStates(t),n=e?l.compile(t):void 0,o&&i?this.nodes=_.map(this.nodesData,function(e){var t=_.clone(e),e=(t.id=e[i],t.color=a.generateColorFromNode(e),t.shape=a.generateShapeFromNode(e),t.mass=a.generateMassFromNode(e),t.label=""+e[o],t.group=e[s],t.level=a.generateLevelFromNode(e),p(p({},r),{id:t.id,label:t.label,group:t.group,level:t.level,mass:t.mass}));return t.title=n?n(e):void 0,t}):d.Log.Warn("Label & id are required fields.")),this.setGroups(),this.renderGraph()},g.prototype.generateShapeFromNode=function(e){return e[this.viewModel.get("Data.Nodes.shape.customShape")]},g.prototype.setData=function(){var e=this;try{this.network&&this.debugPerf("Set Data",function(){e.network&&e.network.setData(e.mapDataAttributes())})}catch(e){e instanceof Error&&d.Log.Warn(e.message)}},g.prototype.setGroups=function(){this.groups=_.uniq(this.nodes.map(function(e){return e.group}))},g.prototype.generateColorFromNode=function(e){var t=this.viewModel.get("Data.Nodes.color");return{background:_.isEmpty(e[t.background])?void 0:e[t.background],border:_.isEmpty(e[t.border])?void 0:e[t.border],highlight:{background:_.isEmpty(e[t.highlight.background])?void 0:e[t.highlight.background],border:_.isEmpty(e[t.highlight.border])?void 0:e[t.highlight.border]},hover:{background:_.isEmpty(e[t.hover.background])?void 0:e[t.hover.background],border:_.isEmpty(e[t.hover.border])?void 0:e[t.hover.border]}}},g.prototype.generateLevelFromNode=function(e){var t=this.viewModel.get("Data.Nodes.level"),e=Number(e[t]);if(!isNaN(e))return e},g.prototype.generateMassFromNode=function(e){var t=this.viewModel.get("Data.Nodes.mass"),e=Number(e[t]);if(!(isNaN(e)||e<1))return e},g.prototype.getHierarchicalDirection=function(e){if(["LR","RL","UD","DU"].includes(e))return e;switch(e){case"Up to Down":return"UD";case"Down to Up":return"DU";case"Right to Left":return"RL";default:return"LR"}},g.prototype.renderGraph=function(){this.destroyNetwork();var e=_.omit(this.viewModel.get("Layout"),["clusterScale","randomLayoutPattern","randomSeed"]),t=(e.hierarchical.direction=this.getHierarchicalDirection(this.viewModel.get("Layout.hierarchical.direction")),this.viewModel.get("Layout.randomLayoutPattern")?void 0:this.viewModel.get("Layout.randomSeed")||0),t=(this.api.showQueryStatus({type:"Loading"}),{interaction:_.extend({hover:!0,multiselect:!0},this.viewModel.get("Interaction")),layout:_.extend({hierarchical:{blockShifting:!0,edgeMinimization:!0,parentCentralization:!0,sortMethod:"directed"},improvedLayout:!0,randomSeed:t},e),physics:{enabled:this.viewModel.get("Physics.enabled"),barnesHut:{gravitationalConstant:-Math.abs(this.viewModel.get("Physics.gravitationalConstant"))||0,centralGravity:this.viewModel.get("Physics.centralGravity")||0,springLength:this.viewModel.get("Physics.springLength")||0,springConstant:this.viewModel.get("Physics.springConstant")||0},maxVelocity:this.viewModel.get("Physics.maxVelocity")||0,minVelocity:this.viewModel.get("Physics.minVelocity")||0,solver:"barnesHut",stabilization:{iterations:this.viewModel.get("Physics.maxStepsBeforeRendering")||1}}});this.dataSet=this.mapDataAttributes(),this.network=new i.Network(this.$graph[0],this.dataSet,t),this.listenToNetwork()},g.prototype.updateError=function(e,t){t?this.errors[e]=t:delete this.errors[e],_.keys(this.errors).length?(t=_.map(this.errors,function(e,t){return"["+t+"]: "+e.error}),this.api.showErrorMessage({error:t.join("\n"),type:"Warning"})):this.api.hideErrorMessage()},g.getComponentDefinition=n.getComponentDefinition,g.PROP_SELECTED="Basic.Selected",g.PROP_SELECTED_EDGE="Basic.SelectedEdge",g.ELEMENT_TYPE_NODE="node",g.ELEMENT_TYPE_EDGE="edge",g.NORENDER_KEYS=["Basic.Selected","Basic.SelectedEdge","Data","Tooltips","Layout.clusterScale"],g});