define(["Handlebars","QuickBase","moment","xlsx","chartjs","backbone","Forms","css!./css/app.css"],function(f,y,g,R,E,r,H){"use strict";var N,V,e=this&&this.__extends||(N=function(e,t){return(N=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function a(){this.constructor=e}N(e,t),e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)}),m=this&&this.__assign||function(){return(m=Object.assign||function(e){for(var t,a=1,i=arguments.length;a<i;a++)for(var o in t=arguments[a])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},W=(V=r.DeepModel,e(o,V),o.prototype.getChartDataMapping=function(){return this.chartDataMapping},o.prototype.getColumnKeysFromAxisString=function(e,t){var a,i=/\/[gimsuy]*$/,o="",r=(e.startsWith("/")&&e.endsWith("/")?(a=e.substring(1,e.length-1).replace(i,""),o=(i=e.match(i))?i[0].substring(1):""):a="^"+(e=e.replace(/[\-\[\]\/\{\}\(\)\+\?\.\\\^\$\|]/g,"\\$&")).replace(/\*/g,"(.*)")+"$",new RegExp(a,o));return t.getColumnNames().filter(function(e){return e.match(r)})},o.prototype.getDataIcon=function(e){var t;if(this.get("Bubbles.SetIconFromData")&&(this.get("Bubbles.DataIcon")&&this.datasource))return null==(t=null==(t=this.datasource.getData())?void 0:t.get(e))?void 0:t.get(this.get("Bubbles.DataIcon"));return""},o.prototype.getDataIconColor=function(e){var t;if(this.get("Bubbles.SetIconFromData")&&(this.get("Bubbles.DataIconColor")&&this.datasource))return null==(t=null==(t=this.datasource.getData())?void 0:t.get(e))?void 0:t.get(this.get("Bubbles.DataIconColor"));return""},o.prototype.getLabels=function(){return this.labels},o.prototype.getPaletteColor=function(e){return this.palette[e%this.palette.length]},o.prototype.hasPatterns=function(){return"Bar"===this.get("_Hidden._Type")&&Object.keys(this.patterns).length},o.prototype.setPalette=function(e){this.palette=e},o.prototype.setPatterns=function(e){this.patterns=e},o.prototype.getDatasetLength=function(){return this.dataset.length},o.prototype.updateData=function(C,e,t){var a,L,i,D=this;this.checkForMissingFields(C,e,t)&&(this.datasource=C,this.setPreviousChartData(),this.chartData={},this.chartDataMapping={},t=e.find(function(e){return e.get("_Hidden._Label")===D.get("Axes.XAxisID")}),e=this.get("Axes.XAxisData"),a=this.getColumnKeysFromAxisString(e,C),L=0===e.indexOf("/")||-1!==e.indexOf("*"),this.isWild=L,0<a.length&&(i=this.getDataAccessor(C,a[0]),e=C.getData().map(function(e){return i(e)}),this.labels=t.get("Labels.FilterUnique")?_.uniq(e):e),a.forEach(function(s){var l=D.getDataAccessor(C,s);switch(D.get("_Hidden._Type")){case"Candlestick":D.chartDataMapping[s]={colX:s};var e=_.map(C.getData().models,function(e){return parseFloat(e.get(D.get("Axes.High")))}),t=_.map(C.getData().models,function(e){return parseFloat(e.get(D.get("Axes.Low")))}),a=D.getDataAccessor(C,D.get("Axes.Open")),i=D.getDataAccessor(C,D.get("Axes.Close")),o=D.getDataAccessor(C,D.get("Axes.High")),r=D.getDataAccessor(C,D.get("Axes.Low")),n=_.max(e),d=_.min(t);D.chartData[s]=C.getData().map(function(e){return{c:i(e),h:o(e),l:r(e),o:a(e),x:l(e),y:o(e)===n?1.05*(void 0===n?1:n):.95*(void 0===d?1:d)}});break;case"Violin":D.chartDataMapping[s]={colX:s};var e=_.flatten(_.map(C.getData().models,function(e){return _.map(e.get(D.get("Axes.Coords")),function(e){return parseFloat(e)})})),c=D.getViolinDataAccessor(C,D.get("Axes.Coords")),u=_.max(e),h=_.min(e);D.chartData[s]=C.getData().map(function(e){var t=c(e),a=void 0===u?1:u,i=void 0===h?1:h,o=_.max(_.map(t,function(e){return parseFloat(e)}));return{data:_.map(t,function(e){return parseFloat(e)}),median:_.mean(_.map(t,function(e){return parseFloat(e)})),x:l(e),y:void 0===o?0:a<=o?1.05*a:.95*i}});break;case"BoxPlot":D.chartDataMapping[s]={colX:s};var t=_.map(C.getData().models,function(e){return parseFloat(e.get(D.get("Axes.Min")))}),e=_.map(C.getData().models,function(e){return parseFloat(e.get(D.get("Axes.Max")))}),p=D.getDataAccessor(C,D.get("Axes.Min")),g=D.getDataAccessor(C,D.get("Axes.Q1")),m=D.getDataAccessor(C,D.get("Axes.Median")),f=D.getDataAccessor(C,D.get("Axes.Q3")),y=D.getDataAccessor(C,D.get("Axes.Max")),b=D.getDataAccessor(C,D.get("Axes.Outliers")),x=_.min(t),v=_.max(e);D.chartData[s]=C.getData().map(function(e){var t=b(e);return{max:y(e),median:m(e),min:p(e),outliers:_.isArray(t)?t:null,q1:g(e),q3:f(e),whiskerMax:y(e),whiskerMin:p(e),x:l(e),y:y(e)===v?1.05*(void 0===v?1:v):.95*(void 0===x?1:x)}});break;case"Line":case"Bar":case"Bubble":case"Waterfall":var t=D.get("Axes.YAxisData"),e=[],S=!1;"string"==typeof t&&(S=0===t.indexOf("/")||-1!==t.indexOf("*"),e=D.getColumnKeysFromAxisString(t,C),D.isWild=L||S),!e.length&&/^(-[\d.]+$)|[\d.]+$/.test(t)&&(e=[parseFloat(t)],S=!1),_.each(e,function(e){var t,a,i,o=[],o=(L&&o.push(s),S&&o.push(e.toString()),o.join(":")),r="number"==typeof e,n=r?e:D.getDataAccessor(C,e);D.chartDataMapping[o]={colX:s,colY:e},"Bubble"===D.get("_Hidden._Type")?(t=D.get("Axes.RadiusScaling"),a="Fixed Size"===D.get("Axes.Radius")?2:D.get("Axes.Radius"),i=D.getDataAccessor(C,D.get("Axes.Radius")),D.chartData[o]=C.getData().map(function(e){return{r:"number"==typeof a?a*t:Number(i(e))*t,x:l(e),y:r?n:n(e)}})):D.chartData[o]=C.getData().map(function(e){return{x:l(e),y:r?n:n(e)}})})}}),this.updateVisuals())},o.prototype.updateVisuals=function(){var e=this.computeCommonProps(),t=this.computeTypedProps();this.dataset=_.map(e,function(e){return _.extend({},t,e)})},o.prototype.computeHighlightRules=function(e,t,a,i){var o=this.get("HighlightRules"),r=[],n=e||this.get("Axes.YAxisData"),s=b.alpha(t,_.isNil(a)?80:a);if(o&&o.length){var l=o.map(function(e){return new RegExp((e.RuleTarget||"*").replace(/\*/g,"(.*)$"))});if(this.chartData[e]&&this.datasource)for(var d=0;d<this.datasource.getData().length;d++){var c=this.computeColorInternal(n,i,d,o,l);r.push(c?b.alpha(c,a):s)}return r}return s},o.prototype.computeColor=function(e,t,a,i,o){var r=this.get("HighlightRules"),o=b.alpha(this.computeColorInternal(e||this.get("Axes.YAxisData"),i,o,r,r.map(function(e){return new RegExp((e.RuleTarget||"*").replace(/\*/g,"(.*)$"))}))||t,a);return o="Bar"===this.get("_Hidden._Type")&&this.patterns[e]&&-1===i.indexOf("Border")?y.Tools.drawPattern(this.patterns[e],o,void 0,6,12).patternCanvas.toDataURL():o},o.prototype.getDataIconColors=function(i){if(this.get("Bubbles.SetIconFromData")&&this.datasource){var o,r=this.get("Bubbles.DataIconColor");if(r)return o=this.get("Basics.BackgroundOpacity"),this.datasource.getData().map(function(e,t){t=Array.isArray(i)?i[t]:i,e=e.get(r);if(e&&0!==e.indexOf("#")){var a=b.HEX_CODES[e];if(a)return b.alpha(a,o)}else if(e&&0===e.indexOf("#"))return b.alpha(e,o);return t})}return i},o.prototype.getLabelSettings=function(){var r=this,e=this.get("Labels"),t=e.Enabled,a=e.Frequency,i=e.Color,o=e.Anchor,n=e.Align,s=e.Offset,l=e.Template,e=e.Font,d=this.get("Labels"),c=d.Rotation,u=d.ShowOverlap,h=f.compile(l),p=["start","center","end"],g=["top","center","bottom"],m="iterative"===o||"iterative"===n||"auto",c=_.isNil(c)?0:c,u=!_.isNil(u)&&u;return{align:function(e){return"iterative"===n?g[e.dataIndex%g.length]:n},anchor:function(e){return"iterative"===o?p[e.dataIndex%p.length]:o},clamp:!0,clip:!0,color:i,display:function(e){return!!t&&(!!u||e.dataIndex%a==0&&m)},font:{size:e?e.Size:12,weight:e&&e.Bold?"bold":"normal"},formatter:function(t,e){if(!r.datasource)return"";var a=r.datasource.getData().at(e.dataIndex).toJSON();try{var i=Object.assign({},a,t),o=(i.key={x:_.get(e,"dataset.colX"),y:_.get(e,"dataset.colY")},i.cols=a,r.datasource.getApi().getTemplateViewStates(l));return h(_.assignIn(i,o))}catch(e){return _.isNumber(t.y)?t.y:t.x}},rotation:c,offset:s}},o.prototype.initialize=function(){this.listenTo(this,"change:Bubbles.SetIconFromData",function(e,t){var a=e.get("Bubbles.DataIcon"),i=e.get("Bubbles.DataIconColor");t?(void 0===a&&e.set("Bubbles.DataIcon",""),void 0===i&&e.set("Bubbles.DataIconColor","")):!1===t&&(void 0!==a&&e.set("Bubbles.DataIcon",void 0),void 0!==i)&&e.set("Bubbles.DataIconColor",void 0)})},o.prototype.checkForMissingFields=function(e,t,a){var i=this;return e?!o.dataFieldsMap[this.get("_Hidden._Type")].filter(function(e){return!i.get(e)}).length&&!!t.find(function(e){return e.get("_Hidden._Label")===i.get("Axes.XAxisID")})&&!!a.find(function(e){return e.get("_Hidden._Label")===i.get("Axes.YAxisID")}):(this.initialize(),!1)},o.prototype.getDataAccessor=function(e,t){var a=e.getPropertyFromColumn(t.toString()),t=e.getColumnType(a);return 12<=t&&t<=19?function(e){return O.convertKDBTemporalToMoment(e.get(a))}:7===t?function(e){return void 0===e.get(a)||_.isNil(e.get(a))?null:Number(e.get(a))}:function(e){return e.get(a)}},o.prototype.getViolinDataAccessor=function(e,t){var a=e.getPropertyFromColumn(t.toString());return function(e){return e.get(a)}},o.prototype.getPreviousChartData=function(e,t){e=0<=_.indexOf(Object.keys(this.previousChartData),e)?e:"";if(this.previousChartData&&this.previousChartData[e]){e=_.map(this.previousChartData[e],"y");if(e.length>=t)return e[t]}return null},o.prototype.setPreviousChartData=function(){this.previousChartData=_.extend({},this.chartData)},o.prototype.getRandomColour=function(e){var t=this.palette,e=e%t.length;return t[e]||"#0061FF"},o.prototype.computeColorInternal=function(r,n,s,e,l){var d,c,u=this,t=this.get("Basics"),a=t.Focus,t=t.Data,a=a?_.first(b.focus2Array(a)):[],h=void 0===a?0:a.length;return(c=t.dataSet&&t.dataSet.breakdownColumns?t.dataSet.breakdownColumns:c)&&c.attributes&&(c=c.get("value")),e.forEach(function(e,t){if(l[t].test(r)&&e.RuleSource){t="<this>"!==e.RuleSource?e.RuleSource:r;if("{breakdownId}"===e.RuleSource&&(t=c&&c[h]?c[h]:e.RuleSource),!u.datasource)return"#ffffff";var a,i,o,t=("string"==typeof s?u.datasource.getData().get(s):u.datasource.getData().at(s)).get(t);"iterative"===e.RuleType?(a=e.Palette[s%e.Palette.length],d=a.type||"#ffffff"):"gradient"===e.RuleType?(a=e.Palette,i=e.RuleMin,o=e.RuleMax,d=b.interpolateColor(a,i,o,t)):e.RuleOperation&&(a=e.RuleOperation,i=e.RuleValue,o=e[n],"previous"===i&&(i=u.getPreviousChartData(r,s)),b.getConditionResult(t,i,a))&&(d=o)}}),d},o.prototype.computeCommonProps=function(){var e,t,a,l=this,d=0,c={},u=this.get("_Hidden._Type");return this.datasource&&(e="bar"===u.toLowerCase()?"Bars":u,0<=_.indexOf(["Bar","BoxPlot","Candlestick","Violin","Waterfall"],u))&&(c={barPercentage:this.get(e+".BarPercentage")/100,categoryPercentage:this.get(e+".CategoryPercentage")/100},"percentage"!==this.get(e+".BarWidthType")&&(t=this.get(e+".MaxBarThickness"),a=this.get(e+".BarThickness"),c.barThickness=a,c.maxBarThickness=t,c.minBarLength=0),"Waterfall"===u)&&(c.increaseColor=this.get(e+".IncreaseColor"),c.decreaseColor=this.get(e+".DecreaseColor")),"Candlestick"===u?_.map(this.chartData,function(e,t){return _.merge({borderColor:b.alpha(l.get("Basics.BorderColor"),l.get("Basics.BorderOpacity")),borderWidth:l.get("Basics.BorderWidth"),colX:l.chartDataMapping[t].colX,colY:l.chartDataMapping[t].colY,data:e,dataKey:t,id:l.get("_Hidden._LayerId")+":"+t,index:l.get("_Hidden._Index"),label:l.isWild?t:l.get("Basics.Name"),layerId:l.get("_Hidden._LayerId"),type:l.getChartType(),xAxisID:l.get("Axes.XAxisID"),yAxisID:l.get("Axes.YAxisID")},c)}):_.map(this.chartData,function(e,a){var t=l.getRandomColour(d),i=(d+=1,"circle"),o=("Bubble"===u?(i=l.get("Bubbles.PointStyle")?l.get("Bubbles.PointStyle"):"circle",l.get("Bubbles.SetIconFromData")&&l.get("Bubbles.DataIcon")&&l.datasource?i=l.datasource.getData().map(function(e){return e.get(l.get("Bubbles.DataIcon"))}):l.get("Bubbles.Icons")&&(i=l.get("Bubbles.Icons"))):"Line"===u&&(i=l.get("Points.PointStyle")?l.get("Points.PointStyle"):"circle"),l.get("Basics.BackgroundColor")),r=l.get("Points.PointBackgroundColor")?l.get("Points.PointBackgroundColor"):o,n=l.get("Points.PointBorderColor")?l.get("Points.PointBorderColor"):r,o=l.computeHighlightRules(a,l.isWild?t:o,l.get("Basics.BackgroundOpacity"),"RuleColor"),s=b.alpha(l.isWild?t:l.get("Basics.BackgroundColor"),l.get("Basics.BackgroundOpacity"));return"Bar"===u&&l.patterns[a]&&(o=Array.isArray(o)?o.map(function(e,t){return y.Tools.drawPattern(l.patterns[a],e).pattern}):y.Tools.drawPattern(l.patterns[a],o).pattern,s=Array.isArray(s)?s.map(function(e,t){return y.Tools.drawPattern(l.patterns[a],e,void 0,12).pattern}):y.Tools.drawPattern(l.patterns[a],s,void 0,12).pattern),"Bubble"===u&&l.get("Bubbles.SetIconFromData")&&l.get("Bubbles.DataIconColor")&&(o=l.getDataIconColors(o)),_.merge({backgroundColor:o,borderColor:l.get("Line")?b.alpha(l.isWild?t:l.get("Basics.BorderColor"),"Waterfall"===u?0:l.get("Basics.BorderOpacity")):l.computeHighlightRules(a,l.isWild?t:l.get("Basics.BorderColor"),"Waterfall"===u?0:l.get("Basics.BorderOpacity"),"RuleBorderColor"),borderDash:l.getBorderDash(),borderWidth:l.get("Basics.BorderWidth"),colX:l.chartDataMapping[a].colX,colY:l.chartDataMapping[a].colY,data:e,dataKey:a,datalabels:l.getLabelSettings(),defaultBackgroundColor:s,defaultBorderColor:b.alpha(l.isWild?t:l.get("Basics.BorderColor"),l.get("Basics.BorderOpacity")),id:l.get("_Hidden._LayerId")+":"+a,index:l.get("_Hidden._Index"),label:l.isWild?a:l.get("Basics.Name"),layerId:l.get("_Hidden._LayerId"),pointBackgroundColor:l.computeHighlightRules(a,l.isWild?t:r,l.get("Points.PointBackgroundOpacity"),"RuleColor"),pointBorderColor:l.computeHighlightRules(a,l.isWild?t:n,l.get("Points.PointBorderOpacity"),"RuleBorderColor"),pointRadius:l.get("Points.PointRadius"),pointStyle:i,type:"Waterfall"===u?"bar":l.getChartType(),xAxisID:l.get("Axes.XAxisID"),yAxisID:l.get("Axes.YAxisID")},c)})},o.prototype.getChartType=function(){return this.get("Candlestick.OHLC")?"ohlc":this.get("_Hidden._Type").toLowerCase()},o.prototype.getBorderDash=function(){var e=this.get("Line.DashGap"),t=this.get("Line.DashWidth");return e&&t?[t,e]:[]},o.prototype.computeTypedProps=function(){switch(this.get("_Hidden._Type")){case"Bubble":return{fill:!0,hoverBackgroundColor:this.get("Bubbles.HoverBackgroundColor"),hoverBorderColor:this.get("Bubbles.HoverBorderColor"),hoverBorderWidth:this.get("Bubbles.HoverBorderWidth"),hoverRadius:this.get("Bubbles.HoverRadius")};case"Candlestick":return{borderColor:this.get("Candlestick.BorderColor"),color:{down:this.get("Candlestick.BearColor"),unchanged:this.get("Candlestick.NeutralColor"),up:this.get("Candlestick.BullColor")}};case"Line":var e=/^Layer (\d+)$/,t=this.get("Line.Fill"),e=(/^[+][0-9]+$/.test(t)?t=t.replace("+","-"):e.test(t)&&(e=null===(e=e.exec(t))?0:e[1],t=this.collection.length-Number(e)),this.get("Interpolation.Interpolation"));return{cubicInterpolationMode:"Monotone"===e?"monotone":"default",dashGap:this.get("Line.DashGap"),dashWidth:this.get("Line.DashWidth"),fadetoTransparent:this.get("Line.FadeToTransparent"),fill:t,lineTension:"Cubic"===e?this.get("Interpolation.LineTension")/20:"Linear"===e?0:1,pointBackgroundColor:b.alpha(this.get("Points.PointBackgroundColor"),this.get("Points.PointBackgroundOpacity")),pointBorderColor:b.alpha(this.get("Points.PointBorderColor"),this.get("Points.PointBorderOpacity")),pointBorderWidth:this.get("Points.PointBorderWidth"),pointHitRadius:this.get("Points.PointHitRadius"),pointHoverBackgroundColor:this.get("Points.PointHoverBackgroundColor"),pointHoverBorderColor:this.get("Points.PointHoverBorderColor"),pointHoverBorderWidth:this.get("Points.PointHoverBorderWidth"),pointHoverRadius:this.get("Points.PointHoverRadius"),pointRadius:this.get("Points.PointRadius"),pointStyle:this.get("Points.PointStyle"),showLine:this.get("Line.ShowLine"),spanGaps:this.get("Line.SpanGaps"),steppedLine:"Stepped"===e&&this.get("Interpolation.SteppedLine")};case"Bar":t=b.alpha(this.get("Bars.HoverBackgroundColor"),this.get("Bars.HoverBackgroundOpacity"));return{hoverBackgroundColor:t=!this.isWild&&this.patterns[""]?y.Tools.drawPattern(this.patterns[""],t).pattern:t,hoverBorderColor:b.alpha(this.get("Bars.HoverBorderColor"),this.get("Bars.HoverBorderOpacity")),hoverBorderWidth:this.get("Bars.HoverBorderWidth"),pointRadius:4,pointStyle:"rectRot"};case"Waterfall":return{pointRadius:4,pointStyle:"rectRot",increaseColor:"#7ad16f",decreaseColor:"#d1776f",waterfall:!0};case"Violin":case"BoxPlot":return}},o.commonVisualFields=["_Hidden._Index","Basics.Name","Basics.LegendLabelColor","Basics.BackgroundColor","Basics.BackgroundOpacity","Basics.BorderColor","Basics.BorderOpacity","Basics.BorderWidth","Axes.XAxisID","Axes.YAxisID","Labels"],o.dataFieldsMap={Bar:(o.commonDataFields=["_Hidden._Type","Basics.Data","Axes.XAxisData"]).concat(["Axes.YAxisData"]),BoxPlot:["Axes.Min","Axes.Max","Axes.Q1","Axes.Median","Axes.Q3","Axes.Outliers"],Bubble:o.commonDataFields.concat(["Axes.Radius","Axes.RadiusScaling","Axes.YAxisData"]),Candlestick:["Axes.Low","Axes.Close","Axes.High","Axes.Open"],Line:o.commonDataFields.concat(["Axes.YAxisData"]),Waterfall:o.commonDataFields.concat(["Axes.YAxisData"]),Violin:["Axes.Coords"]},o.visualFieldsMap={Bar:o.commonVisualFields.concat(["Bars"]),BoxPlot:o.commonVisualFields.concat(["BoxPlot"]),Bubble:o.commonVisualFields.concat(["Bubbles"]),Candlestick:o.commonVisualFields.concat(["Candlestick"]),Line:o.commonVisualFields.concat(["Line","Interpolation","Points"]),Waterfall:o.commonVisualFields.concat(["Waterfall"]),Violin:o.commonVisualFields.concat(["Violin"])},o.typedFieldsMap={Bar:["Bars"],BoxPlot:["Axes.Min","Axes.Max","Axes.Q1","Axes.Median","Axes.Q3","Axes.Outliers","BoxPlot"],Bubble:["Axes.Radius","Axes.RadiusScaling","Bubbles"],Candlestick:["Axes.Low","Axes.Close","Axes.High","Axes.Open","Candlestick"],Line:["_Hidden._PossibleLayers","Line","Interpolation","Points"],Waterfall:["Waterfall"],Violin:["Axes.Coords","Violin"]},o);function o(){var e=null!==V&&V.apply(this,arguments)||this;return e.columns=[],e.labels=[],e.chartDataMapping={},e.chartData={},e.previousChartData={},e.dataset=[],e.isWild=!1,e.palette=[],e.patterns={},e}Y=r.Collection,e(z,Y),z.prototype.modelId=function(e){return e._Hidden._LayerId+e._Hidden._Type},z.prototype.getUniqueLayerName=function(e){var t=[],a=/^[0-9]*$/;return this.map(function(e){return e.get("Basics.Name")}).forEach(function(e){e=e.substr(e.lastIndexOf(" ")+1);0<e.length&&a.test(e)&&t.push(parseInt(e,10))}),t.sort(function(e,t){return t-e}),t.length?e.substr(0,e.lastIndexOf(" ")+1)+(t[0]+1):e+" 1"};var Y,j=z;function z(){var e=null!==Y&&Y.apply(this,arguments)||this;return e.model=W,e}X=r.DeepModel,e(q,X),q.prototype.toChartJSON=function(){return{duration:this.get("Enabled")?this.get("Duration"):0,easing:_.isNil(this.get("Easing"))?"linear":this.get("Easing")}};var X,Z=q;function q(){return null!==X&&X.apply(this,arguments)||this}U=r.DeepModel,e(t,U),t.extractScales=function(h){var e=h.get("Range.SoftRange"),e="time"===h.get("_Hidden._Type")?{break:parseInt(h.get("Labels.TimeFormats.Break"),10),display:h.get("Display"),distribution:h.get("Labels.TimeFormats.Distribution"),gridLines:{color:b.alpha(h.get("GridLines.GridLinesColor"),h.get("GridLines.GridLinesOpacity")),drawBorder:!1,offsetGridLines:h.get("GridLines.OffsetGridLines"),zeroLineColor:b.alpha(h.get("GridLines.GridLinesColor"),h.get("GridLines.GridLinesOpacity"))},id:h.get("_Hidden._Label"),offset:h.get("Labels.Offset"),position:h.get("Position"),scaleLabel:{display:h.get("Title.Display"),fontColor:b.alpha(h.get("Title.FontColor"),h.get("Title.FontOpacity")),fontFamily:h.get("Title.FontFamily"),fontSize:h.get("Title.FontSize"),fontStyle:h.get("Title.FontStyle"),labelString:h.get("Title.LabelString")},stacked:h.get("Stacked"),ticks:{callback:function(e,t,a,i,o){return(0<=["1213","1214","1216","1217","1218","1219"].indexOf(o)?e.utc():e.utc().tz(O.timezone)).format(i)},display:h.get("Labels.Display"),fontColor:b.alpha(h.get("Labels.FontColor"),h.get("Labels.FontOpacity")),fontFamily:h.get("Labels.FontFamily"),fontSize:h.get("Labels.FontSize"),fontStyle:h.get("Labels.FontStyle"),major:{enabled:h.get("Labels.TimeFormats.ShowMajor")},max:h.get("Range.Max"),min:h.get("Range.Min"),maxRotation:_.isNil(h.get("Labels.MaxRotation"))?0:h.get("Labels.MaxRotation"),minRotation:_.isNil(h.get("Labels.MinRotation"))?0:h.get("Labels.MinRotation")},time:{displayFormats:{day:h.get("Labels.TimeFormats.Day"),hour:h.get("Labels.TimeFormats.Hour"),millisecond:h.get("Labels.TimeFormats.Millisecond"),minute:h.get("Labels.TimeFormats.Minute"),month:h.get("Labels.TimeFormats.Month"),quarter:h.get("Labels.TimeFormats.Quarter"),second:h.get("Labels.TimeFormats.Second"),week:h.get("Labels.TimeFormats.Week"),year:h.get("Labels.TimeFormats.Year")},isoWeekday:h.get("Labels.TimeFormats.IsoWeekday"),parser:function(e){var t;return g.isMoment(e)||g.isDuration(e)||(t=_.get(e,"_kdbType"))&&0<=["1216","1217","1218","1219"].indexOf(t)&&(e=g(_.get(e,"_milliseconds"))),e},round:h.get("Labels.TimeFormats.Round"),stepSize:h.get("Labels.StepSize"),tooltipFormat:h.get("Labels.TimeFormats.TooltipFormat"),unit:h.get("Labels.TimeFormats.Unit")},triggerBreak:parseInt(h.get("Labels.TimeFormats.TriggerBreak"),10),type:h.get("_Hidden._Type")}:"category"===h.get("_Hidden._Type")?{display:h.get("Display"),gridLines:{color:b.alpha(h.get("GridLines.GridLinesColor"),h.get("GridLines.GridLinesOpacity")),drawBorder:!1,offsetGridLines:h.get("GridLines.OffsetGridLines"),zeroLineColor:b.alpha(h.get("GridLines.GridLinesColor"),h.get("GridLines.GridLinesOpacity"))},id:h.get("_Hidden._Label"),offset:!0,position:h.get("Position"),scaleLabel:{display:h.get("Title.Display"),fontColor:b.alpha(h.get("Title.FontColor"),h.get("Title.FontOpacity")),fontFamily:h.get("Title.FontFamily"),fontSize:h.get("Title.FontSize"),fontStyle:h.get("Title.FontStyle"),labelString:h.get("Title.LabelString")},stacked:h.get("Stacked"),ticks:{autoSkip:0===h.get("Labels.StepSize"),autoSkipPadding:5,callback:function(e,t,a){var i,o=h.get("_Hidden._Label"),r=h.get("Labels.Format"),n=h.get("Labels.Precision"),s=h.get("Labels.HideTrailingZeroes"),l=h.get("Labels.DateFormat"),r=b.getFormatter(r,n,s,l),n=_.get(this,"chart"),d=_.get(this,"id"),s=_.get(this,"ctx"),l=_.find(n.config.data.datasets,function(e){return e.xAxisID===o}),c="",u=parseFloat(h.get("Labels.StepSize"));if("category"===h.get("_Hidden._Type")?l&&_.get(l,"data")&&(i=_.map(_.get(l,"data"),"x"),e=0<t&&i[t-1]===i[t]?"":i[t]):_.some(l,function(e){return e.xAxisID===d})&&(i=_.find(l,function(e){return e.xAxisID===d}))&&i.hasOwnProperty("data")&&i.data[t]&&i.data[t].x&&(e=i.data[t].x),isNaN(e)||(e=r(e)),"horizontalBar"===n.config.type&&0===u&&0<a.length&&(u=Math.max(1,Math.round(20/(s.canvas.clientHeight/a.length)))),""!==(c="horizontalBar"===n.config.type&&t%u!=0?c:h.get("Labels.Prefix")+e+h.get("Labels.Suffix")))return c},display:h.get("Labels.Display"),fontColor:b.alpha(h.get("Labels.FontColor"),h.get("Labels.FontOpacity")),fontFamily:h.get("Labels.FontFamily"),fontSize:h.get("Labels.FontSize"),fontStyle:h.get("Labels.FontStyle"),max:h.get("Range.Max"),maxRotation:_.isNil(h.get("Labels.MaxRotation"))?0:h.get("Labels.MaxRotation"),min:h.get("Range.Min"),minRotation:_.isNil(h.get("Labels.MinRotation"))?0:h.get("Labels.MinRotation"),reverse:h.get("Labels.Reverse"),stepSize:h.get("Labels.StepSize"),suggestedMax:e?h.get("Range.SuggestedMax"):void 0,suggestedMin:e?h.get("Range.SuggestedMin"):void 0},type:h.get("_Hidden._Type")}:{afterFit:function(e){h.get("Labels.MaxWidth")&&(e.width=h.get("Labels.MaxWidth"))},center:h.get("Center"),display:h.get("Display"),gridLines:{color:b.alpha(h.get("GridLines.GridLinesColor"),h.get("GridLines.GridLinesOpacity")),drawBorder:!1,offsetGridLines:h.get("GridLines.OffsetGridLines"),zeroLineColor:b.alpha(h.get("GridLines.GridLinesColor"),h.get("GridLines.GridLinesOpacity"))},id:h.get("_Hidden._Label"),offset:h.get("Labels.Offset"),position:h.get("Position"),scaleLabel:{display:h.get("Title.Display"),fontColor:b.alpha(h.get("Title.FontColor"),h.get("Title.FontOpacity")),fontFamily:h.get("Title.FontFamily"),fontSize:h.get("Title.FontSize"),fontStyle:h.get("Title.FontStyle"),labelString:h.get("Title.LabelString")},stacked:h.get("Stacked"),ticks:{beginAtZero:h.get("Labels.BeginAtZero"),callback:function(e){var t=b.getFormatter(h.get("Labels.Format"),h.get("Labels.Precision"),h.get("Labels.HideTrailingZeroes"),h.get("Labels.DateFormat"));if(!isNaN(e)){if(Math.floor(e)!==e&&0===h.get("Labels.Precision"))return"";e=t(e)}return h.get("Labels.Prefix")+e+h.get("Labels.Suffix")},display:h.get("Labels.Display"),fontColor:b.alpha(h.get("Labels.FontColor"),h.get("Labels.FontOpacity")),fontFamily:h.get("Labels.FontFamily"),fontSize:h.get("Labels.FontSize"),fontStyle:h.get("Labels.FontStyle"),max:h.get("Range.Max"),maxRotation:_.isNil(h.get("Labels.MaxRotation"))?0:h.get("Labels.MaxRotation"),min:h.get("Range.Min"),minRotation:_.isNil(h.get("Labels.MinRotation"))?0:h.get("Labels.MinRotation"),reverse:h.get("Labels.Reverse"),stepSize:h.get("Labels.StepSize"),suggestedMax:e?h.get("Range.SuggestedMax"):void 0,suggestedMin:e?h.get("Range.SuggestedMin"):void 0},type:h.get("_Hidden._Type")};return e},t.singular=function(e){return e.replace("e","i")},t.camelCase=function(e){return e.replace("X","x").replace("Y","y")},t.prototype.initialize=function(){this.listenTo(this,"change:Range.UseMinMax",function(e,t){e.get("Range.UseMinMaxReset")&&(t?e.get("Range.UseDataRange")||void 0===e.get("Range.UseDataRange")?e.trigger("cache",{model:e,load:["Range.UseDataRange"],defaults:[!0]}):(e.trigger("cache",{model:e,load:["Range.UseDataRange"],defaults:[!1]}),e.trigger("cache",{model:e,load:["Range.SoftRange"],defaults:[!1]}),e.trigger("cache",{model:e,load:["Range.UseDataRange"],defaults:[!1]})):(e.trigger("cache",{model:e,store:["Range.UseDataRange"],defaults:[!1]}),e.trigger("cache",{model:e,store:["Range.SoftRange"]})))}),this.listenTo(this,"change:Range.UseDataRange",function(e,t){t?(e.trigger("cache",{model:e,store:["Range.SoftRange"],defaults:[!1]}),e.trigger("cache",{model:e,store:["Range.SuggestedMax","Range.SuggestedMin"]}),e.trigger("cache",{model:e,store:["Range.Max","Range.Min"]})):(e.trigger("cache",{model:e,load:["Range.SoftRange"],defaults:[!1]}),e.trigger("cache",{model:e,store:["Range.SuggestedMax","Range.SuggestedMin"]}),e.trigger("cache",{model:e,load:["Range.Max","Range.Min"],defaults:[0,0]}))}),this.listenTo(this,"change:_Hidden._Type",function(e){e.get("Range.UseMinMax")||e.trigger("cache",{model:e,store:["Range.SuggestedMax","Range.SuggestedMin"]})}),this.listenTo(this,"change:Range.SoftRange",function(e,t){e.get("Range.UseMinMax")?t?(e.trigger("cache",{model:e,load:["Range.SuggestedMax","Range.SuggestedMin"],defaults:[0,0]}),e.trigger("cache",{model:e,store:["Range.Max","Range.Min"]})):(e.get("Range.UseDataRange")?e.trigger("cache",{model:e,store:["Range.Max","Range.Min"]}):e.trigger("cache",{model:e,load:["Range.Max","Range.Min"],defaults:[0,0]}),e.trigger("cache",{model:e,store:["Range.SuggestedMax","Range.SuggestedMin"]})):(e.trigger("cache",{model:e,store:["Range.Max","Range.Min"]}),e.trigger("cache",{model:e,store:["Range.SuggestedMax","Range.SuggestedMin"]}))}),this.listenTo(this,"change:Title.Display",function(e){e.get("Title.Display")?e.trigger("cache",{defaults:["","#FFFFFF",100,"'Helvetica Neue', 'Helvetica', 'Arial', 'sans-serif'",12,"normal"],load:["Title.LabelString","Title.FontColor","Title.FontOpacity","Title.FontFamily","Title.FontSize","Title.FontStyle"],model:e}):e.trigger("cache",{model:e,store:["Title.LabelString","Title.FontColor","Title.FontOpacity","Title.FontFamily","Title.FontSize","Title.FontStyle"]})}),this.listenTo(this,"change:Labels.Display",function(e){e.get("Labels.Display")?e.trigger("cache",{defaults:["#FFFFFF",100,"'Helvetica Neue', 'Helvetica', 'Arial', 'sans-serif'",12,"normal",!e.isNumerical()&&void 0,0,"",""],load:["Labels.FontColor","Labels.FontOpacity","Labels.FontFamily","Labels.FontSize","Labels.FontStyle","Labels.Reverse","Labels.StepSize","Labels.Prefix","Labels.Suffix"],model:e}):e.trigger("cache",{model:e,store:["Labels.FontColor","Labels.FontOpacity","Labels.FontFamily","Labels.FontSize","Labels.FontStyle","Labels.Reverse","Labels.StepSize","Labels.Prefix","Labels.Suffix"]})}),this.listenTo(this,"change:Labels.Reverse",function(e,t){_.isUndefined(t)||_.isNull(t)||e.set("Labels._ReverseCache",t)})},t.prototype.isNumerical=function(){return _.includes(["linear","logarithmic"],this.get("_Hidden._Type"))};var U,n=t;function t(){var e=null!==U&&U.apply(this,arguments)||this;return e.cache={},e}G=r.Collection,e($,G),$.prototype.modelId=function(e){return e._Hidden._AxisId+e._Hidden._Type};var G,K=$;function $(){var e=null!==G&&G.apply(this,arguments)||this;return e.model=n,e}s.sourceKey=function(e){return e.getPath()},s.mergeChanges=function(t,a,e,i,o,r){return e&&(t=_.fromPairs(_.map(e,function(e){return[a(e),e]}))),i&&_.each(i,function(e){return _.extend(t[a(e)],e)}),o&&_.each(o,function(e){t[a(e)]=e}),r&&_.each(r,function(e){delete t[a(e)]}),t},s.prototype.setFocus=function(e){this.focus=e,this.updateChildren(),this.childDataSource&&this.childDataSource.setFocus(e)},s.prototype.getApi=function(){return this.api},s.prototype.isFocused=function(){return this.focus.length===this.depth&&(0===this.depth||this.source.id===this.focus[this.depth])},s.prototype.getColumnNames=function(){if(this.breakdownColumns&&this.breakdownColumns.length)return[s.BREAKDOWN_ID,this.breakdownColumns[0]].concat(_.difference(_.keys(this.meta),this.breakdownColumns));try{return _.map(this.meta,function(e){return[e.id,e.index]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}catch(e){return _.keys(this.meta)}},s.prototype.getColumnType=function(e){return this.childDataSource?this.childDataSource.getColumnType(e):e===s.BREAKDOWN_ID&&this.primaryKey?this.meta[this.primaryKey].kdbType:this.meta[e]?this.meta[e].kdbType:11},s.prototype.getData=function(){return this.childDataSource?this.childDataSource.getData():this.source.dataSet&&this.source.dataSet.collection},s.prototype.getDepth=function(){return this.childDataSource?this.childDataSource.getDepth():this.depth},s.prototype.getKey=function(){return this.source.cid},s.prototype.getPrimaryKey=function(){return this.childDataSource?this.childDataSource.getPrimaryKey():this.primaryKey},s.prototype.getPropertyFromColumn=function(e){return e===s.BREAKDOWN_ID?this.getPrimaryKey():e},s.prototype.getPath=function(){return this.source.path},s.prototype.getSource=function(){return this.source},s.prototype.hasData=function(){return this.childDataSource?this.childDataSource.hasData():this.hasDataFlag},s.prototype.onData=function(e,t,a){e.primaryKey!==this.primaryKey&&(this.primaryKey=e.primaryKey);var i=e.columns,o=i.reset,r=i.change,n=i.add,i=i.remove;this.meta=s.mergeChanges(this.meta,function(e){return e.id},o,r,n,i),0!==this.depth||_.isEqual(e.breakdownColumns,this.breakdownColumns)||(this.breakdownColumns=e.breakdownColumns,this.removeChild()),t.reset&&0<t.reset.length&&this.removeChild(),a&&this.updateError(this,a),this.hasDataFlag=!0,this.updateChildren()&&this.listener.updateDataSource(this)},s.prototype.subscribe=function(){this.api.subscribe(this.source,this.onData.bind(this))},s.prototype.updateDataSource=function(){this.listener.updateDataSource(this)},s.prototype.updateError=function(e,t){this.listener.updateError(this,t)},s.prototype.unsubscribe=function(){this.childDataSource&&(this.childDataSource.unsubscribe(),delete this.childDataSource),this.api.unsubscribe(this.source)},s.prototype.removeChild=function(){this.childDataSource&&(this.childDataSource.unsubscribe(),delete this.childDataSource)},s.prototype.updateChildren=function(){var e;return!(this.breakdownColumns&&this.breakdownColumns.length&&this.depth<this.breakdownColumns.length-1&&(this.focus.length>this.depth?(this.childDataSource&&this.focus[this.depth]!==this.childDataSource.getSource().id&&this.removeChild(),!this.childDataSource&&(0!==this.depth&&(this.focus[this.depth-1],this.source.id),e=this.source.dataSet&&this.source.dataSet.collection.get(this.focus[this.depth]))&&(this.childDataSource=new s(e,this,this.api,this.focus,this.depth+1,this.breakdownColumns),this.childDataSource.subscribe())):(this.removeChild(),this.focus.length!==this.depth||!this.hasDataFlag||0!==this.depth&&this.focus[this.depth-1]!=this.source.id||this.listener.updateDataSource(this)),1))},s.BREAKDOWN_ID="{breakdownId}";var Q=s;function s(e,t,a,i,o,r){this.breakdownColumns=[],this.meta={},this.hasDataFlag=!1,this.focus=[],this.source=e,this.listener=t,this.api=a,this.depth=o||0,this.breakdownColumns=r||this.breakdownColumns,this.setFocus(i)}J=r.DeepModel,e(te,J),te.prototype.initialize=function(e){this.api=e.api;var o=this.api;this.highlightPlugin={afterDatasetsDraw:function(e){var n=e.chart.ctx,e=e.chartArea,s=n.canvas,l=e.left+5,d=s.clientHeight-15,i=[];_.each(o.getProperty("Layers"),function(e,a){_.each(e.HighlightRules,function(e,t){e.Show&&i.push(m({layer:o.getProperty("Layers."+a+".Basics.Name")},o.getProperty("Layers."+a+".HighlightRules."+t)))})}),_.each(i,function(e){if("gradient"===e.RuleType){for(var t=n.createLinearGradient(l,0,l+15,0),a=1/(e.Palette.length-1),i=0,o=0;i<e.Palette.length;i++)t.addColorStop(o,e.Palette[i].type),o+=a;n.fillStyle=t,n.strokeStyle=t}else n.fillStyle=e.RuleColor,n.strokeStyle=e.RuleBorderColor;n.lineWidth=2,n.fillRect(l,d-2,15,15),n.strokeRect(l,d-2,15,15);var r=_.isObject(e.RuleName)?e.RuleName.get("value"):e.RuleName;l=l+15+5,n.fillStyle="#A0A0A0",n.fillText(r,l,s.clientHeight-7),l=l+n.measureText(r).width+10})}}},te.prototype.showHeighlightRulesLegend=function(){var t=!1;return _.each(this.api.getProperty("Layers"),function(e){_.each(e.HighlightRules,function(e){e.Show&&(t=!0)})}),t};var J,ee=te;function te(){return null!==J&&J.apply(this,arguments)||this}ae=r.DeepModel,e(i,ae),i.prototype.computeLegendProp=function(){var r=this,i=this.legendState,e=this.get("LegendScroll"),t=this.get("Display"),a=this;return{align:this.get("Align")?this.get("Align"):"center",display:!(0<=["scroll","layer group","layer new line"].indexOf(e))&&t,fullWidth:!!this.get("FullWidth"),labels:{boxWidth:this.get("BoxWidth"),filter:function(t,e){var a=!0,e=_.filter(e.datasets,function(e){return e.label===t.text});return e&&_.each(e,function(e){e=_.get(e,"layerId");e&&void 0!==i[e]&&!1===i[e]&&(a=!1)}),a},fontColor:this.get("LabelColor"),fontFamily:"'Helvetica Neue', 'Helvetica', 'Arial', 'sans-serif'",fontSize:this.get("LabelFontSize"),generateLabels:function(e){var a,t,i,o=_.get(E,"defaults.global.legend.labels");return o?(o=o.generateLabels(e),a=e.config.data,_.each(o,function(e,t){a&&a.datasets&&a.datasets[t]&&(_.get(a.datasets[t],"defaultBackgroundColor")&&(e.fillStyle=_.get(a.datasets[t],"defaultBackgroundColor")),_.get(a.datasets[t],"defaultBorderColor"))&&(e.strokeStyle=_.get(a.datasets[t],"defaultBorderColor"))}),e=r.app.el.querySelector(".chart-container"),r.app.api.hasPermission(y.CustomAPIPermission.canExportData)&&(r.app.api.getProperty("FileExport.ShowExportCsvButton")||r.app.api.getProperty("FileExport.ShowExportExcelButton")||r.app.api.getProperty("FileExport.ShowScreenshot"))?(r.fileExportHeight=20,i=document.createElement("div"),document.body.appendChild(i),i.style.fontSize="12px",i.style.position="absolute",i.textContent=_.flatMap(o,"text").toString(),t=i.clientWidth,document.body.removeChild(i),i.remove(),i=240+32*o.length,(r.app.el.clientWidth||0)-(t||0)-i<0&&e?e.classList.add("overflow"):e&&e.classList.remove("overflow")):e&&(r.fileExportHeight=0,e.classList.remove("overflow")),o):[]},padding:this.get("Padding"),usePointStyle:this.get("UsePointStyle")},onClick:function(e,t){_.get(a.app,"legendModel")&&_.get(a.app,"legendModel").clickCount++,a.debounceClickEvents(t)},position:this.get("Position")?this.get("Position").replace("-inline",""):"top",reverse:!this.get("Reverse")}},i.prototype.setLegendStateProps=function(e){this.legendStateProps=e},i.prototype.renderhtmlLegend=function(o){var e=this.get("LegendScroll"),t=this.get("Display");0<=["scroll","layer group","layer new line"].indexOf(e)&&t?(this.externalDiv.innerHTML=this.computeLegendHTML(o.legend.legendItems,o),e=this.externalDiv.querySelectorAll(".legendItem"),_.each(e,function(a,i){a.addEventListener("click",function(e){var t;a&&(a.classList.toggle("strike"),t=a.classList.contains("strike"),i=o.legend.legendItems[i].datasetIndex,o.getDatasetMeta(i).hidden=t,o.update())})}),this.computehtmlLegendStyle()):this.externalDiv.innerHTML=""},i.prototype.computeLayoutProp=function(e){return this.bottomAdjust=e?20:0,this.computehtmlLegendStyle(),{padding:{bottom:this.bottom,left:this.left,right:this.right,top:this.top}}},i.prototype.toLegendJSON=function(){var e=_.extend(this.toJSON(),{});return e.externalDiv&&delete e.externalDiv,e.toolsEnabled&&delete e.toolsEnabled,e},i.prototype.restoreLayerState=function(e){e.data.datasets&&(e=e.data.datasets,this.restoreLayerStateOnDatasets(e))},i.prototype.restoreLayerStateOnDatasets=function(e){var i=this;_.forEach(e,function(e){var t,a=_.get(e,"layerId");a&&(t=_.get(e,"label"),e.hidden=t&&_.isBoolean(i.legendStateProps[t])?i.legendStateProps[t]:!i.layerState[a])})},i.prototype.updateLayerStatefromOnSettingsChanged=function(e){var t=this;this.layerState||(this.layerState={}),this.legendState||(this.legendState={}),_.forEach(e,function(e){t.layerState[e._Hidden._LayerId]=e.Basics.Enabled,t.legendState[e._Hidden._LayerId]=e.Basics.LegendEnabled})},i.prototype.updateLayerStatefromLegendClick=function(e,t){var a,i,t=_.get(t,"datasetIndex");_.get(e,"data.datasets")&&!_.isNil(t)&&(a=_.get(e,"data.datasets"),i=a[t].layerId,1<_.filter(a,function(e){return e.layerId===i}).length?(this.hasWarnedAboutWildCards||(this.hasWarnedAboutWildCards=!0),a[t].hidden=!a[t].hidden,e.update()):(this.layerState[i]=!e.getDatasetMeta(t).hidden,this.set("layerState",this.layerState)))},i.prototype.updateLayerStatefromLegendDblClick=function(e,t){t=_.get(t,"datasetIndex");if(_.get(e,"data.datasets")&&!_.isNil(t)){var a=_.get(e,"data.datasets"),i=a[t].layerId;if(1<_.filter(a,function(e){return e.layerId===i}).length)this.hasWarnedAboutWildCards||(this.hasWarnedAboutWildCards=!0),e.update();else{for(var o=0;o<a.length;o++){var r=a[o].layerId;this.layerState[r]=!e.getDatasetMeta(o).hidden}this.set("layerState",this.layerState)}}},i.prototype.clickEvents=function(e){1<this.clickCount?this.executeOnDoubleClick(e):this.executeonClick(e),this.clickCount=0},i.prototype.executeonClick=function(e){var t,a,i;_.get(this,"chart.legend.clickTime")||(t=e.datasetIndex,(i=(a=this.app.chart).getDatasetMeta(t)).hidden=!(!_.isNil(i.hidden)&&!1!==i.hidden||a.data.datasets[t].hidden),this.dcHidden=!0,a.config.legendModel.updateLayerStatefromLegendClick(a,e))},i.prototype.executeOnDoubleClick=function(e){var t=_.get(e,"datasetIndex"),a=this.app.chart;if(!_.isNil(t)){for(var i=0;i<a.data.datasets.length;i++){var o=a.getDatasetMeta(i),r=_.get(o,"controller._config.layerId");r&&this.legendState[r]?o.hidden=i!==t&&this.dcHidden:o.hidden=!0}a.config.legendModel.updateLayerStatefromLegendDblClick(a,e),this.dcHidden=!this.dcHidden}},i.prototype.resetLayout=function(){this.top=0,this.bottom=this.bottomAdjust||0,this.left=0,this.right=0},i.prototype.computehtmlLegendStyle=function(){var e=this.toolsEnabled?i.TOOLS_HEIGHT:0,t=this.get("Position");0<=["scroll","layer group","layer new line"].indexOf(this.get("LegendScroll"))?("bottom"===t?(this.externalDiv.style.bottom=this.bottomAdjust||0,this.externalDiv.style.height=this.bottom+"px",this.externalDiv.style.left="",this.externalDiv.style.right="",this.externalDiv.style.top="",this.externalDiv.style.width="auto"):"top"===t||"top-inline"===t?(this.externalDiv.style.bottom="",this.externalDiv.style.height=this.top+"px",this.externalDiv.style.left="",this.externalDiv.style.right="",this.externalDiv.style.top=0,this.externalDiv.style.width="auto"):"left"===t?(this.externalDiv.style.bottom="",this.externalDiv.style.height="auto",this.externalDiv.style.left=0,this.externalDiv.style.right="",this.externalDiv.style.top=e+"px",this.externalDiv.style.width=this.left+"px"):"right"===t&&(this.externalDiv.style.bottom="",this.externalDiv.style.height="auto",this.externalDiv.style.left="",this.externalDiv.style.right=0,this.externalDiv.style.top=e+"px",this.externalDiv.style.width=this.right+"px"),this.externalDiv.style.color=this.get("LabelColor"),this.externalDiv.style["font-family"]="'Helvetica Neue', 'Helvetica', 'Arial', 'sans-serif'",this.externalDiv.style["font-size"]=this.get("LabelFontSize")):(this.resetLayout(),this.externalDiv.style.bottom=this.bottomAdjust,this.externalDiv.style.left="",this.externalDiv.style.right="",this.externalDiv.style.top="")},i.prototype.getTextWidth=function(e){var t=document.createElement("canvas").getContext("2d"),a=parseFloat(this.get("LabelFontSize"))||0;return t?(t.font=a+"px Helvetica Neue, Helvetica, Arial, sans-serif",t.measureText(e).width):0},i.prototype.getPointStyle=function(e,t,a){var i=this.get("Padding"),o=this.get("LabelColor"),r=this.get("LabelFontSize"),n=this.get("BoxWidth"),s=this.get("UsePointStyle"),l=this.get("Position"),l="left"===l||"right"===l,d={circle:"circle",fillStyle:e.fillStyle,fontSize:r,labelColor:o,layerName:t,margin:i,radius:n/2-1,cntr:n/2,strokeStyle:e.strokeStyle,text:e.text,width:n,lblWidth:a,class:l?"":"horizontalLegend"},r={fillStyle:e.fillStyle,fontSize:r,labelColor:o,layerName:t,margin:i,rect:"rect",strokeStyle:e.strokeStyle,text:e.text,width:n,lblWidth:a,class:l?"":"horizontalLegend"};return s?d:r},i.prototype.isWildLayer=function(e,t,a,i){t=i+1<t.length?t[i+1]:null,i=t?e.data.datasets[t.datasetIndex]:null;return i&&_.get(i,"layerId")===a},i.prototype.getMaxWidth=function(e){var t=this,a=0;return _.each(e,function(e){e=t.getTextWidth(e.text);a<e&&(a=e)}),a},i.prototype.maxLegendWidth=function(e){var e=this.getMaxWidth(e),t=parseFloat(this.get("Padding"))||0;return e+((parseFloat(this.get("BoxWidth"))||0)+2*t+6)},i.prototype.computeLegendHTML=function(s,l){var d,c=this,e=this.get("Position"),t=this.get("LegendScroll"),a=this.get("LabelFontSize"),u="layer new line"===t,h=u?this.get("LegendLayerThreshold"):100,p="left"===e||"right"===e,g="scroll"===t,m=Math.floor(this.externalDiv.clientHeight/(a+6)),f=this.app.el.clientWidth||100,y=u||g?1:Math.ceil(s.length/m),b="",x=0,v=0,S=0,C=p?i.VERTHTML:i.HORZHTML,L=!1,D=!1,T=[],k=this.getMaxWidth(s),M=this.maxLegendWidth(s);return _.each(s,function(e,t){var a="</div><div class=column-0>",i=l.data.datasets[e.datasetIndex],e=(d=i.layerId,c.getPointStyle(e,d,k)),o=d!==b,r=h<=S,n=c.isWildLayer(l,s,d,t),i=i.hidden,i=(e.class=i?e.class+" strike":e.class+"",D=!1,L&&!n||(n||r)&&o);n?(T.push(t),r=Math.floor((f-10)/M),!p&&1<T.length&&T.length%r==0&&(v+=14)):T=[],0<x&&i&&!g&&(r=p?"legendLineBreak":"legendSpanbreak",i=s.length-1,u&&(r="legendNewLine",v+=14,y=i!==t&&p?y+1:y,S=0),L&&!n&&(D=!0,x=0,C+=ce.htmlLegend(e)),s.length-1===t&&(a=""),C=p?C+a:C+"<div class='"+r+"'></div>"),u&&(S=o?S+1:0),b=d,L=n,D||(C+=ce.htmlLegend(e)),x++,p&&0<x&&x%m==0&&!g&&(C+=a,x=0)}),this.resetLayout(),"default"!==t&&(a=20*Math.ceil(s.length/(f/M)),this.updateChartPadding(M*y,e,a,v)),this.updateLayouts(l),C+="</div></div>"},i.prototype.updateChartPadding=function(e,t,a,i){"right"===t?(this.right=e,this.top=20,this.bottom=this.bottomAdjust):"left"===t?(this.left=e,this.top=20,this.bottom=this.bottomAdjust):"bottom"===t?this.bottom=i||a:(this.bottom=this.bottomAdjust,this.top=i||a,_.isNil(_.get(this.app.el.getElementsByClassName("tools-panel"),"0.style.top"))||(this.app.el.getElementsByClassName("tools-panel")[0].style.top=this.top+"px"))},i.prototype.updateLayouts=function(e){e.options.layout.padding.left=this.left,e.options.layout.padding.right=this.right,e.options.layout.padding.top=this.top,e.options.layout.padding.bottom=this.bottom,_.isNil(_.get(this.app.el.getElementsByClassName("chart-container"),"0.style.height"))||(this.app.el.getElementsByClassName("chart-container")[0].style.height="calc(100% - "+(this.top+this.fileExportHeight)+"px)"),e.update()},i.TOOLS_HEIGHT=20,i.VERTHTML="<div class='legend-5' style='display:flex;'><div class='column-0'>",i.HORZHTML="<div class='legend-5'><div class='column-1'>";var ae,ie=i;function i(e){var t=ae.call(this)||this;return t.hasWarnedAboutWildCards=!1,t.dcHidden=!0,t.right=0,t.left=0,t.top=0,t.bottom=0,t.bottomAdjust=0,t.legendStateProps={},t.clickCount=0,t.fileExportHeight=20,t.externalDiv=e.externalDiv,t.toolsEnabled=!1,t.app=e.app,t.debounceClickEvents=_.debounce(t.clickEvents.bind(t),300),t}"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e){if(null===e)throw new TypeError("Cannot convert undefined or null to object");var a=Object(e);return _.each(arguments,function(e){if(null!==e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(a[t]=e[t])}),a},writable:!0,configurable:!0});l.cache=function(l,d,c,u){var e;_.isArray(c.load)&&(e=c.load.reduce(function(e,t,a){var i,o,r,n,s,a=c.defaults&&c.defaults[a];return l.cache?((o=l.cache[t])&&o.get&&o.get("_viewType")&&(o=(i=o).get("value"),r=(n=(d+t).split(".")).pop(),n=n.join("."),s={},r)&&(s[r]=i,u.setProperty(n,s,{bypass:!0})),e[t]=o||a):void 0===e[t]&&(e[t]=a),e},{}),l.set(e)),_.isArray(c.store)&&(e=c.store.reduce(function(e,t){var a=(d+t).split("."),i=a.pop();return i&&(e[t]=u.getProperty(a.join("."))[i]),e},{}),void 0===l.cache&&(l.cache={}),_.extend(l.cache,e),e=c.store.reduce(function(e,t){return e[t]=void 0,e},{}),l.set(e))},l.compareKDBTimes=function(e,t){return e.i>t.i?1:e.i<t.i?-1:e.n>t.n?1:e.n<t.n?-1:0},l.convertPropertyIfMoment=function(e){e=O.convertISODatetimeToKDBLikeObject(e);return O.isKDBTemporal(e)?O.convertKDBTemporalToMoment(e):e},l.expandNestedViewStates=function(e,t){var a,i=/([a-zA-Z]+)\.[0-9]+\./,o=Object.keys(e),r=[];return(r=_.every(o,function(){var e=t.getPropertyMeta(o[0]);return e&&"viewstate"===e.type})?_.uniq(_.filter(_.map(o,function(e){e=i.exec(e);return e?e[1]:null}))):r).length?(a={},_.each(r,function(e){return a[e]=t.getProperty(e)}),a):e},l.focus2Array=function(e){var t=[],a=/"([^"]*)"/g,e=e.toString?e.toString():"",i=/^\[([^\]]*)]$/.exec(e);if(null!==i){if(/^(?:"[^"\\]*(?:\\[\S\s][^"\\]*)*")(?:,"[^"\\]*(?:\\[\S\s][^"\\]*)*")*/.test(i[1]))for(var o=void 0;null!==(o=a.exec(i[1]));)t.push(_.map(o[1].split(","),function(e){return e.replace(/&#44;/g,",")}))}else t.push(e.split(","));return _.filter(t,function(e){return 0<(""+e).length})},l.hex2RGB=function(e){e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return e?[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]:[255,255,255]},l.RGB2hex=function(e){return"#"+((1<<24)+(e[0]<<16)+(e[1]<<8)+e[2]).toString(16).slice(1)},l.clamp=function(e,t,a){return a<e?a:e<t?t:e},l.interpolateColor=function(e,t,a,i){for(var a=(a-t)/(e.length-1),i=this.clamp((i-t)/a,0,e.length-1),i=_.isNaN(i)?0:i,t=e[Math.floor(i)].type,a=e[Math.ceil(i)].type,o=this.hex2RGB(t),r=this.hex2RGB(a),n=i-Math.floor(i),s=o.slice(),l=0;l<3;l++)s[l]=Math.round(s[l]+n*(r[l]-o[l]));return this.RGB2hex(s)},l.getConditionResult=function(e,t,a){var i,o,r={isMatch:function(e,t){var a,i=!1,o=e.split(/ +and +| +/);for(_.includes(o,"or")&&(o=_.without(o,"or"),i=!0),a=0;a<o.length;a++)0!==o[a].indexOf("-")&&o[a].indexOf("*")<0&&(o[a]="*"+o[a]+"*");return _[i?"some":"every"](o,function(e){return r.isSimpleMatch(e,t)})},isSimpleMatch:function(e,t){var a=!1,e=(0===e.indexOf("-")&&(e=e.replace("-",""),a=!0),new RegExp("^"+e.replace(/\*/g,".*")+"$").test(t));return a?!e:e}},n=!1,s=isNaN(parseFloat(e))||_.isObject(e)?(""+e).toLowerCase():parseFloat(e),l=isNaN(parseFloat(t))||_.isObject(t)?(""+t).toLowerCase():parseFloat(t);switch(e&&e.class&&0<=["1212","1213","1214","1215"].indexOf(e.class)?(s=O.convertKDBTemporalToMoment(e).unix(),"in"===a?(i=[],_.each(t.toString().split(","),function(e){i.push(O.convertDateStringValueToMoment(e).unix()),l=i.toString()})):l=O.convertDateStringValueToMoment(t).unix()):e&&e.class&&0<=["1216","1217","1218","1219"].indexOf(e.class)&&(s=O.convertKDBTemporalToMoment(e).valueOfNano(),"in"===a?(o=[],_.each(t.toString().split(","),function(e){o.push(O.convertDateStringValueToMoment(e).valueOfNano()),l=o.toString()})):l=O.convertDateStringValueToMoment(t).valueOfNano()),a){case"contains":n=0<=s.toString().indexOf(l.toString());break;case"starts with":n=0===s.toString().indexOf(l.toString());break;case"ends with":n=-1!==s.toString().indexOf(l.toString(),s.toString().length-l.toString().length);break;case"==":n=s===l;break;case"<":n=s<l;break;case">":n=l<s;break;case"<=":n=s<=l;break;case">=":n=l<=s;break;case"!=":n=s!==l;break;case"in":n=0<=l.toString().split(",").indexOf(s.toString());break;case"search":n=r.isMatch(l,s);break;case"regexp":n=new RegExp(t.toString()).test(e?e.toString():"")}return n},l.isDuration=function(e){return _.get(e,"_kdbType")&&0<=["1216","1217","1218","1219"].indexOf(e._kdbType)},l.getFormatter=function(i,o,r,n){return"Number"===i||"Formatted Number"===i||"Smart Number"===i||"Datetime"===i||"Currency"===i||"SmartCurrency"===i?function(e){var t,a=e;if(null==(e="Smart Number"!==i&&"Formatted Number"!==i||_.isNumber(e)?e:_.isNumber(parseFloat(e))?parseFloat(e):e))return"";if("Smart Number"===i)a=_.isNumber(e)?O.smartFormatNumber(e,o):_.escape(e);else{if("Datetime"===i)return t=e,(g.isMoment(e)||g.isDuration(e)?l.isDuration(e)?O.convertValueToMoment(e.valueOf()):e:O.isKDBTemporal(e)?O.convertKDBTemporalToMoment(e):("number"==typeof e&&(t=new Date(e)),O.convertDateStringValueToMoment(t.toString()))).format(n);a="Formatted Number"===i&&e.toFixed?_.isNaN(e)?"":O.formatNumber(e,o):e.toFixed?e.toFixed(o):_.escape(a)}if(r&&0<=a.toString().indexOf(".")){for(;"0"===a[a.length-1];)a=a.slice(0,-1);"."===a[a.length-1]&&(a=a.slice(0,-1))}return a}:"Boolean"===i?function(e){return _.escape(e)}:function(e){return g.isMoment(e)||g.isDuration(e)?e.format(n,void 0):_.escape(e)}},l.pump=function(a){var e,i,o;return null==a||!_.isObject(a)||(e=Object.getPrototypeOf(a),_.isObject(a)&&e!==Object.prototype&&e!==Array.prototype)?a:e===Array.prototype&&_.isArray(a)?a.map(l.pump):(i=/^(\d+)((?:\.\w+)+)$/,Object.keys(a).every(function(e){return i.test(e)})?Object.keys(a).map(function(e){var t=i.exec(e);return _.isNil(t)?{index:0,tail:void 0,value:void 0}:{index:Number(t[1]),tail:t[2].substring(1),value:a[e]}}).reduce(function(e,t){var a={},i=void 0===t.index?0:t.index;return a[i]={},a[i][t.tail]=t.value,_.merge(e,l.pump(a))},[]):(o={greedy:/^(\w+)((?:\.\w+)*)$/,nonGreedy:/^(\w+)((?:\.\w+)+)$/},Object.keys(a).some(function(e){return o.nonGreedy.test(e)})?Object.keys(a).map(function(e){var t=o.greedy.exec(e);return{head:_.isNil(t)?null:t[1],tail:_.isNil(t)||""===t[2]?null:t[2].substring(1),value:a[e]}}).reduce(function(e,t){var a={},i=null!==t.tail,o=_.isNil(t.head)?0:t.head,r=_.isNil(t.tail)?0:t.tail;return i?(a[o]={},a[o][r]=t.value):a[o]=t.value,_.merge(e,l.pump(a))},{}):_.mapValues(a,l.pump)))},l.replaceViewStatesWithValue=function(e,t,a){return l.replaceViewStates(e,t,function(e,t,a,i){return i.value!==a&&console.warn("viewModel value has changed"),i.value},a)},l.replaceViewStatesWithModel=function(e,t,i){return l.replaceViewStates(e,t,function(e,t,a){return a instanceof r.Model&&a.get("_viewType")?a:((e=i.getProperty(e)[t]).get("value")!==a&&e.set("value",a),e)},i)},l.alpha=function(e,t){var a=this.hex2RGB(e);return a?"rgba(".concat(a[0],",").concat(a[1],",").concat(a[2],",").concat(t/100,")"):new Color(e).alpha(t/100).rgbaString()},l.colorFactory=function(e,t,a){void 0===t&&(t="#0061FF"),void 0===a&&(a=80);var i={};return i[e+"Color"]={title:e.replace("Point","").replace("Hover","Hover ").replace("Border","Border ").replace("Background","Background ")+"Color",type:"gradient",default:t,options:{gradient:!1}},i[e+"Opacity"]={title:e.replace("Point","").replace("Hover","Hover ").replace("Border","Border ").replace("Background","Background ")+"Opacity",default:a,minimum:0,maximum:100,type:"number",step:1,format:"range"},i},l.backgroundFactory=function(e){return l.colorFactory(e+"Background")},l.borderFactory=function(e){var t={};return t[e+"BorderWidth"]={title:e.replace("Point","").replace("Hover","Hover ")+" Border Width",type:"number",format:"range",default:2.01,minimum:.01,maximum:10.01},_.merge(l.colorFactory(e+"Border"),t)},l.radiusFactory=function(e){var t={};return t[e+"Radius"]={title:e.replace("Point","").replace("Hover","Hover ").replace("Hit","Hit ")+"Radius",type:"number",format:"range",default:0,minimum:0,maximum:10},t},l.typeFactory=function(e){return{_Type:{type:"string",default:e,options:{hidden:!0}}}},l.replaceViewStates=function(a,e,l,d){var c;return c=function(e,t){return function a(e,t,i){i=i?i+".":"";var o,r,n=d.getPropertyMeta(i+(t+="")),s=e&&e.has&&e.has("_dataSource")&&e.has("_dataType"),s=(_.isArray(e)||_.isObject(e))&&!s;return n&&"data"===n.type?e:n&&"viewstate"===n.type?(o=(r=(i+t).split(".")).pop(),r=r.join("."),l(r,void 0===o?"":o,e,n)):s?(i+=t,c=function(e,t){return a(e,t,i)},(_.isArray(e)?_.map:_.mapValues)(e,c)):e}(e,t,a||"")},(_.isArray(e)?_.map:_.mapValues)(e,c)},l.HEX_CODES={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};var b=l;function l(){}f.registerHelper("ico",function(e){return new f.SafeString('<i class="fa '+e.hash.icon+'" style="color:'+e.hash.color+';"></i>')}),f.registerHelper("groupByLayer",function(e){var i=[],t=_.groupBy(this.points,function(e){return e.layerName}),o=_.groupBy(this.legendItems,function(e){return e.text});return _.forEach(t,function(e,t){var a=e.map(function(e){var t=o[e.layerName],t=t&&t[0]&&t[0].pointStyle?t[0].pointStyle:"circle";return{borderColor:e.colors.borderColor,cols:e.cols,color:e.colors.backgroundColor,data:e.layerData,dataFormatted:e.layerDataFormatted,isLayerEnabled:e.isLayerEnabled,shape:t}});i.push({colors:e[0].colors,isLayerEnabled:e[0].isLayerEnabled,layerCount:_.sumBy(a,function(e){return _.isNil(e.data)||""===e.data?0:1}),layerUniqData:_.uniq(_.compact(_.map(a,function(e){return e.data}))).join(),layerName:t,layerPoints:a,svg:e[0].svg})}),new f.SafeString(e.fn({layers:i}))}),f.registerHelper("groupByLayerX",function(r,e){var t=[],a=_.uniq(_.flatMap(this.points,function(e){return e.cols[r].toString()})),n=_.groupBy(this.points,function(e){return e.layerName}),s=_.groupBy(this.legendItems,function(e){return e.text});return _.forEach(a,function(i){var o=[];_.forEach(n,function(e,t){var a=_.filter(e,function(e){return e.cols[r].toString()===i.toString()}).map(function(e){var t=s[e.layerName],t=t&&t[0]&&t[0].pointStyle?t[0].pointStyle:"circle";return{data:e.layerData,dataFormatted:e.layerDataFormatted,cols:e.cols,color:e.colors.backgroundColor,borderColor:e.colors.borderColor,shape:t}});o.push({colors:e[0].colors,grouping:i,layerName:t,layerPoints:a,legends:s,isLayerEnabled:e[0].isLayerEnabled})}),t.push({grouping:i,data:o})}),new f.SafeString(e.fn({layers:t}))}),f.registerHelper("filterLayers",function(e){var t=e.hash.names.split(","),a=_.filter(this.points,function(e){return _.includes(t,e.layerName)});return new f.SafeString(e.fn({points:a}))});oe=r.DeepModel,e(a,oe),a.prototype.beforeInit=function(e){var t=this;this.chartInstance=e,this.node=e.canvas,this.node.addEventListener("touchenter",function(e){t.pendingEvent=e,window.requestAnimationFrame(t.nextFrame.bind(t))}),this.node.addEventListener("mousedown",this.mouseDown.bind(this)),this.node.addEventListener("mouseup",this.mouseUp.bind(this)),this.node.addEventListener("mousemove",function(e){t.pendingEvent=e,window.requestAnimationFrame(t.nextFrame.bind(t))}),this.node.addEventListener("mouseout",this.mouseOut.bind(this)),this.node.addEventListener("dblclick",this.dblClick.bind(this))},a.prototype.afterRender=function(){this.triggerSort&&(this.sortDataset(),this.triggerSort=!1)},a.prototype.afterUpdate=function(){this.triggerSort=!0},a.prototype.destroy=function(){this.node&&(this.node.removeEventListener("touchenter",this.mouseMove.bind(this)),this.node.removeEventListener("mousedown",this.mouseDown.bind(this)),this.node.removeEventListener("mouseup",this.mouseUp.bind(this)),this.node.removeEventListener("mousemove",this.mouseMove.bind(this)),this.node.removeEventListener("mouseout",this.mouseOut.bind(this)),this.node.removeEventListener("dblclick",this.dblClick.bind(this)),delete this.chartInstance,delete this.node)},a.prototype.setLayers=function(e){this.layers=e},a.prototype.onSettingsChange=function(e){this.crosshairArea&&this.selectedCrosshairArea&&(e.hasOwnProperty("CrosshairsEnabled")&&!e.CrosshairsEnabled&&(this.hideHover(),this.hideSelected()),e.hasOwnProperty("CrosshairsColor")&&this.setColor(),e.hasOwnProperty("TooltipBGOpacity")&&this.tooltip&&this.tooltip.updateCSS({"background-color":"rgba(0, 0, 0,"+this.get("TooltipBGOpacity")/100+")"}),this.setColor(),e.hasOwnProperty("TooltipFontSize"))&&this.tooltip&&this.tooltip.updateCSS({"font-size":this.get("TooltipFontSize")})},a.prototype.updateSelectedFromViewState=function(e){this.sortedData&&this.sortedData.length&&((e=this.findClosestElementFromValue(e.Selected))&&this.get("CrosshairsEnabled")?this.isTransposed?(this.selectedY=e.yLabel,this.drawCrosshair(this.selectedCrosshairArea,e.yPixel)):(this.selectedX=e.xLabel,this.drawCrosshair(this.selectedCrosshairArea,e.xPixel)):this.hideSelected())},a.prototype.updateHoverFromViewState=function(e){var t,a;e.Hover?this.sortedData&&this.sortedData.length&&!this.preventViewStateUpdate?(e=this.findClosestElementFromValue(e.Hover),t=this.isTransposed?"yPixel":"xPixel",e?(this.get("CrosshairsEnabled")&&this.drawCrosshair(this.crosshairArea,_.get(e,t)),this.get("TooltipsEnabled")&&(a={offsetY:(this.chartInstance.chartArea.top+this.chartInstance.chartArea.bottom)/2},this.renderTooltip(_.get(e,t),a,e))):this.hideHover()):this.preventViewStateUpdate=!1:(this.hideTooltip(),this.hideHover())},a.prototype.removePreviousChartInstance=function(){this.chartInstance&&delete this.chartInstance},a.prototype.nextFrame=function(){this.pendingEvent&&(this.mouseMove(this.pendingEvent),delete this.pendingEvent)},a.prototype.mouseDown=function(e){this.startDrag=e.offsetX},a.prototype.mouseMove=function(e){this.validateMouseEvent(e)?this.updateHover(e):(this.hideHover(),this.updateViewState("Basics.Hover",""),this.hideTooltip())},a.prototype.mouseUp=function(e){Math.abs(e.offsetX-this.startDrag)<2&&this.validateMouseEvent(e)&&this.updateSelected(e)},a.prototype.mouseOut=function(){this.hideHover(),this.updateViewState("Basics.Hover",""),this.hideTooltip()},a.prototype.dblClick=function(e){this.validateMouseEvent(e)&&this.clearSelected()},a.prototype.clearSelected=function(){this.selectedX=null,this.selectedY=null,this.hideSelected()},a.prototype.compare=function(e,t){if(!e.kdbType){if("number"==typeof e||"number"==typeof t)try{return parseFloat(e)-parseFloat(t)}catch(e){}return"string"==typeof e&&e===t?0:"number"==typeof e?e-parseFloat(t):g.isMoment(O.convertKDBTemporalToMoment(e))?this.getMomentDiff(O.convertKDBTemporalToMoment(e),t):"object"==typeof e?g(e.toString()).diff(t):void 0}switch(e.kdbType()){case"1217":case"1219":return e.asMilliseconds()-g(t).valueOf();case"1212":case"1213":case"1214":return this.getMomentDiff(O.convertKDBTemporalToMoment(e),O.convertKDBTemporalToMoment(t));case"1215":case"1216":case"1218":return this.getMomentDiff(O.convertKDBTemporalToMoment(e),t)}},a.prototype.getMomentDiff=function(e,t){return g.isDuration(e)&&g.isDuration(t)?e.subtract(t).asMilliseconds():g.isMoment(e)&&g.isMoment(t)?e.diff(t):0},a.prototype.drawCrosshair=function(e,t){var a=this.chartInstance.chartArea,i=a.left,o=a.right,r=a.bottom,a=a.top;this.isTransposed&&a<t&&t<r||!this.isTransposed&&i<t&&t<o?(e&&e.classList.add("active"),this.isTransposed?(e.style.height="1px",e.style.left=i+"px",e.style.top=t+"px",e.style.width=o-i+"px"):(e.style.height=r-a+"px",e.style.left=t+"px",e.style.top=a+"px",e.style.width="1px")):e&&e.classList.remove("active")},a.prototype.findClosestElementFromEvent=function(e){if(_.get(this.chartInstance,"data.datasets")){var t=_.map(this.chartInstance._getSortedDatasetMetas(!0),function(e){return e.index}),a=_.filter(this.sortedData,function(e){return 0<=_.indexOf(t,e.datasetIndex)});if(a&&0!==a.length){for(var i=0,o=a.length-1,r=this.isTransposed?this.getOffsetY(e):this.getOffsetX(e);1<o-i;){var n=Math.round((o+i)/2),s=this.isTransposed?a[n].yPixel:a[n].xPixel;if(r<s)o=n;else{if(!(s<r))return a[n];i=n}}var e=this.isTransposed?a[o].yPixel:a[o].xPixel,l=this.isTransposed?a[i].yPixel:a[i].xPixel;return Math.abs(e-r)<Math.abs(l-r)?a[o]:a[i]}}},a.prototype.findClosestElementFromValue=function(e){var t,a=_.get(this.chartInstance,"data.datasets");if(!a)return null;var i=_.map(_.filter(a,function(e){return!e.hidden}),function(e){return a.length-1-e.index}),o=_.filter(this.sortedData,function(e){return 0<=_.indexOf(i,e.datasetIndex)});if(!o)return null;var r=this.isTransposed?"yLabel":"xLabel";if("string"==typeof e&&"string"==typeof _.get(o[0],r)){for(var n=0;n<o.length;n++){var s=_.get(o[n],r);if(s===e||s+""==e+"")return o[n]}return null}if(!o||null===o[0])return null;var l=this.compare(_.get(o[0],r),e),d=this.compare(_.get(o[o.length-1],r),e);if(void 0===l||void 0===d||isNaN(l)||0<l||d<0)return null;var c,u=0,h=o.length,l=_.get(o[u],r),p=e;for(g.isDuration(l)?p=O.convertValueToDuration(e):g.isMoment(l)&&(p=O.convertValueToMoment(e));1<h-u;){if(c=Math.round((h+u)/2),!(t=this.compare(_.get(o[c],r),p)))return o[c];t<0&&(u=c),0<t&&(h=c)}h=o.length===h?h-1:h,d=this.compare(_.get(o[u],r),p),l=this.compare(_.get(o[h],r),p);return void 0===l||void 0===d||Math.abs(d)<Math.abs(l)?o[u]:o[h]},a.prototype.findSelectedElementFromValue=function(t){var a=this,e=this.generateChartElements();return _.find(e,function(e){a.isTransposed;e=e.xLabel;return e===t||e.toString()===t.toString()})},a.prototype.generateChartElements=function(){for(var o=this,r=[],n=this,e=0;e<this.chartInstance.data.datasets.length;e++)!function(e){var a=n.chartInstance.getDatasetMeta(e).controller,t=n.chartInstance.getDatasetMeta(e).data,i=a.hasOwnProperty("_ruler")&&1<a._ruler.stackCount;n.chartInstance.isDatasetVisible(e)&&t.forEach(function(e,t){return r.push({datasetIndex:e._datasetIndex,index:e._index,xLabel:o.chartInstance.data.datasets[e._datasetIndex].data[e._index].x||o.chartInstance.data.labels[e._index],xPixel:i?a._ruler.pixels[t]:e.getCenterPoint().x,yLabel:o.chartInstance.data.datasets[e._datasetIndex].data[e._index].y,yPixel:e.getCenterPoint().y})})}(e);return r},a.prototype.getOffsetX=function(e){var t,a=e.offsetX;return a&&0!==a||(t=e.target)&&(t=t.getBoundingClientRect(),a=e.clientX-t.left),a},a.prototype.getOffsetY=function(e){var t,a=e.offsetY;return a&&0!==a||(t=e.target)&&(t=t.getBoundingClientRect(),a=e.clientY-t.top),a},a.prototype.hideSelected=function(){this.selectedCrosshairArea&&this.selectedCrosshairArea.classList.remove("active")},a.prototype.hideHover=function(){this.crosshairArea&&this.crosshairArea.classList.remove("active")},a.prototype.isReady=function(){return!!(this.sortedData&&this.sortedData.length||(this.sortDataset(),this.sortedData&&this.sortedData.length))},a.prototype.setColor=function(){"#f8f8f8"!==this.get("CrosshairsColor").toLowerCase()&&"#ffffff"!==this.get("CrosshairsColor").toLowerCase()&&(this.crosshairArea.style["background-color"]=b.alpha(this.get("CrosshairsColor"),60),this.crosshairArea.style.color=b.alpha(this.get("CrosshairsColor"),60),this.selectedCrosshairArea.style["background-color"]=b.alpha(this.get("CrosshairsColor"),90),this.selectedCrosshairArea.style.color=b.alpha(this.get("CrosshairsColor"),60))},a.prototype.sortDataset=function(){var t=this;try{var e=this.generateChartElements();this.sortedData=_.sortBy(e,function(e){return t.isTransposed?e&&!isNaN(e.yPixel)?e.yPixel:0:e&&!isNaN(e.xPixel)?e.xPixel:0}),this.updateSelectedAfterRender()}catch(e){this.warnings=e.toString()}},a.prototype.updateHover=function(e){var t,a;this.isReady()&&(this.get("CrosshairsEnabled")||this.get("TooltipsEnabled"))&&(t=this.findClosestElementFromEvent(e),a=this.api.getProperty("Zoom.ZoomToIndex"),!_.isNil(t))&&(a=this.isTransposed?a?t.yPixel:this.getOffsetY(e):a?t.xPixel:this.getOffsetX(e),this.get("TooltipsEnabled")&&this.renderTooltip(a,e,t),this.get("CrosshairsEnabled")&&this.drawCrosshair(this.crosshairArea,a),this.get("CrosshairsEnabled")||this.get("TooltipsEnabled"))&&(this.preventViewStateUpdate=!0,this.updateViewState("Basics.Hover",t))},a.prototype.updateSelected=function(e){var t;this.isReady()&&this.get("CrosshairsEnabled")&&(e=this.findClosestElementFromEvent(e),_.isNil(e)||(t=this.isTransposed?e.yPixel:e.xPixel,this.drawCrosshair(this.selectedCrosshairArea,t),this.isTransposed?this.selectedY=e.yLabel:this.selectedX=e.xLabel,this.updateViewState("Basics.Selected",e)))},a.prototype.updateSelectedAfterRender=function(){var e,t,a,i=this.api.getProperty("Basics.Selected"),o=this.api.getProperty("XAxes.0._Hidden._Type");"category"===o?i&&(this.isTransposed?this.selectedY=i:this.selectedX=i):"time"===o?(e=O.convertDateStringValueToMoment(i),g.isMoment(e)&&(this.isTransposed?this.selectedY=e:this.selectedX=e)):"linear"!==o&&"logarithmic"!==o||(e=parseFloat(i),_.isNumber(e)&&(this.isTransposed?this.selectedY=e:this.selectedX=e)),this.selectedX?(t=this.findSelectedElementFromValue(this.selectedX))&&this.get("CrosshairsEnabled")?(a=t.xPixel,this.drawCrosshair(this.selectedCrosshairArea,a)):this.hideSelected():this.selectedY&&((t=this.findSelectedElementFromValue(this.selectedY))&&this.get("CrosshairsEnabled")?(a=t.yPixel,this.drawCrosshair(this.selectedCrosshairArea,a)):this.hideSelected())},a.prototype.updateViewState=function(e,t){this.set(e,t)},a.prototype.validateMouseEvent=function(e){var t=this.chartInstance.chartArea,a=t.left,i=t.right,o=t.top,t=t.bottom,r=this.getOffsetX(e),e=this.getOffsetY(e);return a<=r+.5&&r-.5<=i&&o<=e&&e<=t},a.prototype.adjustTooltipPosition=function(e,t){var a,i=this.chartInstance.chartArea,t=this.getOffsetY(t);this.tooltip&&(e=this.get("EdgeAlign")?(a=e-i.left<(i.right-i.left)/2?i.right-10*Math.ceil(this.tooltip.el.clientWidth/10)-this.get("Offset"):i.left+this.get("Offset"),i.top+5):(a=e-i.left<(i.right-i.left)/2?e+this.get("Offset"):e-this.tooltip.el.clientWidth-this.get("Offset"),t-this.tooltip.el.clientHeight/2<i.top?i.top:t+this.tooltip.el.clientHeight/2>i.bottom?i.bottom-this.tooltip.el.clientHeight:t-this.tooltip.el.clientHeight/2),this.tooltip.updatePosition({left:a,top:e}))},a.prototype.displayFormat=function(e,t,a){var i,o,r=t,n=e.options.time;if(n)return i=n.displayFormats,o=O.isKDBTemporal(t)?O.convertKDBTemporalToMoment(t):t,g.isMoment(o)?(o="1214"===_.get(t,"_kdbType")?g(t):g(t).tz(O.timezone),n.tooltipFormat?o.format(n.tooltipFormat):o.format(i[e._unit])):t.format?(0<=["1216","1217","1218","1219"].indexOf(_.get(t,"_kdbType"))?O.convertValueToDuration(t.valueOf()):O.convertValueToMoment(t.valueOf())).format(i[e._unit]):void 0;for(var s=this.xAxes.models.concat(this.yAxes.models),l=0;l<s.length;l++){var d=s[l];if(d.get("_Hidden._Label")===a)return b.getFormatter(d.get("Labels.Format"),d.get("Labels.Precision"),d.get("Labels.HideTrailingZeroes"),d.get("Labels.DateFormat"))(t)}return r},a.prototype.findTooltipItems=function(e,t,a){"{breakdownId}"===a&&(a=t.breakdownColumns[t.getDepth()]);var i,o=[];if(0!==t.getData().length){var r=typeof e;switch(r=_.isArray(e)?"string":r){case"object":for(var n=e.toKdbObject(),s=t.meta[a]?t.meta[a].kdbType:t.getColumnType(a),l=O.getComparator(s,function(e){return e}),d=0;d<t.getData().length;d++)(i=t.getData().at(d).get(a)).i=Math.floor(i.i),0===l(n,i)&&o.push(t.getData().at(d));return o;case"string":for(d=0;d<t.getData().length;d++)t.getData().at(d).get(a)===e&&o.push(t.getData().at(d));return o;case"number":for(d=0;d<t.getData().length;d++)0==Number(e)-Number(t.getData().at(d).get(a))&&o.push(t.getData().at(d));return o}}return[]},a.prototype.hideTooltip=function(){this.api.removeTooltip(),delete this.tooltip},a.prototype.populatePointTooltip=function(e,t,a){var i=this.chartInstance,o=(t.x||(t.y=t.offsetY,t.x=t.offsetX),_.get(E,"Interaction.modes.point"));if(void 0!==t.x){var r=o(i,t);if(r.length){for(var n=r[0],o=this.layers.find(function(e){return e.get("_Hidden._LayerId")===i.data.datasets[n._datasetIndex].layerId}),s=this.isTransposed?"y":"x",l=this.displayFormat(i.scales[o.get("Axes.XAxisID")],i.data.datasets[n._datasetIndex].data[n._index][s]||i.data.labels[n._index],o.get("Axes.XAxisID")),s=this.displayFormat(i.scales[o.get("Axes.YAxisID")],i.data.datasets[n._datasetIndex].data[n._index][s]||i.data.labels[n._index],o.get("Axes.YAxisID")),d=void 0,c=void 0,u=void 0,h=this,p=0;p<r.length;p++)!function(e){var t=r[e];u=i.data.datasets[t._datasetIndex].data[t._index],d=h.layers.find(function(e){return e.get("_Hidden._LayerId")===i.data.datasets[t._datasetIndex].layerId}),c=h.dataSources[d.get("Basics.Data.cid")],u=c.getData().at(t._index),h.pushTooltipItem(d,c,u,t._index,t._datasetIndex)}(p);this.pushToTemplate({fontSize:"font-size:"+this.get("TooltipFontSize")+"px",points:_.reverse(this.tooltipItems),xLabel:l,yLabel:s})}else this.get("PreferIntersect")?this.populateTooltip(e,t,a):this.hideTooltip()}},a.prototype.populateTooltip=function(e,t,l){for(var a=this.chartInstance,d=Object.keys(this.dataSources),i=this.layers.find(function(e){return e.get("_Hidden._LayerId")===a.data.datasets[l.datasetIndex].layerId}),o=a.scales[i.get("Axes.XAxisID")],r=a.scales[i.get("Axes.YAxisID")],t=this.getOffsetX(t),n=this.api.getProperty("Zoom.ZoomToIndex"),s=n?l.xLabel:o.getValueForPixel(t),n=n?l.yLabel:r.getValueForPixel(t),t=this.displayFormat(o,s,i.get("Axes.XAxisID")),o=this.displayFormat(r,n,i.get("Axes.YAxisID")),c=this,u=0;u<d.length;u++){var h=function(t){var e=c.dataSources[d[t]];if(!e.getData())return c.hideTooltip(),{value:void 0};var a=c.layers.models.filter(function(e){return e.get("Basics.Data").cid===d[t]}),i=c.findTooltipItems(c.isTransposed?l.yLabel:l.xLabel,e,a[0].get("Axes.XAxisData"));if(i&&i.length)for(var o=0;o<i.length;o++)for(var r=i[o],n=0;n<a.length;n++){var s=a[n];c.pushTooltipItem(s,e,r,l.index)}}(u);if("object"==typeof h)return h.value}this.pushToTemplate({fontSize:"font-size:"+this.get("TooltipFontSize")+"px",points:this.tooltipItems,xLabel:t,yLabel:o})},a.prototype.pushTooltipItem=function(e,t,a,i,o){var r,n=this.chartInstance,s=!1,l=!1,d=[],c="",u=e.get("Basics.BackgroundColor"),h=e.get("Basics.BorderColor"),p=e.get("Basics.BackgroundOpacity"),g=e.get("Basics.BorderOpacity"),m="_rowIndex"!==t.getPrimaryKey()?t.getData().indexOf(a):_.isNil(a.get("_rowIndex"))?a.id:a.get("_rowIndex"),f={colors:{backgroundColor:"",borderColor:""},cols:a.attributes,isLayerEnabled:e.get("Basics.Enabled"),layerData:"",layerDataFormatted:"",layerName:"",svg:""};switch(e.get("_Hidden._Type")){case"Candlestick":T=a.attributes[e.get("Axes.Low")]+" (Low) ",T=(T=(T+=a.attributes[e.get("Axes.High")]+" (High) ")+(a.attributes[e.get("Axes.Close")]+" (Close) "))+(a.attributes[e.get("Axes.Open")]+" (Open) "),f.layerName=e.get("Basics.Name"),f.layerData=T,f.layerDataFormatted=T,f.colors.backgroundColor=e.get("Candlestick.BearColor"),f.colors.borderColor=e.get("Candlestick.BullColor");break;case"Violin":T=a.attributes[e.get("Axes.Coords")],f.layerName=e.get("Basics.Name"),f.layerData=void 0===T?"":T.toString(),f.layerDataFormatted=void 0===T?"":T.toString();break;case"BoxPlot":T=a.attributes[e.get("Axes.Min")]+" (min) ",T=(T=(T=(T+=a.attributes[e.get("Axes.Q1")]+" (Q1) ")+(a.attributes[e.get("Axes.Median")]+" (Median) "))+(a.attributes[e.get("Axes.Q3")]+" (Q3) "))+(a.attributes[e.get("Axes.Max")]+" (Max) "),f.layerName=e.get("Basics.Name"),f.layerData=T,f.layerDataFormatted=T;break;case"Line":case"Bar":case"Bubble":case"Waterfall":var y=e.get("Axes.YAxisData");if("string"==typeof y){var b=(l=!o&&0!==o)?e.get("Axes.YAxisData"):n.data.datasets[o].colY,x=/\/[gimsuy]*$/,v=void 0,S="",C=(y.startsWith("/")&&y.endsWith("/")?(v=y.substring(1,y.length-1).replace(x,""),S=(x=y.match(x))?x[0].substring(1):""):v="^"+(y=y.replace(/[\-\[\]\/\{\}\(\)\+\?\.\\\^\$\|]/g,"\\$&")).replace(/\*/g,"(.*)")+"$",new RegExp(v,S)),s=!!(1<(d=t.getColumnNames().filter(function(e){return e.match(C)})).length||d[0]&&d[0]!==y);if(-1===d.indexOf(b)&&!s)return}if(s&&l){for(var L=0;L<d.length;L++){var D=d[L],T=this.displayFormat(n.scales[e.get("Axes.YAxisID")],a.attributes[D],e.get("Axes.YAxisID")),c=a.attributes[D+"_Formatted"]?this.displayFormat(n.scales[e.get("Axes.YAxisID")],a.attributes[D+"_Formatted"],e.get("Axes.YAxisID")):T,k=e.getPaletteColor(L),M=e.computeColor(D,k,p,"RuleColor",m),F=e.computeColor(D,h,g,"RuleBorderColor",m);this.tooltipItems.push({colors:{backgroundColor:M,borderColor:F},cols:a.attributes,isLayerEnabled:e.get("Basics.Enabled"),layerData:T,layerDataFormatted:c,layerName:D,svg:this.renderSVG(e,M,F,i)})}return}"number"==typeof y?T=y.toString():(T=this.displayFormat(n.scales[e.get("Axes.YAxisID")],a.attributes[b],e.get("Axes.YAxisID")),c=a.attributes[b+"_Formatted"]?this.displayFormat(n.scales[e.get("Axes.YAxisID")],a.attributes[b+"_Formatted"],e.get("Axes.YAxisID")):T),f.layerName=s?b:e.get("Basics.Name"),f.layerData=void 0===T?"":T.toString(),f.layerDataFormatted=void 0===c?"":c.toString()}"Candlestick"!==e.get("_Hidden._Type")&&(F=s?(r=-1<d.indexOf(b)?d.indexOf(b):o,k=e.getPaletteColor(void 0===r?0:r),M=e.computeColor(b,k,p,"RuleColor",m),e.computeColor(b,k,g,"RuleBorderColor",m)):(M=e.computeColor("",u,p,"RuleColor",m),e.computeColor("",h,g,"RuleBorderColor",m)),f.colors.backgroundColor=M,f.colors.borderColor=F),f.svg=this.renderSVG(e,f.colors.backgroundColor,f.colors.borderColor,i),this.tooltipItems.push(f)},a.prototype.pushToTemplate=function(e){e.legendItems=this.chartInstance.legend.legendItems,this.tooltip=this.api.setTooltip({text:this.get("useCustomTooltip")?this.get("customTooltip"):"<table><thead><tr style='padding-right: 10px;'> <th>{{"+(this.isTransposed?"yLabel":"xLabel")+"}}</th><th> </th > </tr></thead>{{#each points }}<tr><td>{{{svg}}} {{ layerName }}: </td><td style='padding-right: 10px; text-align: left;'>{{layerData}}</td > </tr>{{/each}}</table>",data:e,anchorEl:this.chartInstance.canvas}).updateCSS({backgroundColor:"rgba(0, 0, 0,"+this.get("TooltipBGOpacity")/100+")",fontSize:this.get("TooltipFontSize")})},a.prototype.renderSVG=function(e,t,a,i){var o=this.get("TooltipFontSize"),r="<svg height="+o+" width="+o+' viewbox="0 0 12 12">',n=e.get("Basics.BackgroundOpacity"),s=e.get("Basics.BorderWidth");switch(e.get("_Hidden._Type")){case"Bubble":var l,d=e.get("Bubbles.Icons")?e.get("Bubbles.Icons"):e.get("Bubbles.PointStyle");e.get("Bubbles.SetIconFromData")&&e.get("Bubbles.DataIcon")&&((l=e.getDataIcon(i))&&(d=l),e.get("Bubbles.DataIconColor"))&&(l=e.getDataIconColor(i))&&(t=l);break;case"Line":d=e.get("Points.PointStyle");break;default:d="circle"}switch(e.hasPatterns()&&-1!==t.indexOf("base64")&&(r+='<pattern  id="pat01" width="12" height="12"/><image href='.concat(t,' width="12" height="12"></image></pattern>'),t="url(#pat01)"),d){case"circle":r=r+'<circle cx="6" cy="6" r="5" stroke="" + stroke + "" stroke-width='+Math.min(1,s)+" fill="+t+" ></circle>";break;case"cross":r=r+"<path fill="+t+"  stroke="+a+" stroke-width="+Math.min(1,s)+'  stroke-linecap="butt" stroke-linejoin="miter" opacity='+n+'  d="M 5 0 L 5 5 L 0 5 L 0 7 L 5 7 L 5 12 L 7 12 L 7 7 L 12 7 L 12 5 L 7 5 L 7 0 L 5 0 L 5 0 Z"></path>';break;case"crossRot":r=r+"<path fill="+t+" stroke="+a+" stroke-width="+Math.min(1,s)+' stroke-linecap="butt" stroke-linejoin="miter" opacity='+n+' d="M 3 0 L 0 3 L 3 6 L 0 9 L 3 12 L 6 9 L 9 12 L 12 9 L 9 6 L 12 3 L 9 0L 6 3 L 3 0 Z"></path>';break;case"triangle":r=r+"<path fill="+t+" stroke="+a+" stroke-width="+Math.min(1,s)+'  stroke-linecap="butt" stroke-linejoin="miter" opacity='+n+' d="M 0 12 L 6 0 L 12 12 L 0 12 Z" ></path>';break;case"rectRot":r=r+"<path fill="+t+" stroke="+a+" stroke-width="+Math.min(1,s)+' stroke-linecap="butt" stroke-linejoin="miter" opacity='+n+' d="M 6 0 L 12 6 L 6 12 L 0 6 L 6 0 Z"></path>';break;case"downTriangle":r=r+"<path fill="+t+" stroke="+a+" stroke-width="+Math.min(1,s)+' stroke-linecap="butt" stroke-linejoin="miter" opacity='+n+' d="M 0 0 L 12 0 L 6 12 L 0 0 Z"></path>';break;default:r=r+"<rect fill="+t+" stroke="+a+" stroke-width="+Math.min(1,s)+' stroke-linecap="butt" stroke-linejoin="miter" opacity='+n+' height="12" width="12"></rect>'}return r+="</svg>",0<=d.indexOf("fa-")?r='<i style="color:'+t+'" class="fa '+d+'"></i>':0<=d.indexOf("mi-")&&(r='<i style="color:'+t+'" class="mi '+d+'"></i>'),r},a.prototype.renderTooltip=function(e,t,a){this.tooltipItems=[],this.get("TooltipsIntersect")||this.get("PreferIntersect")?this.populatePointTooltip(e,t,a):this.populateTooltip(e,t,a),this.adjustTooltipPosition(e,t)};var oe,re=a;function a(e){var t=e.dataSources,a=e.layers,i=e.yAxes,o=e.xAxes,r=e.el,e=e.api,n=oe.call(this)||this;return n.startDrag=0,n.isTransposed=!1,n.triggerSort=!1,n.tooltipItems=[],n.warnings="",n.preventViewStateUpdate=!1,n.dataSources=t,n.layers=a,n.api=e,n.yAxes=i,n.xAxes=o,n.crosshairArea=r.querySelector(".crosshair"),n.selectedCrosshairArea=r.querySelector(".crosshair-selected"),n.mouseDown=n.mouseDown.bind(n),n.mouseUp=n.mouseUp.bind(n),n.mouseMove=n.mouseMove.bind(n),n.mouseOut=n.mouseOut.bind(n),n.dblClick=n.dblClick.bind(n),n.nextFrame=n.nextFrame.bind(n),n}ne=r.DeepModel,e(d,ne),d.prototype.beforeInit=function(e){var t=this;this.chartInstance=e,this.node=e.canvas,this.node&&(this.node.addEventListener("touchmove",function(e){t.mouseMove(t.getTouchEvent(e.target,e.targetTouches[0]))}),this.node.addEventListener("touchstart",function(e){t.mouseDown(t.getTouchEvent(e.target,e.changedTouches[0]))}),this.node.addEventListener("touchend",function(e){t.mouseUp(t.getTouchEvent(e.target,e.changedTouches[0]))}),this.node.addEventListener("mousemove",this.mouseMove.bind(this)),this.node.addEventListener("mousedown",this.mouseDown.bind(this)),this.node.addEventListener("mouseup",this.mouseUp.bind(this)),this.node.addEventListener("wheel",this.mouseWheel.bind(this)))},d.prototype.destroy=function(){var t=this;this.node&&(this.node.removeEventListener("touchmove",function(e){t.mouseMove(t.getTouchEvent(e.target,e.targetTouches[0]))}),this.node.removeEventListener("touchstart",this.mouseDown.bind(this)),this.node.removeEventListener("touchend",function(e){t.mouseUp(t.getTouchEvent(e.target,e.changedTouches[0]))}),this.node.removeEventListener("mousemove",this.mouseMove.bind(this)),this.node.removeEventListener("mousedown",this.mouseDown.bind(this)),this.node.removeEventListener("mouseup",this.mouseUp.bind(this)),this.node.removeEventListener("wheel",this.mouseWheel.bind(this)),delete this.chartInstance,delete this.node)},d.prototype.beforeDatasetsDraw=function(e){var t=e.chartArea,e=e.ctx,a=t.left,i=t.top,o=t.right,t=t.bottom;e.save(),e.beginPath(),e.rect(a,i,o-a,t-i),e.clip()},d.prototype.afterDatasetsDraw=function(e){e.ctx.restore()},d.prototype.afterRender=function(e){e.data.datasets.length&&this.storeDefault()},d.prototype.setDistribution=function(e){this.distribution=e},d.prototype.getZoomSettings=function(){return{drag:!0,enabled:this.enabled(this.chartInstance,"dragZoom"),mode:"x",scaleAxes:"x"}},d.prototype.storeDefault=function(){!this.defaultZoom&&this.chartInstance&&(this.defaultZoom=this.fetchZoomObj(this.chartInstance))},d.prototype.updateDebouncer=function(e){var a=this;e.ViewstateUpdateDelay&&(this.debounceViewState=_.debounce(function(e,t){a.updateViewState(e,t)},1e3*this.get("ViewstateUpdateDelay")))},d.prototype.initalizeListeners=function(){var t=this;this.listenTo(this,"change:Min change:Max",function(e){void 0!==e.get("Min")&&void 0!==e.get("Max")&&t.chartInstance&&t.updateMinMaxFromViewstate()})},d.prototype.resetZoom=function(){this.isReset=!0,this.zoomObj=void 0;var e,t,a,i=this.get("DefaultMin"),o=this.get("DefaultMax");void 0!==i&&""!==i&&void 0!==o&&""!==o||(e=_.get(this.chartInstance,"config.crosshairModel.sortedData"))&&(t=_.get(this.defaultZoom,"min")?_.get(this.defaultZoom,"min"):null,a=_.get(this.defaultZoom,"max")?_.get(this.defaultZoom,"max"):null,i=this.get("ResetViewStateOnly")?t:e[0].xLabel,o=this.get("ResetViewStateOnly")?a:e[e.length-1].xLabel),this.resetYaxisNice(),this.updateMinMax(this.chartInstance,i,o),this.updateViewState(this.chartInstance)},d.prototype.getTouchEvent=function(e,t){var a=e.getBoundingClientRect();return{offsetX:t.pageX-a.left,offsetY:t.pageY-a.top,target:e,targetTouches:t,type:"touch",xLabel:0}},d.prototype.enabled=function(e,t){if(e.canvas){e=_.get(e,"canvas.parentElement.parentElement");if(e){var a=e.getElementsByClassName("active-mouse")[0];switch(t){case"scrollZoom":return this.get("ScrollZoom");case"pan":return this.get("DragPan")&&("none"===a.style.display||a.classList.contains("hidden1")||a.classList.contains("hidden")||a.classList.contains("active"));case"dragZoom":return this.get("DragZoom")&&!this.isTransposed&&("none"===a.style.display||a.classList.contains("hidden1")||a.classList.contains("hidden")||!a.classList.contains("active"))}}}return!1},d.prototype.setRoot=function(e,t){var a,i,o;e&&(a=_.get(e,"scales"),i=_.get(e,"config.crosshairModel.selectedCrosshairArea"),a)&&this.eventIsInChartArea(e,t)&&(e=a[this.activeAxis].options.type,t=this.snapEventToData(t),o=this.isTransposed?t.offsetY:t.offsetX,this.root=_.has(t,"xLabel")&&"category"!==e?t.xLabel:a[this.activeAxis].getValueForPixel(o),this.rootEvent=t,this.crosshairRoot=parseFloat(i.style.left))},d.prototype.singleClick=function(e){this.chartInstance.config.crosshairModel.sortedData.length&&this.setRoot(this.chartInstance,e)},d.prototype.dblClick=function(){this.resetZoom(),this.clearDragOverlay(),this.root=void 0,this.rootEvent=void 0},d.prototype.eventIsInChartArea=function(e,t){var e=e.chartArea,a=!!t.type&&"touchstart"===t.type;if(a&&(t.targetTouches&&0<t.targetTouches.length))return(a=this.getTouchEvent(t.target,t.targetTouches[0])).offsetX>e.left&&a.offsetX<e.right&&a.offsetY>e.top&&a.offsetY<e.bottom;return t.offsetX>e.left&&t.offsetX<e.right&&t.offsetY>e.top&&t.offsetY<e.bottom},d.prototype.mouseMove=function(e){(this.root||0===this.root)&&this.rootEvent&&(this.enabled(this.chartInstance,"pan")?(this.isReset=!1,this.chartInstance&&this.pan(this.chartInstance,e)):(e=this.snapEventToData(e),this.enabled(this.chartInstance,"dragZoom")&&3<Math.abs(this.rootEvent.offsetX-e.offsetX)&&this.createDragZoomOverlay(this.chartInstance,e)))},d.prototype.mouseDown=function(e){!!e.type&&"touch"===e.type||e.preventDefault();var t=Date.now();10<t-this.clicks&&t-this.clicks<this.delay?this.dblClick():this.singleClick(e),this.clicks=t},d.prototype.mouseUp=function(e){var t=this.chartInstance,a=this.root||0===this.root,i=!1;if(this.enabled(t,"dragZoom")&&a&&this.rootEvent)try{i=!(e.type&&"touch"===e.type&&Math.abs(this.rootEvent.offsetX-e.offsetX)<3)}catch(e){this.warnings=e.toString(),i=!1}i&&this.rootEvent&&(e=this.snapEventToData(e),3<Math.abs(this.rootEvent.offsetX-e.offsetX))&&(this.isReset=!1,this.dragZoom(t,e)),this.clearDragOverlay(),this.root=void 0,this.rootEvent=void 0},d.prototype.mouseWheel=function(e){var t=this.chartInstance;this.enabled(t,"scrollZoom")&&(e.preventDefault(),this.isReset=!1,this.zoom(t,e))},d.prototype.setDuration=function(e,t){e=g.duration(e.valueOf());return t=void 0===t?"1217":t,e._kdbType=_.isNil(e._kdbType)?t:e._kdbType,e},d.prototype.updateMinMax=function(e,a,i,t){var o,r,n=this;e&&(o=!1,r=_.get(e,"chart.scales"))&&(_.each(r,function(e,t){0<=t.indexOf("XAxis")&&("time"===e.options.type&&(a=void 0!==a?b.isDuration(a)?n.setDuration(a,a._kdbType):O.convertValueToMoment(a):a,i=void 0!==i?b.isDuration(i)?n.setDuration(i,i._kdbType):O.convertValueToMoment(i):i,"1212"!==a._kdbType&&"1215"!==a._kdbType||a.isUTC(!0),"1212"!==i._kdbType&&"1215"!==i._kdbType||a.isUTC(!0),e.options.ticks.min=a,e.options.ticks.max=i),e.options.ticks.min=a,e.options.ticks.max=i,e.min=a,e.max=i,o=!0)}),o)&&this.recalculateYLimitsAndUpdate(e,t)},d.prototype.recalculateYLimitsAndUpdate=function(e,t){var a,i,o=this,r=_.get(e,"scales");r&&this.chartInstance&&("none"!==this.get("YAdjust")&&t&&this.rootEvent?(a=Math.min(t.offsetX,this.rootEvent.offsetX),i=Math.max(t.offsetX,this.rootEvent.offsetX),_.forEach(r,function(e,t){"Y"===t.split("")[0]&&o.getYaxisNice(e,a,i)}),this.chartInstance.update(),this.zoomObj=this.fetchZoomObj(e)):(this.chartInstance.update(),this.activeAxis.indexOf("XAxis")<0&&(this.zoomObj=this.isReset?void 0:this.fetchZoomObj(e))))},d.prototype.resetYaxisNice=function(){var e;this.chartInstance&&(e=_.get(this.chartInstance,"scales"),_.forEach(e,function(e,t){"Y"===t.split("")[0]&&(e.options.ticks.min=void 0,e.options.ticks.max=void 0)}),this.chartInstance.update())},d.prototype.getYaxisNice=function(a,i,o){var r,n,s,e,t,l,d=this.get("YAdjust");this.chartInstance&&(r=_.map(this.chartInstance._getSortedDatasetMetas(!0),function(e){if(!e.hidden)return e.index}),e=a.chart._getSortedDatasetMetas(!0),e=_.map(e[0].data,function(e,t){if(e._view.x>=i&&e._view.x<=o)return t}),n=_.min(e),s=_.max(e),_.isNil(n)||_.isNil(s)||(e=_.flatMap(this.chartInstance.data.datasets,function(e,t){if(e.yAxisID===a.id&&0<=r.indexOf(t))return _.map(_.filter(e.data,function(e,t){return n<=t&&t<=s}),"y")}),l=_.min(e),e=_.max(e),void 0!==l&&void 0!==e&&(t=this.getNice(e-l),l="nice"===d?Math.floor(l/t)*t:l,d="nice"===d?Math.ceil(e/t)*t:e,a.options.ticks.min=l,a.options.ticks.max=d)))},d.prototype.getNice=function(e){var t=Math.floor(Math.log10(e)),e=e/Math.pow(10,t),e=e<=1?1:e<=5?2:e<=10?5:10;return e*Math.pow(10,t)},d.prototype.snapEventToData=function(e){var t,a,i=_.get(this.chartInstance,"config.crosshairModel");return i&&this.get("ZoomToIndex")?(t=(i=i.findClosestElementFromEvent(e)).xPixel,a=i.yPixel,i=i.xLabel,{offsetX:t,offsetY:a,target:e.target,targetTouches:null,type:"touch",xLabel:i}):e},d.prototype.createDragZoomOverlay=function(e,t){var a,e=e.chartArea;this.rootEvent&&(a=Math.min(this.rootEvent.offsetX,t.offsetX),t=Math.max(this.rootEvent.offsetX,t.offsetX),this.zoomArea.style["background-color"]=this.get("FillColor"),this.zoomArea.style.height=e.bottom-e.top+"px",this.zoomArea.style.left=a+"px",this.zoomArea.style.opacity=this.get("FillOpacity")/100,this.zoomArea.style.position="absolute",this.zoomArea.style.top=e.top+"px",this.zoomArea.style.width=t-a+"px",e=_.get(this.chartInstance,"config.crosshairModel.tooltipArea"))&&(t=e.html(),e.innerHTML=t)},d.prototype.clearDragOverlay=function(){this.zoomArea.style.left="0px",this.zoomArea.style.width="0px"},d.prototype.dragZoom=function(e,t){var a=_.get(e,"scales");if(a)switch(a[this.activeAxis].options.type){case"linear":case"logarithmic":this.dragZoomLinear(e,t);break;case"time":this.dragZoomTime(e,t);break;case"category":this.dragZoomCategory(e,t)}},d.prototype.dragZoomLinear=function(e,t){var a=_.get(e,"scales");if(a){var i=this.root,a=_.has(t,"xLabel")?t.xLabel:a[this.activeAxis].getValueForPixel(t.offsetX),o=Math.min(i,a),i=Math.max(i,a);if(this.get("ResetViewStateOnly"))return this.updateViewState(e,{min:o,max:i});this.updateMinMax(e,o,i,t),this.updateViewState(e)}},d.prototype.dragZoomTime=function(e,t){var a=_.get(e,"scales");if(a){var i=this.root,a=_.has(t,"xLabel")?t.xLabel:a[this.activeAxis].getValueForPixel(t.offsetX),o=g.isDuration(i),r=i.valueOf()<a.valueOf()?i:a,i=i.valueOf()>a.valueOf()?i:a,a=o?O.convertValueToDuration(r,"1217"):O.convertValueToMoment(r),r=o?O.convertValueToDuration(i,"1217"):O.convertValueToMoment(i);if(this.get("ResetViewStateOnly"))return this.updateViewState(e,{min:a,max:r});this.updateMinMax(e,a,r,t),this.updateViewState(e)}},d.prototype.dragZoomCategory=function(e,t){var a=_.get(e,"scales");if(a){var i=e.data.labels,o=this.isTransposed?t.offsetY:t.offsetX,r=this.root,a=a[this.activeAxis].getValueForPixel(o),o=Math.min(r,a),r=Math.max(r,a);if(this.get("ResetViewStateOnly"))return this.updateViewState(e,{min:i[o],max:i[r]});this.updateMinMax(e,i[o],i[r],t),this.updateViewState(e)}},d.prototype.pan=function(e,t){var a=_.get(e,"chart.scales");if(a){switch(e.preventUpdate=!0,a[this.activeAxis].options.type){case"linear":this.panLinear(e,t);break;case"time":this.panTime(e,t);break;case"category":this.panCategory(e,t);break;default:this.hasWarned||(this.hasWarned=!0)}this.debounceViewState(e)}},d.prototype.panCategory=function(e,t){var a,i,o,r,n=_.get(e,"scales");n&&this.rootEvent&&(a=e.data.labels,i=this.isTransposed?t.offsetY:t.offsetX,i=n[this.activeAxis].getValueForPixel(i),i=this.root-i,r=n[this.activeAxis].minIndex,o=(n=n[this.activeAxis].maxIndex)-r,n=n+i,(r=r+i)<0?n=(r=0)+o:n>a.length-1&&(r=(n=a.length-1)-o),this.translateCrosshair(t.offsetX-this.rootEvent.offsetX),this.updateMinMax(e,a[r],a[n]))},d.prototype.panLinear=function(e,t){var a,i,o=_.get(e,"scales");o&&this.rootEvent&&(a=o[this.activeAxis].getValueForPixel(t.offsetX),a=this.root-a,i=(o[this.activeAxis].options.ticks.min||o[this.activeAxis].min)+a,o=(o[this.activeAxis].options.ticks.max||o[this.activeAxis].max)+a,this.translateCrosshair(t.offsetX-this.rootEvent.offsetX),this.updateMinMax(e,i,o))},d.prototype.addMilliSecToMoment=function(e,t){return O.convertValueToMoment(e._i).add(t,"ms").valueOf()},d.prototype.panTime=function(e,t){var a,i,o,r=_.get(e,"scales");r&&this.rootEvent&&(a=g.isDuration(this.root),i=r[this.activeAxis].getValueForPixel(t.offsetX),i=a?this.root-i:this.root.diff(i),o=r[this.activeAxis].options.ticks.min||r[this.activeAxis].min,r=r[this.activeAxis].options.ticks.max||r[this.activeAxis].max,o=a?o._milliseconds+i:this.addMilliSecToMoment(o,i),r=a?r._milliseconds+i:this.addMilliSecToMoment(r,i),i=a?O.convertValueToDuration(o,"1217"):O.convertValueToMoment(o),o=a?O.convertValueToDuration(r,"1217"):O.convertValueToMoment(r),this.translateCrosshair(t.offsetX-this.rootEvent.offsetX),this.updateMinMax(e,i,o))},d.prototype.translateCrosshair=function(e){var t=_.get(this.chartInstance,"config.crosshairModel.selectedCrosshairArea");t&&this.crosshairRoot&&(t.style.left=this.crosshairRoot+e+"px")},d.prototype.directionFactor=function(e,t){var a=e.chartArea.left,e=e.chartArea.right;return(t.offsetX-a)/(e-a)},d.prototype.zoom=function(e,t){var a=_.get(e,"scales");if(a){a=a[this.activeAxis].options.type;switch(e.preventUpdate=!0,a){case"linear":case"logarithmic":this.zoomLinear(e,t);break;case"time":this.zoomTime(e,t);break;case"category":this.zoomCategory(e,t);break;default:this.hasWarned||(this.hasWarned=!0)}this.debounceViewState(e)}},d.prototype.zoomCategory=function(e,t){var a,i,o=_.get(e,"scales");o&&(a=e.data.labels,i=o[this.activeAxis].minIndex,o=o[this.activeAxis].maxIndex,t=t.deltaY/Math.abs(t.deltaY)*1,i=Math.ceil(i-t),(o=(o=Math.floor(o+t))>a.length-1?a.length-1:o)<(i=i<0?0:i)&&(t=i,i=o,o=t),this.updateMinMax(e,a[i],a[o]))},d.prototype.zoomLinear=function(e,t){var a,i,o=_.get(e,"scales");o&&(a=this.directionFactor(e,t),i=o[this.activeAxis].options.ticks.min||o[this.activeAxis].min,t=.1*((o=o[this.activeAxis].options.ticks.max||o[this.activeAxis].max)-i)*(t.deltaY/Math.abs(t.deltaY)),this.updateMinMax(e,i-t*a,o+t*(1-a)))},d.prototype.zoomTime=function(e,t){var a,i,o,r=_.get(e,"scales");r&&(o=this.directionFactor(e,t),i=r[this.activeAxis].options.ticks.min||r[this.activeAxis].min,r=r[this.activeAxis].options.ticks.max||r[this.activeAxis].max,t=(a=b.isDuration(i))?(i=i._milliseconds,.1*((r=r._milliseconds)-i)*(t.deltaY/Math.abs(t.deltaY))):i._isAMomentObject?(i=g(i._d),.1*((r=g(r._d))-i)*(t.deltaY/Math.abs(t.deltaY))):.1*r.diff(i)*(t.deltaY/Math.abs(t.deltaY)),i=i-t*o,r=r+t*(1-o),t=a?O.convertValueToDuration(i,"1217"):O.convertValueToMoment(i).tz("UTC"),o=a?O.convertValueToDuration(r,"1217"):O.convertValueToMoment(r).tz("UTC"),"smart"===this.distribution&&this.defaultZoom&&(t=this.defaultZoom.min>t?this.defaultZoom.min:t,o=this.defaultZoom.max<o?this.defaultZoom.max:o),this.updateMinMax(e,t,o))},d.prototype.fetchZoomObj=function(e){var t=_.get(e,"scales"),a={min:"",max:""};if(t){var i=t[this.activeAxis].options,t=i.type,e=_.get(e,"data.labels"),o=e&&e.length?_.first(e):void 0,r=e&&e.length?_.last(e):void 0;switch(t){case"linear":case"logarithmic":a={min:this.get("min")||i.ticks.min||o,max:this.get("max")||i.ticks.max||r};break;case"time":a={min:_.get(i,"ticks.min._isValid")?i.ticks.min:"",max:_.get(i,"ticks.max._isValid")?i.ticks.max:""};break;case"category":a={min:this.get("min")||i.ticks.min||o,max:this.get("max")||i.ticks.max||r}}}return a},d.prototype.updateMinMaxFromViewstate=function(){var e=_.get(this.chartInstance,"scales");if(e){var e=e[this.activeAxis].options.type,t=this.chartInstance,a=this.get("Min"),i=this.get("Max");switch(this.isReset=!1,e){case"linear":case"logarithmic":this.updateMinMax(t,parseFloat(a),parseFloat(i));break;case"time":""!==a&&O.convertValueToMoment(a),""!==i&&O.convertValueToMoment(i),this.updateMinMax(t,a,i);break;case"category":var o,r,n=t.data.labels[0];g.isDuration(n)||g.isMoment(n)?(o=O.convertStringToMomentFormat(a,a.type),r=O.convertStringToMomentFormat(i,i.type),a=t.data.labels.find(function(e){return e.valueOf()===(_.isNil(o)?o:o.valueOf())})||a,i=t.data.labels.find(function(e){return e.valueOf()===(_.isNil(r)?r:r.valueOf())})||i):"number"==typeof n&&(a=1<n.toString().split(".").length?parseInt(a,10):parseFloat(a),i=1<n.toString().split(".").length?parseInt(i,10):parseFloat(i)),this.updateMinMax(t,a,i);break;default:this.hasWarned||(this.hasWarned=!0)}this.zoomObj=this.fetchZoomObj(t),this.set("Min",this.valToViewState(this.zoomObj.min),{silent:!0}),this.set("Max",this.valToViewState(this.zoomObj.max),{silent:!0})}},d.prototype.updateViewState=function(e,t){if(!this.isTransposed)try{this.zoomObj=t||this.fetchZoomObj(e),this.set("Min",this.valToViewState(this.zoomObj.min),{silent:!0}),this.set("Max",this.valToViewState(this.zoomObj.max),{silent:!0}),e.preventUpdate=!1,this.chartInstance.isDirty&&this.trigger("cleanChart",this),this.trigger("MinMaxChange",this)}catch(e){this.warnings=e.toString()}},d.prototype.valToViewState=function(e){return void 0!==e&&e._isAMomentObject&&"function"!=typeof e.isValid&&(e.utcOffset&&(e=O.convertKDBTemporalToMoment(e)),e=O.convertKDBTemporalToMoment(g(e._i))),(e=b.isDuration(e)?this.setDuration(e._milliseconds,e.kdbType):e)&&e.toDashString?e.toDashString():null!=e?""+e:""};var ne,se=d;function d(e){var e=e.el,t=ne.call(this)||this;return t.isReset=!1,t.isTransposed=!1,t.activeAxis="XAxis 1",t.hasWarned=!1,t.distribution="",t.warnings="",t.clicks=0,t.delay=300,t.zoomArea=e.querySelector(".zoomchart"),t.debounceViewState=_.debounce(t.updateViewState.bind(t),100*t.get("ViewstateUpdateDelay")),t.initalizeListeners(),t}var le;le=r.DeepModel,e(de,le),de.prototype.initialize=function(e){this.set("ShowExportCsvButton",e.ShowExportCsvButton),this.set("ShowExportExcelButton",e.ShowExportExcelButton)};function de(){return null!==le&&le.apply(this,arguments)||this}var c={Trigger:{default:"Click",enum:["Click","Hover","Double Click"],propertyOrder:2,title:"Trigger Action",type:"string"}},u=(h.axisTypeFactory=function(e,t){return{title:e,options:{collapsed:!0,linked_oneof_property:{property:"_Hidden._Type",value:e}},properties:h.axisPropertiesFactory(e,t)}},h.factory=function(t,e){var a="XAxes"===t?["category","linear","logarithmic","time"]:["linear","category","logarithmic","time"];return{type:"array",propertyOrder:e,items:{type:"object",id:"arrItem",title:t,headerTemplate:n.singular(t)+" {{ i1 }}",oneOf:a.map(function(e){return h.axisTypeFactory(e,t)})}}},h.axisPropertiesFactory=function(e,t){var a={_Hidden:{options:{hidden:!0},properties:{_AxisId:{options:{hidden:!0},type:"string"},_Index:{options:{hidden:!0},type:"number"},_Label:{options:{hidden:!0},type:"string"},_Type:{default:e,options:{hidden:!0},type:"string"}},type:"object"},Center:{default:"",options:{hidden:!("linear"===e)},propertyOrder:31,type:"string"},Display:{default:!0,format:"checkbox",propertyOrder:20,title:"Display",type:"boolean"},GridLines:{options:{collapsed:!0},properties:{OffsetGridLines:{default:!0,format:"checkbox",type:"boolean"}},type:"object"},Position:{default:"XAxes"===t?"bottom":"left",enum:"XAxes"===t?["bottom","top"]:["left","right"],propertyOrder:10,type:"string"},Stacked:{default:!1,format:"checkbox",propertyOrder:30,title:"Stacked",type:"boolean"},Title:{options:{collapsed:!0},properties:_.merge({Display:{default:!1,format:"checkbox",type:"boolean"},FontFamily:{default:null,type:"string"},FontSize:{default:null,format:"number",type:"number"},FontStyle:{default:null,enum:["normal","italic","oblique","initial","inherit"],type:"string"},LabelString:{default:null,type:"string"}},b.colorFactory("Font",void 0,void 0)),type:"object"},Labels:{options:{collapsed:!0},properties:_.merge({Display:{default:!0,format:"checkbox",propertyOrder:1,type:"boolean"},FontFamily:{default:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",propertyOrder:17,title:"Font Family",type:"string"},FontSize:{default:12,format:"number",propertyOrder:16,title:"Font Size",type:"number"},FontStyle:{default:"normal",enum:["normal","italic","oblique","initial","inherit"],propertyOrder:18,title:"Font Style",type:"string"},MaxRotation:{default:360,propertyOrder:9,title:"Max Rotation",type:"number"},MaxWidth:{default:0,propertyOrder:11,title:"Fixed Axis Width",type:"number"},MinRotation:{default:0,propertyOrder:10,title:"Min Rotation",type:"number"},StepSize:{default:0,propertyOrder:13,title:"Step Size",type:"number"},_ReverseCache:{default:!1,options:{hidden:!0},type:"boolean"}},b.colorFactory("Font","#F8F8F8",100),_.includes(["linear","logarithmic"],e)?{Reverse:{default:!1,format:"checkbox",propertyOrder:3,type:"boolean"}}:{},b.colorFactory("Font","#F8F8F8",100),_.includes(["time","linear"],e)?{Offset:{default:!1,format:"checkbox",propertyOrder:3,title:"Offset",type:"boolean"}}:{},_.includes(["category","linear","logarithmic"],e)?{BeginAtZero:{default:!0,format:"checkbox",propertyOrder:2,title:"Begin At Zero",type:"boolean"},DateFormat:{default:"YYYY-MM-DD",enum:["YYYY-MM-DD","YYYY-MMM-DD","YYYY-MMMM-DD","YYYY-MM","YYYY-MMM","YYYY-MMMM","MMM DD","MMM Do","YYYY-MM-DD HH:mm:ss","YYYY-MM-DD hh:mm:ss","YYYY-MM-DD kk:mm:ss","hh:mm:ss","kk:mm:ss","hh:mm:ss.SS","hh:mm","kk:mm","mm:ss","mm:ss.SS"],propertyOrder:6,title:"Date/Time format",type:"string"},Format:{default:"General",enum:["General","Number","Smart Number","Formatted Number","Datetime"],propertyOrder:5,type:"string"},HideTrailingZeroes:{default:!1,format:"checkbox",propertyOrder:4,title:"Hide Trailing Zeroes",type:"boolean"},Precision:{default:2,format:"number",maximum:10,minimum:0,propertyOrder:7,title:"Decimal Places",type:"number"},Prefix:{default:"",propertyOrder:14,type:"string"},Suffix:{default:"",propertyOrder:15,type:"string"}}:{},_.includes(["category"],e)?{FilterUnique:{default:!1,format:"checkbox",title:"Filter Unique",type:"boolean"}}:{},_.includes(["time"],e)?{TimeFormats:{options:{collapsed:!0},properties:{Break:{default:864e5,minimum:0,propertyOrder:1,type:"number"},Day:{default:"MMM D",propertyOrder:7,type:"string"},Distribution:{default:"linear",enum:["linear","series","smart"],propertyOrder:1,type:"string"},Hour:{default:"hA",propertyOrder:8,type:"string"},IsoWeekday:{default:!1,format:"checkbox",propertyOrder:13,type:"boolean"},ShowMajor:{default:!1,format:"checkbox",propertyOrder:15,title:"Show Major units",type:"boolean"},Millisecond:{default:"h:mm:ss.SSS a",propertyOrder:11,type:"string"},Minute:{default:"h:mm a",propertyOrder:9,type:"string"},Month:{default:"MMM YYYY",propertyOrder:5,type:"string"},Quarter:{default:"[Q]Q - YYYY",propertyOrder:4,type:"string"},Round:{default:!1,format:"checkbox",propertyOrder:14,type:"boolean"},Second:{default:"h:mm:ss a",propertyOrder:10,type:"string"},TooltipFormat:{default:"",propertyOrder:12,title:"Tooltip Format",type:"string"},TriggerBreak:{default:864e5,minimum:0,propertyOrder:1,type:"number"},Unit:{default:"",enum:["","year","quarter","month","week","day","hour","minute","second","millisecond"],propertyOrder:2,title:"Force Time Unit",type:"string"},Week:{default:"ll",propertyOrder:6,type:"string"},Year:{default:"YYYY",propertyOrder:3,type:"string"}},title:"Time Formats",type:"object"}}:{}),type:"object"}};switch(_.merge(a.GridLines.properties,b.colorFactory("GridLines","#F8F8F8",10)),e){case"linear":case"logarithmic":case"time":a.Range={options:{collapsed:!0},properties:{Max:{default:void 0,format:"number",propertyOrder:6,type:"number"},Min:{default:void 0,format:"number",propertyOrder:7,type:"number"},SoftRange:{default:void 0,format:"checkbox",propertyOrder:3,title:"Use Soft Range",type:"boolean"},SuggestedMax:{default:void 0,format:"number",propertyOrder:4,title:"Suggested Max",type:"number"},SuggestedMin:{default:void 0,format:"number",propertyOrder:5,title:"Suggested Min",type:"number"},UseDataRange:{default:void 0,format:"checkbox",propertyOrder:3,title:"Use Data Range",type:"boolean"},UseMinMax:{default:!1,format:"checkbox",propertyOrder:1,title:"Use Min/Max",type:"boolean"},UseMinMaxReset:{default:!0,format:"checkbox",propertyOrder:2,title:"Reset on change",type:"boolean"}},type:"object"}}return a},h);function h(){}var p={RuleName:{default:"",propertyOrder:1,title:"Rule Name",type:"string"},RuleSource:{default:"",enumSource:"possible_cols",propertyOrder:3,title:"Rule Source",type:"string",watch:{possible_cols:"arrItem._Hidden._PossibleColumnsWithItself"}},RuleTarget:{data:"possible_columns",default:"*",propertyOrder:2,title:"Rule Target",type:"customDropdown",watch:{possible_columns:"arrItem._Hidden._PossibleColumns"}},RuleType:{options:{hidden:!0},propertyOrder:4,title:"Rule Type",type:"string"},Show:{default:!1,format:"checkbox",propertyOrder:5,title:"Show Rule in Legend",type:"boolean"}},p={_Hidden:{options:{hidden:!0},properties:{_Index:{options:{hidden:!0},type:"number"},_LayerId:{options:{hidden:!0},type:"string"},_PossibleColumns:{options:{hidden:!0},type:"array"},_PossibleColumnsWithItself:{options:{hidden:!0},type:"array"},_PossibleColumnsWithXYKey:{options:{hidden:!0},type:"array"},_PossibleColumnsWithEmptyKey:{options:{hidden:!0},type:"array"},_PossibleRadius:{options:{hidden:!0},type:"array"},_PossibleXAxes:{options:{hidden:!0},type:"array"},_PossibleYAxes:{options:{hidden:!0},type:"array"}},type:"object"},Basics:{options:{collapsed:!0},properties:_.merge({},{Data:{propertyOrder:1,title:"Data Source",type:"data"},Enabled:{default:!0,format:"checkbox",propertyOrder:3,title:"Enabled",type:"boolean"},LegendEnabled:{default:!0,format:"checkbox",propertyOrder:4,title:"Legend Enabled",type:"boolean"},LegendLabelColor:{default:"#F8F8F8",options:{gradient:!1,hidden:!0,noColor:!1},propertyOrder:5,title:"Legend Color",type:"gradient"},Name:{default:"",propertyOrder:2,type:"string"}},b.backgroundFactory(""),b.borderFactory("")),propertyOrder:10,type:"object"},Axes:{options:{collapsed:!0},properties:{XAxisData:{data:"possible_columns",default:"",title:"X-Axis Data",type:"customDropdown",watch:{possible_columns:"arrItem._Hidden._PossibleColumns"}},XAxisID:{enumSource:"possible_xaxis",title:"X-Axis ID",type:"string",watch:{possible_xaxis:"arrItem._Hidden._PossibleXAxes"}},YAxisID:{enumSource:"possible_yaxis",title:"Y-Axis ID",type:"string",watch:{possible_yaxis:"arrItem._Hidden._PossibleYAxes"}}},propertyOrder:20,type:"object"},HighlightRules:{items:{oneOf:[{options:{linked_oneof_property:{property:"RuleType",value:"discrete"}},properties:Object.assign({},p,{RuleBorderColor:{default:"#F8F8F8",options:{gradient:!1,noColor:!1},propertyOrder:12,title:"Rule Border Color",type:"gradient"},RuleColor:{default:"#F8F8F8",options:{gradient:!1,noColor:!1},propertyOrder:11,title:"Rule Colour",type:"gradient"},RuleOperation:{default:"",enum:["","search","regexp","contains","starts with","ends with","==","<",">","<=",">=","!=","in","Fill Left-to-Right","Fill Right-to-Left"],propertyOrder:9,title:"Rule Operation",type:"string"},RuleValue:{data:"possible_columns",default:"",propertyOrder:10,title:"Rule Value",type:"string"}}),title:"Discrete"},{options:{additionalProperties:!1,linked_oneof_property:{property:"RuleType",value:"gradient"}},properties:Object.assign({},p,{Palette:{default:[{type:"#b71c1c"},{type:"#F57F17"},{type:"#33691E"}],format:"table",items:{properties:{type:{default:"#ffa500",options:{gradient:!1},title:"color",type:"gradient"}},title:"Palette Colour",type:"object"},options:{collapsed:!0},propertyOrder:8,title:"Color Palette",type:"array",uniqueItems:!1},RuleMax:{default:1,format:"number",propertyOrder:7,title:"Rule Max",type:"number"},RuleMin:{default:0,format:"number",propertyOrder:6,title:"Rule Min",type:"number"}}),title:"Gradient"},{options:{additionalProperties:!1,linked_oneof_property:{property:"RuleType",value:"iterative"}},properties:{RuleName:{default:"",propertyOrder:1,title:"Rule Name",type:"string"},RuleSource:{default:"",enumSource:"possible_cols",options:{hidden:!0},propertyOrder:3,title:"Rule Source",type:"string",watch:{possible_cols:"arrItem._Hidden._PossibleColumnsWithItself"}},RuleTarget:{data:"possible_columns",default:"*",options:{hidden:!0},propertyOrder:2,title:"Rule Target",type:"customDropdown",watch:{possible_columns:"arrItem._Hidden._PossibleColumns"}},RuleType:{options:{hidden:!0},propertyOrder:4,title:"Rule Type",type:"string"},Show:{default:!1,format:"checkbox",propertyOrder:5,title:"Show Rule in Legend",type:"boolean"},Palette:{default:[{type:"#cc6677"},{type:"#ddcc77"},{type:"#117733"}],format:"table",items:{properties:{type:{default:"#ffa500",options:{gradient:!1},title:"color",type:"gradient"}},title:"Palette Colour",type:"object"},options:{collapsed:!0},propertyOrder:8,title:"Color Palette",type:"array",uniqueItems:!1}},title:"Iterative"}],title:"Iterative Highlight",type:"object"},options:{collapsed:!0},title:"Highlight Rules",type:"array"},Actions:{fields:{map:_.extend({Current:{enumSource:"possible_columns",propertyOrder:10,title:"Source Column",type:"string",watch:{possible_columns:"arrItem._Hidden._PossibleColumnsWithXYKey"}}},c),nav:c,query:c,url:c},options:{collapsed:!0},type:"actions"},Labels:{options:{collapsed:!0},properties:{Align:{default:"center",enum:["center","start","end","right","bottom","left","top","iterative"],propertyOrder:4,type:"string"},Anchor:{default:"center",enum:["center","start","end","iterative"],propertyOrder:5,type:"string"},Color:{default:"#000",options:{gradient:!1,noColor:!1},propertyOrder:2,title:"Label Color",type:"gradient"},Enabled:{default:!1,format:"checkbox",propertyOrder:1,type:"boolean"},ShowOverlap:{default:!1,format:"checkbox",propertyOrder:8,title:"Show Overlap",type:"boolean"},Font:{properties:{Bold:{default:!1,format:"checkbox",type:"boolean"},Size:{default:12,minimum:1,type:"number"}},propertyOrder:8,type:"object"},Frequency:{default:1,minimum:1,propertyOrder:3,title:"Label Freq",type:"number"},Offset:{default:"0",propertyOrder:6,type:"string"},Rotation:{default:0,propertyOrder:7,type:"number"},Template:{default:"{{x}}, {{toFixed y 2}}",propertyOrder:7,templateItems:{values:{items:_.keyBy(["x","y","r"]),type:"object"}},title:"Label Template",type:"tooltipTemplate"}},type:"object"}},x={properties:{Animations:{options:{collapsed:!0},properties:{Duration:{default:void 0,format:"number",propertyOrder:5,type:"number"},Easing:{default:void 0,enum:["linear","easeInQuad","easeOutQuad","easeInOutQuad","easeInCubic","easeOutCubic","easeInOutCubic","easeInQuart","easeOutQuart","easeInOutQuart","easeInQuint","easeOutQuint","easeInOutQuint","easeInSine","easeOutSine","easeInOutSine","easeInExpo","easeOutExpo","easeInOutExpo","easeInCirc","easeOutCirc","easeInOutCirc","easeInElastic","easeOutElastic","easeInOutElastic","easeInBack","easeOutBack","easeInOutBack","easeInBounce","easeOutBounce","easeInOutBounce"],propertyOrder:4,type:"string"},Enabled:{default:!1,format:"checkbox",propertyOrder:1,type:"boolean"},HoverEvents:{default:!0,format:"checkbox",propertyOrder:2,type:"boolean"},InteractionMode:{default:"x",enum:["x","y","point","dataset"],propertyOrder:3,title:"Interaction Mode",type:"string"}},propertyOrder:300,type:"object"},Basics:{options:{collapsed:!0},properties:{Name:{default:"",propertyOrder:1,type:"string"},Focus:{default:"",propertyOrder:2,type:"string"},Hover:{default:"",propertyOrder:3,type:"string"},Selected:{default:"",propertyOrder:1,type:"string"},Transpose:{default:!1,format:"checkbox",propertyOrder:4,type:"boolean"},SortBy:{default:"index",propertyOrder:5,type:"string",title:"Sort by",enum:["index","x"]},WarningOnNoData:{default:!1,format:"checkbox",title:"Show Error when no Data",propertyOrder:6,type:"boolean"},UsePatterns:{default:!1,format:"checkbox",title:"Add Patterns to Bars",propertyOrder:7,type:"boolean"}},propertyOrder:100,type:"object"},Layers:{_paste:function(e,t,a){function i(e){return _.get(e,"_Hidden._LayerId")&&_.set(e,"_Hidden._LayerId",_.uniqueId("layer_")),e}a(_.isArray(e)?_.map(e,i):i(e))},items:{additionalProperties:!1,headerTemplate:"{{#if self.Basics.Name}}{{valueProp self.Basics.Name }}{{else}}Layer {{ i1 }}{{/if}}",id:"arrItem",oneOf:[{options:{linked_oneof_property:{property:"_Hidden._Type",value:"Line"}},properties:_.merge({},p,{Axes:{properties:{YAxisData:{data:"possible_columns",default:"",title:"Y-Axis Data",type:"customDropdown",watch:{possible_columns:"arrItem._Hidden._PossibleColumns"}}}},Interpolation:{options:{collapsed:!0},properties:{Interpolation:{default:"Linear",enum:["Linear","Cubic","Monotone","Stepped"],type:"string"},LineTension:{default:0,format:"range",maximum:10,minimum:0,type:"number"},SteppedLine:{default:"after",enum:["before","after"],type:"string"}},propertyOrder:30,type:"object"},Line:{options:{collapsed:!0},properties:{DashGap:{default:0,format:"number",propertyOrder:6,title:"Dash Gap",type:"number"},DashWidth:{default:0,format:"number",propertyOrder:5,title:"Dash Width",type:"number"},FadeToTransparent:{default:!1,format:"checkbox",propertyOrder:4,title:"Fade to Transparent",type:"boolean"},Fill:{default:"nofill",enumSource:"possible_layers",propertyOrder:3,type:"string",watch:{possible_layers:"arrItem._Hidden._PossibleLayers"}},ShowLine:{default:!0,format:"checkbox",propertyOrder:2,type:"boolean"},SpanGaps:{default:!1,format:"checkbox",propertyOrder:1,type:"boolean"}},propertyOrder:40,type:"object"},Points:{options:{collapsed:!0},properties:_.merge({},b.backgroundFactory("Point"),b.borderFactory("Point"),b.radiusFactory("Point"),{PointStyle:{default:"circle",enum:["circle","cross","crossRot","dash","line","rect","rectRounded","rectRot","star","triangle","downTriangle"],title:"Style",type:"string"}},b.radiusFactory("PointHit"),b.backgroundFactory("PointHover"),b.borderFactory("PointHover"),b.radiusFactory("PointHover")),propertyOrder:50,type:"object"},_Hidden:{properties:_.merge({},b.typeFactory("Line"),{_PossibleLayers:{options:{hidden:!0},type:"array"}})}}),title:"Line"},{options:{linked_oneof_property:{property:"_Hidden._Type",value:"Bar"}},properties:_.merge({},p,{Axes:{properties:{YAxisData:{data:"possible_columns",default:"",title:"Y-Axis Data",type:"customDropdown",watch:{possible_columns:"arrItem._Hidden._PossibleColumns"}}}},Bars:{options:{collapsed:!0},properties:_.merge({BarPercentage:{default:90,format:"range",maximum:100,minimum:0,title:"Bar Percentage",type:"number"},BarThickness:{default:10,title:"Bar Thickness",type:"number"},BarWidthType:{default:"percentage",enum:["percentage","manual bar thickness"],title:"Bar Width type",type:"string"},CategoryPercentage:{default:80,format:"range",maximum:100,minimum:0,title:"Category Percentage",type:"number"},MaxBarThickness:{default:10,title:"Max Bar Thickness",type:"number"}},b.backgroundFactory("Hover"),b.borderFactory("Hover")),propertyOrder:30,type:"object"},_Hidden:{properties:b.typeFactory("Bar")}}),title:"Bar"},{options:{linked_oneof_property:{property:"_Hidden._Type",value:"Bubble"}},properties:_.merge({},p,{Axes:{properties:{Radius:{default:"Fixed Size",enumSource:"possible_radius",title:"Radius Data",type:"string",watch:{possible_radius:"arrItem._Hidden._PossibleRadius"}},RadiusScaling:{default:1,format:"number",title:"Radius Scaling",type:"number"},YAxisData:{data:"possible_columns",default:"",title:"Y-Axis Data",type:"customDropdown",watch:{possible_columns:"arrItem._Hidden._PossibleColumns"}}}},Bubbles:{options:{collapsed:!0},properties:_.merge({},b.backgroundFactory("Hover"),b.borderFactory("Hover"),b.radiusFactory("Hover"),{Icons:{default:"",title:"Icon Override",type:"icon"},PointStyle:{default:"circle",enum:["circle","cross","crossRot","dash","line","rect","rectRounded","rectRot","star","triangle","downTriangle"],type:"string"},SetIconFromData:{title:"Set Icon from Data",type:"boolean",default:!1},DataIcon:{title:"Icon",type:"dropdown",default:"",data:"possible_columns",watch:{possible_columns:"arrItem._Hidden._PossibleColumnsWithEmptyKey"}},DataIconColor:{title:"Icon Color",type:"dropdown",default:"",data:"possible_columns",watch:{possible_columns:"arrItem._Hidden._PossibleColumnsWithEmptyKey"}}}),propertyOrder:30,type:"object"},_Hidden:{properties:b.typeFactory("Bubble")}}),title:"Bubble"},{options:{linked_oneof_property:{property:"_Hidden._Type",value:"BoxPlot"}},properties:_.merge({},p,{Axes:{properties:{Max:{enumSource:"possible_columns",propertyOrder:5,title:"Max",type:"string",watch:{possible_columns:"arrItem._Hidden._PossibleColumns"}},Median:{enumSource:"possible_columns",propertyOrder:3,title:"Median",type:"string",watch:{possible_columns:"arrItem._Hidden._PossibleColumns"}},Min:{enumSource:"possible_columns",propertyOrder:1,title:"Min",type:"string",watch:{possible_columns:"arrItem._Hidden._PossibleColumns"}},Q1:{enumSource:"possible_columns",propertyOrder:2,title:"Q1",type:"string",watch:{possible_columns:"arrItem._Hidden._PossibleColumns"}},Q3:{enumSource:"possible_columns",propertyOrder:4,title:"Q3",type:"string",watch:{possible_columns:"arrItem._Hidden._PossibleColumns"}},Outliers:{enumSource:"possible_columns",propertyOrder:10,title:"Outliers",type:"string",watch:{possible_columns:"arrItem._Hidden._PossibleColumns"}}}},BoxPlot:{options:{collapsed:!0},properties:_.merge({},{BarPercentage:{default:90,format:"range",maximum:100,minimum:0,title:"Bar Percentage",type:"number"},BarThickness:{default:10,title:"Bar Thickness",type:"number"},BarWidthType:{default:"percentage",enum:["percentage","manual bar thickness"],title:"Bar Width type",type:"string"},CategoryPercentage:{default:80,format:"range",maximum:100,minimum:0,title:"Category Percentage",type:"number"},MaxBarThickness:{default:10,title:"Max Bar Thickness",type:"number"}},b.backgroundFactory("Hover"),b.borderFactory("Hover")),propertyOrder:30,type:"object"},_Hidden:{properties:b.typeFactory("BoxPlot")}}),title:"BoxPlot"},{options:{linked_oneof_property:{property:"_Hidden._Type",value:"Violin"}},properties:_.merge({},p,{_Hidden:{properties:b.typeFactory("Violin")},Violin:{options:{collapsed:!0},properties:_.merge({BarPercentage:{default:90,format:"range",maximum:100,minimum:0,title:"Bar Percentage",type:"number"},BarThickness:{default:10,title:"Bar Thickness",type:"number"},BarWidthType:{default:"percentage",enum:["percentage","manual bar thickness"],title:"Bar Width type",type:"string"},CategoryPercentage:{default:80,format:"range",maximum:100,minimum:0,title:"Category Percentage",type:"number"},MaxBarThickness:{default:10,title:"Max Bar Thickness",type:"number"}},b.backgroundFactory("Hover"),b.borderFactory("Hover")),propertyOrder:30,type:"object"},Axes:{properties:{Coords:{enumSource:"possible_columns",title:"Coordinates",type:"string",watch:{possible_columns:"arrItem._Hidden._PossibleColumns"}}}}}),title:"Violin"},{options:{linked_oneof_property:{property:"_Hidden._Type",value:"Waterfall"}},properties:_.merge({},p,{_Hidden:{properties:b.typeFactory("Waterfall")},Axes:{properties:{YAxisData:{data:"possible_columns",default:"",title:"Y-Axis Data",type:"customDropdown",watch:{possible_columns:"arrItem._Hidden._PossibleColumns"}}}},Waterfall:{options:{collapsed:!0},properties:_.merge({BarPercentage:{default:90,format:"range",maximum:100,minimum:0,title:"Bar Percentage",type:"number"},BarThickness:{default:10,title:"Bar Thickness",type:"number"},BarWidthType:{default:"percentage",enum:["percentage","manual bar thickness"],title:"Bar Width type",type:"string"},CategoryPercentage:{default:80,format:"range",maximum:100,minimum:0,title:"Category Percentage",type:"number"},MaxBarThickness:{default:10,title:"Max Bar Thickness",type:"number"},IncreaseColor:{default:"#7ad16f",options:{gradient:!1},title:"Increase Color",type:"gradient"},DecreaseColor:{default:"#d1776f",options:{gradient:!1},title:"Decrease Color",type:"gradient"}},b.backgroundFactory("Hover"),b.borderFactory("Hover")),propertyOrder:30,type:"object"}}),title:"Waterfall"},{options:{linked_oneof_property:{property:"_Hidden._Type",value:"Candlestick"}},properties:_.merge({},p,{_Hidden:{properties:b.typeFactory("Candlestick")},Candlestick:{options:{collapsed:!0},properties:{OHLC:{default:!1,format:"checkbox",title:"Use OHLC",type:"boolean"},BearColor:{default:"rgb(255,0,0)",options:{gradient:!1},title:"Bear Color",type:"gradient"},BullColor:{default:"rgb(0,255,0)",options:{gradient:!1},title:"Bull Color",type:"gradient"},NeutralColor:{default:"rgb(255,255,255)",options:{gradient:!1},title:"Neutral Color",type:"gradient"},BarPercentage:{default:90,format:"range",maximum:100,minimum:0,title:"Bar Percentage",type:"number"},BarThickness:{default:10,title:"Bar Thickness",type:"number"},BarWidthType:{default:"percentage",enum:["percentage","manual bar thickness"],title:"Bar Width type",type:"string"},CategoryPercentage:{default:80,format:"range",maximum:100,minimum:0,title:"Category Percentage",type:"number"},MaxBarThickness:{default:10,title:"Max Bar Thickness",type:"number"}},propertyOrder:30,type:"object"},Axes:{properties:{Close:{enumSource:"possible_columns",propertyOrder:2,title:"Close",type:"string",watch:{possible_columns:"arrItem._Hidden._PossibleColumns"}},High:{enumSource:"possible_columns",propertyOrder:4,title:"High",type:"string",watch:{possible_columns:"arrItem._Hidden._PossibleColumns"}},Low:{enumSource:"possible_columns",propertyOrder:3,title:"Low",type:"string",watch:{possible_columns:"arrItem._Hidden._PossibleColumns"}},Open:{enumSource:"possible_columns",propertyOrder:1,title:"Open",type:"string",watch:{possible_columns:"arrItem._Hidden._PossibleColumns"}}}}}),title:"Candlestick"}],options:{hidden:void 0,collapsed:!0,keep_oneof_values:!0},title:"Layer",type:"object"},propertyOrder:200,type:"array"},Overlay:{options:{collapsed:!0},properties:{CrosshairsColor:{default:"#F8F8F8",options:{gradient:!1,noColor:!1},propertyOrder:321,title:"Crosshairs Color",type:"gradient"},CrosshairsEnabled:{default:!0,format:"checkbox",propertyOrder:311,title:"Show Crosshairs",type:"boolean"},EdgeAlign:{default:!1,format:"checkbox",propertyOrder:317,title:"Align Tooltip with Edge",type:"boolean"},Offset:{default:7,minimum:0,propertyOrder:318,title:"Tooltip Offset",type:"number"},PreferIntersect:{default:!1,format:"checkbox",propertyOrder:314,title:"Prefer Intersect",type:"boolean"},TooltipBGOpacity:{default:80,format:"range",maximum:100,minimum:0,propertyOrder:315,title:"Tooltip Background Opacity",type:"number"},TooltipFontSize:{default:12,maximum:100,minimum:0,propertyOrder:316,title:"Tooltip Font Size",type:"number"},TooltipsEnabled:{default:!0,format:"checkbox",propertyOrder:312,title:"Show Tooltip",type:"boolean"},TooltipsIntersect:{default:!1,format:"checkbox",propertyOrder:313,title:"Tooltips Intersect",type:"boolean"},customTooltip:{data:["series","values"],default:"<table><thead><tr style='padding-right: 10px;'> <th>{{ xLabel }} </th><th> </th > </tr></thead > {{#each points }}<tr><td><svg height='12' width = '12' > <rect style='fill:{{colors.backgroundColor}};stroke-width:3;stroke:{{colors.borderColor}}' height = '12' width = '12' > </rect></svg > {{ layerName }}: </td><td style='padding-right: 10px; text-align: left;'>{{layerData}}</td > </tr>{{/each}}</table>",propertyOrder:320,templateItems:{points:{items:{colors:{backgroundColor:"backgroundColor",borderColor:"borderColor"},cols:null,isLayerEnabled:"isLayerEnabled",layerData:"layerData",layerDataFormatted:"layerDataFormatted",layerName:"layerName"},type:"array"}},title:"Custom tooltip",type:"tooltipTemplate"},useCustomTooltip:{default:!1,format:"checkbox",propertyOrder:319,title:"Use Custom Tooltip",type:"boolean"}},propertyOrder:310,type:"object"},Zoom:{options:{collapsed:!0},properties:{DefaultMax:{default:"",propertyOrder:10,title:"Default Max  Viewstate",type:"viewstate"},DefaultMin:{default:"",propertyOrder:9,title:"Default Min Viewstate",type:"viewstate"},DragPan:{default:!0,format:"checkbox",propertyOrder:3,title:"Pan",type:"boolean"},DragZoom:{default:!0,format:"checkbox",propertyOrder:2,title:"Drag Zoom",type:"boolean"},FillColor:{default:"#898989",options:{gradient:!1},propertyOrder:5,title:"Fill Colour",type:"gradient"},FillOpacity:{default:60,format:"range",maximum:100,minimum:0,propertyOrder:6,title:"Fill Opacity",type:"number"},Max:{default:"",propertyOrder:8,title:"Max Viewstate",type:"viewstate"},Min:{default:"",propertyOrder:7,title:"Min Viewstate",type:"viewstate"},ResetViewStateOnly:{default:!1,format:"checkbox",propertyOrder:4,title:"Reset Viewstates Only",type:"boolean"},ScrollZoom:{default:!0,format:"checkbox",propertyOrder:1,title:"Scroll Zoom",type:"boolean"},ViewstateUpdateDelay:{default:1,maximum:10,minimum:0,propertyOrder:11,title:"Viewstate Update Delay (s)",type:"number"},YAdjust:{default:"none",enum:["none","nice","min/max"],title:"Rounding for Y-axis",type:"string"},ZoomStack:{default:"",options:{hidden:!0},title:"Zoom Stack",type:"string"},ZoomToIndex:{default:!0,format:"checkbox",title:"Snap to Data",type:"boolean"}},propertyOrder:312,title:"Zoom & Pan",type:"object"},Legend:{options:{collapsed:!0},properties:{Display:{default:!0,format:"checkbox",position:1,type:"boolean"},Position:{default:"top",enum:["top","top-inline","bottom","left","right"],position:2,type:"string"},BoxWidth:{default:12,position:4,title:"Icon Width",type:"number"},Padding:{default:10,position:5,title:"Icon Padding",type:"number"},FullWidth:{default:!0,format:"checkbox",options:{hidden:!0},position:2,title:"Full Width",type:"boolean"},LabelFontFamily:{default:"Helvetica",enum:["Helvetica","Arial","Times New Roman","Times","Courier New","Courier","Verdana","Georgia","Palatino","Garamond","Comic Sans MS"],options:{hidden:!0},position:6,title:"Label Font Family",type:"string"},LabelFontSize:{default:12,position:6,title:"Label Font Size",type:"number"},LabelColor:{default:"#898989",options:{gradient:!1},position:7,title:"Label Colour",type:"gradient"},Align:{default:"center",enum:["start","center","end"],position:8,title:"Align",type:"string"},LegendScroll:{default:"default",enum:["default","scroll","layer group","layer new line"],position:9,title:"Legend Display Type",type:"string"},LegendLayerThreshold:{default:5,position:10,title:"New Layer Threshold",type:"number"},Reverse:{default:!1,format:"checkbox",position:11,title:"Reverse Order",type:"boolean"},UsePointStyle:{default:!0,format:"checkbox",position:12,title:"Use Point Style",type:"boolean"}},propertyOrder:312,type:"object"},XAxes:u.factory("XAxes",210),YAxes:u.factory("YAxes",220),possiblePalettes:{type:"array",format:"table",options:{collapsed:!0,hidden:!0}},Style:{options:{collapsed:!0},properties:{palettes:{default:"",title:"Palette Theme",type:"string",enumSource:"possible_palettes",propertyOrder:1,watch:{possible_palettes:"root.possiblePalettes"}},Palette:{default:[{type:"#0061FF"},{type:"#F23A66"},{type:"#009BAB"},{type:"#7647CC"},{type:"#FFC300"},{type:"#9FA3A6"},{type:"#003A99"},{type:"#A90B31"},{type:"#005D67"},{type:"#452481"}],format:"table",items:{properties:{type:{default:"#ffa500",options:{gradient:!1},title:"color",type:"gradient"}},title:"Palette Colour",type:"object"},options:{collapsed:!1},propertyOrder:2,title:"Color Palette",type:"array",uniqueItems:!1}},propertyOrder:313,title:"Style",type:"object"},FileExport:{options:{collapsed:!0},properties:{FileName:{format:"table",items:{options:{collapsed:!0},properties:{FileNamePart:{title:"FileName Part",type:"string"}},title:"Filename Part",type:"object"},options:{collapsed:!0,hidden:!1},title:"FileName",type:"array"},ShowExportCsvButton:{default:!1,format:"checkbox",title:"Show Export Csv Button",type:"boolean"},ShowExportExcelButton:{default:!1,format:"checkbox",title:"Show Export Excel Button",type:"boolean"},ShowScreenshot:{default:!1,format:"checkbox",title:"Show Screenshot Button",type:"boolean"},ScreenshotButton:{default:"Export Png",enum:["Export Png","Copy to Clipboard","Export Png & Copy to Clipboard"],title:"Screenshot Button",type:"string"},Actions:{type:"array",format:"table",title:"Actions",options:{collapsed:!0},items:{type:"object",title:"Action",options:{collapsed:!0},properties:{EventType:{title:"Event Type",type:"string",default:"all",enum:["all","onSuccess","onFail"]},Result:{title:"Last Result",type:"string",default:""}}}}},propertyOrder:320,title:"File Export",type:"object"}},title:"properties",type:"object"},v=(S.mergeArray=function(e,l,d){var c=[];return _.each(e,function(e,n){var s=e._Hidden._Type;_.each(e,function(e,t){var a;if(void 0===c[n]?c.push(_.merge({},l[d][s])):_.get(c[n],"_Hidden")&&_.get(c[n],"_Hidden._Type")&&s!==_.get(c[n],"_Hidden._Type")&&"Layers"!==d&&(c[n]=_.merge({},l[d][s])),c[n][t]&&!e._dashboardsType&&"object"==typeof(a=c[n][t])&&"object"==typeof e&&0<Object.keys(e).length?_.each(e,function(e,t){a[t]=e}):c[n][t]=e,"object"==typeof c[n][t])for(var i=Object.keys(c[n][t]),o=0;o<i.length;o++){var r=i[o];void 0!==c[n][t][r]&&null!==c[n][t][r]||delete c[n][t][r]}})}),c},S.mergeDictionary=function(a,i,o){"string"!=typeof i&&_.each(i,function(e,t){void 0===a[o]?a[o]=i:void 0===a[o][t]||"object"!=typeof e||e._dashboardsType||e instanceof r.Model?a[o][t]=e:a[o][t]="Palette"===t?S.mergeObject(a[o][t],e):S.mergeJSON(a[o][t],e,!0)})},S.getJSONTemplateFromSchema=function(e,t){var e=e.properties[t],a={};return _.each(e.items.oneOf,function(e){var i={};_.each(e.properties,function(e,t){var a;e.properties?(i[t]={},a={},_.each(e.properties,function(e,t){void 0!==e.default&&(a[t]=e.default)}),i[t]=a):"array"===e.type||"actions"===e.type?i[t]=[]:"object"===e.type&&(i[t]={})}),a[e.title]=i}),a},S.appendCommonAxesProps=function(e,t){var a={Display:!0,FontColor:"#FFFFFF",FontFamily:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",FontOpacity:100,FontSize:12,FontStyle:"normal",MaxRotation:360,MinRotation:0,StepSize:0},i={Center:"",Display:!0,Labels:_.extend({},a,{Format:"General",HideTrailingZeroes:!1,Precision:2,Prefix:"",Suffix:""}),Position:"XAxes"===t?"bottom":"left",Stacked:!1},o={Center:"",Display:!0,Labels:a,Position:"XAxes"===t?"bottom":"left",Stacked:!1};return"XAxes"===t?i.Labels.FilterUnique=!1:"YAxes"===t&&(i.Labels.BeginAtZero=!0,i.Labels.Reverse=!1),_.each(e,function(e,t){S.mergeJSON(e,"time"===t?o:i,!1)}),e},S.mergeJSON=function(e,t,a){return a?_.extend(void 0===e?{}:e,void 0===t?{}:_.filter(t,function(e){return!_.isEqual(e,{})})):_.extend(void 0===e?{}:e,void 0===t?{}:t)},S.mergeObject=function(e,t){return _.mergeWith({},e,t,function(e,t){return _.isNull(t)?e:t})},S);function S(){}C.getComponentDefinition=function(e){var t,a,i={appArgs:{json:this.getDefaultJSON(),schema:x,quickStart:[{path:"Layers.0.Basics.Data",message:"populate Data Source"}]},componentDescription:"",componentName:"ChartJS",id:1};if(0<_.keys(e.settingsModel.attributes).length)for(a=C.upgrades.indexOf(_.find(C.upgrades,{version:e.settingsModel.get("version")}))+1;a<C.upgrades.length;a+=1)(t=C.upgrades[a]).fn(e.settingsModel),e.settingsModel.set("version",t.version);return i},C.getDefaultJSON=function(){var e=v.getJSONTemplateFromSchema(x,"XAxes"),t=v.getJSONTemplateFromSchema(x,"YAxes"),e=v.appendCommonAxesProps(e,"XAxes"),t=v.appendCommonAxesProps(t,"YAxes");return{Alignment:{innerPaddingBottom:0,innerPaddingLeft:0,innerPaddingRight:0,innerPaddingTop:0,paddingBottom:0,paddingLeft:0,paddingRight:0,paddingTop:0,titlePaddingBottom:7,titlePaddingLeft:0,titlePaddingRight:0,titlePaddingTop:7},Animations:{Enabled:!1,HoverEvents:!0,InteractionMode:"x"},Basics:{Name:"",Focus:"",Hover:"",Selected:"",Transpose:!1,SortBy:"index",WarningOnNoData:!1,UsePatterns:!1},FileExport:{FileName:[],ShowExportCsvButton:!1,ShowExportExcelButton:!1,ShowScreenshot:!1,ScreenshotButton:"Export Png",Actions:[]},Layers:[{_Hidden:{_Index:0,_LayerId:"layer_8977",_PossibleColumns:[],_PossibleColumnsWithItself:[],_PossibleColumnsWithXYKey:[],_PossibleRadius:[],_PossibleXAxes:["XAxis 1"],_PossibleYAxes:["YAxis 1"],_Type:"Line",_PossibleLayers:["nofill","origin"]},Actions:[],Axes:{XAxisData:"",XAxisID:"XAxis 1",YAxisData:"",YAxisID:"YAxis 1"},Basics:{Data:"",BackgroundColor:"#0061FF",BackgroundOpacity:80,BorderColor:"#0061FF",BorderOpacity:80,BorderWidth:0,Enabled:!0,LegendEnabled:!0,LegendLabelColor:"",Name:"Layer 1"},HighlightRules:[],Interpolation:{Interpolation:"Linear",LineTension:0,SteppedLine:"after"},Labels:{Align:"center",Anchor:"center",Color:"#000",Enabled:!1,Font:{Bold:!1,Size:12},Frequency:1,Offset:"0",Rotation:0,Template:"{{x}}, {{toFixed y 2}}"},Line:{DashGap:0,DashWidth:0,FadeToTransparent:!1,Fill:"nofill",ShowLine:!0,SpanGaps:!1},Points:{PointBackgroundColor:"#0061FF",PointBackgroundOpacity:80,PointBorderColor:"#0061FF",PointBorderOpacity:80,PointBorderWidth:0,PointHitRadius:0,PointHoverBackgroundColor:"#0061FF",PointHoverBackgroundOpacity:80,PointHoverBorderColor:"#0061FF",PointHoverBorderOpacity:80,PointHoverBorderWidth:0,PointHoverRadius:0,PointRadius:0,PointStyle:"circle"}}],Legend:{Align:"center",BoxWidth:12,Display:!0,FullWidth:!0,LabelColor:"#F8F8F8",LabelFontFamily:"Helvetica",LabelFontSize:12,LegendScroll:"default",Padding:10,Position:"top-inline",Reverse:!1,UsePointStyle:!0},Overlay:{CrosshairsColor:"#F8F8F8",CrosshairsEnabled:!0,EdgeAlign:!1,Offset:7,PreferIntersect:!1,TooltipBGOpacity:80,TooltipFontSize:12,TooltipsEnabled:!0,TooltipsIntersect:!1,customTooltip:'<table><thead><tr style="padding-right: 10px;"><th>{{ xLabel }} </th><th> </th> </tr></thead><tbody>{{#each points }}{{#if isLayerEnabled}}<tr> <td>{{{svg}}} {{ layerName }}: </td><td style="padding-right: 10px; text-align: left;">{{layerData}}</td></tr>{{/if}}{{/each}}</tbody></table>',useCustomTooltip:!1},Style:{palettes:[],Palette:[{type:"#0061FF"},{type:"#F23A66"},{type:"#009BAB"},{type:"#7647CC"},{type:"#FFC300"},{type:"#9FA3A6"},{type:"#003A99"},{type:"#A90B31"},{type:"#005D67"},{type:"#452481"}]},XAxes:[e.category],YAxes:[t.linear],Zoom:{DefaultMax:"",DefaultMin:"",DragPan:!0,DragZoom:!0,FillColor:"#898989",FillOpacity:50,Max:"",Min:"",ResetViewStateOnly:!1,ScrollZoom:!0,ViewstateUpdateDelay:1,YAdjust:"None",ZoomStack:"",ZoomToIndex:!0},format:{tileBackgroundColor:"#000000",tileBorderColor:"#000000",tileBorderRounding:0,tileBorderWidth:0,tileShadow:!1,tileTransparentBackground:!0,titleBackgroundColor:"",titleBottomBorderWidth:0,titleColor:"",titleFontBold:"",titleFontSize:16,titleHorizontal:"Center",titleShadow:!1,titleTransparentBackground:"",widgetTitle:""},version:"v2.11.0"}},C.getDefaultJSONTemplates=function(){var e=v.getJSONTemplateFromSchema(x,"XAxes"),t=v.getJSONTemplateFromSchema(x,"YAxes"),e=v.appendCommonAxesProps(e,"XAxes"),t=v.appendCommonAxesProps(t,"YAxes");return{Defaults:this.getDefaultJSON(),Layers:v.getJSONTemplateFromSchema(x,"Layers"),XAxes:e,YAxes:t}},C.mergeWithDefault=function(e){var a=this.getDefaultJSONTemplates(),t=_.extend({},e),i=_.extend({},a.Defaults);return delete i.version,_.each(e.attributes,function(e,t){_.isArray(e)?"Layers"!==t&&"XAxes"!==t&&"YAxes"!==t||(i[t]=v.mergeArray(_.extend({},e),a,t)):v.mergeDictionary(i,e,t)}),t.set(i,{silent:!0}),t};c=C;function C(){}c.upgrades=[{fn:function(e){var t=e.get("Basics"),t=(t.Selected=void 0===t.Selected?"":t.Selected,t.Focus=void 0===t.Focus?"":t.Focus,e.set("Basics",t),e.get("XAxes").concat(e.get("YAxes"))),a=(t.forEach(function(e){e.Labels=e.Labels||{},e.Labels.Format="General",e.Labels.Precision=2,e.Labels.DateFormat="YYYY-MM-DD",e.Labels.HideTrailingZeroes=!1,e.Position=e.Position||""}),void 0===e.get("Zoom")&&e.set("Zoom",{Enabled:!1,FillColor:"#898989",FillOpacity:50,Max:"",Min:"",ResetViewStateOnly:!1}),_.each(e.get("Layers"),function(e){e.HighlightRules||(e.HighlightRules=[])}),void 0===e.get("Legend")&&e.set("Legend",{BoxWidth:12,Display:!0,FullWidth:!0,LabelColor:"#F8F8F8",LabelFontFamily:"Helvetica Neue",LabelFontSize:12,LegendScroll:"default",Padding:10,Position:"top",Reverse:!1,UsePointStyle:!0}),t.forEach(function(e){"time"===e._Hidden._Type&&(e.Labels.TimeFormats.Distribution=void 0===e.Labels.TimeFormats.Distribution?"linear":e.Labels.TimeFormats.Distribution,e.Labels.TimeFormats.Year=void 0===e.Labels.TimeFormats.Year?"YYYY":e.Labels.TimeFormats.Year,e.Labels.TimeFormats.Quarter=void 0===e.Labels.TimeFormats.Quarter?"[Q]Q - YYYY":e.Labels.TimeFormats.Quarter,e.Labels.TimeFormats.Month=void 0===e.Labels.TimeFormats.Month?"MMM YYYY":e.Labels.TimeFormats.Month,e.Labels.TimeFormats.Week=void 0===e.Labels.TimeFormats.Week?"ll":e.Labels.TimeFormats.Week,e.Labels.TimeFormats.Day=void 0===e.Labels.TimeFormats.Day?"MMM D":e.Labels.TimeFormats.Day,e.Labels.TimeFormats.Hour=void 0===e.Labels.TimeFormats.Hour?"hA":e.Labels.TimeFormats.Hour,e.Labels.TimeFormats.Minute=void 0===e.Labels.TimeFormats.Minute?"h:mm a":e.Labels.TimeFormats.Minute,e.Labels.TimeFormats.Second=void 0===e.Labels.TimeFormats.Second?"h:mm:ss a":e.Labels.TimeFormats.Second,e.Labels.TimeFormats.Millisecond=void 0===e.Labels.TimeFormats.Millisecond?"h:mm:ss.SSS a":e.Labels.TimeFormats.Millisecond,e.Labels.TimeFormats.TooltipFormat=void 0===e.Labels.TimeFormats.TooltipFormat?"":e.Labels.TimeFormats.TooltipFormat,e.Labels.TimeFormats.IsoWeekday=void 0!==e.Labels.TimeFormats.IsoWeekday&&e.Labels.TimeFormats.IsoWeekday,e.Labels.TimeFormats.Unit=void 0===e.Labels.TimeFormats.Unit?"":e.Labels.TimeFormats.Unit,e.Labels.TimeFormats.Round=void 0!==e.Labels.TimeFormats.Round&&e.Labels.TimeFormats.Round),e.Labels.Prefix=void 0===e.Labels.Prefix?"":e.Labels.Prefix,e.Labels.Suffix=void 0===e.Labels.Suffix?"":e.Labels.Suffix,e.Labels.StepSize=void 0===e.Labels.StepSize?0:e.Labels.StepSize,e.Labels=_.omit(e.Labels,["TimeFormat"])}),e.get("Overlay")),i=(a.CrosshairsEnabled=void 0===a.CrosshairsEnabled||a.CrosshairsEnabled,a.CrosshairsColor=void 0===a.CrosshairsColor?"#F8F8F8":a.CrosshairsColor,a.TooltipsEnabled=void 0===a.TooltipsEnabled||a.TooltipsEnabled,e.set("Overlay",a),e.unset("Tooltips"),e.get("FileExport")),i=(void 0===i?(e.set("FileExport.ShowExportCsvButton",!1),e.set("FileExport.ShowExportExcelButton",!1),e.set("FileExport.FileName",[])):e.set("FileExport",i),void 0===i.ShowScreenshot?e.set("FileExport.ShowScreenshot",!1):e.set("FileExport",i),void 0===e.get("Overlay.customTooltip")&&e.set("Overlay.customTooltip",null),void 0===e.get("Basics.Hover")&&e.set("Basics.Hover",""),void 0===e.get("Style")&&e.set("Style",{Palette:[{type:"#0061FF"},{type:"#F23A66"},{type:"#009BAB"},{type:"#7647CC"},{type:"#FFC300"},{type:"#9FA3A6"},{type:"#003A99"},{type:"#A90B31"},{type:"#005D67"},{type:"#452481"}]}),void 0===e.get("Overlay.useCustomTooltip")&&e.set("Overlay.useCustomTooltip",!1),e.get("Zoom"));void 0===i.YAdjust&&e.set("Zoom.YAdjust","none");void 0===e.get("Zoom.ZoomToIndex")&&e.set("Zoom.ZoomToIndex",!0);var o=e.get("Layers").slice();e.set("Layers",o.reverse());e.get("XAxes").forEach(function(e){e.labels&&!e.Labels.FilterUnique&&(e.Labels.FilterUnique=!1)}),i=e.get("Zoom");o=e.get("Overlay");i.DragZoom=void 0===i.DragZoom?e.get("Zoom.Enabled"):i.DragZoom,i.ScrollZoom=void 0===i.ScrollZoom||i.ScrollZoom,i.DragPan=void 0===i.DragPan||i.DragZoom,i.ViewstateUpdateDelay=void 0===i.ViewstateUpdateDelay?1:i.ViewstateUpdateDelay,e.set("Zoom",i),delete i.Enabled,delete o.TooltipsMode,delete o.TooltipsPosition,(t=e.get("XAxes").concat(e.get("YAxes"))).forEach(function(e){e.Labels.MinRotation=void 0===e.Labels.MinRotation?0:e.Labels.MinRotation,e.Labels.MaxRotation=void 0===e.Labels.MaxRotation?360:e.Labels.MaxRotation}),(t=e.get("XAxes").concat(e.get("YAxes"))).forEach(function(e){e.Labels.MaxWidth=void 0===e.Labels.MaxWidth?0:e.Labels.MaxWidth}),e.get("Overlay.PreferIntersect")||e.set("Overlay.PreferIntersect",!1),(o=e.get("Overlay")).EdgeAlign=void 0!==a.EdgeAlign&&a.EdgeAlign,o.TooltipBGOpacity=void 0===a.TooltipBGOpacity?80:a.TooltipBGOpacity,o.TooltipFontSize=void 0!==a.TooltipFontSize&&a.TooltipFontSize,e.set("Overlay",o),_.each(e.get("Layers"),function(e){e.Basics.Enabled=!0})},version:"4.1.0"},{fn:function(e){var t=e.get("Zoom");void 0===t.DefaultMin&&e.set("Zoom.DefaultMin",""),void 0===t.DefaultMax&&e.set("Zoom.DefaultMax",""),e.unset("Zoom.FocusMin"),e.unset("Zoom.FocusMax")},version:"4.1.1"},{fn:function(e){e.get("XAxes").concat(e.get("YAxes")).forEach(function(e){e.Range&&(e.Range.UseMinMaxReset=void 0===e.Range.UseMinMaxReset||e.Range.UseMinMaxReset)}),void 0===e.get("Animations.HoverEvents")&&e.set("Animations.HoverEvents",!0),void 0===e.get("Overlay.Offset")&&e.set("Overlay.Offset",7);var t=e.get("Layers");_.each(t,function(e){e.Basics.LegendEnabled=!0}),e.set("Layers",t),e.get("Overlay").useCustomTooltip||e.set("Overlay.customTooltip","<table style='{{fontSize}}'><thead><tr style='padding-right: 10px;'> <th>{{ xLabel }} </th><th> </th > </tr></thead> {{#each points }}<tr><td>{{{svg}}} {{ layerName }}: </td><td style='padding-right: 10px; text-align: left;'>{{layerData}}</td > </tr>{{/each}}</table>"),t=e.get("Layers"),_.each(t,function(e){"Candlestick"===e._Hidden._Type&&(e.Basics.BorderWidth=1,e.Basics.BorderColor="#F8F8F8",e.Basics.BorderOpacity=100,delete e.Candlestick.BorderColor)}),e.set("Layers",t),t=e.get("Layers"),_.each(t,function(e){for(var t=0;t<e.HighlightRules.length;t++)e.HighlightRules[t].RuleTarget="*",e.HighlightRules[t].RuleType="discrete"}),e.set("Layers",t)},version:"4.2.0"},{fn:function(a){var e=a.get("Layers");_.each(e,function(e,t){var e=e.SelectedObjectRouting;e?(e=_.map(e,function(e){return{Current:e.ColumnProperty,Target:e.ViewstateProperty,Trigger:"Click",_Type:"map"}}),a.set("Layers.".concat(t,".Actions"),e)):a.set("Layers.".concat(t,".Actions"),[]),a.set("Layers.".concat(t,".SelectedObjectRouting"),void 0)})},version:"4.3.0"},{fn:function(e){e.get("Animations.Interactionmode")||e.set("Animations.InteractionMode","x")},version:"4.3.1"},{fn:function(o){var e=o.get("Layers"),r=o.get("XAxes.0.Bars"),n=["Bar","BoxPlot","Candlestick","Violin"];_.each(e,function(a){var e,i,t;"Line"===a._Hidden._Type&&(a.Line.DashWidth=void 0===a.Line.DashWidth?0:a.Line.DashWidth,a.Line.DashGap=void 0===a.Line.DashGap?0:a.Line.DashGap),"BoxPlot"===a._Hidden._Type&&(a.Axes.Outliers=void 0===a.Axes.Outliers?a.Axes.Median:a.Axes.Outliers),0<=_.indexOf(n,a._Hidden._Type)&&r&&(e="Bar"===a._Hidden._Type?"Bars":a._Hidden._Type,i=0,_.each(o.get("XAxes"),function(e,t){e._Hidden._Label===a.Axes.XAxisID&&(i=t)}),t=o.get("XAxes."+i+".Bars"),a[e].BarPercentage=void 0===t.BarPercentage?90:t.BarPercentage,a[e].BarThickness=void 0===t.BarThickness?10:t.BarThickness,a[e].BarWidthType=void 0===t.BarWidthType?"percentage":t.BarWidthType,a[e].CategoryPercentage=void 0===t.CategoryPercentage?80:t.CategoryPercentage,a[e].MaxBarThickness=void 0===t.MaxBarThickness?10:t.MaxBarThickness)}),o.set("Layers",e),_.each(o.get("XAxes"),function(e,t){o.unset("XAxes."+t+".Bars")}),_.each(o.get("YAxes"),function(e,t){o.unset("YAxes."+t+".Bars")})},version:"4.5.1.2"},{fn:function(e){var t=e.get("Overlay");"<table style='{{fontSize}}'><thead><tr style='padding-right: 10px;'> <th>{{ xLabel }} </th><th> </th > </tr></thead> {{#each points }}<tr><td>{{{svg}}} {{ layerName }}: </td><td style='padding-right: 10px; text-align: left;'>{{layerData}}</td > </tr>{{/each}}</table>"!==t.customTooltip&&"<table><thead><tr style='padding-right: 10px;'> <th>{{ xLabel }} </th><th> </th > </tr></thead > {{#each points }}<tr><td><svg height='12' width = '12' > <rect style='fill:{{colors.backgroundColor}};stroke-width:3;stroke:{{colors.borderColor}}' height = '12' width = '12' > </rect></svg > {{ layerName }}: </td><td style='padding-right: 10px; text-align: left;'>{{layerData}}</td > </tr>{{/each}}</table>"!==t.customTooltip||(t.customTooltip='<table><thead><tr style="padding-right: 10px;"><th>{{ xLabel }} </th><th> </th> </tr></thead><tbody>{{#each points }}{{#if isLayerEnabled}}<tr> <td>{{{svg}}} {{ layerName }}: </td><td style="padding-right: 10px; text-align: left;">{{layerData}}</td></tr>{{/if}}{{/each}}</tbody></table>'),e.set("Overlay",t)},version:"4.6.0"},{fn:function(e){var t=e.get("Legend");t.Align=void 0===t.Align?"center":t.Align,e.set("Legend",t)},version:"4.6.1"},{fn:function(e){var t=e.get("Legend");t.LegendScroll=!0===t.LegendScroll?"scroll":"default",t.LegendLayerThreshold=_.isNil(t.LegendLayerThreshold)?5:t.LegendLayerThreshold,e.set("Legend",t)},version:"4.6.1.3"},{fn:function(e){e=e.get("XAxes");_.each(e,function(e){0<=["linear","time"].indexOf(_.get(e,"_Hidden._Type"))&&(e.Labels.Offset=void 0!==e.Labels.Offset&&e.Labels.Offset)})},version:"4.6.1.4"},{fn:function(e){e.get("XAxes").concat(e.get("YAxes")).forEach(function(e){"time"===e._Hidden._Type&&(e.Labels.TimeFormats.ShowMajor=void 0!==e.Labels.TimeFormats.ShowMajor&&e.Labels.TimeFormats.ShowMajor)});var t=e.get("Layers"),t=(_.each(t,function(e){e.Labels.Rotation=_.isNil(e.Labels.Rotation)?0:e.Labels.Rotation,e.Labels.ShowOverlap=!_.isNil(e.Labels.ShowOverlap)&&e.Labels.ShowOverlap}),e.get("Basics"));t.SortBy=_.isNil(t.SortBy)?"index":t.SortBy},version:"4.7.0"},{fn:function(e){e=e.get("FileExport");e.Actions=_.isNil(e.Actions)?[]:e.Actions},version:"4.7.5"},{fn:function(e){e.get("Basics.Name")||e.set("Basics.Name","")},version:"4.7.7"},{fn:function(e){e.get("Basics.WarningOnNoData")||e.set("Basics.WarningOnNoData",!1)},version:"v2.2.3"},{fn:function(e){void 0===e.get("FileExport.ScreenshotButton")&&e.set("FileExport.ScreenshotButton","Export Png")},version:"v2.3.0.1"},{fn:function(e){void 0===e.get("Basics.UsePatterns")&&e.set("Basics.UsePatterns",!1)},version:"v2.8.0"},{fn:function(a){a.get("Layers").forEach(function(e,t){"Bubble"===a.get("Layers."+t+"._Hidden._Type")&&void 0===a.get("Layers."+t+".Bubbles.SetIconFromData")&&(a.set("Layers."+t+".Bubbles.SetIconFromData",!1),a.set("Layers."+t+".possibleIconColumns",[""]))})},version:"v2.11.0"}];L.app=f.template({compiler:[8,">= 4.3.0"],main:function(e,t,a,i,o){return'<div class="chart-legend"></div>\n<div class="chartjs-component">\n\n    <div class="tools-panel">\n        <i class="icons active-mouse pan-tool fa fa-hand-paper-o hidden1"></i>\n        <i class="icons reset-chart active fa fa-search hidden1" title="Reset Zoom"></i>\n        <i class="icons reset-chart-level active fa fa-search-minus disabled" title="Zoom out"\n           style="display:none;"></i>\n        <i class="icons reset-chart-level-in active fa fa-search-plus disabled" title="Zoom in"\n           style="display:none;"></i>\n    </div>\n\n\n    <div class="chart-container" oncontextmenu="return false;">\n\n        <canvas class="chart"></canvas>\n        <canvas class="zoomchart"></canvas>\n        <div class="crosshair"></div>\n        <div class="crosshair-selected"></div>\n    </div>\n    <div class="highlight-rules-dialog" title="Highlight Rules"></div>\n\n</div>\n'},useData:!0}),L.fileExporter=f.template({compiler:[8,">= 4.3.0"],main:function(e,t,a,i,o){var r=null!=t?t:e.nullContext||{},n=e.hooks.helperMissing,s=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="canvasChartpnlButtons">\n    <span class="lnksExport link-disabled">\n        <i class="fa fa-fw fa-download" title="'+s((e(a,"t")||t&&e(t,"t")||n).call(r,"Data",{name:"t",hash:{},data:o,loc:{start:{line:3,column:47},end:{line:3,column:59}}}))+'"></i>\n        <a class="lnkExcelExport" title="'+s((e(a,"t")||t&&e(t,"t")||n).call(r,"Download the current dataset in Excel format",{name:"t",hash:{},data:o,loc:{start:{line:4,column:41},end:{line:4,column:93}}}))+'">'+s((e(a,"t")||t&&e(t,"t")||n).call(r,"Excel",{name:"t",hash:{},data:o,loc:{start:{line:4,column:95},end:{line:4,column:108}}}))+'</a>\n        <a class="lnkCsvExport" title="'+s((e(a,"t")||t&&e(t,"t")||n).call(r,"Download the current dataset in CSV format",{name:"t",hash:{},data:o,loc:{start:{line:5,column:39},end:{line:5,column:89}}}))+'">'+s((e(a,"t")||t&&e(t,"t")||n).call(r,"CSV",{name:"t",hash:{},data:o,loc:{start:{line:5,column:91},end:{line:5,column:102}}}))+'</a>\n        <a class="lnkDownloadScreenshot" title="'+s((e(a,"t")||t&&e(t,"t")||n).call(r,"Download a PNG image of the chart",{name:"t",hash:{},data:o,loc:{start:{line:6,column:48},end:{line:6,column:89}}}))+'">'+s((e(a,"t")||t&&e(t,"t")||n).call(r,"PNG",{name:"t",hash:{},data:o,loc:{start:{line:6,column:91},end:{line:6,column:102}}}))+"</a>\n    </span> \n</div> \n"},useData:!0}),L.highlighRule=f.template({1:function(e,t,a,i,o){var r,n=null!=t?t:e.nullContext||{},s=e.hooks.helperMissing,l="function",d=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="highlightRule-menu-item">\n    <svg>\n        <rect x="2" y="5" width="10" height="10" stroke="'+d(typeof(r=null!=(r=e(a,"ruleBorder")||(null!=t?e(t,"ruleBorder"):t))?r:s)==l?r.call(n,{name:"ruleBorder",hash:{},data:o,loc:{start:{line:4,column:57},end:{line:4,column:71}}}):r)+'" fill="'+d(typeof(r=null!=(r=e(a,"ruleColor")||(null!=t?e(t,"ruleColor"):t))?r:s)==l?r.call(n,{name:"ruleColor",hash:{},data:o,loc:{start:{line:4,column:79},end:{line:4,column:92}}}):r)+'" stroke-width="2"></rect>\n    </svg>\n    <span>'+d(typeof(r=null!=(r=e(a,"ruleName")||(null!=t?e(t,"ruleName"):t))?r:s)==l?r.call(n,{name:"ruleName",hash:{},data:o,loc:{start:{line:6,column:10},end:{line:6,column:22}}}):r)+"</span>\n</div>\n"},compiler:[8,">= 4.3.0"],main:function(e,t,a,i,o){return null!=(a=(e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]})(a,"each").call(null!=t?t:e.nullContext||{},t,{name:"each",hash:{},fn:e.program(1,o,0),inverse:e.noop,data:o,loc:{start:{line:1,column:0},end:{line:8,column:9}}}))?a:""},useData:!0}),L.htmlLegend=f.template({1:function(e,t,a,i,o){var r,n=null!=t?t:e.nullContext||{},s=e.hooks.helperMissing,l="function",d=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="legendItem '+d(typeof(r=null!=(r=e(a,"class")||(null!=t?e(t,"class"):t))?r:s)==l?r.call(n,{name:"class",hash:{},data:o,loc:{start:{line:2,column:23},end:{line:2,column:32}}}):r)+'">\n    <div class="legendIcon">\n        <svg height="'+d(typeof(r=null!=(r=e(a,"width")||(null!=t?e(t,"width"):t))?r:s)==l?r.call(n,{name:"width",hash:{},data:o,loc:{start:{line:4,column:21},end:{line:4,column:30}}}):r)+'" width="'+d(typeof(r=null!=(r=e(a,"width")||(null!=t?e(t,"width"):t))?r:s)==l?r.call(n,{name:"width",hash:{},data:o,loc:{start:{line:4,column:39},end:{line:4,column:48}}}):r)+'" style="margin-left:'+d(typeof(r=null!=(r=e(a,"margin")||(null!=t?e(t,"margin"):t))?r:s)==l?r.call(n,{name:"margin",hash:{},data:o,loc:{start:{line:4,column:69},end:{line:4,column:79}}}):r)+"px; margin-right:"+d(typeof(r=null!=(r=e(a,"margin")||(null!=t?e(t,"margin"):t))?r:s)==l?r.call(n,{name:"margin",hash:{},data:o,loc:{start:{line:4,column:96},end:{line:4,column:106}}}):r)+'px;">\n            <circle cx="'+d(typeof(r=null!=(r=e(a,"cntr")||(null!=t?e(t,"cntr"):t))?r:s)==l?r.call(n,{name:"cntr",hash:{},data:o,loc:{start:{line:5,column:24},end:{line:5,column:32}}}):r)+'" cy="'+d(typeof(r=null!=(r=e(a,"cntr")||(null!=t?e(t,"cntr"):t))?r:s)==l?r.call(n,{name:"cntr",hash:{},data:o,loc:{start:{line:5,column:38},end:{line:5,column:46}}}):r)+'" r="'+d(typeof(r=null!=(r=e(a,"radius")||(null!=t?e(t,"radius"):t))?r:s)==l?r.call(n,{name:"radius",hash:{},data:o,loc:{start:{line:5,column:51},end:{line:5,column:61}}}):r)+'" stroke="'+d(typeof(r=null!=(r=e(a,"fillStyle")||(null!=t?e(t,"fillStyle"):t))?r:s)==l?r.call(n,{name:"fillStyle",hash:{},data:o,loc:{start:{line:5,column:71},end:{line:5,column:84}}}):r)+'" stroke-width="" fill="'+d(typeof(r=null!=(r=e(a,"fillStyle")||(null!=t?e(t,"fillStyle"):t))?r:s)==l?r.call(n,{name:"fillStyle",hash:{},data:o,loc:{start:{line:5,column:108},end:{line:5,column:121}}}):r)+'"></circle>\n        </svg>\n    </div>\n    <div class="legendText" style="width:'+d(typeof(r=null!=(r=e(a,"lblWidth")||(null!=t?e(t,"lblWidth"):t))?r:s)==l?r.call(n,{name:"lblWidth",hash:{},data:o,loc:{start:{line:8,column:41},end:{line:8,column:53}}}):r)+'px;">'+d(typeof(r=null!=(r=e(a,"text")||(null!=t?e(t,"text"):t))?r:s)==l?r.call(n,{name:"text",hash:{},data:o,loc:{start:{line:8,column:58},end:{line:8,column:66}}}):r)+"</div> \n</div>\n"},3:function(e,t,a,i,o){var r,n=null!=t?t:e.nullContext||{},s=e.hooks.helperMissing,l="function",d=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="legendItem '+d(typeof(r=null!=(r=e(a,"class")||(null!=t?e(t,"class"):t))?r:s)==l?r.call(n,{name:"class",hash:{},data:o,loc:{start:{line:12,column:23},end:{line:12,column:32}}}):r)+'">\n    <div class="legendIcon">\n        <svg height="'+d(typeof(r=null!=(r=e(a,"width")||(null!=t?e(t,"width"):t))?r:s)==l?r.call(n,{name:"width",hash:{},data:o,loc:{start:{line:14,column:21},end:{line:14,column:30}}}):r)+'" width="'+d(typeof(r=null!=(r=e(a,"width")||(null!=t?e(t,"width"):t))?r:s)==l?r.call(n,{name:"width",hash:{},data:o,loc:{start:{line:14,column:39},end:{line:14,column:48}}}):r)+'" style="margin-left:'+d(typeof(r=null!=(r=e(a,"margin")||(null!=t?e(t,"margin"):t))?r:s)==l?r.call(n,{name:"margin",hash:{},data:o,loc:{start:{line:14,column:69},end:{line:14,column:79}}}):r)+"px; margin-right:"+d(typeof(r=null!=(r=e(a,"margin")||(null!=t?e(t,"margin"):t))?r:s)==l?r.call(n,{name:"margin",hash:{},data:o,loc:{start:{line:14,column:96},end:{line:14,column:106}}}):r)+'px;">\n            <rect height="'+d(typeof(r=null!=(r=e(a,"width")||(null!=t?e(t,"width"):t))?r:s)==l?r.call(n,{name:"width",hash:{},data:o,loc:{start:{line:15,column:26},end:{line:15,column:35}}}):r)+'" width="'+d(typeof(r=null!=(r=e(a,"width")||(null!=t?e(t,"width"):t))?r:s)==l?r.call(n,{name:"width",hash:{},data:o,loc:{start:{line:15,column:44},end:{line:15,column:53}}}):r)+'" stroke="'+d(typeof(r=null!=(r=e(a,"fillStyle")||(null!=t?e(t,"fillStyle"):t))?r:s)==l?r.call(n,{name:"fillStyle",hash:{},data:o,loc:{start:{line:15,column:63},end:{line:15,column:76}}}):r)+'" stroke-width="1" fill="'+d(typeof(r=null!=(r=e(a,"fillStyle")||(null!=t?e(t,"fillStyle"):t))?r:s)==l?r.call(n,{name:"fillStyle",hash:{},data:o,loc:{start:{line:15,column:101},end:{line:15,column:114}}}):r)+'" ></rect>\n        </svg>\n    </div>\n    <div class="legendText" style="width:'+d(typeof(r=null!=(r=e(a,"lblWidth")||(null!=t?e(t,"lblWidth"):t))?r:s)==l?r.call(n,{name:"lblWidth",hash:{},data:o,loc:{start:{line:18,column:41},end:{line:18,column:53}}}):r)+'px;">'+d(typeof(r=null!=(r=e(a,"text")||(null!=t?e(t,"text"):t))?r:s)==l?r.call(n,{name:"text",hash:{},data:o,loc:{start:{line:18,column:58},end:{line:18,column:66}}}):r)+"</div>\n</div>\n"},compiler:[8,">= 4.3.0"],main:function(e,t,a,i,o){var r,n=null!=t?t:e.nullContext||{},s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return(null!=(r=s(a,"if").call(n,null!=t?s(t,"circle"):t,{name:"if",hash:{},fn:e.program(1,o,0),inverse:e.noop,data:o,loc:{start:{line:1,column:0},end:{line:10,column:7}}}))?r:"")+(null!=(r=s(a,"if").call(n,null!=t?s(t,"rect"):t,{name:"if",hash:{},fn:e.program(3,o,0),inverse:e.noop,data:o,loc:{start:{line:11,column:0},end:{line:20,column:7}}}))?r:"")+" "},useData:!0}),L.tooltip=f.template({1:function(e,t,a,i,o){var r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return" \n"+(null!=(a=r(a,"if").call(null!=t?t:e.nullContext||{},null!=t?r(t,"isLayerEnabled"):t,{name:"if",hash:{},fn:e.program(2,o,0),inverse:e.noop,data:o,loc:{start:{line:8,column:4},end:{line:18,column:11}}}))?a:"")},2:function(e,t,a,i,o){var r,n,s=null!=t?t:e.nullContext||{},l=e.hooks.helperMissing,d="function",c=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"    <tr>\n        <td> \n            "+(null!=(r=typeof(n=null!=(n=e(a,"svg")||(null!=t?e(t,"svg"):t))?n:l)==d?n.call(s,{name:"svg",hash:{},data:o,loc:{start:{line:11,column:12},end:{line:11,column:21}}}):n)?r:"")+"\n            "+c(typeof(n=null!=(n=e(a,"layerName")||(null!=t?e(t,"layerName"):t))?n:l)==d?n.call(s,{name:"layerName",hash:{},data:o,loc:{start:{line:12,column:12},end:{line:12,column:25}}}):n)+': \n        </td>\n        <td style="padding-right: 10px; text-align: left;">\n            '+c(typeof(n=null!=(n=e(a,"layerDataFormatted")||(null!=t?e(t,"layerDataFormatted"):t))?n:l)==d?n.call(s,{name:"layerDataFormatted",hash:{},data:o,loc:{start:{line:15,column:12},end:{line:15,column:34}}}):n)+"\n        </td>\n    </tr> \n"},compiler:[8,">= 4.3.0"],main:function(e,t,a,i,o){var r,n=null!=t?t:e.nullContext||{},s=e.hooks.helperMissing,l="function",d=e.escapeExpression,c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<table style="'+d(typeof(r=null!=(r=c(a,"fontSize")||(null!=t?c(t,"fontSize"):t))?r:s)==l?r.call(n,{name:"fontSize",hash:{},data:o,loc:{start:{line:1,column:14},end:{line:1,column:26}}}):r)+'">\n    <thead>\n        <tr style="padding-right: 10px;">\n            <th> '+d(typeof(r=null!=(r=c(a,"xLabel")||(null!=t?c(t,"xLabel"):t))?r:s)==l?r.call(n,{name:"xLabel",hash:{},data:o,loc:{start:{line:4,column:17},end:{line:4,column:27}}}):r)+" </th>\n            <th> </th>\n        </tr>\n    </thead> "+(null!=(d=c(a,"each").call(n,null!=t?c(t,"points"):t,{name:"each",hash:{},fn:e.program(1,o,0),inverse:e.noop,data:o,loc:{start:{line:7,column:13},end:{line:19,column:13}}}))?d:"")+"</table>"},useData:!0});var ce=L;function L(){}D.getConfig=function(p){var g=this,e={".csv":"Csv",".xlsx":"Excel"}[p.fileFormat],m={configSets:{},fileFormat:p.fileFormat,fileName:y.ExportTools.getExportFileName(p.fileName,"",e),workSheetTitle:p.workSheetTitle},f=_.merge(this.mapAxisConfigs(p.columnsConfig.xAxes),this.mapAxisConfigs(p.columnsConfig.yAxes));return p.columnsConfig.layers.models.length&&_.each(p.columnsConfig.layers.models,function(t){var o,e,a,i,r,n,s,l,d,c,u=t.get("Basics.Data").cid,h=p.columnsConfig.dataSources[u];h&&(m.configSets[u]||(m.configSets[u]={dataSet:h.getData().toJSON(),metaData:[]}),o=h.getColumnNames(),e=void 0,m.configSets[u].metaData.length||(e={axisId:t.get("Axes.XAxisID"),colId:t.get("Axes.XAxisData")}),a={axisId:t.get("Axes.YAxisID"),colId:t.get("Axes.YAxisData"),colName:t.get("Basics.Name")},i={axisId:"",colId:t.get("Axes.Radius")},r=[],["Close","High","Low","Open","Q1","Q3","Min","Max","Median"].forEach(function(e){r.push({axisId:t.get("Axes.YAxisID"),colId:t.get("Axes."+e)})}),n=t.get("Axes.YAxisData"),c=/\/[gimsuy]*$/,s=void 0,l="",_.isNil(n)?s="":n.startsWith("/")&&n.endsWith("/")?(s=n.substring(1,n.length-1).replace(c,""),l=(c=n.match(c))?c[0].substring(1):""):s="^"+(n=n.replace(/[\-\[\]\/\{\}\(\)\+\?\.\\\^\$\|]/g,"\\$&")).replace(/\*/g,"(.*)")+"$",d=new RegExp(s,l),_.each(o.filter(function(e){return e.match(d)}),function(e){r.push({axisId:t.get("Axes.YAxisID"),colId:e,colName:e})}),c=[e,a,i].concat(r),_.each(c,function(e){var a,t,i;_.get(e,"colId")&&_.isString(e.colId)&&(a=y.ExportTools.regExValidateColumnIDs(e.colId,o),t=e.axisId?f[e.axisId]:null,e=e.colName&&1===a.length?e.colName:"",h.breakdownColumns.length&&(i=h.breakdownColumns[h.getDepth()],_.each(a,function(e,t){"{breakdownId}"===e&&(a[t]=i)})),m.configSets[u].metaData=m.configSets[u].metaData.concat(g.getExportMetaData({colFormats:t,colIds:a,colName:e,getColumnType:_.bind(h.getColumnType.bind(h),h)})))})),m.configSets[u].metaData=_.uniqBy(m.configSets[u].metaData,function(e){return e.colId})}),m},D.mapAxisConfigs=function(e){var t={};return e.each(function(e){t[e.get("_Hidden._Label")]=e}),t},D.getExportMetaData=function(i){var o=this,e=i.colFormats,t=!e||e.get("Display"),r=e?e.get("_Hidden._Type"):"linear",n="",s="",l=e&&e.get("Labels.Precision")?e.get("Labels.Precision"):0,d=e?e.get("Labels.Format"):"",c="",u=!1,h=[];return t&&("time"===r?(d="Time",c=e.get("Labels.TimeFormats")):(n=e?e.get("Labels.Prefix"):"",s=e?e.get("Labels.Suffix"):"","Datetime"===d?c=e.get("Labels.DateFormat")||"":"General"!==d&&(u=!!e&&e.get("Labels.HideTrailingZeroes"))),_.each(i.colIds,function(e){var t=i.getColumnType(e),t=o.resolveColumnTypeAndFormat(r,d,c,l,t),a=(("Number"===t.dataType&&n||s)&&(t.dataType="String"),{});a.colId=e,a.colName=i.colName||e,a.dataType=t.dataType,a.dataKdbType=t.dataKdbType,a.dataFormat=t.dataFormat,a.hideTrailingZeroes=u,a.prefix=n,a.suffix=s,h.push(a)})),h},D.resolveColumnTypeAndFormat=function(e,t,a,i,o){var r=11<o&&o<20,n=i?"."+Array(i+1).join("0"):"",s={12:"DateTime",13:"Date",14:"Date",15:"DateTime",16:"Time",17:"Time",18:"Time",19:"Time"}[o];switch(i=this.getValidPrecission(Number(i)),(3===o||o<1||19<o)&&(o=11,a="TO_STRING",t="String"),t||(1===o?t="Boolean":1<o&&o<10?(t="Number",o<8&&(a="#0")):t="String"),t){case"Number":a="linear"===e||"logarithmic"===e?"#0"+n:"";break;case"Formatted Number":case"Smart Number":"linear"===e||"logarithmic"===e?(a="Formatted Number"===t?"#,##0"+n:r?"SmartNumber":"SmartNumber"+n,t="Number"):(t="String",a="");break;case"Datetime":var l=y.ExportTools.getTemporalTypeFromFormat(a),d=!!/[M,Y,D,d,Q]/.test(a),c=!!/[H,h,k,m,S,s]/.test(a);"category"===e&&s?"Time"===(t=s)&&"Time"!==l&&(a=d&&c&&a.split(" ").pop()||""):(t=l,a=_.get(y.ExportTools.CHARTS_DATE_FORMAT_MAP,a)),a=r?a||"":(t="String","");break;case"Time":a=r?this.resolveAxisTimeType(a):(t="String","");break;default:t="linear"!==e&&"logarithmic"!==e||!r?"String":"Number",a=""}return{dataFormat:a,dataKdbType:o,dataType:t=1===o?"Boolean":t}},D.resolveAxisTimeType=function(e){var t="",a={"":"",day:"Day",hour:"Hour",millisecond:"Millisecond",minute:"Minute",month:"Month",quarter:"Quarter",second:"Second",week:"Week",year:"Year"}[e.Unit];return a&&_.isString(t)?t=e[a]:""===a&&(t="TO_STRING"),t},D.getValidPrecission=function(e){e=void 0!==e?e:0;return e<0?e=0:10<e&&(e=10),e};var ue=D;function D(){}he=r.View,e(k,he),k.prototype.remove=function(){return this.lnkCsvExport&&this.fileExportCSV&&this.lnkCsvExport.removeEventListener("click",this.fileExportCSV),this.lnkExcelExport&&this.fileExportXLSX&&this.lnkExcelExport.removeEventListener("click",this.fileExportXLSX),this.lnkDownloadScreenshot&&this.fileExportPNG&&this.lnkDownloadScreenshot.removeEventListener("click",this.fileExportPNG),this.stopListening(),r.View.prototype.remove.apply(this)},k.prototype.initializeEvents=function(){this.listenTo(this.model,"change",this.displayChoiceLinkButtons.bind(this)),this.lnkCsvExport&&this.lnkExcelExport&&this.lnkDownloadScreenshot&&(this.fileExportCSV=this.fileExport.bind(this,".csv"),this.fileExportXLSX=this.fileExport.bind(this,".xlsx"),this.fileExportPNG=this.downloadImage.bind(this,".png"),this.lnkCsvExport.addEventListener("click",this.fileExportCSV),this.lnkExcelExport.addEventListener("click",this.fileExportXLSX),this.lnkDownloadScreenshot.addEventListener("click",this.fileExportPNG))},k.prototype.displayChoiceLinkButtons=function(){var e=this.model.get("FileExport");!e||_.keys(e).length<5||(this.appView.api.hasPermission(y.CustomAPIPermission.canExportData)&&(e.ShowExportCsvButton||e.ShowExportExcelButton||e.ShowScreenshot)?(this.lnkCsvExport&&this.lnkExcelExport&&this.lnkDownloadScreenshot&&this.lnksExport&&(this.lnksExport.classList.remove("link-disabled"),this.lnkCsvExport.classList.toggle("link-disabled",!e.ShowExportCsvButton),this.lnkExcelExport.classList.toggle("link-disabled",!e.ShowExportExcelButton),this.lnkDownloadScreenshot.classList.toggle("link-disabled",!e.ShowScreenshot)),this.chartContainer&&this.chartContainer.classList.toggle("links-enabled",!this.chartContainer.classList.contains("links-enabled")),e.Enabled||this.model.set("FileExport.Enabled",!0)):(this.lnksExport&&this.lnksExport.classList.add("link-disabled"),this.chartContainer&&this.chartContainer.classList.remove("links-enabled"),e.Enabled&&this.model.set("FileExport.Enabled",!1)))},k.prototype.downloadImage=function(e){var a=this,i=y.ExportTools.getExportFileName(this.getExportConfig().fileName,"","Screenshot"),o=this.appView.dashboardViewModel.get("selectedDocumentId"),r=this.appView.api.getDashboardName(o),i=("string"==typeof i?i:"Screenshot")+e;this.generateImage(function(e,t){O.fileSave(i,e,t),a.appView.api.onTransferAction({actions:a.appView.api.getProperty("FileExport.Actions"),component:"ChartJs",dashboardId:o,dashboardName:r,fileLength:"na"},i,"na","success","png",a.appView.api.humanFileSize(e.size))})},k.prototype.fileExport=function(e){var t=this.appView.dashboardViewModel.get("selectedDocumentId"),a=this.appView.api.getDashboardName(t),i=y.ExportTools,e=ue.getConfig(_.extend(this.getExportConfig(),{fileFormat:e}));e.actions=this.appView.api.getProperty("FileExport.Actions"),e.selectedDashboard={dashboardId:t,dashboardName:a,fileLength:"na"},i.openFileExportDialog(e)},k.prototype.generateImage=function(s){var e,l,d=this;_.isNil(this.chartContainer)||(e=this.chartContainer.parentElement,_.isNil(e))||(l=e.querySelector(".tools-panel"),_.isNil(l))||_.isNil(this.chartContainer)||(_.set(l,"style.display","none"),html2canvas(this.chartContainer,{onrendered:function(e){var t="Light"===d.getTheme()?"#F8F8F8":"#282828",a=d.chartContainer.clientHeight,i=d.chartContainer.clientWidth,o=document.createElement("canvas"),r=(o.width=i,o.height=a,o.getContext("2d")),n=(r.fillStyle=t,r.fillRect(0,0,i,a),r.drawImage(e,0,0),_.set(l,"style.display",""),d.appView.api.getProperty("FileExport.ScreenshotButton"));d.isIE?-1<n.indexOf("Export Png")&&(t=o.toDataURL("image/png"),s(O.convertDataUrlToBlob(t),"image/png")):r.canvas.toBlob(function(e){-1<n.indexOf("Export Png")&&s(e,"application/octet-stream"),-1<n.indexOf("Copy to Clipboard")&&e&&y.Tools.copyToClipboard(e,"Canvas Charts",d.appView.api)})}}))},k.prototype.getTheme=function(){return this.appView.dashboardViewModel.get("DashboardTheme")},k.prototype.renderLinks=function(){this.lnksExport=this.el.querySelector(".lnksExport"),this.lnkCsvExport=this.el.querySelector("a.lnkCsvExport"),this.lnkExcelExport=this.el.querySelector("a.lnkExcelExport"),this.lnkDownloadScreenshot=this.el.querySelector("a.lnkDownloadScreenshot")};var he,pe,T,I,ge=k;function k(e){var t=he.call(this,e)||this;return t.getCanvas=e.getCanvas,t.appView=e.appView,t.getExportConfig=e.getExportConfig,t.isIE=!1,HTMLCanvasElement&&HTMLCanvasElement.prototype&&_.get(HTMLCanvasElement.prototype,"msToBlob")&&(t.isIE=!0),t.chartContainer=t.appView.el.querySelector(".chart-container"),t.render(),t.renderLinks(),t.initializeEvents(),t}function me(e){return null===e?NaN:+e}function fe(e){return 1/Math.sqrt(2*Math.PI)*Math.exp(-.5*e*e)}function ye(e){var t=e.length;if(t<1)return NaN;if(1===t)return 0;for(var a=function(e){var t=e.length;if(0===t)return NaN;for(var a=0,i=-1;++i<t;)a+=(e[i]-a)/(i+1);return a}(e),i=-1,o=0;++i<t;){var r=e[i]-a;o+=r*r}return o/(t-1)}function be(e,t){return e-t}function xe(e){t=[.25,.75],o=(i=(i=e).slice().sort(be)).length-1;var i,t,o,e=t.map(function(e){var t,a;return 0===e?i[0]:1===e?i[o]:(e=1+e*o,t=Math.floor(e),a=i[t-1],0==(e=e-t)?a:a+e*(i[t]-a))});return e[1]-e[0]}function ve(e){var t=xe(e)/1.34;return 1.06*Math.min(Math.sqrt(ye(e)),t)*Math.pow(e.length,-.2)}function _e(e){if(0===e.length)return{outliers:[]};(e=e.filter(function(e){return"number"==typeof e&&!isNaN(e)})).sort(function(e,t){return e-t});var r,n,a,t=pe(e);return{min:t[0],max:t[1],median:T(e,.5),kde:(r=fe,n=[],a=ve,(i.sample=function(e){return arguments.length?(n=e,i):n})(e))};function i(e,t){var o=a.call(this,n);return e.map(function(e){for(var t=-1,a=0,i=n.length;++t<i;)a+=r((e-n[t])/o);return[e,a/o/i]})}}function Se(e){if(!_.isNil(e.median))return void 0!==e.median&&void 0!==e.q1&&void 0!==e.q3?e:Array.isArray(e)?e.__stats||e:void 0}function Ce(e){var t;return e&&("number"==typeof e||"string"==typeof e?Number(e):(t=Se(e))?t.median:e)}function Le(i){var o=this,r=this.recalibrate,n=this.chart,s=this.isHorizontal();this.min=null,this.max=null,n.data.datasets.forEach(function(e,t){var a=n.getDatasetMeta(t);n.isDatasetVisible(t)&&(t=a,s?t.xAxisID===o.id:t.yAxisID===o.id)&&e.data.forEach(function(e,t){r&&(a.data[t]._view.x>r[1]||a.data[t]._view.x<r[0])||e&&!a.data[t].hidden&&(e="number"==typeof(t=e).min&&"number"==typeof t.max?t:"string"==typeof t.min?{median:parseFloat(t.median),q1:parseFloat(t.q1),q3:parseFloat(t.q3),min:parseFloat(t.min),max:parseFloat(t.max),x:t.x}:Array.isArray(t)?Se(t):void 0)&&((null===o.min||e.min<o.min)&&(o.min=e.min),(null===o.max||e.max>o.max)&&(o.max=e.max),i)&&i(e)})})}pe=function(e,t){var a,i,o,r=e.length,n=-1;if(null==t){for(;++n<r;)if(null!=(a=e[n])&&a<=a)for(i=o=a;++n<r;)null!=(a=e[n])&&(a<i&&(i=a),o<a)&&(o=a)}else for(;++n<r;)if(null!=(a=t(e[n],n,e))&&a<=a)for(i=o=a;++n<r;)null!=(a=t(e[n],n,e))&&(a<i&&(i=a),o<a)&&(o=a);return[i,o]},T=function(e,t,a){_.isNil(a)&&(a=me);a=e.sort(function(e,t){return e-t}),e=(a.length-1)*t,t=Math.floor(e);return void 0!==a[t+1]?a[t]+(e-t)*(a[t+1]-a[t]):a[t]},p=_.extend({},E.defaults.global.elements.rectangle,{borderWidth:1,outlierRadius:2,itemRadius:2,itemStyle:"circle",itemBackgroundColor:E.defaults.global.elements.rectangle.backgroundColor,itemBorderColor:E.defaults.global.elements.rectangle.borderColor}),u=E.Element.extend({isVertical:function(){return void 0!==this._view.width},draw:function(){},_drawItems:function(t,e,a,i){var o,r,n,s,l;t.itemRadius<=0||!e.items||e.items.length<=0||(a.save(),a.strokeStle=t.itemBorderColor,a.fillStyle=t.itemBackgroundColor,void 0===(r=e.median)&&(r=Date.now()),o=function(){return(r=(9301*r+49297)%233280)/233280},n=t.itemRadius,i&&(s=t.x,l=t.width,e.items.forEach(function(e){E.canvasHelpers.drawPoint(a,t.itemStyle,n,s-l/2+o()*l,e)})),a.restore())},_drawOutliers:function(e,t,a,i){var o,r;t.outliers&&(o=e.outlierRadius,a.beginPath(),i&&(r=e.x,t.outliers.forEach(function(e){a.arc(r,e,o,0,2*Math.PI)})),a.fill(),a.closePath())},_getBounds:function(){return{left:0,top:0,right:0,bottom:0}},height:function(){return 0},inRange:function(e,t){var a;return!!this._view&&e>=(a=this._getBounds()).left&&e<=a.right&&t>=a.top&&t<=a.bottom},inXRange:function(e){var t=this._getBounds();return e>=t.left&&e<=t.right},inYRange:function(e){var t=this._getBounds();return e>=t.top&&e<=t.bottom},getCenterPoint:function(){var e=this._view;return{x:e.x,y:e.y}}}),E.defaults.global.elements.boxandwhiskers=_.extend({},p),E.elements.BoxAndWhiskers=u.extend({transition:function(e){var t=E.Element.prototype.transition.call(this,e),a=this._model,i=this._start,o=this._view;return a&&1!==e&&null!=i.boxplot&&(a.boxplot===o.boxplot&&(o.boxplot=E.helpers.clone(o.boxplot)),transitionBoxPlot(i.boxplot,o.boxplot,a.boxplot,e)),t},draw:function(){var e=this._chart.ctx,t=this._view,a=t.boxplot,i=this.isVertical();e.save(),e.fillStyle=t.backgroundColor,e.strokeStyle=t.borderColor,e.lineWidth=t.borderWidth,this._drawBoxPlot(t,a,e,i),this._drawOutliers(t,a,e,i),e.restore(),this._drawItems(t,a,e,i)},_drawBoxPlot:function(e,t,a,i){this._drawBoxPlotVert(e,t,a)},_drawBoxPlotVert:function(e,t,a){var i=e.x,e=e.width,o=i-e/2;t.q3>t.q1?a.fillRect(o,t.q1,e,t.q3-t.q1):a.fillRect(o,t.q3,e,t.q1-t.q3),a.save(),a.beginPath(),a.moveTo(o,t.median),a.lineTo(o+e,t.median),a.closePath(),a.stroke(),a.restore(),t.q3>t.q1?a.strokeRect(o,t.q1,e,t.q3-t.q1):a.strokeRect(o,t.q3,e,t.q1-t.q3),a.beginPath(),a.moveTo(o,t.whiskerMin),a.lineTo(o+e,t.whiskerMin),a.moveTo(i,t.whiskerMin),a.lineTo(i,t.q1),a.moveTo(o,t.whiskerMax),a.lineTo(o+e,t.whiskerMax),a.moveTo(i,t.whiskerMax),a.lineTo(i,t.q3),a.closePath(),a.stroke()},_getBounds:function(){var e,t=this._view,a=t.boxplot;return a?(e=t.y,t=t.height,{left:a.whiskerMin,top:e=e-t/2,right:a.whiskerMax,bottom:e+t}):{left:0,top:0,right:0,bottom:0}}}),E.defaults.global.elements.violin=_.extend({points:100},p),E.elements.Violin=u.extend({draw:function(){var a,i,o=this._chart.ctx,e=this._view,t=e.violin,r=this.isVertical(),n=(this._drawItems(e,t,o,r),o.save(),o.fillStyle=e.backgroundColor,o.strokeStyle=e.borderColor,o.lineWidth=e.borderWidth,t.coords);E.canvasHelpers.drawPoint(o,"rectRot",5,e.x,e.violin.median);o.stroke(),o.beginPath(),r&&(a=e.x,i=e.width/2/t.maxEstimate,o.moveTo(a,t.min),n.forEach(function(e){var t=e.v,e=e.estimate;o.lineTo(a-e*i,t)}),o.lineTo(a,t.max),o.moveTo(a,t.min),n.forEach(function(e){var t=e.v,e=e.estimate;o.lineTo(a+e*i,t)}),o.lineTo(a,t.max)),o.stroke(),o.fill(),o.closePath(),this._drawOutliers(e,t,o,r),o.restore()},_getBounds:function(){var e=this._view,t=e.violin,a=e.y,e=e.height,a=a-e/2;return{left:t.min,top:a,right:t.max,bottom:a+e}}}),p={scales:{yAxes:[{type:"arrayLinear"}]}},u={_elementOptions:function(){return{}},updateElement:function(t,a,e){var i=this.getDataset(),o=t.custom||{},r=this._elementOptions();E.controllers.bar.prototype.updateElement.call(this,t,a,e),["outlierRadius","itemRadius","itemStyle","itemBackgroundColor","itemBorderColor"].forEach(function(e){t._model[e]=void 0!==o[e]?o[e]:E.helpers.valueAtIndexOrDefault(i[e],a,r[e])})},_calculateCommonModel:function(e,t,a,i){a.outliers&&(e.outliers=a.outliers.map(function(e){return i.getPixelForValue(Number(e))})),Array.isArray(t)&&(e.items=t.map(function(e){return i.getPixelForValue(Number(e))}))}},E.defaults.boxplot=E.helpers.merge({},[E.defaults.bar,p,{tooltips:{callbacks:{label:function(e){return e}}}}]),P=_.extend({},u,{dataElementType:E.elements.BoxAndWhiskers,_elementOptions:function(){return this.chart.options.elements.boxandwhiskers},_updateElementGeometry:function(e,t,a,i){E.controllers.bar.prototype._updateElementGeometry.call(this,e,t,a,i),e._model.boxplot=this._calculateBoxPlotValuesPixels(this.index,t)},_calculateBoxPlotValuesPixels:function(e,t){var a=this._getValueScale(),e=this.chart.data.datasets[e].data[t],i=Se(e),o={};return i&&(Object.keys(i).forEach(function(e){"outliers"!==e&&(o[e]=a.getPixelForValue(Number(i[e])))}),this._calculateCommonModel(o,e,i,a)),o}}),E.controllers.boxplot=E.controllers.bar.extend(P),E.defaults.violin=E.helpers.merge({},[E.defaults.bar,p,{}]),P=_.extend({},u,{dataElementType:E.elements.Violin,_elementOptions:function(){return this.chart.options.elements.violin},_updateElementGeometry:function(e,t,a,i){E.controllers.bar.prototype._updateElementGeometry.call(this,e,t,a,i);a=e.custom||{},i=this._elementOptions();e._model.violin=this._calculateViolinValuesPixels(this.index,t,(void 0!==a.points?a:i).points)},_calculateViolinValuesPixels:function(e,t,a){var i=this._getValueScale(),e=this.chart.data.datasets[e].data[t].data,t=(void 0===(t=e).__kde&&(t.__kde=_e(t)),t.__kde),o=(Array.isArray(e)&&(t.min=_.min(e),t.q1=T(e,.25),t.median=T(e,.5),t.q3=T(e,.75),t.max=_.max(e)),t.max-t.min),o=function(e,t,a){e=+e,t=+t,a=(o=arguments.length)<2?(t=e,e=0,1):o<3?1:+a;for(var i=-1,o=0|Math.max(0,Math.ceil((t-e)/a)),r=new Array(o);++i<o;)r[i]=e+i*a;return r}(t.min,t.max,o/a),a=(o[o.length-1]!==t.max&&o.push(t.max),t.coords||t.kde(o).map(function(e){return{v:e[0],estimate:e[1]}})),o={min:i.getPixelForValue(t.min),max:i.getPixelForValue(t.max),median:i.getPixelForValue(t.median),coords:a.map(function(e){var t=e.v,e=e.estimate;return{v:i.getPixelForValue(t),estimate:e}}),maxEstimate:function(e,t){var a,i,o=e.length,r=-1;if(null==t){for(;++r<o;)if(null!=(a=e[r])&&a<=a)for(i=a;++r<o;)null!=(a=e[r])&&i<a&&(i=a)}else for(;++r<o;)if(null!=(a=t(e[r],r,e))&&a<=a)for(i=a;++r<o;)null!=(a=t(e[r],r,e))&&i<a&&(i=a);return i}(a,function(e){return e.estimate})};return this._calculateCommonModel(o,e,t,i),o}}),E.controllers.violin=E.controllers.bar.extend(P),p=E.scaleService.getScaleConstructor("linear").extend({getRightValue:function(e){return E.LinearScaleBase.prototype.getRightValue.call(this,Ce(e))},determineDataLimits:function(){var e,t,a,i=this.recalibrate,o=(Le.call(this),this.min&&this.max&&(this.max,this.min),this),r=o.options,n=o.chart,s=n.data,l=n.config.panModel,d=!i&&l&&l.get("YAdjust")&&"none"!=l.get("YAdjust").toLowerCase()?l.zoomObj:void 0,c=(d&&d.min&&d.min.isValid&&d.max&&d.max.isValid&&(d.min.isValid()&&d.max.isValid()||(d=void 0)),s.datasets),u=o.isHorizontal(),i=E.helpers,h=o._getMatchingVisibleMetas(),p={},g=h.length;o.min=null,o.max=null;var m=r.stacked;if(void 0===m&&i.each(c,function(e,t){var a;m||(a=n.getDatasetMeta(t),n.isDatasetVisible(t)&&(t=a,u?t.xAxisID===o.id:t.yAxisID===o.id)&&void 0!==a.stack&&(m=!0))}),void 0===m)for(e=0;!m&&e<g;++e)t=h[e],m=void 0!==t.stack;for(e=0;e<g;++e)if(t=h[e],s=d?c[t.index].data.filter(function(e){return n.scales[t.xAxisID].min<=e.x.valueOf()&&e.x.valueOf()<=n.scales[t.xAxisID].max}):c[t.index].data,m){L=f=M=k=T=D=C=S=v=x=b=y=void 0;for(var f,y=o,b=p,x=t,v=s,S=y.options,C=S.stacked,L=(b=b,C=C,C=[(L=x).type,void 0===C&&void 0===L.stack?L.index:"",L.stack].join("."),void 0===b[C]&&(b[C]={pos:[],neg:[]}),b[C]),D=L.pos,T=L.neg,k=v.length,M=0;M<k;++M)f=y._parseValue(v[M]),isNaN(f.min)||isNaN(f.max)||x.data[M].hidden||(D[M]=D[M]||0,T[M]=T[M]||0,S.relativePoints?D[M]=100:f.min<0||f.max<0?T[M]+=f.min:D[M]+=f.max)}else{F=B=O=w=P=A=void 0;for(var F,A=o,P=t,w=s,O=w.length,B=0;B<O;++B)F=A._parseValue(w[B]),isNaN(F.min)||isNaN(F.max)||P.data[B].hidden||(A.min=_.isNil(A.min)?F.min:Math.min(A.min,F.min),A.max=_.isNil(A.max)?F.max:Math.max(A.max,F.max))}I.each(p,function(e){a=e.pos.concat(e.neg),o.min=Math.min(o.min,I.min(a)),o.max=Math.max(o.max,I.max(a))}),o.min=I.isFinite(o.min)&&!isNaN(o.min)?o.min:0,o.max=I.isFinite(o.max)&&!isNaN(o.max)?o.max:1;t&&0<=["boxplot","candlestick","ohlc"].indexOf(t.type)&&(o.finMax=o.finMin=null,r=l=void 0,"boxplot"===t.type&&(l=null==(i=_.minBy(s,"min"))?void 0:i.min,r=null==(i=_.maxBy(s,"max"))?void 0:i.max),"candlestick"!==t.type&&"ohlc"!==t.type||(l=_.minBy(s,"l").l,r=_.maxBy(s,"h").h),o.finMin=I.isFinite(l)&&!isNaN(l)?l:0,o.finMax=I.isFinite(r)&&!isNaN(r)?r:1,o.min=o.finMin,o.max=o.finMax,o.min=isFinite(o.min)&&!isNaN(o.min)?o.min:0,o.max=isFinite(o.max)&&!isNaN(o.max)?o.max:1),o.handleTickRangeOptions()},getLabels:function(){var e=this.chart.data;return this.options.labels||(this.isHorizontal()?e.xLabels:e.yLabels)||e.labels}}),E.scaleService.registerScaleType("arrayLinear",p,E.scaleService.getScaleDefaults("linear")),I=E.helpers,u=E.scaleService.getScaleConstructor("logarithmic").extend({getRightValue:function(e){return E.LinearScaleBase.prototype.getRightValue.call(this,Ce(e))},determineDataLimits:function(){var t=this,e=(this.minNotZero=null,Le.call(this,function(e){0!==e.min&&(null===t.minNotZero||e.min<t.minNotZero)&&(t.minNotZero=e.min)}),this.options.ticks);this.min=I.valueOrDefault(e.min,this.min-.05*this.min),this.max=I.valueOrDefault(e.max,this.max+.05*this.max),this.min===this.max&&(0!==this.min&&null!==this.min?(this.min=Math.pow(10,Math.floor(I.log10(this.min))-1),this.max=Math.pow(10,Math.floor(I.log10(this.max))+1)):(this.min=1,this.max=10))}}),E.scaleService.registerScaleType("arrayLogarithmic",u,E.scaleService.getScaleDefaults("logarithmic"));var M=(E=E&&E.hasOwnProperty("default")?E.default:E).helpers,De=function(){if("undefined"!=typeof window){if(window.devicePixelRatio)return window.devicePixelRatio;var e=window.screen;if(e)return(e.deviceXDPI||1)/(e.logicalXDPI||1)}return 1}(),F={toTextLines:function(e){var t,a=[];for(e=[].concat(e);e.length;)"string"==typeof(t=e.pop())?a.unshift.apply(a,t.split("\n")):Array.isArray(t)?e.push.apply(e,t):M.isNullOrUndef(e)||a.unshift(""+t);return a},toFontString:function(e){return!e||M.isNullOrUndef(e.size)||M.isNullOrUndef(e.family)?null:(e.style?e.style+" ":"")+(e.weight?e.weight+" ":"")+e.size+"px "+e.family},textSize:function(e,t,a){var i,o=[].concat(t),r=o.length,t=e.font,n=0;for(e.font=a.string,i=0;i<r;++i)n=Math.max(e.measureText(o[i]).width,n);return e.font=t,{height:r*a.lineHeight,width:n}},parseFont:function(e){var t=E.defaults.global,a=M.valueOrDefault(e.size,t.defaultFontSize),a={family:M.valueOrDefault(e.family,t.defaultFontFamily),lineHeight:M.options.toLineHeight(e.lineHeight,a),size:a,style:M.valueOrDefault(e.style,t.defaultFontStyle),weight:M.valueOrDefault(e.weight,null),string:""};return a.string=F.toFontString(a),a},bound:function(e,t,a){return Math.max(e,Math.min(t,a))},arrayDiff:function(e,t){for(var a,i,o=e.slice(),r=[],n=0,s=t.length;n<s;++n)i=t[n],-1===(a=o.indexOf(i))?r.push([i,1]):o.splice(a,1);for(n=0,s=o.length;n<s;++n)r.push([o[n],-1]);return r},rasterize:function(e){return Math.round(e*De)/De}};function Te(e,t){var a=t.x,t=t.y;return null===a?{x:0,y:-1}:null===t?{x:1,y:0}:(a=e.x-a,e=e.y-t,{x:(t=Math.sqrt(a*a+e*e))?a/t:0,y:t?e/t:-1})}var ke=0,Me=1,Fe=2,Ae=4,Pe=8;function we(e,t,a){var i=ke;return e<a.left?i|=Me:e>a.right&&(i|=Fe),t<a.top?i|=Pe:t>a.bottom&&(i|=Ae),i}function Oe(e,t){var a=t.anchor,i=e,i=(t.clamp&&(i=function(e,t){for(var a,i,o,r=e.x0,n=e.y0,s=e.x1,l=e.y1,d=we(r,n,t),c=we(s,l,t);d|c&&!(d&c);)(a=d||c)&Pe?(i=r+(s-r)*(t.top-n)/(l-n),o=t.top):a&Ae?(i=r+(s-r)*(t.bottom-n)/(l-n),o=t.bottom):a&Fe?(o=n+(l-n)*(t.right-r)/(s-r),i=t.right):a&Me&&(o=n+(l-n)*(t.left-r)/(s-r),i=t.left),a===d?d=we(r=i,n=o,t):c=we(s=i,l=o,t);return{x0:r,x1:s,y0:n,y1:l}}(i,t.area)),a="start"===a?(o=i.x0,i.y0):"end"===a?(o=i.x1,i.y1):(o=(i.x0+i.x1)/2,(i.y0+i.y1)/2),o),o=a,r=e.vx,n=e.vy,s=t.align;switch(s){case"center":r=n=0;break;case"bottom":r=0,n=1;break;case"right":r=1,n=0;break;case"left":r=-1,n=0;break;case"top":r=0,n=-1;break;case"start":r=-r,n=-n;break;case"end":break;default:s*=Math.PI/180,r=Math.cos(s),n=Math.sin(s)}return{x:i,y:o,vx:r,vy:n}}var Be=function(e,t){var a=(e.startAngle+e.endAngle)/2,i=Math.cos(a),a=Math.sin(a),o=e.innerRadius,r=e.outerRadius;return Oe({x0:e.x+i*o,y0:e.y+a*o,x1:e.x+i*r,y1:e.y+a*r,vx:i,vy:a},t)},Ee=function(e,t){var a=Te(e,t.origin),i=a.x*e.radius,o=a.y*e.radius;return Oe({x0:e.x-i,y0:e.y-o,x1:e.x+i,y1:e.y+o,vx:a.x,vy:a.y},t)},Ie=function(e,t){var a=Te(e,t.origin),i=e.x,o=e.y,r=0,n=0;return e.horizontal?(i=Math.min(e.x,e.base),r=Math.abs(e.base-e.x)):(o=Math.min(e.y,e.base),n=Math.abs(e.base-e.y)),Oe({x0:i,y0:o+n,x1:i+r,y1:o,vx:a.x,vy:a.y},t)},Re=function(e,t){var a=Te(e,t.origin);return Oe({x0:e.x,y0:e.y,x1:e.x,y1:e.y,vx:a.x,vy:a.y},t)},A=E.helpers,He=F.rasterize;function Ne(e,t,a,i,o){var r,n,s,l,d,c,u,h,p,g,m,f,y=i.textAlign,b=i.color,x=!!b,v=i.font,_=t.length,S=i.textStrokeColor,C=i.textStrokeWidth,L=S&&C;if(_&&(x||L))for(S=a,C=y,n=(n=v).lineHeight,s=S.w,l=S.x,"center"===C?l+=s/2:"end"!==C&&"right"!==C||(l+=s),a={h:n,w:s,x:l,y:S.y+n/2},e.font=v.string,e.textAlign=y,e.textBaseline="middle",e.shadowBlur=i.textShadowBlur,e.shadowColor=i.textShadowColor,x&&(e.fillStyle=b),o=o||0,r=0,_=t.length;r<_;++r)d=e,c=t[r],u={stroked:L,filled:x,w:a.w,x:a.x,y:o+a.y+a.h*r},f=m=g=p=h=void 0,h=d.shadowBlur,p=u.stroked,g=He(u.x),m=He(u.y),f=He(u.w),p&&d.strokeText(c,g,m,f),u.filled&&(h&&p&&(d.shadowBlur=0),d.fillText(c,g,m,f),h)&&p&&(d.shadowBlur=h)}function Ve(e,t,a,i){var o=this;o._config=e,o._index=i,o._model=null,o._rects=null,o._ctx=t,o._el=a}A.extend(Ve.prototype,{_modelize:function(e,t,a,i){var o,r=this._index,n=A.options.resolve,s=F.parseFont(n([a.font,{}],i,r)),l=n([a.color,E.defaults.global.defaultFontColor],i,r);return{align:n([a.align,"center"],i,r),anchor:n([a.anchor,"center"],i,r),area:i.chart.chartArea,backgroundColor:n([a.backgroundColor,null],i,r),borderColor:n([a.borderColor,null],i,r),borderRadius:n([a.borderRadius,0],i,r),borderWidth:n([a.borderWidth,0],i,r),clamp:n([a.clamp,!1],i,r),clip:n([a.clip,!1],i,r),color:l,display:e,font:s,lines:t,offset:n([a.offset,0],i,r),opacity:n([a.opacity,1],i,r),origin:(e=this._el,o=e._model.horizontal,(e=e._scale||o&&e._xScale||e._yScale)?void 0!==e.xCenter&&void 0!==e.yCenter?{x:e.xCenter,y:e.yCenter}:(e=e.getBasePixel(),o?{x:e,y:null}:{x:null,y:e}):null),padding:A.options.toPadding(n([a.padding,0],i,r)),positioner:(o=this._el)instanceof E.elements.Arc?Be:o instanceof E.elements.Point?Ee:o instanceof E.elements.Rectangle?Ie:Re,rotation:n([a.rotation,0],i,r)*(Math.PI/180),size:F.textSize(this._ctx,t,s),textAlign:n([a.textAlign,"start"],i,r),textShadowBlur:n([a.textShadowBlur,0],i,r),textShadowColor:n([a.textShadowColor,l],i,r),textStrokeColor:n([a.textStrokeColor,l],i,r),textStrokeWidth:n([a.textStrokeWidth,0],i,r)}},update:function(e){var t,a,i=this,o=null,r=null,n=i._index,s=i._config,l=A.options.resolve([s.display,!0],e,n);l&&(n=e.dataset.data[n],n=A.valueOrDefault(A.callback(s.formatter,[n,e]),n),(n=A.isNullOrUndef(n)?[]:F.toTextLines(n)).length)&&(o=i._modelize(l,n,s,e),n=(l=o).borderWidth||0,s=l.padding,e=l.size.height,t=-(l=l.size.width)/2,a=-e/2,r={frame:{x:t-s.left-n,y:a-s.top-n,w:l+s.width+2*n,h:e},text:{x:t,y:a,w:l,h:e}}),i._model=o,i._rects=r},geometry:function(){return this._rects?this._rects.frame:{}},rotation:function(){return this._model?this._model.rotation:0},visible:function(){return this._model&&this._model.opacity},model:function(){return this._model},draw:function(e,t){var a,e=e.ctx,i=this._model,o=this._rects;this.visible()&&(e.save(),i.clip&&(a=i.area,e.beginPath(),e.rect(a.left,a.top,a.right-a.left,a.bottom-a.top),e.clip()),e.globalAlpha=F.bound(0,i.opacity,1),e.translate(He(t.x),He(t.y)),e.rotate(i.rotation),o.frame,i.backgroundColor,i.borderColor,i.borderWidth,Ne(e,i.lines,o.text,i,this.$layout.yAdjust),e.restore())}});var P=E.helpers,We=Number.MIN_SAFE_INTEGER||-9007199254740991,Ye=Number.MAX_SAFE_INTEGER||9007199254740991;function je(e,t,a){var i=Math.cos(a),a=Math.sin(a),o=t.x,t=t.y;return{x:o+i*(e.x-o)-a*(e.y-t),y:t+a*(e.x-o)+i*(e.y-t)}}function ze(e,t){for(var a,i,o=Ye,r=We,n=t.origin,s=0;s<e.length;++s)i=(a=e[s]).x-n.x,a=a.y-n.y,i=t.vx*i+t.vy*a,o=Math.min(o,i),r=Math.max(r,i);return{min:o,max:r}}function Xe(e,t){var a=t.x-e.x,i=t.y-e.y,a=Math.sqrt(a*a+i*i);return{vx:(t.x-e.x)/a,vy:(t.y-e.y)/a,origin:e,ln:a}}function Ze(){this._rotation=0,this._rect={x:0,y:0,w:0,h:0}}function qe(e,t,a){var i,o,r,e=t.positioner(e,t),n=e.vx,s=e.vy;return n||s?(o=a.w,a=a.h,r=t.rotation,i=Math.abs(o/2*Math.cos(r))+Math.abs(a/2*Math.sin(r)),o=Math.abs(o/2*Math.sin(r))+Math.abs(a/2*Math.cos(r)),i*=n*(a=1/Math.max(Math.abs(n),Math.abs(s))),o*=s*a,_.isNumber(t.offset)?(i+=t.offset*n,o+=t.offset*s):2===(r=t.offset.split(",")).length?(i+=_.isNaN(parseFloat(r[0]))?4*n:parseFloat(r[0]),o+=_.isNaN(parseFloat(r[1]))?4*s:parseFloat(r[1])):(i+=4*n,o+=4*s),{x:e.x+i,y:e.y+o}):{x:e.x,y:e.y}}P.extend(Ze.prototype,{center:function(){var e=this._rect;return{x:e.x+e.w/2,y:e.y+e.h/2}},update:function(e,t,a){this._rotation=a,this._rect={x:t.x+e.x,y:t.y+e.y,w:t.w,h:t.h}},contains:function(e){var t=this._rect;return!((e=je(e,this.center(),-this._rotation)).x<t.x-1||e.y<t.y-1||e.x>t.x+t.w+2||e.y>t.y+t.h+2)},intersects:function(e){var t,a,i,o=this._points(),r=e._points(),n=[Xe(o[0],o[1]),Xe(o[0],o[3])];for(this._rotation!==e._rotation&&n.push(Xe(r[0],r[1]),Xe(r[0],r[3])),t=0;t<n.length;++t)if(a=ze(o,n[t]),i=ze(r,n[t]),a.max<i.min||i.max<a.min)return!1;return!0},_points:function(){var e=this._rect,t=this._rotation,a=this.center();return[je({x:e.x,y:e.y},a,t),je({x:e.x+e.w,y:e.y},a,t),je({x:e.x+e.w,y:e.y+e.h},a,t),je({x:e.x,y:e.y+e.h},a,t)]}});var Ue={prepare:function(e){for(var t,a,i,o=[],r=0,n=e.length;r<n;++r)for(t=0,a=e[r].length;t<a;++t)i=e[r][t],o.push(i),i.$layout={_box:new Ze,_hidable:!1,_visible:!0,_set:r,_idx:t};return o.sort(function(e,t){e=e.$layout,t=t.$layout;return e._idx===t._idx?e._set-t._set:t._idx-e._idx}),this.update(o),o},update:function(e){for(var t,a,i,o,n=_.filter(e,function(e){return e._model}),r=0,s=n.length;r<s;++r)(a=(t=n[r]).$layout)._visible&&(i=t.geometry(),o=qe(t._el._model,t.model(),i),a._box.update(o,i,t.rotation()));for(var l,d,c,u=n,h=function(t,a){var e,i,o=_.get(t,"_box._rect"),r=_.get(a,"_box._rect");(n[0]?_.get(n[0],"$context.chart.height"):0)&&o&&r&&(e=t.yAdjust||0,i=Math.abs(r.y-o.y)/2,a.yAdjust=e+o.h+i,_.each(_.filter(n,function(e){return e._index===t._idx&&e.$layout._box._rect.y!==o.y&&e.$layout._box._rect.y!==r.y}),function(e){var t=a._box;t._rect.y=t._rect.y+a.yAdjust,e.$layout._box.intersects(t)&&(e.$layout.yAdjust=r.h+i)}))},p=u.length-1;0<=p;--p)for(d=u[p].$layout,l=p-1;0<=l&&d._visible;--l)(c=u[l].$layout)._visible&&d._box.intersects(c._box)&&(0!==u[l].rotation()?c._visible=!1:h(d,c))},lookup:function(e,t){for(var a,i=e.length-1;0<=i;--i)if((a=e[i].$layout)&&a._visible&&a._box.contains(t))return{dataset:a._set,label:e[i]};return null},draw:function(e,t){for(var a,i,o,r,n=0,s=t.length;n<s;++n)(i=(a=t[n]).$layout)._visible&&(o=a.geometry(),r=qe(a._el._view,a.model(),o),i._box.update(r,o,a.rotation()),a.draw(e,r))}},Ge=E.helpers,P={align:"center",anchor:"center",backgroundColor:null,borderColor:null,borderRadius:0,borderWidth:0,clamp:!1,clip:!1,color:void 0,display:!1,font:{family:void 0,lineHeight:1,size:void 0,style:void 0,weight:null},formatter:function(e){if(Ge.isNullOrUndef(e))return null;var t,a,i,o=e;if(Ge.isObject(e))if(Ge.isNullOrUndef(e.label))if(Ge.isNullOrUndef(e.r))for(o="",i=0,a=(t=Object.keys(e)).length;i<a;++i)o+=(0!==i?", ":"")+t[i]+": "+e[t[i]];else o=e.r;else o=e.label;return""+o},listeners:{},offset:4,opacity:1,padding:{top:4,right:4,bottom:4,left:4},rotation:0,textAlign:"start",textStrokeColor:void 0,textStrokeWidth:0,textShadowBlur:0,textShadowColor:void 0},Ke=E.helpers,w="$datalabels";function $e(e,t,a){var i,t=t&&t[a.dataset];t&&(i=(a=a.label).$context,!0===Ke.callback(t,[i]))&&(e[w]._dirty=!0,a.update(i))}function Qe(e,t){var a=e[w],i=a._listeners;if(i.enter||i.leave){if("mousemove"===t.type)o=Ue.lookup(a._labels,t);else if("mouseout"!==t.type)return;var o,r,n,t=a._hovered;a._hovered=o,a=e,e=i,i=o,((o=t)||i)&&(o?i?o.label!==i.label&&(n=r=!0):n=!0:r=!0,n&&$e(a,e.leave,o),r)&&$e(a,e.enter,i)}}E.defaults.global.plugins.datalabels=P,E.defaults.global.plugins.datalabels=P,P={id:"datalabels",beforeInit:function(e){e[w]={_actives:[]}},beforeUpdate:function(e){e=e[w];e&&(e._listened=!1,e._listeners={},e._datasets=[],e._labels=[])},afterDatasetUpdate:function(e,i,t){var a,o=i.index,r=e[w];if(r){var n=r._datasets[o]=[],s=e.isDatasetVisible(o),l=e.data.datasets[o],d=(t=t,!1===(a=(a=l).datalabels)?null:Ke.merge({},[t,a=!0===a?{}:a])),c=i.meta.data||[],u=c.length,h=e.ctx,p=void 0,g=void 0,m=void 0;for(h.save(),p=0;p<u;++p)g=c[p],s&&g&&!g.hidden&&!g._model.skip?(n.push(m=new Ve(d,h,g,p)),m.update(m.$context={active:!1,chart:e,dataIndex:p,dataset:l,datasetIndex:o})):m=null,g[w]=m;h.restore(),Ke.merge(r._listeners,d.listeners||{},{merger:function(e,t,a){t[e]=t[e]||{},t[e][i.index]=a[e],r._listened=!0}})}},afterUpdate:function(e,t){e[w]&&(e[w]._labels=Ue.prepare(e[w]._datasets,t))},afterDatasetsDraw:function(e){e[w]&&Ue.draw(e,_.filter(e[w]._labels,function(e){return e._model}))},beforeEvent:function(e,t){if(e[w]&&e[w]._listened)switch(t.type){case"mousemove":case"mouseout":Qe(e,t);break;case"click":i=t,o=(a=e)[w],r=o._listeners.click,(o=r&&Ue.lookup(o._labels,i))&&$e(a,r,o)}var a,i,o,r},afterEvent:function(e){var t=e[w];if(e[w]){for(var a,i=t._actives,o=t._actives=e.lastActive||[],r=F.arrayDiff(i,o),n=void 0,s=void 0,n=0,l=r.length;n<l;++n)(a=r[n])[1]&&(s=a[0][w])&&(s.$context.active=1===a[1],s.update(s.$context));(t._dirty||r.length)&&(Ue.update(t._labels),e.animating||e.render()),delete t._dirty}}},E.plugins.register(P),function i(o,r,n){function s(a,e){if(!r[a]){if(!o[a]){var t="function"==typeof require&&require;if(!e&&t)return t(a,!0);if(l)return l(a,!0);e=new Error("Cannot find module '"+a+"'");throw e.code="MODULE_NOT_FOUND",e}t=r[a]={exports:{}};o[a][0].call(t.exports,function(e){var t=o[a][1][e];return s(t||e)},t,t.exports,i,o,r,n)}return r[a].exports}for(var l="function"==typeof require&&require,e=0;e<n.length;e++)s(n[e]);return s}({1:[function(e,t,a){},{}],2:[function(e,t,a){t.exports=function(e){e.defaults.candlestick=Object.assign({},e.defaults.financial),e.defaults.candlestick.scales={xAxes:[Object.assign({},e.defaults.financial.scales.xAxes[0])],yAxes:[Object.assign({},e.defaults.financial.scales.yAxes[0])]},e.controllers.candlestick=e.controllers.financial.extend({dataElementType:e.elements.Candlestick,updateElement:function(e,t,a){var i=this,o=i.getMeta(),r=i.getDataset(),n=i._resolveDataElementOptions(e,t);e._xScale=i.getScaleForId(o.xAxisID),e._yScale=i.getScaleForId(o.yAxisID),e._datasetIndex=i.index,e._index=t,e._model={datasetLabel:r.label||"",color:r.color,borderColor:r.borderColor,borderWidth:r.borderWidth},i.updateElementGeometry(e,t,a,n),e.pivot()}})}},{}],3:[function(e,t,a){t.exports=function(n){n.defaults.financial={label:"",hover:{mode:"label"},scales:{xAxes:[{type:"time",distribution:"series",categoryPercentage:.8,barPercentage:.9,ticks:{source:"data"}}],yAxes:[{type:"financialLinear"}]},tooltips:{callbacks:{label:function(e,t){return t.datasets[e.datasetIndex].data[e.index]}}}},n.controllers.financial=n.controllers.bar.extend({dataElementType:n.elements.Financial,updateElementGeometry:function(e,t,a,i){var o=this,e=e._model,r=o._getValueScale(),n=r.getBasePixel(),r=r.isHorizontal(),s=o._ruler||o.getRuler(),l=o.calculateBarValuePixels(o.index,t,i),s=o.calculateBarIndexPixels(o.index,t,s,i);e.horizontal=r,e.base=a?n:l.base,e.x=r?a?n:l.head:s.center,e.y=r?s.center:a?n:l.head,e.height=r?s.size:void 0,e.width=r?void 0:s.size,e.candle=o.calculateCandleValuesPixels(o.index,t,i)},calculateCandleValuesPixels:function(e,t){var a=this.chart,i=this._getValueScale(),a=a.data.datasets;return{o:i.getPixelForValue(Number(a[e].data[t].o)),h:i.getPixelForValue(Number(a[e].data[t].h)),l:i.getPixelForValue(Number(a[e].data[t].l)),c:i.getPixelForValue(Number(a[e].data[t].c))}},draw:function(){var e,t=this.chart.chart.ctx,a=this.getMeta().data,i=this.getDataset(),o=a.length,r=0;for(n.canvasHelpers.clipArea(t,this.chart.chartArea);r<o;++r)null==(e=i.data[r].o)||isNaN(e)||a[r].draw();n.canvasHelpers.unclipArea(t)}})}},{}],4:[function(e,t,a){t.exports=function(e){e.defaults.ohlc=Object.assign({},e.defaults.financial),e.defaults.ohlc.scales={xAxes:[Object.assign({},e.defaults.financial.scales.xAxes[0])],yAxes:[Object.assign({},e.defaults.financial.scales.yAxes[0])]},e.defaults.ohlc.scales.xAxes[0].barPercentage=1,e.defaults.ohlc.scales.xAxes[0].categoryPercentage=1,e.controllers.ohlc=e.controllers.financial.extend({dataElementType:e.elements.Ohlc,updateElement:function(e,t,a){var i=this,o=i.getMeta(),r=i.getDataset(),n=i._resolveDataElementOptions(e,t);e._xScale=i.getScaleForId(o.xAxisID),e._yScale=i.getScaleForId(o.yAxisID),e._datasetIndex=i.index,e._index=t,e._model={datasetLabel:r.label||"",lineWidth:r.lineWidth,armLength:r.armLength,armLengthRatio:r.armLengthRatio,color:r.color},i.updateElementGeometry(e,t,a,n),e.pivot()}})}},{}],5:[function(e,t,a){t.exports=function(e){var s=e.helpers,l=e.defaults.global;l.elements.candlestick=Object.assign(l.elements.financial,{borderColor:l.elements.financial.color.unchanged,borderWidth:2}),e.elements.Candlestick=e.elements.Financial.extend({draw:function(){var e=this._chart.ctx,t=this._view,a=t.x,i=t.candle.o,o=t.candle.h,r=t.candle.l,n=t.candle.c;e.strokeStyle=s.getValueOrDefault(t.borderColor,l.elements.candlestick.borderColor),e.lineWidth=s.getValueOrDefault(t.borderWidth,l.elements.candlestick.borderWidth),e.fillStyle=n<i?s.getValueOrDefault(t.color?t.color.up:void 0,l.elements.candlestick.color.up):i<n?s.getValueOrDefault(t.color?t.color.down:void 0,l.elements.candlestick.color.down):s.getValueOrDefault(t.color?t.color.unchanged:void 0,l.elements.candlestick.color.unchanged),e.beginPath(),e.moveTo(a,o),e.lineTo(a,Math.min(i,n)),e.moveTo(a,r),e.lineTo(a,Math.max(i,n)),e.stroke(),e.fillRect(a-t.width/2,n,t.width,i-n),e.closePath()}})}},{}],6:[function(e,t,a){t.exports=function(e){function o(e){var e=e._view,t=e.width/2,a=e.x-t,t=e.x+t;return{left:a,top:e.candle.h,right:t,bottom:e.candle.l}}e.defaults.global.elements.financial={color:{up:"rgba(80, 160, 115, 1)",down:"rgba(215, 85, 65, 1)",unchanged:"rgba(90, 90, 90, 1)"},fractionalDigitsCount:void 0},e.elements.Financial=e.Element.extend({height:function(){var e=this._view;return e.base-e.y},inRange:function(e,t){var a,i=!1;return i=this._view?e>=(a=o(this)).left&&e<=a.right&&t>=a.top&&t<=a.bottom:i},inXRange:function(e){var t=o(this);return e>=t.left&&e<=t.right},getCenterPoint:function(){var e=this._view;e.width;return{x:e.x,y:(e.candle.h+e.candle.l)/2}}})}},{}],7:[function(e,t,a){t.exports=function(e){var d=e.helpers,c=e.defaults.global;c.elements.ohlc=Object.assign(c.elements.financial,{lineWidth:2,armLength:null,armLengthRatio:.8}),e.elements.Ohlc=e.elements.Financial.extend({draw:function(){var e=this._chart.ctx,t=this._view,a=t.x,i=t.candle.o,o=t.candle.h,r=t.candle.l,n=t.candle.c,s=d.getValueOrDefault(t.armLength,c.elements.ohlc.armLength),l=d.getValueOrDefault(t.armLengthRatio,c.elements.ohlc.armLengthRatio);null===s&&(s=t.width*l*.5),e.strokeStyle=n<i?d.getValueOrDefault(t.color?t.color.up:void 0,c.elements.ohlc.color.up):i<n?d.getValueOrDefault(t.color?t.color.down:void 0,c.elements.ohlc.color.down):d.getValueOrDefault(t.color?t.color.unchanged:void 0,c.elements.ohlc.color.unchanged),e.lineWidth=d.getValueOrDefault(t.lineWidth,c.elements.ohlc.lineWidth),e.beginPath(),e.moveTo(a,o),e.lineTo(a,r),e.moveTo(a-s,i),e.lineTo(a,i),e.moveTo(a+s,n),e.lineTo(a,n),e.stroke()}})}},{}],8:[function(e,t,a){var i="function"==typeof(i=e("chart.js"))?i:window.Chart;e("./scale.financialLinear.js")(i),e("./element.financial.js")(i),e("./element.candlestick.js")(i),e("./element.ohlc.js")(i),e("./controller.financial.js")(i),e("./controller.candlestick.js")(i),e("./controller.ohlc.js")(i)},{"./controller.candlestick.js":2,"./controller.financial.js":3,"./controller.ohlc.js":4,"./element.candlestick.js":5,"./element.financial.js":6,"./element.ohlc.js":7,"./scale.financialLinear.js":9,"chart.js":1}],9:[function(e,t,a){t.exports=function(e){e.helpers;var t=e.scaleService.getScaleConstructor("linear").extend({});e.scaleService.registerScaleType("financialLinear",t,{position:"left",ticks:{callback:function(e){return e}}})}},{}]},{},[8]);var Je,O=y.Tools;function B(e){var n=Je.call(this,e)||this,i=(n.layers=new j,n.dataSources={},n.animation=new Z,n.isTransposed=!1,n.focus=[],n.errors={},n.isPendingFirstOnSettingsChange=!0,n.isReadyForThemeChange=!1,n.clicks=0,n.delay=300,n.previousClicked="",n.globalPalette=[],n.dashboardViewModel=e.dashboardViewModel,B.docViewModel=e.viewModel,n.api=e.api,n.api.setProperty);return n.api.setProperty=function(e,t,a){a&&a.bypass||(t=b.replaceViewStatesWithModel(e,t,n.api)),i.call(n.api,e,t,a)},n.el.innerHTML=ce.app({}),n.el.classList.add("chartjs"),n.ctx=n.el.querySelector(".chart-container").querySelector("canvas").getContext("2d"),n.disablePointerEventsOnMask(),n.listenTo(n.layers,"add reset",function(e){n.initLayerListeners(e),n.setThemeAccordingToDashboardSettings()}),n.listenTo(n.layers,"remove",function(e){e.stopListening()}),n.listenTo(n.layers,"update",function(e,t){n.updatePossibleLayers();var a=0<t.changes.added.length+t.changes.removed.length;_.throttle(function(){!a&&n.animation&&n.animation.get("Enabled")?n.updateChart():n.initializeChart()})}),n.xAxes=n.initAxis("XAxes"),n.yAxes=n.initAxis("YAxes"),n.legendModel=new ie({app:n,externalDiv:n.el.querySelector(".chart-legend")}),n.listenTo(n.legendModel,"change",n.updateChart.bind(n)),n.listenTo(n.legendModel,"change:layerState",function(){_.each(n.layers.models,function(e){e.set("Basics.Enabled",n.legendModel.layerState[e.get("_Hidden._LayerId")])}),_.each(n.api.getProperty("Layers"),function(e,t){e=n.legendModel.layerState[e._Hidden._LayerId];n.api.setProperty("Layers."+t+".Basics.Enabled",e,{bypass:!0})})}),n.listenTo(n.animation,"change",n.updateChart.bind(n)),n.crosshairModel=new re({api:n.api,dataSources:n.dataSources,el:n.el,layers:n.layers,xAxes:n.xAxes,yAxes:n.yAxes}),n.listenTo(n.crosshairModel,"change:Basics.Selected",function(){var t,e,a,i,o,r;(n.api.getPropertyMeta("Basics.Selected").viewstateType||n.api.getPropertyMeta("Basics.Focus").viewstateType)&&(e=n.crosshairModel.get("Basics.Selected"),r=_.get(e,"datasetIndex"),a=_.get(n,"chart.data.datasets"),t=_.get(a[r],"layerId"),a)&&!_.isNil(r)&&t&&(r=(a=n.layers.find(function(e){return e.get("_Hidden._LayerId")===t})).get("Basics.Data"),r=n.dataSources[r.cid],e=e.index,r.getData())&&void 0!==(e=r.getData().at(e))&&(a=r.getPropertyFromColumn(a.get("Axes.XAxisData")),i=r.getDepth(),o=_.clone(n.focus),r=12<=(r=r.getColumnType(a))&&r<=19?O.convertKDBTemporalToMoment(e.get(a)).toDashString():""+e.get(a),o[i]=r,n.api.setProperty("Basics.Focus",o.join(","),{bypass:!0}),n.api.setProperty("Basics.Selected",r,{bypass:!0}))}),n.listenTo(n.crosshairModel,"change:Basics.Hover",function(){if(n.api.getPropertyMeta("Basics.Hover").viewstateType){var t=n.crosshairModel.get("Basics.Hover");if(!t)return n.api.setProperty("Basics.Hover",t,{bypass:!0});var e=n.layers.find(function(e){return e.get("_Hidden._LayerId")===n.chart.data.datasets[t.datasetIndex].layerId}),a=e.get("Basics.Data"),a=n.dataSources[a.cid],i=t.index;a.getData()&&void 0!==(i=a.getData().at(i))&&(e=a.getPropertyFromColumn(e.get("Axes.XAxisData")),a=12<=(a=a.getColumnType(e))&&a<=19?O.convertKDBTemporalToMoment(i.get(e)).toDashString():""+i.get(e),n.api.setProperty("Basics.Hover",a,{bypass:!0}))}}),n.panModel=new se({el:n.el}),n.listenTo(n.panModel,"MinMaxChange",function(e){n.api.setProperty("Zoom.Min",e.get("Min"),{bypass:!0}),n.api.setProperty("Zoom.Max",e.get("Max"),{bypass:!0})}),n.listenTo(n.panModel,"cleanChart",function(){n.initializeChart()}),n.fileExportModel=new r.DeepModel,n.fileExporterView=new ge({api:n.api,appView:n,el:ce.fileExporter({}),getCanvas:function(){return n.ctx.canvas},getExportConfig:function(){return{altFileName:"",columnsConfig:{dataSources:n.dataSources,layers:n.layers,xAxes:n.xAxes,yAxes:n.yAxes},fileName:n.fileExportModel.get("FileExport.FileName"),workSheetTitle:"ChartJs"}},model:n.fileExportModel}),n.listenTo(n.fileExportModel,"change:FileExport.Enabled",n.toggleToolsPanel.bind(n)),n.el.querySelector(".tools-panel").append(n.fileExporterView.el),n.highlightRulesModel=new ee({api:n.api,el:n.el}),n.el.querySelector(".active-mouse").addEventListener("click",function(e){return n.ZoomPanToolHandler(e)}),n.el.querySelector(".reset-chart").addEventListener("click",function(e){return n.ZoomPanToolHandler(e)}),n.el.querySelector(".reset-chart-level").addEventListener("click",function(e){return n.ZoomPanToolHandler(e)}),n.el.querySelector(".reset-chart-level-in").addEventListener("click",function(e){return n.ZoomPanToolHandler(e)}),n.globalPalette=e.dashboardAppModel.get("globalPalettes"),n.api.setProperty("possiblePalettes",_.map(_.uniqBy(n.globalPalette,"rule"),"rule")),n}return Je=r.View,e(B,Je),B.convertToMomentOrDuration=function(e,t){var a=t;return e&&e._isAMomentObject?a=O.convertDateStringValueToMoment(t,O.timezone):e&&(a=O.convertValueToDuration(t,e._kdbType)),a},B.prototype.onSettingsChange=function(e){var t=!!this.isPendingFirstOnSettingsChange,a=(this.isPendingFirstOnSettingsChange&&(this.isPendingFirstOnSettingsChange=!1),b.expandNestedViewStates(e,this.api)),a=b.replaceViewStatesWithValue("",a,this.api),a=b.pump(a);this.onSettingsChangeProcessed.call(this,a,e),t&&(this.isReadyForThemeChange=!0,this.isPendingFirstOnSettingsChange=!1,this.setThemeAccordingToDashboardSettings())},B.prototype.updateError=function(e,t){function a(e){return"Error"===e?3:"Loading"===e?2:"NoResults"===e?1:0}var i=this,e=e.getKey(),t=(t?this.errors[e]=t:delete this.errors[e],_.reduce(this.errors,function(e,t){t=t.type;return a(t)>a(e)?t:e},""));t&&("NoResults"!==t||Object.keys(this.dataSources).length===Object.keys(this.errors).length)?(e=_.map(this.errors,function(e,t){e=e.error,t=i.dataSources[t];return e?"["+t.getPath()+"]: "+e:null}).filter(function(e){return e}),this.api.showQueryStatus({error:e.join("\n"),type:t})):this.api.hideQueryStatus()},B.prototype.updateDataSource=function(a){var i=this;if(this.dataSources[a.getKey()]){var e=this.layers.filter(function(e){e=e.get("Basics.Data");return e&&e.cid===a.getKey()}),o=!0,r=this.getDefaultConfig(a);if(e.forEach(function(e,t){e.updateData(a,i.xAxes,i.yAxes),e.set("_Hidden._PossibleRadius",_.union(["Fixed Size"],a.getColumnNames())),e.set("_Hidden._PossibleColumnsWithXYKey",_.union(["<thisX>","<thisY>","<thisName>"],a.getColumnNames())),e.set("_Hidden._PossibleColumnsWithEmptyKey",_.union([""],a.getColumnNames())),e.set("_Hidden._PossibleColumnsWithItself",_.union(["<this>"],a.getColumnNames())),e.set("_Hidden._PossibleColumns",a.getColumnNames()),0===t&&""===e.get("Axes.YAxisData")&&(e.set("Axes.YAxisData",r.y),o=!1),0===t&&""===e.get("Axes.XAxisData")&&(e.set("Axes.XAxisData",r.x),o=!1)}),!e.length)return;this.api.setProperty("Layers",this.layers.toJSON().map(function(e,t){return i.api.setProperty("Layers."+t+"._Hidden._PossibleColumns",_.get(e,"_Hidden._PossibleColumns")),e.Actions=i.api.getProperty("Layers."+t+".Actions"),e}),{silent:o})}this.updatePatternsForBars(),this.animation&&this.animation.get("Enabled")?this.updateChart():this.initializeChart()},B.prototype.getDefaultConfig=function(e){var a=this,i=!1,o=!1,r={x:"",y:""},t=["12","15","14","16","17","18","19","13"],n=["11","10"],s=["9","8","7","6","5","4"],l=["0","2","1"],d=_.chain(e.meta).groupBy("kdbType").map(function(e,t){return{key:t,val:e,count:e.length}}).orderBy("count","desc").value(),s=this.sortColumnByPopularity(s,_.map(d,"key"));return _.each(_.concat(t,n,s,l),function(t){!i&&0<_.filter(d,function(e){return e.key===t}).length&&(r.x=_.get(e,"breakdownColumns")&&0<_.get(e,"breakdownColumns").length?"{breakdownId}":_.map(_.filter(d,function(e){return e.key===t})[0].val,"id")[0],i=!0)}),_.each(_.concat(s,t,n,l),function(t){!o&&0<_.filter(d,function(e){return e.key===t}).length&&(r.y=a.columnsToRegex(_.filter(d,function(e){return e.key===t})[0]),o=!0)}),r},B.prototype.sortColumnByPopularity=function(t,e){return _.filter(e,function(e){return 0<=t.indexOf(e)})},B.prototype.columnsToRegex=function(e){e=_.map(e.val,"id");return 0<e.length?"/^("+e.slice(0,5).join("|")+")$/":"*"},B.prototype.disablePointerEventsOnMask=function(){var e=this.el[0];e&&_.get(e,"parentElement.parentElement")&&(_.get(e,"parentElement.parentElement").getElementsByClassName("queryStatus")[0].style.pointerEvents="none")},B.prototype.initLayerListeners=function(a){function e(e){return"change:"+e}var i=this,t=(this.stopListening(a),this.listenTo(a,"change:_Hidden._Type",this.initLayerListeners.bind(this)),["XAxes","YAxes"].forEach(function(e){var t="XAxes"===e?i.xAxes:i.yAxes,t=_.map(t.map("_Hidden"),"_Label");a.get("Axes."+e.replace("e","i")+"ID").length||a.set("Axes."+e.replace("e","i")+"ID",e.replace("e","i")+" 1"),a.set("_Hidden._Possible"+e,t),a.setPalette(i.getPalette()),i.listenTo(a,"change:_Hidden._Possible"+e,function(e){e.setPalette(i.getPalette()),i.api.setProperty("Layers",i.layers.toJSON(),{silent:!0}),i.onSettingsLayersChanged(i.layers.toJSON())})}),W.dataFieldsMap[a.get("_Hidden._Type")]),o=W.visualFieldsMap[a.get("_Hidden._Type")],t=t.map(e).join(" "),o=o.map(e).join(" ");this.listenTo(a,t,this.onLayerDataEvents.bind(this)),this.listenTo(a,o,this.onLayerVisualEvents.bind(this))},B.prototype.initAxis=function(i){var o=this,t=new K;return this.listenTo(t,"add",function(e){o.updatePossibleAxes(i),e.isNumerical()&&(e.set("Labels.Reverse",!!e.get("Labels._ReverseCache"),{silent:!0}),o.api.setProperty(i,t.toJSON(),{silent:!0})),o.setThemeAccordingToDashboardSettings()}),this.listenTo(t,"remove",function(){o.updatePossibleAxes(i)}),this.listenTo(t,"update",function(){o.initializeChart()}),this.listenTo(t,"change:Range.UseMinMax change:Range.SoftRange change:Title.Display change:Labels.Display change:Labels.Reverse change:Labels._ReverseCache",function(){o.api.setProperty(i,t.toJSON())}),this.listenTo(t,"change:Labels.Format, change:Labels.DateFormat, change:Labels.FilterUnique",function(){o.layers.each(o.onLayerDataEvents.bind(o))}),this.listenTo(t,"cache",function(e){var t=e.model,a=i+"."+t.get("_Hidden._Index")+".";b.cache(t,a,e,o.api)}),t},B.prototype.getPalette=function(){var a=this;return this.api.getProperty("Style.Palette").map(function(e,t){return a.api.getProperty("Style.Palette.".concat(t,".type"))})},B.prototype.onSettingsChangeProcessed=function(t,a){var i,e,o=this;_.isObject(t.Animations)&&this.onSettingsAnimationsChanged.call(this,t.Animations),_.isObject(t.Basics)&&this.onSettingsBasicsChanged.call(this,t.Basics),["XAxes","YAxes"].forEach(function(e){_.isArray(t[e])&&o.onSettingsAxesChanged.call(o,e,t[e])}),_.isArray(t.Layers)&&!_.isEqual(this.layers.toJSON(),t.Layers)&&(i=/^Layers\.\d+\.Basics\.Enabled$/,e=Object.keys(a),_.some(e,function(e){return!e.match(/^Layers\.\d+\.Actions\.\d+\.Target$/)&&!e.match(/^Layers\.\d+\._Hidden._PossibleColumns$/)})&&this.onSettingsLayersChanged.call(this,t.Layers),_.each(e,function(e){i.test(e)&&_.get(o.chart,"data.datasets")&&o.onSettingsLayersEnabledChanged.call(o,t.Layers,a)})),(_.isObject(t.Style)||_.isEqual(Object.keys(t),["Palette"]))&&this.onSettingsStyleChanged.call(this),_.isObject(t.Zoom)&&(this.onSettingsZoomChanged.call(this,t.Zoom),this.ZoomPanToolPanel(t)),_.isObject(t.Overlay)&&this.onSettingsCrosshairChanged.call(this,t.Overlay),_.isObject(t.Legend)&&this.onSettingsLegendChanged.call(this,t.Legend),_.isObject(t.FileExport)&&this.onSettingsFileExportChanged.call(this,t.FileExport),_.isObject(t.Basics)&&t.Basics.hasOwnProperty("Transpose")&&this.onSettingsOrientationChanged.call(this,t.Basics.Transpose),this.chart&&t.hasOwnProperty("Layers")&&(this.updateChart(),this.legendModel.restoreLayerState(this.chart))},B.prototype.updatePatternsForBars=function(){var a=this,i=0;this.layers.forEach(function(e){var t;"Bar"===e.get("_Hidden._Type")&&(t={},a.api.getProperty("Basics.UsePatterns")&&Object.keys(e.getChartDataMapping()).forEach(function(e){t[e]=O.Patterns[i%O.Patterns.length],i++}),e.setPatterns(t),e.updateVisuals())})},B.prototype.onSettingsAxesChanged=function(a,e){var t="XAxes"===a?this.xAxes:this.yAxes,i=_.map(t.map("_Hidden"),"_AxisId"),o=e.filter(function(e){return!_.get(e,"_Hidden._AxisId")});o.length?(o.forEach(function(e){for(;!e._Hidden._AxisId||_.includes(i,e._Hidden._AxisId);)e._Hidden._AxisId=_.uniqueId("axis_")}),this.api.setProperty(a,e)):(e.forEach(function(e,t){e._Hidden._Index=t,e._Hidden._Label="".concat(n.singular(a)," ").concat(t+1)}),t.set(e))},B.prototype.onSettingsAnimationsChanged=function(e){var t=this;e.hasOwnProperty("Enabled")?(e.Enabled?b.cache(this.animation,"Animations.",{load:["Duration","Easing"],defaults:[400,"easeOutQuart"]},this.api):b.cache(this.animation,"Animations.",{store:["Duration","Easing"]},this.api),this.animation.set(e),_.defer(function(){t.api.setProperty("Animations",t.animation.toJSON())})):this.animation.set(e),e.hasOwnProperty("HoverEvents")&&this.initializeChart()},B.prototype.onSettingsBasicsChanged=function(e){var t=this;e.Selected&&this.chart&&this.crosshairModel.updateSelectedFromViewState(e),e.hasOwnProperty("Hover")&&this.chart&&this.crosshairModel.updateHoverFromViewState(e),e.hasOwnProperty("SortBy")&&this.chart&&this.updateChart(),e.hasOwnProperty("UsePatterns")&&this.chart&&(this.updatePatternsForBars(),this.updateChart()),void 0!==e.Focus&&(this.focus=_.first(b.focus2Array(e.Focus))||[],_.each(this.dataSources,function(e){e.setFocus(t.focus),t.api.getPropertyMeta("Basics.Focus").viewstateType&&t.crosshairModel.set("Basics.Selected",t.focus)}))},B.prototype.onSettingsCrosshairChanged=function(e){this.crosshairModel.set(e),this.crosshairModel.onSettingsChange(e)},B.prototype.onSettingsFileExportChanged=function(e){var a=this;this.fileExportModel&&(_.each(e,function(e,t){a.fileExportModel.set("FileExport."+t,e)}),4<_.keys(e).length)&&void 0===this.fileExportModel.get("FileExport.Enabled")&&(this.api.hasPermission(y.CustomAPIPermission.canExportData)&&(e.ShowExportCsvButton||e.ShowExportExcelButton||e.ShowScreenshot)?this.fileExportModel.set("FileExport.Enabled",!0):this.fileExportModel.set("FileExport.Enabled",!1))},B.prototype.onSettingsLayersChanged=function(e){var i,a,o,r=this,n=_.map(this.layers.map("_Hidden"),"_LayerId"),t=e.filter(function(e){return _.get(e,"_Hidden")}).filter(function(e){return!e._Hidden._LayerId});t.length?(i=this.layers,t.forEach(function(t){var e,a=["Basics.BackgroundColor","Basics.BackgroundOpacity","Basics.BorderColor","Basics.BorderWidth","Basics.LegendLabelColor","Basics.LegendLabelColor","Basics.BorderColor","Axes","Actions","HighlightRules","Basics.Data","Basics.Enabled"];for(0<i.models.length?(e=i.models[i.models.length-1].attributes._Hidden._Type,"Line"===(t._Hidden._Type=e)?a.push("Interpolation","Line","Points"):(t.Points=null,t.Interpolation=null,t.Line=null),"Bubble"===e?a.push("Bubbles"):t.Bubbles=null,"Bar"===e?a.push("Bars"):t.Bars=null,"Waterfall"===e?a.push("Waterfall"):t.Waterfall=null,a.forEach(function(e){e=e.split(".");1===e.length?t[e[0]]&&i.models[i.models.length-1].attributes[e[0]]?t[e[0]]=i.models[i.models.length-1].attributes[e[0]]:t[e[0]]={}:2===e.length&&t[e[0]]&&i.models[i.models.length-1].attributes[e[0]]&&(t[e[0]][e[1]]=i.models[i.models.length-1].attributes[e[0]][e[1]])}),e=r.api.getProperty("Style.Palette"),t.Basics.Name=r.layers.getUniqueLayerName(i.models[i.models.length-1].attributes.Basics.Name),t.Basics.BackgroundColor=e[i.models.length%e.length].type,t.Basics.BorderColor=e[i.models.length%e.length].type,t.Points&&(t.Points.PointBackgroundColor=e[i.models.length%e.length].type,t.Points.PointBorderColor=e[i.models.length%e.length].type,t.Points.PointHoverBackgroundColor=e[i.models.length%e.length].type,t.Points.PointHoverBorderColor=e[i.models.length%e.length].type),t.Bars&&(t.Bars.HoverBackgroundColor=e[i.models.length%e.length].type,t.Bars.HoverBorderColor=e[i.models.length%e.length].type,t.Bars.BarPercentage=90,t.Bars.BarThickness=10,t.Bars.BarWidthType="percentage",t.Bars.CategoryPercentage=80),t.Bubbles&&(t.Bubbles.HoverBackgroundColor=e[i.models.length%e.length].type,t.Bubbles.HoverBorderColor=e[i.models.length%e.length].type),t.Line&&(t.Line.Fill="noFill")):t.Basics.Name=t.Basics.Name||"Layer 1";!t._Hidden._LayerId||_.includes(n,t._Hidden._LayerId);)t._Hidden._LayerId=_.uniqueId("layer_")}),this.api.setProperty("Layers",e)):(a=!1,e.forEach(function(e,t){_.isNil(_.get(e,"_Hidden._Index"))||(e._Hidden._Index=t,a=!0)}),a&&(this.layers.set(e),this.legendModel.updateLayerStatefromOnSettingsChanged(e),(t=_.chain(e).map("Basics").map("Data").filter(Boolean).uniq().value()).forEach(function(a){var e=r.dataSources[a.cid];e?e.hasData()&&r.updateDataSource(e):(e=new Q(a,r,r.api,r.focus),r.dataSources[a.cid]=e,r.listenTo(a,"change:queryStatus",function(e,t){r.updateError(r.dataSources[a.cid],t)}),e.subscribe())}),o=_.fromPairs(_.map(t,function(e){return[e.cid,!0]})),_.each(this.dataSources,function(e){var t=e.getSource();t&&!o[t.cid]&&(r.stopListening(t),delete r.dataSources[e.getKey()],e.unsubscribe(),r.updateDataSource(e),r.updateError(e,void 0))})))},B.prototype.onSettingsLegendChanged=function(e){this.legendModel.set(e),this.chart&&(this.legendModel.renderhtmlLegend(this.chart),this.chart.options.legend=this.legendModel.computeLegendProp(),this.chart.update())},B.prototype.onSettingsLayersEnabledChanged=function(o,r){var n=this,e=Object.keys(r);_.each(e,function(t){var a,i=t.split(".").map(function(e){return _.isNaN(parseInt(e,10))?e:parseInt(e,10)}),e=o[i[1]];_.get(e,"_Hidden._LayerId")&&(a=_.get(e,"_Hidden._LayerId"),e=_.filter(n.chart.data.datasets,function(e){return e.layerId===a}),_.each(e,function(e){_.each(Object.values(e._meta),function(e){n.chart.getDatasetMeta(_.get(e,"index")).hidden=!r[t]}),n.layers.at(i[1]).set("Basics.Enabled",r[t])}))}),this.crosshairModel.setLayers(this.layers)},B.prototype.onSettingsOrientationChanged=function(e){this.isTransposed=e,this.api.getProperty("Overlay.TooltipsEnabled")&&this.isTransposed&&this.api.setProperty("Overlay.TooltipsIntersect",!0,{silent:!0}),this.panModel.isTransposed=this.isTransposed,this.crosshairModel.isTransposed=this.isTransposed,this.el.querySelector(".reset-chart").classList.toggle("hidden",this.isTransposed),this.initializeChart()},B.prototype.onSettingsStyleChanged=function(){var t=this,a=""+(null==(e=this.dashboardViewModel)?void 0:e.get("DashboardTheme")),i=".palette_theme",o=this.api.getProperty("Style.palettes"),e=_.filter(this.globalPalette,function(e){var t=".dark"!==_.get(e,"theme")&&".light"!==_.get(e,"theme")||e.theme.toLowerCase()==="."+a.toLowerCase();return e.rule===i&&t}),r=(_.isEmpty(o)||" "===o||o===i)&&0<e.length,n=!1,s=[],l=(r?_.each(e,function(e){s.push({type:y.Tools.rgbStr2hex(e.color)}),n=!0}):o&&_.each(this.globalPalette,function(e){var t=".dark"!==_.get(e,"theme")&&".light"!==_.get(e,"theme")||e.theme.toLowerCase()==="."+a.toLowerCase();!_.isEmpty(e.rule.trim())&&e.rule===o&&t&&(s.push({type:y.Tools.rgbStr2hex(e.color)}),n=!0)}),n&&this.api.setProperty("Style.Palette",s),this.getPalette());this.layers&&this.layers.models&&(_.each(this.layers.models,function(e){e.setPalette(l),t.onLayerVisualEvents(e)}),this.updateChart())},B.prototype.onSettingsZoomChanged=function(e){this.panModel.set(e),this.panModel.updateDebouncer(e),this.toggleToolsPanel()},B.prototype.destroyChart=function(){this.chart&&(this.chart.destroy(),delete this.chart)},B.prototype.onResize=function(){this.chart&&this.legendModel&&(this.chart.resize(!1),this.legendModel.renderhtmlLegend(this.chart))},B.prototype.initializeChart=function(){var e,t,a,i,o=this.api.getProperty("Basics.WarningOnNoData");this.chart&&this.chart.preventUpdate?this.chart.isDirty=!0:(this.legendModel&&_.get(this,"chart.legend")&&this.legendModel.setLegendStateProps(_.mapValues(_.keyBy(this.chart.legend.legendItems,"text"),"hidden")),this.destroyChart(),t=(e=this.prepareChart()).datasets,i=e.labels,e=e.options,t&&i&&e&&this.setMinMaxTime(e,t)&&(t={crosshairModel:this.crosshairModel,data:{datasets:t,labels:i},legendModel:this.legendModel,options:e,panModel:this.panModel,plugins:[this.panModel,this.crosshairModel,this.highlightRulesModel.highlightPlugin],timezone:O.timezone,type:this.isTransposed?"horizontalBar":"bar"},this.isTransposed||(a=_.get(t,"options.scales.yAxes"))&&a.forEach(function(e,t){"linear"===a[t].type&&(a[t].type="arrayLinear")}),i=!1,t.data&&t.data.datasets&&(this.legendModel.restoreLayerStateOnDatasets(t.data.datasets),o)&&(i=0===t.data.datasets.filter(function(e){return _.get(e,"data.length")}).length),this.chart=new E(this.ctx,t),this.legendModel.renderhtmlLegend(this.chart),i?this.api.showQueryStatus({message:"No Data",type:0}):this.api.hideQueryStatus()))},B.prototype.updateChart=function(){var i=this;if(this.chart&&this.chart.preventUpdate)this.chart.isDirty=!0;else if(!this.chart||this.isTransposed)this.initializeChart();else{var e=this.prepareChart(),t=e.datasets,a=e.labels,e=e.options;if(t&&a&&e)if(this.setMinMaxTime(e,t)){_.merge(this.chart.options,e),t.forEach(function(e){var t,a=_.find(i.chart.data.datasets,{id:e.id});a?(t=e.data,_.merge(a,e),a.data=t):i.chart.data.datasets.push(e)});for(var o=_.fromPairs(t.map(function(e){return[e.id,!0]})),r=0;r<this.chart.data.datasets.length;r++)o[this.chart.data.datasets[r].id]||(this.chart.data.datasets.splice(r,1),r--);this.chart.data.datasets.sort(function(e,t){return t.index-e.index}),this.chart.data.labels=a,this.chart.update()}else this.chart&&(this.chart.destroy(),delete this.chart)}},B.prototype.prepareChart=function(){var e,t,a=this;if(!this.layers.length||!this.xAxes.length||!this.yAxes.length)return{};if(this.isTransposed){if(o=_.cloneDeep(_.orderBy(_.flatMap(this.layers.models,"dataset").filter(_.negate(_.isEmpty)),"index","desc")),_.includes(o.map(function(e){return e.type}),"boxplot")||_.includes(o.map(function(e){return e.type}),"waterfall")||_.includes(o.map(function(e){return e.type}),"violin")||_.includes(o.map(function(e){return e.type}),"candlesticks"))return{};_.each(o,function(e,t){o[t].type="bar"===o[t].type?"horizontalBar":o[t].type;var a=e.xAxisID,i=e.yAxisID;o[t].xAxisID=i,o[t].yAxisID=a,o[t].data=e.data.map(function(e){return{r:e.r||void 0,x:e.y,y:e.x}})})}else var i=this.layers.models,o="x"===this.api.getProperty("Basics.SortBy")?_.each(_.flatMap(i,"dataset"),function(e){e.data=_.sortBy(e.data,"x","desc")}):_.orderBy(_.flatMap(i,"dataset").filter(_.negate(_.isEmpty)),"index","desc");return this.layers.some(function(e){e=e.get("Basics.Data");return!e||!a.dataSources[e.cid]||!a.dataSources[e.cid].hasData()})?{}:(i=this.layers.at(0).getLabels(),e={xAxes:(this.isTransposed?this.yAxes:this.xAxes).map(n.extractScales),yAxes:(this.isTransposed?this.xAxes:this.yAxes).map(n.extractScales)},t=this.api.getProperty("Animations.InteractionMode"),t=_.merge({},{animation:{duration:0},layout:{padding:{bottom:0}},maintainAspectRatio:!1,responsive:!0},{animation:this.animation.toChartJSON(),hover:{mode:"x"===t?this.isTransposed?"y":"x":t},layout:this.legendModel.computeLayoutProp(this.highlightRulesModel.showHeighlightRulesLegend()),legend:this.legendModel.computeLegendProp(),onClick:this.doActions.bind(this),onHover:this.doActions.bind(this),scaleOverride:!0,scaleStepWidth:50,scales:e,tooltips:{enabled:!1,mode:"point"}}),this.animation.get("HoverEvents")||(t.events=["mouseout","click","touchstart","touchmove"]),{datasets:_.clone(o),labels:_.clone(i),options:_.clone(t)})},B.prototype.ZoomPanToolPanel=function(e){_.includes(_.keys(e),"Zoom")&&((e=this.api.getProperty("Zoom")).DragZoom&&e.DragPan?this.el.querySelector(".active-mouse").classList.toggle("hidden1",!1):this.el.querySelector(".active-mouse").classList.toggle("hidden1",!0),e.DragZoom||e.ScrollZoom?this.el.querySelector(".reset-chart").classList.toggle("hidden1",!1):this.el.querySelector(".reset-chart").classList.toggle("hidden1",!0))},B.prototype.toggleToolsPanel=function(){var e,t;this.fileExportModel.has("FileExport")&&this.legendModel&&(t=this.api.getProperty("Zoom.DragZoom")||this.api.getProperty("Zoom.ScrollZoom"),e=this.fileExportModel.get("FileExport.Enabled"),this.legendModel.toolsEnabled||!t&&!e?t||e||(this.legendModel.toolsEnabled=!1,(t=this.el.querySelector(".tools-panel"))&&t.classList.toggle("disabled",!t.classList.contains("disabled")),this.updateChart()):(this.legendModel.toolsEnabled=!0,this.el.querySelector(".tools-panel")&&this.el.querySelector(".tools-panel").classList.remove("disabled"),this.updateChart()))},B.prototype.ZoomPanToolHandler=function(e){(e.target&&e.target.classList.contains("active")||e.target.classList.contains("active-mouse"))&&(e.target.classList.contains("active-mouse")&&e.target.classList.contains("pan-tool")&&this.el.querySelector(".active-mouse")&&(this.el.querySelector(".active-mouse").classList.toggle("active"),this.panModel),e.target.classList.contains("reset-chart"))&&this.panModel.resetZoom()},B.prototype.onLayerDataEvents=function(e){var t=e.get("Basics.Data"),t=t?this.dataSources[t.cid]:void 0,a=_.isNil(t)?[]:t.getColumnNames();e.updateData(t,this.xAxes,this.yAxes),e.set("_Hidden._PossibleRadius",_.union(["Fixed Size"],a)),e.set("_Hidden._PossibleColumnsWithXYKey",_.union(["<thisX>","<thisY>","<thisName>"],a)),e.set("_Hidden._PossibleColumnsWithEmptyKey",_.union([""],a)),e.set("_Hidden._PossibleColumnsWithItself",_.union(["<this>"],a)),e.set("_Hidden._PossibleColumns",a),this.api.setProperty("Layers",this.layers.toJSON())},B.prototype.onLayerVisualEvents=function(e){e.updateVisuals()},B.prototype.doActions=function(o){var r=this;if(this.chart){var e=this.chart.getElementAtEvent(o);if(e.length){var n,s,l=e[0],e=l._datasetIndex,d=l._index,c=l._model,t=_.filter(this.layers.models,function(e){return 0<e.getDatasetLength()}),e=t.length-1-e,t=t[e=e<0||e>t.length-1?t.length-1:e],a=t.get("Basics.Data"),a=this.dataSources[a.cid],u=a.getData().at(d),i=_.get(a,"focus");if(!u&&i){u=a.getSource();for(var h=0;h<i.length-1;h++)var p=_.get(u,"dataSet.collection"),u=p?p.get(i[h]):u;a=_.get(u,"dataSet.collection");u=a?a.at(d):u}t.get("Actions")&&l&&(n=[],s=_.get(o,"timeStamp")?_.get(o,"timeStamp"):Date.now(),t.get("Actions").forEach(function(e,t){if(!("mousemove"===o.type&&"Hover"!==e.Trigger||"mousemove"!==o.type&&"Hover"===e.Trigger)){var a;switch(e.Current){case"<thisName>":a=c.datasetLabel;break;case"<thisX>":a=l._chart.data.datasets[l._datasetIndex].data[d].x;break;case"<thisY>":a=l._chart.data.datasets[l._datasetIndex].data[d].y;break;default:a=u.get(e.Current)}var i=!1;"Double Click"===e.Trigger&&20<s-r.clicks&&s-r.clicks<r.delay&&l===r.previousClicked?(i=!0,r.clicks=0,r.previousClicked=""):"Double Click"!==e.Trigger&&(i=!0),i&&n.push(m(m({},e),{Value:a,_PropertyIndex:t}))}}),0<=o.type.toLowerCase().indexOf("click")&&(this.clicks=s,this.previousClicked=l),0<n.length)&&this.api.doActions(n,"Layers.".concat(e,".Actions"))}}},B.prototype.setMinMaxTime=function(e,c){function t(t,a,i,e){var o,r,n,s,l,d;"time"!==t.type&&"linear"!==t.type&&"arrayLinear"!==t.type||!c[0]?"category"===t.type&&(_.isEmpty(p.get("Min"))||p.isReset||(t.ticks.min=p.get("Min")),_.isEmpty(p.get("Max"))||p.isReset||(t.ticks.max=p.get("Max"))):(n=r=void 0,o=e.find(function(e){return e.get("_Hidden._Label")===t.id}),s=_.map(_.filter(c,function(e){return e[a]===t.id&&e.data&&e.data.length&&(!o.get("Center")||u.legendModel.layerState[e.layerId]||!_.find(u.legendModel.layerState,function(e){return!0===e}))}),function(e){return _.filter(_.map(e.data,function(e){return e[i]}),function(e){return null!=e})}),l=_.min(_.map(s,function(e){return _.min(e)})),s=_.max(_.map(s,function(e){return _.max(e)})),(e=(o=e.find(function(e){return e.get("_Hidden._Label")===t.id})).get("Range"))&&e.UseMinMax?n=e.SoftRange?(r=null!==(d=b.convertPropertyIfMoment(e.SuggestedMin))&&l<d?l:d,null!==(d=b.convertPropertyIfMoment(e.SuggestedMax))&&d<s?s:d):e.UseDataRange?(r=l,s):(r=b.convertPropertyIfMoment(e.Min),b.convertPropertyIfMoment(e.Max)):"time"===t.type&&(r=l,n=s),o.get("Center")&&"number"==typeof parseFloat(o.get("Center"))&&"linear"===t.type&&(d=n||s,r=(e=parseFloat(o.get("Center")))-(s=Math.max(Math.abs(e-(r||l)),Math.abs(e-d))||1),n=e+s),(h=h&&(void 0===r||null!==r&&isFinite(r))&&(void 0===n||null!==n&&isFinite(n)))&&("time"===t.type?(t.ticks.min=r,t.ticks.max=n,t.ticks.kdbType=_.get(r,"_kdbType")?r.kdbType():""):(t.type,t.ticks.min=r,t.ticks.max=n),0<=t.id.indexOf("XAxis"))&&!1===g&&(l=B.convertToMomentOrDuration(r,p.get("Min")),d=B.convertToMomentOrDuration(n,p.get("Max")),"time"===t.type?(_.isEmpty(p.get("Min"))||p.isReset?p.isReset&&p.get("DefaultMin")&&(t.ticks.min=B.convertToMomentOrDuration(r,p.get("DefaultMin"))):t.ticks.min=l,_.isEmpty(p.get("Max"))||p.isReset?p.isReset&&p.get("DefaultMax")&&(t.ticks.max=B.convertToMomentOrDuration(n,p.get("DefaultMax"))):t.ticks.max=d):(t.type,_.isEmpty(p.get("Min"))||p.isReset||(t.ticks.min=parseFloat(p.get("Min"))),_.isEmpty(p.get("Max"))||p.isReset||(t.ticks.max=parseFloat(p.get("Max"))))))}var u=this,h=!0,p=this.panModel,g=p.get("ResetViewStateOnly");this.panModel.setDistribution(this.api.getProperty("XAxes.0.Labels.TimeFormats.Distribution"));return this.isTransposed?(_.each(e.scales.xAxes,function(e){return t(e,"xAxisID","x",u.yAxes)}),_.each(e.scales.yAxes,function(e){return t(e,"yAxisID","y",u.xAxes)})):(_.each(e.scales.xAxes,function(e){return t(e,"xAxisID","x",u.xAxes)}),_.each(e.scales.yAxes,function(e){return t(e,"yAxisID","y",u.yAxes)})),h},B.prototype.setTheme=function(e){var a,t=this.xAxes.models.concat(this.yAxes.models),i=this.layers.models,o="",r="Light"===e?(a="#FFFFFF",o="#F8F8F8","#000000"):(e="Dark",a="#000000","#F8F8F8"),e=e.toLowerCase(),e=(this.setThemesInDivs(".chart-container",e),this.setThemesInDivs(".tools-panel",e),t.forEach(function(t){_.each(["GridLines.GridLinesColor","Labels.FontColor","Title.FontColor"],function(e){new Color(t.get(e)).hexString()!==a&&new Color(t.get(e)).hexString()!==o||t.set(e,r)})}),this.api.getProperty("Legend.LabelColor"));(e&&e.toString().toLowerCase()===a.toLowerCase()||o&&e.toString().toLowerCase()===o.toLowerCase())&&this.legendModel.set("LabelColor",r),i.forEach(function(t){"Candlestick"===t.get("_Hidden._Type")&&_.each(["Basics.BorderColor"],function(e){new Color(t.get(e)).hexString()!==a&&new Color(t.get(e)).hexString()!==o||t.set(e,r)})}),this.api.setProperty("Legend",this.legendModel.toLegendJSON()),this.api.setProperty("XAxes",this.xAxes.toJSON(),{silent:!0}),this.api.setProperty("YAxes",this.yAxes.toJSON()),this.api.setProperty("Layers",this.layers.toJSON())},B.prototype.setThemesInDivs=function(e,t){e=this.el.querySelector(e);e&&(e.classList.remove("dark"),e.classList.remove("light"),e.classList.add(t))},B.prototype.setThemeAccordingToDashboardSettings=function(){this.isReadyForThemeChange&&this.setTheme(this.dashboardViewModel.get("DashboardTheme"))},B.prototype.updatePossibleAxes=function(t){var e="XAxes"===t?this.xAxes:this.yAxes,a=_.map(e.map("_Hidden"),"_Label");this.layers.forEach(function(e){e.set("_Hidden._Possible"+t,a)})},B.prototype.updatePossibleLayers=function(){this.layers.forEach(function(i){var e,t;"Line"===i.get("_Hidden._Type")?(e=i.collection.reduceRight(function(e,t,a){return[i===t?"nofill":"Layer "+(a+1)].concat(e)},["origin"]),t=_.compact(_.map(e,function(e,t){if(0<t)return"+"+t})),i.set("_Hidden._PossibleLayers",e.concat(t))):i.get("_Hidden._PossibleLayers")&&i.unset("_Hidden._PossibleLayers")});var o={RuleColor:"#F8F8F8",RuleName:"",RuleOperation:"",RuleValue:"",Show:!1};this.layers.models.forEach(function(e){var t=e.get("HighlightRules"),a=_.filter([_.last(t)],o),i=t.length-1;a.length&&0<i&&(e.unset("HighlightRules."+i,{silent:!0}),(a=m({},t[i-1])).RuleName=a.name+" copy",e.set("HighlightRules."+i,a))}),this.api.setProperty("Layers",this.layers.toJSON())},B.getComponentDefinition=c.getComponentDefinition,B.getDefaultJSON=c.getDefaultJSON,B.getDefaultJSONTemplates=c.getDefaultJSONTemplates,B.mergeWithDefault=c.mergeWithDefault,B});