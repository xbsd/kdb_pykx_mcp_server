define(["Handlebars","QuickBase","moment","xlsx","jstree","css!./css/app.css"],function(k,M,L,c,d){"use strict";var y,g=this&&this.__extends||(y=function(t,e){return(y=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}))(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}y(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),T=this&&this.__spreadArray||function(t,e,i){if(i||2===arguments.length)for(var n,o=0,r=e.length;o<r;o++)!n&&o in e||((n=n||Array.prototype.slice.call(e,0,o))[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))},A=this&&this.__assign||function(){return(A=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},f=[{type:"#0061FF"},{type:"#F23A66"},{type:"#009BAB"},{type:"#7647CC"},{type:"#FFC300"},{type:"#9FA3A6"},{type:"#003A99"},{type:"#A90B31"},{type:"#005D67"},{type:"#452481"}],e={Trigger:{default:"Click",enum:["Click","Hover"],propertyOrder:2,title:"Trigger Action",type:"string"}},m=[{title:"Column Color",options:{linked_oneof_property:{property:"RuleType",value:"Column"}},properties:{RuleType:{options:{hidden:!0},title:"Rule Type",type:"string"},RuleName:{default:"",title:"Rule Name",type:"string"},RuleTarget:{default:"",title:"Rule Target (Column Name)",type:"customDropdown",data:"possible_columns",watch:{possible_columns:"root.possibleYDataCols"}},UsePalette:{title:"Use Color Palette",type:"boolean",default:!1},RuleColor:{default:"#F8F8F8",options:{gradient:!1,noColor:!1},title:"Rule Color",type:"gradient"},RuleColumnsPaletteTheme:{default:"",title:"Palette Theme",type:"string",enumSource:"possible_palettes",watch:{possible_palettes:"root.possiblePalettes"}},RuleColumnsPalette:{type:"array",format:"table",title:"Color Palette",options:{collapsed:!0},uniqueItems:!1,items:{type:"object",title:"Palette Color",properties:{type:{type:"gradient",options:{gradient:!1},title:"color",default:"#ffa500"}}},default:_.cloneDeep(f)}}},{title:"Layer Color Palette",options:{linked_oneof_property:{property:"RuleType",value:"Layer"}},properties:{RuleType:{options:{hidden:!0},title:"Rule Type",type:"string"},RuleName:{default:"",title:"Rule Name",type:"string"},RuleTarget:{default:"",title:"Rule Target (Layer Name)",type:"customDropdown",data:"possible_columns",watch:{possible_columns:"root.possibleLayers"},options:{dropdownMessage:"Please select a layer",dropdownType:"layer"}},RulePaletteTheme:{default:"",title:"Palette Theme",type:"string",enumSource:"possible_palettes",watch:{possible_palettes:"root.possiblePalettes"}},RuleColorPalette:{type:"array",format:"table",title:"Color Palette",options:{collapsed:!0},uniqueItems:!1,items:{type:"object",title:"Palette Color",properties:{type:{type:"gradient",options:{gradient:!1},title:"color",default:"#ffa500"}}},default:_.cloneDeep(f)}}},{title:"Axis Formatting",options:{linked_oneof_property:{property:"RuleType",value:"Axis"}},properties:{RuleType:{options:{hidden:!0},title:"Rule Type",type:"string"},RuleName:{default:"",title:"Rule Name",type:"string"},RuleTargetAxis:{default:"",title:"Rule Target (Axis)",type:"customDropdown",data:"possible_columns",watch:{possible_columns:"root.possibleAxes"},options:{dropdownMessage:"Please select an axis",dropdownType:"axis"}},RuleProperty:{default:"Prefix",options:{gradient:!1,noColor:!1},title:"Axis Property",type:"string",enum:["Prefix","Suffix","Decimal Places"]},RuleCondition:{default:"",title:"Rule Condition",type:"customDropdown",data:"possible_columns",watch:{possible_columns:"root.possibleDataCols"}},RuleAction:{default:"",title:"Rule Action",type:"string"}}}],i={RuleName:{default:"",propertyOrder:1,title:"Rule Name",type:"string"},RuleSource:{default:"",enumSource:"possible_columns",propertyOrder:3,title:"Rule Source",type:"string",watch:{possibleCols:"arrItem.possibleRulesColumns"}},RuleTarget:{enumSource:"possible_columns",default:"",propertyOrder:2,title:"Rule Target",type:"string",watch:{possibleCols:"arrItem.possibleYColumns"}},RuleType:{options:{hidden:!0},propertyOrder:4,title:"Rule Type",type:"string"},Show:{default:!1,format:"checkbox",propertyOrder:5,title:"Show Rule in Legend",type:"boolean"}},b=(r.getComponentDefinition=function(t){var e={id:667,componentName:"Editable Dropdown",componentDescription:"Editable dropdown",appKey:"EditableList",css:"EditableList",appArgs:{quickStart:[{path:"Layers.0.Data",message:"populate Data Source"}],json:{version:"v2.12.0",possibleLegendGroups:["None"],possiblePositions:["Top","Bottom","Left","Right"],Style:{advanced:""},Basics:{Name:"",Hover:"",Selected:"",Focus:"",SelectFirstPoint:!1,RangeSelection:!1,Zoom:!0,Duration:400,Easing:"easeOutQuart",TrackLoadTime:!1,LoadTime:"",UsePatterns:!1,UseHierarchicalRules:!0},Layers:[{_Id:"L0",_Type:G.Bubble,Data:"",CacheStreamingData:!1,XAxis:"",YAxis:"",XAxisMulti:"",XAxisId:"X-Axis 1",YAxisId:"Y-Axis 1",Color:_.clone(r.COLOR_DEFAULT),ColorData:"None",Opacity:80,Name:"",ShowCurrentTick:!1,Enabled:!0,Legend:!0,LegendGroup:"None",PaletteTheme:"",Bubbles:{RadiusData:"Fixed Size",RadiusScaling:4,ScaleOnZoom:!0,SetIconFromData:!1,Icon:"",DataIcon:"",DataIconColor:""},Palette:_.cloneDeep(f),Actions:[],HighlightRules:[],Labels:{Align:"center",Color:"#000000",Enabled:!1,Font:{Bold:!1,Size:12},Frequency:1,Offset:"0",Rotation:0,Template:"{{x}}, {{toFixed y 2}}",MaxLabels:10},possibleRadiusData:["Fixed Size"],possibleRulesColumns:[],possibleXColumns:[],possibleYColumns:[],possibleMultiColumns:[],possibleXAxes:["X-Axis 1"],possibleYAxes:["Y-Axis 1"]}],Xaxes:[{Bounds:"",Type:"Linear",Position:"Bottom",Width:0,Ticks:10,Color:"",FilterUnique:!0,Sort:!1,Stacked:!1,Title:{Display:!1,LabelString:"",FontSize:16},Format:{Display:!0,Rotation:0,BeginAtZero:!1,ShowMajorUnits:!1,Break:864e5,Distribution:"Linear",TriggerBreak:864e5,IntervalLength:0,Format:"Number",DateFormat:"",Precision:2,FontSize:12,Prefix:"",Suffix:"",HideTrailingZeroes:!1,MultiAxis:[]},Range:{UseMinMax:!1,Min:"",Max:"",SelectionMin:"",SelectionMax:"",ResetToNull:!0},Gridlines:{GridlinesOffset:!1,GridlinesColor:"",GridlinesOpacity:15}}],Yaxes:[{Bounds:"",Type:"Linear",Position:"Left",Width:0,Ticks:10,Color:"",FilterUnique:!0,Sort:!1,Stacked:!1,StackedGap:!1,Title:{Display:!1,LabelString:"",FontSize:16},Format:{Display:!0,Rotation:0,BeginAtZero:!1,ShowMajorUnits:!1,Break:864e5,Distribution:"Linear",TriggerBreak:864e5,IntervalLength:0,Format:"Number",DateFormat:"",Precision:2,FontSize:12,Prefix:"",Suffix:"",HideTrailingZeroes:!1},Range:{UseMinMax:!1,Min:"",Max:"",SelectionMin:"",SelectionMax:"",ResetToNull:!0},Gridlines:{GridlinesOffset:!1,GridlinesColor:"",GridlinesOpacity:15}}],Overlay:{ShowCrosshairs:!0,ShowCoordinates:!0,SnapToPoint:!0,UseCustomTooltip:!1,CustomTooltip:r.CUSTOM_TOOLTIP_DEFAULT,ShowAllLayers:!0,ShowAllPoints:!1,GroupByLayer:!1},Legend:{Position:"Top",UseCustomLegend:!1,CustomLegend:r.CUSTOM_LEGEND_DEFAULT,LegendGroups:[]},Annotations:{ShowAnnotateControl:!1,Annotations:""},FileExport:{Actions:[],FileName:[],ShowExportCsvButton:!1,ShowExportExcelButton:!1,ShowExportPngButton:!1,PngButton:"Export Png",UseChartFormat:!1},OverrideRules:[],HierarchicalRules:[]},schema:{type:"object",title:"Properties",properties:{possibleXColumns:{type:"readOnlyArray",items:{type:"string"},default:[],options:{collapsed:!0,hidden:!0}},possibleYColumns:{type:"readOnlyArray",items:{type:"string"},default:[],options:{collapsed:!0,hidden:!0}},possibleMultiColumns:{type:"readOnlyArray",items:{type:"string"},default:[],options:{collapsed:!0,hidden:!0}},possibleLegendGroups:{type:"array",options:{hidden:!0},default:["None"]},possiblePositions:{type:"array",options:{hidden:!0},default:["Top","Bottom","Left","Right"]},Basics:{propertyOrder:0,type:"object",title:"Basics",options:{collapsed:!0},properties:{Name:{title:"Name",type:"string",default:""},Hover:{title:"Hover",type:"string",default:""},Selected:{title:"Selected",type:"string",default:""},Focus:{title:"Focus",type:"string",default:""},SelectFirstPoint:{title:"Select First Point",type:"boolean",default:!1},RangeSelection:{title:"Range Selection",type:"boolean",default:!1},Zoom:{title:"Zoom",type:"boolean",default:!0},Duration:{title:"Animation Duration",type:"number",default:400},Easing:{title:"Animation Easing",type:"string",default:"easeOutQuart",enum:["swingFromTo","swingFrom","swingTo","easeFromTo","easeFrom","easeTo","easeInQuad","easeOutQuad","easeInOutQuad","easeInCubic","easeOutCubic","easeInOutCubic","easeInQuart","easeOutQuart","easeInOutQuart","easeInQuint","easeOutQuint","easeInOutQuint","easeInSine","easeOutSine","easeInOutSine","easeInExpo","easeOutExpo","easeInOutExpo","easeInCirc","easeOutCirc","easeInOutCirc","easeOutBounce","easeInBack","easeOutBack","easeInOutBack","bounce","bouncePast","elastic"]},TrackLoadTime:{title:"Track Load Time",default:!1,type:"boolean",format:"checkbox"},LoadTime:{title:"Load Time (ms)",type:"string",default:""},UsePatterns:{title:"Add Patterns to Bars",type:"boolean",default:!1},UseHierarchicalRules:{title:"Inherit Hierarchical Rules",type:"boolean",default:!0}}},possiblePalettes:{propertyOrder:2,type:"array",format:"table",default:[""],options:{collapsed:!0,hidden:!0}},possibleAxes:{type:"array",options:{hidden:!0}},possibleDataCols:{type:"array",options:{hidden:!0}},possibleYDataCols:{type:"array",options:{hidden:!0}},possibleLayers:{type:"array",options:{hidden:!0}},Layers:{propertyOrder:1,type:"array",items:{type:"object",id:"arrItem",title:"Layer",options:{collapsed:!0},headerTemplate:"{{#if self.Name}}{{valueProp self.Name }}{{else}}Layer {{ i1 }}{{/if}}",oneOf:[{title:G.Bubble,options:{linked_oneof_property:{property:"_Type",value:G.Bubble}},properties:_.extend({},r.LAYER_COMMON,r.LAYER_BASIC,r.LAYER_AXIS_VALS,{Bubbles:{title:"Bubbles",type:"object",options:{collapsed:!0},propertyOrder:11,properties:r.LAYER_BUBBLE}})},{title:G.Line,options:{linked_oneof_property:{property:"_Type",value:G.Line}},properties:_.extend({},r.LAYER_COMMON,r.LAYER_BASIC,r.LAYER_AXIS_VALS,{Line:{title:G.Line,type:"object",options:{collapsed:!0},propertyOrder:11,properties:{LineThickness:{title:"Line Width",type:"number",default:1,propertyOrder:7},LineStyle:{title:"Line Style",default:"None",enum:["None","Dashed","Dotted"],type:"string",propertyOrder:7},DashGap:{title:"Dash Gap",type:"number",default:1,propertyOrder:7},DashWidth:{title:"Dash Width",type:"number",default:1,propertyOrder:7},Fill:{title:"Fill",type:"dropdown",default:"No Fill",data:"possible_columns",watch:{possible_layers:"arrItem.possibleLayers"},propertyOrder:8},FillColor:{default:"#0061FF",options:{gradient:!1,noColor:!1},propertyOrder:8,title:"Fill Color",type:"gradient"},FillOpacity:{title:"Fill Opacity",type:"number",default:80,propertyOrder:8},FadeToTransparent:{title:"Fade to Transparent",type:"boolean",default:!1,propertyOrder:8},SpanGaps:{title:"Span Gaps",type:"boolean",default:!1,propertyOrder:8},Interpolation:{title:"Interpolation",type:"object",options:{collapsed:!0},propertyOrder:13,properties:{Interpolation:{title:"Interpolation",default:"Linear",enum:["Linear","Stepped","Monotone"],type:"string"},SteppedLine:{title:"Stepped Line",default:"After",enum:["Before","After"],type:"string"},SegmentLength:{title:"Curvature",default:20,type:"number"}}},PaletteTheme:{default:"",title:"Palette Theme",type:"string",enumSource:"possible_palettes",watch:{possible_palettes:"root.possiblePalettes"},propertyOrder:11},FillPalette:{title:"Fill Color Palette",type:"array",format:"table",options:{collapsed:!0},uniqueItems:!1,items:{type:"object",title:"Fill Palette Color",properties:{type:{type:"gradient",options:{gradient:!1},title:"color",default:"#ffa500"}}},default:_.cloneDeep(f),propertyOrder:12}}}},{Bubbles:{title:"Bubbles",type:"object",options:{collapsed:!0},propertyOrder:10,properties:_.extend({Color:{title:"Color",type:"gradient",options:{gradient:!1},default:_.clone(r.COLOR_DEFAULT)},Opacity:{title:"Opacity",type:"number",default:80}},r.LAYER_BUBBLE)}})},{title:G.Bar,options:{linked_oneof_property:{property:"_Type",value:G.Bar}},properties:_.extend({},r.LAYER_COMMON,r.LAYER_BASIC,r.LAYER_AXIS_VALS,{Bars:{title:"Bars",type:"object",options:{collapsed:!0},propertyOrder:10,properties:_.extend({},r.BAR_PROPERTIES,r.BORDER_PROPERTIES)}})},{title:G.Waterfall,options:{linked_oneof_property:{property:"_Type",value:G.Waterfall}},properties:_.extend({IncreaseColor:{default:"#7ad16f",options:{gradient:!1},title:"Increase Color",type:"gradient",propertyOrder:7},DecreaseColor:{default:"#d1776f",options:{gradient:!1},title:"Decrease Color",type:"gradient",propertyOrder:7}},r.LAYER_COMMON,r.LAYER_BASIC,r.LAYER_AXIS_VALS,{Bars:{title:"Bars",type:"object",options:{collapsed:!0},propertyOrder:10,properties:_.extend({},r.BAR_PROPERTIES,r.BORDER_PROPERTIES)}})},{title:G.Bounds,options:{linked_oneof_property:{property:"_Type",value:G.Bounds}},properties:_.extend({x1:{title:"X1 coordinate",propertyOrder:4,enumSource:"possible_columns",type:"string",watch:{possibleColumns:"arrItem.possibleXColumns"}},x2:{title:"X2 coordinate",propertyOrder:4,enumSource:"possible_columns",type:"string",watch:{possibleColumns:"arrItem.possibleXColumns"}}},r.LAYER_COMMON,r.LAYER_BASIC)},{title:G.Candlestick,options:{linked_oneof_property:{property:"_Type",value:G.Candlestick}},properties:_.extend({},r.LAYER_COMMON,r.LAYER_BASIC,r.LAYER_AXIS_VALS,{Open:{enumSource:"possible_columns",propertyOrder:3,title:"Open",type:"string",watch:{possibleColumns:"arrItem.possibleXColumns"}},High:{enumSource:"possible_columns",propertyOrder:3,title:"High",type:"string",watch:{possibleColumns:"arrItem.possibleXColumns"}},Low:{enumSource:"possible_columns",propertyOrder:3,title:"Low",type:"string",watch:{possibleColumns:"arrItem.possibleXColumns"}},Close:{enumSource:"possible_columns",propertyOrder:3,title:"Close",type:"string",watch:{possibleColumns:"arrItem.possibleXColumns"}},CandlestickFormat:{type:"object",title:"Candlestick Format",propertyOrder:11,options:{collapsed:!0},properties:_.extend({},r.BAR_PROPERTIES,{BearColor:{default:"#ff0000",options:{gradient:!1,noColor:!1},propertyOrder:5,title:"Bear Color",type:"gradient"},BullColor:{default:"#00ff00",options:{gradient:!1,noColor:!1},propertyOrder:5,title:"Bull Color",type:"gradient"},NeutralColor:{default:"#ffffff",options:{gradient:!1,noColor:!1},propertyOrder:5,title:"Neutral Color",type:"gradient"},WickColor:{default:"#7b8284",options:{gradient:!1,noColor:!1},propertyOrder:5,title:"Wick Color",type:"gradient"}})},YAxis:{options:{hidden:!0}}})},{title:G.Heatmap,options:{linked_oneof_property:{property:"_Type",value:G.Heatmap}},properties:_.extend({HeatmapX1:{enumSource:"possible_columns",propertyOrder:3,title:"X1 Coordinate",type:"string",watch:{possibleColumns:"arrItem.possibleXColumns"}},HeatmapX2:{enumSource:"possible_columns",propertyOrder:3,title:"X2 Coordinate",type:"string",watch:{possibleColumns:"arrItem.possibleXColumns"}},HeatmapY1:{enumSource:"possible_columns",propertyOrder:3,title:"Y1 Coordinate",type:"string",watch:{possibleColumns:"arrItem.possibleXColumns"}},HeatmapY2:{enumSource:"possible_columns",propertyOrder:3,title:"Y2 Coordinate",type:"string",watch:{possibleColumns:"arrItem.possibleXColumns"}},Score:{enumSource:"possible_columns",propertyOrder:3,title:"Score",type:"string",watch:{possibleColumns:"arrItem.possibleXColumns"}}},r.LAYER_COMMON,r.LAYER_BASIC)},{title:G.Baseline,options:{linked_oneof_property:{property:"_Type",value:G.Baseline}},properties:_.extend({Axis:{title:"Baseline Axis",type:"string",propertyOrder:4,enum:["X-Axis","Y-Axis"],default:"Y-Axis"},Value:{title:"Baseline Value",type:"string",propertyOrder:4,default:"0.5"}},r.LAYER_BASIC)}]}},Xaxes:{title:"X-Axes",type:"array",propertyOrder:2,options:{collapsed:!0},items:{title:"X-Axis",type:"object",options:{collapsed:!0},properties:{Bounds:{options:{hidden:!0}},Type:{title:"X-Axis Type",type:"string",propertyOrder:1,enum:["Linear","Category","Time","Logarithmic"],default:"Linear"},Position:{title:"Position",type:"string",enum:["Top","Bottom"],propertyOrder:2,default:"Bottom"},Width:{title:"Height",type:"number",propertyOrder:2,default:0},TickSpacing:{type:"boolean",title:"Tick Spacing",propertyOrder:2,enum:["Number of Ticks","Fixed Tick Interval (ms)"],default:"Number of Ticks"},Ticks:{type:"number",title:"Number of Ticks",propertyOrder:2,default:10},IntervalLength:{title:"Fixed Tick Interval (ms)",type:"number",default:0,propertyOrder:2},Color:{title:"Color",type:"gradient",options:{noColor:!0,gradient:!1},propertyOrder:2,default:""},FilterUnique:{title:"Filter Unique",type:"boolean",propertyOrder:2,default:!0},Sort:{title:"Sort",type:"boolean",propertyOrder:2,default:!0},Stacked:{title:"Stacked",type:"boolean",propertyOrder:2,default:!1},Title:{type:"object",title:"Title",options:{collapsed:!0},properties:{Display:{title:"Display",type:"boolean",default:!1},LabelString:{title:"Label String",type:"string",default:""},FontSize:{title:"Font Size",type:"number",default:16}}},Range:{type:"object",title:"Range",propertyOrder:2,options:{collapsed:!0,hidden:!1},properties:{UseMinMax:{title:"Use min max",type:"boolean",default:!1},Min:{title:"Min",type:"string",default:""},Max:{title:"Max",type:"string",default:""},SelectionMin:{title:"Selection Min",type:"string",default:""},SelectionMax:{title:"Selection Max",type:"string",default:""},ResetToNull:{title:"Reset to Null",type:"boolean",default:!0}}},Gridlines:{type:"object",title:"Gridlines",propertyOrder:3,options:{collapsed:!0},properties:{GridlinesOffset:{title:"Offset Gridlines",type:"boolean",default:!1},GridlinesColor:{title:"Gridlines Color",type:"gradient",options:{noColor:!0,gradient:!1},default:""},GridlinesOpacity:{title:"Gridlines Opacity",type:"number",default:15}}},Format:{type:"object",title:"Format",propertyOrder:4,options:{collapsed:!0},properties:{Display:{title:"Display",type:"boolean",default:!0,propertyOrder:1},Rotation:{title:"Rotation",type:"number",default:0,propertyOrder:1},BeginAtZero:{type:"boolean",title:"Begin at Zero",format:"checkbox",default:!1,propertyOrder:2},ShowMajorUnits:{type:"boolean",title:"Show Major Units",format:"checkbox",default:!1,propertyOrder:3},Break:{title:"Break (ms)",type:"number",default:864e5,propertyOrder:3},Distribution:{title:"Distribution",type:"string",enum:["Linear","Smart"],default:"Linear",propertyOrder:3},TriggerBreak:{title:"Trigger Break (ms)",type:"number",default:864e5,propertyOrder:3},Format:{title:"Numeric Format",type:"string",enum:["Number","Smart Number","Formatted Number"],default:"Number"},DateFormat:{default:"",enum:["","YYYY-MM-DD","YYYY-MMM-DD","YYYY-MMMM-DD","YYYY-MM","YYYY-MMM","YYYY-MMMM","MMM DD","MMM Do","YYYY-MM-DD HH:mm:ss","YYYY-MM-DD hh:mm:ss","YYYY-MM-DD kk:mm:ss","hh:mm:ss","kk:mm:ss","hh:mm:ss.SS","hh:mm:ss.SSS","hh:mm:ss.SSSSSS","hh:mm:ss.SSSSSSSSS","hh:mm","kk:mm","mm:ss","mm:ss.SS"],title:"Date/Time Format",type:"string"},Precision:{title:"Decimal Places",type:"number",default:2},FontSize:{title:"Font Size",type:"number",format:"number",default:12},Prefix:{title:"Prefix",type:"string",default:""},Suffix:{title:"Suffix",type:"string",default:""},HideTrailingZeroes:{type:"boolean",propertyOrder:4,title:"Hide Trailing Zeroes",format:"checkbox",default:!1},MultiAxis:{type:"array",title:"Multi Axis Format",options:{collapsed:!0,disable_array_add:!0,disable_array_delete:!0},items:{type:"object",title:"Multi Axis",headerTemplate:"Multi Axis  {{ i1 }} {{ self.Field }}",options:{collapsed:!0},properties:{Rotation:{title:"Rotation",type:"number",default:0,propertyOrder:1},FontSize:{title:"Font Size",type:"number",format:"number",default:12},Prefix:{title:"Prefix",type:"string",default:""},Suffix:{title:"Suffix",type:"string",default:""},Precision:{title:"Decimal Places",type:"number",default:2},Field:{title:"Field",type:"string",default:"",options:{hidden:!0}}},watch:{Field:"Field"}}}}}}}},Yaxes:{title:"Y-Axes",type:"array",propertyOrder:2,options:{collapsed:!0},items:{title:"Y-Axis",type:"object",options:{collapsed:!0},properties:{Bounds:{options:{hidden:!0}},Type:{title:"Y-Axis Type",type:"string",propertyOrder:1,enum:["Linear","Category","Time","Logarithmic"],default:"Linear"},Position:{title:"Position",type:"string",enum:["Left","Right"],propertyOrder:2,default:"Left"},Width:{title:"Width",type:"number",propertyOrder:2,default:0},TickSpacing:{type:"boolean",title:"Tick Spacing",propertyOrder:2,enum:["Number of Ticks","Fixed Tick Interval (ms)"],default:"Number of Ticks"},Ticks:{type:"number",title:"Number of Ticks",propertyOrder:2,default:10},IntervalLength:{title:"Fixed Tick Interval (ms)",type:"number",default:0,propertyOrder:2},Color:{title:"Color",type:"gradient",options:{noColor:!0,gradient:!1},propertyOrder:2,default:""},FilterUnique:{title:"Filter Unique",type:"boolean",propertyOrder:2,default:!0},Sort:{title:"Sort",type:"boolean",propertyOrder:2,default:!0},Stacked:{title:"Stacked",type:"boolean",propertyOrder:2,default:!1},StackedGap:{title:"Stacked Bars Gap",type:"boolean",default:!1,propertyOrder:2},Title:{type:"object",title:"Title",options:{collapsed:!0},properties:{Display:{title:"Display",type:"boolean",default:!1},LabelString:{title:"Label String",type:"string",default:""},FontSize:{title:"Font Size",type:"number",default:16}}},Range:{type:"object",title:"Range",propertyOrder:2,options:{collapsed:!0,hidden:!1},properties:{UseMinMax:{title:"Use min max",type:"boolean",default:!1},Min:{title:"Min",type:"string",default:""},Max:{title:"Max",type:"string",default:""},SelectionMin:{title:"Selection Min",type:"string",default:""},SelectionMax:{title:"Selection Max",type:"string",default:""},ResetToNull:{title:"Reset to Null",type:"boolean",default:!0}}},Gridlines:{type:"object",title:"Gridlines",propertyOrder:3,options:{collapsed:!0},properties:{GridlinesOffset:{title:"Offset Gridlines",type:"boolean",default:!1},GridlinesColor:{title:"Gridlines Color",type:"gradient",options:{noColor:!0,gradient:!1},default:""},GridlinesOpacity:{title:"Gridlines Opacity",type:"number",default:15}}},Format:{type:"object",title:"Format",propertyOrder:3,options:{collapsed:!0},properties:{Display:{title:"Display",type:"boolean",default:!0,propertyOrder:1},Rotation:{title:"Rotation",type:"number",default:0,propertyOrder:1},Break:{title:"Break (ms)",type:"number",default:864e5,propertyOrder:3},Distribution:{title:"Distribution",type:"string",enum:["Linear","Smart"],default:"Linear",propertyOrder:3},TriggerBreak:{title:"Trigger Break (ms)",type:"number",default:864e5,propertyOrder:3},BeginAtZero:{type:"boolean",title:"Begin at Zero",format:"checkbox",default:!1,propertyOrder:2},ShowMajorUnits:{type:"boolean",title:"Show Major Units",format:"checkbox",default:!1,propertyOrder:3},Format:{title:"Numeric Format",type:"string",enum:["Number","Smart Number","Formatted Number"],default:"Number"},DateFormat:{default:"",enum:["","YYYY-MM-DD","YYYY-MMM-DD","YYYY-MMMM-DD","YYYY-MM","YYYY-MMM","YYYY-MMMM","MMM DD","MMM Do","YYYY-MM-DD HH:mm:ss","YYYY-MM-DD hh:mm:ss","YYYY-MM-DD kk:mm:ss","hh:mm:ss","kk:mm:ss","hh:mm:ss.SS","hh:mm:ss.SSS","hh:mm:ss.SSSSSS","hh:mm:ss.SSSSSSSSS","hh:mm","kk:mm","mm:ss","mm:ss.SS"],title:"Date/Time Format",type:"string"},Precision:{title:"Decimal Places",type:"number",default:2},FontSize:{title:"Font Size",type:"number",format:"number",default:12},Prefix:{title:"Prefix",type:"string",default:""},Suffix:{title:"Suffix",type:"string",default:""},HideTrailingZeroes:{type:"boolean",propertyOrder:4,title:"Hide Trailing Zeroes",format:"checkbox",default:!1}}}}}},Overlay:{type:"object",title:"Overlay",options:{collapsed:!0},propertyOrder:209,properties:{ShowCrosshairs:{type:"boolean",title:"Show Crosshairs",default:!0},ShowCoordinates:{type:"boolean",title:"Show Coordinates",default:!0},SnapToPoint:{type:"boolean",title:"Snap Crosshair to Data",default:!0},UseCustomTooltip:{type:"boolean",title:"Use custom tooltip",default:!1},CustomTooltip:{type:"tooltipTemplate",title:"Custom tooltip",templateItems:{this:{type:"array",items:{color:"color",data:"data",icon:"icon",image:"image",name:"name",width:"width",xAxis:"xAxis",yAxis:"yAxis",xAxisRaw:"xAxisRaw",yAxisRaw:"yAxisRaw"}}},default:r.CUSTOM_TOOLTIP_DEFAULT},ShowAllLayers:{type:"boolean",title:"Show all layers",default:!0},ShowAllPoints:{type:"boolean",title:"Show all data points",default:!1},GroupByLayer:{type:"boolean",title:"Group tooltip by layer",default:!1}}},FileExport:{options:{collapsed:!0},properties:{FileName:{format:"table",items:{options:{collapsed:!0},properties:{FileNamePart:{title:"FileName Part",type:"string"}},title:"Filename Part",type:"object"},options:{collapsed:!0,hidden:!1},title:"FileName",type:"array"},ShowExportCsvButton:{default:!1,format:"checkbox",title:"Show Export Csv Button",type:"boolean"},ShowExportExcelButton:{default:!1,format:"checkbox",title:"Show Export Excel Button",type:"boolean"},ShowExportPngButton:{default:!1,format:"checkbox",title:"Show Screenshot Button",type:"boolean"},PngButton:{default:"Export Png",enum:["Export Png","Copy to Clipboard","Export Png & Copy to Clipboard"],title:"Screenshot Button",type:"string"},UseChartFormat:{default:!1,format:"checkbox",title:"Use Chart Formatting",type:"boolean"},Actions:{type:"array",format:"table",title:"Actions",options:{collapsed:!0},items:{type:"object",title:"Action",options:{collapsed:!0},properties:{EventType:{title:"Event Type",type:"string",default:"all",enum:["all","onSuccess","onFail"]},Result:{title:"Last Result",type:"string",default:""}}}}},propertyOrder:320,title:"File Export",type:"object"},Legend:{title:"Legend",type:"object",options:{collapsed:!0},propertyOrder:210,properties:{Position:{title:"Position",type:"dropdown",data:"possiblePositions",watch:{possiblePositions:"root.possiblePositions"},default:"Top"},UseCustomLegend:{type:"boolean",title:"Use Custom Legend",default:!1},CustomLegend:{type:"legendTemplate",title:"Custom Legend",templateItems:{this:{type:"array",items:{bullColor:"bullColor",color:"color",fontColor:"fontColor",icon:"icon",image:"image",strike:"strike",text:"text",width:"width"}}},default:r.CUSTOM_LEGEND_DEFAULT},LegendGroups:{title:"Legend Groups",type:"array",items:{headerTemplate:"{{#if self.Name}}{{valueProp self.Name }}{{else}}Legend Group {{ i1 }}{{/if}}",type:"object",id:"arrItem",title:"Legend Group",options:{collapsed:!0},properties:{Name:{type:"string",default:""},Expanded:{type:"boolean",default:!0},Icon:{type:"icon",title:"Icon",iconTypes:"fa",default:""},RegexStr:{type:"regex",default:"",title:"Regex grouping"}}}}}},Annotations:{title:"Annotations",type:"object",options:{collapsed:!0},propertyOrder:250,properties:{ShowAnnotateControl:{default:!1,format:"checkbox",title:"Show Annotate Controls",type:"boolean"},Annotations:{type:"string",title:"Annotations",default:""}}},OverrideRules:{title:"Override Rules",type:"array",options:{collapsed:!0},items:{title:"Override Rule",type:"object",oneOf:m}},HierarchicalRules:{title:"Hierarchical Rules",type:"array",options:{collapsed:!0,hidden:!0},items:{title:"Hierarchical Rule",type:"object",oneOf:m}},Style:{type:"object",title:"Style",options:{collapsed:!0},properties:{advanced:{type:"css",title:"Advanced CSS",default:""}}}}}}};if(0<_.keys(t.settingsModel.attributes).length)for(var i=_.find(r.upgrades,{version:t.settingsModel.get("version")}),n=void 0===i?1:r.upgrades.indexOf(i)+1;n<r.upgrades.length;n+=1){var o=r.upgrades[n];o.fn(t.settingsModel,t),t.settingsModel.set("version",o.version)}return e},r.COLOR_DEFAULT="#0061FF",r.TOOLTIP_DEFAULT='<table><thead><tr><th>{{this.0.xAxis}}</th><th></th></tr></thead><tbody>{{#each this}} {{#if open}}<tr><td width="{{width}}">Open: </td><td>{{open}} </td></tr><tr><td width="{{width}}">High: </td><td>{{high}} </td></tr><tr><td width="{{width}}">Low: </td><td>{{low}} </td></tr><tr><td width="{{width}}">Close: </td><td>{{close}} </td></tr>{{else if yAxis}}<tr><td width="{{width}}"><i class="{{icon}}" style="color:{{color}};{{image}};"></i> {{name}}: </td><td>{{#if grouped}}{{#each grouped}}<td> {{this}} </td>{{/each}} {{else}} <td>{{yAxis}}</td> {{/if}}</td></tr>{{/if}}{{/each}}</tbody></table>',r.BAR_PROPERTIES={BarWidth:{title:"Bar Percentage",type:"number",default:95,propertyOrder:8},BarFixedWidth:{title:"Bar Fixed Width",type:"number",default:10,propertyOrder:8},BarWidthType:{title:"Bar Width Type",type:"string",default:"Percentage",enum:["Percentage","Fixed Width"],propertyOrder:8},BarOrientation:{title:"Bar Orientation",type:"string",default:"Vertical",enum:["Vertical","Horizontal"],propertyOrder:8}},r.BORDER_PROPERTIES={BorderWidth:{title:"Border Width",type:"number",default:0,propertyOrder:10},BorderOpacity:{title:"Border Opacity",type:"number",default:100,propertyOrder:10},BorderColor:{title:"Border Color",type:"gradient",options:{gradient:!1,noColor:!1},default:"#0061FF",propertyOrder:10},BorderPalette:{type:"array",format:"table",title:"Border Color Palette",options:{collapsed:!0},uniqueItems:!1,items:{type:"object",title:"Palette Color",properties:{type:{type:"gradient",options:{gradient:!1},title:"color",default:"#ffa500"}}},default:_.cloneDeep(f),propertyOrder:10}},r.BASICS={Hover:"",Selected:"",Focus:"",SelectFirstPoint:!1,RangeSelection:!1,Zoom:!0,Duration:400,Easing:"easeOutQuart",TrackLoadTime:!1,LoadTime:"",UsePatterns:!1,UseHierarchicalRules:!0},r.CUSTOM_TOOLTIP_DEFAULT='<table><thead><tr><th>{{this.0.xAxis}}</th><th></th></tr></thead><tbody>{{#each this}}<tr><td width="{{width}}"><i class="{{icon}}" style="color:{{color}}; {{image}};"></i> {{name}}: </td><td>{{yAxis}}</td></tr>{{/each}}</tbody></table>',r.CUSTOM_LEGEND_DEFAULT='\n<ul class="chartgl-legend">\n  {{#each this}}\n    {{!-- legend color --}}\n    <li>\n      {{#if icon}}\n        <i style="height:{{width}}px;color:{{color}};margin-top:2.5px;margin-right:5px;{{image}}"class="fa {{icon}}"></i>\n      {{else}}  \n        {{#if bullColor}}\n          <span style="margin-right:5px;">  \n            <i style="font-size: 16px;color:{{color}};margin-top:0;" class="fa fa-ellipsis-v"></i>\n            <i style="font-size: 8px;margin-left:-5px;color:{{bullColor}};margin-top:3px;position: absolute;"class="fa fa-square"></i>\n          </span>\n        {{else}}\n          {{#if isHeatmap}}\n            <svg style="background:{{color}}; border-radius:2px;width:{{width}}px; height:{{width}}px;margin-top:2px;margin-right:5px;{{image}}"class="fa fa-square"></svg>\n          {{else}}\n            <i style="height:{{width}}px;color:{{color}};margin-top:2.5px;margin-right:5px;{{image}}"class="fa fa-square"></i>\n            {{/if}}\n        {{/if}}\n      {{/if}}\n\n      {{!-- legend text --}}\n      <span style="color:{{fontColor}}; text-decoration:{{strike}}" id="{{text}}">{{text}}</span>\n    </li>\n  {{/each}}\n</ul>',r.LAYER_BASIC={_Id:{type:"string",options:{hidden:!0}},_Type:{type:"string",options:{hidden:!0}},possibleXAxes:{type:"array",options:{hidden:!0}},possibleYAxes:{type:"array",options:{hidden:!0}},Name:{title:"Name",type:"string",default:"",propertyOrder:2},XAxisId:{title:"X-Axis",default:"X-Axis 1",type:"string",enumSource:"possible_xaxis",watch:{possible_xaxis:"arrItem.possibleXAxes"},propertyOrder:3},YAxisId:{title:"Y-Axis",default:"Y-Axis 1",type:"string",enumSource:"possible_yaxis",watch:{possible_yaxis:"arrItem.possibleYAxes"},propertyOrder:3},Color:{title:"Color",type:"gradient",options:{gradient:!1},default:_.clone(r.COLOR_DEFAULT),propertyOrder:8},Opacity:{title:"Opacity",type:"number",default:80,propertyOrder:8},LegendGroup:{title:"Legend Group (Custom)",type:"dropdown",default:"None",data:"possibleCols",propertyOrder:9,watch:{possibleCols:"root.possibleLegendGroups"}},ColorData:{title:"Legend Color by Column",type:"dropdown",default:"None",data:"possible_columns",watch:{possible_columns:"arrItem.possibleColorColumns"},propertyOrder:9},ShowCurrentTick:{title:"Show Current Tick Label",type:"boolean",default:!1,propertyOrder:9},CacheStreamingData:{title:"Cache Streaming Data",type:"boolean",default:!1,propertyOrder:9},Legend:{title:"Legend Enabled",type:"boolean",default:!0,propertyOrder:9},Enabled:{title:"Enabled",type:"boolean",default:!0,propertyOrder:9},Labels:{options:{collapsed:!0},properties:{Align:{default:"center",enum:["center","right","bottom","left","top"],propertyOrder:4,type:"string"},Color:{default:"#000000",options:{gradient:!1,noColor:!1},propertyOrder:2,title:"Label Color",type:"gradient"},Enabled:{default:!1,format:"checkbox",propertyOrder:1,type:"boolean"},Font:{properties:{Bold:{default:!1,format:"checkbox",type:"boolean"},Size:{default:12,minimum:1,type:"number"}},propertyOrder:8,type:"object"},Frequency:{default:1,minimum:1,propertyOrder:3,title:"Label Freq",type:"number"},Offset:{default:"0",propertyOrder:6,type:"string"},Rotation:{default:0,propertyOrder:7,type:"number"},MaxLabels:{default:10,propertyOrder:7,type:"number",title:"Max Label Quantity"},Template:{default:"{{x}}, {{toFixed y 2}}",propertyOrder:7,templateItems:{values:{items:_.keyBy(["x","y","r"]),type:"object"}},title:"Label Template",type:"tooltipTemplate"}},type:"object"}},r.LAYER_BUBBLE={RadiusData:{title:"Radius Data",type:"",propertyOrder:7,default:"Fixed Size",enumSource:"possible_columns",watch:{possibleCols:"arrItem.possibleRadiusData"}},RadiusScaling:{title:"Radius Scaling",type:"number",propertyOrder:7,default:4},ScaleOnZoom:{title:"Scale on Zoom",type:"boolean",default:!0,propertyOrder:7},SetIconFromData:{title:"Set Icon from Data",type:"boolean",default:!1,propertyOrder:8},DataIcon:{title:"Icon",type:"dropdown",default:"",data:"possible_columns",watch:{possible_columns:"arrItem.possibleIconColumns"},propertyOrder:9},DataIconColor:{title:"Icon Color",type:"dropdown",default:"",data:"possible_columns",watch:{possible_columns:"arrItem.possibleIconColumns"},propertyOrder:9},Icon:{type:"icon",title:"Icon",iconTypes:"fa",propertyOrder:9,default:""}},r.LAYER_AXIS_VALS={XAxis:{title:"X-Axis Data",type:"dropdown",default:"",data:"possible_columns",watch:{possible_columns:"arrItem.possibleXColumns"},propertyOrder:3},YAxis:{title:"Y-Axis Data",type:"customDropdown",default:"",data:"possible_columns",watch:{possible_columns:"arrItem.possibleYColumns"},propertyOrder:3},XAxisMulti:{title:"Multi X-Axis",type:"customDropdown",default:"",data:"possible_columns",watch:{possible_columns:"arrItem.possibleMultiColumns"},propertyOrder:3}},r.LAYER_COMMON={possibleActionsColumns:{type:"array",options:{hidden:!0}},possibleColorColumns:{type:"array",options:{hidden:!0}},possibleIconColumns:{type:"array",options:{hidden:!0}},possibleRadiusData:{type:"array",options:{hidden:!0}},possibleLayers:{type:"array",options:{hidden:!0}},possibleRulesColumns:{type:"array",options:{hidden:!0}},possibleXColumns:{type:"array",options:{hidden:!0}},possibleYColumns:{type:"array",options:{hidden:!0}},possibleMultiColumns:{type:"array",options:{hidden:!0}},Data:{title:"Data Source",type:"data",default:"",propertyOrder:1},PaletteTheme:{default:"",title:"Palette Theme",type:"string",enumSource:"possible_palettes",watch:{possible_palettes:"root.possiblePalettes"},propertyOrder:10},Palette:{type:"array",format:"table",title:"Color Palette",options:{collapsed:!0},uniqueItems:!1,items:{type:"object",title:"Palette Color",properties:{type:{type:"gradient",options:{gradient:!1},title:"color",default:"#ffa500"}}},default:_.cloneDeep(f),propertyOrder:10},Actions:{title:"Actions",type:"actions",fields:{map:_.extend({Current:{enumSource:"possible_columns",propertyOrder:10,title:"Source Column",type:"string",watch:{possibleColumns:"arrItem.possibleActionsColumns"}}},e),nav:e,query:e,url:e},options:{collapsed:!0}},HighlightRules:{title:"Highlight Rules",type:"array",options:{collapsed:!0},items:{title:"Highlight Rule",type:"object",oneOf:[{options:{linked_oneof_property:{property:"RuleType",value:"discrete"}},properties:Object.assign({},i,{RuleColor:{default:"#F8F8F8",options:{gradient:!1,noColor:!1},propertyOrder:11,title:"Rule Color",type:"gradient"},RuleOperation:{default:"",enum:["","search","regexp","contains","starts with","ends with","==","<",">","<=",">=","!=","in"],propertyOrder:9,title:"Rule Operation",type:"string"},RuleValue:{data:"possible_columns",default:"",propertyOrder:10,title:"Rule Value",type:"string"}}),title:"Discrete"},{options:{additionalProperties:!1,linked_oneof_property:{property:"RuleType",value:"gradient"}},properties:Object.assign({},i,{Palette:{default:[{type:"#cc6677"},{type:"#ddcc77"},{type:"#117733"}],format:"table",items:{properties:{type:{default:"#ffa500",options:{gradient:!1},title:"color",type:"gradient"}},title:"Palette Color",type:"object"},options:{collapsed:!0},propertyOrder:8,title:"Color Palette",type:"array",uniqueItems:!1},RuleMax:{default:1,format:"number",propertyOrder:7,title:"Rule Max",type:"number"},RuleMin:{default:0,format:"number",propertyOrder:6,title:"Rule Min",type:"number"}}),title:"Gradient"}]}}},r.upgrades=[{version:"0",fn:function(t,e){}},{version:"4.5.0",fn:function(t){t.get("Basics")&&!t.get("Basics.Easing")&&t.unset("Basics")}},{version:"4.5.1.1",fn:function(o){o.get("Palette")||o.set("Palette",f),_.each(o.get("Layers"),function(t,e){o.get("Layers."+e+".Name")||o.set("Layers."+e+".Name","Layer "+(e+1))}),o.get("Xaxis")&&!o.get("Xaxes.Range.SelectionMin")&&(o.set("Xaxis.Range.SelectionMin",""),o.set("Xaxis.Range.SelectionMax",""),o.set("Yaxis.Range.SelectionMin",""),o.set("Yaxis.Range.SelectionMax","")),o.get("Basics.Easing")||o.set("Basics",r.BASICS),o.get("Xaxes")&&o.get("Xaxes.0.Format")||(o.set("Xaxes",[_.extend({},o.get("Xaxis"),{Position:{title:"Position",type:"string",enum:["Top","Bottom"],default:"Bottom"}})]),o.set("Yaxes",[_.extend({},o.get("Yaxis"),{Position:{title:"Position",type:"string",enum:["Left","Right"],default:"Left"}})]),o.set("Yaxes.0.Position","Left"),o.set("Xaxes.0.Position","Bottom"),o.unset("Xaxis"),o.unset("Yaxis"),_.each(o.get("Layers"),function(t,e){o.set("Layers."+e+".XAxisId","X-Axis 1"),o.set("Layers."+e+".YAxisId","Y-Axis 1"),o.set("Layers."+e+".possibleXAxes",["X-Axis 1"]),o.set("Layers."+e+".possibleYAxes",["Y-Axis 1"])}));'<table>{{#each this}}{{#eq @index 0}}<thead><tr><th>{{xAxis}}</th><th></th></tr></thead>{{/eq}}<tr><td width="{{width}}"><i class="{{icon}}" style="color:{{color}}"></i> {{name}}: </td><td>{{yAxis}}</td></tr>{{/each}}</table>'===o.get("Overlay.CustomTooltip")&&o.set("Overlay.CustomTooltip",'<table><thead><tr><th>{{this.0.0.xAxis}}</th><th></th></tr></thead>{{#each this}}{{#each this}}<tr><td width="{{width}}"><i class="{{icon}}" style="color:{{color}}; {{image}};"></i> {{name}}: </td><td>{{yAxis}}</td></tr>{{/each}}{{/each}}</table>'),o.get("Overlay.ShowAllPoints")||o.set("Overlay.ShowAllPoints",!1),o.get("Overlay.GroupByLayer")||o.set("Overlay.GroupByLayer",!1),_.each(o.get("Layers"),function(t,e){o.get("Layers."+e+".Enabled")||o.set("Layers."+e+".Enabled",!0),o.get("Layers."+e+".Opacity")||o.set("Layers."+e+".Opacity",80);var i="Layers."+e+".BarWidth",n="Layers."+e+".BarFixedWidth",e="Layers."+e+".BarWidthType";o.get(i)&&!o.get(n)&&(o.set(i,100*o.get(i)),o.set(e,"Percentage"),o.set(n,10))})}},{version:"4.6.0a",fn:function(n){_.each(n.get("Layers"),function(t,e){var i;void 0===n.get("Layers."+e+".ScaleOnZoom")&&(i=n.get("Layers."+e+".PointSize"),n.set("Layers."+e+".ScaleOnZoom",!0),n.set("Layers."+e+".RadiusData","Fixed Size"),n.set("Layers."+e+".RadiusScaling",i),n.unset("Layers."+e+".PointSize"))});'<table><thead><tr><th>{{this.0.0.xAxis}}</th><th></th></tr></thead>{{#each this}}{{#each this}}<tr><td width="{{width}}"><i class="{{icon}}" style="color:{{color}}; {{image}};"></i> {{name}}: </td><td>{{yAxis}}</td></tr>{{/each}}{{/each}}</table>'===n.get("Overlay.CustomTooltip")&&n.set("Overlay.CustomTooltip",r.CUSTOM_TOOLTIP_DEFAULT),n.get("Layers").forEach(function(t,e){n.get("Layers."+e+"._Type")===G.Line&&(n.get("Layers."+e+".Fill")||(n.set("Layers."+e+".Fill","No Fill"),n.set("Layers."+e+".FillColor","#0061FF"),n.set("Layers."+e+".FillOpacity",80)),n.get("Layers."+e+"._Type")===G.Line)&&void 0===n.get("Layers."+e+".FadeToTransparent")&&n.set("Layers."+e+".FadeToTransparent",!1)})}},{version:"4.6.0b",fn:function(t){void 0===t.get("Overlay.ShowCoordinates")&&t.set("Overlay.ShowCoordinates",!0),void 0===t.get("Overlay.SnapToPoint")&&t.set("Overlay.SnapToPoint",!0)}},{version:"4.6.0c",fn:function(i){i.get("Layers").forEach(function(t,e){void 0===t.ColorData&&(i.set("Layers."+e+".possibleColorColumns",["None"]),i.set("Layers."+e+".ColorData","None")),void 0===t.Palette&&(t=i.get("Palette")||f,i.set("Layers."+e+".Palette",t))}),i.get("Xaxes").forEach(function(t,e){void 0===t.Format.BeginAtZero&&i.set("Xaxes."+e+".Format.BeginAtZero",!1)}),i.get("Yaxes").forEach(function(t,e){void 0===t.Format.BeginAtZero&&i.set("Yaxes."+e+".Format.BeginAtZero",!1)})}},{version:"4.6.0d",fn:function(i){i.get("Layers").forEach(function(t,e){e="Layers."+e;void 0===t.Palette&&(t=i.get("Palette")||f,i.set(e+".Palette",t)),"No Fill"===i.get(e+".Fill")&&(i.set(e+".FillColor",void 0),i.set(e+".Fade",void 0),i.set(e+".FillOpacity",void 0))})}},{version:"4.7.2",fn:function(i){i.get("Layers").forEach(function(t,e){e="Layers."+e;t._Type===G.Line&&void 0===i.get(e+".SpanGaps")&&i.set(e+".SpanGaps",!1),void 0===t.LegendGroup&&i.set(e+".LegendGroup","None")}),void 0===i.get("Legend")&&(i.set("Legend.LegendGroups",[]),i.set("Legend.Position","Top"))}},{version:"4.7.2",fn:function(t){_.isNil(t.get("FileExport"))&&t.set("FileExport",{FileName:[],ShowExportCsvButton:!1,ShowExportExcelButton:!1})}},{version:"4.7.3",fn:function(o){o.get("Layers").forEach(function(t,e){var i,n="Layers."+e;t._Type===G.Line&&void 0===o.get(n+".Line")&&(e=["Fill","FillColor","FillOpacity","FadeToTransparent","SpanGaps"],o.set(n+".Line"),o.set(n+".Line.FillPalette",f),e.forEach(function(t){return o.set(n+".Line."+t,o.get(n+"."+t))}),e.forEach(function(t){return o.unset(n+"."+t)})),void 0===t.Labels&&(o.set(n+".Labels"),i=[!1,"center","#000000",!1,12,1,0,0,"{{x}}, {{toFixed y 2}}",10],["Enabled","Align","Color","Font.Bold","Font.Size","Frequency","Offset","Rotation","Template","MaxLabels"].forEach(function(t,e){return o.set(n+".Labels."+t,i[e])}))})}},{version:"4.7.3",fn:function(t){_.isNil(t.get("Annotations"))&&t.set("Annotations",{ShowAnnotateControl:!1,Annotations:""})}},{version:"4.7.3.1",fn:function(t){t=t.get("FileExport");t.ShowExportPngButton=!_.isNil(t.ShowExportPngButton)&&t.howExportPngButton}},{version:"4.7.4",fn:function(i){(_.isNil(i.get("Xaxes.0.Stacked"))||_.isNil(i.get("Yaxes.0.Stacked")))&&(i.get("Xaxes").forEach(function(t,e){i.set("Xaxes."+e+".Stacked",!1)}),i.get("Yaxes").forEach(function(t,e){i.set("Yaxes."+e+".Stacked",!1)})),_.isNil(i.get("Basics.Zoom"))&&i.set("Basics.Zoom",!0),i.get("Layers").forEach(function(t,e){i.get("Layers."+e+"._Type")!==G.Bar||i.get("Layers."+e+".BarOrientation")||i.set("Layers."+e+".BarOrientation","Vertical")})}},{version:"4.7.4.1",fn:function(i){var t=i.get("Xaxes"),e=i.get("Yaxes");t.forEach(function(t,e){void 0===i.get("Xaxes."+e+".Color")&&i.set("Xaxes."+e+".Color","")}),e.forEach(function(t,e){void 0===i.get("Yaxes."+e+".Color")&&i.set("Yaxes."+e+".Color","")});'<table><thead><tr><th>{{this.0.xAxis}}</th><th></th></tr></thead>{{#each this}}<tr><td width="{{width}}"><i class="{{icon}}" style="color:{{color}}; {{image}};"></i> {{name}}: </td><td>{{yAxis}}</td></tr>{{/each}}</table>'===i.get("Overlay.CustomTooltip")&&i.set("Overlay.CustomTooltip",r.CUSTOM_TOOLTIP_DEFAULT)}},{version:"4.7.4.2",fn:function(t){t=t.get("FileExport");t.UseChartFormat=!_.isNil(t.UseChartFormat)&&t.UseChartFormat}},{version:"4.7.4.3",fn:function(i){i.get("Layers").forEach(function(t,e){t._Type!==G.Line||i.get((t="Layers."+e+".Line.Interpolation")+".Interpolation")||(i.set(t+".Interpolation","Linear"),i.set(t+".SteppedLine","After"))})}},{version:"4.7.4.4",fn:function(i){var t=i.get("Xaxes"),e=i.get("Yaxes");t.forEach(function(t,e){e="Xaxes."+e;"Time"===i.get(e+".Type")&&void 0===i.get(e+".Format.ShowMajorUnits")&&i.set(e+".Format.ShowMajorUnits",!1)}),e.forEach(function(t,e){e="Yaxes."+e;"Time"===i.get(e+".Type")&&void 0===i.get(e+".Format.ShowMajorUnits")&&i.set(e+".Format.ShowMajorUnits",!1)}),i.get("Layers").forEach(function(t,e){void 0===t.ShowCurrentTick&&i.set("Layers."+e+".ShowCurrentTick",!1)})}},{version:"4.7.4.5",fn:function(i){i.get("Layers").forEach(function(t,e){void 0===t.CacheStreamingData&&i.set("Layers."+e+".CacheStreamingData",!1)})}},{version:"4.7.5",fn:function(n){n.get("Layers").forEach(function(t,e){var i;void 0!==t.Bubbles||t._Type!==G.Bubble&&t._Type!==G.Line&&""!==t._Type||(i=t._Type===G.Line?0:4,n.set((e="Layers."+e)+".Bubbles.RadiusScaling",n.get(e+".RadiusScaling")||i),n.set(e+".Bubbles.RadiusData",n.get(e+".RadiusData")||""),n.set(e+".Bubbles.ScaleOnZoom",n.get(e+".ScaleOnZoom")||!0),n.set(e+".Bubbles.Icon",n.get(e+".Icon")||""),t._Type===G.Line?(n.set(e+".Bubbles.Color",n.get(e+".Color")||r.COLOR_DEFAULT),n.set(e+".Bubbles.Opacity",n.get(e+".Opacity")||80)):(n.unset(e+".RadiusScaling"),n.unset(e+".RadiusData"),n.unset(e+".ScaleOnZoom"),n.unset(e+".Icon")))})}},{version:"4.7.5.1",fn:function(i){var t=i.get("FileExport");t.Actions=_.isNil(t.Actions)?[]:t.Actions,i.get("Layers").forEach(function(t,e){t._Type===G.Line&&void 0===t.LineThickness&&i.set("Layers."+e+".Line.LineThickness",1)})}},{version:"4.7.5.2",fn:function(i){i.get("Layers").forEach(function(t,e){t._Type===G.Line&&void 0===t.Line.Interpolation.SegmentLength&&i.set("Layers."+e+".Line.Interpolation.SegmentLength",20)}),void 0===i.get("Basics.LoadTime")&&(i.set("Basics.LoadTime",""),i.set("Basics.TrackLoadTime",!1))}},{version:"4.7.6",fn:function(i){i.get("Layers").forEach(function(t,e){t._Type===G.Line&&void 0===t.Line.LineStyle&&i.set("Layers."+e+".Line.LineStyle","None")})}},{version:"4.7.7",fn:function(t){t.get("Basics.Name")||t.set("Basics.Name","")}},{version:"4.7.8",fn:function(i){i.get("Xaxes").forEach(function(t,e){"Category"===i.get("Xaxes."+e+".Type")&&i.set("Xaxes."+e+".FilterUnique",!0)}),i.get("Yaxes").forEach(function(t,e){"Category"===i.get("Yaxes."+e+".Type")&&i.set("Yaxes."+e+".FilterUnique",!0)})}},{version:"4.7.8a",fn:function(t){var e=t.get("Basics.Zoom");void 0===t.get("Basics.RangeSelection")&&(void 0!==e?(t.set("Basics.Zoom",e),t.set("Basics.RangeSelection",!e)):(t.set("Basics.Zoom",!0),t.set("Basics.RangeSelection",!1)))}},{version:"4.7.8b",fn:function(i){i.get("Layers").forEach(function(t,e){""===t._Type&&i.set("Layers."+e+"._Type","Bubble")})}},{version:"4.7.8c",fn:function(t){void 0===t.get("Overlay.ShowAllLayers")&&t.set("Overlay.ShowAllLayers",!0)}},{version:"4.7.8d",fn:function(i){var t,e;void 0===i.get("Xaxes.0.Format.Rotation")&&(t=i.get("Xaxes"),e=i.get("Yaxes"),t.forEach(function(t,e){i.set("Xaxes."+e+".Format.Rotation",0)}),e.forEach(function(t,e){i.set("Yaxes."+e+".Format.Rotation",0)}))}},{version:"4.7.8e",fn:function(i){i.get("Layers").forEach(function(t,e){void 0===t.possibleActionsColumns&&i.set("Layers."+e+".possibleActiosColumns",["None","<thisX>","<thisY>","<thisName>"])})}},{version:"4.7.8f",fn:function(i){i.get("Xaxes").forEach(function(t,e){"Category"===i.get("Xaxes."+e+".Type")&&i.set("Xaxes."+e+".Sort",!1)}),i.get("Yaxes").forEach(function(t,e){"Category"===i.get("Yaxes."+e+".Type")&&i.set("Yaxes."+e+".Sort",!1)})}},{version:"v2.2.2",fn:function(i){i.get("Layers").forEach(function(t,e){void 0===i.get("Layers."+e+".XAxisMulti")&&i.set("Layers."+e+".XAxisMulti","")})}},{version:"v2.3.0.1",fn:function(t){void 0===t.get("FileExport.PngButton")&&t.set("FileExport.PngButton","Export Png"),void 0===t.get("Basics.SelectFirstPoint")&&t.set("Basics.SelectFirstPoint",!1)}},{version:"v2.3.0.2",fn:function(t){var e=t.get("Xaxes.0.Format.DateFormat");void 0===e&&""!==e&&(t.set("Xaxes.0.Format.DateFormat",""),t.set("Yaxes.0.Format.DateFormat",""))}},{version:"v2.5.0",fn:function(i){void 0===i.get("Legend.CustomLegend")&&(i.set("Legend.CustomLegend",r.CUSTOM_LEGEND_DEFAULT),i.set("Legend.UseCustomLegend",!1));var t=i.get("Xaxes"),e=i.get("Yaxes");t.forEach(function(t,e){void 0===i.get("Xaxes."+e+".Range.ResetToNull")&&i.set("Xaxes."+e+".Range.ResetToNull",!0),"Time"===i.get("Xaxes."+e+".Type")&&void 0===i.get("Xaxes."+e+".TickSpacing")&&i.set("Xaxes."+e+".TickSpacing","Number of Ticks")}),e.forEach(function(t,e){void 0===i.get("Yaxes."+e+".Range.ResetToNull")&&i.set("Yaxes."+e+".Range.ResetToNull",!0),"Time"===i.get("Yaxes."+e+".Type")&&void 0===i.get("Yaxes."+e+".TickSpacing")&&i.set("Yaxes."+e+".TickSpacing","Number of Ticks")})}},{version:"v2.8.0",fn:function(a){a.get("Layers").forEach(function(t,e){var i,n,o,r,e="Layers."+e;a.get(e+"._Type");void 0===a.get(e+".Bars.BarWidthType")&&(i=a.get(e+".BarOrientation"),n=a.get(e+".BarWidthType"),o=a.get(e+".BarWidth"),r=a.get(e+".BarFixedWidth"),a.unset(e+".BarOrientation"),a.unset(e+".BarWidthType"),a.unset(e+".BarWidth"),a.unset(e+".BarFixedWidth"),a.set(e+".Bars.BarOrientation",i),a.set(e+".Bars.BarWidthType",n),a.set(e+".Bars.BarWidth",o),a.set(e+".Bars.BarFixedWidth",r))}),a.get("Yaxes").forEach(function(t,e){e="Yaxes."+e;a.get(e+".Stacked")&&void 0===a.get(e+".StackedGap")&&a.set(e+".StackedGap",!1)}),void 0===a.get("Basics.UsePatterns")&&a.set("Basics.UsePatterns",!1)}},{version:"v2.9.0",fn:function(i){i.get("Legend.LegendGroups").forEach(function(t,e){void 0===i.get("Legend.LegendGroups."+e+".RegexStr")&&i.set("Legend.LegendGroups."+e+".RegexStr","")})}},{version:"v2.9.2",fn:function(t){var e,i;void 0===t.get("OverrideRules")&&(t.set("OverrideRules",[]),e=t.get("Xaxes").map(function(t,e){return"X-Axis "+(e+1)}),i=t.get("Yaxes").map(function(t,e){return"Y-Axis "+(e+1)}),t.set("possibleAxes",e.concat(i)),t.set("possibleDataCols",[]),t.set("possibleYDataCols",[]))}},{version:"v2.11.0",fn:function(n){_.isNil(n.get("Basics.Focus"))&&n.set("Basics.Focus",""),void 0===n.get("Basics.UseHierarchicalRules")&&n.set("Basics.UseHierarchicalRules",!0),void 0===n.get("HierarchicalRules")&&n.set("HierarchicalRules",[]),n.get("Layers").forEach(function(t,e){var i=n.get("Layers."+e+"._Type");"Bubble"!==i&&"Line"!==i||void 0===n.get("Layers."+e+".Bubbles.SetIconFromData")&&(n.set("Layers."+e+".Bubbles.SetIconFromData",!1),n.set("Layers."+e+".possibleIconColumns",[""]))})}},{version:"v2.12.0",fn:function(o){o.get("Layers").forEach(function(t,e){var i=o.get("Layers."+e+"._Type"),n="Bars";i!==G.Bar&&i!==G.Waterfall||!_.isNil(o.get("Layers."+e+"."+n+".BorderWidth"))||(o.set("Layers."+e+"."+n+".BorderWidth",0),o.set("Layers."+e+"."+n+".BorderColor","#0061FF"),o.set("Layers."+e+"."+n+".BorderOpacity",80),o.set("Layers."+e+"."+n+".BorderPalette",f))}),o.get("OverrideRules").forEach(function(t,e){"Column"!==t.RuleType&&t.RuleType||void 0!==o.get("OverrideRules."+e+".UsePalette")||o.set("OverrideRules."+e+".UsePalette",!1)})}}],r);function r(){}q.annotate=k.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){var r=null!=e?e:t.nullContext||{},a=t.hooks.helperMissing,s=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="chartGLAnnotateControl">\n    <span class="lnksAnnotate link-disabled">\n    <a class="lnkAnnotate btn-annotate" title="'+s((t(i,"t")||e&&t(e,"t")||a).call(r,"Enable Annotation mode",{name:"t",hash:{},data:o,loc:{start:{line:3,column:47},end:{line:3,column:77}}}))+'"><i class="fa fa-fw fa-pencil draw-icon"></i>'+s((t(i,"t")||e&&t(e,"t")||a).call(r,"Annotate",{name:"t",hash:{},data:o,loc:{start:{line:3,column:123},end:{line:3,column:139}}}))+'</a>\n    <a class="lnkEditAnnotate btn-annotate" title="'+s((t(i,"t")||e&&t(e,"t")||a).call(r,"Edit annotations",{name:"t",hash:{},data:o,loc:{start:{line:4,column:51},end:{line:4,column:75}}}))+'"><i class="fa fas fa-edit"></i></a>\n    <a class="lnkUndoAnnotate btn-annotate btn-disabled" title="'+s((t(i,"t")||e&&t(e,"t")||a).call(r,"Undo",{name:"t",hash:{},data:o,loc:{start:{line:5,column:64},end:{line:5,column:76}}}))+'"><i class="fa fa-undo"></i></a>\n    <a class="lnkRedoAnnotate btn-annotate btn-disabled" title="'+s((t(i,"t")||e&&t(e,"t")||a).call(r,"Redo",{name:"t",hash:{},data:o,loc:{start:{line:6,column:64},end:{line:6,column:76}}}))+'"><i class="fa fa-repeat"></i></a>\n    </span>   \n</div>'},useData:!0}),q.annotateDialog=k.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){var r=null!=e?e:t.nullContext||{},a=t.hooks.helperMissing,s=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="draw-menu">\n    <fieldset class="options-annotate-new">\n        <legend>'+s((t(i,"t")||e&&t(e,"t")||a).call(r,"Annotate Settings",{name:"t",hash:{},data:o,loc:{start:{line:3,column:16},end:{line:3,column:41}}}))+'</legend>\n            <div class="pnlNew">\n            <label>'+s((t(i,"t")||e&&t(e,"t")||a).call(r,"Annotation type",{name:"t",hash:{},data:o,loc:{start:{line:5,column:19},end:{line:5,column:42}}}))+'</label>\n            <select class="annotate-type-select select2-container--dashboards select2-selection--single">\n                <option value="text-note">'+s((t(i,"t")||e&&t(e,"t")||a).call(r,"Text note",{name:"t",hash:{},data:o,loc:{start:{line:7,column:42},end:{line:7,column:59}}}))+'</option>\n                <option value="rectangle">'+s((t(i,"t")||e&&t(e,"t")||a).call(r,"Rectangle",{name:"t",hash:{},data:o,loc:{start:{line:8,column:42},end:{line:8,column:59}}}))+'</option>\n                <option value="horizontal-line">'+s((t(i,"t")||e&&t(e,"t")||a).call(r,"Horizontal line",{name:"t",hash:{},data:o,loc:{start:{line:9,column:48},end:{line:9,column:71}}}))+'</option>\n                <option value="vertical-line">'+s((t(i,"t")||e&&t(e,"t")||a).call(r,"Vertical line",{name:"t",hash:{},data:o,loc:{start:{line:10,column:46},end:{line:10,column:67}}}))+'</option>\n                <option value="trend-line">'+s((t(i,"t")||e&&t(e,"t")||a).call(r,"Trend line",{name:"t",hash:{},data:o,loc:{start:{line:11,column:43},end:{line:11,column:61}}}))+'</option>\n            </select>\n            </div>\n            <div class="pnlNew">\n            <label>'+s((t(i,"t")||e&&t(e,"t")||a).call(r,"Annotation color",{name:"t",hash:{},data:o,loc:{start:{line:15,column:19},end:{line:15,column:43}}}))+'</label>\n                <span class="fa fa-fw watermark fa-tint annotate-color-icon"></span>\n                <button class="annotate-color-btn ui-widget ui-state-default ui-corner-all">\n                </button>\n    </fieldset>\n    <fieldset class="options-annotate-edit">\n    <legend>'+s((t(i,"t")||e&&t(e,"t")||a).call(r,"Edit",{name:"t",hash:{},data:o,loc:{start:{line:21,column:12},end:{line:21,column:24}}}))+'</legend>\n        <div class="delete-all-div">\n            <a class="delete-all-btn"><i class="fa fa-trash"></i>'+s((t(i,"t")||e&&t(e,"t")||a).call(r,"Delete All",{name:"t",hash:{},data:o,loc:{start:{line:23,column:65},end:{line:23,column:83}}}))+'</a>\n        </div>\n        <table class="table-annotate-edit">\n            <thead class="ui-widget-header ui-corner-all ui-helper-clearfix">\n                <tr>\n                    <th>'+s((t(i,"t")||e&&t(e,"t")||a).call(r,"Annotation Type",{name:"t",hash:{},data:o,loc:{start:{line:28,column:24},end:{line:28,column:47}}}))+'</th>\n                    <th class="th-color">'+s((t(i,"t")||e&&t(e,"t")||a).call(r,"Color",{name:"t",hash:{},data:o,loc:{start:{line:29,column:41},end:{line:29,column:54}}}))+"</th>  \n                    <th>"+s((t(i,"t")||e&&t(e,"t")||a).call(r,"Delete",{name:"t",hash:{},data:o,loc:{start:{line:30,column:24},end:{line:30,column:38}}}))+'</th>\n                </tr>\n            </thead>\n            <tbody class="tbody-annotate-edit">\n            </tbody>\n        </table>\n    </fieldset>\n\n</div>'},useData:!0}),q.annotateFragment=k.template({1:function(t,e,i,n,o){return"#version 300 es"},3:function(t,e,i,n,o){return"in"},5:function(t,e,i,n,o){return" varying"},7:function(t,e,i,n,o){return"out vec4 outColor;\n"},9:function(t,e,i,n,o){return"outColor"},11:function(t,e,i,n,o){return"gl_FragColor"},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){var r,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(r=s(i,"if").call(a,null!=e?s(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:1,column:0},end:{line:1,column:38}}}))?r:"")+"\nprecision mediump float;\n"+(null!=(r=s(i,"if").call(a,null!=e?s(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(3,o,0),inverse:t.program(5,o,0),data:o,loc:{start:{line:3,column:0},end:{line:3,column:41}}}))?r:"")+" vec4 vColor;\n\n"+(null!=(r=s(i,"if").call(a,null!=e?s(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(7,o,0),inverse:t.noop,data:o,loc:{start:{line:5,column:0},end:{line:7,column:7}}}))?r:"")+"\nvoid main(void) {\n    "+(null!=(r=s(i,"if").call(a,null!=e?s(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(9,o,0),inverse:t.program(11,o,0),data:o,loc:{start:{line:10,column:4},end:{line:10,column:55}}}))?r:"")+" = vColor;\n}"},useData:!0}),q.annotateVertex=k.template({1:function(t,e,i,n,o){return"#version 300 es"},3:function(t,e,i,n,o){return"in"},5:function(t,e,i,n,o){return" attribute"},7:function(t,e,i,n,o){return"out"},9:function(t,e,i,n,o){return" varying"},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){var r,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(r=s(i,"if").call(a,null!=e?s(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:1,column:0},end:{line:1,column:38}}}))?r:"")+"\n"+(null!=(r=s(i,"if").call(a,null!=e?s(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(3,o,0),inverse:t.program(5,o,0),data:o,loc:{start:{line:2,column:0},end:{line:2,column:43}}}))?r:"")+" vec2 aPosition;\nuniform vec2 u_resolution;\n"+(null!=(r=s(i,"if").call(a,null!=e?s(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(3,o,0),inverse:t.program(5,o,0),data:o,loc:{start:{line:4,column:0},end:{line:4,column:43}}}))?r:"")+" vec4 aColor;\n"+(null!=(r=s(i,"if").call(a,null!=e?s(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(7,o,0),inverse:t.program(9,o,0),data:o,loc:{start:{line:5,column:0},end:{line:5,column:42}}}))?r:"")+" vec4 vColor;\n\nvoid main(void) {\n    gl_PointSize = 10.0;\n    \n    // convert the position from pixels to 0.0 to 1.0\n    vec2 zeroToOne = aPosition / u_resolution;\n\n    // 32-bit below here                \n    // convert from 0->1 to 0->2\n    vec2 zeroToTwo = zeroToOne * 2.0;\n\n    // convert from 0->2 to -1->+1 (clip space)\n    vec2 clipSpace = zeroToTwo - 1.0;\n\n    gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);\n\n    vColor = aColor;\n}"},useData:!0}),q.app=k.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){var r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<canvas class="axis"></canvas>\n<div class="webgl-wrapper">\n    <canvas id='+t.escapeExpression("function"==typeof(i=null!=(i=r(i,"uid")||(null!=e?r(e,"uid"):e))?i:t.hooks.helperMissing)?i.call(null!=e?e:t.nullContext||{},{name:"uid",hash:{},data:o,loc:{start:{line:3,column:15},end:{line:3,column:22}}}):i)+'></canvas>\n</div>\n<div class="draw-div"></div>\n<div class="export-div"></div>\n<div class="legend-div"></div>\n<canvas class="data-labels"></canvas>\n<canvas class="annotations"></canvas>\n<canvas class="annotations2d"></canvas>\n<svg class="overlay">\n    <defs>\n        <marker id="sArrow" markerWidth="9" markerHeight="6" orient="auto" refY="3" refX="0">\n            <path d="M7,0 L7,6 L0,3 z"></path>\n        </marker>\n        <marker id="eArrow" markerWidth="9" markerHeight="6" orient="auto" refY="3" refX="7">\n            <path d="M0,0 L0,6 L7,3 z"></path>\n        </marker>\n    </defs>\n    <svg class="mask"></svg>\n    <svg class="crosshairs"></svg>\n</svg>\n<div class="GL-highlight-rule"></div>\n<img></img>\n'},useData:!0}),q.dualVertex=k.template({1:function(t,e,i,n,o){return"#version 300 es"},3:function(t,e,i,n,o,r,a){var s=null!=e?e:t.nullContext||{},l=t.hooks.helperMissing,h="function",p=t.escapeExpression,u=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(t=u(i,"if").call(s,null!=a[1]?u(a[1],"isWebGL2"):a[1],{name:"if",hash:{},fn:t.program(4,o,0,r,a),inverse:t.program(6,o,0,r,a),data:o,loc:{start:{line:4,column:0},end:{line:4,column:45}}}))?t:"")+" "+p(typeof(r=null!=(r=u(i,"vt")||(null!=e?u(e,"vt"):e))?r:l)==h?r.call(s,{name:"vt",hash:{},data:o,loc:{start:{line:4,column:46},end:{line:4,column:52}}}):r)+" "+p(typeof(r=null!=(r=u(i,"name")||(null!=e?u(e,"name"):e))?r:l)==h?r.call(s,{name:"name",hash:{},data:o,loc:{start:{line:4,column:53},end:{line:4,column:61}}}):r)+"_position;\n    uniform "+p(typeof(r=null!=(r=u(i,"ut")||(null!=e?u(e,"ut"):e))?r:l)==h?r.call(s,{name:"ut",hash:{},data:o,loc:{start:{line:5,column:12},end:{line:5,column:18}}}):r)+" "+p(typeof(r=null!=(r=u(i,"name")||(null!=e?u(e,"name"):e))?r:l)==h?r.call(s,{name:"name",hash:{},data:o,loc:{start:{line:5,column:19},end:{line:5,column:27}}}):r)+"_u_min;\n    uniform "+p(typeof(r=null!=(r=u(i,"ut")||(null!=e?u(e,"ut"):e))?r:l)==h?r.call(s,{name:"ut",hash:{},data:o,loc:{start:{line:6,column:12},end:{line:6,column:18}}}):r)+" "+p(typeof(r=null!=(r=u(i,"name")||(null!=e?u(e,"name"):e))?r:l)==h?r.call(s,{name:"name",hash:{},data:o,loc:{start:{line:6,column:19},end:{line:6,column:27}}}):r)+"_u_max;\n"},4:function(t,e,i,n,o){return"in"},6:function(t,e,i,n,o){return"attribute"},8:function(t,e,i,n,o){var r,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"    "+(null!=(r=s(i,"if").call(a,null!=e?s(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(4,o,0),inverse:t.program(6,o,0),data:o,loc:{start:{line:10,column:4},end:{line:10,column:46}}}))?r:"")+" vec4 h_color;\n    "+(null!=(r=s(i,"if").call(a,null!=e?s(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(9,o,0),inverse:t.program(11,o,0),data:o,loc:{start:{line:11,column:4},end:{line:11,column:45}}}))?r:"")+" lowp vec4 v_color;\n"},9:function(t,e,i,n,o){return"out"},11:function(t,e,i,n,o){return"varying"},13:function(t,e,i,n,o){var r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"    "+(null!=(i=r(i,"if").call(null!=e?e:t.nullContext||{},null!=e?r(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(9,o,0),inverse:t.program(11,o,0),data:o,loc:{start:{line:15,column:4},end:{line:15,column:45}}}))?i:"")+" vec2 v_uv;\n    uniform float u_canvasWidth;\n    uniform float u_canvasHeight;\n"},15:function(t,e,i,n,o){var r,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"    "+(null!=(r=s(i,"if").call(a,null!=e?s(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(4,o,0),inverse:t.program(6,o,0),data:o,loc:{start:{line:24,column:4},end:{line:24,column:46}}}))?r:"")+" vec2 a_barCoord;\n    "+(null!=(r=s(i,"if").call(a,null!=e?s(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(9,o,0),inverse:t.program(11,o,0),data:o,loc:{start:{line:25,column:4},end:{line:25,column:45}}}))?r:"")+" vec2 v_barCoord;\n\n    "+(null!=(r=s(i,"if").call(a,null!=e?s(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(4,o,0),inverse:t.program(6,o,0),data:o,loc:{start:{line:27,column:4},end:{line:27,column:46}}}))?r:"")+" float a_xBorder;\n    "+(null!=(r=s(i,"if").call(a,null!=e?s(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(9,o,0),inverse:t.program(11,o,0),data:o,loc:{start:{line:28,column:4},end:{line:28,column:45}}}))?r:"")+" float v_xBorder;\n\n    "+(null!=(r=s(i,"if").call(a,null!=e?s(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(4,o,0),inverse:t.program(6,o,0),data:o,loc:{start:{line:30,column:4},end:{line:30,column:46}}}))?r:"")+" float a_yBorder;\n    "+(null!=(r=s(i,"if").call(a,null!=e?s(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(9,o,0),inverse:t.program(11,o,0),data:o,loc:{start:{line:31,column:4},end:{line:31,column:45}}}))?r:"")+" float v_yBorder;\n"},17:function(t,e,i,n,o){return"in float dataIcon;\nout float vDataIcon;\n"},19:function(t,e,i,n,o){return"vec2 ds_sub (vec2 dsa, vec2 dsb) {\n    vec2 dsc;\n    float e, t1, t2;\n    t1 = dsa.x - dsb.x;\n    e = t1 - dsa.x;\n    t2 = ((-dsb.x - e) + (dsa.x - (t1 - e))) + dsa.y - dsb.y;\n    dsc.x = t1 + t2;\n    dsc.y = t2 - (dsc.x - t1);\n    return dsc;\n}\n\nvec2 ds_div(vec2 dsa, vec2 dsb)\n{\n    vec2 dsc;\n    float c11, c21, c2, e, s1, s2, t1, t2, t11, t12, t21, t22;\n    float a1, a2, b1, b2, cona, conb, split = 8193.;\n\n    // Compute a DP approximation to the quotient.\n    s1 = dsa.x / dsb.x;\n\n    // On systems with a fused multiply add, such as IBM systems, it is faster to\n    // uncomment the next two lines and comment out the following lines until !>.\n    // On other systems, do the opposite.\n    //  c11 = s1 * dsb(1)\n    // c21 = s1 * dsb(1) - c11\n    cona = s1 * split;\n    conb = dsb.x * split;\n    a1 = cona - (cona - s1);\n    b1 = conb - (conb - dsb.x);\n    a2 = s1 - a1;\n    b2 = dsb.x - b1;\n\n    // Multiply s1 * dsb.x using Dekker's method.\n    c11 = s1 * dsb.x;\n    c21 = (((a1 * b1 - c11) + a1 * b2) + a2 * b1) + a2 * b2;\n\n    // Compute s1 * dsb.y (only high-order word is needed).\n    c2 = s1 * dsb.y;\n    \n    // Compute (c11, c21) + c2 using Knuth's trick.\n    t1 = c11 + c2;\n    e = t1 - c11;\n    t2 = ((c2 - e) + (c11 - (t1 - e))) + c21;\n\n    // The result is t1 + t2, after normalization.\n    t12 = t1 + t2;\n    t22 = t2 - (t12 - t1);\n\n    // Compute dsa - (t12, t22) using Knuth's trick.\n    t11 = dsa.x - t12;\n    e = t11 - dsa.x;\n    t21 = ((-t12 - e) + (dsa.x - (t11 - e))) + dsa.y - t22;\n\n    // Compute high-order word of (t11, t21) and divide by dsb(1).\n    s2 = (t11 + t21) / dsb.x;\n    \n    // The result is s1 + s2, after normalization.\n    dsc.x = s1 + s2;\n    dsc.y = s2 - (dsc.x - s1);\n\n    return dsc;\n}\n"},21:function(t,e,i,n,o){var r,a=null!=e?e:t.nullContext||{},s=t.hooks.helperMissing,l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(r=(l(i,"eq")||e&&l(e,"eq")||s).call(a,null!=e?l(e,"vt"):e,"uint",{name:"eq",hash:{},fn:t.program(22,o,0),inverse:t.noop,data:o,loc:{start:{line:107,column:4},end:{line:111,column:11}}}))?r:"")+(null!=(r=(l(i,"eq")||e&&l(e,"eq")||s).call(a,null!=e?l(e,"vt"):e,"int",{name:"eq",hash:{},fn:t.program(24,o,0),inverse:t.noop,data:o,loc:{start:{line:112,column:4},end:{line:116,column:11}}}))?r:"")+(null!=(r=(l(i,"eq")||e&&l(e,"eq")||s).call(a,null!=e?l(e,"vt"):e,"float",{name:"eq",hash:{},fn:t.program(26,o,0),inverse:t.noop,data:o,loc:{start:{line:117,column:4},end:{line:120,column:11}}}))?r:"")+(null!=(r=(l(i,"eq")||e&&l(e,"eq")||s).call(a,null!=e?l(e,"vt"):e,"vec2",{name:"eq",hash:{},fn:t.program(28,o,0),inverse:t.noop,data:o,loc:{start:{line:121,column:4},end:{line:126,column:11}}}))?r:"")},22:function(t,e,i,n,o){var r,a=null!=e?e:t.nullContext||{},s=t.hooks.helperMissing,l="function",h=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"    float "+h(typeof(r=null!=(r=t(i,"name")||(null!=e?t(e,"name"):e))?r:s)==l?r.call(a,{name:"name",hash:{},data:o,loc:{start:{line:108,column:10},end:{line:108,column:18}}}):r)+"_u_range = float(int("+h(typeof(r=null!=(r=t(i,"name")||(null!=e?t(e,"name"):e))?r:s)==l?r.call(a,{name:"name",hash:{},data:o,loc:{start:{line:108,column:39},end:{line:108,column:47}}}):r)+"_u_max) - int("+h(typeof(r=null!=(r=t(i,"name")||(null!=e?t(e,"name"):e))?r:s)==l?r.call(a,{name:"name",hash:{},data:o,loc:{start:{line:108,column:61},end:{line:108,column:69}}}):r)+"_u_min));\n    float "+h(typeof(r=null!=(r=t(i,"name")||(null!=e?t(e,"name"):e))?r:s)==l?r.call(a,{name:"name",hash:{},data:o,loc:{start:{line:109,column:10},end:{line:109,column:18}}}):r)+"a = float(int("+h(typeof(r=null!=(r=t(i,"name")||(null!=e?t(e,"name"):e))?r:s)==l?r.call(a,{name:"name",hash:{},data:o,loc:{start:{line:109,column:32},end:{line:109,column:40}}}):r)+"_position) - "+h(typeof(r=null!=(r=t(i,"name")||(null!=e?t(e,"name"):e))?r:s)==l?r.call(a,{name:"name",hash:{},data:o,loc:{start:{line:109,column:53},end:{line:109,column:61}}}):r)+"_u_min);\n    zeroToOne."+h(typeof(r=null!=(r=t(i,"name")||(null!=e?t(e,"name"):e))?r:s)==l?r.call(a,{name:"name",hash:{},data:o,loc:{start:{line:110,column:14},end:{line:110,column:22}}}):r)+" = "+h(typeof(r=null!=(r=t(i,"name")||(null!=e?t(e,"name"):e))?r:s)==l?r.call(a,{name:"name",hash:{},data:o,loc:{start:{line:110,column:25},end:{line:110,column:33}}}):r)+"a / "+h(typeof(r=null!=(r=t(i,"name")||(null!=e?t(e,"name"):e))?r:s)==l?r.call(a,{name:"name",hash:{},data:o,loc:{start:{line:110,column:37},end:{line:110,column:45}}}):r)+"_u_range;\n"},24:function(t,e,i,n,o){var r,a=null!=e?e:t.nullContext||{},s=t.hooks.helperMissing,l="function",h=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"    float "+h(typeof(r=null!=(r=t(i,"name")||(null!=e?t(e,"name"):e))?r:s)==l?r.call(a,{name:"name",hash:{},data:o,loc:{start:{line:113,column:10},end:{line:113,column:18}}}):r)+"_u_range = float(int("+h(typeof(r=null!=(r=t(i,"name")||(null!=e?t(e,"name"):e))?r:s)==l?r.call(a,{name:"name",hash:{},data:o,loc:{start:{line:113,column:39},end:{line:113,column:47}}}):r)+"_u_max) - int("+h(typeof(r=null!=(r=t(i,"name")||(null!=e?t(e,"name"):e))?r:s)==l?r.call(a,{name:"name",hash:{},data:o,loc:{start:{line:113,column:61},end:{line:113,column:69}}}):r)+"_u_min));\n    float "+h(typeof(r=null!=(r=t(i,"name")||(null!=e?t(e,"name"):e))?r:s)==l?r.call(a,{name:"name",hash:{},data:o,loc:{start:{line:114,column:10},end:{line:114,column:18}}}):r)+"a = float("+h(typeof(r=null!=(r=t(i,"name")||(null!=e?t(e,"name"):e))?r:s)==l?r.call(a,{name:"name",hash:{},data:o,loc:{start:{line:114,column:28},end:{line:114,column:36}}}):r)+"_position - "+h(typeof(r=null!=(r=t(i,"name")||(null!=e?t(e,"name"):e))?r:s)==l?r.call(a,{name:"name",hash:{},data:o,loc:{start:{line:114,column:48},end:{line:114,column:56}}}):r)+"_u_min);\n    zeroToOne."+h(typeof(r=null!=(r=t(i,"name")||(null!=e?t(e,"name"):e))?r:s)==l?r.call(a,{name:"name",hash:{},data:o,loc:{start:{line:115,column:14},end:{line:115,column:22}}}):r)+" = "+h(typeof(r=null!=(r=t(i,"name")||(null!=e?t(e,"name"):e))?r:s)==l?r.call(a,{name:"name",hash:{},data:o,loc:{start:{line:115,column:25},end:{line:115,column:33}}}):r)+"a / "+h(typeof(r=null!=(r=t(i,"name")||(null!=e?t(e,"name"):e))?r:s)==l?r.call(a,{name:"name",hash:{},data:o,loc:{start:{line:115,column:37},end:{line:115,column:45}}}):r)+"_u_range;\n"},26:function(t,e,i,n,o){var r,a=null!=e?e:t.nullContext||{},s=t.hooks.helperMissing,l="function",h=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"    float "+h(typeof(r=null!=(r=t(i,"name")||(null!=e?t(e,"name"):e))?r:s)==l?r.call(a,{name:"name",hash:{},data:o,loc:{start:{line:118,column:10},end:{line:118,column:18}}}):r)+"_u_range = float("+h(typeof(r=null!=(r=t(i,"name")||(null!=e?t(e,"name"):e))?r:s)==l?r.call(a,{name:"name",hash:{},data:o,loc:{start:{line:118,column:35},end:{line:118,column:43}}}):r)+"_u_max - "+h(typeof(r=null!=(r=t(i,"name")||(null!=e?t(e,"name"):e))?r:s)==l?r.call(a,{name:"name",hash:{},data:o,loc:{start:{line:118,column:52},end:{line:118,column:60}}}):r)+"_u_min);\n    zeroToOne."+h(typeof(r=null!=(r=t(i,"name")||(null!=e?t(e,"name"):e))?r:s)==l?r.call(a,{name:"name",hash:{},data:o,loc:{start:{line:119,column:14},end:{line:119,column:22}}}):r)+" = ("+h(typeof(r=null!=(r=t(i,"name")||(null!=e?t(e,"name"):e))?r:s)==l?r.call(a,{name:"name",hash:{},data:o,loc:{start:{line:119,column:26},end:{line:119,column:34}}}):r)+"_position - "+h(typeof(r=null!=(r=t(i,"name")||(null!=e?t(e,"name"):e))?r:s)==l?r.call(a,{name:"name",hash:{},data:o,loc:{start:{line:119,column:46},end:{line:119,column:54}}}):r)+"_u_min) / "+h(typeof(r=null!=(r=t(i,"name")||(null!=e?t(e,"name"):e))?r:s)==l?r.call(a,{name:"name",hash:{},data:o,loc:{start:{line:119,column:64},end:{line:119,column:72}}}):r)+"_u_range;\n"},28:function(t,e,i,n,o){var r,a=null!=e?e:t.nullContext||{},s=t.hooks.helperMissing,l="function",h=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"    vec2 "+h(typeof(r=null!=(r=t(i,"name")||(null!=e?t(e,"name"):e))?r:s)==l?r.call(a,{name:"name",hash:{},data:o,loc:{start:{line:122,column:9},end:{line:122,column:17}}}):r)+"_u_range = ds_sub("+h(typeof(r=null!=(r=t(i,"name")||(null!=e?t(e,"name"):e))?r:s)==l?r.call(a,{name:"name",hash:{},data:o,loc:{start:{line:122,column:35},end:{line:122,column:43}}}):r)+"_u_max, "+h(typeof(r=null!=(r=t(i,"name")||(null!=e?t(e,"name"):e))?r:s)==l?r.call(a,{name:"name",hash:{},data:o,loc:{start:{line:122,column:51},end:{line:122,column:59}}}):r)+"_u_min);  \n    vec2 "+h(typeof(r=null!=(r=t(i,"name")||(null!=e?t(e,"name"):e))?r:s)==l?r.call(a,{name:"name",hash:{},data:o,loc:{start:{line:123,column:9},end:{line:123,column:17}}}):r)+"_position2 = ds_sub("+h(typeof(r=null!=(r=t(i,"name")||(null!=e?t(e,"name"):e))?r:s)==l?r.call(a,{name:"name",hash:{},data:o,loc:{start:{line:123,column:37},end:{line:123,column:45}}}):r)+"_position, "+h(typeof(r=null!=(r=t(i,"name")||(null!=e?t(e,"name"):e))?r:s)==l?r.call(a,{name:"name",hash:{},data:o,loc:{start:{line:123,column:56},end:{line:123,column:64}}}):r)+"_u_min);             \n    vec2 "+h(typeof(r=null!=(r=t(i,"name")||(null!=e?t(e,"name"):e))?r:s)==l?r.call(a,{name:"name",hash:{},data:o,loc:{start:{line:124,column:9},end:{line:124,column:17}}}):r)+"_zeroToOne = ds_div("+h(typeof(r=null!=(r=t(i,"name")||(null!=e?t(e,"name"):e))?r:s)==l?r.call(a,{name:"name",hash:{},data:o,loc:{start:{line:124,column:37},end:{line:124,column:45}}}):r)+"_position2,"+h(typeof(r=null!=(r=t(i,"name")||(null!=e?t(e,"name"):e))?r:s)==l?r.call(a,{name:"name",hash:{},data:o,loc:{start:{line:124,column:56},end:{line:124,column:64}}}):r)+"_u_range);\n    zeroToOne."+h(typeof(r=null!=(r=t(i,"name")||(null!=e?t(e,"name"):e))?r:s)==l?r.call(a,{name:"name",hash:{},data:o,loc:{start:{line:125,column:14},end:{line:125,column:22}}}):r)+" = "+h(typeof(r=null!=(r=t(i,"name")||(null!=e?t(e,"name"):e))?r:s)==l?r.call(a,{name:"name",hash:{},data:o,loc:{start:{line:125,column:25},end:{line:125,column:33}}}):r)+"_zeroToOne.x;\n"},30:function(t,e,i,n,o){return"    gl_PointSize = pointSize;\n    "},32:function(t,e,i,n,o){return" gl_PointSize = u_point_size;\n"},34:function(t,e,i,n,o){return"    v_color = h_color;\n"},36:function(t,e,i,n,o){return"    v_barCoord = a_barCoord;\n    v_xBorder = a_xBorder;\n    v_yBorder = a_yBorder;\n"},38:function(t,e,i,n,o){return"    vDataIcon = dataIcon;\n"},40:function(t,e,i,n,o){return"    float normalizedPosX = ((x_position - x_u_min) / x_u_range) * u_canvasWidth;\n    float normalizedPosY = ((y_position - y_u_min) / y_u_range) * u_canvasHeight;\n    v_uv = vec2(normalizedPosX / 40.0, normalizedPosY / 40.0 );\n"},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o,r,a){var s,l=null!=e?e:t.nullContext||{},h=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(s=h(i,"if").call(l,null!=e?h(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(1,o,0,r,a),inverse:t.noop,data:o,loc:{start:{line:1,column:0},end:{line:1,column:38}}}))?s:"")+"\n\n"+(null!=(s=h(i,"each").call(l,null!=e?h(e,"axis"):e,{name:"each",hash:{},fn:t.program(3,o,0,r,a),inverse:t.noop,data:o,loc:{start:{line:3,column:0},end:{line:7,column:9}}}))?s:"")+"\n"+(null!=(s=h(i,"if").call(l,null!=e?h(e,"isColored"):e,{name:"if",hash:{},fn:t.program(8,o,0,r,a),inverse:t.noop,data:o,loc:{start:{line:9,column:0},end:{line:12,column:7}}}))?s:"")+"\n"+(null!=(s=h(i,"if").call(l,null!=e?h(e,"isPatterned"):e,{name:"if",hash:{},fn:t.program(13,o,0,r,a),inverse:t.noop,data:o,loc:{start:{line:14,column:0},end:{line:18,column:7}}}))?s:"")+"\nuniform float u_point_size;\n"+(null!=(s=h(i,"if").call(l,null!=e?h(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(4,o,0,r,a),inverse:t.program(6,o,0,r,a),data:o,loc:{start:{line:21,column:0},end:{line:21,column:42}}}))?s:"")+" float pointSize;\n\n"+(null!=(s=h(i,"if").call(l,null!=e?h(e,"isBorder"):e,{name:"if",hash:{},fn:t.program(15,o,0,r,a),inverse:t.noop,data:o,loc:{start:{line:23,column:0},end:{line:32,column:7}}}))?s:"")+"\n"+(null!=(s=h(i,"if").call(l,null!=e?h(e,"isDataIcons"):e,{name:"if",hash:{},fn:t.program(17,o,0,r,a),inverse:t.noop,data:o,loc:{start:{line:34,column:0},end:{line:37,column:7}}}))?s:"")+"\n"+(null!=(s=h(i,"if").call(l,null!=e?h(e,"math"):e,{name:"if",hash:{},fn:t.program(19,o,0,r,a),inverse:t.noop,data:o,loc:{start:{line:39,column:0},end:{line:102,column:7}}}))?s:"")+"\nvoid main() {\n    vec2 zeroToOne;\n"+(null!=(s=h(i,"each").call(l,null!=e?h(e,"axis"):e,{name:"each",hash:{},fn:t.program(21,o,0,r,a),inverse:t.noop,data:o,loc:{start:{line:106,column:4},end:{line:127,column:13}}}))?s:"")+"\n    // 32-bit below here                \n    // convert from 0->1 to 0->2\n    vec2 zeroToTwo = zeroToOne * 2.0;\n\n    // convert from 0->2 to -1->+1 (clip space)\n    vec2 clipSpace = zeroToTwo - 1.0;\n\n    gl_Position = vec4(clipSpace, 0, 1);\n\n"+(null!=(s=h(i,"if").call(l,null!=e?h(e,"isSize"):e,{name:"if",hash:{},fn:t.program(30,o,0,r,a),inverse:t.program(32,o,0,r,a),data:o,loc:{start:{line:138,column:4},end:{line:141,column:11}}}))?s:"")+"\n"+(null!=(s=h(i,"if").call(l,null!=e?h(e,"isColored"):e,{name:"if",hash:{},fn:t.program(34,o,0,r,a),inverse:t.noop,data:o,loc:{start:{line:143,column:4},end:{line:145,column:11}}}))?s:"")+"\n"+(null!=(s=h(i,"if").call(l,null!=e?h(e,"isBorder"):e,{name:"if",hash:{},fn:t.program(36,o,0,r,a),inverse:t.noop,data:o,loc:{start:{line:147,column:4},end:{line:151,column:11}}}))?s:"")+"\n"+(null!=(s=h(i,"if").call(l,null!=e?h(e,"isDataIcons"):e,{name:"if",hash:{},fn:t.program(38,o,0,r,a),inverse:t.noop,data:o,loc:{start:{line:153,column:4},end:{line:155,column:11}}}))?s:"")+"\n"+(null!=(s=h(i,"if").call(l,null!=e?h(e,"isPatterned"):e,{name:"if",hash:{},fn:t.program(40,o,0,r,a),inverse:t.noop,data:o,loc:{start:{line:157,column:4},end:{line:161,column:11}}}))?s:"")+"\n}\n"},useData:!0,useDepths:!0}),q.fileExporter=k.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){var r=null!=e?e:t.nullContext||{},a=t.hooks.helperMissing,s=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="chartGLExportButtons">\n    <span class="lnksExport link-disabled">\n        <i class="fa fa-fw fa-download" title="'+s((t(i,"t")||e&&t(e,"t")||a).call(r,"Data",{name:"t",hash:{},data:o,loc:{start:{line:3,column:47},end:{line:3,column:59}}}))+'"></i>\n        <a class="lnkExcelExport" title="'+s((t(i,"t")||e&&t(e,"t")||a).call(r,"Download the current dataset in Excel format",{name:"t",hash:{},data:o,loc:{start:{line:4,column:41},end:{line:4,column:93}}}))+'">'+s((t(i,"t")||e&&t(e,"t")||a).call(r,"Excel",{name:"t",hash:{},data:o,loc:{start:{line:4,column:95},end:{line:4,column:108}}}))+'</a>\n        <a class="lnkCsvExport" title="'+s((t(i,"t")||e&&t(e,"t")||a).call(r,"Download the current dataset in CSV format",{name:"t",hash:{},data:o,loc:{start:{line:5,column:39},end:{line:5,column:89}}}))+'">'+s((t(i,"t")||e&&t(e,"t")||a).call(r,"CSV",{name:"t",hash:{},data:o,loc:{start:{line:5,column:91},end:{line:5,column:102}}}))+'</a>\n         <a class="lnkPngExport" title="'+s((t(i,"t")||e&&t(e,"t")||a).call(r,"Download the current dataset in PNG format",{name:"t",hash:{},data:o,loc:{start:{line:6,column:40},end:{line:6,column:90}}}))+'">'+s((t(i,"t")||e&&t(e,"t")||a).call(r,"PNG",{name:"t",hash:{},data:o,loc:{start:{line:6,column:92},end:{line:6,column:103}}}))+"</a>\n    </span> \n</div> \n"},useData:!0}),q.fragment=k.template({1:function(t,e,i,n,o){return"#version 300 es"},3:function(t,e,i,n,o){return"out vec4 outColor;\n"},5:function(t,e,i,n,o){var r,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"    "+(null!=(r=s(i,"if").call(a,null!=e?s(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(6,o,0),inverse:t.program(8,o,0),data:o,loc:{start:{line:14,column:4},end:{line:14,column:44}}}))?r:"")+" vec2 v_barCoord;\n    "+(null!=(r=s(i,"if").call(a,null!=e?s(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(6,o,0),inverse:t.program(8,o,0),data:o,loc:{start:{line:15,column:4},end:{line:15,column:44}}}))?r:"")+" float v_xBorder;\n    "+(null!=(r=s(i,"if").call(a,null!=e?s(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(6,o,0),inverse:t.program(8,o,0),data:o,loc:{start:{line:16,column:4},end:{line:16,column:44}}}))?r:"")+" float v_yBorder;\n\n    uniform vec4 a_borderColor;\n    uniform float a_isHorizontal;\n"},6:function(t,e,i,n,o){return"in"},8:function(t,e,i,n,o){return"varying"},10:function(t,e,i,n,o){return"  in float vDataIcon;\n  uniform mediump sampler2DArray u_dataIcons;\n"},12:function(t,e,i,n,o){var r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"    uniform sampler2D spriteTexture;\n    "+(null!=(i=r(i,"if").call(null!=e?e:t.nullContext||{},null!=e?r(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(6,o,0),inverse:t.program(8,o,0),data:o,loc:{start:{line:29,column:4},end:{line:29,column:44}}}))?i:"")+" vec2 v_uv;\n"},14:function(t,e,i,n,o){var r,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"    "+(null!=(r=s(i,"if").call(a,null!=e?s(e,"isTextured"):e,{name:"if",hash:{},fn:t.program(15,o,0),inverse:t.noop,data:o,loc:{start:{line:31,column:4},end:{line:31,column:61}}}))?r:"")+"\n"+(null!=(r=s(i,"if").call(a,null!=e?s(e,"isColored"):e,{name:"if",hash:{},fn:t.program(17,o,0),inverse:t.program(19,o,0),data:o,loc:{start:{line:32,column:4},end:{line:35,column:11}}}))?r:"")},15:function(t,e,i,n,o){return"uniform sampler2D spriteTexture;"},17:function(t,e,i,n,o){var r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"        "+(null!=(i=r(i,"if").call(null!=e?e:t.nullContext||{},null!=e?r(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(6,o,0),inverse:t.program(8,o,0),data:o,loc:{start:{line:33,column:8},end:{line:33,column:48}}}))?i:"")+" vec4 v_color;\n        "},19:function(t,e,i,n,o){return"uniform vec4 a_color; \n"},21:function(t,e,i,n,o){return"outColor"},23:function(t,e,i,n,o){return"gl_FragColor"},25:function(t,e,i,n,o){var r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"texture"+(null!=(i=r(i,"unless").call(null!=e?e:t.nullContext||{},null!=e?r(e,"isWebGL2"):e,{name:"unless",hash:{},fn:t.program(26,o,0),inverse:t.noop,data:o,loc:{start:{line:42,column:34},end:{line:42,column:67}}}))?i:"")+"(spriteTexture, v_uv);\n"},26:function(t,e,i,n,o){return"2D"},28:function(t,e,i,n,o){var r,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"            "+(null!=(r=s(i,"if").call(a,null!=e?s(e,"isDataIcons"):e,{name:"if",hash:{},fn:t.program(29,o,0),inverse:t.noop,data:o,loc:{start:{line:44,column:12},end:{line:44,column:126}}}))?r:"")+"\n            "+(null!=(r=s(i,"if").call(a,null!=e?s(e,"isTextured"):e,{name:"if",hash:{},fn:t.program(31,o,0),inverse:t.noop,data:o,loc:{start:{line:45,column:12},end:{line:45,column:110}}}))?r:"")+"\n            "+(null!=(r=s(i,"if").call(a,null!=e?s(e,"isColored"):e,{name:"if",hash:{},fn:t.program(33,o,0),inverse:t.program(35,o,0),data:o,loc:{start:{line:46,column:12},end:{line:46,column:58}}}))?r:"")+";\n"},29:function(t,e,i,n,o){var r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"texture"+(null!=(i=r(i,"unless").call(null!=e?e:t.nullContext||{},null!=e?r(e,"isWebGL2"):e,{name:"unless",hash:{},fn:t.program(26,o,0),inverse:t.noop,data:o,loc:{start:{line:44,column:38},end:{line:44,column:71}}}))?i:"")+"(u_dataIcons, vec3(gl_PointCoord, vDataIcon)) * "},31:function(t,e,i,n,o){var r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"texture"+(null!=(i=r(i,"unless").call(null!=e?e:t.nullContext||{},null!=e?r(e,"isWebGL2"):e,{name:"unless",hash:{},fn:t.program(26,o,0),inverse:t.noop,data:o,loc:{start:{line:45,column:37},end:{line:45,column:70}}}))?i:"")+"(spriteTexture, gl_PointCoord) * "},33:function(t,e,i,n,o){return"v_color"},35:function(t,e,i,n,o){return"a_color"},37:function(t,e,i,n,o){var r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"        float edgeDistPrimary;\n        float distToOuterEdge;\n        float borderWidth;\n\n        if (a_isHorizontal == 1.0) {\n            edgeDistPrimary = min(v_barCoord.y, 1.0 - v_barCoord.y);\n            distToOuterEdge = 1.0 - v_barCoord.x;\n            borderWidth = v_yBorder;\n        } else {\n            edgeDistPrimary = min(v_barCoord.x, 1.0 - v_barCoord.x);\n            distToOuterEdge = 1.0 - v_barCoord.y;\n            borderWidth = v_xBorder;\n        }\n\n        bool inPrimaryBorder = edgeDistPrimary < v_xBorder;\n        bool inOuterBorder = distToOuterEdge < v_yBorder;\n        if (inPrimaryBorder || inOuterBorder) {\n            "+(null!=(i=r(i,"if").call(null!=e?e:t.nullContext||{},null!=e?r(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(21,o,0),inverse:t.program(23,o,0),data:o,loc:{start:{line:68,column:12},end:{line:68,column:63}}}))?i:"")+" = a_borderColor;\n        }  \n"},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){var r,a=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(r=s(i,"if").call(a,null!=e?s(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:1,column:0},end:{line:1,column:38}}}))?r:"")+"\n\n// fragment shaders don't have a default precision so we need\n// to pick one. mediump is a good default\n\nprecision mediump float;\nprecision mediump int;\n\n"+(null!=(r=s(i,"if").call(a,null!=e?s(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o,loc:{start:{line:9,column:0},end:{line:11,column:7}}}))?r:"")+"\n"+(null!=(r=s(i,"if").call(a,null!=e?s(e,"isBorder"):e,{name:"if",hash:{},fn:t.program(5,o,0),inverse:t.noop,data:o,loc:{start:{line:13,column:0},end:{line:20,column:7}}}))?r:"")+"\n"+(null!=(r=s(i,"if").call(a,null!=e?s(e,"isDataIcons"):e,{name:"if",hash:{},fn:t.program(10,o,0),inverse:t.noop,data:o,loc:{start:{line:22,column:0},end:{line:25,column:7}}}))?r:"")+"\n"+(null!=(r=s(i,"if").call(a,null!=e?s(e,"isPatterned"):e,{name:"if",hash:{},fn:t.program(12,o,0),inverse:t.program(14,o,0),data:o,loc:{start:{line:27,column:0},end:{line:36,column:7}}}))?r:"")+"\n\n\nvoid main() {\n    "+(null!=(r=s(i,"if").call(a,null!=e?s(e,"isWebGL2"):e,{name:"if",hash:{},fn:t.program(21,o,0),inverse:t.program(23,o,0),data:o,loc:{start:{line:41,column:4},end:{line:41,column:55}}}))?r:"")+" = \n        "+(null!=(r=s(i,"if").call(a,null!=e?s(e,"isPatterned"):e,{name:"if",hash:{},fn:t.program(25,o,0),inverse:t.program(28,o,0),data:o,loc:{start:{line:42,column:8},end:{line:47,column:11}}}))?r:"")+"\n    // find minimum distance to any edge (0 or 1 in either axis)\n"+(null!=(r=s(i,"if").call(a,null!=e?s(e,"isBorder"):e,{name:"if",hash:{},fn:t.program(37,o,0),inverse:t.noop,data:o,loc:{start:{line:50,column:4},end:{line:70,column:11}}}))?r:"")+"\n\n   \n}\n"},useData:!0}),q.highlightRule=k.template({1:function(t,e,i,n,o){var r,a=null!=e?e:t.nullContext||{},s=t.hooks.helperMissing,l="function",h=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <li><svg style="background:'+h(typeof(r=null!=(r=t(i,"ruleColor")||(null!=e?t(e,"ruleColor"):e))?r:s)==l?r.call(a,{name:"ruleColor",hash:{},data:o,loc:{start:{line:3,column:31},end:{line:3,column:44}}}):r)+'; margin-right:4px;" width="15" height="16"></svg>\n    <span style="color:'+h(typeof(r=null!=(r=t(i,"color")||(null!=e?t(e,"color"):e))?r:s)==l?r.call(a,{name:"color",hash:{},data:o,loc:{start:{line:4,column:23},end:{line:4,column:32}}}):r)+'">'+h(typeof(r=null!=(r=t(i,"ruleName")||(null!=e?t(e,"ruleName"):e))?r:s)==l?r.call(a,{name:"ruleName",hash:{},data:o,loc:{start:{line:4,column:34},end:{line:4,column:46}}}):r)+"</span></li>\n"},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){return'<ul class="chartgl-highlight-rule">\n'+(null!=(i=(t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]})(i,"each").call(null!=e?e:t.nullContext||{},e,{name:"each",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:2,column:0},end:{line:5,column:9}}}))?i:"")+"</ul>"},useData:!0}),q.legend=k.template({1:function(t,e,i,n,o){var r=null!=e?e:t.nullContext||{},a=t.hooks.helperMissing,s="function",l=t.escapeExpression,h=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"  \x3c!--legend color--\x3e\n    <li>\n"+(null!=(t=h(i,"if").call(r,null!=e?h(e,"image"):e,{name:"if",hash:{},fn:t.program(2,o,0),inverse:t.program(4,o,0),data:o,loc:{start:{line:5,column:6},end:{line:22,column:13}}}))?t:"")+'\n      \x3c!--legend text--\x3e\n      <span style="color:'+l(typeof(t=null!=(t=h(i,"fontColor")||(null!=e?h(e,"fontColor"):e))?t:a)==s?t.call(r,{name:"fontColor",hash:{},data:o,loc:{start:{line:25,column:25},end:{line:25,column:38}}}):t)+"; text-decoration:"+l(typeof(t=null!=(t=h(i,"strike")||(null!=e?h(e,"strike"):e))?t:a)==s?t.call(r,{name:"strike",hash:{},data:o,loc:{start:{line:25,column:56},end:{line:25,column:66}}}):t)+'" id="'+l(typeof(t=null!=(t=h(i,"text")||(null!=e?h(e,"text"):e))?t:a)==s?t.call(r,{name:"text",hash:{},data:o,loc:{start:{line:25,column:72},end:{line:25,column:80}}}):t)+'">'+l(typeof(t=null!=(t=h(i,"text")||(null!=e?h(e,"text"):e))?t:a)==s?t.call(r,{name:"text",hash:{},data:o,loc:{start:{line:25,column:82},end:{line:25,column:90}}}):t)+"</span>\n    </li>\n"},2:function(t,e,i,n,o){var r,a=null!=e?e:t.nullContext||{},s=t.hooks.helperMissing,l="function",h=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'        <i style="height:'+h(typeof(r=null!=(r=t(i,"width")||(null!=e?t(e,"width"):e))?r:s)==l?r.call(a,{name:"width",hash:{},data:o,loc:{start:{line:6,column:25},end:{line:6,column:34}}}):r)+"px;color:"+h(typeof(r=null!=(r=t(i,"color")||(null!=e?t(e,"color"):e))?r:s)==l?r.call(a,{name:"color",hash:{},data:o,loc:{start:{line:6,column:43},end:{line:6,column:52}}}):r)+";margin-top:2.5px;margin-right:5px;"+h(typeof(r=null!=(r=t(i,"image")||(null!=e?t(e,"image"):e))?r:s)==l?r.call(a,{name:"image",hash:{},data:o,loc:{start:{line:6,column:87},end:{line:6,column:96}}}):r)+'"></i>\n'},4:function(t,e,i,n,o){var r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=r(i,"if").call(null!=e?e:t.nullContext||{},null!=e?r(e,"icon"):e,{name:"if",hash:{},fn:t.program(5,o,0),inverse:t.program(7,o,0),data:o,loc:{start:{line:7,column:6},end:{line:22,column:6}}}))?i:""},5:function(t,e,i,n,o){var r,a=null!=e?e:t.nullContext||{},s=t.hooks.helperMissing,l="function",h=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'        <i style="height:'+h(typeof(r=null!=(r=t(i,"width")||(null!=e?t(e,"width"):e))?r:s)==l?r.call(a,{name:"width",hash:{},data:o,loc:{start:{line:8,column:25},end:{line:8,column:34}}}):r)+"px;color:"+h(typeof(r=null!=(r=t(i,"color")||(null!=e?t(e,"color"):e))?r:s)==l?r.call(a,{name:"color",hash:{},data:o,loc:{start:{line:8,column:43},end:{line:8,column:52}}}):r)+';margin-top:2.5px;margin-right:5px;"class="fa '+h(typeof(r=null!=(r=t(i,"icon")||(null!=e?t(e,"icon"):e))?r:s)==l?r.call(a,{name:"icon",hash:{},data:o,loc:{start:{line:8,column:98},end:{line:8,column:106}}}):r)+'"></i>\n'},7:function(t,e,i,n,o){var r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(i=r(i,"if").call(null!=e?e:t.nullContext||{},null!=e?r(e,"bullColor"):e,{name:"if",hash:{},fn:t.program(8,o,0),inverse:t.program(10,o,0),data:o,loc:{start:{line:10,column:8},end:{line:21,column:15}}}))?i:"")+"      "},8:function(t,e,i,n,o){var r,a=null!=e?e:t.nullContext||{},s=t.hooks.helperMissing,l="function",h=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'          <span style="margin-right:5px;">\n            <i style="font-size: 16px;color:'+h(typeof(r=null!=(r=t(i,"color")||(null!=e?t(e,"color"):e))?r:s)==l?r.call(a,{name:"color",hash:{},data:o,loc:{start:{line:12,column:44},end:{line:12,column:53}}}):r)+';margin-top:0;" class="fa fa-ellipsis-v"></i>\n            <i style="font-size: 8px;margin-left:-5px;color:'+h(typeof(r=null!=(r=t(i,"bullColor")||(null!=e?t(e,"bullColor"):e))?r:s)==l?r.call(a,{name:"bullColor",hash:{},data:o,loc:{start:{line:13,column:60},end:{line:13,column:73}}}):r)+';margin-top:3px;position: absolute;"class="fa fa-square"></i>\n          </span>\n'},10:function(t,e,i,n,o){var r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(i=r(i,"if").call(null!=e?e:t.nullContext||{},null!=e?r(e,"isHeatmap"):e,{name:"if",hash:{},fn:t.program(11,o,0),inverse:t.program(13,o,0),data:o,loc:{start:{line:16,column:10},end:{line:20,column:19}}}))?i:""},11:function(t,e,i,n,o){var r,a=null!=e?e:t.nullContext||{},s=t.hooks.helperMissing,l="function",h=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'            <svg style="background:'+h(typeof(r=null!=(r=t(i,"color")||(null!=e?t(e,"color"):e))?r:s)==l?r.call(a,{name:"color",hash:{},data:o,loc:{start:{line:17,column:35},end:{line:17,column:44}}}):r)+"; border-radius:2px;width:"+h(typeof(r=null!=(r=t(i,"width")||(null!=e?t(e,"width"):e))?r:s)==l?r.call(a,{name:"width",hash:{},data:o,loc:{start:{line:17,column:70},end:{line:17,column:79}}}):r)+"px; height:"+h(typeof(r=null!=(r=t(i,"width")||(null!=e?t(e,"width"):e))?r:s)==l?r.call(a,{name:"width",hash:{},data:o,loc:{start:{line:17,column:90},end:{line:17,column:99}}}):r)+"px;margin-top:2px;margin-right:5px;"+h(typeof(r=null!=(r=t(i,"image")||(null!=e?t(e,"image"):e))?r:s)==l?r.call(a,{name:"image",hash:{},data:o,loc:{start:{line:17,column:134},end:{line:17,column:143}}}):r)+'"class="fa fa-square"></svg>\n'},13:function(t,e,i,n,o){var r,a=null!=e?e:t.nullContext||{},s=t.hooks.helperMissing,l="function",h=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'            <i style="height:'+h(typeof(r=null!=(r=t(i,"width")||(null!=e?t(e,"width"):e))?r:s)==l?r.call(a,{name:"width",hash:{},data:o,loc:{start:{line:19,column:29},end:{line:19,column:38}}}):r)+"px;color:"+h(typeof(r=null!=(r=t(i,"color")||(null!=e?t(e,"color"):e))?r:s)==l?r.call(a,{name:"color",hash:{},data:o,loc:{start:{line:19,column:47},end:{line:19,column:56}}}):r)+";margin-top:2.5px;margin-right:5px;"+h(typeof(r=null!=(r=t(i,"image")||(null!=e?t(e,"image"):e))?r:s)==l?r.call(a,{name:"image",hash:{},data:o,loc:{start:{line:19,column:91},end:{line:19,column:100}}}):r)+'"class="fa fa-square"></i>\n'},compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){return'<ul class="chartgl-legend">\n'+(null!=(i=(t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]})(i,"each").call(null!=e?e:t.nullContext||{},e,{name:"each",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:2,column:2},end:{line:27,column:11}}}))?i:"")+"</ul>"},useData:!0}),q.textNoteDialog=k.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,n,o){var r=null!=e?e:t.nullContext||{},a=t.hooks.helperMissing,s=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="edit-text-annotation">\n    <div class="edit-prop prop-text">\n        <label for="note-text">'+s((t(i,"t")||e&&t(e,"t")||a).call(r,"Text",{name:"t",hash:{},data:o,loc:{start:{line:3,column:31},end:{line:3,column:43}}}))+'</label>\n        <textarea id="note-text" class="annotate-text ui-widget ui-state-default ui-corner-all" rows="4" cols="25" data-property-name="text"></textarea>\n    </div>\n    <div class="edit-prop prop-text-color">\n        <label>'+s((t(i,"t")||e&&t(e,"t")||a).call(r,"Text color",{name:"t",hash:{},data:o,loc:{start:{line:7,column:15},end:{line:7,column:33}}}))+'</label>\n        <span class="fa fa-fw watermark fa-tint annotate-color-icon text-color-icon"></span>\n        <button class="annotate-color-btn text-color-btn ui-widget ui-state-default ui-corner-all" data-property-name="aColor">\n        </button>\n    </div>\n    <div class="edit-prop prop-text-size">\n        <label>'+s((t(i,"t")||e&&t(e,"t")||a).call(r,"Font size",{name:"t",hash:{},data:o,loc:{start:{line:13,column:15},end:{line:13,column:32}}}))+'</label>\n        <input class="text-size ui-widget ui-state-default ui-corner-all" type="number" min="1" data-property-name="fontSize">\n    </div>\n    <div class="edit-prop-chkbox prop-text-bold">\n        <label>'+s((t(i,"t")||e&&t(e,"t")||a).call(r,"Bold",{name:"t",hash:{},data:o,loc:{start:{line:17,column:15},end:{line:17,column:27}}}))+'</label>\n        <input class="text-bold ui-widget ui-state-default ui-corner-all" type="checkbox" data-property-name="fontBold">\n    </div>\n    <div class="edit-prop prop-text-margin">\n        <label>'+s((t(i,"t")||e&&t(e,"t")||a).call(r,"Text margin",{name:"t",hash:{},data:o,loc:{start:{line:21,column:15},end:{line:21,column:34}}}))+'</label>\n        <input class="text-margin ui-widget ui-state-default ui-corner-all" type="number" min="0" max="50" data-property-name="textMargin">\n    </div>\n    <div class="edit-prop prop-fill-color">\n        <label>'+s((t(i,"t")||e&&t(e,"t")||a).call(r,"Fill color",{name:"t",hash:{},data:o,loc:{start:{line:25,column:15},end:{line:25,column:33}}}))+'</label>\n        <span class="fa fa-fw watermark fa-tint annotate-color-icon fill-color-icon"></span>\n        <button class="annotate-color-btn fill-color-btn ui-widget ui-state-default ui-corner-all" data-property-name="fillColor">\n        </button>\n    </div>\n    <div class="edit-prop prop-fill-opacity">\n        <label>'+s((t(i,"t")||e&&t(e,"t")||a).call(r,"Fill opacity",{name:"t",hash:{},data:o,loc:{start:{line:31,column:15},end:{line:31,column:35}}}))+'</label>\n        <input class="fill-opacity ui-slider ui-slider-horizontal ui-widget ui-widget-content ui-corner-all" type="range" min="0" max="100" data-property-name="fillOpacity"> \n    </div>\n    <div class="edit-prop prop-border-thickness">\n        <label>'+s((t(i,"t")||e&&t(e,"t")||a).call(r,"Border thickness",{name:"t",hash:{},data:o,loc:{start:{line:35,column:15},end:{line:35,column:39}}}))+'</label>\n        <input class="border-thickness ui-widget ui-state-default ui-corner-all" type="number" min="1" max="5" data-property-name="borderThickness">\n    </div>\n    <div class="edit-prop prop-border-color">\n        <label>'+s((t(i,"t")||e&&t(e,"t")||a).call(r,"Border color",{name:"t",hash:{},data:o,loc:{start:{line:39,column:15},end:{line:39,column:35}}}))+'</label>\n        <span class="fa fa-fw watermark fa-tint annotate-color-icon border-color-icon"></span>\n        <button class="annotate-color-btn border-color-btn ui-widget ui-state-default ui-corner-all" data-property-name="borderColor">\n        </button>\n    </div>\n    <div class="edit-prop prop-border-opacity">\n        <label>'+s((t(i,"t")||e&&t(e,"t")||a).call(r,"Border opacity",{name:"t",hash:{},data:o,loc:{start:{line:45,column:15},end:{line:45,column:37}}}))+'</label>\n           <input class="border-opacity ui-widget ui-state-default ui-corner-all" type="range" min="0" max="100" data-property-name="borderOpacity"> \n    </div>\n    <div class="edit-prop prop-anchor-position">\n        <label>'+s((t(i,"t")||e&&t(e,"t")||a).call(r,"Anchor position",{name:"t",hash:{},data:o,loc:{start:{line:49,column:15},end:{line:49,column:38}}}))+'</label>\n        <select class="anchor-position select2-container--dashboards select2-selection--single" data-property-name="anchorPosition">\n                <option value="topLeft">'+s((t(i,"t")||e&&t(e,"t")||a).call(r,"Top left",{name:"t",hash:{},data:o,loc:{start:{line:51,column:40},end:{line:51,column:56}}}))+'</option>\n                <option  value="bottomLeft">'+s((t(i,"t")||e&&t(e,"t")||a).call(r,"Bottom left",{name:"t",hash:{},data:o,loc:{start:{line:52,column:44},end:{line:52,column:63}}}))+"</option>\n            </select>\n    </div>\n</div>"},useData:!0});var F=q;function q(){}K.prototype.getBarWidth=function(){return this.fullBarWidth},K.drawXBounds=function(t,r,a,s){var l=[],h=[],p=[];return t.forEach(function(t,e){for(var i=r[e],t=(l.push(t,t,i,t,i,i),h.push(t,i),a[e%a.length]),n=Object.values(X.hexColorToVec4(t,s)),o=0;o<6;o++)p.push(n)}),[l,h,p]},K.drawYBounds=function(t,e){for(var i=[],n=0;n<e;n++)i.push(t.x,t.y,t.x,t.y,t.x,t.y);return i},K.prototype.getStackedYVals=function(){return this.stackedYVals},K.getBorderCoordinates=function(t){for(var e=[],i=0;i<t;i++)e.push(0,0,0,1,1,0,0,1,1,0,1,1);return new Float32Array(e)},K.prototype.getXBorderWidth=function(t,e,i){var n,o=e.borderWidth||0,e=e.orientation===H.BAR_HORIZONTAL?e.size.y:e.size.x,r=Math.abs(Number(i.z)-Number(i.x));r||(a=.1*Number(i.x),n=Number(i.x)-a,r=Number(i.z)+a-n);var i=o/((this.barWidth||.5)*(e/r)),a=Array(6*t.length).fill(i);return new Float32Array(a)},K.prototype.getYBorderWidth=function(o,t,e){var i,n,r=t.waterfallInfo,a=t.borderWidth||0,s=t.orientation===H.BAR_HORIZONTAL,l=Math.abs(Number(e.w)-Number(e.y)),h=(l||(i=.1*Number(e.y),n=Number(e.y)-i,l=Number(e.w)+i-n),s?t.size.x:t.size.y),p=[];return o.forEach(function(t,e){var i=Math.abs(t),n=(r&&(n=o[e-1],e=0<e&&e<o.length-1&&n!==t?n:0,i=Math.abs(t-e)),h/l),t=a/(i*n);p.push(t,t,t,t,t,t)}),new Float32Array(p)},K.prototype.getXBarPoints=function(i,a,t,s,l,h,e,p){var n,o,u=this,c=a.barGrouping,r=a.barWidth,d=null==c?void 0:c.barIndices,y=a.barType,g=X.getMidrange(new Y(t.x,t.z),h),f=a.size,g=(g&&(t=new V(Number(X.toBigInt(t.x)-g),t.y,Number(X.toBigInt(t.z)-g),t.w)),Math.abs(Number(t.z)-Number(t.x))),m=(g||(n=.1*Number(t.x),o=Number(t.x)-n,g=Number(t.z)+n-o),(null==d?void 0:d.length)||0),t=r/(a.orientation===H.BAR_VERTICAL||"y"===l?f.x:f.y),P=[],x=0,v=0,O=0,T=0;return null!=p&&p.stackedGapSize&&!_.isEmpty(null==p?void 0:p.prevLayerData)&&(T=p.stackedGapSize),O=c&&d?(v=d.indexOf(c.index)+(e||0),x=g/c.dataLength/(s?1:m),"Percentage"===y?x*r/2:g*t):(o=(n=i.slice(1).map(function(t,e){return t-i[e]})).length?0:.01*g,f=n.length?X.getDistance(n,i):o,g=g?Math.abs(g+o+o):10,"Percentage"===y?f/2*r:g*t),_.each(i,function(t,e){var i,n=t-O,o=t+O,r=.85*("Percentage"===y?x:2*O);c&&(i=0,n=(t=s||"x"!==l?t:t-(i=m*r/2)+r*(v+.5))-.85*O,o=t+.85*O,0===Number(e))&&(u.maxXDist=i),0===Number(e)&&(u.barWidth=O*(c?.85:1)*2,r?u.fullBarWidth=r:(i=X.convertJSToNumber(X.convertToJsScalar(h,n)),r=X.convertJSToNumber(X.convertToJsScalar(h,o)),u.fullBarWidth=Math.abs(i-r))),"y"===l&&a.orientation===H.BAR_HORIZONTAL&&(n=0,o=t,null!=p&&p.prevLayerData&&null!=p&&p.xData&&(n=(i=u.getStackedBars(p.prevLayerData,p.xData,e,o))[0],o=i[1],null!=p)&&p.stackedGapSize&&(t<0?n-=T:0<t&&(n+=T)),u.stackedYVals[e]=o),"x"===l&&a.orientation===H.BAR_HORIZONTAL?P.push(n,o,n,o,n,o):P.push(n,n,o,n,o,o)}),P},K.prototype.getWaterfallPoints=function(o,r,a){var s=[],l=[],h=r.colorArray;return o.forEach(function(t,e){var i=o[e-1],n=0<e&&e<o.length-1&&i!==t?i:0,n=(s.push(n,t,n,t,n,t),0===e||e===o.length-1||t===i);e=h&&h.length&&n&&void 0!==h[a][e]?h[a][e]:(e=Array.isArray(r.defaultColor)?r.defaultColor[a]:r.defaultColor,n=n?e:i<t?r.increaseColor:r.decreaseColor,X.hexColorToVec4(n,r.opacity)),l.push(Object.values(e))}),[s,l]},K.prototype.getYBarPoints=function(t,o){var r=this,a=0,s=(null!=o&&o.stackedGapSize&&!_.isEmpty(null==o?void 0:o.prevLayerData)&&(a=o.stackedGapSize),[]);return t.forEach(function(t,e){var i,n=0;null!=o&&o.prevLayerData&&null!=o&&o.xData&&(n=(i=r.getStackedBars(o.prevLayerData,o.xData,e,t))[0],null!=o&&o.stackedGapSize&&(t<0?n-=a:0<t&&(n+=a)),r.stackedYVals[e]=t=i[1]),s.push(n,t,n,t,n,t)}),s},K.prototype.getCandlesticks=function(o,r,a){var s=[],l=[];return o[0].forEach(function(t,e){var i,e=o[1][e],n=t===e&&a;n&&(t+=.002*r,e-=.002*r),s.push(t,e,t,e,t,e),a&&(i=Number(a.opa),n=n?a.neutralColor:t<e?a.bullColor:a.bearColor,t=X.hexColorToVec4(n,i),l.push(Object.values(t)))}),[s,l]},K.prototype.getMaxDist=function(){return this.maxXDist},K.prototype.getStackedBars=function(t,e,i,n){var o=0,e=e[i]+"";return void 0!==t[e]&&(i=t[e][0],t=t[e][1],n+=o=n<0?i:t),[o,n]};var j,J=K;function K(){this.fullBarWidth=0,this.maxXDist=0,this.stackedYVals=[],this.barWidth=0}(e=j=j||{}).Column="Column",e.Layer="Layer",e.Axis="Axis";Q=Backbone.View,g(l,Q),l.prototype.setTheme=function(t){this.theme=t,this.updateOverrideRulesProperties()},l.prototype.setPossibleAxes=function(t,e){var o=this,r=[];t.forEach(function(i,t){var n="Xaxes."+t+".Format.MultiAxis";o.api.getProperty(n).forEach(function(t,e){r.push(i+" Multi Axis - "+o.api.getProperty(n+"."+e+".Field"))})}),this.api.setProperty("possibleAxes",t.concat(e,r))},l.prototype.setPossibleDataCols=function(t){var i=[],n=[];t.forEach(function(t){var e=t.getAllCols(),t=t.getXCol();-1===i.indexOf(t)&&i.push(t),e.forEach(function(t){-1===i.indexOf(t)&&i.push(t),-1===n.indexOf(t)&&n.push(t)})}),this.api.setProperty("possibleDataCols",i),this.api.setProperty("possibleYDataCols",n)},l.prototype.setPossibleLayers=function(t){var i=this,t=t.map(function(t,e){return i.api.getProperty("Layers."+e+".Name")});this.api.setProperty("possibleLayers",t)},l.prototype.updateOverrideRulesAxis=function(t,e){var o=this,r=(this.axis.resetOverrideRules(),{}),a={},n=(e.forEach(function(t,e){var i=o.api.getProperty("Layers."+e+"."+H.PROP_XAXISID),n=o.api.getProperty("Layers."+e+"."+H.PROP_YAXISID),t=t.getAllCols(),e=o.api.getProperty("Layers."+e+"."+H.PROP_XAXIS);r[i]||(r[i]=[]),a[n]||(a[n]=[]),-1===r[i].indexOf(e)&&r[i].push(e),t.forEach(function(t){-1===a[n].indexOf(t)&&a[n].push(t)})}),this.api.getProperty(Te.PROP_XAXES).map(function(t,e){return"X-Axis "+(e+1)})),s=this.api.getProperty(Te.PROP_YAXES).map(function(t,e){return"Y-Axis "+(e+1)});n.forEach(function(i,t){var n="Xaxes."+t+W.PROP_MULTIAXIS;o.api.getProperty(n).forEach(function(t,e){r[i].push(o.api.getProperty(n+"."+e+".Field"))})}),t.forEach(function(t){var e,i=t.RuleTargetAxis;i&&(e=M.Tools.getRegex(i),o.axis.setOverrideRules(t,i,e,n,s,r,a))})},l.prototype.updateOverrideRulesColors=function(t,e){var s={};e.forEach(function(t){t.getAllCols().forEach(function(t){void 0===s[t]&&(s[t]="")})}),t.forEach(function(t,e){var i,n,o,r,a=X.getProperty(t[l.PROP_RULE_TARGET]);a&&(i=M.Tools.getRegex(a),n=X.getProperty(t[l.PROP_USE_PALETTE]),o=[X.getProperty(t[l.PROP_COLOR])],n&&(o=X.getProperty(t[l.PROP_COLUMN_PALETTE]).map(function(t){return"object"==typeof t.type&&t.type.attributes?t.type.attributes.value:t.type})),r=0,Object.keys(s).forEach(function(t,e){a&&(a.toLowerCase()===t.toLowerCase()||t.match(i))&&(s[t]=o[r],r+1>o.length-1?r=0:r++)}))}),e.forEach(function(t){return t.updateOverrideColors(s)})},l.prototype.updateOverrideRulesColorPalettes=function(t,e){var a=this,s=e.map(function(t){return[]});t.forEach(function(t){var n,o,r=X.getProperty(t[l.PROP_RULE_TARGET]);r&&(n=M.Tools.getRegex(r),o=X.getProperty(t[l.PROP_PALETTE]),e.forEach(function(t,e){var i=a.api.getProperty("Layers."+e+".Name");r&&(r.toLowerCase()===i.toLowerCase()||i.match(n))&&(s[e]=o)}))}),e.forEach(function(t,e){return t.updateOverridePalette(s[e])})},l.prototype.updateOverrideRulesProperties=function(){var r=this,t=this.api.getProperty(l.PROP_OVERRIDE_RULES),a=""+this.theme,s=".palette_theme";t.forEach(function(t,e){var i,n,o,e=l.PROP_OVERRIDE_RULES+"."+e+".";t.RuleType===j.Layer?(n=r.api.getProperty(e+l.PROP_PALETTETHEME),(o=M.Tools.getPaletteFromTheme(r.globalPalette,n,s,a)).updated&&r.api.setProperty(e+l.PROP_PALETTE,o.palette)):t.RuleType!==j.Column&&""!==t.RuleType||(t=r.api.getProperty(e+l.PROP_USE_PALETTE),i=r.api.getProperty(e+l.PROP_COLUMN_PALETTE),t?void 0===i?(r.api.setProperty(e+l.PROP_COLUMN_PALETTE,f),r.api.setProperty(e+l.PROP_COLOR,void 0),r.api.setProperty(e+l.PROP_COLUMN_PALETTE_THEME,"")):(n=r.api.getProperty(e+l.PROP_COLUMN_PALETTE_THEME),(o=M.Tools.getPaletteFromTheme(r.globalPalette,n,s,a)).updated&&r.api.setProperty(e+l.PROP_COLUMN_PALETTE,o.palette)):void 0!==i&&(r.api.setProperty(e+l.PROP_COLUMN_PALETTE,void 0),r.api.setProperty(e+l.PROP_COLUMN_PALETTE_THEME,void 0),r.api.setProperty(e+l.PROP_COLOR,"#F8F8F8")))})},l.PROP_OVERRIDE_RULES="OverrideRules",l.PROP_HIERARCHICAL_RULES="HierarchicalRules",l.PROP_COLOR="RuleColor",l.PROP_PALETTE="RuleColorPalette",l.PROP_PALETTETHEME="RulePaletteTheme",l.PROP_USE_PALETTE="UsePalette",l.PROP_COLUMN_PALETTE="RuleColumnsPalette",l.PROP_COLUMN_PALETTE_THEME="RuleColumnsPaletteTheme",l.PROP_RULE_TARGET="RuleTarget";var Q,tt=l;function l(t,e,i,n,o,r){var a=this,i=((a=Q.call(this,t)||this).api=e,a.axis=i,a.theme=n,a.globalPalette=o,null==(e=t.dashboardViewModel.get("HierarchicalRules"))?void 0:e.ChartHierarchicalRules);return i&&i.length?r({HierarchicalRules:i}):null!=(n=a.api.getProperty(l.PROP_HIERARCHICAL_RULES))&&n.length&&r({HierarchicalRules:[]}),a.listenTo(t.dashboardViewModel,"change:HierarchicalRules",function(t){t=null==(t=t.get("HierarchicalRules"))?void 0:t.ChartHierarchicalRules;r({HierarchicalRules:t})}),a}nt.calcVals=function(t,i,n){var o=[];return t.forEach(function(t,e){e=i[e];"x"===n?o.push(t,t,e,t,e,e):o.push(t,e,t,e,t,e)}),o};var et,I,it=nt;function nt(){}(i=et=et||{}).Linear="Linear",i.Monotone="Monotone",i.Stepped="Stepped",(e=I=I||{}).None="None",e.Dotted="Dotted",e.Dashed="Dashed";B.getSpanGaps=function(a,s){var l=[],h=[],p=[],u=a.nullVal,c=s.nullVal;return _.each(s.col,function(t,e){var i=s.scalar,n=a.scalar,i=i(s.col,e),n=n(a.col,e),o=Number(i),r=Number(n);l.push(o),h.push(r),(X.isNull(i,c)||X.isNull(n,u))&&p.push(Number(e))}),{x:h,y:l,indices:p}},B.spanGapsForLineFill=function(h,p,i,t){var n=i.map(function(t){for(var e=t,i=t;0<e&&(isNaN(h[e])||isNaN(p[e]));)e--;for(;i<h.length&&(isNaN(h[i])||isNaN(p[i]));)i++;var n=h[e],o=h[i],r=p[e],a=p[i],s=(t-e)/(i-e),l=(h[t]-n)/(o-n),o=n+s*(o-n),n=r+(isNaN(h[t])?s:l)*(a-r);return[isNaN(h[t])?o:h[t],isNaN(p[t])||isNaN(h[t])?n:p[t]]});return{x:h.map(function(t,e){return isNaN(t)&&0<e?(e=i.indexOf(e),n[e][0]):t}),y:p.map(function(t,e){return(isNaN(t)||isNaN(h[e]))&&0<e?(e=i.indexOf(e),n[e][1]):t})}},B.spanGaps=function(t,e,i,n){t=t.filter(function(t,e){return-1===i.indexOf(e)}),e=e.filter(function(t,e){return-1===i.indexOf(e)});for(var o=t[t.length-1],r=e[e.length-1],a=t.length;a<n.col.length;a++)t.push(o),e.push(r);return{x:t,y:e}},B.drawStyledLine=function(t,i,e,n){for(var o=e.lineThickness.size,r=t.length,a=t.map(function(t,e){e=i[e];return B.convertToScreenSpace(new Y(t,e),n,o)}),s=e.dashGap+3,t=e.lineThickness.lineThickness,l=e.lineStyle===I.Dotted?t:e.dashWidth+1,h=[],p=[],u=1;u<r;u++){var c=!1,d=!1,y=a[u-1],g=isNaN(y.x)||isNaN(y.y)?y:a[u-1],y=a[u];if(e.isStreaming||(d=B.checkIfPointWithinBounds(y,g,n,o)),e.isStreaming||d){for(var f,m,P,x,d=y.x-g.x,v=y.y-g.y,O=Math.sqrt(v*v+d*d),T=Math.floor(O/(l+s)),R=1+(e.lineStyle===I.Dotted?1:2)*T,b=(l<O%(l+s)?R+=1:c=!0,d/R),_=v/R,T=Y.normalize(Y.subtract(y,g)),C=Y.multiply(T,new Y(s,s)),L=Y.multiply(T,new Y(l,l)),A=[],E=0;E<R;E++)e.lineStyle===I.Dotted?(m=g.x+b*(E+1),f=g.y+_*(E+1),m=B.convertFromScreenSpace(new Y(m,f),n,o),h.push(m.x),p.push(m.y)):(f=Math.floor(E/2+E%2)*L.x+(E-E%2)/2*C.x,m=Math.floor(E/2+E%2)*L.y+(E-E%2)/2*C.y,P=g.x+f,x=g.y+m,A.push(new Y(P,x)));if(c&&A.push(y),e.lineStyle===I.Dashed)for(E=1;E<A.length;E+=2){var S=A[E],D=B.convertFromScreenSpace(A[E-1],n,o),S=B.convertFromScreenSpace(S,n,o);h.push(NaN,D.x,S.x),p.push(NaN,D.y,S.y)}}}return[h,p]},B.drawLine=function(t,e,i,n){var e=T([],e,!0),t=T([],t,!0),o=i.lineThickness,n=B.getLineBounds(i,n),r=i.interpolation===et.Monotone&&i.segmentLength,a=i.lineStyle;if(0<i.dashGap&&a!==I.None){var s=B.drawStyledLine(e,t,i,n);if((a===I.Dotted||a===I.Dashed&&0<i.dashWidth)&&(e=s[0],t=s[1]),!i.useThickLines||a===I.Dotted)return[e,t,[],[],0]}return r?B.drawMonotoneInterpolation(i,e,t,n):B.drawMiterLines(o,e,t,n)},B.getCatmullRomPoints=function(t,i,e,n){var o=e.lineThickness.size,t=t.map(function(t,e){return B.convertToScreenSpace(new Y(t,i[e]),n,o)});return t.length<2?[]:B.calcCatmullRomPoints(t,n,e)},B.calcCatmullRomPoints=function(t,e,i){var n=i.lineThickness.size,o=i.zoomVal,r=o.z-o.x,o=o.w-o.y,a=Math.min(500,i.segmentLength*(1/((r+o)/2))),a=B.closestNumber(a,6),s=[];t.unshift(t[0]),t.push(t[t.length-1]);for(var l=1;l<t.length-2;l++){var h,p,u=!1;if(i.isStreaming||(h=t[l+2],p=t[l-1],u=B.checkIfPointWithinBounds(h,p,e,n)),i.isStreaming||u)for(var c=t[l-1],d=t[l],y=t[l+1],g=t[l+2],f=0;f<1;f+=1/a){var m=f*f,P=m*f,x=.5*(2*m-P-f),v=.5*(3*P-5*m+2),O=.5*(-3*P+4*m+f),P=.5*(P-m),m=x*c.x+v*d.x+O*y.x+P*g.x,x=x*c.y+v*d.y+O*y.y+P*g.y;s.push(new Y(m,x))}}return s.unshift(t[0]),s.push(t[t.length-1]),[s,a]},B.checkIfPointWithinBounds=function(t,e,i,n){t=B.convertFromScreenSpace(t,i,n),e=B.convertFromScreenSpace(e,i,n);return t.x>=i.x&&e.x<=i.z},B.getLineBounds=function(t,e){var i=null==(i=e.triggerData.x)?void 0:i.data,n=null==(n=e.triggerData.y)?void 0:n.data,o=t.lineThickness||t,t=new Y(o.bounds.x,o.bounds.z).applyFn(function(t){return X.convertJSToScalar(o.xType,t)}),r=new Y(o.bounds.y,o.bounds.w).applyFn(function(t){return X.convertJSToScalar(o.yType,t)}),t=new Y(Number(t.x),Number(t.y)),r=new Y(Number(r.x),Number(r.y));return null!=i&&i.length&&(i=e.triggerData.x.bounds,t=e.zoom?X.calculateCroppedBounds2(new Y(e.zoom.x,e.zoom.z),i,e.xType):i),null!=n&&n.length&&(i=e.triggerData.y.bounds,r=e.zoom?X.calculateCroppedBounds2(new Y(e.zoom.y,e.zoom.w),i,e.yType):i),V.fromVec2(t,r)},B.drawMonotoneInterpolation=function(t,e,i,n){var o=[],r=[],a=[],s=t.lineThickness,l=s.size,e=B.getCatmullRomPoints(e,i,t,n);if(e.length<2)return[[],[],[],[],0];for(var h=e[0],i=e[1],t=(s.lineThickness+.5)/2,p=new Y(t,t),u=1;u<h.length-1;u++){var c=h[u-1],d=h[u],y=h[u+1],g=h[u+2]||y,f=Y.subtract(y,c),g=Y.subtract(g,d),f=Y.normalize(f),g=Y.normalize(g),f=new Y(f.y,-f.x),g=new Y(-g.y,g.x),m=Y.subtract(d,Y.scale(f,p)),d=Y.add(d,Y.scale(f,p)),f=Y.subtract(y,Y.scale(g,p)),y=Y.add(y,Y.scale(g,p)),g=B.convertFromScreenSpace(m,n,l),m=B.convertFromScreenSpace(d,n,l),d=B.convertFromScreenSpace(f,n,l),f=B.convertFromScreenSpace(y,n,l);o.push(g.x,m.x,d.x),r.push(g.y,m.y,d.y),o.push(g.x,f.x,d.x),r.push(g.y,f.y,d.y),a.push(B.convertFromScreenSpace(c,n,l))}e=B.convertFromScreenSpace(h[h.length-1],n,l);return a.push(e),[o,r,[],a,i]},B.drawMiterLines=function(t,i,e,n){var o=[],r=[],a=e.length,s=[];if(_.isEqual(i,e)){for(var s=new Array(i.length),l=0;l<i.length;l++)s[l]=l;s.sort(function(t,e){t=i[t],e=i[e];return isNaN(Number(t))&&isNaN(Number(e))?0:isNaN(Number(t))?1:isNaN(Number(e))?-1:Number(t-e)})}for(var h=t.size,p=function(t){return s.length?s[t]:t},u=p(0),u=new Y(i[u],e[u]),c=[B.convertToScreenSpace(u,n,h)],d=[],y=(t.lineThickness+.5)/2,g=0;g<a;g++){var f,m,P=m,x=c[c.length-1],v=0===g?x:c[c.length-2],O=p(g+1),O=g===a-1?x:new Y(i[O],e[O]),v=(g!==a-1&&(O=B.convertToScreenSpace(O,n,h)),c.push(O),x.x===v.x&&x.y===v.y&&(f=Y.normalize(Y.subtract(x,O)),v=Y.add(v,f)),x.x===O.x&&x.y===O.y&&(f=Y.normalize(Y.subtract(x,v)),O=Y.add(O,f)),(x=x.x===v.x&&x.x===O.x?new Y(x.x+x.x/1e4,x.y):x).y===v.y&&x.y===O.y&&(x=new Y(x.x,x.y+x.y/1e4)),Y.normalize(Y.subtract(x,v))),O=Y.normalize(Y.subtract(O,x)),T=Y.normalize(Y.add(v,O)),T=new Y(-T.y,T.x),R=new Y(-v.y,v.x),b=1/Y.dot(T,R),b=Math.abs(b)===1/0?1:b,C=new Y(-1,-1),L=new Y(1,1),A=10<b?10:b,E=new Y(x.x+C.x*T.x*y*A,x.y+C.x*T.y*y*A),L=new Y(x.x+L.x*T.x*y*A,x.y+L.x*T.y*y*A);10<b?(A=Y.normalize(Y.subtract(v,O)),b=Y.dot(T,A),O=(v=0<Math.sign(C.x*b))?L:E,A=new Y(T.y,-T.x),b=(C=new Y(0<A.y?1:-1,0<A.x?1:-1)).x*C.y,T=new Y(x.x-b*y*R.x,x.y-b*y*R.y),A=new Y(x.x+b*y*R.x,x.y+b*y*R.y),C=B.convertFromScreenSpace(T,n,h),x=B.convertFromScreenSpace(A,n,h),R=B.convertFromScreenSpace(O,n,h),m=v?[b<0?x:C,R,b<0?C:x,2]:[R,0<b?x:C,0<b?C:x,1],d.push(g)):m=[B.convertFromScreenSpace(E,n,h),B.convertFromScreenSpace(L,n,h)],0<g&&m&&P&&B.createTriangles(g,P,m,o,r)}return[o,r,d,[]]},B.createTriangles=function(t,e,i,n,o){var r,a,s=e[0],l=e[1],h=i[0],i=i[1];4===e.length?(r=e[2],a=2===e[3]?l:s,e=2===e[3]?i:h,n.push(s.x,l.x,r.x),o.push(s.y,l.y,r.y),n.push(r.x,a.x,e.x),o.push(r.y,a.y,e.y),n.push(h.x,r.x,i.x),o.push(h.y,r.y,i.y)):(n.push(s.x,l.x,h.x,h.x,l.x,i.x),o.push(s.y,l.y,h.y,h.y,l.y,i.y))},B.closestNumber=function(t,e){var i=parseInt(t/e+""),n=e*i,e=0<t*e?e*(i+1):e*(i-1);return Math.abs(t-n)<Math.abs(t-e)?n||6:e||6},B.convertFromScreenSpace=function(t,e,i){function n(t,e,i){return t/i*(e.y-e.x)+e.x}var o=n(t.x,new Y(e.x,e.z),i.x),t=n(t.y,new Y(e.y,e.w),i.y);return new Y(o,t)},B.convertToScreenSpace=function(t,e,i){function n(t,e,i){return(t-e.x)/(e.y-e.x)*i}var o=n(t.x,new Y(e.x,e.z),i.x),t=n(t.y,new Y(e.y,e.w),i.y);return new Y(o,t)},B.drawSteppedXLine=function(t){for(var e=[t[0]],i=1;i<t.length;i++)e.push(t[i],t[i]);return e.push(t[t.length-1]),e},B.drawSteppedYLine=function(t){for(var e=[t[0]],i=1;i<t.length;i++)e.push(t[i-1],t[i]);return e.push(t[t.length-1]),e},B.fixOverlappingNegativeYData=function(o,r){var a=[],s=[];return r.forEach(function(t,e){var i=o[e],n=r[e+1],e=o[e+1];a.push(i),s.push(t),(0<t&&n<0||t<0&&0<n)&&(t=-(t-(n=(n-t)/(e-i))*i)/n,s.push(0),a.push(t))}),[a,s]},B.getXLineFill=function(t){for(var e=[],i=0;i<t.length;i++){var n=t[i],o=t[i+1];e.push(n,n,o,n,o,o)}return e},B.getYLineFill=function(t,e,i,n){var o=[],r=e.fromBounds?Number(e.fromBounds.y):0,a=e.fromBounds?Number(e.fromBounds.w):0,s=e.toBounds?Number(e.toBounds.y):0,l=e.toBounds?Number(e.toBounds.w):0,h=_.min(t)||0,p=_.max(t)||0,u=r,c=(h<0&&0<p||h<0&&p<0&&0<a?u=0:h<0&&p<0&&(u=a),e.cols?e.cols[0]:null);c&&"Origin"!==e.fill&&i&&e.interpolation!==et.Stepped&&(c="Before"===n?B.drawSteppedXLine(c):B.drawSteppedYLine(c));for(var d=0;d<t.length;d++){var y=u,g=u,f=("Origin"!==e.fill&&(y=c[d],g=c[d+1],m=new Y(s,l),f=new Y(r,a),_.isEqual(m,f)||(y=(a-r)*((y-s)/(m=l-s))+r,g=(a-r)*((g-s)/m)+r)),t[d]),m=t[d+1];o.push(f,y,g,f,g,m)}return o};var ot=B;function B(){}at.applyRangeToBreakIntervals=function(t){var n,o,e,r,a;return null!=(e=null==t?void 0:t.breakIntervals)&&e.length?(n=t.breakIntervals,o=_.cloneDeep(n),e=X.calculateCroppedJs2(t.crop,new Y(t.min,t.max)),r=e.x,a=e.y-r,n.forEach(function(t,e){var i=t[0],t=t[1];t<r?(o[e]=null,n[e+1]&&(r+=n[e+1][0]-t)):((i<r||0===e&&r<i)&&(i=r,o[e][0]=r),o[e][2]=(t-i)/a)}),o.filter(function(t){return t})):[]},at.applyTriggerBreak=function(s,l,t,h){for(var p=new Array(s.length),e=0;e<s.length;e++)p[e]=e;X.sortFn(p,s);for(var u=new Array(s.length),c=0,d=[[s[p[0]]]],i=function(e,t,i,n){var o,r,a=!0;h&&(r=d[d.length-1],o=r?r[0]:null,h.filter(function(t){return _.isEqual(t,[o,e])}).length<1)&&(n&&(u[p[i+n]]=s[p[i+n]]-c),a=!1),a&&(u[p[i+n]]=(r=e+l)-c,c+=t-r,d[d.length-1].push(e),d.push([t-l]))},e=0;e<s.length;e+=2){var n=s[p[e-1]],o=s[p[e]],r=s[p[e+1]],a=o-n,y=r-o;u[p[e]]=o-c,void 0!==n&&t<=a&&i(n,o,e,0),void 0!==r&&(t<=y?i(o,r,e,1):u[p[e+1]]=s[p[e+1]]-c),e>=s.length-2&&1===d[d.length-1].length&&d[d.length-1].push(void 0!==r?r:o)}return[u,d]},at.getTriggerBreakVals=function(t,e,i){function n(t){return r?L.duration(t):L(t)}var i=Math.max.apply(Math,i),o=X.convertToJsScalar(e,i),r=L.isDuration(o),o=X.convertJSToNumber(o),a=o-(null==t?void 0:t.triggerBreak),o=o-(null==t?void 0:t.breakVal),t=X.convertJSToScalar(e,n(a)),a=X.convertJSToScalar(e,n(o));return[Number(i)-Number(t),Number(i)-Number(a)]},at.prototype.getTriggerBounds=function(t){return this.triggerData[t].bounds},at.prototype.getTriggerData=function(t){return this.triggerData[t].data},at.prototype.getTriggerIntervals=function(t){return this.triggerData[t].breakIntervals},at.prototype.getAllTriggerData=function(){return this.triggerData},at.prototype.applyTriggerData=function(t,e,i,n){var o=t,e=at.getTriggerBreakVals(n,e,o),r=e[0],e=e[1],n=n.breaksToApply;return r&&e?(o=at.applyTriggerBreak(o,r,e,n),this.triggerData[i].breakIntervals=o[1],r=o[0],this.triggerData[i].bounds=new Y(Math.min.apply(Math,r),Math.max.apply(Math,r)),"x"===i?this.triggerData[i].data=r:"y"===i&&(this.triggerData[i].data||(this.triggerData[i].data=[]),this.triggerData[i].data.push(r)),r):t},at.prototype.applyTriggerBreakForLines=function(t,e,i,n,o){var r=t.x,e=(r&&null!=r&&r.breakVal&&null!=r&&r.triggerBreak&&(e=e.xCol,i=this.applyTriggerData(i,null==e?void 0:e.qtype,"x",r)),t.y);return[i,n=e&&null!=e&&e.breakVal&&null!=e&&e.triggerBreak?this.applyTriggerData(n,o.qtype,"y",e):n]},at.prototype.convertTriggerBreak=function(t,e,i,n,o,r,a,s,l){var t=t[o],h=i===G.Baseline,e=(null==t?void 0:t.breakVal)&&(null==t?void 0:t.triggerBreak)&&!e.spanGaps;return e&&!h&&(h=x.convertToNumArr(n,i,l),l=(i=at.getTriggerBreakVals(t,n.qtype,h))[0],n=i[1],l&&n?(i=this.applyTriggerData(h,s,o,t))&&(r=a=i):e=!1),[a,r,e]};var rt=at;function at(){this.triggerData={x:{},y:{}}}function st(t,e,i){if(!(t=t.getUniformLocation(e,i)))throw new Error(i+" failed getUniformLocation");this.location=t}g(pt,lt=st),pt.prototype.set=function(t,e){t.uniform1f(this.location,e)};var lt,ht=pt;function pt(){return null!==lt&&lt.apply(this,arguments)||this}g(dt,ut=st),dt.prototype.set=function(t,e){t.uniform4f(this.location,e.x,e.y,e.z,e.w)};var ut,ct=dt;function dt(){return null!==ut&&ut.apply(this,arguments)||this}yt.MIN_KEY="_u_min",yt.MAX_KEY="_u_max";i=yt;function yt(t,e,i){var n=t.getUniformLocation(e,i+yt.MIN_KEY),t=t.getUniformLocation(e,i+yt.MAX_KEY);if(!n||!t)throw new Error(i+" axis failed getUniformLocation");this.min=n,this.max=t}g(mt,gt=i),mt.prototype.set=function(t,e){t.uniform1i(this.min,e.x),t.uniform1i(this.max,e.y)};var gt,ft=mt;function mt(){return null!==gt&&gt.apply(this,arguments)||this}g(vt,Pt=i),vt.prototype.set=function(t,e){t.uniform1f(this.min,e.x),t.uniform1f(this.max,e.y)};var Pt,xt=vt;function vt(){return null!==Pt&&Pt.apply(this,arguments)||this}g(Rt,Ot=i),Rt.prototype.set=function(t,e){t.uniform2f(this.min,e.x,e.x-Math.fround(e.x)),t.uniform2f(this.max,e.y,e.y-Math.fround(e.y))};var Ot,Tt=Rt;function Rt(){return null!==Ot&&Ot.apply(this,arguments)||this}_t.prototype.apply=function(t,e){t.bindBuffer(t.ARRAY_BUFFER,e),t.enableVertexAttribArray(this.location),this.glType===WebGLRenderingContext.FLOAT?t.vertexAttribPointer(this.location,this.size,this.glType,!1,this.stride||0,this.offset||0):t.vertexAttribIPointer(this.location,this.size,this.glType,this.stride||0,this.offset||0)};var bt=_t;function _t(t,e,i,n,o){this.location=t,this.glType=e,this.size=i,this.stride=n,this.offset=o}Object.defineProperty(Lt.prototype,"Program",{get:function(){return this.program},enumerable:!1,configurable:!0}),Lt.createBuffer=function(t,e){var i=t.createBuffer();if(i)return t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),i;throw new Error("gl error creating buffer")},Lt.createTextureArray=function(t,e,i){var n=t.createTexture();if(!n)throw new Error("gl error creating texture");t.activeTexture(t.TEXTURE0+e),t.bindTexture(t.TEXTURE_2D_ARRAY,n);var o=i[0].width,r=i[0].height,e=Math.floor(Math.log2(Math.max(o,r)))+1;t.texStorage3D(t.TEXTURE_2D_ARRAY,e,t.RGBA8,o,r,i.length);for(var a=0;a<i.length;++a){var s=i[a];t.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,a,o,r,1,t.RGBA,t.UNSIGNED_BYTE,s)}return t.texParameteri(t.TEXTURE_2D_ARRAY,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D_ARRAY,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D_ARRAY,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR),t.texParameteri(t.TEXTURE_2D_ARRAY,t.TEXTURE_MAG_FILTER,t.LINEAR),t.generateMipmap(t.TEXTURE_2D_ARRAY),n},Lt.createTexture=function(t,e,i,n){var o=t.createTexture();if(o)return t.activeTexture(t.TEXTURE0+i),t.bindTexture(t.TEXTURE_2D,o),n?(t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT)):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.generateMipmap(t.TEXTURE_2D),o;throw new Error("gl error creating texture")},Lt.getShader=function(t,e,i,n,o,r,a,s,l,h){var p=[i,n,o,r,a,s,l,h,t.canvas.id].join(":");return Lt.shaders[p]||(Lt.shaders[p]=new Lt(t,i,n,e,o,r,a,s,l,h)),this.shaders[p]},Lt.composeFragment=function(t,e,i,n,o,r,a){return F.fragment({isWebGL2:t,isTextured:e,isColored:i,isSize:n,isBorder:o,isPatterned:r,isDataIcons:a})},Lt.composeVertex=function(t,e,i,n,o,r,a,s){t={x:t,y:e};return F.dualVertex({isWebGL2:i,isColored:n,isSize:o,isBorder:r,isPatterned:a,isDataIcons:s,math:_.some(_.values(t),function(t){return X.isLong(t)||X.isDouble(t)}),axis:_.map(t,function(t,e){return _.extend(Lt.getShaderConfig(t),{name:e})})})},Lt.createProgram=function(t,e,i){var n=t.createProgram();if(!n)throw new Error("gl error creating program");if(t.attachShader(n,e),t.attachShader(n,i),t.linkProgram(n),t.getProgramParameter(n,t.LINK_STATUS))return n;throw e=t.getProgramInfoLog(n),t.deleteProgram(n),new Error("gl error linking program: "+e)},Lt.createShader=function(t,e,i){e=t.createShader(e);if(!e)throw new Error("gl error creating shader");if(t.shaderSource(e,i),t.compileShader(e),t.getShaderParameter(e,t.COMPILE_STATUS))return e;throw i=t.getShaderInfoLog(e),t.deleteShader(e),new Error("gl error compiling shader: "+i)},Lt.getShaderConfig=function(t){switch(t){case E.Byte:case E.Char:return{vt:"uint",ut:"int"};case E.Short:case E.Int:case E.Month:case E.Date:case E.Minute:case E.Second:case E.Time:return{vt:"int",ut:"int"};case E.List:case E.Symbol:case E.Float:return{vt:"float",ut:"float"};case E.Long:case E.Double:case E.Timestamp:case E.DateTime:case E.Timespan:return{vt:"vec2",ut:"vec2"};default:throw"Not implemented"}},Lt.prototype.remove=function(t){t.deleteProgram(this.program),t.deleteShader(this.vertexShader),t.deleteShader(this.fragmentShader)},Lt.prototype.setTexture=function(t,e){t.uniform1i(this.textureLocation,e)},Lt.prototype.createRange=function(t,e,i){return new(X.isDouble(t)||X.isLong(t)?Tt:X.isFloat(t)?xt:ft)(e,this.program,i)},Lt.prototype.getVertexBinding=function(t,e,i){var n=t.getAttribLocation(this.Program,i+"_position");switch(e){case E.Byte:case E.Char:return new bt(n,t.UNSIGNED_BYTE,1);case E.Short:return new bt(n,t.SHORT,1);case E.Int:case E.Month:case E.Date:case E.Minute:case E.Second:case E.Time:return new bt(n,t.INT,1);case E.List:case E.Symbol:case E.Float:return new bt(n,t.FLOAT,1);case E.Long:case E.Double:case E.Timestamp:case E.DateTime:case E.Timespan:return new bt(n,t.FLOAT,2);default:throw"Not implemented"}},Lt.shaders={};var Ct,D=Lt;function Lt(t,e,i,n,o,r,a,s,l,h){this.textureLocation=null;var p,u=Lt.composeVertex(e,i,n,r,a,s,l,h),n=Lt.composeFragment(n,o,r,a,s,l,h);this.vertexShader=Lt.createShader(t,t.VERTEX_SHADER,u),this.fragmentShader=Lt.createShader(t,t.FRAGMENT_SHADER,n),this.program=Lt.createProgram(t,this.vertexShader,this.fragmentShader),this.xRange=this.createRange(e,t,"x"),this.yRange=this.createRange(i,t,"y"),this.xBinding=this.getVertexBinding(t,e,"x"),this.yBinding=this.getVertexBinding(t,i,"y"),o&&(this.textureLocation=t.getUniformLocation(this.Program,"spriteTexture")),l?(this.textureLocation=t.getUniformLocation(this.Program,"spriteTexture"),this.canvasWidthLocation=t.getUniformLocation(this.Program,"u_canvasWidth"),this.canvasHeightLocation=t.getUniformLocation(this.Program,"u_canvasHeight")):r?(p=t.getAttribLocation(this.Program,"h_color"),this.colorLocation=new bt(p,t.FLOAT,4)):this.color=new ct(t,this.Program,"a_color"),a?(p=t.getAttribLocation(this.Program,"pointSize"),this.sizeLocation=new bt(p,t.FLOAT,1)):this.pointSize=new ht(t,this.Program,"u_point_size"),s&&(p=t.getAttribLocation(this.Program,"a_barCoord"),this.borderLocation=new bt(p,t.FLOAT,2),this.borderColor=new ct(t,this.Program,"a_borderColor"),u=t.getAttribLocation(this.Program,"a_xBorder"),this.xBorderWidth=new bt(u,t.FLOAT,1),n=t.getAttribLocation(this.Program,"a_yBorder"),this.yBorderWidth=new bt(n,t.FLOAT,1),this.isHorizontalLocation=t.getUniformLocation(this.Program,"a_isHorizontal")),h&&(p=t.getAttribLocation(this.Program,"dataIcon"),this.dataIconsLocation=new bt(p,t.FLOAT,1),this.dataIconsTextureLocation=t.getUniformLocation(this.Program,"u_dataIcons"))}Math.fround=Math.fround||(Ct=new Float32Array(1),function(t){return Ct[0]=t,Ct[0]});At.prototype.applyFn=function(t){return new At(t(this.x),t(this.y))},At.add=function(t,e){return new At(t.x+e.x,t.y+e.y)},At.dot=function(t,e){return t.x*e.x+t.y*e.y},At.multiply=function(t,e){return new At(t.x*e.x,t.y*e.y)},At.normalize=function(t){var e=Math.sqrt(t.x*t.x+t.y*t.y);return new At(e?t.x/e:0,e?t.y/e:0)},At.scale=function(t,e){return new At(t.x*e.x,t.y*e.y)},At.subtract=function(t,e){return new At(t.x-e.x,t.y-e.y)};var Y=At;function At(t,e){this.x=t,this.y=e}Et.fromVec2=function(t,e){return new Et(t.x,e.x,t.y,e.y)},Et.prototype.toString=function(){return _.map([this.x,this.y,this.z,this.w],function(t){return""+t}).join(",")},Et.prototype.applyFn=function(t){return new Et(t(this.x),t(this.y),t(this.z),t(this.w))};var V=Et;function Et(t,e,i,n){this.x=t,this.y=e,this.z=i,this.w=n}var C,E=M.ipc.TypeNum,X=(R.calculateCroppedBounds=function(t,e,i,n){i=R.calculateCroppedBounds2(new Y(t.x,t.z),new Y(e.x,e.z),i),t=R.calculateCroppedBounds2(new Y(t.y,t.w),new Y(e.y,e.w),n);return new V(i.x,t.x,i.y,t.y)},R.calculateCroppedBounds2=function(t,e,i){function n(t,e,i){return e+(i-e)*t}t=new Y(n(t.x,e.x,e.y),n(t.y,e.x,e.y));return i&&(R.isInt(i)||R.isLong(i))&&(e=t,t=new Y(Math.floor(e.x),Math.ceil(e.y))),t},R.calculateCroppedJsBounds=function(t,e,i,n){var o=R.scaleJs(t.x,e.x,e.z,i),r=R.scaleJs(t.z,e.x,e.z,i),a=R.scaleJs(t.y,e.y,e.w,n),t=R.scaleJs(t.w,e.y,e.w,n),e=R.calculatePrecision(i,new Y(o,r)),i=R.calculatePrecision(n,new Y(a,t));return new V(e.x,i.x,e.y,i.y)},R.calculatePrecision=function(e,t){var i;return e&&(R.isInt(e)||e===E.Long||e===E.Timespan)&&(i=t.applyFn(function(t){return R.convertJSToScalar(e,t)}),i=i,i=new Y(Math.floor(Number(i.x)),Math.ceil(Number(i.y))),t=new Y(R.convertToJsScalar(e,i.x),R.convertToJsScalar(e,i.y))),t},R.calculateCroppedJs2=function(t,e,i){var n=R.scaleJs(t.x,e.x,e.y,i),t=R.scaleJs(t.y,e.x,e.y,i),e=new Y(n,t);return i?R.calculatePrecision(i,e):e},R.getUpdatedRange=function(t,e,i,n){t=R.getRange(t),t=R.getMidrange(new Y(t[0],t[1]),i,n);return e=t?new Y(R.toBigInt(e.x)-t,R.toBigInt(e.y)-t):e},R.calculateCrop=function(t,e,i){i===E.Timestamp&&(o=R.convertJSToScalar(i,e.x),r=R.convertJSToScalar(i,e.y),n=R.getMidrange(new Y(o,r),i,e))&&(e=new Y(Number(R.toBigInt(o)-n),Number(R.toBigInt(r)-n)),o=R.convertJSToScalar(i,t.x),r=R.convertJSToScalar(i,t.y),t=new Y(Number(R.toBigInt(o)-n),Number(R.toBigInt(r)-n)));var n,o,r,i=new Y(R.calcCrop(t.x,e.x,e.y),R.calcCrop(t.y,e.x,e.y));return new Y(isNaN(i.x)?0:i.x,isNaN(i.y)?1:i.y)},R.calcCrop=function(t,e,i){return t=R.convertJSToNumber(t),e=R.convertJSToNumber(e),1-(t-(i=R.convertJSToNumber(i)))/(e-i)},R.calculateBoundsDiagonal=function(t){var e=t.z-t.x,t=t.w-t.y;return Math.sqrt(e*e+t*t)},R.calculateInset=function(t,e){var i=t.z-t.x,n=t.w-t.y,o=2*e;return new V(o<=n?t.x+e:t.x,o<=i?t.y+e:t.y,o<=n?t.z-e:t.z,o<=i?t.w-e:t.w)},R.calculateMergedRange=function(t){if(0===t.length)return null;if(1===t.length)return t[0];for(var e=t[0].x,i=t[0].y,n=1;n<t.length;n++)var o=t[n],e=R.min(e,o.x),i=R.max(i,o.y);return new Y(e,i)},R.getCategoryData=function(i,t,n,o,e){var r=this,a=i.length,s=new Float32Array(a),l=[],h=[],p=[],u=e.key&&"score"!==e.key?2:1,c="x1"===e.key?e.x2:"x2"===e.key?e.x1:"y1"===e.key?e.y2:"y2"===e.key?e.y1:null,d=new Array(i.length);if(o){for(var y=0;y<i.length;y++)d[y]=y;d.sort(function(t,e){t=r.getColScalar(i,t),e=r.getColScalar(i,e);return isNaN(Number(t))&&isNaN(Number(e))?0:isNaN(Number(t))?1:isNaN(Number(e))?-1:(i.qtype===E.Symbol||i.qtype===E.Char)&&isNaN(Number(t))&&isNaN(Number(e))?t.localeCompare(e):Number(t-e)})}for(var g=0,f=0;f<a;f++){var m=o?d[f]:f,P=f,x=(t===G.Heatmap&&(P="x2"!==e.key&&"y2"!==e.key?g:g+1),this.getColScalar(i,m));p[P]=x,2==u&&c&&(p["x2"!==e.key&&"y2"!==e.key?g+1:g]=this.getColScalar(c,f)),g+=2}var v={},O=n?_.uniq(p):p;O.forEach(function(t,e){t=n?t:o?d[e]:e;v[t]=1<O.length?e/(O.length-1):.5});for(f=0;f<a;f++){var m=o?d[f]:f,x=this.getColScalar(i,m),T=(s[m]=v[n?x:m],R.isString(i.qtype)||i.qtype===E.Char?x:R.convertToJsScalar(i.qtype,x));h[f]=T,o&&(l[m]=T)}return[h,s,l]},R.getColScalar=function(t,e){var i;return void 0!==e||t.qtype!==E.List&&t.qtype!==E.Symbol?t.qtype===E.List?(i=t.getValue(e),R.getValueFromObject(i)):t.qtype===E.Symbol||t.qtype===E.Char?t.getValue(e):t.getScalar(e):null},R.getColValue=function(t,e){var i;return void 0!==e||t.qtype!==E.List&&t.qtype!==E.Symbol?t.qtype===E.List?(i=t.getValue(e),R.getValueFromObject(i)):t.getValue(e):null},R.getRange=function(t){return t&&t.getRange&&t.calcRange?t.getRange():[0,1]},R.getStackedData=function(n,t,o){return t.forEach(function(t,e){var e=n[e]+"",i=(o[e]||(o[e]=[0,0]),o[e]);t<0?o[e][0]=Math.min(i[0],t):o[e][1]=Math.max(i[1],t)}),o},R.convertStringToScalar=function(t,e){var i;return isNaN(Number(t))?e?(i=e.fromString(t),e.toScalar(i)):t:Number(t)},R.convertJSToNumber=function(t){return L.isMoment(t)||L.isDuration(t)?t.valueOfNano()/1e6:t},R.convertJSToScalar=function(t,e){var i,n=M.ipc;(i={})[E.Date]=n.QDate,i[E.DateTime]=n.DateTime,i[E.Minute]=n.Minute,i[E.Month]=n.Month,i[E.Second]=n.Second,i[E.Time]=n.Time,i[E.Timespan]=n.Timespan,i[E.Timestamp]=n.Timestamp;n=i[t];if(n&&(L.isMoment(e)||L.isDuration(e)))return n.toScalar(n.fromMoment(e));if(L.isMoment(e)||L.isDuration(e))throw"Invalid Type Conversion";return e},R.convertStringToJsScalar=function(t,e){t=R.convertStringToScalar(t,R.ipcTemp(e));return R.convertToJsScalar(e,t)},R.convertToJsScalar=function(t,e,i){var n=M.ipc;(o={})[E.Date]=n.QDate,o[E.DateTime]=n.DateTime,o[E.Minute]=n.Minute,o[E.Month]=n.Month,o[E.Second]=n.Second,o[E.Time]=n.Time,o[E.Timespan]=n.Timespan,o[E.Timestamp]=n.Timestamp;var o,n=o[t];return n?(t===E.Timespan&&(e=Number(e)),o=R.isLong(t)&&M.Long.isLong(e)?M.Long.fromString(e.toString()):e,i?n.fromScalar(o):M.Tools.convertKDBTemporalToMoment(n.fromScalar(o))):Number(e)},R.convertVec2ToJsScalar=function(t,e,i){return new Y(R.convertToJsScalar(e,t.x),R.convertToJsScalar(i,t.y))},R.convertVec4ToJsScalar=function(t,e,i){return new V(R.convertToJsScalar(e,t.x),R.convertToJsScalar(i,t.y),R.convertToJsScalar(e,t.z),R.convertToJsScalar(i,t.w))},R.convertVec4ToScalar=function(t,e,i){return new V(R.convertJSToScalar(e,t.x),R.convertJSToScalar(i,t.y),R.convertJSToScalar(e,t.z),R.convertJSToScalar(i,t.w))},R.dist=function(t,e){var i=t.x-e.x,t=t.y-e.y;return Math.sqrt(i*i+t*t)},R.expandNestedViewStates=function(t,e){var i,n=/([a-zA-Z]+)\.[0-9]+\./,o=Object.keys(t),r=[];return(r=_.every(function(t){t=e.getPropertyMeta(t[0]);return t&&"viewstate"===t.type})?_.uniq(_.filter(_.map(o,function(t){t=n.exec(t);return t?t[1]:null}))):r).length?(i={},_.each(r,function(t){return i[t]=e.getProperty(t)}),i):t},R.floatToEmulateDoubleArray=function(t,e){for(var i=2*t.length,n=new Float32Array(i),o=0,r=0;r<i;r+=2){var a=void 0,a=null!=e&&e.length&&e[r]?e[r]:t.getScalar(o);n[r]=a,n[r+1]=a-Math.fround(a),R.isNull(a,R.getNullVal(t.qtype))&&(n[r]=NaN,n[r+1]=NaN),o++}return n},R.getDistance=function(t,e){for(var i=e[e.length-1]-e[0],n=t.length,o=1/0,r=1/0;n--;)o=t[n]<o&&0<t[n]?t[n]:o,r=Math.abs(t[n]<r&&t[n]<0?t[n]:r);var a=o<r?o:r;return a>i/e.length?a:i/e.length},R.getFormatter=function(n,o,r,a){return"Number"===n||"Formatted Number"===n||"Smart Number"===n?function(t){"Smart Number"!==n&&"Formatted Number"!==n||"string"==typeof t&&(t=/^(\-|\+)?([0-9]+(\.[0-9]+)?|Infinity)$/.test(t)?parseFloat(t):t);var e=L.isMoment(t)||L.isDuration(t)||M.Tools.isKDBTemporal(t),i="";if(null==t)return"";if(a&&e?(M.Tools.isKDBTemporal(t)&&(t=M.Tools.convertKDBTemporalToMoment(t)),L.isDuration(t)?(-1!==a.indexOf("kk")&&(a=a.replace("kk","hh")),i=t.format(a,{trim:!1})):L.isMoment(t)&&(i=t.format(a))):i="Smart Number"===n?_.isNumber(t)?M.Tools.smartFormatNumber(t,o):_.escape(t):"number"==typeof t?"Formatted Number"===n?M.Tools.formatNumber(t,o):t.toFixed(o):_.escape(t),r&&0<=i.toString().indexOf(".")){for(;"0"===i[i.length-1];)i=i.slice(0,-1);i.indexOf(".")===i.length-1&&(i=i.slice(0,-1))}return i}:"General"===n?function(t){return L.isMoment(t)||L.isDuration(t)?t.format():_.escape(t)}:"Boolean"===n?function(t){return _.escape(t)}:function(t){return _.escape(t)}},R.getProperty=function(t){return t&&"object"==typeof t&&!Array.isArray(t)&&void 0!==t.attributes.value?t.attributes.value:t},R.validateWebGL=function(t){t?M.Log.Info("webgl works!"):"undefined"!=typeof WebGL2RenderingContext?console.error("Your browser appears to support WebGL but it might be disabled. Try updating your OS and/or video card drivers"):console.error("Your browser does not support WebGL")},R.getMajorPerformanceCaveat=function(t){var e=document.createElement("canvas"),i=(e.setAttribute("width","1"),e.setAttribute("height","1"),document.getElementsByTagName("body")[0]),t=(i.appendChild(e),e.getContext(t,{failIfMajorPerformanceCaveat:!0}));return i.removeChild(e),!t},R.getMidrange=function(t,e,i,n){if(e===E.Timestamp){i=i||new Y(R.convertToJsScalar(e,t.x),R.convertToJsScalar(e,t.y));e=new Y(Number(i.x),Number(i.y));if(n||e.y===e.x&&t.x!==t.y)return(R.toBigInt(t.x)+R.toBigInt(t.y))/R.toBigInt(2)}return null},R.getNullVal=function(t){var e;return R.isLong(t)?(e=new M.Long(0,2147483648),"undefined"!=typeof BigInt&&(e=BigInt(e))):R.isDouble(t)||(e=5===t?-32768:-2147483648),e},R.getValueFromObject=function(t){for(var e="",i=0;i<t.length;i++)e+=t.getValue(i);return e},R.focus2Array=function(t){var e=[],i=/"([^"]*)"/g,t=t.toString?t.toString():"",n=/^\[([^\]]*)]$/.exec(t);if(null!==n){if(/^(?:"[^"\\]*(?:\\[\S\s][^"\\]*)*")(?:,"[^"\\]*(?:\\[\S\s][^"\\]*)*")*/.test(n[1]))for(var o=void 0;null!==(o=i.exec(n[1]));)e.push(_.map(o[1].split(","),function(t){return t.replace(/&#44;/g,",")}))}else e.push(t.split(","));return _.filter(e,function(t){return 0<(""+t).length})},R.formatData=function(t,e,i,n,o){return R.getFormatter(e,i,n,o)(t)},R.ipcTemp=function(t){switch(t){case 12:return M.ipc.Timestamp;case 13:return M.ipc.Month;case 14:return M.ipc.QDate;case 15:return M.ipc.DateTime;case 16:return M.ipc.Timespan;case 17:return M.ipc.Minute;case 18:return M.ipc.Second;case 19:return M.ipc.Time}},R.isDouble=function(t){return-1!==R.DOUBLE_TYPES.indexOf(t)},R.isFloat=function(t){return t===E.Float},R.isInt=function(t){return-1!==R.INT_TYPES.indexOf(t)},R.isLong=function(t){return-1!==R.LONG_TYPES.indexOf(t)},R.isNull=function(t,e){return e?Number(t)===Number(e):isNaN(Number(t))||null===t},R.isRegexOrWild=function(t){t="object"==typeof t&&null!=t&&t.attributes?t.attributes.value:t;return!!t&&(0===t.indexOf("/")||-1!==t.indexOf("*"))},R.isString=function(t){return null!==t&&-1!==R.STRING_TYPES.indexOf(t)},R.limitWithin=function(t,e,i){return t=R.toNumber(t),e=R.toNumber(e),i=R.toNumber(i),t<e?e:i<t?i:t},R.log10=function(t){return Math.log10?Math.log10(t):Math.log(t)/Math.LN10},R.longToEmulateDoubleArray=function(e,t){for(var i=2*e.length,n=new Float32Array(i),o=0,r="undefined"!=typeof BigInt?e.getScalar.bind(e):function(t){return e.getLegacyScalar(t).toString()},a=R.getRange(e),s=R.getMidrange(new Y(a[0],a[1]),e.qtype),l=0;l<i;l+=2){var h,p,u=o++;null!=t&&t.length&&t[l]?(n[l]=t[l],n[l+1]=t[l+1]):(u=r(u),p=R.toBigInt(u),p=s?p-s:p,h=Number(p),n[l]=h,p=p-R.toBigInt(Math.fround(h)),n[l+1]=Number(p),R.isNull(u,R.getNullVal(e.qtype))&&(n[l]=NaN,n[l+1]=NaN))}return n},R.mergeRange=function(t){if(0<t.length){for(var e=t[0],i=1;i<t.length;i++)e=new Y(R.minJs(e.x,t[i].x),R.maxJs(e.y,t[i].y));return e}},R.max=function(t,e){if(M.Long.isLong(t)){if(M.Long.isLong(e))return t.gt(e)?t:e;t=t.toNumber()}else M.Long.isLong(e)&&(e=e.toNumber());return e<t?t:e},R.maxJs=function(t,e){return L.isMoment(t)&&L.isMoment(e)?t.valueOfNano()>e.valueOfNano()?t:e:e<t?t:e},R.min=function(t,e){if(M.Long.isLong(t)){if(M.Long.isLong(e))return t.gt(e)?e:t;t=t.toNumber()}else M.Long.isLong(e)&&(e=e.toNumber());return e<t?e:t},R.minJs=function(t,e){return L.isMoment(t)&&L.isMoment(e)||L.isDuration(t)&&L.isDuration(e)?t.valueOfNano()>e.valueOfNano()?e:t:e<t?e:t},R.normalize=function(t,e,i){return(t-e)/(i-e)},R.replaceViewStates=function(i,t,l,h){var p=function(t,e){return function i(t,e,n){n=n?n+".":"";e+="";var o=h.getPropertyMeta(n+e);var r=t&&t.has&&t.has("_dataSource")&&t.has("_dataType");r=(_.isArray(t)||_.isObject(t))&&!r;{var a,s;return o&&"data"===o.type?t:o&&"viewstate"===o.type?(s=(n+e).split("."),a=s.pop(),s=s.join("."),l(s,void 0===a?"":a,t,o)):r?(n+=e,p=function(t,e){return i(t,e,n)},(u=_.isArray(t)?_.map:_.mapValues)(t,p)):t}}(t,e,i||"")},u=_.isArray(t)?_.map:_.mapValues;return u(t,p)},R.replaceViewStatesWithValue=function(t,e,i){return R.replaceViewStates(t,e,function(t,e,i,n){return n.value,n.value},i)},R.intToFloat=function(t){for(var e=0,i=new Float32Array(t.length),n=0;n<t.length;n++){var o=t.getScalar(e++);i[n]=o}return i},R.toBigInt=function(t){return"bigint"==typeof t?t:BigInt(Math.round(t))},R.toLong=function(t){return R.isIE11?M.Long.isLong(t)?t:new M.Long(Math.round(Number(t))):"bigint"==typeof t?t:BigInt(Math.round(t))},R.toNumber=function(t){return M.Long.isLong(t)?t.toNumber():"bigint"==typeof t?Number(t):t},R.calculateRelativePoint=function(t,e){return new Y(R.calculateRelativeValue(t.x,e.x,e.z),R.calculateRelativeValue(t.y,e.y,e.w))},R.calculateRelativeValue=function(t,e,i){var n;return R.isIE11?((M.Long.isLong(t)?t.toNumber():Number(t))-(n=M.Long.isLong(e)?e.toNumber():Number(e)))/((M.Long.isLong(i)?i.toNumber():Number(i))-n):"bigint"==typeof e&&"bigint"==typeof i?Number(R.toBigInt(t)-e)/Number(i-e):(Number(t)-Number(e))/(Number(i)-Number(e))},R.scale=function(t,e,i){return e+t*(i-e)},R.scale2=function(t,e,i){return new Y(e.x+t*(i.x-e.x),e.y+t*(i.y-e.y))},R.scale4=function(t,e,i){return new V(e.x+t*(i.x-e.x),e.y+t*(i.y-e.y),e.z+t*(i.z-e.z),e.w+t*(i.w-e.w))},R.scaleJs=function(t,e,i,n){var o,r,a,s,l,h,p;return L.isMoment(e)&&L.isMoment(i)?(a=p=s=o=void 0,s=n===E.Timestamp&&(h=R.convertJSToScalar(n,e),r=R.convertJSToScalar(n,i),l=new Y(e,i),a=R.getMidrange(new Y(h,r),n,l))?(o=Number(R.toBigInt(h)-a),Number(R.toBigInt(r)-a)):(o=e.valueOfNano(),i.valueOfNano()),l=o+t*(s-o),a?p=M.Tools.convertValueToMoment(R.convertToJsScalar(E.Timestamp,R.toBigInt(l)+a)):(p=L(l/1e6)).nanoseconds(l%1e6),p):L.isDuration(e)&&L.isDuration(i)?(l=(n=Number(e.valueOf()))+t*(Number(i.valueOf())-n),h=e.nanosecond()+t*(i.nanosecond()-e.nanosecond()),(p=L.duration(l)).nanoseconds(h),p):Number(e)+t*(Number(i)-Number(e))},R.sortFn=function(t,i){t.sort(function(t,e){t=i[t],e=i[e];return isNaN(Number(t))&&isNaN(Number(e))?0:isNaN(Number(t))?1:isNaN(Number(e))?-1:Number(t-e)})},R.toS=function(t){return"number"!=typeof t&&t.toDashString?t.toDashString():t.toString?t.toString():""},R.xPart=function(t){return new Y(t.x,t.z)},R.yPart=function(t){return new Y(t.y,t.w)},R.hex2RGB=function(t){t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:[255,255,255]},R.hexColorToVec4=function(t,e){t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return t&&4===t.length?new V(parseInt(t[1],16)/256,parseInt(t[2],16)/256,parseInt(t[3],16)/256,e/100):new V(.5,.5,.5,1)},R.isIE11=/Trident\/.*rv:11/.test(navigator.userAgent),R.isWebGL2="undefined"!=typeof WebGL2RenderingContext,R.glContext=R.isWebGL2?"webgl2":R.isIE11?"experimental-webgl":"webgl",R.isWebGLHWAcclEnabled=!R.getMajorPerformanceCaveat("webgl"),R.DOUBLE_TYPES=[E.Double,E.DateTime],R.INT_TYPES=[E.Byte,E.Short,E.Int,E.Char,E.Month,E.Date,E.Minute,E.Second],R.LONG_TYPES=[E.Long,E.Timespan,E.Timestamp],R.STRING_TYPES=[E.List,E.Symbol],R.HEX_CODES={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},R);function R(){}(e=C=C||{})[e.Nanosecond=0]="Nanosecond",e[e.Millisecond=1]="Millisecond",e[e.Second=2]="Second",e[e.Minute=3]="Minute",e[e.Hour=4]="Hour",e[e.Day=5]="Day",e[e.Month=6]="Month",e[e.Year=7]="Year";S.prototype.getProperty=function(t){return this.propertyCache[t]||this.api.getProperty(this.axisProp+t)},S.prototype.resetOverrideRules=function(){var t=-1!==this.axisProp.indexOf("Multi")?".Prefix":S.PROP_PREFIX,e=-1!==this.axisProp.indexOf("Multi")?".Suffix":S.PROP_SUFFIX,i=-1!==this.axisProp.indexOf("Multi")?".Precision":S.PROP_PRECISION;this.propertyCache[S.PROP_PREFIX]=this.api.getProperty(this.axisProp+t),this.propertyCache[S.PROP_SUFFIX]=this.api.getProperty(this.axisProp+e),this.propertyCache[S.PROP_PRECISION]=this.api.getProperty(this.axisProp+i),this.hasOverrideRules=!1},S.prototype.getOverridePropMapping=function(t){switch(t){case"Prefix":return S.PROP_PREFIX;case"Suffix":return S.PROP_SUFFIX;case"Decimal Places":return S.PROP_PRECISION;default:return t}},S.prototype.setOverrideRules=function(t,e){for(var i=t.RuleCondition,n=t.RuleAction,o=this.getOverridePropMapping(t.RuleProperty),r=M.Tools.getRegex(i),a=0;a<e.length;a++){var s=e[a];if(null!=s&&s.match(r)||(null==s?void 0:s.toLowerCase())===i.toLowerCase()){this.propertyCache[o]=n,this.hasOverrideRules=!0;break}}},S.prototype.getAxisGroupIndex=function(){return Number(this.axisProp.split(".")[1])},S.prototype.getTicksLength=function(){return this.ticks},S.prototype.hasOverrideRulesSet=function(){return this.hasOverrideRules},S.prototype.isTriggerBreakApplied=function(){return this.triggerBreakApplied},S.prototype.updateBreakIntervals=function(t,e,i,n){this.breakInfo={breakIntervals:t,min:e,max:i,crop:n}},S.prototype.getBaseSize=function(t){return!this.displayTitle||this.width||void 0!==this.isFinalAxisGroup&&!this.isFinalAxisGroup?(t+=2*S.TICKSIZE,!this.width||this.axisGroups.length&&void 0===this.isFinalAxisGroup?t:t-(t-this.width)):t+S.TICKSIZE+1.8*this.titleFontSize},S.prototype.getGridlines=function(){return{color:this.gridlinesColor,offset:this.gridlinesOffset,opacity:this.gridlinesOpacity}},S.prototype.getLogTicks=function(t,e){for(var i=t,n=e,o=0,r=Math.ceil(t);r<=Math.floor(e);r++)o++;o<=1&&(o=this.ticks-1);for(var a=[],s=n-i,t=this.niceNum(n-i,!1),l=this.niceNum(t/o,!0),t=Math.floor(i/l)*l,h=Math.max(-Math.floor(X.log10(l)),0),p=X.getFormatter(this.format,Math.max(h,this.propertyCache[S.PROP_PRECISION]),this.hideTrailingZeroes),r=t;r<=n;r+=l){r+l===r&&(l*=2);var u=Math.pow(10,r);i<=r&&void 0!==u&&a.push({pos:(r-i)/s,label:this.propertyCache[S.PROP_PREFIX]+p(u)+this.propertyCache[S.PROP_SUFFIX]})}return a},S.prototype.getTimeTicks=function(t,e,i,n,o,r,a,s){var l=this.intervalLength,h=new Y(X.convertJSToScalar(this.type,this.bounds.x),X.convertJSToScalar(this.type,this.bounds.y)),p=o.unit.size===S.INTERVALS[0].size,u=r&&this.isTriggerBreakApplied()?null:X.getMidrange(h,this.type,this.bounds,p),c=(u&&(t=Number(X.toBigInt(h.x)-u),e=Number(X.toBigInt(h.y)-u),l)&&0<l&&(l*=1e6,p=X.toBigInt(h.y)-X.toBigInt(h.x),l=(e-t)*(l/Number(p))),[]),d=n===C.Month||n===C.Year,y=d||n===C.Year,g=o.unit,f=(t/=g.size,(e/=g.size)-t),h=this.niceNum(e-t,!1),m=this.stepSize||this.niceNum(h/(h&&h<s?h:s),!0),n=(l&&0<l&&(m=h/(p=l/g.size)<50?p:h/50),Math.floor(t/m)*m);this.isTriggerBreakApplied()&&!this.stepSize&&(this.stepSize=m);for(var P,x,v,O,T,R,b=n;b<=e;b+=m)t<=b&&(R=void 0,R=i?(P="12"+this.type,P=M.Tools.convertValueToDuration(b*g.size,P),v=g.format,this.dateFormat&&-1!==(v=this.dateFormat).indexOf("kk")&&(v=v.replace("kk","hh")),P.formatNano(y?"":v,{trim:!1})):(P=(d?b+1:b)*g.size,O=u?X.toBigInt(P)+u:P,x=void 0,x=this.type===E.Date?L(P):u?M.Tools.convertValueToMoment(X.convertToJsScalar(this.type,O)):M.Tools.convertValueToMoment(P),v=g.format,o.majorUnit&&(O=Number(x),T=x.clone().startOf(o.majorUnitName).valueOf(),Math.abs(O-T)<g.size)&&(v=o.majorUnit.format),this.dateFormat&&(v=this.dateFormat),x.format(v)),c.push({pos:(b-t)/f/r+a,label:this.propertyCache[S.PROP_PREFIX]+R+this.propertyCache[S.PROP_SUFFIX]}));return c},S.prototype.getSimpleTicks=function(){var n,t,o,r,a,e,s=this,i=L.isMoment(this.bounds.x),l=L.isDuration(this.bounds.x),h=X.convertJSToNumber(this.bounds.x),p=X.convertJSToNumber(this.bounds.y);return this.propertyCache[S.PROP_TYPE]===S.TYPE_LOGARITHMIC?this.getLogTicks(h,p):i||l?(n=this.determineUnitForAutoTicks(h,p,this.ticks),i=S.INTERVALS[n],t=e=void 0,this.showMajorTicks&&(e=S.INTERVALS[this.determineMajorUnit(n)],t=this.getUnitName(n)),o={unit:i,majorUnit:e,majorUnitName:t},null!=(i=rt.applyRangeToBreakIntervals(this.breakInfo))&&i.length?(r=p-h,a=0,e=i.map(function(t){h=X.convertJSToNumber(X.convertToJsScalar(s.type,t[0])),p=X.convertJSToNumber(X.convertToJsScalar(s.type,t[1]));var t=1/t[2],e=a||0,i=s.ticks/t,t=s.getTimeTicks(h,p,l,n,o,t,e,i);return a+=(p-h)/r,t}),Array.prototype.concat.apply([],e)):this.getTimeTicks(h,p,l,n,o,1,0,this.ticks)):this.niceScale(h,p)},S.prototype.measureText=function(t,e){return t.font=this.fontSize+"px "+S.FONTFACE,t.measureText(e)},S.prototype.setRangeViewstate=function(t,e,i){var n,o=t?X.toS(t.x):"",t=t?X.toS(t.y):"";null!=(n=this.api.getPropertyMeta(e+"."+i+S.PROP_SEL_MIN))&&n.viewstateType&&this.api.setProperty(e+"."+i+S.PROP_SEL_MIN,o),null!=(n=this.api.getPropertyMeta(e+"."+i+S.PROP_SEL_MAX))&&n.viewstateType&&this.api.setProperty(e+"."+i+S.PROP_SEL_MAX,t)},S.prototype.updateCategoryData=function(t){this.categoryData=t},S.prototype.setAxisGroups=function(t){this.axisGroups=t},S.prototype.getAxisGroups=function(){return this.axisGroups},S.prototype.getBounds=function(){return this.bounds},S.prototype.getLayerType=function(){return this.type},S.prototype.updateBounds=function(t,e){_.isEqual(t,this.bounds)||(this.bounds=t,this.type=_.min(e))},S.prototype.niceNum=function(t,e){var i=Math.floor(X.log10(t)),t=t/Math.pow(10,i),e=e?t<1.5?1:t<3?2:t<7?5:10:t<=1?1:t<=2?2:t<=5?5:10;return e*Math.pow(10,i)},S.prototype.determineMajorUnit=function(t){switch(t){case C.Nanosecond:case C.Millisecond:case C.Second:case C.Minute:case C.Hour:return C.Day;case C.Day:return C.Month;default:return C.Year}},S.prototype.determineUnitForAutoTicks=function(t,e,i){var n,o=Number.MAX_SAFE_INTEGER||9007199254740991,r=this.getUnitFromLayer(this.type);for(n in C){var a=isNaN(Number(n))?C[n]:Number(n),s=S.INTERVALS[a],l=s.steps||o,s=Math.ceil((e-t)/(l*s.size)),l=Math.ceil((e-t)/(l*S.INTERVALS[r].size));if(s<=i){if(l<s)return r;if(Number(a)>=r)return a}}return C.Year},S.prototype.getUnitFromLayer=function(t){switch(t){case E.Date:return C.Day;case E.Month:return C.Month;case E.Minute:return C.Minute;case E.Second:return C.Second;case E.Timespan:case E.Timestamp:return C.Nanosecond;case E.DateTime:case E.Time:return C.Millisecond;default:return C.Year}},S.prototype.getUnitName=function(t){switch(t){case C.Nanosecond:case C.Millisecond:case C.Second:case C.Minute:case C.Hour:return"day";case C.Day:return"month";default:return"year"}},S.prototype.setCategory=function(){this.propertyCache[S.PROP_TYPE]=S.TYPE_CATEGORY},S.prototype.niceScale=function(t,e){for(var i=[],n=e-t,o=this.propertyCache[S.PROP_TYPE]===S.TYPE_CATEGORY&&this.categoryData.length,r=this.niceNum(e-t,!1),a=this.niceNum(r/(this.ticks-1),!0),s=0,r=(o&&(a=1/(s=this.categoryData.length-1)),o&&1===this.categoryData.length?e=.5:Math.floor(t/a)*a),l=Math.max(-Math.floor(X.log10(a)),0),h=X.getFormatter(this.format,Math.max(l,this.propertyCache[S.PROP_PRECISION]),this.hideTrailingZeroes),p=r;p<=e;p+=a){p+a===p&&(a*=2);var u=Math.round(s*p),u=o?this.categoryData[u]:p,c=L.isMoment(u),d=L.isDuration(u);this.propertyCache[S.PROP_TYPE]===S.TYPE_CATEGORY&&(c||d)&&(this.dateFormat&&(u=(this.type===E.Date?L(u):M.Tools.convertValueToMoment(u)).format(this.dateFormat)),u=X.toS(u)),t<=p&&void 0!==u&&i.push({pos:(p-t)/n,label:this.propertyCache[S.PROP_PREFIX]+h(u)+this.propertyCache[S.PROP_SUFFIX]})}return i},S.FONTFACE="Segoe UI,Helvetica,Arial,sans-serif",S.PROP_BEGIN_ZERO=".Format.BeginAtZero",S.PROP_ROTATION=".Format.Rotation",S.PROP_COLOR=".Color",S.PROP_DATE_FORMAT=".Format.DateFormat",S.PROP_FILTER_UNIQUE=".FilterUnique",S.PROP_FORMAT=".Format.Format",S.PROP_HIDETRAIL=".Format.HideTrailingZeroes",S.PROP_MIN=".Range.Min",S.PROP_MAX=".Range.Max",S.PROP_MULTIAXIS=".Format.MultiAxis",S.PROP_SEL_MIN=".Range.SelectionMin",S.PROP_SEL_MAX=".Range.SelectionMax",S.PROP_USE_MIN_MAX=".Range.UseMinMax",S.PROP_RESET_NULL=".Range.ResetToNull",S.PROP_DISPLAY=".Format.Display",S.PROP_SORTED=".Sort",S.PROP_STACKED=".Stacked",S.PROP_STACKED_GAP=".StackedGap",S.PROP_TYPE=".Type",S.PROP_BREAK=".Format.Break",S.PROP_DISTRIBUTION=".Format.Distribution",S.PROP_TRIGGER_BREAK=".Format.TriggerBreak",S.PROP_PRECISION=".Format.Precision",S.PROP_WIDTH=".Width",S.TICKSIZE=7,S.TYPE_CATEGORY="Category",S.TYPE_LINEAR="Linear",S.TYPE_TIME="Time",S.TYPE_LOGARITHMIC="Logarithmic",S.RANGE_PROPS=[S.PROP_TYPE,S.PROP_STACKED,S.PROP_BEGIN_ZERO,S.PROP_USE_MIN_MAX,S.PROP_MIN,S.PROP_MAX],S.PROP_FONTSIZE=".Format.FontSize",S.PROP_GRIDLINESCOLOR=".Gridlines.GridlinesColor",S.PROP_GRIDLINESOFFSET=".Gridlines.GridlinesOffset",S.PROP_GRIDLINESOPACITY=".Gridlines.GridlinesOpacity",S.PROP_INTERVAL_LENGTH=".IntervalLength",S.PROP_TICK_SPACING=".TickSpacing",S.PROP_POSITION=".Position",S.PROP_PREFIX=".Format.Prefix",S.PROP_SHOW_MAJOR=".Format.ShowMajorUnits",S.PROP_SUFFIX=".Format.Suffix",S.PROP_TICKS=".Ticks",S.PROP_TITLEDISPLAY=".Title.Display",S.PROP_TITLESTRING=".Title.LabelString",S.PROP_TITLEFONTSIZE=".Title.FontSize",S.INTERVALS=[{common:!0,size:1e-6,steps:1e6,format:"H:mm:ss.SSSSSSSSS"},{common:!0,size:1,steps:1e3,format:"H:mm:ss.SSS"},{common:!0,size:1e3,steps:60,format:"H:mm:ss"},{common:!0,size:6e4,steps:60,format:"H:mm"},{common:!0,size:36e5,steps:24,format:"HH:mm"},{common:!0,size:864e5,steps:30,format:"YYYY-MM-DD"},{common:!0,size:2628e6,steps:12,format:"MMM YY"},{common:!0,size:3154e7,format:"Y"}];var W=S;function S(t,e,i,n,o){var r=this,n=(this.index=t,this.bounds=new Y(0,1),this.propertyCache={},this.axisProp="",this.breakInfo={},this.categoryData=[],this.hasOverrideRules=!1,this.type=0,this.showMajorTicks=!1,this.stepSize=0,this.triggerBreakApplied=!1,this.axisGroups=[],this.api=e,this.axisProp=i,this.isFinalAxisGroup=o,this.width=e.getProperty(i+S.PROP_WIDTH),this.dateFormat=e.getProperty(i+S.PROP_DATE_FORMAT),this.displayTitle=e.getProperty(i+S.PROP_TITLEDISPLAY),this.display=e.getProperty(i+S.PROP_DISPLAY),this.gridlinesOpacity=e.getProperty(i+S.PROP_GRIDLINESOPACITY),this.gridlinesOffset=e.getProperty(i+S.PROP_GRIDLINESOFFSET),this.gridlinesColor=e.getProperty(i+S.PROP_GRIDLINESCOLOR),this.intervalLength=e.getProperty(i+S.PROP_INTERVAL_LENGTH),this.title=e.getProperty(i+S.PROP_TITLESTRING),this.titleFontSize=e.getProperty(i+S.PROP_TITLEFONTSIZE),this.ticks=e.getProperty(i+S.PROP_TICKS),this.fontSize=e.getProperty(i+S.PROP_FONTSIZE),this.position=e.getProperty(i+S.PROP_POSITION),this.format=e.getProperty(i+S.PROP_FORMAT),this.hideTrailingZeroes=e.getProperty(i+S.PROP_HIDETRAIL),this.propertyCache[S.PROP_PRECISION]=e.getProperty(i+S.PROP_PRECISION),this.propertyCache[S.PROP_PREFIX]=e.getProperty(i+S.PROP_PREFIX),this.propertyCache[S.PROP_SUFFIX]=e.getProperty(i+S.PROP_SUFFIX),void 0!==n&&(this.axisProp=i+S.PROP_MULTIAXIS+"."+n,this.propertyCache[S.PROP_PREFIX]=e.getProperty(this.axisProp+".Prefix"),this.propertyCache[S.PROP_SUFFIX]=e.getProperty(this.axisProp+".Suffix"),this.propertyCache[S.PROP_PRECISION]=e.getProperty(this.axisProp+".Precision"),this.fontSize=e.getProperty(this.axisProp+".FontSize")),S.RANGE_PROPS.forEach(function(t){return r.propertyCache[t]=e.getProperty(i+t)}),-1!==i.indexOf("Yaxes")&&(t=e.getProperty(i+S.PROP_STACKED),o=e.getProperty(i+S.PROP_STACKED_GAP),t&&void 0===o?e.setProperty(i+S.PROP_STACKED_GAP,!1):t||void 0===o||e.setProperty(i+S.PROP_STACKED_GAP,void 0)),e.getProperty(i+S.PROP_TYPE)),t=e.getProperty(i+S.PROP_TICK_SPACING),o=("Time"===n?(void 0===t&&(e.setProperty(i+S.PROP_TICK_SPACING,"Number of Ticks"),void 0===this.ticks)&&(e.setProperty(i+S.PROP_TICKS,10),this.ticks=10),"Number of Ticks"===t&&void 0===this.ticks?(e.setProperty(i+S.PROP_TICKS,10),e.setProperty(i+S.PROP_INTERVAL_LENGTH,void 0)):"Fixed Tick Interval (ms)"===t&&void 0===this.intervalLength&&(e.setProperty(i+S.PROP_INTERVAL_LENGTH,0),e.setProperty(i+S.PROP_TICKS,void 0))):void 0!==t&&("Fixed Tick Interval (ms)"===t&&(e.setProperty(i+S.PROP_TICKS,10),this.ticks=10),e.setProperty(i+S.PROP_TICK_SPACING,void 0),e.setProperty(i+S.PROP_INTERVAL_LENGTH,void 0)),e.getProperty(i+S.PROP_TICKS)),t=(this.ticks=void 0===o?10:o,this.intervalLength=e.getProperty(i+S.PROP_INTERVAL_LENGTH),e.getProperty(i+S.PROP_BREAK)),o=("Time"===n&&void 0===t?(e.setProperty(i+S.PROP_BREAK,864e5),e.setProperty(i+S.PROP_DISTRIBUTION,"Linear"),e.setProperty(i+S.PROP_TRIGGER_BREAK,864e5),e.setProperty(i+S.PROP_SHOW_MAJOR,!1)):"Time"!==n&&void 0!==t&&(e.setProperty(i+S.PROP_BREAK,void 0),e.setProperty(i+S.PROP_DISTRIBUTION,void 0),e.setProperty(i+S.PROP_TRIGGER_BREAK,void 0),e.setProperty(i+S.PROP_SHOW_MAJOR,void 0)),e.getProperty(i+S.PROP_FILTER_UNIQUE)),t=("Category"===n&&void 0===o?e.setProperty(i+S.PROP_FILTER_UNIQUE,!0):"Category"!==n&&void 0!==o&&e.setProperty(i+S.PROP_FILTER_UNIQUE,void 0),e.getProperty(i+S.PROP_SORTED));"Category"===n&&void 0===t?e.setProperty(i+S.PROP_SORTED,!1):"Category"!==n&&void 0!==t&&e.setProperty(i+S.PROP_SORTED,void 0),"Smart"===e.getProperty(i+S.PROP_DISTRIBUTION)&&(this.triggerBreakApplied=!0),e.getProperty(i+S.PROP_SHOW_MAJOR)&&(this.showMajorTicks=!0)}var St=function(t,e,i,n,o,r){this.layer=t,this.index=e,this.overpoint=i,this.yAxis=n,this.yIndex=o,this.xProp=r,this.layer.getLayerType()===G.Bounds&&(this.overpoint=new Y(this.overpoint.x,1))},Dt=(It.prototype.drawCoordinates=function(t,e,i,n,o,r,a,s){var l,h,p=n.getElementsByClassName("xCoord")[0],u=n.getElementsByClassName("yCoord")[0],c=(p||u||(p=this.setUpCoordinate(!0,n),u=this.setUpCoordinate(!1,n)),t.width*e.x),e=t.height*e.y;!o||p.innerText===(h=this.formatData("Xaxis",o.val,a))&&"none"!==p.style.display||(p.style.display="block",a=p.offsetHeight,l=p.offsetWidth,o="Top"===o.position?i.y-a-3:t.height+i.y+3,t=c+i.x,c=l/2,p.style.top=(o+a>n.offsetHeight?o-a:o)+"px",p.style.left=(t-c<0?0:t+c>n.offsetWidth?n.offsetWidth-l:t-c)+"px",p.innerText=h),!r||u.innerText===(h=this.formatData("Yaxis",r.val,s))&&"none"!==u.style.display||(u.style.display="block",a="Right"===r.position?n.offsetWidth-i.z+3:i.x-u.offsetWidth-3,o=u.offsetHeight,u.style.top=e+i.y-o/2+"px",u.style.left=(a<0?0:a)+"px",u.innerText=h)},It.prototype.hideCoordinates=function(t,e){var i=t.getElementsByClassName("yCoord")[0],t=t.getElementsByClassName("xCoord")[0];"x"===e&&t?t.style.display="none":"y"===e&&i?i.style.display="none":t&&i&&(i.style.display="none",t.style.display="none")},It.prototype.updateTheme=function(t,e){var i,n=e.getElementsByClassName("xCoord")[0],e=e.getElementsByClassName("yCoord")[0];this.theme=t,n&&e&&(n.style.backgroundColor=i=(t="Light"===t)?"rgba(48, 48, 48, 0.9)":"rgba(248, 248, 248, 0.9)",n.style.color=t?"white":"black",e.style.backgroundColor=i,e.style.color=t?"white":"black")},It.prototype.hideTooltip=function(){this.api.removeTooltip(),delete this.tooltip},It.prototype.render=function(t,i,e,n){function o(t){_.each(t,function(t){var e=t.layer.getAxisData(t.xProp),i=t.layer.getRowData(t.index),i=i?i[e]:null;null!==i&&(e=function(t){return t.i+""+(t.n||0===t.n?t.n:"")},(i="object"==typeof i&&i.i?e(i):i)===(x="object"==typeof x&&null!=x&&x.i?e(x):x))&&(c&&d&&!g?O.push(t):v.push(h.getRowData(t.layer,t.index,t.yAxis,t.yIndex,t.xProp)))})}var r,a,s,l,h=this,p=t.width*i.overpoint.x+6,u=t.height*(1-i.overpoint.y)+6,c=this.api.getProperty(It.PROP_GROUPBYLAYER),d=this.api.getProperty(It.PROP_SHOWALLPOINTS),y=this.api.getProperty(It.PROP_SHOWALLLAYERS),g=this.api.getProperty(It.PROP_USECUSTOMTOOLTIP),f=i.layer.getAxisData(i.xProp),m=i,P=(this.closestPointInfo=this.getRowData(m.layer,m.index,m.yAxis,m.yIndex,m.xProp),i.layer.getRowData(m.index)),x=P?P[f]:null,v=[],O=[];i.layer.getLayerType()===G.Baseline?v.push(this.getRowData(i.layer,i.index,i.yAxis,i.yIndex,i.xProp)):y&&!d?o(n):d?(l=e,y||(r=i.layer.index,l=e.filter(function(t){return t.layer.index===r})),o(l),c&&!g&&(v=this.groupedLayers(n,O))):y||d||(a=[],s=P?P[i.yAxis]:null,e=i.layer.getAxisId("x"),l=i.layer.getAxisId("y"),y=this.api.getProperty("Xaxes."+e+".Stacked"),e=this.api.getProperty("Yaxes."+l+".Stacked"),y||e?a.push(i):(n.filter(function(t){var e=t.layer.getRowData(t.index),e=e?e[t.yAxis]:null;_.isEqual(e,s)&&a.push(t)}),m.layer.isRegexOrWild()&&P&&(l=m.yAxis,y=Object.keys(P),_.without(y,f,l).forEach(function(t,e){e+=1;_.isEqual(P[t],s)&&(t=A(A({},i),{yAxis:t,yIndex:e}),a.push(t))}))),o(a));e={text:g?this.api.getProperty(It.PROP_CUSTOMTOOLTIP):b.TOOLTIP_DEFAULT,data:v,position:{top:u,left:p},anchorEl:t};return this.tooltip=this.api.setTooltip(e),P},It.prototype.returnPointInfo=function(){return this.closestPointInfo},It.prototype.formattedData=function(t,e){return t.getRowData(e)},It.prototype.getRowData=function(i,t,e,n,o,r){var a,s=this,l=i.getLayerType(),o="Value"===o?"val":i.getAxisData(o),h=this.api.getProperty(i.indexProp(H.PROP_HIGHLIGHTRULES)),p=this.api.getProperty(i.indexProp(H.PROP_ICON)),u=(l!==G.Line||i.hasBubbles()||(p=""),l===G.Heatmap?a=h&&h.length?i.getColorArr(t):(c=i.getHeatmapScore(),a=X.getRange(c),c=X.getColScalar(c,t),Qt.interpolateColor(i.getPaletteProperty(),Number(a[0]),Number(a[1]),Number(c))):(c=l===G.Line&&i.hasBubbles()&&p?U.Bubble:U.Default,a=(c=i.getLayerColors(c,!0))[n%c.length],(h&&h.length||i.hasColorData())&&(a=i.getColorArr(t,i.isRegexOrWild()?n:null))),this.formattedData(i,t)),c=i.getLayerName(),h=i.isRegexOrWild()||l===G.Heatmap?e:c,n=i.getAxisId("x"),d=i.getAxisId("y"),c=u?this.formatData("Xaxis",u[o],n):"",n=u?this.formatData("Yaxis",u[e],d):"",y=this.getWidth(h,12),g=this.getWidth(c,12),f=i.hasPatterns(),m=f?i.getColorValue(a,12,e):void 0,P=i.hasDataIcons(),x=i.hasDataIconColor(),P=(P&&(p=i.getDataIcon(t)),f&&m?m:p),v={color:a=(a=x&&0!==(a=i.getDataIconColor(t)||a).indexOf("#")?X.HEX_CODES[a]||a:a)&&"#"!==a[0]?"#"+a:a,data:u,icon:p&&0===p.indexOf("fa")?"fa "+p:"fa fa-square",image:P&&0===P.indexOf("data:image/")?"width: 15px; content: url('"+P+"')":"",name:h,width:Math.max(y+30,g+30),xAxis:c,yAxis:l===G.Bounds?"":n,xAxisRaw:u?u[o]:void 0,yAxisRaw:u?u[e]:void 0,grouped:r?_.map(r,function(t){return s.formatData("Yaxis",t,d)}):null};return i.isCandlestick()&&["Open","High","Low","Close"].forEach(function(t){var e=s.api.getProperty(i.indexProp(t));v[t.toLowerCase()]=u?s.formatData("Yaxis",u[e],d):""}),v},It.prototype.getWidth=function(t,e){var i=document.createElement("canvas").getContext("2d");if(i)return i.font=e+"px "+W.FONTFACE,i.measureText(t).width;throw new Error("2d context not supported or canvas already initialized")},It.prototype.groupedLayers=function(n,r){var a=this,o=[],t=_.map(n,function(t){return t.layer.getAllCols()}),s=[];return _.each(t,function(t,e){var i=n[e];1===t.length?o.push(_.filter(r,function(t){return t.layer===i.layer&&t.yIndex===i.yIndex})):_.each(t,function(t,e){o.push(_.filter(r,function(t){return t.layer===i.layer&&t.yIndex===Number(e)}))})}),_.each(o,function(n,o){_.each(r,function(t){var e,i=n[0];i&&i.layer===t.layer&&(e=n[0].yAxis,t=_.map(n,function(t){t=a.formattedData(t.layer,t.index);return t?t[e]:null}),s[o]=a.getRowData(i.layer,i.index,i.yAxis,i.yIndex,i.xProp,t))})}),s.filter(function(t){return t})},It.prototype.setUpCoordinate=function(t,e){var i=document.createElement("div");return i.className=t?"xCoord":"yCoord",i.style.borderRadius="3px",i.style.padding="3px",i.style.position="absolute",i.style.fontFamily="sans-serif",e.appendChild(i),this.updateTheme(this.theme,e),i},It.PROP_CUSTOMTOOLTIP="Overlay.CustomTooltip",It.PROP_USECUSTOMTOOLTIP="Overlay.UseCustomTooltip",It.PROP_GROUPBYLAYER="Overlay.GroupByLayer",It.PROP_SHOWALLLAYERS="Overlay.ShowAllLayers",It.PROP_SHOWALLPOINTS="Overlay.ShowAllPoints",It.FORMATS={1212:"YYYY-MM-DD HH:mm:ss.SSSSSSSSS",1213:"YYYY-MM",1214:"YYYY-MM-DD",1215:"YYYY-MM-DD HH:mm:ss.SSS",1216:"YYYY-MM-DD HH:mm:ss.SSSSSSSSS",1217:"YYYY-MM-DD HH:mm",1218:"YYYY-MM-DD HH:mm:ss",1219:"YYYY-MM-DD HH:mm:ss.SSS"},It);function It(t,e){this.formatData=e,this.api=t}wt.prototype.hideCrosshair=function(t){var e=this.el.getElementsByClassName("crosshairX")[0],i=this.el.getElementsByClassName("crosshairY")[0],n=this.el.getElementsByClassName("crosshair-selected")[0];e&&this.el&&(e.setAttribute("visibility","hidden"),i.setAttribute("visibility","hidden"),"hide-both"===t)&&n&&n.setAttribute("visibility","hidden")},wt.prototype.render=function(t,e,i,n,o){this.margin=t,"click"===i&&(this.overpoint=e);var r=o.width*e.x,e=o.height*(1-e.y),n="Light"===n?"black":"white";this.api.getProperty(wt.PROP_CROSSHAIR)?(this.crosshairX?(this.crosshairX=this.el.getElementsByClassName("hover"===i?"crosshairX":"crosshair-selected")[0],this.crosshairY=this.el.getElementsByClassName("crosshairY")[0]):(this.crosshairX=document.createElementNS("http://www.w3.org/2000/svg","line"),this.crosshairY=document.createElementNS("http://www.w3.org/2000/svg","line"),"hover"===i?(this.crosshairX.setAttribute("class","crosshairX"),this.crosshairY.setAttribute("class","crosshairY")):this.crosshairX.setAttribute("class","crosshair-selected")),"number"==typeof r&&this.crosshairX&&isFinite(r)&&(this.setCrosshair(this.crosshairX,n,i),this.crosshairX.setAttribute("x1",r+""),this.crosshairX.setAttribute("y1","0"),this.crosshairX.setAttribute("x2",r+""),this.crosshairX.setAttribute("y2",o.height+t.y+"")),"number"==typeof e&&this.crosshairY&&isFinite(e)&&"hover"===i&&(this.setCrosshair(this.crosshairY,n),this.crosshairY.setAttribute("x1","0"),this.crosshairY.setAttribute("y1",e+""),this.crosshairY.setAttribute("x2",o.width+t.x+""),this.crosshairY.setAttribute("y2",e+""))):this.hideCrosshair("hide-both")},wt.prototype.onPan=function(t,e){var i;this.isSelected()&&this.crosshairX&&(i=Number(this.crosshairX.getAttribute("x1"))/e.width,this.setPosition(i+t,e),this.overpoint=new Y(i+t,this.overpoint.y))},wt.prototype.updateSelected=function(t,e,i){var n;this.isSelected()&&(n=this.overpoint.x,e)&&(e=t.y-t.x,n>t.x&&n<t.y?n=(n-t.x)/e:this.hideCrosshair("hide-both"),this.setPosition(n,i))},wt.prototype.isSelected=function(){return this.crosshairX&&this.crosshairX===this.el.getElementsByClassName("crosshair-selected")[0]&&"visible"===this.crosshairX.getAttribute("visibility")},wt.prototype.setPosition=function(t,e){var i=e.width*t,e=e.height+this.margin.y+"";!isNaN(t)&&isFinite(i)&&this.crosshairX&&(this.crosshairX.setAttribute("x1",i+""),this.crosshairX.setAttribute("y1","0"),this.crosshairX.setAttribute("x2",i+""),this.crosshairX.setAttribute("y2",e))},wt.prototype.setCrosshair=function(t,e,i){t.setAttribute("visibility","visible"),t.setAttribute("opacity",.7),t.setAttribute("stroke",e),t.setAttribute("stroke-dasharray","click"===i?0:3),this.el.getElementsByClassName("overlay")[0].getElementsByClassName("crosshairs")[0].appendChild(t)},wt.SVG_NS="http://www.w3.org/2000/svg",wt.PROP_CROSSHAIR="Overlay.ShowCrosshairs";var Bt=wt;function wt(t,e){this.el=t,this.api=e,this.crosshairX=null,this.crosshairY=null,this.overpoint=new Y(0,1),this.margin=new V(0,0,1,1)}kt.prototype.getDataCache=function(t,e){return null===this.cacheData?null:("x"===t?this.xDataCache:this.yDataCache)[e]},kt.prototype.setCacheValue=function(t){this.cacheData=t},kt.prototype.setDataCache=function(t,e,i,n,o){null!==this.cacheData?("x"===t?this.xDataCache[e]=n:"y"===t&&void 0!==e&&(this.yDataCache[e]=n),i.length===this.maxRows&&(i=this.cacheData+(o?1:0),"x"===t?this.xDataCache[e]=n.slice(i):"y"===t&&(this.yDataCache[e]=n.slice(i)))):(this.xDataCache.length||this.yDataCache.length)&&this.removeDataCache()},kt.prototype.removeDataCache=function(){this.xDataCache=[],this.yDataCache=[]};var Nt=kt;function kt(t){this.maxRows=t,this.xDataCache=[],this.yDataCache=[],this.cacheData=null}Mt.clearCanvas=function(t,e,i){Mt.clearColor(e,i),t&&e.viewport(0,0,e.canvas.width,e.canvas.height),e.clear(e.COLOR_BUFFER_BIT)},Mt.replaceWebGLCanvas=function(t,e){var i=t.style.left,n=t.style.top,o=t.width,r=t.height,t=(e.removeChild(t),document.createElement("canvas")),e=(e.appendChild(t),_.uniqueId("ChartGL"));return t.id=e,t.style.left=i,t.style.top=n,t.width=o,t.height=r,{uid:e,canvas:t}},Mt.setUpWebGLContext=function(t){t=t.getContext(X.glContext,{premultipliedAlpha:X.isWebGLHWAcclEnabled,preserveDrawingBuffer:!0});return X.validateWebGL(t),t},Mt.resizeCanvasToDisplaySize=function(t){var e=t.getBoundingClientRect(),i=e.width,e=e.height;t.width===i&&t.height===e||(t.width=i,t.height=e)},Mt.clearColor=function(t,e){X.isWebGLHWAcclEnabled||X.isIE11?t.clearColor(0,0,0,0):"Light"===e?t.clearColor(.973,.973,.973,0):t.clearColor(.157,.157,.157,0)},Mt.clearWebGLViewport=function(t,e,i,n,o){Mt.resizeCanvasToDisplaySize(t.canvas);var r,a=t.canvas.getBoundingClientRect(),e=e.getBoundingClientRect(),s=e.right-e.left,l=e.bottom-e.top,h=e.left-a.left,p=a.height-e.bottom+a.top+1.5,u=!1,c=p,d=l;o&&(o=o.elements.reduce(function(t,e){return 0<e.clientHeight&&e.clientHeight<t.clientHeight?e:t}).getBoundingClientRect(),e.bottom>o.bottom&&(r=e.bottom-o.bottom,u=!0,c=a.height-o.bottom+a.top+1.5,d=l-r),e.top<o.top&&(u=!0,d-=r=o.top-e.top),d<0)&&(d=0),t.enable(t.SCISSOR_TEST),t.viewport(h,p,s,l),t.scissor(h,c,s,d),this.clearColor(t,i),t.clear(t.COLOR_BUFFER_BIT),t.disable(t.SCISSOR_TEST),u&&(t.enable(t.SCISSOR_TEST),t.scissor(h,c,s,d))};var Ft=Mt;function Mt(){}Xt.prototype.destroyTree=function(){0!==this.treeWidth&&(this.$tree.jstree("destroy"),this.treeWidth=0)},Xt.prototype.getNames=function(){return this.names},Xt.prototype.getTreeWidth=function(){return this.treeWidth},Xt.prototype.onSettingsChange=function(e,t){var i=e.map(function(t){return t.Name}),n=e.map(function(t,e){return e}).filter(function(t){return e[t].Expanded}),o=this.legends.filter(function(t,e){return t.legendGroup&&-1!==n.indexOf(t.index)}).map(function(t){return t.id}),r=e.map(function(t){return t.Icon});this.openedNodes||(this.openedNodes=o,this.icons=r,this.names=i),!_.isEqual(o,this.openedNodes)&&t&&this.expandNodes(o),_.isEqual(i,this.names)&&_.isEqual(r,this.icons)||(this.icons=r,this.appInvalidate(z.Legend))},Xt.prototype.render=function(t){var e=this,i=this.api.getProperty("Legend.LegendGroups").map(function(t){return t.Name}),t=this.generateDataObj(t);_.isEqual(i,this.names)&&_.isEqual(t,this.legends)||(this.destroyTree(),this.legends=t,this.names=i,this.$tree.jstree({core:{data:this.legends,force_text:!0,dblclick_toggle:!1},checkbox:{three_state:!0,cascade:"undefined",tie_selection:!1},plugins:["checkbox","conditionalselect","changed"]}),this.initTreeEvents(),this.$tree.on("ready.jstree",function(){e.updateTreeWidth(!0),e.updateIconColors()}))},Xt.prototype.updateTreeWidth=function(t){var e=this.$tree.width();e!==this.treeWidth&&(this.treeWidth=e,t)&&this.appInvalidate(z.Axis)},Xt.prototype.expandNodes=function(t){this.$tree.jstree("close_all"),this.$tree.jstree(!0).open_node(t),this.openedNodes=t},Xt.prototype.initTreeEvents=function(){var i=this;this.$tree.on("ready.jstree",function(){i.$tree.on("check_node.jstree",function(t,e){i.onNodeCheck(e.node,!0)}),i.$tree.on("uncheck_node.jstree",function(t,e){i.onNodeCheck(e.node,!1)}),i.$tree.on("after_open.jstree",function(t,e){i.setLegendGroupExpanded(e.node.original.index,!0)}),i.$tree.on("after_close.jstree",function(t,e){i.setLegendGroupExpanded(e.node.original.index,!1)})})},Xt.prototype.generateDataObj=function(t){var r=this;return t.map(function(t,e){var i,n=t.customText||t.text,o=t.icon||"fa fa-stop";return 0===(null==(i=t.icon)?void 0:i.indexOf("fa"))&&(o="fa "+t.icon),A(A({},t),{id:e,icon:o,state:{opened:!t.legendGroup||r.api.getProperty("Legend.LegendGroups."+t.index+".Expanded"),selected:!1,checked:t.enabled},li_attr:{class:"treenode-id-"+e,title:n},text:n,legendId:t.legendId||t.text,color:t.color})})},Xt.prototype.onNodeCheck=function(t,e){var i=this,n=!1;this.clicks++,1===this.clicks&&setTimeout(function(){1===i.clicks?i.selectedLegend="":1<i.clicks&&(n=!0,i.selectedLegend?(i.$tree.jstree(!0).check_all(),i.selectedLegend="",i.updateIconColors()):(i.$tree.jstree(!0).uncheck_all(),i.$tree.jstree(!0).check_node(t),i.selectedLegend=t.original.legendId)),i.updateLayerOnNodeCheck(t,e,n),i.clicks=0},300)},Xt.prototype.setLegendGroupExpanded=function(t,e){this.api.setProperty("Legend.LegendGroups."+t+".Expanded",e),this.updateTreeWidth(),e&&this.updateIconColors(),this.appInvalidate(z.Axis)},Xt.prototype.updateIconColors=function(){var i=this;this.legends.forEach(function(t,e){t.legendGroup||(e=null==(e=i.el.getElementsByClassName("treenode-id-"+e)[0])?void 0:e.getElementsByClassName("jstree-themeicon-custom")[0])&&(e.style.color=t.color)})},Xt.prototype.updateLayerOnNodeCheck=function(r,a,s){var t,l=this,h=r.original.legendId;r.children.length?_.uniq(r.children.map(function(t){return l.$tree.jstree(!0).get_node(t+"").original.index})).forEach(function(e,t){var i=r.children.filter(function(t){return l.$tree.jstree(!0).get_node(t+"").original.index===e}),n=i.map(function(t){return l.$tree.jstree(!0).get_node(t+"").original.legendId}),t=t<r.children.length-1,i=l.$tree.jstree(!0).get_node(i[0]+""),o=i.original.wild,i=i.original.legendId;l.updateLayerState(e,a,s,i,t,o,!0,s?r.original.legendGroupName||h:"",n)}):(t=r.original.wild,this.updateLayerState(r.original.index,a,s,h,!1,t))};var Yt=Xt;function Xt(t,e,i,n){this.el=t,this.api=e,this.updateLayerState=i,this.appInvalidate=n,this.clicks=0,this.icons=[],this.legends=[],this.names=[],this.selectedLegend="",this.$tree=$(this.el).find(".legend-div"),this.names=this.api.getProperty("Legend.LegendGroups").map(function(t){return t.Name})}Ht.prototype.render=function(i){function n(t){return"object"==typeof t&&t.attributes?t.attributes.value:t}var o=[];_.each(this.api.getProperty("Layers"),function(t){_.each(_.filter(t.HighlightRules,function(t){return n(t.Show)}),function(t){if("gradient"===t.RuleType){if(!t.Palette.length)return;var e=t.Palette.map(function(t){return"object"==typeof t.type&&t.type.attributes?t.type.attributes.value:t.type}),e=Qt.createGradient(e)}else e=n(t.RuleColor);o.push({ruleColor:e,ruleName:n(t.RuleName),color:i})})}),this.ruleLegendEl.innerHTML=F.highlightRule(o)};var Gt=Ht;function Ht(t,e){this.api=t,this.el=e,this.ruleLegendEl=this.el.getElementsByClassName("GL-highlight-rule")[0]}Ut.prototype.onSettingsChange=function(t){this.tree.onSettingsChange(t,this.isLegendGroup)},Ut.prototype.render=function(){var h,t,p,e,i,n,u,c,d,y,g,o,r,f=this;this.checkedNode?this.checkedNode=!1:(h=[],t=this.color,p=T([],this.layers,!0),e=this.legendDiv,i=this.exportDiv,n=this.drawDiv,u=this.api.getProperty("Legend.LegendGroups"),o=this.api.getProperty("Layers"),c=[],d={},this.legendHeight=void 0,this.ruleLegendHeight=void 0,this.updatePalette(this.layers),this.updateLegendGroupNames(u,o),y=o.some(function(t){return t.LegendGroup&&"None"!==t.LegendGroup}),g=0,o.forEach(function(e){var i,t,n,o,r,a,s=e.LegendGroup,l=p.find(function(t){return t.getId()===e._Id});l&&(t=f.renderLegend(e,l,s),n=0,y&&s&&"None"!==s&&(-1===c.indexOf(s)?(a=u.findIndex(function(t){return t.Name===s}),a=f.getLegendGroupObj(a),(o=null!=a&&a.regexStr&&0===a.regexStr.indexOf("/")?M.Tools.getRegex(a.regexStr):o)&&!(r=t.find(function(t){t=t.text.match(o);return!(!t||null==t||!t.groups)}))&&M.Log.Warn("Legend Groups: No matches found"),r||(c.push(s),a.opened=f.api.getProperty("Legend.LegendGroups."+(c.length-1)+".Expanded"),h.push(a)),i=g,g++):i=h.findIndex(function(t){return t.text===s})),t.forEach(function(t){y?o&&r?n=f.renderRegexLegendGroups(o,t,u,s,l,h,d,n):(t=A(A({},t),{id:g,legendGroup:!1,index:null==l?void 0:l.index,parent:"None"===s?"#":i,enabled:null==l?void 0:l.isEnabled(),wild:null==l?void 0:l.isRegexOrWild()}),h.push(t)):h.push(t),g++}))}),r=(o=this.api.getProperty("Legend.UseCustomLegend"))?this.getCustomLegendHtml(h):null,y?this.renderLegendGroups(e,h,o,r):this.renderDefaultLenged(e,o,r,h,p),this.highlightRule.render(t),this.updateLegendPositions(e,i,n))},Ut.prototype.updateLegendPositions=function(t,e,i){var n=this.getPosition(),o=this.el.getElementsByClassName("lnksAnnotate")[0],r=this.el.getElementsByClassName("lnksExport")[0],a=this.api.hasPermission(M.CustomAPIPermission.canExportData)&&(this.api.getProperty("FileExport.ShowExportCsvButton")||this.api.getProperty("FileExport.ShowExportPngButton")||this.api.getProperty("FileExport.ShowExportExcelButton")),s=this.api.getProperty("Annotations.ShowAnnotateControl");"Left"===n||"Right"===n?(t.classList.remove("top-bottom"),e.classList.remove("top-bottom"),i.classList.remove("top-bottom"),"Right"===n?(t.classList.add("right"),e.classList.add("right"),i.classList.add("right")):(t.classList.remove("right"),e.classList.remove("right"),i.classList.remove("right"))):(t.classList.add("top-bottom"),t.classList.remove("right"),e.classList.add("top-bottom"),e.classList.remove("right"),i.classList.add("top-bottom"),i.classList.remove("right")),t.style.top="Bottom"===n?"auto":"Top"===n?"5px":this.isLegendGroup?a&&s?"45px":a||s?"25px":"5px":this.height/2-this.getHeight()/2+"px",this.isLegendGroup&&(t.style.height="calc(100%  - "+t.style.top+")"),i.style.top="Bottom"===n?"auto":"5px",e.style.top="Bottom"===n?"auto":"Top"!==n&&("Left"!==n&&"Right"!==n||this.api.getProperty("Annotations.ShowAnnotateControl"))?"25px":"5px",o.style.textAlign="Left"===n?"left":"right",r.style.textAlign="Left"===n?"left":"right",this.api.getProperty("Layers").some(function(t){return t.HighlightRules&&t.HighlightRules.some(function(t){return t.Show})})?(a=this.el.getElementsByClassName("GL-highlight-rule")[0],s=Math.max(this.getFileExporterWidth(),this.getWidth())+"px",a.style.left="Left"===n?s:"0px",a.style.right="Right"===n?s:"0px","Bottom"===n&&(t.style.bottom=this.getRulesHeight()-5+"px",e.style.bottom=t.style.bottom,i.style.bottom=t.style.bottom)):"Bottom"===n&&(t.style.bottom="5px",e.style.bottom=t.style.bottom,i.style.bottom=t.style.bottom)},Ut.prototype.updatePalette=function(r){var a=this;_.each(this.api.getProperty("Layers"),function(e,i){null!=(o=e.Palette)&&o.forEach(function(t,e){""===t.type&&(t=(t=b.PALETTE_DEFAULT)[e%t.length],a.api.setProperty("Layers."+i+".Palette."+e,t))});var t,n,o=_.findIndex(r,function(t){return t.getId()===e._Id}),o=r[o];o&&(t=o.getPaletteProperty(!0),o.getLayerType()===G.Bounds?(i,0):o.isRegexOrWild()||o.hasColorData()?(o.isEnabled()&&_.isEqual(o.getAllCols(),a.disabledColumns[i])&&(a.disabledColumns[i]=[]),i,o.updateLayerPalette(a.disabledColumns[i],!1),o.hasColorData()&&(n=a.paletteCache[o.getId()],_.isEqual(n,t)||o.updateColumns(a.disabledColumns[i]))):(i,a.disabledColumns[i]=[],o.updateLayerPalette([],!0)))}),this.paletteCache=[],this.layers.forEach(function(t){a.paletteCache[t.getId()]=t.getPaletteProperty(!0)})},Ut.prototype.updateTheme=function(t){this.color="Light"===t?"black":"white"},Ut.prototype.updateWildcards=function(t,e,i,n){var o;t&&(o=t.hasColorData(),n&&this.disabledColumns[e]||(this.disabledColumns[e]=i&&t.isEnabled()?[]:t.getAllCols(o)),t.updateColumns(this.disabledColumns[e],n))},Ut.prototype.getLayers=function(t){this.layers=t},Ut.prototype.getHeight=function(){var t=this.legendDiv;if(void 0!==this.legendHeight)this.isLegendGroup||t.style.height===this.legendHeight+"px"||(t.style.height=this.legendHeight+"px");else{if(this.api.getProperty("Layers").filter(function(t){return t.Legend}).some(function(t){return t})){var e=t.getElementsByTagName("ul")[0],e=null==e?void 0:e.getBoundingClientRect();if(e)return this.isLegendGroup||(t.style.height=e.height+"px"),this.legendHeight=e.height}this.legendHeight=0,t.style.height=this.legendHeight+"px"}return this.legendHeight},Ut.prototype.getTreeWidth=function(){return this.tree.getTreeWidth()||200},Ut.prototype.getWidth=function(){var t,e=this.legendDiv,i=this.exportDiv,n=this.drawDiv,o=this.api.getProperty("Layers").filter(function(t){return t.Legend}),r=this.getFileExporterWidth(),a=this.getAnnotateWidth();return o.some(function(t){return t})?(o=null==(o=this.el.getElementsByClassName("chartgl-legend")[0])?void 0:o.getBoundingClientRect(),"Left"===(t=this.getPosition())||"Right"===t?(this.isLegendGroup||(e.style.width=(null==o?void 0:o.width)+"px"),t={left:"Left"===t?"0":"",right:"Right"===t?"0":""},Object.assign(i.style,t),Object.assign(n.style,t)):(e.style.width="calc(100%  - "+(r+a)+"px)",n.style.left="",n.style.right=r+"px",i.style.left="",i.style.right="0"),i.style.width=r+"px",n.style.width=a+"px",this.isLegendGroup?this.getTreeWidth():null==o?void 0:o.width):(e.style.width="0px",0)},Ut.prototype.getPosition=function(){var t=this.api.getProperty("Legend.Position");return!this.isLegendGroup||"Top"!==t&&"Bottom"!==t?t:"Right"},Ut.prototype.getRulesHeight=function(){var t;return void 0!==this.ruleLegendHeight?this.ruleLegendHeight:(t=this.el.getElementsByClassName("chartgl-highlight-rule")[0],this.ruleLegendHeight=(null==t?void 0:t.getBoundingClientRect().height)+10||0)},Ut.prototype.onResize=function(t){this.height=t,this.legendHeight=void 0,this.ruleLegendHeight=void 0,this.tree.updateTreeWidth()},Ut.prototype.doubleClickLegend=function(r,a,s,t,l,h){var p=this;this.selectedLegend&&!t?(this.selectedLegend="",this.layers.forEach(function(t,e){p.api.setProperty("Layers."+e+".Enabled",!0),(t.isRegexOrWild()||t.hasColorData())&&(p.disabledColumns[e]=[])})):(t||(this.selectedLegend=r),this.api.getProperty("Layers."+s+".Enabled")||this.api.setProperty("Layers."+s+".Enabled",!0),this.layers.forEach(function(t,e){var i=p.api.getProperty("Layers."+e+".LegendGroup"),n=!p.isLegendGroup||i!==r,i=l===i,o=p.layers[e].hasColorData();e!==s&&n&&!i?(n=p.api.getProperty("Layers."+e+".Enabled"),p.api.setProperty("Layers."+e+".Enabled",!n),(p.layers[e].isRegexOrWild()||o)&&(p.disabledColumns[e]=n?p.layers[e].getAllCols(o):[])):null!=h&&h.length&&e===a.index&&(i=p.disabledColumns[e],n=p.layers[e].getAllCols(o).filter(function(t){return-1===h.indexOf(t)}),_.isEqual(i,n)?p.disabledColumns[e]=[]:p.disabledColumns[e]=n)}),!a.isRegexOrWild()&&!a.hasColorData()||t||l||(t=a.hasColorData(),this.disabledColumns[s]=a.getAllCols(t).filter(function(t){return t!==r})))},Ut.prototype.renderRegexLegendGroups=function(t,o,r,a,s,l,h,p){var u,c=this,d=o.text,t=d.match(t);return t&&t.groups&&(u=Object.values(t.groups)).forEach(function(t,e){var i,n=t,t=u[e+1];t&&(h[n]||(h[n]={},e=r.findIndex(function(t){return t.Name===a}),i=c.api.getProperty("Legend.LegendGroups."+e+".Icon"),e=c.api.getProperty("Legend.LegendGroups."+e+".Expanded"),e=A(A({},o),{id:p,legendGroup:!0,index:null==s?void 0:s.index,parent:"#",enabled:null==s?void 0:s.isEnabled(),wild:null==s?void 0:s.isRegexOrWild(),text:n,opened:e,color:c.color,fontColor:c.color,icon:i,image:i&&0===i.indexOf("data:image/")?"content: url('"+i+"')":"",legendGroupName:a}),p++,l.push(e)),h[n][t]=d,e=null==(i=l.find(function(t){return t.text===n}))?void 0:i.id,o=A(A({},o),{id:p,legendGroup:!1,index:null==s?void 0:s.index,parent:void 0!==e?e+"":"#",enabled:null==s?void 0:s.isEnabled(),wild:null==s?void 0:s.isRegexOrWild(),text:t,legendId:d}),p++,l.push(o))}),p},Ut.prototype.renderLegendGroups=function(t,e,i,n){if(i)for(var i=document.createElement("p"),o=(i.innerHTML=n,i.getElementsByTagName("li")),r=0,a=0;a<e.length;a++){var s,l=e[a];l.legendGroup||((s=o[r].getElementsByTagName("span")[0])&&(e[a]=A(A({},l),{customText:s.innerText})),r++)}t.classList.add("grouped-legend"),t.classList.remove("standard-legend"),"100%"===t.style.width&&(t.style.width="auto"),"100%"!==t.style.height&&(t.style.height="100%"),this.isLegendGroup=!0,this.tree.render(e)},Ut.prototype.getCustomLegendHtml=function(t){var e=this.api.getProperty("Legend.CustomLegend"),i=this.api.getTemplateViewStates(e);return k.compile(e)(t.map(function(t){return A(A({},i),t)}))},Ut.prototype.getLegendGroupObj=function(t){var e=this.api.getProperty("Legend.LegendGroups."+t+".Icon");return{color:this.color,icon:e,image:e&&0===e.indexOf("data:image/")?"content: url('"+e+"')":"",width:12,radius:6,text:this.api.getProperty("Legend.LegendGroups."+t+".Name"),fontColor:this.color,strike:"",bullColor:null,parent:"#",id:t,legendGroup:!0,index:t,regexStr:this.api.getProperty("Legend.LegendGroups."+t+".RegexStr")}},Ut.prototype.renderDefaultLenged=function(t,e,i,n,o){var a=this,s=(t.classList.add("standard-legend"),t.classList.remove("grouped-legend"),this.tree.destroyTree(),this.isLegendGroup=!1,t.innerHTML=e&&i?i:F.legend(n),[]),t=(_.each(o,function(t,e){var i=a.api.getProperty("Layers."+e+".Legend"),n=s.filter(function(t){return t}),n=n[n.length-1],o=t.getLayerType()===G.Baseline,r=t.hasColorData(),o=o||t.isCandlestick()?1:t.getAllCols(r).length;s.push(i?o+(0<e&&n?n:0):0)}),this.legendDiv.getElementsByTagName("li")),r=0;_.each(t,function(e,o){e.onclick=function(){i=o,n=0,_.each(s,function(t,e){if(i+1<=t)return n=e,!1});var i,n,t=n;1===++r&&setTimeout(function(){a.updateState(e,t,1<r),r=0},300)}})},Ut.prototype.renderLegend=function(t,n,e){var o,r,a,s,l,i,h,p=n.index,u=this.color,c=[],d=n.getLayerType(),y=n.hasColorData(),y=n.getAllCols(y),g=n.isEnabled();return this.disabledColumns[p]&&(g||_.isEqual(this.disabledColumns[p],y))||(this.disabledColumns[p]=g?[]:y),this.api.getProperty("Layers."+p+".Legend")&&(o=this.api.getProperty("Layers."+p+"."+H.PROP_ICON),d!==G.Line||n.hasBubbles()||(o=""),r=n.isEnabled(),g=d===G.Line&&n.hasBubbles()&&o?U.Bubble:U.Default,a=n.getLayerColors(g),s=n.hasPatterns(),!n.hasColorData()||e&&"None"!==e?n.isRegexOrWild()?(y=n.getAllCols(),l=this.disabledColumns[p],_.each(y,function(t,e){var i=s?n.getColorValue(a[e%a.length],12,t):void 0,i=s&&i?i:o,e=a[e%a.length];"#"!==e[0]&&(e="#"+e),c.push({color:e,icon:o||i,image:i&&0===i.indexOf("data:image/")?"content: url('"+i+"')":"",width:12,radius:6,text:t,fontColor:u,strike:r&&-1===l.indexOf(t)?"":"line-through"})})):("#"!==(g=d===G.Heatmap?Qt.createGradient(a):n.isCandlestick()?this.api.getProperty("Layers."+p+".CandlestickFormat.WickColor"):a[0])[0]&&(g="#"+g),e=s?n.getColorValue(g,12):void 0,y=s&&e?e:o,c.push({color:g,icon:o||y,image:y&&0===y.indexOf("data:image/")?"content: url('"+y+"')":"",width:d===G.Heatmap?11:12,radius:6,text:this.api.getProperty("Layers."+p+".Name"),fontColor:u,strike:r?"":"line-through",bullColor:n.isCandlestick()?this.api.getProperty("Layers."+p+".CandlestickFormat.BullColor"):null,isHeatmap:d===G.Heatmap})):(i=this.disabledColumns[p],g=(e=n.getColorData())[0],h=e[1],g.forEach(function(t,e){t=t.toString();e=h[e];"#"!==e[0]&&(e="#"+e),c.push({color:e,icon:o,image:o&&0===o.indexOf("data:image/")?"content: url('"+o+"')":"",width:12,radius:6,text:null==t?void 0:t.toString(),fontColor:u,strike:r&&-1===i.indexOf(t)?"":"line-through"})}))),c},Ut.prototype.updateLegendGroupNames=function(t,e){var n=this,o=t.map(function(t){return t.Name}),r=this.tree.getNames();e.forEach(function(t,e){var i,t=t.LegendGroup;"None"!==t&&-1===o.indexOf(t)&&(i=r.indexOf(t),t=r.length===o.length?o[i]:"None",n.api.setProperty("Layers."+e+".LegendGroup",t))})},Ut.prototype.updateState=function(t,e,i){var t=t.getElementsByTagName("span")[0],n=t.id,o=this.layers[e],r=o.isEnabled(),a=o.isRegexOrWild(),s=o.hasColorData();this.setIgnoreSettings(!0),i?this.doubleClickLegend(n,o,e):(this.selectedLegend="")===t.style.textDecoration?(t.style.textDecoration="line-through",a||!r||s||this.api.setProperty("Layers."+e+".Enabled",!1),(a||s)&&(this.disabledColumns[e].length+1===o.getAllCols(s).length&&this.api.setProperty("Layers."+e+".Enabled",!1),this.disabledColumns[e].push(n))):(t.style.textDecoration="",r||this.api.setProperty("Layers."+e+".Enabled",!0),(a||s)&&this.disabledColumns[e].splice(this.disabledColumns[e].indexOf(n),1)),this.updateLayers(!0),(a||o.getLayerType()===G.Heatmap||s)&&(this.updatePalette(this.layers),this.layers[e].updateColumns(this.disabledColumns[e])),this.setIgnoreSettings(!1),this.appInvalidate(z.Process)},Ut.prototype.updateTreeState=function(i,n,t,e,o,r,a,s,l){var h=this,p=this.layers[i],u=(this.setIgnoreSettings(!0),this.checkedNode=!0,p.hasColorData()),c=p.isRegexOrWild();t?(this.doubleClickLegend(e,p,i,o,s,l),this.appInvalidate(z.Process)):(this.selectedLegend="",null!=l&&l.length?l.forEach(function(t){var e;n?-1<(e=h.disabledColumns[i].indexOf(t))&&h.disabledColumns[i].splice(e,1):-1===h.disabledColumns[i].indexOf(t)&&h.disabledColumns[i].push(t)}):r?n?(this.disabledColumns[i].splice(this.disabledColumns[i].indexOf(e),1),this.api.setProperty("Layers."+i+".Enabled",!0)):(this.disabledColumns[i].length+1===p.getAllCols(u).length&&(this.api.setProperty("Layers."+i+".Enabled",!1),this.appInvalidate(z.Process)),this.disabledColumns[i].push(e)):(this.api.setProperty("Layers."+i+".Enabled",n),this.updateLayers(!0),n&&(this.disabledColumns[i]=[]),this.appInvalidate(z.Process))),c&&(this.updatePalette(this.layers),p.updateColumns(this.disabledColumns[i])),s&&this.layers.forEach(function(t,e){e!==i&&h.layers[e].updateColumns(h.disabledColumns[e])}),this.setIgnoreSettings(!1)};var zt=Ut;function Ut(t,e,i,n,o,r,a,s){this.el=t,this.api=e,this.tooltips=i,this.appInvalidate=n,this.setIgnoreSettings=o,this.updateLayers=r,this.getFileExporterWidth=a,this.getAnnotateWidth=s,this.checkedNode=!1,this.color="black",this.disabledColumns=[],this.height=0,this.isLegendGroup=!1,this.layers=[],this.paletteCache={},this.selectedLegend="",this.highlightRule=new Gt(this.api,this.el),this.tree=new Yt(this.el,this.api,this.updateTreeState.bind(this),this.appInvalidate.bind(this)),this.legendDiv=this.el.getElementsByClassName("legend-div")[0],this.exportDiv=this.el.getElementsByClassName("export-div")[0],this.drawDiv=this.el.getElementsByClassName("draw-div")[0]}Wt.prototype.onAxisPan=function(t,e){var i=t.clientX-e.left,n=t.clientY-e.top,o=e.right-t.clientX,e=e.bottom-t.clientY,t=this.axis.getMargin(),r=i<t.x,a=o<t.z,s=n<t.y,t=e<t.w,r=r?"Left":a?"Right":s?"Top":t?"Bottom":"";return[new V(i,n,o,e),r]},Wt.prototype.onPanning=function(t,e,i,n,o,r,a){var s,l="",h="Top"===e||"Bottom"===e,e="Left"===e||"Right"===e;this.activePan||(this.activePan=t),e?l=this.calculatePanDirection(t.y,"y",this.activePan):h&&(l=this.calculatePanDirection(t.x,"x",this.activePan)),l&&(a=h?a.offsetWidth:a.offsetHeight,a=this.pixelDiff/a,(s=this.num-1)<0||(this.activePan=t,document.body.style.cursor=h?"e-resize":"n-resize",t=("Right"===l||"Left"===l?o:r)[s],o=i[s]||new Y(0,1),r=n[s]||new Y(0,1),i=(t.y-t.x)*(o.y-o.x)*a,n=(t.y-t.x)*(r.y-r.x)*a,o="Right"===l?-i:"Left"===l?i:0,r="Top"===l?-n:"Bottom"===l?n:0,i=new V(t.x+(h?o:0),t.x+(e?r:0),t.y+(h?o:0),t.y+(e?r:0)),this.onPan(i,"Right"===l?a:"Left"===l?-a:0,s,l)))},Wt.prototype.onPointDown=function(t,e){this.activePan=t;var i="Top"===e||"Bottom"===e,n="Left"===e||"Right"===e,o=this.axis.getAxes("x"),r=this.axis.getAxes("y"),a=this.axis.getAxes("x","Top"),s=this.axis.getAxes("x","Bottom"),l=this.axis.getAxes("y","Left"),h=this.axis.getAxes("y","Right"),p=0,u=0,c=i?this.axis.getSize(e,"x"):n?this.axis.getSize(e,"y"):[];_.each(c,function(t,e){0<Number(e)&&(c[e]=c[Number(e)-1]+c[e])}),"Right"===e&&(p=t.z),"Left"===e&&(p=t.x),"Top"===e&&(p=t.y),"Bottom"===e&&(p=t.w),_.each(c,function(t,e){if(p<=t)return u=c.length-Number(e),!1}),"Right"===e&&(u=r.indexOf(h[u-1])+1),"Left"===e&&(u=r.indexOf(l[u-1])+1),"Top"===e&&(u=o.indexOf(a[u-1])+1),"Bottom"===e&&(u=o.indexOf(s[u-1])+1),this.num=u},Wt.prototype.calculatePanDirection=function(t,e,i){if("y"===e){if(this.pixelDiff=Math.abs(i.y-t),i.y<t)return"Bottom";if(i.y>t)return"Top"}else{if(this.pixelDiff=Math.abs(i.x-t),i.x<t)return"Right";if(i.x>t)return"Left"}return""};var Vt=Wt;function Wt(t,e,i){this.api=t,this.axis=e,this.onPan=i,this.activePan=null,this.num=0,this.pixelDiff=0}n.prototype.getProperty=function(t,e,i){return(-1!==t.indexOf("Xaxes")?this.x:this.y)[e].getProperty(i)},n.prototype.resetOverrideRules=function(){this.x.forEach(function(t){return t.resetOverrideRules()}),this.y.forEach(function(t){return t.resetOverrideRules()}),this.axisGroupClasses.forEach(function(t){t.forEach(function(t){return t.resetOverrideRules()})})},n.prototype.setOverrideRules=function(o,r,a,t,e,s,i){var l=this;""!==o.RuleTargetAxis&&""!==o.RuleCondition&&""!==o.RuleAction&&(t.forEach(function(n,t){s[n]&&r&&(r===n||n.match(a))&&l.x[t].setOverrideRules(o,s[n]),l.axisGroupClasses[t]&&s[n]&&l.axisGroupClasses[t].forEach(function(t,e){var e=s[n][e],i=n+" Multi Axis - "+e;i&&r&&(r===i||i.match(a))&&t.setOverrideRules(o,[e])})}),e.forEach(function(t,e){i[t]&&r&&(r===t||t.match(a))&&l.y[e].setOverrideRules(o,i[t])}))},n.prototype.getAxes=function(t,i){return i?_.map(this[t],function(t,e){if(t.position===i)return Number(e)+1}).filter(function(t){return void 0!==t}):_.map(this[t],function(t,e){return Number(e)+1})},n.prototype.getAxisType=function(t,e){var i=[];return[this.api.getProperty(t+"."+e+W.PROP_SEL_MIN),this.api.getProperty(t+"."+e+W.PROP_SEL_MAX),this.api.getProperty(t+"."+e+W.PROP_MIN),this.api.getProperty(t+"."+e+W.PROP_MAX)].filter(function(t){return t}).forEach(function(t){t=M.Tools.inferKdbTypeFromDashString(t),t=t?Number(t.slice(-2)):null;t&&i.push(t)}),i.length?i:[E.Float]},n.prototype.getBounds=function(t,e,i,n){var o=this.api.getProperty(e+"."+i+W.PROP_BEGIN_ZERO),r=this.api.getProperty(e+"."+i+W.PROP_USE_MIN_MAX),a=this.api.getProperty(e+"."+i+W.PROP_MIN),e=this.api.getProperty(e+"."+i+W.PROP_MAX),n=(r&&(i=M.Tools.inferKdbTypeFromDashString(a),s=M.Tools.inferKdbTypeFromDashString(e),i=i?Number(i.slice(-2)):n,s=s?Number(s.slice(-2)):n,a=/\S/.test(a)?X.convertStringToJsScalar(a,i):t.x,e=/\S/.test(e)?X.convertStringToJsScalar(e,s):t.y),r?new Y(a,e):t),i=t.x<0,s=t.y<0;return new Y(!o||s||i?n.x:0,o&&s?0:n.y)},n.prototype.getMargin=function(){return this.margin},n.prototype.getSelectionZoomBounds=function(t,e,i,n,o){var r,a,s=this.api.getProperty(e+"."+i+W.PROP_SEL_MIN),l=this.api.getProperty(e+"."+i+W.PROP_SEL_MAX),h=t?t.x:0,t=t?t.y:1,p=M.Tools.inferKdbTypeFromDashString(s),u=M.Tools.inferKdbTypeFromDashString(l),p=p?Number(p.slice(-2)):n,u=u?Number(u.slice(-2)):n,n=/\S/.test(s)?X.convertStringToScalar(s,X.ipcTemp(p)):"",c=/\S/.test(l)?X.convertStringToScalar(l,X.ipcTemp(u)):"";return"number"!=typeof n&&"bigint"!=typeof n||(h=X.convertToJsScalar(p,n)),"number"!=typeof c&&"bigint"!=typeof c||(t=X.convertToJsScalar(u,c)),this.api.getProperty(e+"."+i+W.PROP_TYPE)===W.TYPE_CATEGORY&&o&&o[1]?s||l?(r=p===E.Symbol?s:h,a=u===E.Symbol?l:t,n=o[0].findIndex(function(t){return _.isEqual(t,r)}),c=o[0].findIndex(function(t){return _.isEqual(t,a)}),new Y(o[1][n]||0,o[1][c]||1)):new Y(0,1):new Y(h,t)},n.prototype.getSize=function(e,t){var n,o,r=this,i=("x"===t?this.x:this.y).filter(function(t){return t.position===e&&t.display}),a=this.legend.getHeight(),s=this.legend.getPosition();return"x"===t?(t=this.legend.getRulesHeight(),n="Top"===e&&"Top"===s?a+5:t+("Bottom"===s?a:0),_.map(i,function(t,e){var i=r.labelHeights[t.index]||t.fontSize;return((t.display?t.getBaseSize(i):0)+(0===e?n:0))*(t.getAxisGroups().length+1)})):(t=this.legend.getWidth(),o="Left"===e?"Left"===s?t:0:this.margin.z-this.getWidth(i),_.map(i,function(t,e){var i=_.maxBy(r.yTicks[e],function(t){return t.label.length}),i=t.measureText(r.ctx,(null==i?void 0:i.label)||"");return(t.display?t.getBaseSize(i.width):0)+(0===e?o:0)}))},n.prototype.hasOverrideRules=function(){return this.x.concat(this.y).some(function(t){return t.hasOverrideRulesSet()})},n.prototype.onResize=function(){this.renderAll=!0},n.prototype.onSettingsChange=function(t,e){"Xaxes"===t&&(this.x[e]=new W(e,this.api,"Xaxes."+e)),"Yaxes"===t&&(this.y[e]=new W(e,this.api,"Yaxes."+e)),this.renderAll=!0},n.prototype.render=function(n,o,t,e,i,r,a){var s,l,h,p,u,c,d=this,i=(this.currentTickLabels=i,this.x.length!==t.length&&(this.x=[],_.each(t,function(t,e){d.x[e]=new W(e,d.api,"Xaxes."+e)})),this.y.length!==e.length&&(this.y=[],_.each(e,function(t,e){d.y[e]=new W(e,d.api,"Yaxes."+e)})),this.getSimpleTicks(t,e),this.x.length&&_.some(this.x,function(t){return!0===t.display})),y=this.y.length&&_.some(this.y,function(t){return!0===t.display}),g=this.y.filter(function(t){return"Right"===t.position&&t.display}),f=this.legend.getPosition(),m=this.legend.getWidth(),P=this.legend.getHeight(),x=m!==this.legendWidth,x=n!==this.width||o!==this.height||this.renderAll||x,v=(n!==this.width&&(this.width=n,this.canvas.width=n),o!==this.height&&(this.height=o,this.canvas.height=o),x&&(this.updateTheme(),this.ctx.clearRect(0,0,n,o)),_.some(this.x,function(t,e){return t.bounds&&d.xBounds[e]&&(t.bounds.x!==d.xBounds[e].x||t.bounds.y!==d.xBounds[e].y)})),O=_.some(this.y,function(t,e){return t.bounds&&d.yBounds[e]&&(t.bounds.x!==d.yBounds[e].x||t.bounds.y!==d.yBounds[e].y||!d.currentTicksInit&&(null==(t=d.currentTickLabels[e])?void 0:t.length))}),y=(this.getLabelHeights(t),(x||O)&&y&&(O=this.margin,y=W.TICKSIZE,this.ctx.clearRect(0,O.y-y,O.x-W.TICKSIZE,o-O.y-O.w+2*y),this.ctx.clearRect(n-O.z+y,O.y-y,O.z+y,o-O.y-O.w+2*y),this.ctx.clearRect(O.x,O.y,n-O.z-O.x,o-O.y-O.w),this.ctx.clearRect(O.x-y,O.y-y,y+.5,o-O.y+2*y-O.w),this.ctx.clearRect(n-O.z-2,O.y-y-1,y+2,o-O.y+y-O.w+1),this.ctx.clearRect(n-O.z,O.y-1,y,o-O.y+W.TICKSIZE+1-O.w),_.each(e,function(t,e){d.api.getProperty("Yaxes."+e+W.PROP_DISPLAY)&&d.renderY(e,n,o,f,m,P,r)})),this.m.x!==this.margin.x||this.m.z!==this.margin.z),i=((x||y||v)&&i&&(s=this.margin,O=W.TICKSIZE,e=this.calcTickWidth("Left"),i=this.calcTickWidth("Right"),c=_.some(this.y,function(t){return!0===t.display&&"Left"===t.position}),l=_.some(this.y,function(t){return!0===t.display&&"Right"===t.position}),h=_.some(this.x,function(t){return!0===t.display&&"Top"===t.position}),p=s.x-.5,u=s.z,e&&(e>s.x||!c)&&(p=e),i&&(i>s.z||!l)&&(u=e),this.ctx.clearRect(0,o-s.w+W.TICKSIZE,n,s.w-1+W.TICKSIZE),h&&this.ctx.clearRect(0,0,n,s.y-(!y||x||v?O:0)),this.ctx.clearRect(p,o-s.w,(c=l?n-p-u:n)+1,W.TICKSIZE),h&&this.ctx.clearRect(p,s.y-W.TICKSIZE,c+("Top"===f?.5:"Right"===f?-1:-.5),W.TICKSIZE-1),_.each(t,function(t,e){var i;d.api.getProperty("Xaxes."+e+W.PROP_DISPLAY)&&(d.renderX(e,n,o,f,l?s.z:m,P,d.xTicks[e],d.x[e],r),null!=(i=r[e]))&&i.length&&d.drawAxisGroups(r,e,n,o,f,l?s.z:m,P,a[e])})),this.margin),e=g.length?n-i.x-i.z-1:n;return this.ctx.clearRect(i.x,i.y-.5,e,o-i.w-i.y),this.drawXGridlines(n,o),this.drawYGridlines(n,o),this.ctx.globalAlpha=1,this.updateTheme(),_.each(this.x,function(t,e){return d.xBounds[e]=t.bounds}),_.each(this.y,function(t,e){return d.yBounds[e]=t.bounds}),this.m=this.margin,this.renderAll=!1,this.legendWidth=m,this.margin},n.prototype.updateCategoryData=function(t,e,i,n){var o="x"===t?"Xaxes.":"Yaxes.",r=this.api.getProperty(o+e+W.PROP_FILTER_UNIQUE),a=this.api.getProperty(o+e+W.PROP_TYPE),s=[],o=(n.forEach(function(t,e){var i;s=0<e&&a===W.TYPE_CATEGORY&&!r?(i=[],null!=t&&t.forEach(function(t,e){_.isEqual(t[e],s[0][e])||i.push(t)}),s.concat(i)):s.concat(t)}),"x"===t?s:s[0]);r&&(o=_.uniqBy(o,function(t){if(t)return t.i&&t.n?t.i&&t.n:t.i||t})),i.updateCategoryData(o||[])},n.prototype.updateMultiAxis=function(t,o){var r=this;this.axisGroupClasses=[],_.each(t,function(t,n){r.axisGroupClasses[n]=[],o[n].forEach(function(t,e){var i=e===o[n].length-1,e=new W(n,r.api,"Xaxes."+n,e,i);r.axisGroupClasses[n].push(e)})})},n.prototype.getMultiAxisTicks=function(t,e,i,n,o){i=this.axisGroupClasses[e][i],i.setCategory(),this.updateCategoryData("x",e,i,[t[0]]),e=o,t=n.getLayerType();return i.updateBounds(e,[t]),i.getSimpleTicks()},n.prototype.drawAxisGroups=function(i,n,h,p,u,c,d,y){var g=this,t=i[n],f=this.x[n];t.forEach(function(t,e){var t=g.getMultiAxisTicks(t,n,e,f,y),o={},r=(t.forEach(function(t){o[t.label]||(o[t.label]=[]),o[t.label].push(t.pos)}),t[0]&&t[1]?(t[1].pos-t[0].pos)/2:0),a=t[0]&&r?[0<t[0].pos-r?t[0].pos-r:0]:[],s=[],l=Object.keys(o);l.forEach(function(t,e){var i=o[t],n=i.length%2==1?i[Math.floor(i.length/2)]:(i[i.length/2-1]+i[i.length/2])/2,n=(s.push({pos:n,label:t}),i[i.length-1]),t=l[e+1]?o[l[e+1]][0]:null;(n&&t||r)&&a.push(t?(n+t)/2:n+r)}),g.renderX(n,h,p,u,c,d,s,g.axisGroupClasses[n][e],i,e,a)})},n.prototype.renderAxes=function(){this.renderAll=!0},n.prototype.updateTheme=function(t){this.theme=t||this.theme},n.prototype.calcTickWidth=function(o){var r=this,t=0,e="Left"===o?_.map(this.x,function(t){return _.first(r.xTicks[t.index])}):_.map(this.x,function(t){return _.last(r.xTicks[t.index])});return t=e.length&&(e=_.map(e,function(t){return t?t.label:""}),e=_.map(e,function(t,e){var t=r.x[e].measureText(r.ctx,t).width,i=r.api.getProperty("Xaxes."+e+W.PROP_ROTATION),n=0;return t+(n=0<i&&"Right"===o||i<0&&"Left"===o?r.calculateRotatedWidth(i,t,r.x[e].fontSize/2):n)}),e=_.max(e))?Math.ceil(e/2)+1:t},n.prototype.calculateLongestWidth=function(t,e){t=_.maxBy(t,function(t){return t.label.length});return e.measureText(this.ctx,(null==t?void 0:t.label)||"").width+12},n.prototype.calculateLabelHeight=function(t,e){t*=Math.PI/180;return e*Math.abs(Math.sin(t))},n.prototype.calculateYOffset=function(t,e){var t=t%360,i=(t<0&&(t+=360),0);return e+(i=90<t&&t<270?10*Math.abs(Math.sin((t-90)%180*(Math.PI/180))):i)},n.prototype.calculateRotatedWidth=function(t,e,i){t*=Math.PI/180;return Math.abs(e*Math.cos(t))+Math.abs(i*Math.sin(t))},n.prototype.calculateXOffset=function(t,e,i){var i=i.position,n=t%360;return n<0&&0,0!==t?(n="Top"===i?-e/2:e/2,t<0?-n:n):0},n.prototype.getLabelHeight=function(t,e){var i=0;return 0!==e&&t.display&&(t=this.calculateLongestWidth(this.xTicks[t.index],this.x[t.index]),i=this.calculateLabelHeight(e,t)),i},n.prototype.getLabelHeights=function(t){var n=this;this.labelHeights=[],_.each(t,function(t,e){var i=n.x[e],e=n.api.getProperty("Xaxes."+e+W.PROP_ROTATION);n.labelHeights[i.index]=n.getLabelHeight(i,e)})},n.prototype.getSimpleTicks=function(t,e){var n=this;this.xTicks=new Array(t.length),this.yTicks=new Array(e.length),_.each(t,function(t,e){var i=n.api.getProperty("Xaxes."+e+W.PROP_DISPLAY);n.xTicks[e]=i?n.x[e].getSimpleTicks():[]}),_.each(e,function(t,e){var i=n.api.getProperty("Yaxes."+e+W.PROP_DISPLAY);n.yTicks[e]=i?n.y[e].getSimpleTicks():[]})},n.prototype.getStepSize=function(t,e,i){e=e&&e<t?Math.ceil(t/e):1;return e=i.propertyCache[W.PROP_TYPE]===W.TYPE_CATEGORY&&(i=i.getTicksLength())<t&&e<(t=Math.ceil(t/i))?t:e},n.prototype.drawCurrentTickLabels=function(t,s,l,h,p,u){var c=this,t=(this.ctx.textBaseline="middle",this.ctx.textAlign="Left"===p.position?"right":"left",this.currentTickLabels[t]);null!=t&&t.length&&(this.currentTicksInit=!0,t.forEach(function(t){t.forEach(function(t){var e=Number(t[0]),i=(e-Number(p.bounds.x))/(Number(p.bounds.y)-Number(p.bounds.x)),i=s-l*i,n=h?-5:5,o=p.measureText(c.ctx,e.toString()),r=u+3*(h?-1:1),a=i-11,o=(c.ctx.beginPath(),o.width*(h?-1:1)+2.2*n);c.ctx.rect(r+n,a,o,19),c.ctx.moveTo(r+n,a),c.ctx.lineTo(r+n,19+a),c.ctx.lineTo(r,10+a),c.ctx.fillStyle=t[1],c.ctx.fill(),c.ctx.fillStyle="#FFFFFF",c.ctx.fillText(e.toString(),r+2*n,i)})}))},n.prototype.drawXGridlines=function(h,p){var u=this;_.each(this.x,function(t,e){var i=u.xTicks[e];if(i){var n=h-u.margin.x-u.margin.z-2,o=t.getGridlines(),e=u.calculateLongestWidth(i,t),e=0<Math.round(n/e)?Math.round(n/e):1,r=u.getStepSize(i.length,e,t),e=(u.ctx.beginPath(),o.color),t=e||("Dark"===u.theme?"#ffffff":"#000000");u.ctx.strokeStyle=t,u.ctx.globalAlpha=void 0!==o.opacity?o.opacity/100:.15;for(var a=0;a<i.length;a+=r){var s=Math.round(u.margin.x+i[a].pos*n)-.5,l=(0===a&&o.offset&&(l=s/2)>u.margin.x&&(u.ctx.moveTo(l,p-u.margin.w),u.ctx.lineTo(l,u.margin.y)),o.offset?a===i.length-1?u.canvas.width-u.margin.z:u.margin.x+i[a+1].pos*n:0),s=o.offset?s+Math.abs(s-l)/2:s;s<h-u.margin.z&&(u.ctx.moveTo(s,p-u.margin.w),u.ctx.lineTo(s,u.margin.y))}u.ctx.stroke(),u.ctx.closePath()}})},n.prototype.drawYGridlines=function(p,u){var c=this;_.each(this.y,function(t,e){var i=c.yTicks[e];if(i){for(var n=u-c.margin.w,o=n-c.margin.y,r=t.getGridlines(),e=(c.ctx.beginPath(),r.color),e=e||("Dark"===c.theme?"#ffffff":"#000000"),a=(c.ctx.strokeStyle=e,c.ctx.globalAlpha=void 0!==r.opacity?r.opacity/100:.15,c.getStepSize(i.length,null,t)),s=0;s<i.length;s+=a){var l=Math.round(n-i[s].pos*o),h=r.offset?0===s?n:n-i[s-1].pos*o:0,h=r.offset?h-Math.abs(l-h)/2-.5:l+.5;c.ctx.moveTo(c.margin.x,h),c.ctx.lineTo(p-c.margin.z-1,h)}c.ctx.stroke(),c.ctx.closePath()}})},n.prototype.fixOverlappingTriggerBreak=function(t,n,o,r){var a=[];return t.forEach(function(t){var e,i;(!a[a.length-1]||(e=t.pos,i=a[a.length-1].pos,n<o+e*r-(o+i*r)))&&a.push(t)}),a},n.prototype.getHeight=function(t){var n=this;return _.sumBy(t,function(t){var e=n.labelHeights[t.index]||t.fontSize,i=t.getAxisGroupIndex();return void 0!==i&&(i=n.api.getProperty("Xaxes."+t.index+W.PROP_MULTIAXIS+"."+i+".Rotation"))&&(e=n.getLabelHeight(t,i)),t.display?t.getBaseSize(e):0})},n.prototype.getWidth=function(t){var n=this;return _.sumBy(t,function(t){var e=null!=(e=n.currentTickLabels[t.index])&&e.length?10:0,i=n.yTicks[t.index],i=_.maxBy(i,function(t){return t.label.length}),i=t.measureText(n.ctx,(null==i?void 0:i.label)||"");return t.display?t.getBaseSize(i.width)+e:0})},n.prototype.renderX=function(t,e,i,n,o,r,a,s,l,h,p){function u(t,e,i,n){return e<=t&&!i?t:e<=t&&i?n+(t-n):n}var F=this,c=this.x[t],d=_.maxBy(a,function(t){return t.label.length}),d=s.measureText(this.ctx,(null==d?void 0:d.label)||"").width+12,y=this.api.getProperty("Xaxes."+t+W.PROP_ROTATION),g=this.labelHeights[t],f=(void 0!==h&&(y=this.api.getProperty("Xaxes."+t+W.PROP_MULTIAXIS+"."+h+".Rotation"),P=this.axisGroupClasses[t][h],g=this.getLabelHeight(P,y)),[]),m=[],P=(this.x.forEach(function(t,i){t.display&&("Top"===t.position?f.push(t):"Bottom"===t.position&&m.push(t),t=l[i])&&t.forEach(function(t,e){e=F.axisGroupClasses[i][e];e.display&&("Top"===e.position?f.push(e):"Bottom"===e.position&&m.push(e))})}),this.getHeight(f)+("Top"===n?r:0)+5),x="Top"===s.position,v=_.some(this.y,function(t){return!0===t.display&&"Left"===t.position}),O=_.some(this.y,function(t){return!0===t.display&&"Right"===t.position}),T=v?this.margin.x:"Left"===n?o:0,o="Right"===n?o:this.margin.z,R=this.legend.getRulesHeight(),M=(M=this.getHeight(m)+R+("Bottom"===n?r:0))||5,b=x?("Top"===n?r:0)+5+this.getHeight(f.slice(f.indexOf(c)+(void 0!==h?h+1:0))):this.margin.y,C=x?0:this.getHeight(m.slice(m.indexOf(c)+(void 0!==h?h+1:0)))+R+("Bottom"===n?r:0),v=u(this.calcTickWidth("Left"),this.margin.x,v,T),O=u(this.calcTickWidth("Right"),this.margin.z,O,o),L=T=T<v?v:T,A=e-T-(o=o<O?O:o)-3,v=(s.isTriggerBreakApplied()&&(a=this.fixOverlappingTriggerBreak(a,d,L,A),this.xTicks[t]=a),this.calculateRotatedWidth(y,d,s.fontSize/2)),O=0<Math.round(A/v)?Math.round(A/v):1,E=this.getStepSize(a.length,O,s),d=(d=this.api.getProperty("Xaxes."+t+W.PROP_COLOR))||("Light"===this.theme?"#000000":"#ffffff");if(this.ctx.strokeStyle=d,this.ctx.fillStyle=d,void 0===h&&(this.ctx.beginPath(),this.ctx.moveTo(T-.5,x?b-.5:i-C+.5),this.ctx.lineTo(e-o-.5,x?b-.5:i-C+.5)),void 0===h)for(var S=0;S<a.length;S+=E){var D=Math.round(L+a[S].pos*A)+.5;this.ctx.moveTo(D,.5+(x?b:i-C)),this.ctx.lineTo(D,.5+(x?b-W.TICKSIZE:i-C+W.TICKSIZE))}if(p)for(var Y=x?("Top"===n?r:0)+5+this.getHeight(f.slice(f.indexOf(c))):this.margin.y,X=x?0:this.getHeight(m.slice(m.indexOf(c)))+R+("Bottom"===n?r:0),G=x?("Top"===n?r:0)+5+this.getHeight(f.slice(f.indexOf(c)+(void 0!==h?h+2:0))):this.margin.y,H=x?0:this.getHeight(m.slice(m.indexOf(c)+(void 0!==h?h+2:0)))+R+("Bottom"===n?r:0),z=s.displayTitle&&!s.width?s.titleFontSize+W.TICKSIZE:0,S=0;S<p.length;S+=E){var D=L+p[S]*A,I=.5+(x?Y:i-X),B=.5+(x?G?G-.5:.5:i-((H||0)+.5+z));this.ctx.clearRect(D+.5,x?B:I,1,Math.abs(B-I)),this.ctx.fillRect(D+.5,x?B:I,1,Math.abs(B-I))}this.ctx.stroke(),this.ctx.closePath(),this.ctx.textBaseline=x?"bottom":"top",this.ctx.textAlign="center",this.ctx.font=s.fontSize+"px "+W.FONTFACE;for(S=0;S<a.length;S+=E){var w=0,U=0;0!==y&&(N=s.measureText(this.ctx,(null==(N=a[S])?void 0:N.label)||"").width+12,k=this.calculateLabelHeight(y,N),w=this.calculateYOffset(y,k)/2,k=this.calculateRotatedWidth(y,N,s.fontSize/2),U=this.calculateXOffset(y,k,s));var N=(D=0===(D=L+a[S].pos*A)?10:D)+.5+U,k=(x?b-W.TICKSIZE-.5:i-C+W.TICKSIZE+.5)+(x?-w:w);this.ctx.save(),this.ctx.translate(N,k),this.ctx.rotate(y*(Math.PI/180)),this.ctx.fillText(a[S].label,0,0),this.ctx.restore()}v=!l[t].length||l[t].length&&h===l[t].length-1;s.displayTitle&&v&&(this.ctx.textBaseline="middle",this.ctx.font=s.titleFontSize+"px "+W.FONTFACE,O=this.api.getProperty("Xaxes."+t+W.PROP_WIDTH),d=void 0,d=i-C+17-(s.titleFontSize+(i-C-O))>s.titleFontSize+30?x?b-O+s.titleFontSize:i+g-C+O-s.titleFontSize+12:x?b-s.titleFontSize-15:i+g-C+s.titleFontSize+25,this.ctx.fillText(s.title,(e+T-o)/2,d)),this.margin=new V(T,P,o,M)},n.prototype.renderY=function(t,e,i,n,o,r,a){var s=this,l=this.y[t],h=this.yTicks[t],p=this.x.length&&_.some(this.x,function(t){return t.display}),u=this.x.filter(function(t){return"Top"===t.position&&t.display}),c=this.x.filter(function(t){return"Bottom"===t.position&&t.display}),d=(this.x.forEach(function(t,i){var e=a[i];e&&e.forEach(function(t,e){e=s.axisGroupClasses[i][e];e.display&&("Top"===e.position?u.push(e):"Bottom"===e.position&&c.push(e))})}),this.getHeight(c)),y=this.getHeight(u),g="Left"===l.position,f=this.y.filter(function(t){return"Left"===t.position&&t.display}),m=this.y.filter(function(t){return"Right"===t.position&&t.display}),P=this.getWidth(f)+("Left"===n?o:0),x=this.getWidth(m)+("Right"===n?o:0),v=x,p=Math.round(p?d:5)+this.legend.getRulesHeight()+("Bottom"===n?r:0),d=_.maxBy(h,function(t){return t.label.length}),d=l.measureText(this.ctx,(null==d?void 0:d.label)||""),y=y+(d.emHeightAscent||l.fontSize/2)+("Top"===n?r:0),r=this.getWidth(f.slice(f.indexOf(l)))+("Left"===n?o:0),v=g?v:this.getWidth(m.slice(m.indexOf(l)))+("Right"===n?o:0),O=this.calcTickWidth("Left")+("Left"===n?o:0),f=(O&&(f.length?P<O&&(P+=L=O-P,r+=L):P=O),this.calcTickWidth("Right")+("Right"===n?o:0)),T=(f&&(m.length?x<f&&(x+=L=f-x,v+=L):x=f),p=p||8,y=y||8,Math.floor(g?r:e-v+.5)+.5),R=i-p,b=R-y,C=this.getStepSize(h.length,null,l),O=(O=this.api.getProperty("Yaxes."+t+W.PROP_COLOR))||("Light"===this.theme?"#000000":"#ffffff");this.ctx.strokeStyle=O,this.ctx.fillStyle=O,this.ctx.beginPath();var o=y-("Top"===n?2:6),m=1+R,L=m-o;this.ctx.moveTo(T-1,o),this.ctx.lineTo(T-1,m);for(var A=0;A<h.length;A+=C){var E=Math.round(R-h[A].pos*b)+.5;this.ctx.moveTo(T-1,E),this.ctx.lineTo(g?T-W.TICKSIZE-1:T+W.TICKSIZE,E)}this.ctx.stroke(),this.ctx.closePath();var S=this.api.getProperty("Yaxes."+t+W.PROP_ROTATION);this.ctx.textBaseline="middle",this.ctx.textAlign="Left"===l.position?"right":"left",this.ctx.font=l.fontSize+"px "+W.FONTFACE;for(A=0;A<h.length;A+=C){E=R-h[A].pos*b+.5;this.ctx.save(),this.ctx.translate(g?T-W.TICKSIZE:T+W.TICKSIZE,E),this.ctx.rotate(S*(Math.PI/180)),this.ctx.fillText(h[A].label,0,0),this.ctx.restore()}l.displayTitle&&(this.ctx.textAlign="center",this.ctx.textBaseline="bottom",this.ctx.font=l.titleFontSize+"px "+W.FONTFACE,this.ctx.save(),f=void 0,r=this.api.getProperty("Yaxes."+t+W.PROP_WIDTH),f=T-d.width-(l.titleFontSize+(T-r)+2)<l.titleFontSize+2||!r?g?Math.abs(l.titleFontSize-T-2)-d.width:T+l.titleFontSize+d.width-2:g?Math.abs(l.titleFontSize+5+(T-r)):Math.abs(T+r)-l.titleFontSize-5,this.ctx.translate(f,(i-p+y)/2),this.ctx.rotate(g?-Math.PI/2:Math.PI/2),this.ctx.fillText(l.title,0,0),this.ctx.restore()),this.drawCurrentTickLabels(t,m,L,g,l,T),this.margin=new V(P,y,x,p)};var Zt=n;function n(t,e,i){this.api=t,this.canvas=e,this.legend=i,this.x=[],this.y=[],this.currentTickLabels={},this.currentTicksInit=!1,this.labelHeights=[],this.margin=new V(0,0,0,0),this.legendWidth=0,this.m=new V(0,0,0,0),this.xBounds=[],this.yBounds=[],this.renderAll=!0,this.xTicks=[],this.yTicks=[],this.axisGroupClasses=[];t=this.canvas.getContext("2d");if(!t)throw new Error("ChartGL: failed to get 2D context");this.ctx=t}P.prototype.clearRangeLines=function(t,e){this.zoomEnabled&&this.zoomEnabled===t&&!this.enableRangeSelection||(this.removeDragLine(),this.removeLines(),this.removeHandles(),_.isNil(t))||_.isNil(e)||(this.setZoomEnabled(t,e),t&&this.removeMask())},P.prototype.drawRangeLines=function(){var t,e,i,n,o,r,a;this.dragSelector||this.dragSelectorEdge||(this.zoomEnabled&&this.setZoomEnabled(!1,!0),this.clearRangeLines(!1,!0),this.bounds=this.el.getBoundingClientRect(),t=(e=this.bounds.width)*this.zoomRegion.x,e=1===this.zoomRegion.z?e-2:e*this.zoomRegion.z,i=(null==(i=this.downPoint)?void 0:i.y)||this.bounds.height/2,n=this.bounds.right-this.bounds.left,o=this.bounds.bottom-this.bounds.top,r=Math.max(.5+t,5),a=Math.min(.5+e,this.bounds.width-5),this.drawXLines(r,a,i,o),this.updateMask(n,o,t,e))},P.prototype.getZoomDirection=function(){return this.direction},P.prototype.isDragging=function(){return null!==this.dragBounds},P.prototype.isDraggingRange=function(){return this.dragSelector},P.prototype.remove=function(){this.el.removeEventListener("mousedown",this.mouseDownHandler),document.removeEventListener("mousemove",this.mouseOverHandler,{capture:!0}),document.removeEventListener("mouseup",this.mouseUpHandler,{capture:!0}),document.removeEventListener("mousemove",this.mouseMoveHandler,{capture:!0})},P.prototype.resize=function(t,e,i,n){this.el.style.left=t+"px",this.el.style.top=e+"px",this.el.style.width=i+"px",this.el.style.height=n+"px";t=this.el.getBoundingClientRect();this.zoomEnabled||_.isEqual(t,this.bounds)||!this.enableRangeSelection||this.drawRangeLines(),this.boundingClientRect=this.el.getBoundingClientRect()},P.prototype.getBoundingClientRect=function(){return this.boundingClientRect},P.prototype.updateRangeSelector=function(t){var e=Math.max(0,t.x),t=Math.min(1,t.y);this.zoomRegion=new V(e,0,t,1)},P.prototype.createMask=function(){var t=document.createElementNS(P.SVG_NS,"path");return this.el.getElementsByClassName("mask")[0].append(t),t},P.prototype.createDragLine=function(){var t=document.createElementNS(P.SVG_NS,"line");return this.zoomEnabled&&t.setAttribute("class","drag-line"),this.el.append(t),t.setAttribute("stroke-dasharray","8,4"),t},P.prototype.createLines=function(){var e=this;return _.times(2,function(){var t=document.createElementNS(P.SVG_NS,"line");return e.el.append(t),t})},P.prototype.createHandles=function(){var e=this;return _.times(2,function(){var t=document.createElementNS(P.SVG_NS,"rect");return t.style.fill="#ffffff",t.rx.baseVal.value=2,t.style.stroke="#6b6464",t.width.baseVal.value=8,t.height.baseVal.value=25,e.el.append(t),t})},P.prototype.createRect=function(){var t=document.createElementNS(P.SVG_NS,"rect");return t.style.fill="none",this.el.append(t),t},P.prototype.drawXLines=function(t,e,i,n){this.direction="x",this.dragLine=this.dragLine||this.createDragLine(),this.lines=this.lines||this.createLines(),this.removeRect(),this.dragLine.x1.baseVal.value=t,this.dragLine.y1.baseVal.value=i+.5,this.dragLine.x2.baseVal.value=e,this.dragLine.y2.baseVal.value=i+.5,this.lines[0].x1.baseVal.value=t,this.lines[0].y1.baseVal.value=0,this.lines[0].x2.baseVal.value=t,this.lines[0].y2.baseVal.value=n,this.lines[1].x1.baseVal.value=e,this.lines[1].y1.baseVal.value=0,this.lines[1].x2.baseVal.value=e,this.lines[1].y2.baseVal.value=n,this.enableRangeSelection&&(this.handles=this.handles||this.createHandles(),this.handles[0].x.baseVal.value=t-4,this.handles[0].y.baseVal.value=n/2-12.5,this.handles[1].x.baseVal.value=e-4,this.handles[1].y.baseVal.value=n/2-12.5)},P.prototype.onOverlayMouseDown=function(t){var e=document.getElementsByClassName("DomOutline_label");if(!e.length){if(0!==t.button)return this.onOverlayMouseUp(t);if(this.clickTime&&Date.now()-this.clickTime<325)return this.onOverlayMouseUp(t),this.zoomRegion=new V(0,0,1,1),this.removeMask(),this.drawRangeLines(),this.onReset();this.clickTime=Date.now(),this.bounds=this.el.getBoundingClientRect();var e=this.bounds.right-this.bounds.left,i=(X.limitWithin(t.clientX,this.bounds.left,this.bounds.right)-this.bounds.left)/e,n=this.handles&&t.target===this.handles[0],o=this.handles&&t.target===this.handles[1],i=i>this.zoomRegion.x&&i<=this.zoomRegion.z,o=n||o;this.edge=n?"left":"right",this.enableRangeSelection&&(i||o)?o?(this.dragSelectorEdge=!0,this.dragSelector=!1,this.downPoint=new Y(t.clientX-this.bounds.left,this.bounds.height/2)):i&&(this.dragSelectorEdge=!1,this.dragSelector=!0,this.downPoint||(this.downPoint=new Y(this.zoomRegion.x*e,this.bounds.height/2))):(this.dragSelector=!1,this.dragSelectorEdge=!1),this.downPoint=new Y(t.clientX-this.bounds.left,this.enableRangeSelection?this.bounds.height/2:t.clientY-this.bounds.top),document.body.style["pointer-events"]="none",document.addEventListener("mouseup",this.mouseUpHandler,{capture:!0}),document.addEventListener("mousemove",this.mouseMoveHandler,{capture:!0}),t.preventDefault(),t.stopPropagation()}},P.prototype.onOverlayMouseMove=function(t){if(t.stopPropagation(),this.bounds&&this.downPoint&&(this.zoomEnabled||this.enableRangeSelection)){var e,i=this.bounds.right-this.bounds.left,n=this.bounds.bottom-this.bounds.top,o=X.limitWithin(t.clientX,this.bounds.left,this.bounds.right)-this.bounds.left,r=X.limitWithin(t.clientY,this.bounds.top,this.bounds.bottom)-this.bounds.top,a=Math.min(this.downPoint.x,o),s=Math.min(this.downPoint.y,r),l=Math.abs(this.downPoint.x-o),h=Math.abs(this.downPoint.y-r),t=((t=e=e||{})[t.XY=0]="XY",t[t.X=1]="X",t[t.Y=2]="Y",e.XY);switch(this.enableRangeSelection?t=e.X:l<P.SNAP_SZ&&h<P.SNAP_SZ?((p=l/h)<P.ASPECT_RATIO||1/P.ASPECT_RATIO<p)&&(t=p<1?e.Y:e.X):l<P.SNAP_SZ?t=e.Y:h<P.SNAP_SZ&&(t=e.X),t){case e.X:s=0,h=n;break;case e.Y:a=0,l=i}if(this.enableRangeSelection&&(this.dragSelector||this.dragSelectorEdge)){if(!this.dragBounds||!this.prevDragVal)return p=this.zoomRegion.x*i,u=this.zoomRegion.z*i,this.dragBounds=new V(p,0,u,1),void(this.prevDragVal=o);var p=o-this.prevDragVal,u=p,c=p;if(this.dragSelectorEdge){if("left"===this.edge){if(c=0,o>this.dragBounds.z)return}else if(u=0,o<this.dragBounds.x)return}else this.dragSelector&&(this.dragBounds.x+u<=0||this.dragBounds.z+c>=this.bounds.width)&&(u=c=0);var d=this.dragBounds.x+u,y=this.dragBounds.z+c;this.dragBounds=new V(d,s,y,s+h),this.updateRangeSelector(new Y(this.zoomRegion.x+u/i,this.zoomRegion.z+c/i)),this.downPoint=new Y(this.downPoint.x+p,this.downPoint.y),this.prevDragVal=o,o=this.dragBounds.z,this.onZoom(this.zoomRegion)}else this.dragBounds=new V(a,s,a+l,s+h);d=X.calculateBoundsDiagonal(this.dragBounds);if(0<d||this.dragSelector?((this.dragSelector||this.dragSelectorEdge)&&(a=this.dragBounds.x,l=Math.abs(this.dragBounds.x-o)),this.mask=this.mask||this.createMask(),this.mask.setAttribute("d","M0,0H"+i+"V"+n+"H0V0M"+(Math.round(a)+.5)+","+(Math.round(s)+.5)+"v"+h+"h"+l+"v-"+h+"h-"+l+"Z")):this.zoomEnabled&&this.removeMask(),15<d)switch(this.dragLine=this.dragLine||this.createDragLine(),t){case e.X:var g,f=this.downPoint.x+.5,m=o+.5;this.enableRangeSelection&&(g=this.dragSelectorEdge||this.dragSelector?this.dragBounds.x+.5:f,f=Math.max(g,5),m=Math.min(m,this.bounds.width-5)),this.drawXLines(f,m,this.downPoint.y,n);break;case e.Y:this.direction="y",this.lines=this.lines||this.createLines(),this.removeRect(),this.dragLine.x1.baseVal.value=this.downPoint.x+.5,this.dragLine.y1.baseVal.value=this.downPoint.y+.5,this.dragLine.x2.baseVal.value=this.downPoint.x+.5,this.dragLine.y2.baseVal.value=.5+r,this.lines[0].x1.baseVal.value=0,this.lines[0].y1.baseVal.value=this.downPoint.y+.5,this.lines[0].x2.baseVal.value=i,this.lines[0].y2.baseVal.value=this.downPoint.y+.5,this.lines[1].x1.baseVal.value=0,this.lines[1].y1.baseVal.value=.5+r,this.lines[1].x2.baseVal.value=i,this.lines[1].y2.baseVal.value=.5+r;break;default:this.direction="xy",this.rectangle=this.rectangle||this.createRect(),this.removeLines(),this.dragLine.x1.baseVal.value=this.downPoint.x+.5,this.dragLine.y1.baseVal.value=this.downPoint.y+.5,this.dragLine.x2.baseVal.value=o+.5,this.dragLine.y2.baseVal.value=.5+r,this.rectangle.x.baseVal.value=this.downPoint.x<o?this.downPoint.x+.5:o+.5,this.rectangle.y.baseVal.value=this.downPoint.y<r?this.downPoint.y+.5:.5+r,this.rectangle.width.baseVal.value=l,this.rectangle.height.baseVal.value=h}else this.removeDragLine(),this.removeLines(),this.removeRect(),this.removeHandles()}},P.prototype.onOverlayMouseOver=function(t){var e=this.el.getBoundingClientRect();if(document.elementFromPoint(t.clientX,t.clientY)!==this.el||t.clientX<e.left||t.clientX>e.right||t.clientY<e.top||t.clientY>e.bottom)return this.onOver(null);var i=t.clientX-e.left,n=t.clientY-e.top;this.dragSelectorEdge||(!this.handles||t.target!==this.handles[0]&&t.target!==this.handles[1]?document.body.style.cursor="default":document.body.style.cursor="e-resize"),this.onOver(new Y(i/(e.right-e.left),n/(e.top-e.bottom)))},P.prototype.onOverlayMouseUp=function(t){var e;this.bounds&&(document.body.style["pointer-events"]="auto",document.removeEventListener("mouseup",this.mouseUpHandler,{capture:!0}),document.removeEventListener("mousemove",this.mouseMoveHandler,{capture:!0}),t.stopPropagation(),this.dragBounds&&X.calculateBoundsDiagonal(this.dragBounds)>P.SNAP_SZ/3?(t=this.bounds.right-this.bounds.left,this.zoomEnabled?(e=this.bounds.bottom-this.bounds.top,this.zoomRegion=new V(this.dragBounds.x/t,this.dragBounds.y/e,this.dragBounds.z/t,this.dragBounds.w/e)):this.updateRangeSelector(new Y(this.dragBounds.x/t,this.dragBounds.z/t)),this.onZoom(this.zoomRegion)):this.onClick(),this.downPoint=void 0,this.prevDragVal=null,this.dragSelector=!1,this.dragSelectorEdge=!1,document.body.style.cursor="default",this.zoomEnabled&&(this.removeMask(),this.removeDragLine(),this.removeLines(),this.removeRect()),this.dragBounds=null)},P.prototype.removeDragLine=function(){this.dragLine&&this.el.removeChild(this.dragLine),this.dragLine=void 0},P.prototype.removeHandles=function(){var e=this;this.handles&&this.handles.forEach(function(t){return e.el.removeChild(t)}),this.handles=void 0},P.prototype.removeLines=function(){var e=this;this.lines&&this.lines.forEach(function(t){return e.el.removeChild(t)}),this.lines=void 0},P.prototype.removeRect=function(){this.rectangle&&this.el.removeChild(this.rectangle),this.rectangle=void 0},P.prototype.removeMask=function(){var t=this.el.getElementsByClassName("mask")[0];this.mask&&t.removeChild(this.mask),this.mask=void 0},P.prototype.setZoomEnabled=function(t,e){this.zoomEnabled=!e&&t,this.enableRangeSelection=e,this.zoomEnabled?this.el.classList.remove("range-selection"):this.el.classList.add("range-selection")},P.prototype.updateMask=function(t,e,i,n){var o=i,i=Math.abs(i-n),n=e;this.mask=this.mask||this.createMask(),this.mask.setAttribute("d","M0,0H"+t+"V"+e+"H0V0M"+(Math.round(o)+.5)+","+(Math.round(0)+.5)+"v"+n+"h"+i+"v-"+n+"h-"+i+"Z")},P.SVG_NS="http://www.w3.org/2000/svg",P.SNAP_SZ=28,P.ASPECT_RATIO=.45;var qt=P;function P(t,e,i,n,o){this.direction="",this.dragBounds=null,this.dragSelector=!1,this.dragSelectorEdge=!1,this.edge="",this.enableRangeSelection=!1,this.prevDragVal=null,this.zoomEnabled=!0,this.zoomRegion=new V(0,0,1,1),this.el=t,this.onOver=e,this.onZoom=i,this.onReset=n,this.onClick=o,this.mouseDownHandler=this.onOverlayMouseDown.bind(this),this.mouseUpHandler=this.onOverlayMouseUp.bind(this),this.mouseMoveHandler=this.onOverlayMouseMove.bind(this),this.mouseOverHandler=this.onOverlayMouseOver.bind(this),this.el.addEventListener("mousedown",this.mouseDownHandler),document.addEventListener("mousemove",this.mouseOverHandler,{capture:!0})}jt.convertToNumArr=function(t,e,i){for(var n=jt.getScalarData(t,t.qtype),o=n.scalar,r=n.nullVal,a=null!=i&&i.length?i:Array(t.length),s=e===G.Bounds,l=e===G.Line||e===G.LineFill,h=null!=i&&i.length?i.length:0;h<t.length;h++){var p=o(t,h);"bigint"==typeof(p=!s&&X.isNull(p,r)?l?NaN:0:p)&&(p=Number(p)),a[h]=p}return a},jt.getScalarData=function(t,e){var i,n,o,r,a,s=X.isLong(e)&&t.hash&&"bigint"==typeof t.hash(0);t.getRange&&t.qtype&&(o=X.getRange(t),i=X.getMidrange(new Y(o[0],o[1]),t.qtype));return n=t,o=e,r=s,t=X.getNullVal(o),a=X.isString(o)?function(t,e){return X.getColScalar(n,e)}:X.isLong(o)?function(t,e){return r?n.getScalar(e):(e=n.getLegacyScalar(e),X.isNull(e)?e.toString():X.toBigInt(e))}:function(t,e){return Number(n.getScalar(e))},{scalar:function(t,e){t=a(t,e);return i?X.toBigInt(t)-i:t},nullVal:t}},jt.convertSteppedData=function(t,e,i){i="Before"===i.steppedLine;return"x"===e?i?ot.drawSteppedXLine(t):ot.drawSteppedYLine(t):"y"===e?i?ot.drawSteppedYLine(t):ot.drawSteppedXLine(t):t},jt.convertXToFloatArr=function(t,e){if(jt.isDoubleOrLongTemporal(e)){for(var i=new Float32Array(2*t.length),n=0,o=0;o<i.length;o+=2){var r=t[n++];i[o]=r,i[o+1]=r-Math.fround(r)}return i}return new Float32Array(t)},jt.convertYToFloatArr=function(o,t,r){var a=new Float32Array(0);return _.each(t,function(t){if(jt.isDoubleOrLongTemporal(t)&&!r){a=new Float32Array(2*o.length);for(var e=0,i=0;i<a.length;i+=2){var n=o[e++];a[i]=n,a[i+1]=n-Math.fround(n)}}}),a.length?a:new Float32Array(o)},jt.getBoundsData=function(t){var e=t.x1,i=t.x2,e=jt.convertToNumArr(e,G.Bounds),i=jt.convertToNumArr(i,G.Bounds);return J.drawXBounds(e,i,t.palette,t.opacity)},jt.getSpanGapsInfo=function(t,e,i){return t===W.TYPE_CATEGORY?{col:i,scalar:function(t,e){return t[e]}}:{col:e,scalar:(t=jt.getScalarData(e,e.qtype)).scalar,nullVal:t.nullVal}},jt.isDoubleOrLongTemporal=function(t){return t===E.DateTime||t===E.Timestamp||t===E.Timespan},jt.isFloatType=function(t,e,i,n){var o=t===G.Bounds,r=t===G.Heatmap,a=t===G.Bar||t===G.Waterfall,s=t===G.Candlestick,t=t===G.Line&&(e.lineStyle===I.Dotted||e.lineStyle===I.Dashed),i=i&&i[0],i=!(!i||!i.fill||"No Fill"===i.fill);return a&&void 0!==e.barWidth||r||i||e.useThickLines||t||s||o||!n&&e.spanGaps||!n&&e.interpolation===et.Stepped},jt.hasAxisTransformations=function(t,e){return e||t===W.TYPE_CATEGORY||t===W.TYPE_LOGARITHMIC},jt.dataHasNoTransformations=function(t,e,i){var n=t===G.Line,o=t===G.LineBubble,r=e.lineFill,r=t===G.LineFill&&(null==r?void 0:r.fill),a=(n||r||o)&&e.spanGaps&&e.xCol,s=e.lineStyle===I.Dotted||e.lineStyle===I.Dashed,n=(n||r||o)&&e.interpolation===et.Stepped,s=e.useThickLines||e.spanGaps||s||n||r;return t===G.Candlestick||t===G.Heatmap||e.calcXLineData||t===G.Baseline||(t===G.Bubble||t===G.Line&&!s||o&&!n&&!a)&&!i};var x=jt;function jt(){}o.prototype.setup=function(t,e){this.tx=t,this.tys=e,this.catmullPoints=[],this.segmentLength=[],this.stackedYData=[],this.waterfallColors=[],this.yCategoryData=[[],[],[]]},o.prototype.setBarWidth=function(t){this.barWidth=t},o.prototype.setColData=function(t,e){t&&(this.xColData=t),e&&(this.yColsData=e)},o.prototype.getBarWidth=function(){return this.barWidth},o.prototype.getBevelIndices=function(){return this.bevelIndices},o.prototype.getBoundsColors=function(){return this.boundsColors},o.prototype.getCategoryData=function(t){return"x"===t?this.xCategoryData:this.yCategoryData},o.prototype.getCatmullPoints=function(){return this.catmullPoints},o.prototype.getCatmullPointsAndSegLength=function(){return[this.catmullPoints,this.segmentLength]},o.prototype.getColData=function(){return[this.xColData,this.yColsData]},o.prototype.getMaxDist=function(){return this.maxDistFromX},o.prototype.getSegmentLength=function(){return this.segmentLength},o.prototype.getStackedXData=function(){return this.stackedXData},o.prototype.getStackedYData=function(){return this.stackedYData},o.prototype.getTriggerBounds=function(t){return this.smartAxis.getTriggerBounds(t)},o.prototype.getTriggerData=function(t){return this.smartAxis.getTriggerData(t)},o.prototype.getTriggerIntervals=function(t){return this.smartAxis.getTriggerIntervals(t)},o.prototype.getWaterfallColors=function(){return this.waterfallColors},o.prototype.getXBorderWidths=function(){return this.xBorderWidths},o.prototype.getYBorderWidths=function(){return this.yBorderWidths},o.prototype.performDataConversions=function(t,e,i,n,o,r){var a,s=this,l=(n===G.Bar||n===G.Waterfall)&&void 0!==o.barWidth&&o.orientation===H.BAR_HORIZONTAL?"x"===e?"y":"x":e,h=this.convertData(t,l,i,n,o,r),p=h.adata,u=h.convertedData,c=h.isTriggerBreak,d=this.axisTypes[l],d=x.hasAxisTransformations(d,c);return this.dataCache.setDataCache(l,i,t,h.adata),x.dataHasNoTransformations(n,o,d)?(this.useLabels&&!o.calcXLineData&&this.setLabels(u,l,t,n,i),(d={})[l]={adata:p,convertedData:u},d):(a=this.performGeometryTransformations(t,n,o,h.adata,h.convertedData,e,i,c,r),this.useLabels&&Object.keys(a).forEach(function(t){var e;null!==a[t]&&(e=a[t],s.setLabels(e.convertedData,t,e.col,n,i))}),a)},o.prototype.convertData=function(t,e,i,n,o,r){var a=t.qtype;!this.isWebGL2&&X.isInt(a)&&(l=X.intToFloat(t),a=E.Float);var s=(n===G.Bar||n===G.Waterfall)&&void 0!==o.barWidth&&o.orientation===H.BAR_HORIZONTAL,l=this.applyAxisTypeConversions(t,l,e,s,o,n,r,i,a);return this.convertAllData(n,o,l.adata,l.convertedData,t,e,i,l.isTriggerBreak)},o.prototype.convertAllData=function(t,e,i,n,o,r,a,s){var l=t===G.Bounds,h=t===G.Line,p=t===G.LineBubble,u=t===G.LineFill,c=t===G.Baseline,h=h||u||p,d=h&&e.interpolation===et.Stepped,h=h&&e.spanGaps&&e.xCol,y=t===G.Line&&(e.lineStyle===I.Dotted||e.lineStyle===I.Dashed),y=e.useThickLines||h||y||d||u,u=t===G.Bubble||""===t,g=this.axisTypes[r],g=x.hasAxisTransformations(g,s),f=(t===G.Bar||t===G.Waterfall)&&void 0!==e.barWidth&&e.orientation===H.BAR_HORIZONTAL,m="y"===r&&void 0!==a?this.dataCache.getDataCache("y",a):this.dataCache.getDataCache("x",a);return(u||t===G.Line&&!y||p&&!d&&!h)&&!g?this.convertDataWithNoTransformations(i,o,n,m):c&&e.baselineInfo?this.convertBaselineData(e,i,r,n):(l?(i=(u=x.getBoundsData(e))[0],this.xColData=u[1],this.boundsColors=u[2]):g&&(!e.calcXLineData||null!=i&&i.length)||(i=n=this.convertToNumArr(o,t,r,a),y=f?"x"===r?"y":"x":r,null!=(p=e.stacked)&&p.includes("y")&&"x"===y&&(this.stackedXData=n)),{adata:i,convertedData:n,isTriggerBreak:s})},o.prototype.performGeometryTransformations=function(t,e,i,n,o,r,a,s,l){var h=(e===G.Bar||e===G.Waterfall)&&void 0!==i.barWidth,p=h&&i.orientation===H.BAR_HORIZONTAL,u=i.xLineData;return h?n=this.calcBarsTransformations(r,p,i,a,n,s):(n=(h=this.calcLineTransformations(e,i,n,u,o,t,l,r,a))[0],u=h[1],o=h[2]),this.convertDataToFloatArr(n,r,i,u,o,t,e)},o.prototype.convertDataWithNoTransformations=function(t,e,i,n){var o=e.qtype;return{adata:t=X.isString(o)?[]:X.isDouble(o)?X.floatToEmulateDoubleArray(e,n):X.isLong(o)?X.longToEmulateDoubleArray(e,n):t||e.toTypedArray(),convertedData:i}},o.prototype.convertToCategoryAxis=function(t,e,i,n,o,r,a){return this.axisTypes[n]===W.TYPE_CATEGORY&&(e=(t=X.getCategoryData(t,a,r.filterUnique[n],r.sortedAxis[n],r))[1],a===G.Heatmap&&(a!==G.Heatmap||"x1"!==r.key&&"y1"!==r.key)||("x"===n?this.xCategoryData=t:"y"===n&&(this.yCategoryData[0].push(t[0]),this.yCategoryData[1].push(e),this.yCategoryData[2].push(t[2])),(o&&"y"===n||!o&&"x"===n)&&null!=(a=r.stacked)&&a.includes("y")&&(this.stackedXData=t[0])),this.useLabels)&&(i="x"===n?t[1]:e),[e,i]},o.prototype.convertLogarithmicData=function(t){for(var e=t.length,i=new Float32Array(e),n=0;n<e;n++){var o=X.getColScalar(t,n);i[n]=Math.log10(Number(o))}return i},o.prototype.applyAxisTypeConversions=function(t,e,i,n,o,r,a,s,l){var h,p=a?a[i]:{},p=(null==p?void 0:p.breakVal)&&(null==p?void 0:p.triggerBreak)&&!o.spanGaps,n=this.convertToCategoryAxis(t,e,h,i,n,o,r);return e=n[0],h=n[1],a&&(n=this.dataCache.getDataCache(i,s),e=(s=this.smartAxis.convertTriggerBreak(a,o,r,t,i,h,e,l,n))[0],h=s[1],p=s[2]),this.axisTypes[i]===W.TYPE_LOGARITHMIC&&(h=e=this.convertLogarithmicData(t)),{adata:e,convertedData:h,isTriggerBreak:p}},o.prototype.convertBaselineData=function(t,e,i,n){var t=t.baselineInfo.scalarVal,o=[Number(t),Number(t)];return{adata:"x"===i?x.convertXToFloatArr(o,this.tx):x.convertYToFloatArr(o,this.tys,this.boundsColors),convertedData:[t]}},o.prototype.convertSpanGapsData=function(t,e,i,n,o,r){var a=t.xCol,a=x.getSpanGapsInfo(this.axisTypes.x,a,t.xLineData),n=x.getSpanGapsInfo(this.axisTypes.y,e,n),o=o&&"Origin"!==(null==r?void 0:r.fill),r=ot.getSpanGaps(a,n),n=r.x,s=r.y,i=this.smartAxis.applyTriggerBreakForLines(i,t,n,s,e),n=i[0],s=i[1];return[o?ot.spanGapsForLineFill(n,s,r.indices,a):ot.spanGaps(n,s,r.indices,a),[n,s]]},o.prototype.calcLineTransformations=function(t,e,i,n,o,r,a,s,l){var h,p=t===G.Line,u=t===G.LineBubble,c=e.lineFill,d=t===G.LineFill&&(null==c?void 0:c.fill),y=t===G.Line&&!e.useThickLines,g=t===G.Line&&(e.lineStyle===I.Dotted||e.lineStyle===I.Dashed),f=(p||d||u)&&e.interpolation===et.Stepped,p=(p||d||u)&&e.spanGaps&&e.xCol;return p&&(n=(h=(u=this.convertSpanGapsData(e,r,a,i,d,c))[0]).x,i=h.y,o=u[1]),f&&(t===G.LineBubble||y||d)&&(i=i||this.convertToNumArr(r,t,s,l),i=x.convertSteppedData(i,s,e),p||g||d)&&(n=x.convertSteppedData(n,"x",e)),g&&y&&(c=e.xCol,u={zoom:null==a?void 0:a.zoom,xType:c.qtype,yType:r.qtype,triggerData:this.smartAxis.getAllTriggerData()},n=(f=ot.drawLine(i,n,e,u))[0],i=f[1],this.updateCountVal(n.length)),d?(i=(h=this.calcLineFillTransformations(e,l,i,t,s,o,n))[0],n=h[1],o=h[2]):t===G.Line&&e.lineThickness&&!y&&(i=(h=this.calcLineThicknessTransformations(e,i,t,n,a,o,r))[0],n=h[1],o=h[2]),[i,n,o]},o.prototype.calcLineFillTransformations=function(t,e,i,n,o,r,a){var s=n===G.Line,l=n===G.LineBubble,h=t.lineFill,n=n===G.LineFill&&(null==h?void 0:h.fill),s=(s||n||l)&&t.interpolation===et.Stepped,n=t.interpolation===et.Monotone&&t.catmullPoints&&t.catmullPoints[0];return a&&"Linear"===t.interpolation&&(a=(l=ot.fixOverlappingNegativeYData(a,i))[0],i=l[1]),a=n?(l=t.catmullPoints[0][e],i="x"===o?l.map(function(t){return t.x}):l.map(function(t){return t.y}),i="x"===o?ot.getXLineFill(i):ot.getYLineFill(i,h,!1),n=l.map(function(t){return t.x}),ot.getXLineFill(n)):(e=t.steppedLine,i="x"===o?ot.getXLineFill(i):ot.getYLineFill(i,h,s,e),ot.getXLineFill(a)),this.updateCountVal(i.length),[i,a,r]},o.prototype.calcLineThicknessTransformations=function(t,e,i,n,o,r,a){var s=t.xCol,l=i===G.Line,h=i===G.LineBubble,p=t.lineFill,i=i===G.LineFill&&(null==p?void 0:p.fill),p=(l||i||h)&&t.interpolation===et.Stepped,l=(l||i||h)&&t.spanGaps&&t.xCol,i=Array.from(n),h=Array.from(e),l=(l||(r=[i,h]),p&&(i=x.convertSteppedData(i,"x",t),h=x.convertSteppedData(h,"y",t)),{zoom:o.zoom,xType:s.qtype,yType:a.qtype,triggerData:this.smartAxis.getAllTriggerData()}),p=ot.drawLine(h,i,t,l);return this.updateCountVal(p[0].length),n=p[0],e=p[1],this.bevelIndices=p[2],null!=(o=p[3])&&o.length&&(this.catmullPoints.push(p[3]),this.segmentLength.push(p[4])),[e,n,r]},o.prototype.calcBarsTransformations=function(t,e,i,n,o,r){var a=new J,s=[],l=X.convertVec4ToScalar(i.mergedBounds,e?this.tys[0]:this.tx,e?this.tx:this.tys[0]),h=i.viewBounds?X.convertVec4ToScalar(i.viewBounds,e?this.tys[0]:this.tx,e?this.tx:this.tys[0]):new V(0,0,1,1);if(e&&(l=new V(l.y,l.x,l.w,l.z),i.viewBounds)&&(h=new V(h.y,h.x,h.w,h.z)),"x"===t||"y"===t&&e){var p=-1!==i.stacked.indexOf(t);if(!i.mergedBounds)throw"Missing merged";if("Fixed Width"===i.barType&&void 0===(null==(c=i.size)?void 0:c.x))throw"Missing width";var u,c=e&&void 0!==n&&"x"===t?this.tys[n]:this.tx;"y"===t&&e&&p?(u={prevLayerData:n?this.stackedYDataObj:null==(u=null==i?void 0:i.barGrouping)?void 0:u.stacked,xData:this.stackedXData,stackedGapSize:i.stackedGapSize},s=a.getXBarPoints(o,i,l,p,t,c,n,u)):(r&&(r=this.getTriggerBounds(t),l=new V(r.x,l.y,r.y,l.w)),s=a.getXBarPoints(o,i,l,p,t,c,n),"x"===t&&(this.setBarWidth(a.getBarWidth()),this.maxDistFromX=a.getMaxDist())),"y"===t&&e?this.yBorderWidths=a.getYBorderWidth(o,i,h):this.xBorderWidths=a.getXBorderWidth(o,i,h)}else i.waterfallInfo?(s=(r=a.getWaterfallPoints(o,i.waterfallInfo,n||0))[0],this.waterfallColors.push(r[1])):(u=void 0,null!=(l=null==i?void 0:i.stacked)&&l.includes("y")&&(u={prevLayerData:n?this.stackedYDataObj:null==(p=null==i?void 0:i.barGrouping)?void 0:p.stacked,xData:this.stackedXData,stackedGapSize:i.stackedGapSize}),s=a.getYBarPoints(o,u)),this.yBorderWidths=a.getYBorderWidth(o,i,h);return"y"===t&&null!=(c=null==i?void 0:i.stacked)&&c.includes("y")&&(e=this.getStackedXData(),r=a.getStackedYVals(),this.stackedYData.push(r),this.stackedYDataObj=X.getStackedData(e,r,this.stackedYDataObj)),o=s.length?s:o},o.prototype.convertDataToFloatArr=function(t,e,i,n,o,r,a){var s=a===G.Line&&(i.lineStyle===I.Dotted||i.lineStyle===I.Dashed),a=a===G.LineFill&&(null==(a=i.lineFill)?void 0:a.fill),s=i.useThickLines||i.spanGaps||s||a,a=s&&o?o[0]:n,l=s&&o?o[1]:o;return t="x"===e||"y"===e&&i.orientation===H.BAR_HORIZONTAL?x.convertXToFloatArr(t,this.tx):x.convertYToFloatArr(t,this.tys,this.boundsColors),s&&(n=x.convertXToFloatArr(n,this.tx)),{x:"x"===e?{adata:t,convertedData:o,col:r}:i.xLineData?{adata:n,convertedData:a,col:i.xCol}:null,y:"y"===e?{adata:t,convertedData:l,col:r}:null}},o.prototype.convertToNumArr=function(t,e,i,n){i=this.dataCache.getDataCache(i,n);return x.convertToNumArr(t,e,i)},o.prototype.setLabels=function(t,e,i,n,o){t=t||this.convertToNumArr(i,n,e,o),"x"===e&&n!==G.Bounds?this.xColData=t:"y"===e&&this.yColsData.push(t)};var Jt=o;function o(t,e,i,n,o,r,a){this.tx=t,this.tys=e,this.isWebGL2=i,this.axisTypes=n,this.useLabels=o,this.dataCache=r,this.updateCountVal=a,this.barWidth=0,this.bevelIndices=[],this.maxDistFromX=0,this.stackedYData=[],this.stackedYDataObj={},this.stackedXData=[],this.waterfallColors=[],this.yCategoryData=[[],[],[]],this.yColsData=[],this.catmullPoints=[],this.segmentLength=[],this.yColsData=[],this.smartAxis=new rt}a.prototype.getBarWidth=function(){return this.dataConversions.getBarWidth()},a.prototype.getCategoryData=function(t){return this.dataConversions.getCategoryData(t)},a.prototype.getCatmullPoints=function(){return this.dataConversions.getCatmullPointsAndSegLength()},a.prototype.getCols=function(){return this.dataConversions.getColData()},a.prototype.getDataCache=function(t,e){return this.dataCache.getDataCache(t,e)},a.prototype.getMaxDist=function(){return this.dataConversions.getMaxDist()},a.prototype.getStackedXData=function(){return this.dataConversions.getStackedXData()},a.prototype.getStackedYData=function(){return this.dataConversions.getStackedYData()},a.prototype.getTriggerBounds=function(t){return this.dataConversions.getTriggerBounds(t)},a.prototype.getTriggerData=function(t){return this.dataConversions.getTriggerData(t)},a.prototype.getTriggerIntervals=function(t){return this.dataConversions.getTriggerIntervals(t)},a.prototype.updateCountVal=function(t){this.count=t},a.prototype.setCols=function(t,e,i,n){this.yCols=e,this.xCol=i===G.Bounds?n.x1:t},a.prototype.setDataTypes=function(t,e,i,n,o){var r,a,s;t===G.Baseline&&e.baselineInfo?(this.tx=E.Float,this.tys=[E.Float],r=e.baselineInfo.axis,(a=e.baselineInfo.type)&&("x"===r?this.tx=a:this.tys=[a])):t===G.Bounds?(this.tx=e.x1.qtype,this.tys=[e.yType]):(this.tx=(s=function(t){return t===W.TYPE_CATEGORY||t===W.TYPE_LOGARITHMIC})(i.x)?E.Float:o.qtype,this.tys=n.map(function(t){return s(i.y)?E.Float:t.qtype})),this.isWebGL2||(X.isInt(this.tx)&&(this.tx=E.Float),this.tys=this.tys.map(function(t){return X.isInt(t)?E.Float:t}))},a.prototype.setColLength=function(t){null!==this.cacheData?this.colLength=t.length:this.colLength&&(this.colLength=0)},a.prototype.setCount=function(t,e,i,n){t===G.Baseline&&e.baselineInfo?this.count=2:(this.count=Math.min(i.length,_.max(n.map(function(t){return t.length}))||0),e.interpolation===et.Stepped?this.count*=2:t===G.Heatmap&&(this.count*=2,this.axisTypes.x!==W.TYPE_CATEGORY&&(this.tx=e.x1.qtype),this.axisTypes.y!==W.TYPE_CATEGORY)&&(this.tys=[e.y1.qtype]))},a.prototype.setUpLayerData=function(t,e,i,n,o,r,a,s){this.dataCache.setCacheValue(e);e=t.interpolation===et.Stepped;this.setCols(i,n,o,t),this.setRadiusInfo(r,s,e),this.setBorder(t,i),this.setDataIcon(a),this.setupShaders(o,n),this.setCount(o,t,i,n),this.dataConversions.setup(this.tx,this.tys)},a.prototype.processDataByLayerType=function(t,e,i,n,o,r,a,s,l,h){var p,u=this.calcXType(),c=e.mergedBounds;t===G.Candlestick&&c&&null!=(p=e.size)&&p.x?this.processCandlesticks(n,i,e,h):t===G.Heatmap?this.processHeatmapData(e,s):t===G.Baseline&&e.baselineInfo||t===G.Bounds&&e.x1&&e.x2&&e.yRange?this.processBaselineOrBounds(t,e,i,n,h):this.processDataStandard(t,e,n,i,o,a,s,l,r,h),t===G.Waterfall?null!=(p=this.dataConversions.getWaterfallColors())&&p.length&&this.setColorArray(!1,!0,p,!1):(p=x.isFloatType(t,e,r,!0),this.setUpColors(r,a,s,l,t,p,e)),this.createShaders(t,e,r,h,c,n,i,u,o),this.setColLength(i)},a.prototype.createShaders=function(t,o,e,r,i,n,a,s,l){var h=this,p=x.isFloatType(t,o,e,!1),u=x.isDoubleOrLongTemporal(this.tx),c=o.textures&&Object.keys(o.textures).length;if(t===G.Heatmap)this.createShader(E.Float,E.Float,!1,!1,0);else if(t===G.Baseline&&o.baselineInfo||t===G.Bounds&&o.x1&&o.x2&&o.yRange){var e=t===G.Baseline,d=null!=(d=o.x1)&&d.qtype?o.x1.qtype:this.tx,d=!x.isDoubleOrLongTemporal(d)||r.x?E.Float:d,y=r.y||!e?E.Float:this.tys[0];this.createShader(d,y,!1,!1,0)}else if(t===G.Candlestick&&i&&null!=(e=o.size)&&e.x){var g=n.map(function(t){return t.qtype}).map(function(t){return X.isInt(t)?E.Float:t}),f=x.isDoubleOrLongTemporal(g[0]);this.processCandlesticks(n,a,o,r);for(var m=0;m<this.shaders.length;m++){y=f?g[0]:E.Float;this.createShader(s,y,l,!1,m,0===m,this.colorBuffers[0])}}else n.forEach(function(t,e){var i=x.isDoubleOrLongTemporal(h.tys[e]),n=!p&&!r.x||u?h.tx:E.Float,i=!p&&!r.y||i?h.tys[e]:E.Float;h.createShader(o.orientation===H.BAR_HORIZONTAL?i:n,o.orientation===H.BAR_HORIZONTAL?n:i,l,c,e)})},a.prototype.processDataStandard=function(t,e,i,n,o,r,a,s,l,h){var p=e.lineStyle===I.Dotted||e.lineStyle===I.Dashed,u=(this.lineStyleCounts=[],this.yBorderWidthsBuffers=[],t===G.LineFill&&(null==(u=e.lineFill)?void 0:u.fill));e.useThickLines||e.spanGaps||p||u||(this.createXBuffer(t,e,n,i,h),0<e.borderWidth&&(p=this.dataConversions.getXBorderWidths(),this.xBorderWidthsBuffer=D.createBuffer(this.gl,p))),this.createYBuffers(t,e,i,h)},a.prototype.processCandlesticks=function(t,e,a,i){var s,l=this,n=[],h=(t.forEach(function(t,e){t=l.dataConversions.performDataConversions(t,"y",0,G.Candlestick,a,i);n[e]=t.y.adata}),X.convertVec4ToScalar(a.mergedBounds,this.tx,this.tys[0])),t=[n[1],n[2]],o=[n[0],n[3]],p=new J,u=this.dataConversions.performDataConversions(e,"x",0,G.Candlestick,a,i).x.adata,c=[],d=a.widthType,y=[];[t,o].forEach(function(t,e){var i=0===e,n=i?a.bodyWidth/10:a.bodyWidth,o=i?void 0:a,r=Math.abs(Number(h.w)-Number(h.y))||0,r=p.getCandlesticks(t,r,o),o=(i||(c=r[1]),A(A({},a),{barType:d,barWidth:n})),n=(l.buffers[e]=D.createBuffer(l.gl,x.convertXToFloatArr(p.getXBarPoints(u,o,h,!1,"x",l.tx),l.tx)),l.buffers[e+2]=D.createBuffer(l.gl,new Float32Array(r[0])),i&&l.useLabels&&(s=u,y.push(t[0])),p.getBarWidth());n>l.barWidth&&l.dataConversions.setBarWidth(n)}),c.length&&this.setColorArray(!1,!0,[c],!1),this.useLabels&&this.dataConversions.setColData(s,y)},a.prototype.processHeatmapData=function(o,t){var r=this,a={},e=(Object.keys(o).forEach(function(t,e){var i=o[t],n="score"===t?t:"x1"===t||"x2"===t?"x":"y";o.key=t,(o&&"color"!==t||!o)&&((i=r.dataConversions.performDataConversions(i,n,0,G.Heatmap,o)[n].adata)instanceof Float32Array&&(i=Array.from(i)),"score"===t?0:a[t]=i)}),this.useLabels&&this.dataConversions.setColData(a.x1,[a.y1,a.x2,a.y2]),it.calcVals(a.x1,a.x2,"x")),i=it.calcVals(a.y1,a.y2,"y"),e=x.convertXToFloatArr(e,this.tx),i=x.convertYToFloatArr(i,this.tys);this.buffers[0]=D.createBuffer(this.gl,e),this.buffers[1]=D.createBuffer(this.gl,i)},a.prototype.processBaselineOrBounds=function(t,e,i,n,o){var r=t===G.Baseline,a=r?e.baselineInfo.axis:"x",i=this.dataConversions.performDataConversions("x"===a?i:n[0],a,0,t,e,r?o:void 0)[a].adata,n=(this.buffers["x"===a?0:1]=D.createBuffer(this.gl,i),this.dataConversions.getBoundsColors());n&&(this.colorBuffers[0]=D.createBuffer(this.gl,new Float32Array(Array.prototype.concat.apply([],n))))},a.prototype.calcXType=function(){return x.isDoubleOrLongTemporal(this.tx)?this.tx:E.Float},a.prototype.createGroupedBarsBuffers=function(n,t,o,r){var a=this;t.forEach(function(t,e){var i=a.dataConversions.performDataConversions(n,"x",e,G.Bar,o,r).x.adata;a.buffers[e]=D.createBuffer(a.gl,i)})},a.prototype.createXBuffer=function(t,e,i,n,o){(t===G.Bar||t===G.Waterfall)&&e.barGrouping&&1<n.length?this.createGroupedBarsBuffers(i,n,e,o):(n=this.dataConversions.performDataConversions(i,"x",0,t,e,o).x.adata,this.buffers[0]=D.createBuffer(this.gl,n))},a.prototype.createYBuffers=function(o,r,a,s){var l=this,h=0,p=_.clone(this.buffers).length,u=o===G.Bar||o===G.Waterfall,c=r.lineStyle===I.Dotted||r.lineStyle===I.Dashed,t=o===G.LineFill&&(null==(t=r.lineFill)?void 0:t.fill),d=r.useThickLines||r.spanGaps||c||t;a.forEach(function(t,e){d&&(i=r.xCol,n=A(A({},r),{calcXLineData:!0}),i=l.dataConversions.performDataConversions(i,"x",e,o,n,s).x.adata,r.xLineData=i);var i,n=l.dataConversions.performDataConversions(t,"y",e,o,r,s);d?(l.buffers[h]=D.createBuffer(l.gl,n.x.adata),l.buffers[h+1]=D.createBuffer(l.gl,n.y.adata),h+=2):(i=u&&r.barGrouping&&1<a.length?e+(p-1):e+1,l.buffers[i]=D.createBuffer(l.gl,n.y.adata),0<r.borderWidth&&(u&&r.barGrouping&&a.length,t=l.dataConversions.getYBorderWidths(),l.yBorderWidthsBuffers[e]=D.createBuffer(l.gl,t))),c&&l.lineStyleCounts.push(l.count)})},a.prototype.setBorder=function(t,e){var t=t.borderWidth;t&&0<t&&(t=J.getBorderCoordinates(e.length),this.borderCoordinatesBuffer=D.createBuffer(this.gl,t))},a.prototype.setUpColors=function(t,e,i,n,o,r,a){e=t?e:i&&i.length?i:n&&n.length?n:null;e&&e.length&&(o===G.Waterfall?a.waterfallInfo.colorArray=e:(n=!(!(i=t&&t[0])||!i.fill||"No Fill"===i.fill),i=a.interpolation===et.Stepped,t=!!t&&t[1],o=o===G.LineBubble,this.setColorArray(n,r,e,t,i,o,a)))},a.prototype.setRadiusInfo=function(t,e,i){t[0]&&(this.pointSizes=this.getPointSizes(t[0],t[1],e,i),this.sizeBuffer=D.createBuffer(this.gl,new Float32Array(this.pointSizes)))},a.prototype.setDataIcon=function(t){t.dataIcons&&(this.dataIconsBuffer=D.createBuffer(this.gl,new Float32Array(t.dataIcons)))},a.prototype.setupShaders=function(t,e){var i=t===G.Bounds||t===G.Heatmap,t=t===G.Candlestick;this.shaders=new Array(i?1:t?2:e.length),this.buffers=new Array(i?2:t?4:e.length+1)},a.prototype.convertFillToLayerData=function(i){var n=this,o=[],r={fill:"",cols:null,toBounds:null,fromBounds:null};return this.yCols.forEach(function(t,e){t=n.dataConversions.performDataConversions(t,"y",0,G.LineFill,{lineFill:r,interpolation:i.interpolation,steppedLine:i.steppedLine});o[e]=null==(e=t.y)?void 0:e.adata}),o},a.prototype.updatePointSizeOnZoom=function(i){var n=[];this.pointSizes&&(_.each(this.pointSizes,function(t){var e=t*i;n.push(e<t?t:e)}),this.sizeBuffer=D.createBuffer(this.gl,new Float32Array(n)))},a.prototype.getPointSizes=function(i,t,e,n){for(var o=[],r=i.qtype,a=X.isLong(r)?function(t,e){return Number("bigint"==typeof t?i.getScalar(e):i.getLegacyScalar(e).toString())}:function(t,e){return i.getScalar(e)},s=0;s<i.length;s++){var l=t*(e?1.333:1),h=a(i,s);o.push(h*l),n&&(h=a(i,s+1),o.push(h*l))}return o},a.prototype.setColorArray=function(v,O,t,T,R,b,_){var C=this,L=[],A=(null==_?void 0:_.catmullPoints)||this.dataConversions.getCatmullPoints(),E=this.dataConversions.getSegmentLength(),S=0;t&&t.length&&(t.forEach(function(t,e){var i=t;if(A&&(S=null!=_&&_.catmullPoints?null==_?void 0:_.catmullPoints[1][e]:E[e]),O||R||b){for(var n=[],o=O&&!b,r=R&&!v?o?12:2:o?6:1,a=C.dataConversions.getBevelIndices(),s=0;s<t.length;s++)for(var l=r,h=(-1!==a.indexOf(s)&&(l+=3),t[s]),p=0;p<l;++p){!h.length&&null!=_&&_.color&&(u=_.color[e],c=_.opacity,h=te.convertHighlightColor(u,c));var u,c,d=h;if(S)for(var y,g=0,f=0;f<S;f++)v&&T?(y=-1!==[1,2,4].indexOf(g=6===g?0:g)?0:h[3],d=[h[0],h[1],h[2],y],n.push(d),g++):n.push(d);else v&&T&&(y=-1!==[1,2,4,7,8,10].indexOf(p)?0:h[3],d=[h[0],h[1],h[2],y]),n.push(d)}i=n}for(var m=new Float32Array(4*i.length),P=0,x=0;x<i.length;x++){h=i[x];m[P]=h[0],m[P+1]=h[1],m[P+2]=h[2],m[P+3]=h[3],P+=4}L.push(m)}),L.forEach(function(t,e){t=D.createBuffer(C.gl,t);C.colorBuffers[e]=t}))},a.prototype.remove=function(e){_.each(this.buffers,function(t){e.deleteBuffer(t)})},a.prototype.drawGL=function(t,e,i){var e=t===G.Bubble||""===t?this.gl.POINTS:e||t===G.Baseline?this.gl.LINE_STRIP:this.gl.TRIANGLES,n=this.count;this.lineStyleCounts[i]&&(n=this.lineStyleCounts[i]),e===this.gl.TRIANGLES&&t!==G.Line&&t!==G.LineFill&&(n*=6),this.gl.drawArrays(e,0,n)},a.prototype.createShader=function(t,e,i,n,o,r,a){t=D.getShader(this.gl,this.isWebGL2,t,e,i,!r&&void 0!==(a||this.colorBuffers[o]),void 0!==this.sizeBuffer,void 0!==this.borderCoordinatesBuffer,n,void 0!==this.dataIconsBuffer);this.shaders[o]=t,this.gl.useProgram(t.Program)},a.prototype.createBoundsBuffer=function(t,e){var i=this,t=new Y(t.y,t.w).applyFn(function(t){return X.convertJSToScalar(i.tys[0],t)}),n=Number(t.x),t=Number(t.y),n=J.drawYBounds(new Y(n,t),e.length),t=this.dataConversions.getBoundsColors(),e=x.convertYToFloatArr(n,this.tys,t);this.buffers[1]=D.createBuffer(this.gl,e)},a.prototype.createBaselineBuffer=function(t,e){var i="x"===(null==e?void 0:e.axis),t=i?new Y(t.y,t.w):new Y(t.x,t.z),n="x"===(null==e?void 0:e.axis)?"y":"x",o=e.types[n]||(i?this.tys[0]:this.tx),e=t.applyFn(function(t){return X.convertJSToScalar(o,t)}),n=[Number(e.x),Number(e.y)],t=i?x.convertYToFloatArr(n,this.tys):x.convertXToFloatArr(n,this.tx);return i?this.buffers[1]=D.createBuffer(this.gl,t):this.buffers[0]=D.createBuffer(this.gl,t),this.useLabels&&this.dataConversions.setColData(i?null:[Number(e.y)],i?[[Number(e.y)]]:null),o},a.prototype.setAxisBindings=function(t,e,i,n,o,r,a,s,l,h){s!==l&&(this.gl.useProgram(s.Program),t===G.Candlestick||e?s.xBinding.apply(this.gl,this.buffers[i]):(l=(t===G.Bar||t===G.Waterfall)&&1<n.length?o:0,(t===G.Bar&&r===H.BAR_HORIZONTAL?s.yBinding:s.xBinding).apply(this.gl,this.buffers[l])),null!=a&&s.setTexture(this.gl,a),h)&&s.setTexture(this.gl,h[n[o]]);e=t===G.Candlestick?2:1,l=(t===G.Bar||t===G.Waterfall)&&1<n.length?o+this.buffers.length/2:i+e;(t===G.Bar&&r===H.BAR_HORIZONTAL?s.xBinding:s.yBinding).apply(this.gl,this.buffers[l])},a.prototype.getUpdatedRange=function(t,e,i){t=X.getRange(t),t=X.getMidrange(new Y(t[0],t[1]),i);return e=t?new Y(X.toBigInt(e.x)-t,X.toBigInt(e.y)-t):e},a.prototype.render=function(r,a,s,l,h,p,u,c,d,y,g,f,m,t,P){var x,v=this,O=(l===G.Bounds&&t&&this.createBoundsBuffer(r,t),l===G.Baseline&&P&&P.types&&(x=this.createBaselineBuffer(r,P)),0);this.shaders.forEach(function(t,e){var i,n=c||p||v.lineStyleCounts.length||d,o=n?O:e,n=(v.setAxisBindings(l,n,o,u,e,f,m,t,void 0,g),l===G.Candlestick||l===G.Bounds?v.colorBuffers[0]:v.colorBuffers[e]),n=(n&&t.colorLocation&&t.colorLocation.apply(v.gl,n),v.sizeBuffer&&t.sizeLocation&&t.sizeLocation.apply(v.gl,v.sizeBuffer),v.borderCoordinatesBuffer&&t.borderLocation&&t.borderLocation.apply(v.gl,v.borderCoordinatesBuffer),v.dataIconsBuffer&&(t.dataIconsLocation&&t.dataIconsLocation.apply(v.gl,v.dataIconsBuffer),t.dataIconsTextureLocation)&&void 0!==m&&v.gl.uniform1i(t.dataIconsTextureLocation,m),t.canvasWidthLocation&&v.gl.uniform1f(t.canvasWidthLocation,v.gl.canvas.width),t.canvasHeightLocation&&v.gl.uniform1f(t.canvasHeightLocation,v.gl.canvas.height),v.setRangeBinding(f,P,r,l,t,e,x),t.color&&(i=X.hexColorToVec4(a[e%a.length],h),t.color.set(v.gl,i)),t.pointSize&&t.pointSize.set(v.gl,s),t.borderColor&&y.colors&&(i=X.hexColorToVec4(y.colors[e%y.colors.length],y.opacity),t.borderColor.set(v.gl,i)),t.xBorderWidth&&t.xBorderWidth.apply(v.gl,v.xBorderWidthsBuffer),t.yBorderWidth&&t.yBorderWidth.apply(v.gl,v.yBorderWidthsBuffers[e]),t.isHorizontalLocation&&(o=f&&f===H.BAR_HORIZONTAL?1:0,v.gl.uniform1f(t.isHorizontalLocation,o)),l===G.Line&&!c);v.drawGL(l,n,e),O+=2})},a.prototype.setRangeBinding=function(t,e,i,a,s,l,h){var p=this,u=t===H.BAR_HORIZONTAL,c=e?"x"===e.axis?1:0:null;_.each([new Y(i.x,i.z),new Y(i.y,i.w)],function(t,e){var i=0===e?u?1:0:u?0:1,n=0===e?s.xRange:s.yRange,o=0==i?p.tx:p.tys[l],i=(a===G.Baseline&&e===c&&h&&(o=h),0==i?p.xCol:p.yCols[l]),r=1===e&&a===G.Bounds,t=t.applyFn(function(t){return X.convertJSToScalar(o,t)});X.isLong(o)&&!r&&c!==e&&i?(t=p.getUpdatedRange(i,t,o),r=new Y(M.Long.fromString(t.x.toString().split(".")[0]),M.Long.fromString(t.y.toString().split(".")[0])),n.set(p.gl,r.applyFn(X.toNumber))):n.set(p.gl,t.applyFn(X.toNumber))})};var Kt=a;function a(t,e,i,n,o,r,a,s,l){this.isWebGL2=t,this.gl=e,this.maxRows=i,this.axisTypes=n,this.useLabels=o,this.cacheData=null,this.colLength=0,this.count=0,this.tx=0,this.tys=[],this.barWidth=0,this.buffers=[],this.colorBuffers=[],this.lineStyleCounts=[],this.shaders=[],this.pointSizes=[],this.yCols=[],this.yBorderWidthsBuffers=[],this.setDataTypes(s,l,n,a,r),this.dataCache=new Nt(i),this.dataConversions=new Jt(this.tx,this.tys,t,n,o,this.dataCache,this.updateCountVal.bind(this))}$t.createGradient=function(t){for(var e=new Array(t.length),i=0;i<t.length;i++){var n=(i/t.length*100).toFixed(2);e[i]=t[i]+" "+n+"%"}return"linear-gradient(to right, "+e.join(", ")+")"},$t.getConditionResult=function(t,e,i){var n,o,r=!1,a=isNaN(parseFloat(t))||_.isObject(t)?(""+t).toLowerCase():parseFloat(t),s=isNaN(parseFloat(e))||_.isObject(e)?(""+e).toLowerCase():parseFloat(e);switch(t&&t.class&&0<=["1212","1213","1214","1215"].indexOf(t.class)?(a=M.Tools.convertKDBTemporalToMoment(t).unix(),"in"===i?(n=[],_.each(e.toString().split(","),function(t){n.push(M.Tools.convertDateStringValueToMoment(t).unix()),s=n.toString()})):s=M.Tools.convertDateStringValueToMoment(e).unix()):t&&t.class&&0<=["1216","1217","1218","1219"].indexOf(t.class)&&(a=M.Tools.convertKDBTemporalToMoment(t).valueOfNano(),"in"===i?(o=[],_.each(e.toString().split(","),function(t){o.push(M.Tools.convertDateStringValueToMoment(t).valueOfNano()),s=o.toString()})):s=M.Tools.convertDateStringValueToMoment(e).valueOfNano()),i){case"contains":r=0<=a.toString().indexOf(s.toString());break;case"starts with":r=0===a.toString().indexOf(s.toString());break;case"ends with":r=-1!==a.toString().indexOf(s.toString(),a.toString().length-s.toString().length);break;case"==":r=a===s;break;case"<":r=a<s;break;case">":r=s<a;break;case"<=":r=a<=s;break;case">=":r=s<=a;break;case"!=":r=a!==s;break;case"in":r=0<=s.toString().split(",").indexOf(a.toString());break;case"search":r=!!a.toString().match(s.toString());break;case"regexp":r=new RegExp(e.toString()).test(t?t.toString():"")}return r},$t.getScalarResult=function(t,e,i,n,o){var r=t.getScalar(e);if(o&&X.isNull(r,X.getNullVal(t.qtype)))return null;switch("bigint"==typeof r&&"bigint"!=typeof i&&(i=X.toLong(i)),n){case"==":return r===i;case"<":return r<i;case">":return i<r;case"<=":return r<=i;case">=":return i<=r;case"!=":return r!==i}},$t.interpolateColor=function(t,e,i,n){if(!t.length)return"";for(var i=(i-e)/(t.length-1),n=this.clamp((n-e)/i,0,t.length-1),n=_.isNaN(n)?0:n,e=t[Math.floor(n)],i=t[Math.ceil(n)],o=X.hex2RGB(e),r=X.hex2RGB(i),a=n-Math.floor(n),s=o.slice(),l=0;l<3;l++)s[l]=Math.round(s[l]+a*(r[l]-o[l]));return this.RGB2hex(s)},$t.clamp=function(t,e,i){return i<t?i:t<e?e:t},$t.RGB2hex=function(t){return"#"+((1<<24)+(t[0]<<16)+(t[1]<<8)+t[2]).toString(16).slice(1)};var Qt=$t;function $t(){}ee.computeHighlightRules=function(s,l,t,e,h,i,n,o,p,u,c,d,y,g,f,r){var m,P,x,v,O,T;return h?(m={},_.each(_.keys(h),function(t){m[t]=h[t]}),P=[],x=e.length?e:t,v=null==s?void 0:s.map(function(t){t=(t.RuleTarget||"*").replace(/\*/g,"(.*)");return new RegExp("^"+t+"$")}),(null==r?void 0:r.col)&&(null==r?void 0:r.name)?(e=ee.calcHeatmapScoreColor(r,l,s,v,m),P.push(e),P):s||o?(O=[],T=0,_.each(m[x]?[m[x]]:i,function(t,r){O=[];for(var a=m[x]?x:n[r],e=0;e<t.length;e++)!function(t){var e,i=null!=g&&g.length&&g[r]?g[r][t]:l[T],n=s.length?ee.computeColorInternal(a,t,s,v,h,u,c,d,y,f):[p[T]],o=h[a];!s.length&&o.getScalar&&(e=o.getScalar(t),o=o.getScalar(t+1),0<e&&o<0||e<0&&0<o)&&(n[1]=p[T]),f&&c&&1===n.length&&(n[1]=n[0]),n.forEach(function(t){O.push(null===t?null:t||i)})}(e);T++,P.push(O)}),P):[]):[""]},ee.calcHeatmapScoreColor=function(t,e,i,n,o){for(var r=t.col,a=t.name,t=X.getRange(r),s=Number(t[0]),l=Number(t[1]),h=[],p=0;p<r.length;p++){var u=Qt.interpolateColor(e,s,l,Number(X.getColScalar(r,p))),c=i.length?ee.computeColorInternal(a,p,i,n,o,!1):[u];h.push(c&&c[0]?c[0]:u)}return h},ee.convertHighlightColor=function(t,e){var i=X.hexColorToVec4(t,e);return Object.keys(i).map(function(t){return i[t]})},ee.getColorArray=function(t,n,o,r,a){var s,e=[],l=0;return _.each(t,function(t){s=[],_.each(t,function(t){var e,i;t?(e=r?a:n,o&&(i=Number(X.getColScalar(o,l)),isNaN(i))&&(e=0),i=t?ee.convertHighlightColor(t,e):[],s.push(i)):s.push(null===t?[null,null,null,0]:[]),l++}),e.push(s)}),e},ee.calcLineFillColor=function(t,e,i,n,o,r,a,s){var l=n.getScalar(i);return-1!==["<","<=",">",">="].indexOf(t.RuleOperation)&&(n=n.getScalar(i+1),0===Number(l)&&0===Number(e)?o=(">"===t.RuleOperation||">="===t.RuleOperation)&&0<n||("<"===t.RuleOperation||"<="===t.RuleOperation)&&n<0?t.RuleColor:"":s||a||(0<l&&n<0?(r="",(0<=Number(e)&&("<"===t.RuleOperation||"<="===t.RuleOperation)||Number(e)<0&&(">"===t.RuleOperation||">="===t.RuleOperation))&&(r=t.RuleColor)):l<0&&0<n&&(r="",Number(e)<=0&&(">"===t.RuleOperation||">="===t.RuleOperation)||0<Number(e)&&("<"===t.RuleOperation||"<="===t.RuleOperation))&&(r=t.RuleColor))),[o,r]},ee.computeColorInternal=function(h,p,t,u,c,d,y,g,f,m){var P,x=null,v={};return t.forEach(function(t,e){if(u[e].test(h)&&t.RuleSource){var e=c[t.RuleSource],i=null==e?void 0:e.qtype,n=c[h].getValue(p);if(null===n)P=null;else if((3<i&&i<11||11<i&&i<20)&&{"==":!0,"<":!0,">":!0,"<=":!0,">=":!0,"!=":!0}[t.RuleOperation]&&!X.isIE11)n=X.convertStringToScalar(t.RuleValue,X.ipcTemp(i)),i=p,r=Qt.getScalarResult(e,i=y&&m&&"After"===g?p+1:p,n,t.RuleOperation,d),m?(o=r?t.RuleColor:null===r?"":P,n=ee.calcLineFillColor(t,n,i,e,o,x,y,f),P=!n[0]&&P?P:n[0],x=y?P:!n[1]&&x?x:n[1]):r?P=t.RuleColor:null===r&&(P="");else{_.each(_.keys(c),function(t){v[t]=c[t].getValue(p)});var o,r,i=t.RuleSource,a=v[i];if(d&&null===a)P="";else{if(a&&"object"==typeof a&&!a.i){for(var s="",l=0;l<a.length;l++)s+=""+a.getValue(l);a=s}"gradient"===t.RuleType?(e=t.RuleMin,o=t.RuleMax,n=t.Palette.map(function(t){return t.type}),P=Qt.interpolateColor(n,e,o,a)):t.RuleOperation&&(r=t.RuleOperation,i=t.RuleValue,Qt.getConditionResult(a,i,r))&&(P=t.RuleColor)}}}}),null!==x?[P,x]:[P]};var te=ee;function ee(){}ne.prototype.createRenderer=function(t,e,i,n,o,r,a,s,l,h,p,u,c,d,y,g){this.axisTypes=l;var f=i===G.LineBubble,m=i===G.LineFill,P=f?this.bubbleRenderer:m?this.fillRenderer:this.renderer,e=(!e&&P||(P=new Kt(n,t,this.maxRows,l,h,this.xCol,this.yCols,f?G.Bubble:i,a),f?this.bubbleRenderer=P:m?this.fillRenderer=P:this.renderer=P),P.setUpLayerData(a,p,this.xCol,this.yCols,i,this.radiusInfo,r,o),i===G.Line),n=i===G.LineBubble,t=g&&g[0],l=!(!t||!t.fill||"No Fill"===t.fill);return(e||l||n)&&(a=A(A({},a),{lineFill:t,xCol:this.xCol})),P.processDataByLayerType(i,a,this.xCol,this.yCols,o,g,d,u&&u.length?u:c,s,y),P},ne.prototype.getPoint=function(n,o,t){function i(t,e,i){return o&&o[e]?(void 0!==i?o[e][i]:o[e])[n]:(i=X.getColScalar(t,n),r.axisTypes[e]===W.TYPE_LOGARITHMIC?Math.log10(i):i)}var r=this;return[i(t||this.xCol,"x")].concat(this.yCols.map(function(t,e){return i(t,"y",e)}))};var ie=ne;function ne(t,e,i,n,o){this.xCol=t,this.yCols=e,this.yColNames=i,this.maxRows=n,this.radiusInfo=o,this.axisTypes={x:"",y:""}}s.prototype.getBreakdownColumns=function(){return this.breakdownColumns},s.sourceKey=function(t){return t.getPath()},s.mergeChanges=function(e,i,t,n,o,r){return t&&(e=_.fromPairs(_.map(t,function(t){return[i(t),t]}))),n&&_.each(n,function(t){return _.extend(e[i(t)],t)}),o&&_.each(o,function(t){e[i(t)]=t}),r&&_.each(r,function(t){delete e[i(t)]}),e},s.prototype.updateBreakdownCols=function(t){this.breakdownColumns=t,this.childDataSource&&this.childDataSource.updateBreakdownCols(t)},s.prototype.updateCols=function(t,e,i){this.listener.updateCols(t,e,i)},s.prototype.getParent=function(){return this.listener instanceof s?this.listener.getParent():this},s.prototype.setFocus=function(t){this.focus=t,this.updateChildren(),this.childDataSource&&this.childDataSource.setFocus(t)},s.prototype.hasFocus=function(){},s.prototype.getApi=function(){return this.api},s.prototype.isFocused=function(){return this.focus.length===this.depth&&(0===this.depth||this.source.id===this.focus[this.depth])},s.prototype.getColumnNames=function(){if(this.breakdownColumns&&this.breakdownColumns.length)return[s.BREAKDOWN_ID,this.breakdownColumns[0]].concat(_.difference(_.keys(this.meta),this.breakdownColumns));try{return _.map(this.meta,function(t){return[t.id,t.index]}).sort(function(t,e){return t[1]-e[1]}).map(function(t){return t[0]})}catch(t){return _.keys(this.meta)}},s.prototype.getColumnType=function(t){return this.childDataSource?this.childDataSource.getColumnType(t):t===s.BREAKDOWN_ID&&this.primaryKey?this.meta[this.primaryKey].kdbType:this.meta[t]?this.meta[t].kdbType:11},s.prototype.getData=function(){return this.childDataSource?this.childDataSource.getData():this.source},s.prototype.getDepth=function(){return this.childDataSource?this.childDataSource.getDepth():this.depth},s.prototype.getKey=function(){return this.source.cid},s.prototype.getPrimaryKey=function(){return this.childDataSource?this.childDataSource.getPrimaryKey():this.primaryKey},s.prototype.getPropertyFromColumn=function(t){return t===s.BREAKDOWN_ID?this.getPrimaryKey():t},s.prototype.getPath=function(){return this.source.path},s.prototype.getSource=function(){return this.source},s.prototype.hasData=function(){return this.childDataSource?this.childDataSource.hasData():this.hasDataFlag},s.prototype.onData=function(t,e,i){var n,o,r,a;this.hasDataFlag=!0,this.childDataSource||(this.cols=_.clone(e.cols),t.primaryKey!==this.primaryKey&&(this.primaryKey=t.primaryKey),n=(a=t.columns).reset,o=a.change,r=a.add,a=a.remove,this.meta=s.mergeChanges(this.meta,function(t){return t.id},n,o,r,a),0!==this.depth||_.isEqual(t.breakdownColumns,this.breakdownColumns)||(this.breakdownColumns=t.breakdownColumns,this.removeChild()),e.reset&&0<e.reset.length&&this.removeChild(),i&&this.updateError(this,i),this.updateChildren()&&this.listener.updateDataSource(this),this.updateDepth(this.depth),this.getParent().listener.onData(t,e,i))},s.prototype.getChild=function(){return this.childDataSource?this.childDataSource.getChild():this},s.prototype.subscribe=function(t){t&&(this.source=t),this.source.agent.rawSubscribers[this.subId]||this.source.subscribe(this.subId,this,!0)},s.prototype.updateDataSource=function(){this.listener.updateDataSource(this)},s.prototype.updateError=function(t,e){},s.prototype.unsubscribe=function(){this.childDataSource&&(this.childDataSource.unsubscribe(),delete this.childDataSource),this.source.unsubscribe(this.subId)},s.prototype.removeChild=function(){this.childDataSource&&(this.childDataSource.unsubscribe(),delete this.childDataSource)},s.prototype.updateDepth=function(t){this.listener.updateDepth(t)},s.prototype.updateChildren=function(){var t,e;return!(this.breakdownColumns&&this.breakdownColumns.length&&this.depth<this.breakdownColumns.length-1&&(this.focus.length>this.depth?(e=this.source.id||(null==(e=null==(e=null==(e=null==(e=this.source)?void 0:e.dataSet)?void 0:e.collection)?void 0:e.get(this.focus[this.depth]))?void 0:e.id),this.childDataSource&&this.focus[this.depth]!==e&&this.removeChild(),this.childDataSource||(t=this.source.dataSet&&this.source.dataSet.collection.get(this.focus[this.depth]))&&(this.childDataSource=new s(t,this,this.api,this.focus,this.depth+1,this.breakdownColumns),this.childDataSource.subscribe())):(this.removeChild(),e=this.source.id||(null==(t=null==(t=null==(t=null==(t=this.source)?void 0:t.dataSet)?void 0:t.collection)?void 0:t.get(this.focus[this.depth-1]))?void 0:t.id),this.focus.length!==this.depth||!this.hasDataFlag||0!==this.depth&&this.focus[this.depth-1]!=e||(0===this.depth&&this.listener.updateDataSource(this),this.listener.updateCols(this,this.primaryKey,this.cols))),1))},s.BREAKDOWN_ID="{breakdownId}";var G,oe=s;function s(t,e,i,n,o,r){this.breakdownColumns=[],this.meta={},this.hasDataFlag=!1,this.focus=[],this.subId=_.uniqueId("glLayer"),this.cols=[],this.source=t,this.listener=e,this.api=i,this.depth=o||0,this.breakdownColumns=r||this.breakdownColumns,this.setFocus(n)}(i=G=G||{}).Bubble="Bubble",i.Line="Line",i.LineBubble="LineBubble",i.LineFill="LineFill",i.Bar="Bar",i.Waterfall="Waterfall",i.Bounds="Bounds",i.Candlestick="Candlestick",i.Heatmap="Heatmap",i.Baseline="Baseline";Object.defineProperty(w.prototype,"RenderState",{get:function(){return this.renderState},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"Config",{get:function(){return this.config},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"Renderer",{get:function(){return this.renderer},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"XType",{get:function(){return this.config?this.config.xCol.qtype:null},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"YType",{get:function(){return this.config&&this.config.yCols.length?this.config.yCols[0].qtype:null},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"datasourceError",{get:function(){var t;return null==(t=null==(t=this.datasource)?void 0:t.attributes)?void 0:t.error},enumerable:!1,configurable:!0}),w.prototype.applyPatternToColor=function(t,e,i){e=M.Tools.drawPattern(e,t,void 0,i,2*i),t=e.patternCanvas,i=t.getContext("2d");return i?(i.fillStyle=e.pattern,i.fillRect(0,0,t.width,t.height),t.toDataURL()):""},w.prototype.drawLabels=function(t,e,i,n){var o=null==(o=this.renderer)?void 0:o.getCols();o&&this.dataLabels.drawLabels(o,this.index,t,e,i,(null==(o=this.renderer)?void 0:o.getMaxDist())||0,(null==(t=this.renderer)?void 0:t.getBarWidth())||0,(null==(e=null==n?void 0:n.allBarLayers)?void 0:e.indexOf(this))||0,this.isHorizontal(),this.getBaselineAxis(),this.getStackedYData())},w.prototype.getConvertedCategoryData=function(t,e,i){var n=this.getAllCategoryData(e);return n&&n[1]?(n=n[1],("y"===e&&void 0!==i&&n[i]?n[i]:n)[t]):0},w.prototype.getAllPointsFromRelativeX=function(){return this.points},w.prototype.getAxisId=function(t){return this.api.getProperty(this.indexProp(t.toUpperCase()+"AxisId")).replace(/.*?(\d+)$/,"$1")-1},w.prototype.getAxisType=function(t){var e=this.getAxisId(t),t=t.toUpperCase()+"axes.";return this.api.getProperty(t+e+".Type")},w.prototype.getBarType=function(){return this.api.getProperty(this.indexProp(w.PROP_BARWIDTHTYPE))},w.prototype.getBaselineAxis=function(){return"X-Axis"===this.api.getProperty(this.indexProp(w.PROP_BASELINE_AXIS))?"x":"y"},w.prototype.getBaselineInfo=function(){return this.baselineInfo},w.prototype.getBaselineValue=function(){return this.api.getProperty(this.indexProp(w.PROP_BASELINE_VALUE))},w.prototype.getBoundsCol=function(t){if(this.cols)return this.cols[this.api.getProperty(this.indexProp(t))]},w.prototype.getTriggerData=function(t){var e;return null==(e=this.renderer)?void 0:e.getTriggerData(t)},w.prototype.getClosestPointFromRelativeX=function(n,e,t,o,i,r){var a=this;if(!this.config)return null;function s(t){if(u===W.TYPE_CATEGORY)return d?a.getConvertedCategoryData(0,p)[t]:a.getConvertedCategoryData(t,p);if(a.isTriggerBreakApplied("x")){var e=a.getTriggerData("x");if(e)return e[t]}return e=X.getColScalar(h,t),u===W.TYPE_LOGARITHMIC?Math.log10(e):e}var l=this.config,h=r||l.xCol,p=this.isHorizontal()?"y":"x",u=this.getAxisType(p),c=this.getLayerType(),d=this.isHorizontal(),r=this.getSortedIndices(u,h),y=r[0],g=r[1];if(!y)return null;function f(t){for(var e=l.getPoint(y(t),T),i=1;i<e.length;i++){var n=e[i],n=(a.getAxisType(d?"x":"y")===W.TYPE_CATEGORY&&(n=a.getConvertedCategoryData(y(t),"y",i-1)),X.calculateRelativeValue(n,o.y,o.w));if(0<=(n=c===G.Bounds?1:n)&&n<=1)return 1}}function m(t,e){for(var i=[];e?0<=t:t<g;)v(t)||O(t)||i.push(t),e?t--:t++;return i.length?a.getClosestXPoint(i,o,l,y,n):t}var P,r=X.isLong(h.qtype)&&u!==W.TYPE_CATEGORY,x=(P=r?(P=Math.round(n*t),X.isIE11?(o=o.applyFn(X.toLong)).x.add(new M.Long(P).mul(o.z.sub(o.x)).div(new M.Long(t))):X.toBigInt(o.x)+X.toBigInt(P)*(X.toBigInt(o.z)-X.toBigInt(o.x))/X.toBigInt(t)):Number(o.x)+n*(Number(o.z)-Number(o.x)),0<=(t=u===W.TYPE_LINEAR&&h.hasIndex&&h.hasIndex()?h.findIndex(P):u===W.TYPE_LOGARITHMIC&&h.hasIndex&&h.hasIndex()?h.findIndex(Math.pow(10,P)):r&&X.isIE11?M.Tools.binarySearch2(P,this.workerIndex,function(t,e){e=h.getLegacyScalar(e);return t.compare(e)}):M.Tools.binarySearch2(P,this.workerIndex,function(t,e){e=s(e);return e<t?1:t<e?-1:0}))?R=t:(R=-t-2)+1),v=function(t){var t=l.getPoint(y(t),T),e=t[0],t=t.slice(1);return!X.isString(a.XType)&&isNaN(Number(e))||_.every(t,function(t){return!X.isString(a.YType)&&isNaN(Number(t))})},O=function(t){if(a.hasColorData()&&a.colorDataInfo){var e=a.disabledColumns,i=a.cols&&a.cols[a.api.getProperty(a.indexProp(w.PROP_COLORDATA))];if(i){t=y(t),i=X.getColScalar(i,t);if(-1<e.indexOf(null==i?void 0:i.toString()))return!0}}return!1},T={x:this.getTriggerData("x"),y:this.getTriggerData("y")};if(!X.isString(this.XType)){var R,t=l.getPoint(y(R),T,h),b=l.getPoint(y(x),T,h),t=isNaN(Number(t[0]))||O(t[0]),b=isNaN(Number(b[0]))||O(b[0]);if(t)R=m(R,!0);else if(v(R)||O(R))for(;0<=R&&(v(R)||O(R));)R--;if(b)x=m(x,!1);else if(v(x)||O(x))for(;x<g&&(v(x)||O(x));)x++;(t||b)&&(R=x=this.getClosestXPoint([R,x],o,l,y,n))}for(var C=[],L=[],A=l.getPoint(y(R),T,h),E=l.getPoint(y(x),T,h);0<=R&&l.getPoint(y(R),T,h)[0]===A[0];)f(R)&&C.push(R),R--;for(;x<g&&l.getPoint(y(x),T,h)[0]===E[0];)f(x)&&L.push(x),x++;R=C.length?this.getY(C,o,l,y,e,T):R,x=L.length?this.getY(L,o,l,y,e,T):x;var S,D,I,t=_.union(C,L);return this.api.getProperty("Overlay.ShowAllPoints")&&(i!==w.PROP_X2_COORD&&(this.points=[]),S=[],_.each(t,function(t){S.push(c!==G.Bounds&&a.isRegexOrWild()?a.getAllWildcards(t,o,l,y):[a.getClosestPoint(t,o,l,y,e,h,T)])}),this.points=this.points.concat(S)),R<0&&g<=x?null:R<0?this.getClosestPoint(x,o,l,y,e,h,T):g<=x?this.getClosestPoint(R,o,l,y,e,h,T):(b=this.getY(t,o,l,y,e,T),r=X.isIE11&&r?(D=P.sub(h.getLegacyScalar(y(R))),I=h.getLegacyScalar(y(x)).sub(P),D.equals(I)?b:D.lt(I)?R:x):(i=Number(s(y(R))),t=Number(s(y(x))),(D=Number(P)-i)===(I=t-Number(P))?b:D<I?R:x),this.getClosestPoint(r,o,l,y,e,h,T))},w.prototype.getAllCategoryData=function(t){var e;return(null==(e=this.renderer)?void 0:e.getCategoryData(t))||[]},w.prototype.getColorArr=function(t,e){t=this.colorArr[e=e||0][t];return t||this.getLayerColors(U.Default)[e]},w.prototype.getColorData=function(){return this.colorDataInfo},w.prototype.getAllCols=function(t){if(t){t=this.getColorData();if(t)return _.union(t[0],this.disabledColumns)}return this.getLayerType()===G.Baseline||_.get(this.yAxes,"length")||(this.yAxes=this.getYAxesVals()),_.union(this.yAxes,this.disabledColumns)},w.prototype.getAxisStacked=function(t){var e=this.getAxisId(t);return!0===this.api.getProperty(t.toUpperCase()+"axes."+e+".Stacked")},w.prototype.getFillToLayerData=function(t){return this.renderer?this.renderer.convertFillToLayerData(t):[]},w.prototype.getAxisData=function(t){t=this.api.getProperty(this.indexProp(t));return t===w.BREAKDOWN_ID?this.primaryKey:t},w.prototype.getGroupedBarData=function(){var t,e;return this.cols?(t=this.getAxisData(w.PROP_XAXIS),t=this.cols[t],e=null==(e=this.renderer)?void 0:e.getDataCache("x",0),x.convertToNumArr(t,G.Bar,e)):[]},w.prototype.getFillType=function(){return this.propertyCache[w.PROP_TYPE]===G.Line?this.propertyCache[w.PROP_FILL]:""},w.prototype.getId=function(){return this.uid},w.prototype.getInterpolation=function(){return this.propertyCache[w.PROP_INTERPOLATION]},w.prototype.getLayerName=function(){return this.api.getProperty(this.indexProp("Name"))},w.prototype.getLayerType=function(){return this.propertyCache[w.PROP_TYPE]},w.prototype.getLegendGroup=function(){return this.api.getProperty(this.indexProp("LegendGroup"))},w.prototype.getStackedYData=function(){var t;return null==(t=this.renderer)?void 0:t.getStackedYData()},w.prototype.getStackedXData=function(){var t;return null==(t=this.renderer)?void 0:t.getStackedXData()},w.prototype.getTriggerBounds=function(t){if(this.isTriggerBreakApplied(t)&&this.hasData()){var e=null==(e=this.renderer)?void 0:e.getTriggerBounds(t),t="x"===t||"y"===t&&this.isHorizontal()?this.XType:this.YType;if(e&&null!==t)return new Y(X.convertToJsScalar(t,e.x),X.convertToJsScalar(t,e.y))}return null},w.prototype.getTriggerIntervals=function(t){var e;return null==(e=this.renderer)?void 0:e.getTriggerIntervals(t)},w.prototype.getXCol=function(){return this.api.getProperty(this.indexProp(w.PROP_XAXIS))},w.prototype.hasBubbles=function(){var t=this.getLayerType(),e=this.api.getProperty(this.indexProp(w.PROP_RADIUS_SCALE));return t===G.Bubble||t===G.Line&&0<e},w.prototype.hasColorData=function(){var t=this.api.getProperty(this.indexProp(w.PROP_COLORDATA));return!this.isCandlestick()&&t&&"None"!==t},w.prototype.hasDataLabels=function(){var t=this.api.getProperty(this.indexProp(w.PROP_LABEL_ENABLED)),e=this.api.getProperty(this.indexProp(Oe.PROP_LABEL_MAX_LABELS));return t&&0<e},w.prototype.hasFixedWidth=function(){var t=this.api.getProperty(this.indexProp(w.PROP_TYPE)),e=this.getBarType();return t===G.Bar&&"Fixed Width"===e},w.prototype.hasLineStyle=function(){var t=this.api.getProperty(this.indexProp(w.PROP_LINE_STYLE));return 0<this.propertyCache[w.PROP_DASH_GAP]&&(this.isDashedLine()||t===I.Dotted)},w.prototype.hasOverrideRules=function(){return!!Object.keys(this.overrideColors).length},w.prototype.hasStackedGap=function(){var t=this.getAxisId("y");return!(!this.api.getProperty("Yaxes."+t+".Stacked")||!this.api.getProperty("Yaxes."+t+".StackedGap"))},w.prototype.hasPadding=function(){return this.propertyCache[w.PROP_TYPE]!==G.Line},w.prototype.hasTexture=function(){return!(!this.icon||!this.texture)},w.prototype.isBubble=function(){return this.api.getProperty(this.indexProp(w.PROP_TYPE))===G.Bubble},w.prototype.isCandlestick=function(){return this.api.getProperty(this.indexProp(w.PROP_TYPE))===G.Candlestick},w.prototype.isEnabled=function(){return!0===this.api.getProperty(this.indexProp(w.PROP_ENABLED))},w.prototype.isHorizontal=function(){return this.getLayerType()===G.Bar&&this.api.getProperty(this.indexProp(w.PROP_BAR_ORIENTATION))===w.BAR_HORIZONTAL},w.prototype.isThickLines=function(){var t=this.propertyCache[w.PROP_LINETHICKNESS],e=this.propertyCache[w.PROP_INTERPOLATION];return this.getLayerType()===G.Line&&(1<t||e===et.Monotone)},w.prototype.colorsNeedUpdate=function(){var t=!1,e=(this.hasColorData()&&this.cols&&(t=!0),this.propertyCache[w.PROP_HIGHLIGHTRULES]);e&&e.length&&(t=!0);this.propertyCache[w.PROP_TYPE]===G.Heatmap&&(t=!0);e=this.propertyCache[w.PROP_FILL];return t=e&&"No Fill"!==e?!0:t},w.prototype.updateLayerPalette=function(t,e){t&&(o=this.getAxisData(w.PROP_YAXIS),o=this.isRegexOrWild()?this.getColumnKeysFromAxisString(o):[o],n=this.getColorData(),i=this.hasColorData()&&n&&n[0]?n[0].map(function(t){return t.toString()}):o,this.disabledColumns=t.filter(function(t){return-1!==i.indexOf(t)}));var i,n=this.getPaletteProperty();this.palette=e?n:this.getUpdatedPalette(n,U.Default),this.api.getProperty(this.indexProp(w.PROP_FILL))&&(o=this.getPaletteProperty(!1,!0),this.fillPalette=e?o:this.getUpdatedPalette(o,U.Fill));0<this.api.getProperty(this.indexProp(w.PROP_BORDER_WIDTH))&&(t=this.getPaletteProperty(!1,!1,!0),this.borderPalette=e?t:this.getUpdatedPalette(t,U.Border));var n=this.propertyCache[w.PROP_HIGHLIGHTRULES],o=this.propertyCache[w.PROP_FILL];return o&&"No Fill"!==o&&(n&&n.length||this.propertyCache[w.PROP_FADE])&&(e=this.api.getProperty(this.indexProp(w.PROP_FILLCOLOR)),this.isRegexOrWild()||e||this.setLineFillProperties()),this.colorsNeedUpdate()&&this.onColorsChange(),this.palette},w.prototype.updateTheme=function(t){this.theme=t,this.dataLabels.updateTheme(t,this.index)},w.prototype.getBarOrientation=function(){return this.api.getProperty(this.indexProp(w.PROP_BAR_ORIENTATION))},w.prototype.getRowData=function(e){var i,n;return this.getLayerType()===G.Baseline?{val:this.baselineInfo.jsVal}:this.cols?(i=this.cols,n={},_.each(_.keys(i),function(t){n[t]=i[t].getValue(e),n[t]&&"object"==typeof n[t]&&!M.Tools.isKDBTemporal(n[t])&&(n[t]=X.getValueFromObject(n[t]))}),n):null},w.prototype.getColumnKeysFromAxisString=function(t){var e=M.Tools.getRegex(t);return this.columns.filter(function(t){return t.match(e)})},w.prototype.getCurrentTickVals=function(){return this.currentTickVals},w.prototype.getDataRangeX=function(){var t=this.api.getProperty(this.indexProp(w.PROP_TYPE));if(this.cols&&this.hasData()){var e=this.isHorizontal()?"y":"x",e=this.getAxisType(e);if(e===W.TYPE_CATEGORY)return new Y(0,1);var i=void 0,n=void 0;if(t===G.Bounds||t===G.Heatmap){var t=t===G.Bounds,o=this.api.getProperty(this.indexProp(t?w.PROP_X1_COORD:w.PROP_HEATMAP_X1)),t=this.api.getProperty(this.indexProp(t?w.PROP_X2_COORD:w.PROP_HEATMAP_X2));if(!o||!t)return new Y(0,1);var o=this.cols[o],t=this.cols[t],r=X.getRange(o),t=X.getRange(t),i=o.qtype,n=[Math.min(Number(r[0]),Number(t[0])),Math.max(Number(r[1]),Number(t[1]))]}else{o=this.cols[this.getAxisData(w.PROP_XAXIS)];if(i=o.qtype,n=X.getRange(o),this.hasColorData()&&this.disabledColumns.length&&null!=(r=this.disabledColorDataIndices)&&r.length)return this.getColorDataRange([o])}return e===W.TYPE_LOGARITHMIC?(t=new Y(Math.log10(Number(n[0])),Math.log10(Number(n[1]))),X.convertVec2ToJsScalar(t,i,i)):X.convertVec2ToJsScalar(new Y(n[0],n[1]),i,i)}return new Y(0,1)},w.prototype.getDataRangeY=function(){var i,e,t,n,o=this.getLayerType();return!this.cols||!this.hasData()||(n=this.isHorizontal()?"x":"y",(i=this.getAxisType(n))===W.TYPE_CATEGORY)?new Y(0,1):o===G.Heatmap?(n=this.api.getProperty(this.indexProp(w.PROP_HEATMAP_Y1)),o=this.api.getProperty(this.indexProp(w.PROP_HEATMAP_Y2)),n&&o?(n=this.cols[n],o=this.cols[o],t=X.getRange(n),o=X.getRange(o),n=n.qtype,t=[Math.min(Number(t[0]),Number(o[0])),Math.max(Number(t[1]),Number(o[1]))],X.convertVec2ToJsScalar(new Y(t[0],t[1]),n,n)):new Y(0,1)):(o=_.difference(this.yAxes,this.hasColorData()?[]:this.disabledColumns),e=this.cols,n=(t=o.map(function(t){return e[t]}).filter(function(t){return t})).map(function(t){var e=X.getRange(t);return i===W.TYPE_LOGARITHMIC&&(e=[Math.log10(Number(e[0])),Math.log10(Number(e[1]))]),X.convertVec2ToJsScalar(new Y(e[0],e[1]),t.qtype,t.qtype)}),this.hasColorData()&&this.disabledColumns.length&&null!=(o=this.disabledColorDataIndices)&&o.length?this.getColorDataRange(t):X.mergeRange(n)||new Y(0,1))},w.prototype.isBar=function(){var t=this.api.getProperty(this.indexProp(w.PROP_TYPE));return t===G.Bar||t===G.Waterfall},w.prototype.getLabelSize=function(t,e,i){var n,o,r=null==(r=this.renderer)?void 0:r.getCols();return r?(n=this.getBaselineInfo(),o=this.getYAxesVals(),this.dataLabels.getMaxLabelSize(r,o,this.index,t,e,i,n)):null},w.prototype.getPaddedRange=function(o,t,e,i){function n(t,e){if(e===E.Timestamp){var i=t?new Y(o.x,o.z):new Y(o.y,o.w),n=new Y(X.convertJSToScalar(e,i.x),X.convertJSToScalar(e,i.y));if(n.x===n.y)return null;e=X.getMidrange(n,e,i);if(t?y=e:g=e,e)return i=Number(X.toBigInt(n.x)-e),t=Number(X.toBigInt(n.y)-e),new Y(i,t)}return null}var r,a,s,l,h,p=this,u=o.applyFn(L.isMoment),c=o.applyFn(L.isDuration),d=o.applyFn(X.convertJSToNumber),y=X.toBigInt(0),g=X.toBigInt(0),f=n(!0,this.isHorizontal()?this.YType:this.XType),m=n(!1,this.isHorizontal()?this.XType:this.YType),f=(d=new V((f||d).x,m?m.x:d.y,f?f.y:d.z,m?m.y:d.w),this.propertyCache[w.PROP_TYPE]),P=this.isBar(),m=d.x,x=d.z,v=d.y,O=d.w,T=!1,R=(d.y===d.w&&(O+=R=Math.abs(.01*v),v-=R),d.x===d.z&&(x+=R=Math.abs(.01*m),m-=R,T=!0),0),b=this.isHorizontal(),_=(P&&i&&(_=this.getBarType(),C=b?O-v:x-m,r=i.allBarLayers.indexOf(this),l=(r=i.layersCommonXAxis[r]).length,R=("Percentage"===_?(_=r.indexOf(this),C/i.dataLengths[_]/(l+1)*(this.api.getProperty(this.indexProp(w.PROP_BARPERCENT))/100)):C*(this.api.getProperty(this.indexProp(w.PROP_BARFIXED))/t.x))*l),P||this.isCandlestick()?(h=R||(null==(r=this.renderer)?void 0:r.getBarWidth())||0,i=b?0:h,_=b?h:0,C=function(t,e){var i=(e-t)*w.BAR_MIN_RELATIVE_SZ,t=P&&0<e&&0<t?Math.max(0,t-i):t,i=P&&e<0?Math.min(0,e+i):e;return new Y(t,i)},l=b?new Y(v,O):C(v,O),R=b?C(m,x):new Y(m,x),d=new V(R.x-i,l.x-_,R.y+i,l.y+_)):this.hasBubbles()?(r=this.propertyCache[w.PROP_RADIUS_DATA],h=b=Number(this.propertyCache[w.PROP_RADIUS_SCALE])/2,s=C=0,r&&"Fixed Size"!==r&&this.cols&&(i=(R=this.cols[r])&&R.length?X.getRange(R):[0,1],h=b*Number(i[1])),l=h/t.x,a=h/t.y,d=new V(m-(C=l*(x-m)),v-(s=a*(O-v)),x+C,O+s)):f===G.Line&&(a=(this.api.getProperty(this.indexProp(w.PROP_LINETHICKNESS))+1)/t.y,d=new V(m,v-(s=a*(O-v)),x,O+s)),this.api.getProperty(this.indexProp(Oe.PROP_LABEL_MAX_LABELS))),C=(this.hasDataLabels()&&e&&0<_&&!T&&(r=this.api.getProperty(this.indexProp(Oe.PROP_LABEL_ALIGN)),R=X.convertJSToNumber(e.right.position),b=X.convertJSToNumber(e.left.position),y&&(i=e.left.position,h=e.right.position,null!==(l=this.isHorizontal()?this.YType:this.XType))&&(C=new Y(X.convertJSToScalar(l,i),X.convertJSToScalar(l,h)),b=(f=new Y(Number(X.toBigInt(C.x)-y),Number(X.toBigInt(C.y)-y))).x,R=f.y),m=e.right.width/t.x*(d.z-d.x),a=e.left.width/t.x*(d.z-d.x),x=Math.abs(b-d.x),O=Math.abs(d.z-R),s=2*(e.height/t.y)*(d.w-d.y),T=_=0,"center"===r||"top"===r||"bottom"===r?(_=a/1.5-x,T=m/1.5-O):"left"===r?_=a/1.5-x:"right"===r&&(T=m/1.5-O),i=_,l=T<0&&0<d.z?0:T,h=s-Math.abs(d.y-v),d=new V(d.x-i,d.y-("top"===r?0:h),d.z+l,d.w+("bottom"===r?0:h))),["x","y","z","w"].forEach(function(t){u[t]?d[t]=y&&"y"!==t&&"w"!==t?p.convertNanos(d,t,y):g&&"x"!==t&&"z"!==t?p.convertNanos(d,t,g):L(d[t]):c[t]&&(d[t]=L.duration(d[t]))}),this.useAxisRange("x")),f=this.useAxisRange("y");return new V((C.x?o:d).x,(f.x?o:d).y,(C.y?o:d).z,(f.y?o:d).w)},w.prototype.getColorValue=function(t,e,i){return this.api.getProperty(Te.PROP_PATTERNS)?(i=i?this.patterns[i]:Object.values(this.patterns)[0],this.applyPatternToColor(t,i,e)):t},w.prototype.getPaletteProperty=function(t,e,i,n){var o=this,n=n&&n.length?n:this.api.getProperty(this.indexProp(e?w.PROP_FILLPALETTE:i?w.PROP_BORDER_PALETTE:w.PROP_PALETTE)),r=null==n?void 0:n.map(function(t){return"object"==typeof t.type&&t.type.attributes?t.type.attributes.value:t.type});return r=t&&this.api.getProperty(Te.PROP_PATTERNS)?Object.values(this.patterns).map(function(t,e){e=r[e%r.length];return t?o.applyPatternToColor(e,t,12):e}):r},w.prototype.hasData=function(){if(this.getLayerType()===G.Baseline)return!0;if(this.datasource){var t=this.datasource.attributes,e=t.queryStatus;if(t.error)return!1;if(e){if("Loading"===e.type)return!1;if("NoResults"===e.type)return}return!0}},w.prototype.hasNoResults=function(){var t;return!!this.datasource&&"NoResults"===(null==(t=this.datasource.get("queryStatus"))?void 0:t.type)},w.prototype.hasPatterns=function(){var t=this.getLayerType();return this.api.getProperty(Te.PROP_PATTERNS)&&t===G.Bar},w.prototype.hasDataIcons=function(){var t=this.api.getProperty(this.indexProp(w.PROP_SETICONFROMDATA)),e=this.api.getProperty(this.indexProp(w.PROP_DATA_ICON));return!!(t&&e&&this.dataIcons.length)},w.prototype.hasDataIconColor=function(){var t=this.api.getProperty(this.indexProp(w.PROP_SETICONFROMDATA)),e=this.api.getProperty(this.indexProp(w.PROP_DATA_ICON_COLOR));return!!(t&&e&&this.dataIcons.length)},w.prototype.getDataIcon=function(t){var e;return this.cols&&(e=this.api.getProperty(this.indexProp(w.PROP_DATA_ICON)),e=this.cols[e],X.getColScalar(e,t))||""},w.prototype.getDataIconColor=function(t){var e;return this.cols&&(e=this.api.getProperty(this.indexProp(w.PROP_DATA_ICON_COLOR)),e=this.cols[e],X.getColScalar(e,t))||""},w.prototype.indexProp=function(t){return w.PROP_PREFIX+this.index+"."+t},w.prototype.isCurrentTickShown=function(){return this.propertyCache[w.PROP_CURRENT_TICK]},w.prototype.isRegexOrWild=function(){var t=this.getLayerType();return t!==G.Baseline&&t!==G.Heatmap&&X.isRegexOrWild(this.getAxisData(w.PROP_YAXIS))},w.prototype.updateCols=function(t,e,i){this.source=t,this.primaryKey&&this.primaryKey!==e&&(this.primaryKey=e,this.cols=_.clone(i),this.columns=Object.keys(i),this.configure())},w.prototype.updateDataSource=function(t){var e,i=t.getData();(null==i?void 0:i.cid)!==(null==(e=this.datasource)?void 0:e.cid)&&this.onDataSourceChange(i,t),this.source=t},w.prototype.updateDepth=function(t){this.depth=t},w.prototype.onData=function(t,i,e){this.api.getProperty("Basics.TrackLoadTime")&&this.updatePerformanceTracker(!1),e&&this.appInvalidate(this.renderState),this.isCachingData()&&document.hidden&&!this.resetCache&&(this.resetCache=!0),this.isCachingData()?this.newDataLength=i.keyCol?i.keyCol.length:0:null!==this.newDataLength&&(this.newDataLength=null);var n,e=_.find(this.cols,function(t,e){return!i.cols||t!==i.cols[e]}),o=(this.cols=_.clone(i.cols),this.primaryKey=t.primaryKey,t.columns.collection.models.map(function(t){return t.id})),r=!_.isEqual(o,this.columns),a=this.getLayerType();if(e||r){this.resetCache=!0,this.columns=o,this.updateYAxesVals(),this.updateWildcardLayers(!1,!0),this.setDataIcons();try{this.setIgnoreSettings(!0);var s,l,h=this.columns,p=["*"].concat(this.columns),u=((t.breakdownColumns.length||this.source.getBreakdownColumns().length)&&(h=[w.BREAKDOWN_ID].concat(h),p=[w.BREAKDOWN_ID].concat(p)),this.api.setProperty(this.indexProp("possibleXColumns"),h),this.api.setProperty(this.indexProp("possibleYColumns"),p),this.api.setProperty(this.indexProp("possibleMultiColumns"),["","*"].concat(this.columns)),this.api.setProperty(this.indexProp("possibleIconColumns"),[""].concat(this.columns)),this.api.setProperty(this.indexProp("possibleColorColumns"),["None"].concat(this.cols?Object.keys(this.cols):[])),this.api.setProperty(this.indexProp("possibleActionsColumns"),["None","<thisX>","<thisY>","<thisName>"].concat(this.cols?Object.keys(this.cols):[])),this.api.getProperty(this.indexProp(w.PROP_COLORDATA))),c=(u&&(!i.cols||i.cols[u])||(this.api.setProperty(this.indexProp(w.PROP_COLORDATA),"None"),this.colorData=[],this.colorDataArr=[]),null!=(n=this.api.getProperty(this.indexProp(w.PROP_HIGHLIGHTRULES)))&&n.length&&(s=this.cols?Object.keys(this.cols):[],this.api.setProperty(this.indexProp("possibleRulesColumns"),s)),this.propertyCache[w.PROP_FILL]),d=(this.isRegexOrWild()&&c&&"No Fill"!==c&&(this.fillPalette=this.getUpdatedPalette(this.getPaletteProperty(!1,!0),U.Fill)),this.api.getProperty(this.indexProp(w.PROP_BORDER_WIDTH))),y=(this.isRegexOrWild()&&0<d&&(this.borderPalette=this.getUpdatedPalette(this.getPaletteProperty(!1,!1,!0),U.Border)),this.onColorsChange(),this.indexProp(w.PROP_XAXIS)),g=this.getAxisData(w.PROP_XAXIS),f=(a!==G.Baseline&&(i.cols&&!i.cols[g]||!g)&&h[0]&&(l=void 0,l=!t.breakdownColumns.length&&h.find(function(t){return!X.isString(i.cols[t].qtype)})||h[0],this.api.setProperty(y,l)),this.indexProp(w.PROP_YAXIS)),m=this.getAxisData(w.PROP_YAXIS);this.isCandlestick()?(this.setCandlestickProperties(),m&&this.api.setProperty(f,void 0)):a!==G.Baseline&&!m&&this.columns[1]&&(this.api.setProperty(f,"*"),this.setColorProperties())}catch(t){}this.setIgnoreSettings(!1),this.configure()}else this.config?this.onConfigComplete():this.appInvalidate(this.renderState);this.propertyCache[w.PROP_CURRENT_TICK]&&this.calcCurrentTickValues(),this.resetCache=!1},w.prototype.onResize=function(){this.renderState=z.Process},w.prototype.resizeImage=function(t,e,i){var n,o=document.createElement("canvas"),r=(o.width=e,o.height=i,o.getContext("2d"));return r?(e/i<(n=t.width/t.height)?0:0,r.drawImage(t,0,0,e,i),o):t},w.prototype.setDataIcons=function(){var n=this;if(this.dataIcons=[],this.dataIconColors=[],this.api.getProperty(this.indexProp(w.PROP_SETICONFROMDATA))&&this.cols)if(X.isWebGL2){var t=this.api.getProperty(this.indexProp(w.PROP_DATA_ICON));if(t)for(var o=this.cols[t],r=new Array(o.length),a=-1,s=this,e=0;e<o.length;e++)!function(e){var t=(t=X.getColScalar(o,e))||"fa-stop",i=s.onIconsChange(t);i&&(i.onload=function(){i&&n.el.removeChild(i);var t=n.resizeImage(i,64,64);r[e]=t,++a===o.length-1&&(n.dataIcons=r,n.invalidate(z.Process))})}(e);var i=this.api.getProperty(this.indexProp(w.PROP_DATA_ICON_COLOR));if(i&&t){for(var t=this.getLayerType(),l=t===G.Line?this.api.getProperty(this.indexProp(w.PROP_BUBBLES_OPACITY)):this.api.getProperty(this.indexProp(w.PROP_OPACITY)),h=this.cols[i],p=[],u=this.getLayerColors(t===G.Line?U.Bubble:U.Default),c=0;c<this.yAxes.length;c++){p[c]=[];for(e=0;e<h.length;e++){var d=this.colorArr.length?this.colorArr[c][e]:u[c],y=X.getColScalar(h,e);y?0!==y.indexOf("#")&&(y=X.HEX_CODES[y]||"#"+y):y=d,p[c].push(y)}}this.dataIconColors=te.getColorArray(p,l,null)}}else console.warn("ChartGL Set Icon From Data > Your browser does not support WebGL2. This feature requires a modern browser that supports texture arrays. Please try updating your browser or switching to Chrome, Firefox, or Edge.")},w.prototype.onSettingsChange=function(t){var e=[w.PROP_TYPE,w.PROP_XAXIS,w.PROP_YAXIS,w.PROP_XAXISID,w.PROP_YAXISID,w.PROP_BARWIDTHTYPE,w.PROP_BARPERCENT,w.PROP_BARFIXED,w.PROP_FILL,w.PROP_FADE,w.PROP_RADIUS_DATA,w.PROP_RADIUS_SCALE,w.PROP_SPAN_GAPS,w.PROP_COLORDATA,w.PROP_HIGHLIGHTRULES,w.PROP_X1_COORD,w.PROP_X2_COORD,w.PROP_INTERPOLATION,w.PROP_STEPPED,w.PROP_BASELINE_AXIS,w.PROP_BASELINE_VALUE,w.PROP_BUBBLES_COLOR,w.PROP_BUBBLES_OPACITY,w.PROP_OPACITY,w.PROP_LINETHICKNESS,w.PROP_LINE_STYLE,w.PROP_DASH_GAP,w.PROP_DASH_WIDTH,w.PROP_PALETTE_THEME],i=""+this.theme,n=".palette_theme",o=t[w.PROP_PALETTE_THEME],r=t[w.PROP_LINE_PALETTE_THEME],o=M.Tools.getPaletteFromTheme(this.globalPalette,o,n,i),r=M.Tools.getPaletteFromTheme(this.globalPalette,r,n,i),n=(o.updated&&this.api.setProperty(this.indexProp(w.PROP_PALETTE),o.palette),r.updated&&this.api.setProperty(this.indexProp(w.PROP_FILLPALETTE),r.palette),t[w.PROP_DATA]),i=t[w.PROP_TYPE],o=(void 0!==n&&n!==this.datasource&&i!==G.Baseline&&(this.propertyCache[w.PROP_DATA]=n,this.onDataSourceChange(n)),t[w.PROP_COLOR]),r=(""!==o&&o||this.setColorProperties(),t[w.PROP_BAR_ORIENTATION]),n=(r!==this.propertyCache[w.PROP_BAR_ORIENTATION]&&(this.propertyCache[w.PROP_BAR_ORIENTATION]=r),t[w.PROP_HIGHLIGHTRULES]),o=n&&n.length,r=(i!==G.Heatmap&&n&&!n.length&&this.highlightRules&&this.highlightRules.length&&(this.highlightRules=void 0),(o&&this.cols||i===G.Heatmap)&&e.push(w.PROP_COLOR,w.PROP_OPACITY),this.hasColorData()&&(!this.hasColorData()||this.cols)||(this.colorData=[],this.colorDataArr=[]),!1),n=!1,a=t[w.PROP_DATA_ICON],s=t[w.PROP_DATA_ICON_COLOR],a=(void 0!==a&&a!==this.propertyCache[w.PROP_DATA_ICON]&&(r=!0,""===(this.propertyCache[w.PROP_DATA_ICON]=a))&&(n=!0),void 0!==s&&s!==this.propertyCache[w.PROP_DATA_ICON_COLOR]&&(this.propertyCache[w.PROP_DATA_ICON_COLOR]=s,r=!0),t[w.PROP_SETICONFROMDATA]),s=(void 0!==a&&a!==this.propertyCache[w.PROP_SETICONFROMDATA]&&(this.propertyCache[w.PROP_SETICONFROMDATA]=a,this.setIconProperties(a),!(r=!0)===a)&&(n=!0),i===this.propertyCache[w.PROP_TYPE]||i!==G.Bubble&&i!==G.Line||this.setIconProperties(a),t[w.PROP_BUBBLES_COLOR]),a=((r=i===G.Line&&s!==this.propertyCache[w.PROP_BUBBLES_COLOR]&&this.hasDataIcons()?!0:r)&&(this.setDataIcons(),n)&&this.invalidate(z.Process),t[w.PROP_ICON]),s=(void 0!==a&&a!==this.icon&&(this.propertyCache[w.PROP_ICON]=a,this.onIconChange(a)),t[w.PROP_CURRENT_TICK]),r=(s!==this.propertyCache[w.PROP_CURRENT_TICK]&&((this.propertyCache[w.PROP_CURRENT_TICK]=s)?this.calcCurrentTickValues():(this.currentTickVals=[],this.appInvalidate(z.Axis))),i===G.Line&&this.getInterpolation()===et.Monotone&&e.push(w.PROP_SEG_LENGTH),this.isCandlestick()&&e.push(w.PROP_OPEN,w.PROP_HIGH,w.PROP_LOW,w.PROP_CLOSE,w.PROP_BEARCOLOR,w.PROP_BULLCOLOR,w.PROP_NEUTRALCOLOR,w.PROP_CANDLEWIDTHTYPE,w.PROP_CANDLEPERCENT,w.PROP_CANDLEFIXED,w.PROP_OPACITY),i===G.Bounds?e.push(w.PROP_PALETTE,w.PROP_OPACITY):i===G.Baseline&&this.setBaselineProperties(t[w.PROP_BASELINE_AXIS],t[w.PROP_BASELINE_VALUE]),t[w.PROP_CACHE_STREAMING]),n=(r!==this.propertyCache[w.PROP_CACHE_STREAMING]&&(this.propertyCache[w.PROP_CACHE_STREAMING]=r),t[w.PROP_ENABLED]),a=(n!==this.propertyCache[w.PROP_ENABLED]&&(this.propertyCache[w.PROP_ENABLED]=n,this.invalidate(z.Process)),t[w.PROP_LABEL_ENABLED]),s=this.api.getProperty(this.indexProp(Oe.PROP_LABEL_MAX_LABELS)),i=(a&&0<s&&(a!==this.propertyCache[w.PROP_LABEL_ENABLED]&&(e.push(w.PROP_LABEL_ENABLED),this.dataLabels.updateTheme(this.theme,this.index)),this.dataLabels.onSettingsChange(t),this.invalidate(z.Process)),t[w.PROP_FADE]),r=t[w.PROP_FILL],n=(this.cols&&r&&"No Fill"!==r&&this.isEnabled()&&(i||o?this.updateColors=!0:this.lineFillColors=void 0,e.push(w.PROP_FILLCOLOR,w.PROP_FILLOPACITY),this.isRegexOrWild())&&e.push(w.PROP_FILLPALETTE),t[w.PROP_LINE_STYLE]),s=this.propertyCache[w.PROP_LINE_STYLE];n!==s&&(this.setIgnoreSettings(!0),n===I.None?(this.api.setProperty(this.indexProp(w.PROP_DASH_GAP),void 0),this.api.setProperty(this.indexProp(w.PROP_DASH_WIDTH),void 0)):s===I.None&&(this.api.setProperty(this.indexProp(w.PROP_DASH_GAP),1),this.api.setProperty(this.indexProp(w.PROP_DASH_WIDTH),1)),this.setIgnoreSettings(!1)),this.configureIfDiff(t,e),this.invalidateIfDiff(t,w.PROP_COLOR,z.Uniforms),this.invalidateIfDiff(t,w.PROP_WICKCOLOR,z.Uniforms),this.invalidateIfDiff(t,w.PROP_OPACITY,z.Uniforms),this.invalidateIfDiff(t,w.PROP_FILLCOLOR,z.Uniforms),this.invalidateIfDiff(t,w.PROP_FILLOPACITY,z.Uniforms)},w.prototype.setIconProperties=function(t){var e=this.api.getProperty(this.indexProp(w.PROP_ICON)),i=this.api.getProperty(this.indexProp(w.PROP_DATA_ICON)),n=this.api.getProperty(this.indexProp(w.PROP_DATA_ICON_COLOR));t&&void 0!==e?(this.api.setProperty(this.indexProp(w.PROP_ICON),void 0),(this.propertyCache[w.PROP_ICON]=void 0)===i&&(this.api.setProperty(this.indexProp(w.PROP_DATA_ICON),""),this.propertyCache[w.PROP_DATA_ICON]=""),void 0===n&&(this.api.setProperty(this.indexProp(w.PROP_DATA_ICON_COLOR),""),this.propertyCache[w.PROP_DATA_ICON_COLOR]="")):t||void 0===this.api.getProperty(this.indexProp(w.PROP_DATA_ICON))||(this.api.setProperty(this.indexProp(w.PROP_ICON),""),this.propertyCache[w.PROP_ICON]="",void 0!==i&&(this.api.setProperty(this.indexProp(w.PROP_DATA_ICON),void 0),this.propertyCache[w.PROP_DATA_ICON]=void 0),void 0!==n&&(this.api.setProperty(this.indexProp(w.PROP_DATA_ICON_COLOR),void 0),this.propertyCache[w.PROP_DATA_ICON_COLOR]=void 0))},w.prototype.getAxisGroupColsData=function(){var i,n,o,r,a,e=this,t=this.api.getProperty(this.indexProp(w.PROP_MULTI_AXIS));return this.cols&&t?(t=(i=X.isRegexOrWild(t)?this.getColumnKeysFromAxisString(t):[t]).map(function(t){return e.cols?e.cols[t]:{}}),n=this.getLayerType(),o=this.isFilterUnique("x"),r=this.isSorted("x"),a={},t.map(function(t,e){return X.getCategoryData(t,n,o,r,a).concat(i[e])})):[]},w.prototype.getHeatmapScore=function(){var t=this.api.getProperty(this.indexProp(w.PROP_HEATMAP_SCORE));return this.cols?this.cols[t]:null},w.prototype.getPerformanceTrack=function(){return this.performanceTrack},w.prototype.processData=function(n,t,e,i,o,r,a,s){var l,h,p,u,c,d,y,g,f,m,P,x,v,O,T,R,b,_,C=this;this.renderState===z.Process&&this.config&&(l=(h=this.config).xCol,h=h.yCols,l&&l.length&&(p=this.propertyCache[w.PROP_TYPE]||this.api.getProperty(this.indexProp(w.PROP_TYPE)),this.renderer&&this.renderer.remove(n),this.rendererFill&&this.rendererFill.remove(n),this.rendererBubble&&this.rendererBubble.remove(n),u={dataIcons:"",dataIconColors:""},void 0!==(_=this.propertyCache[w.PROP_SETICONFROMDATA])&&_&&(_=this.propertyCache[w.PROP_DATA_ICON],m=this.propertyCache[w.PROP_DATA_ICON_COLOR],_&&this.dataIcons.length&&(this.texture&&(n.deleteTexture(this.texture),this.texture=null),_=D.createTextureArray(n,this.index,this.dataIcons),u.dataIcons=this.dataIcons.map(function(t,e){return e}),this.textureArray=_),m)&&this.dataIconColors.length&&(u.dataIconColors=this.dataIconColors),_=this.propertyCache[w.PROP_ICON],m=this.propertyCache[w.PROP_RADIUS_SCALE],_&&this.image&&this.image.height&&this.image.complete&&0<m&&(this.textureArray&&(n.deleteTexture(this.textureArray),this.textureArray=null),_=this.api.getProperty(Te.PROP_PATTERNS)?this.patternLayerIndex:this.index,this.texture=D.createTexture(n,this.image,_,!1)),this.patternTextures={},this.patternIndices={},this.hasPatterns()&&(c=Object.keys(this.patterns),d=this.getLayerColors(U.Default).filter(function(t,e){e=c[e];return-1===C.disabledColumns.indexOf(e)}),c.filter(function(t){return-1===C.disabledColumns.indexOf(t)}).forEach(function(t,e){var i=C.createPattern(t,d[e%d.length],n);C.patternTextures[t]=D.createTexture(n,i.patternCanvas,C.patternLayerIndex+e,!0),C.patternIndices[t]=C.patternLayerIndex+e})),m=this.getAxisId("x"),_=this.getAxisId("y"),y=this.api.getProperty(this.indexProp(w.PROP_OPACITY)),g={},this.cols&&p===G.Bounds&&null!==o?g={x1:this.cols[this.api.getProperty(this.indexProp(w.PROP_X1_COORD))],x2:this.cols[this.api.getProperty(this.indexProp(w.PROP_X2_COORD))],yRange:new Y(e.y,e.w),palette:this.getPaletteProperty(),opacity:y,yType:o}:p===G.Heatmap&&this.cols?g={x1:this.cols[this.api.getProperty(this.indexProp(w.PROP_HEATMAP_X1))],x2:this.cols[this.api.getProperty(this.indexProp(w.PROP_HEATMAP_X2))],y1:this.cols[this.api.getProperty(this.indexProp(w.PROP_HEATMAP_Y1))],y2:this.cols[this.api.getProperty(this.indexProp(w.PROP_HEATMAP_Y2))],score:this.cols[this.api.getProperty(this.indexProp(w.PROP_HEATMAP_SCORE))],color:this.getPaletteProperty(),opacity:y}:(this.isBar()||this.isCandlestick())&&e&&null!=t&&t.x?(o=this.api.getProperty(this.indexProp(w.PROP_BARWIDTHTYPE)),T=this.api.getProperty(this.indexProp(w.PROP_BARPERCENT))/100,f=this.api.getProperty(this.indexProp(w.PROP_BARFIXED)),T="Percentage"===o?T:f,f=this.api.getProperty("Xaxes."+m+".Stacked"),_=(m=this.api.getProperty("Yaxes."+_+".Stacked"))&&this.api.getProperty("Yaxes."+_+".StackedGap"),x=this.api.getProperty(this.indexProp(w.PROP_INCREASE_COLOR)),v=this.api.getProperty(this.indexProp(w.PROP_DECREASE_COLOR)),b=this.getLayerColors(U.Default),R=this.getBarOrientation()||w.BAR_VERTICAL,O=this.api.getProperty(this.indexProp(w.PROP_BORDER_WIDTH)),P=0,_&&(_=this.isHorizontal()?Number(e.z)-Number(e.x):Number(e.w)-Number(e.y),P=Math.abs(_)/t.y*5),g={barGrouping:a,barWidth:T,barType:o,borderWidth:O,mergedBounds:e,viewBounds:i,orientation:R,size:t,stacked:f&&m?"xy":f?"x":m?"y":"",stackedGapSize:P,textures:this.hasPatterns()?this.patternTextures:null,waterfallInfo:p===G.Waterfall?{increaseColor:x,decreaseColor:v,defaultColor:b,opacity:y}:void 0},this.isCandlestick()&&(_=this.api.getProperty(this.indexProp(w.PROP_BEARCOLOR)),a=this.api.getProperty(this.indexProp(w.PROP_BULLCOLOR)),T=this.api.getProperty(this.indexProp(w.PROP_NEUTRALCOLOR)),o=this.api.getProperty(this.indexProp(w.PROP_CANDLEWIDTHTYPE)),O=this.api.getProperty(this.indexProp(w.PROP_CANDLEPERCENT))/100,i=this.api.getProperty(this.indexProp(w.PROP_CANDLEFIXED)),R="Percentage"===o?O:i,g=A(A({},g),{bearColor:_,bullColor:a,neutralColor:T,bodyWidth:R,opa:y,widthType:o}))):p!==G.Line&&p!==G.Baseline||(f=this.propertyCache[w.PROP_SPAN_GAPS],m=this.propertyCache[w.PROP_INTERPOLATION],P=this.propertyCache[w.PROP_STEPPED],x=this.hasBubbles(),v=this.propertyCache[w.PROP_SEG_LENGTH]||this.api.getProperty(this.indexProp(w.PROP_SEG_LENGTH)),O={lineThickness:0<(b=this.propertyCache[w.PROP_LINETHICKNESS])?b:1,bounds:e,size:t,xType:this.XType,yType:this.YType},i=this.propertyCache[w.PROP_LINE_STYLE],_=this.propertyCache[w.PROP_DASH_GAP],a=this.propertyCache[w.PROP_DASH_WIDTH],T=this.hasLineStyle(),g={baselineInfo:this.baselineInfo,color:this.getLayerColors(U.Default),dashGap:_,dashWidth:a,hasBubbles:x,interpolation:m,isStreaming:this.isStreaming,lineStyle:T?i:"None",lineThickness:O,opacity:y,segmentLength:v,spanGaps:f,steppedLine:P,useThickLines:this.isThickLines(),zoomVal:r}),R={},this.isFilterUnique("x")&&(R.x=!0),this.isFilterUnique("y")&&(R.y=!0),g.filterUnique=R,o={},this.isSorted("x")&&(o.x=!0),this.isSorted("y")&&(o.y=!0),g.sortedAxis=o,b={},this.isTriggerBreakApplied("x")&&(b.x=this.getTriggerBreakInfo("x")),this.isTriggerBreakApplied("y")&&(b.y=this.getTriggerBreakInfo("y")),s&&(b[s[1]].breaksToApply=s[0],b.zoom=s[2]),e=!this.isStreaming||this.isStreaming&&this.resetCache,this.renderer=this.config.createRenderer(n,e,this.getLayerType(),this.isWebGL2,p===G.Bubble&&null!==this.texture,u,g,this.colorData,new Y(this.getAxisType("x"),this.getAxisType("y")),this.hasDataLabels(),this.isCachingData()?this.newDataLength:null,p===G.Bubble?this.dataIconColors:[],this.highlightRules,this.lineFillColors,b),p===G.Line)&&this.hasBubbles()&&(t=this.getLayerColors(U.Bubble),g=A(A({},g),{useThickLines:!1,color:t,opacity:this.propertyCache[w.PROP_BUBBLES_OPACITY]}),this.rendererBubble=this.config.createRenderer(n,e,G.LineBubble,this.isWebGL2,null!==this.texture,u,g,this.colorData,new Y(this.getAxisType("x"),this.getAxisType("y")),this.hasDataLabels(),this.isCachingData()?this.newDataLength:null,this.dataIconColors,this.highlightRules,this.lineFillColors,b)),_=this.propertyCache[w.PROP_TYPE]===G.Line,a=this.propertyCache[w.PROP_FILL],_&&"No Fill"!==a||(this.renderState=z.Uniforms),this.setupWorker(l,h))},w.prototype.getWildcardColumns=function(){var e=this;return this.yAxes.filter(function(t){return-1===e.disabledColumns.indexOf(t)})},w.prototype.processLineFillData=function(t,e){var i,n,o,r,a;this.config&&(n=this.api.getProperty(this.indexProp(w.PROP_COLORDATA)),i=[],this.hasColorData()&&this.cols&&(n=this.calculateColorData(n),i=this.convertColorData(n,!0)),n={},this.isTriggerBreakApplied("x")&&(n.x=this.getTriggerBreakInfo("x")),this.isTriggerBreakApplied("y")&&(n.y=this.getTriggerBreakInfo("y")),r=null,this.propertyCache[w.PROP_INTERPOLATION]===et.Monotone&&(r=(null==(o=this.renderer)?void 0:o.getCatmullPoints())||null),o=null!==this.texture,r={spanGaps:this.propertyCache[w.PROP_SPAN_GAPS],interpolation:this.propertyCache[w.PROP_INTERPOLATION],steppedLine:this.propertyCache[w.PROP_STEPPED],color:this.getLayerColors(U.Fill),opacity:this.api.getProperty(this.indexProp(w.PROP_FILLOPACITY)),catmullPoints:r},a={},this.isFilterUnique("x")&&(a.x=!0),this.isFilterUnique("y")&&(a.y=!0),r.filterUnique=a,a={},this.isSorted("x")&&(a.x=!0),this.isSorted("y")&&(a.y=!0),r.sortedAxis=a,a=!this.isStreaming||this.isStreaming&&this.resetCache,this.rendererFill=this.config.createRenderer(t,a,G.LineFill,this.isWebGL2,o,{},r,i,new Y(this.getAxisType("x"),this.getAxisType("y")),!1,this.isCachingData()?this.newDataLength:null,null,this.highlightRules,this.lineFillColors,n,[e,this.propertyCache[w.PROP_FADE]])),this.renderState=z.Uniforms},w.prototype.removeWebGLRefs=function(t){this.renderer&&(this.renderer.remove(t),this.renderer=null),this.rendererBubble&&(this.rendererBubble.remove(t),this.rendererBubble=null),this.rendererFill&&(this.rendererFill.remove(t),this.rendererFill=null),this.texture&&(t.deleteTexture(this.texture),this.texture=null),this.textureArray&&(t.deleteTexture(this.textureArray),this.textureArray=null),Object.keys(this.patternTextures).length&&this.unsetPatterns(t)},w.prototype.remove=function(t){this.cols=void 0,this.columns=[],this.config=null,this.datasource&&(this.source.unsubscribe(),this.datasource.off("change:queryStatus",this.datasourceStatusFn)),this.removeWebGLRefs(t),this.worker&&this.worker.terminate()},w.prototype.render=function(t,e,i,n,o){var r=n===U.Fill,a=n===U.Bubble,s=r?G.LineFill:this.propertyCache[w.PROP_TYPE],l=this.propertyCache[w.PROP_WICKCOLOR],h=this.propertyCache[w.PROP_RADIUS_DATA],p=(this.propertyCache[w.PROP_RADIUS_SCALE],this.propertyCache[a?w.PROP_BUBBLES_OPACITY:r?w.PROP_FILLOPACITY:w.PROP_OPACITY]),u={};this.hasBorders()&&(d=this.getLayerColors(U.Border),c=this.api.getProperty(this.indexProp(w.PROP_BORDER_OPACITY)),u={width:this.api.getProperty(this.indexProp(w.PROP_BORDER_WIDTH))/20,opacity:c,colors:d});var c=this.hasLineStyle()&&this.propertyCache[w.PROP_LINE_STYLE]===I.Dotted,d=c?Number(this.propertyCache[w.PROP_LINETHICKNESS])+1:this.texture||this.textureArray?1.333*Number(this.propertyCache[w.PROP_RADIUS_SCALE]):Number(this.propertyCache[w.PROP_RADIUS_SCALE]),y=!c&&0<i?1/i:1,g=d*y,f=this.getWildcardColumns(),m=this.propertyCache[w.PROP_SPAN_GAPS],P=this.isThickLines(),x=this.texture||this.dataIcons.length?this.api.getProperty(Te.PROP_PATTERNS)?this.patternLayerIndex:this.index:void 0,h=(i&&this.hasBubbles()&&"Fixed Size"!==h&&null!=(h=this.renderer)&&h.updatePointSizeOnZoom(y),a?this.rendererBubble:r?this.rendererFill:this.renderer);o&&(this.baselineInfo.types=o),h&&h.render(e,this.isCandlestick()?[l]:this.getLayerColors(n,!0),i&&d<=g?g:d,a||c?G.Bubble:s,p,m,f,P,r,u,this.hasPatterns()?this.patternIndices:void 0,this.getBarOrientation()||w.BAR_VERTICAL,x,this.cols?this.cols[this.api.getProperty(this.indexProp(w.PROP_X1_COORD))]:void 0,this.baselineInfo)},w.prototype.removeLabels=function(){this.dataLabels.removeLabels()},w.prototype.setFocus=function(t){this.source&&this.source.getParent().setFocus(t)},w.prototype.setPatterns=function(t){this.patterns=t},w.prototype.setPatternIndex=function(t){this.patternLayerIndex=t},w.prototype.unsetPatterns=function(e){var i=this;this.patterns={},this.patternLayerIndex=0,Object.keys(this.patternTextures).forEach(function(t){e.deleteTexture(i.patternTextures[t])})},w.prototype.updateOverrideColors=function(t){this.overrideColors=t,this.colorsNeedUpdate()&&(this.renderState=z.Process,this.onColorsChange())},w.prototype.updateOverridePalette=function(t){this.overridePalette=t.length?this.getPaletteProperty(!1,!1,!1,t):[],this.colorsNeedUpdate()&&(this.renderState=z.Process,this.onColorsChange())},w.prototype.updatePerformanceTracker=function(t){this.performanceTrack&&!t||(this.performanceTrack=t?0:Date.now())},w.prototype.updateRenderState=function(){this.renderState=z.Process},w.prototype.getDataSource=function(){return this.getLayerType()===G.Baseline?{}:this.datasource},w.prototype.updateAxisId=function(t,e){e=e.toUpperCase(),this.api.setProperty(this.indexProp("possible"+e+"Axes"),t);var i=this.api.getProperty(this.indexProp(e+"AxisId"));t.length&&-1===t.indexOf(i)&&this.api.setProperty(this.indexProp(e+"AxisId"),e+"-Axis 1")},w.prototype.updateColumns=function(t,e){t&&(this.disabledColumns=t),e||this.configure()},w.prototype.updateLayer=function(t,e,i){var n=this;t&&this.api.setProperty(this.indexProp(w.PROP_DATA),t),_.each(e,function(t,e){n.api.setProperty(n.indexProp(i[e]),t)})},w.prototype.wildcardDataChanged=function(t){return this.isRegexOrWild()&&this.propertyCache[w.PROP_DATA]!==t},w.prototype.calcCurrentTickValues=function(){var t,e,o,r,a,i,s,l,h,p=this;this.propertyCache[w.PROP_CURRENT_TICK]&&this.cols&&this.config&&(t=this.config.xCol,e=this.api.getProperty("Xaxes."+this.getAxisId("x")+".Type"),i=this.getSortedIndices(e,t)[0])&&void 0!==(o=i((!(e!==W.TYPE_CATEGORY&&t.hasIndex&&t.hasIndex())&&this.workerIndex.length?this.workerIndex:this.cols[Object.keys(this.cols)[0]]).length-1))&&(r=this.getRowData(o),a=[],r&&(i=this.getAxisId("y"),s=this.api.getProperty("Yaxes."+i+W.PROP_FORMAT),l=this.api.getProperty("Yaxes."+i+W.PROP_PRECISION),h=this.api.getProperty("Yaxes."+i+W.PROP_HIDETRAIL),this.yAxes.forEach(function(t,e){i=p.getLayerType()===G.Heatmap&&p.cols?(n=p.cols[p.api.getProperty(p.indexProp(w.PROP_HEATMAP_SCORE))],i=X.getRange(n),Qt.interpolateColor(p.palette,Number(i[0]),Number(i[1]),Number(X.getColScalar(n,o)))):p.isRegexOrWild()?p.palette[e]:p.api.getProperty(p.indexProp(w.PROP_COLOR));var i,n=X.formatData(r[t],s,l,h);a.push([n,i])})),this.currentTickVals=a,this.appInvalidate(z.Axis))},w.prototype.calculateColorData=function(t,e){this.disabledColorDataIndices=[];var i=[];if(this.cols&&this.cols[t]){for(var n,o=this.cols,r=[],a=[],s=function(t){return null===t?null:M.Tools.isKDBTemporal(t)?M.Tools.convertKDBTemporalToMoment(t).toDashString():X.getValueFromObject(t)},l=0,h=0;h<o[t].length;h++)"object"==typeof(p=o[t].getValue(h))&&(p=s(p)),-1===r.indexOf(p)&&(r.push(p),n=this.getPaletteProperty(!1,!!e),a.push(n[l%n.length]),l++);e||(this.colorDataInfo=[r,a]);for(var p,h=0;h<o[t].length;h++)"object"==typeof(p=o[t].getValue(h))&&(p=s(p)),this.disabledColumns&&-1<this.disabledColumns.indexOf(p.toString())?(i.push(""),this.disabledColorDataIndices.push(h)):i.push(a[r.indexOf(p)])}else this.colorDataInfo=[[],[]],this.colorData=[],this.colorDataArr=[];return i},w.prototype.configure=function(){this.config=null;var e=this.getLayerType();if(this.cols||e===G.Baseline){var i=this.cols,n=(e===G.Heatmap&&i&&(n=this.api.getProperty(this.indexProp(w.PROP_HEATMAP_SCORE)),i=_.omit(i,n)),this.getAxisData(w.PROP_YAXIS));if(this.isCandlestick()||n||(this.setIgnoreSettings(!0),this.api.setProperty(this.indexProp(w.PROP_YAXIS),"*"),this.setIgnoreSettings(!1)),this.updateYAxesVals(),this.isRegexOrWild()&&-1===(null==n?void 0:n.indexOf("*"))){var n=_.keys(_.groupBy(this.yAxes,function(t){return i[t].qtype})),o=[E.Byte,E.Short,E.Int,E.Long,E.Double,E.Float,E.Char],r=[E.Timestamp,E.Month,E.Date,E.DateTime,E.Timespan,E.Minute,E.Second,E.Time];if(n.some(function(t){return 0<=r.indexOf(Number(t))})&&n.some(function(t){return 0<=o.indexOf(Number(t))}))return void this.api.showErrorMessage({error:t("Can't mix date types with number types on ")+"<b>"+t("Properties > Layer > Y-Axis Data")+"</b>",type:"Error"})}var n=_.difference(this.yAxes,this.hasColorData()?[]:this.disabledColumns),a=(this.setColorProperties(),this.setIgnoreSettings(!0),e===G.Bounds&&this.setBoundsProperties(),e===G.Bounds?w.PROP_X1_COORD:e===G.Heatmap?w.PROP_HEATMAP_X1:w.PROP_XAXIS),a=this.getAxisData(a),a=(a||e===G.Bounds||this.api.setProperty(this.indexProp(w.PROP_XAXIS),this.columns[0]),this.cols?this.cols[a]:null),s=["Fixed Size"].concat(this.columns),l=this.api.getProperty(this.indexProp(w.PROP_POSSIBLE_RADIUS)),l=(e!==G.Bubble&&e!==G.Line||_.isEqual(s,l)||this.api.setProperty(this.indexProp(w.PROP_POSSIBLE_RADIUS),s),e===G.Line&&this.setLineFillProperties(),this.setIgnoreSettings(!1),n.map(function(t){return i[t]}).filter(function(t){return t})),s=this.api.getProperty(this.indexProp(w.PROP_RADIUS_DATA)),h=this.api.getProperty(this.indexProp(w.PROP_RADIUS_SCALE)),s=this.hasBubbles()&&this.cols?"Fixed Size"===s?"":this.cols[s]:null;(a&&l||e===G.Bounds||e===G.Baseline)&&(e===G.Baseline&&(a={qtype:E.Float,length:2},l=[{qtype:E.Float,length:2}]),e=Number(null==(e=null==(e=this.datasource)?void 0:e.attributes)?void 0:e._maxRows),this.config=new ie(a,l,n,e,[s,h]),this.onConfigComplete())}},w.prototype.configureIfDiff=function(s,t){var l=this,h=!1;t.forEach(function(t){var e,i,n=s.hasOwnProperty(t)&&!l.propertyCache.hasOwnProperty(t)||!_.isEqual(s[t],l.propertyCache[t]),o="Opacity"===t||"Color"===t||"YAxis"===t||"SpanGaps"===t,r="ColorData"===t,a="HighlightRules"===t;t===w.PROP_TYPE&&(e=s[t],(i=l.propertyCache[w.PROP_TYPE])&&i!==G.Line&&e===G.Line?l.api.setProperty(l.indexProp(w.PROP_RADIUS_SCALE),0):i===G.Line&&e===G.Bubble&&l.api.setProperty(l.indexProp(w.PROP_RADIUS_SCALE),4)),n&&(o||r||a)&&(l.updateColors=!0),n&&(h=h||n,l.propertyCache[t]=_.get(s,t))}),this.updateColors&&(this.onColorsChange(),this.updateColors=!1),h&&this.configure()},w.prototype.convertNanos=function(t,e,i){var t="x"===e||"y"===e?Math.floor(t[e]):Math.ceil(t[e]),n=this.isHorizontal()&&("y"===e||"w"===e),e="x"===e||"z"===e||n?this.XType:this.YType;return M.Tools.convertValueToMoment(X.convertToJsScalar(e,X.toBigInt(t)+i))},w.prototype.getAllWildcards=function(t,e,i,n){t=n(t);for(var o=i.getPoint(t),r=[],a=1;a<o.length;a++)r.push([t,X.calculateRelativePoint(new Y(o[0],o[a]),e),i.yColNames[a-1],a-1]);return r},w.prototype.getClosestPoint=function(t,e,i,n,o,r,a){for(var s=1,l=(t=n(t),i.getPoint(t,a,r)),n=this.api.getProperty("Yaxes."+this.getAxisId("y")+".Stacked"),h=this.getStackedYData(),p=n&&h&&this.getLayerType()===G.Bar,a=this.getAxisType("x"),u=this.getAxisType("y"),r=p?h[0][t]:l[1],c=(u===W.TYPE_CATEGORY&&(r=this.getConvertedCategoryData(t,"y",0)),X.calculateRelativeValue(r,e.y,e.w)),d=Math.abs(o-c),y=1,g=2;g<l.length;g++){var f=l[g],f=(p&&(f=h[g-1][t]),u===W.TYPE_CATEGORY&&(f=this.getConvertedCategoryData(t,"y",g-1)),X.calculateRelativeValue(f,e.y,e.w)),m=Math.abs(f-o);m<d&&(y=g),((p?o<=f&&(m<d||c<o):m<d)||isNaN(Number(l[s])))&&(d=m,s=g,c=f)}var n=l[s=p&&c<o?y:s],r=X.calculateRelativePoint(new Y(l[0],n),e),a=(a===W.TYPE_CATEGORY&&(r=new Y(l[0],r.y)),u===W.TYPE_CATEGORY&&(r=new Y(r.x,l[s])),this.isHorizontal());return a&&(r=X.calculateRelativePoint(new Y(n,l[0]),new V(e.y,e.x,e.w,e.z))),p&&(n=h[s-1][t],n=X.calculateRelativeValue(n,e.y,e.w),r=new Y(a?n:r.x,a?r.y:n)),[t,r,i.yColNames[s-1],s-1]},w.prototype.getClosestXPoint=function(i,n,e,o,r){var a=i[0],t=i.map(function(t){return e.getPoint(o(t))[0]}),s=Math.abs(r-X.calculateRelativeValue(t[0],n.x,n.z));return _.each(t,function(t,e){"number"!=typeof t&&"bigint"!=typeof t||(t=X.calculateRelativeValue(t,n.x,n.z),(t=Math.abs(t-r))<s&&(s=t,a=i[e]))}),a},w.prototype.getColorDataRange=function(t){var o,r,a=this.disabledColorDataIndices;return t.forEach(function(n){_.each(n,function(t,e){e=Number(e);var i=X.getColScalar(n,e);-1===a.indexOf(e)&&!isNaN(i)&&((r<i||void 0===r)&&(r=i),i<o||void 0===o)&&(o=i)})}),X.convertVec2ToJsScalar(new Y(o,r),t[0].qtype,t[0].qtype)},w.prototype.getLayerColors=function(t,e){var i,n=this,o=this.palette,r=w.PROP_COLOR,a=!1,s=this.getLayerType(),s=(t===U.Fill?(r=w.PROP_FILLCOLOR,o=this.fillPalette):t===U.Bubble?(r=w.PROP_BUBBLES_COLOR,a=s===G.Line):t===U.Border&&(r=w.PROP_BORDER_COLOR,o=this.borderPalette),[this.api.getProperty(this.indexProp(r))]);return!this.isRegexOrWild()&&this.getLayerType()!==G.Heatmap||(o.length&&e?s=o:(s=this.getPaletteProperty(!1,t===U.Fill,t===U.Border),e&&(s=this.getUpdatedPalette(s,t)))),s=a||t===U.Fill||(this.overridePalette.length&&this.isRegexOrWild()&&(s=this.overridePalette,e)&&(i=this.getAllCols(),s=s.filter(function(t,e){e=i[e];return-1===n.disabledColumns.indexOf(e)})),e&&this.isRegexOrWild())?s:this.applyOverrideRulesColors(this.getAllCols(),s)},w.prototype.applyOverrideRulesColors=function(t,i){var n=this;return Object.keys(this.overrideColors).length&&t.forEach(function(t,e){n.overrideColors[t]&&(i[e]=n.overrideColors[t])}),i},w.prototype.getSortedIndices=function(t,e){var i,n;return[t!==W.TYPE_CATEGORY&&e.hasIndex&&e.hasIndex()?(i=e.length,function(t){return e.getIndexFromSortedIndex(t)}):this.workerIndex.length?(i=this.workerIndex.length,n=this.workerIndex,function(t){return n[t]}):null,i]},w.prototype.getTriggerBreakInfo=function(t){var e=this.getAxisId(t),t=t.toUpperCase()+"axes.";return{breakVal:this.api.getProperty(t+e+W.PROP_BREAK),triggerBreak:this.api.getProperty(t+e+W.PROP_TRIGGER_BREAK)}},w.prototype.getUpdatedPalette=function(t,e){var i=this.getLayerType()===G.Line&&e===U.Bubble;if(this.overridePalette.length&&e!==U.Fill&&e!==U.Border&&!i&&this.isRegexOrWild()&&(t=this.overridePalette),this.api.getProperty(this.indexProp(w.PROP_TYPE))===G.Heatmap)return t;for(var n=this.getAllCols(),o=0,r=[];r.length<n.length;)r[o]=t[o%t.length],o++;e!==U.Fill&&e!==U.Border&&!i&&Object.keys(this.overrideColors).length&&(r=this.applyOverrideRulesColors(n,r));e=this.disabledColumns;return _.each(e,function(t){return r[n.indexOf(t)]=""}),r.filter(function(t){return 0<t.length})},w.prototype.getY=function(n,o,e,r,a,i){var s,l,h,p,t,u,c=this,d=n[0],y=[];return _.each(n,function(t){t=r(t),(s=e.getPoint(t,i))&&(2<s.length?y.push(s.slice(1)):y.push(s[1]))}),y.length?(p=this.getAxisType("y"),t=(2<s.length&&Array.isArray(y[0])?y[0]:y)[0],p===W.TYPE_CATEGORY&&(t=this.getConvertedCategoryData(r(n[0]),"y",0)),u=Math.abs(a-X.calculateRelativeValue(t,o.y,o.w)),_.each(y,function(t,i){2<s.length&&Array.isArray(t)?_.each(t,function(t,e){p===W.TYPE_CATEGORY&&(t=c.getConvertedCategoryData(r(n[i]),"y",e)),l=X.calculateRelativeValue(t,o.y,o.w),(h=Math.abs(l-a))<u&&(u=h,d=n[i])}):"number"!=typeof t&&"bigint"!=typeof t||(p===W.TYPE_CATEGORY&&(t=c.getConvertedCategoryData(r(n[i]),"y",0)),l=X.calculateRelativeValue(t,o.y,o.w),(h=Math.abs(l-a))<u&&(u=h,d=n[i]))}),d):null},w.prototype.getYAxesVals=function(){var t,e,i=this.cols,n=this.getLayerType();return i&&n!==G.Baseline?(e=this.getAxisData(w.PROP_XAXIS),t=n===G.Heatmap?"*":this.getAxisData(w.PROP_YAXIS),n=this.isRegexOrWild()||n===G.Heatmap?this.getColumnKeysFromAxisString(t):[t],t&&-1!==t.indexOf("*")&&(t=_.without(n,e),e=_.maxBy(_.values(_.groupBy(t,function(t){return i[t].qtype})),function(t){return t.length}))?e:n):this.yAxes},w.prototype.hasBorders=function(){var t=this.getLayerType(),e=this.api.getProperty(this.indexProp(w.PROP_BORDER_WIDTH));return(t===G.Bar||t===G.Waterfall)&&0<e},w.prototype.invalidate=function(t){t<this.renderState&&(this.renderState=t),this.appInvalidate(this.renderState)},w.prototype.invalidateIfDiff=function(t,e,i){void 0!==t[e]&&t[e]!==this.propertyCache[e]&&(this.propertyCache[e]=t[e],this.invalidate(i))},w.prototype.isCachingData=function(){return this.propertyCache[w.PROP_CACHE_STREAMING]&&this.isStreaming&&!this.resetCache},w.prototype.isDashedLine=function(){var t=this.propertyCache[w.PROP_LINE_STYLE];return!!(t&&"None"!==t&&0<this.propertyCache[w.PROP_DASH_GAP]&&0<this.propertyCache[w.PROP_DASH_WIDTH])},w.prototype.isFilterUnique=function(t){var e=this.getAxisId(t),t=t.toUpperCase()+"axes.",i=this.api.getProperty(t+e+W.PROP_TYPE),t=this.api.getProperty(t+e+W.PROP_FILTER_UNIQUE);return i===W.TYPE_CATEGORY&&t},w.prototype.isSorted=function(t){var e=this.getAxisId(t),t=t.toUpperCase()+"axes.",i=this.api.getProperty(t+e+W.PROP_TYPE),t=this.api.getProperty(t+e+W.PROP_SORTED);return i===W.TYPE_CATEGORY&&t},w.prototype.isTriggerBreakApplied=function(t){var e=this.getAxisId(t),t=t.toUpperCase()+"axes.",i=this.api.getProperty(t+e+W.PROP_TYPE),t=this.api.getProperty(t+e+W.PROP_DISTRIBUTION);return i===W.TYPE_TIME&&"Smart"===t},w.prototype.onDataSourceChange=function(t,e){var i,n=this;this.api.getProperty("Basics.TrackLoadTime")&&this.updatePerformanceTracker(!1),this.datasource&&(this.datasource.off("change:queryStatus",this.datasourceStatusFn),this.source)&&this.source.unsubscribe(),this.datasource=t,this.datasource?(t=null==(t=null==t?void 0:t.dataSet2)?void 0:t.breakdownColumns,i=_.first(X.focus2Array(this.api.getProperty(Te.PROP_FOCUS)))||[],this.source=e||new oe(this.datasource,this,this.api,i,this.depth,t),this.cols=void 0,this.columns=[],this.isStreaming="streaming"===this.datasource.attributes._subscriptionType,this.renderState=z.Data,this.source.subscribe(),this.datasourceStatusFn=function(t,e){e&&"Loading"===e.type&&n.invalidate(z.Data)},this.datasource.on("change:queryStatus",this.datasourceStatusFn)):(this.renderState=z.Init,this.isStreaming=!1),this.appInvalidate(this.renderState)},w.prototype.onConfigComplete=function(){this.renderState=z.Process,this.appInvalidate(this.renderState)},w.prototype.onLineFillChange=function(t){var i=this,e=this.api.getProperty(this.indexProp(w.PROP_FILL)),n=this.api.getProperty(this.indexProp(w.PROP_FADE)),o=this.api.getProperty(this.indexProp(w.PROP_FILLOPACITY)),r=this.getAxisData(w.PROP_YAXIS),a=this.api.getProperty(this.indexProp(w.PROP_SPAN_GAPS)),s=this.api.getProperty(this.indexProp(w.PROP_INTERPOLATION)),l=this.getLayerColors(U.Fill),h=this.api.getProperty(this.indexProp(w.PROP_STEPPED)),p=this.getWildcardColumns(),u=[],c=(p.forEach(function(t,e){i.cols&&i.cols[t]&&u.push(i.cols[t])}),te.computeHighlightRules(t,l,this.getAxisData(w.PROP_XAXIS),r,this.cols,u,p,n,l,a,s===et.Stepped,h,s===et.Monotone,this.colorDataArr,!0));a&&c.forEach(function(t,e){if(Array.isArray(t)){for(var i=t.filter(function(t){return t}),n=i.length;n<t.length;n++)i.push("");c[e]=i}}),this.lineFillColors=te.getColorArray(c,0,null,e&&"No Fill"!==e,o)},w.prototype.onColorsChange=function(){var t=this.api.getProperty(this.indexProp(w.PROP_COLORDATA)),t=(this.hasColorData()&&(t=this.calculateColorData(t),this.convertColorData(t)),this.propertyCache[w.PROP_HIGHLIGHTRULES]||this.api.getProperty(this.indexProp(w.PROP_HIGHLIGHTRULES))),e=this.api.getProperty(this.indexProp(w.PROP_TYPE)),e=((null!=t&&t.length||e===G.Heatmap)&&this.onHighlightRuleChange(t),this.api.getProperty(this.indexProp(w.PROP_FILL))),i=this.api.getProperty(this.indexProp(w.PROP_FADE));e&&"No Fill"!==e&&(null!=t&&t.length||i)&&(e=this.api.getProperty(this.indexProp(w.PROP_FILLCOLOR)),this.isRegexOrWild()||e||this.setLineFillProperties(),this.onLineFillChange(t))},w.prototype.onHighlightRuleChange=function(t){var i=this,e=this.api.getProperty(this.indexProp(w.PROP_TYPE)),n=e===G.Heatmap?"*":this.getAxisData(w.PROP_YAXIS),o=this.api.getProperty(this.indexProp(w.PROP_SPAN_GAPS)),r=this.api.getProperty(this.indexProp(w.PROP_INTERPOLATION)),a=this.api.getProperty(this.indexProp(w.PROP_STEPPED)),s=this.getLayerColors(U.Default),l=(e!==G.Line||!this.hasBubbles()||(this.isRegexOrWild()||this.propertyCache[w.PROP_COLOR]===this.propertyCache[w.PROP_BUBBLES_COLOR])&&this.propertyCache[w.PROP_OPACITY]===this.propertyCache[w.PROP_BUBBLES_OPACITY]||(s=[]),this.api.getProperty(this.indexProp(w.PROP_OPACITY))),h=this.getWildcardColumns(),p=[],u=(h.forEach(function(t,e){i.cols&&i.cols[t]&&p.push(i.cols[t])}),this.api.getProperty(this.indexProp(w.PROP_HEATMAP_SCORE))),c=this.cols?this.cols[u]:null,d=e===G.Heatmap,y=te.computeHighlightRules(t,s,this.getAxisData(w.PROP_XAXIS),n,this.cols,p,h,!1,"",e===G.Line&&o,e===G.Line&&r===et.Stepped,a,e===G.Line&&r===et.Monotone,this.colorDataArr,!1,d?{col:c,name:u}:void 0),t=(this.colorArr=_.clone(y),o&&y.forEach(function(t,e){if(Array.isArray(t)){for(var i=t.filter(function(t){return t}),n=i.length;n<t.length;n++)i.push("");y[e]=i}}),this.cols?Object.keys(this.cols):[]),s=(this.api.setProperty(this.indexProp("possibleRulesColumns"),t),d?c:null);this.highlightRules=te.getColorArray(y,l,s)},w.prototype.onIconsChange=function(t){var e;if(!t)return null;if(0===t.indexOf("fa-"))e=requirejs.toUrl("QuickBase").replace(/main$/,"")+"images/white/"+t.replace(/^fa-/,"")+".png";else{if(0!==t.indexOf("data:image/"))throw Error("Unsupported icon scheme!");e=t}t=document.createElement("img");return this.el.append(t),t.style.visibility="hidden",t.src=e,t},w.prototype.onIconChange=function(t){var e,i=this;if(this.icon=t){if(0===t.indexOf("fa-"))e=requirejs.toUrl("QuickBase").replace(/main$/,"")+"images/white/"+t.replace(/^fa-/,"")+".png";else{if(0!==t.indexOf("data:image/"))throw Error("Unsupported icon scheme!");e=t}this.image||(this.image=document.createElement("img")),this.el.append(this.image),this.image.height=1,this.image.style.visibility="hidden",this.image.src=e,this.image.onload=function(){i.image&&i.el.removeChild(i.image),i.invalidate(z.Process)}}else this.texture=null,this.invalidate(z.Process)},w.prototype.createPattern=function(t,e,i){var t=this.patterns[t],n=this.propertyCache[w.PROP_OPACITY];(n=100<n?100:n)<0&&(n=0);n=Math.round(255*n/100).toString(16).padStart(2,"0");return M.Tools.drawPattern(t,e+n,void 0,i.canvas.width)},w.prototype.setBaselineProperties=function(t,e){!this.api.getProperty(this.indexProp(w.PROP_DATA))&&this.datasource&&(this.source.unsubscribe(),this.datasource.off("change:queryStatus",this.datasourceStatusFn));var t="X-Axis"===t?"x":"y",i=M.Tools.inferKdbTypeFromDashString(e),i=Number(null==i?void 0:i.slice(-2))||E.Float,n=/\S/.test(e)?X.convertStringToScalar(e,X.ipcTemp(i)):0,o=n,n=X.convertToJsScalar(i,n,!0);this.baselineInfo=A(A({},this.baselineInfo),{axis:t,type:i,value:e,scalarVal:o,jsVal:n}),this.baselineInfo.types&&(this.baselineInfo.types[t]=i)},w.prototype.setBoundsProperties=function(){var t=this.api.getProperty(this.indexProp(w.PROP_X1_COORD)),e=this.api.getProperty(this.indexProp(w.PROP_X2_COORD));(!t||this.cols&&!this.cols[t]&&this.columns[0])&&this.api.setProperty(this.indexProp(w.PROP_X1_COORD),this.columns[0]),(!e||this.cols&&!this.cols[e]&&this.columns[1])&&this.api.setProperty(this.indexProp(w.PROP_X2_COORD),this.columns[1]),this.api.setProperty(this.indexProp(w.PROP_XAXIS),void 0),this.api.setProperty(this.indexProp(w.PROP_YAXIS),void 0),this.api.setProperty(this.indexProp(w.PROP_COLOR),void 0),this.api.setProperty(this.indexProp(w.PROP_COLORDATA),void 0),this.api.setProperty(this.indexProp(w.PROP_HIGHLIGHTRULES),void 0)},w.prototype.setCandlestickProperties=function(){var n=this,o=this.columns,r=this.getAxisData(w.PROP_XAXIS),t=[w.PROP_OPEN,w.PROP_HIGH,w.PROP_LOW,w.PROP_CLOSE],a=[w.PROP_YAXIS,w.PROP_COLORDATA,w.PROP_COLOR];this.setIgnoreSettings(!0),t.forEach(function(t,e){var i=n.indexProp(t);n.api.getProperty(i)||n.api.setProperty(i,-1!==o.indexOf(t)?t:r),a[e]&&(i=n.indexProp(a[e]),n.api.getProperty(i))&&n.api.setProperty(i,void 0)}),this.setIgnoreSettings(!1)},w.prototype.convertColorData=function(e,t){var n=[],o=t?this.api.getProperty(this.indexProp(w.PROP_FILLOPACITY)):this.api.getProperty(this.indexProp(w.PROP_OPACITY)),i=(_.each(e,function(t){var e=t,i=o,t=(""===t&&(i=0,e="#ffffff"),X.hexColorToVec4(e,i));n.push(Object.values(t))}),this.getAxisData(w.PROP_XAXIS)),i=this.yAxes.length?this.yAxes:_.without(this.columns,i),i=(this.colorDataArr=this.isRegexOrWild()?i.map(function(t){return e}):[e],this.isRegexOrWild()?i.map(function(t){return n}):[n]);return t||(this.colorArr=this.colorDataArr,this.colorData=i),i},w.prototype.setColorProperties=function(){this.setIgnoreSettings(!0);var t=this.indexProp(w.PROP_COLOR),e=this.api.getProperty(t),i=this.indexProp(w.PROP_BUBBLES_COLOR),n=this.getLayerType();this.isRegexOrWild()||this.isCandlestick()||n===G.Bounds||n===G.Heatmap?(void 0!==e&&(this.colorCache=e),this.api.setProperty(t,void 0),this.api.setProperty(i,void 0),this.isBar()&&this.api.setProperty(this.indexProp(w.PROP_BORDER_COLOR),void 0)):void 0===e||""===e?(n=this.colorCache||b.COLOR_DEFAULT,this.api.setProperty(t,n),this.propertyCache[w.PROP_COLOR]=n,this.api.setProperty(i,n),this.propertyCache[w.PROP_BUBBLES_COLOR]=n,this.isBar()&&this.api.setProperty(this.indexProp(w.PROP_BORDER_COLOR),b.COLOR_DEFAULT)):this.propertyCache[w.PROP_COLOR]=e,this.setIgnoreSettings(!1)},w.prototype.setLineFillProperties=function(){var t=this.api.getProperty(this.indexProp(w.PROP_FILLCOLOR)),e=this.api.getProperty(this.indexProp(w.PROP_FILLOPACITY)),i=this.api.getProperty(this.indexProp(w.PROP_FADE));"No Fill"===this.api.getProperty(this.indexProp(w.PROP_FILL))?(this.fillCache=[t||this.fillCache[0],e||this.fillCache[1],i||this.fillCache[2]],this.api.setProperty(this.indexProp(w.PROP_FILLCOLOR),void 0),this.api.setProperty(this.indexProp(w.PROP_FILLOPACITY),void 0),this.api.setProperty(this.indexProp(w.PROP_FADE),void 0)):(void 0!==t||this.isRegexOrWild()?void 0!==t&&this.isRegexOrWild()&&(this.fillCache[0]=t,this.api.setProperty(this.indexProp(w.PROP_FILLCOLOR),void 0)):this.api.setProperty(this.indexProp(w.PROP_FILLCOLOR),this.fillCache[0]||this.propertyCache[w.PROP_COLOR]),void 0===e&&this.api.setProperty(this.indexProp(w.PROP_FILLOPACITY),this.fillCache[1]||80),void 0===i&&this.api.setProperty(this.indexProp(w.PROP_FADE),this.fillCache[2]||!1))},w.prototype.setupWorker=function(t,e){var a=this,s=(this.workerIndex=[],this.isHorizontal()?"y":"x"),i=this.getAxisId(s),l=this.api.getProperty(s.toUpperCase()+"axes."+i+".Type");l!==W.TYPE_CATEGORY&&t.hasIndex&&t.hasIndex()||!e.length?this.worker&&(this.worker.terminate(),this.worker=null):(this.worker||(i=requirejs.toUrl("ChartGL").slice(0,-4)+"worker.js",this.worker=new Worker(i),this.worker.onmessage=function(t){"ready"!==t.data||a.workerQueued?(a.workerIndex=t.data,a.propertyCache[w.PROP_CURRENT_TICK]?a.calcCurrentTickValues():a.invalidate(z.Tooltip)):(a.workerQueued=!0,window.requestAnimationFrame(function(){var t,e,i,n,o,r;a.Config&&a.Config.xCol&&(t=a.getLayerType()===G.Bounds,e=a.Config.xCol,r=null==(r=a.renderer)?void 0:r.getCategoryData(s),a.isHorizontal()&&(r=r&&[r[0][0],r[1][0],r[2][0]]),i=a.isFilterUnique("x"),o=!!((n=a.isSorted("x"))&&e&&e.toTypedArray),r=r&&l===W.TYPE_CATEGORY&&!o?JSON.parse(JSON.stringify(n?r[2]:r[0])):e.toTypedArray?e.toTypedArray():{},a.workerQueued=!1,a.worker)&&a.worker.postMessage([e.qtype,r,l,t,i,n,o])}))},this.worker.onerror=function(t){return M.Log.Error(t)}),t&&e.length&&this.worker.postMessage("queue"))},w.prototype.updateYAxesVals=function(){var t,e=this,i=this.getYAxesVals();this.isCandlestick()&&(this.setCandlestickProperties(),i=[w.PROP_OPEN,w.PROP_HIGH,w.PROP_LOW,w.PROP_CLOSE].map(function(t){return e.api.getProperty(e.indexProp(t))})),_.isEqual(this.yAxes,i)||(1===i.length?this.disabledColumns=[]:(t=this.isEnabled()?this.disabledColumns.filter(function(t){return-1!==i.indexOf(t)}):i,this.disabledColumns=t,this.appInvalidate(z.Legend)),this.yAxes=i)},w.prototype.useAxisRange=function(t){var e=this.getAxisId(t),t="x"===t?"Xaxes":"Yaxes",i=this.api.getProperty(t+"."+e+W.PROP_USE_MIN_MAX),n=this.api.getProperty(t+"."+e+W.PROP_MIN),o=this.api.getProperty(t+"."+e+W.PROP_MAX),t=this.api.getProperty(t+"."+e+W.PROP_BEGIN_ZERO);return new Y(!!(t||i&&""!==n),!(!i||""===o))},w.BAR_HORIZONTAL="Horizontal",w.BAR_VERTICAL="Vertical",w.PROP_DATA="Data",w.PROP_TYPE="_Type",w.PROP_XAXIS="XAxis",w.PROP_YAXIS="YAxis",w.PROP_MULTI_AXIS="XAxisMulti",w.PROP_COLOR="Color",w.PROP_BARPERCENT="Bars.BarWidth",w.PROP_BARFIXED="Bars.BarFixedWidth",w.PROP_BAR_ORIENTATION="Bars.BarOrientation",w.PROP_BARWIDTHTYPE="Bars.BarWidthType",w.PROP_BORDER_WIDTH="Bars.BorderWidth",w.PROP_BORDER_COLOR="Bars.BorderColor",w.PROP_BORDER_OPACITY="Bars.BorderOpacity",w.PROP_BORDER_PALETTE="Bars.BorderPalette",w.PROP_BASELINE_AXIS="Axis",w.PROP_BASELINE_VALUE="Value",w.PROP_BEARCOLOR="CandlestickFormat.BearColor",w.PROP_BUBBLES_COLOR="Bubbles.Color",w.PROP_BUBBLES_OPACITY="Bubbles.Opacity",w.PROP_CANDLEPERCENT="CandlestickFormat.BarWidth",w.PROP_CANDLEFIXED="CandlestickFormat.BarFixedWidth",w.PROP_CANDLEWIDTHTYPE="CandlestickFormat.BarWidthType",w.PROP_CURRENT_TICK="ShowCurrentTick",w.PROP_BULLCOLOR="CandlestickFormat.BullColor",w.PROP_NEUTRALCOLOR="CandlestickFormat.NeutralColor",w.PROP_FADE="Line.FadeToTransparent",w.PROP_FILL="Line.Fill",w.PROP_FILLCOLOR="Line.FillColor",w.PROP_FILLOPACITY="Line.FillOpacity",w.PROP_FILLPALETTE="Line.FillPalette",w.PROP_HEATMAP_X1="HeatmapX1",w.PROP_HEATMAP_X2="HeatmapX2",w.PROP_HEATMAP_Y1="HeatmapY1",w.PROP_HEATMAP_Y2="HeatmapY2",w.PROP_HEATMAP_SCORE="Score",w.PROP_ICON="Bubbles.Icon",w.PROP_INTERPOLATION="Line.Interpolation.Interpolation",w.PROP_SEG_LENGTH="Line.Interpolation.SegmentLength",w.PROP_STEPPED="Line.Interpolation.SteppedLine",w.PROP_INCREASE_COLOR="IncreaseColor",w.PROP_DECREASE_COLOR="DecreaseColor",w.PROP_LINETHICKNESS="Line.LineThickness",w.PROP_PALETTE="Palette",w.PROP_RADIUS_SCALE="Bubbles.RadiusScaling",w.PROP_SCALE_ZOOM="Bubbles.ScaleOnZoom",w.PROP_SETICONFROMDATA="Bubbles.SetIconFromData",w.PROP_DATA_ICON="Bubbles.DataIcon",w.PROP_DATA_ICON_COLOR="Bubbles.DataIconColor",w.PROP_SPAN_GAPS="Line.SpanGaps",w.PROP_WICKCOLOR="CandlestickFormat.WickColor",w.PROP_ACTIONS="Actions",w.PROP_HIGHLIGHTRULES="HighlightRules",w.PROP_X1_COORD="x1",w.PROP_X2_COORD="x2",w.PROP_XAXISID="XAxisId",w.PROP_YAXISID="YAxisId",w.PROP_LINE_STYLE="Line.LineStyle",w.PROP_DASH_GAP="Line.DashGap",w.PROP_DASH_WIDTH="Line.DashWidth",w.BAR_MIN_RELATIVE_SZ=.02,w.PROP_CACHE_STREAMING="CacheStreamingData",w.PROP_COLORDATA="ColorData",w.PROP_ENABLED="Enabled",w.PROP_OPACITY="Opacity",w.PROP_PREFIX="Layers.",w.PROP_RADIUS_DATA="Bubbles.RadiusData",w.PROP_OPEN="Open",w.PROP_HIGH="High",w.PROP_LOW="Low",w.PROP_CLOSE="Close",w.PROP_LABEL_ENABLED="Labels.Enabled",w.PROP_POSSIBLE_RADIUS="possibleRadiusData",w.PROP_PALETTE_THEME="PaletteTheme",w.PROP_LINE_PALETTE_THEME="Line.PaletteTheme",w.BREAKDOWN_ID="{breakdownId}";var H=w;function w(t,e,i,n,o,r,a,s,l){this.index=t,this.uid=e,this.api=i,this.appInvalidate=n,this.setIgnoreSettings=o,this.el=r,this.updateWildcardLayers=a,this.theme=s,this.globalPalette=l,this.primaryKey="",this.depth=0,this.textureArray=null,this.config=null,this.colorArr=[],this.colorCache=null,this.colorData=[],this.colorDataArr=[],this.colorDataInfo=null,this.columns=[],this.currentTickVals=[],this.datasource=null,this.disabledColumns=[],this.disabledColorDataIndices=[],this.fillCache=[],this.icon="",this.dataIcons=[],this.dataIconColors=[],this.image=null,this.isStreaming=!1,this.isWebGL2="undefined"!=typeof WebGL2RenderingContext,this.newDataLength=null,this.overrideColors={},this.overridePalette=[],this.palette=[],this.performanceTrack=0,this.fillPalette=[],this.borderPalette=[],this.patternLayerIndex=0,this.patterns={},this.patternIndices={},this.patternTextures={},this.points=[],this.propertyCache={},this.renderer=null,this.rendererFill=null,this.rendererBubble=null,this.resetCache=!0,this.texture=null,this.subId=_.uniqueId("glLayer"),this.renderState=z.Init,this.workerIndex=[],this.worker=null,this.workerQueued=!1,this.yAxes=[],this.updateColors=!1,this.dataLabels=new Oe(this.el.getElementsByClassName("data-labels")[0],this.api,this.getRowData.bind(this))}re=Backbone.View,g(se,re),se.prototype.remove=function(){return this.lnkCsvExport&&this.lnkCsvExport.removeEventListener("click",_.bind(this.fileExport.bind(this),".csv"),!1),this.lnkExcelExport&&this.lnkExcelExport.removeEventListener("click",_.bind(this.fileExport.bind(this),".xlsx"),!1),this.lnkPngExport&&this.lnkPngExport.removeEventListener("click",_.bind(this.downloadImage.bind(this),".png"),!1),this.stopListening(),Backbone.View.prototype.remove.apply(this)},se.prototype.getWidth=function(){var t=this.api.getProperty("FileExport");return this.api.hasPermission(M.CustomAPIPermission.canExportData)&&(t.ShowExportCsvButton||t.ShowExportExcelButton||t.ShowExportPngButton)?se.LEGEND_WIDTH:0},se.prototype.displayChoiceLinkButtons=function(){var t=this.api.getProperty("FileExport");!t||_.keys(t).length<3||(this.api.hasPermission(M.CustomAPIPermission.canExportData)&&(t.ShowExportCsvButton||t.ShowExportExcelButton||t.ShowExportPngButton)?this.lnkCsvExport&&this.lnkExcelExport&&this.lnksExport&&this.lnkPngExport&&(this.lnksExport.classList.remove("link-disabled"),this.lnkCsvExport.classList.toggle("link-disabled",!t.ShowExportCsvButton),this.lnkExcelExport.classList.toggle("link-disabled",!t.ShowExportExcelButton),this.lnkPngExport.classList.toggle("link-disabled",!t.ShowExportPngButton)):(this.lnksExport&&this.lnksExport.classList.add("link-disabled"),this.lnkCsvExport&&this.lnkCsvExport.classList.add("link-disabled"),this.lnkExcelExport&&this.lnkExcelExport.classList.add("link-disabled"),this.lnkPngExport&&this.lnkPngExport.classList.add("link-disabled")),this.onResize())},se.prototype.initializeEvents=function(){var t=this;this.lnkCsvExport&&this.lnkCsvExport.addEventListener("click",function(){t.fileExport(".csv")}),this.lnkExcelExport&&this.lnkExcelExport.addEventListener("click",function(){t.fileExport(".xlsx")}),this.lnkPngExport&&this.lnkPngExport.addEventListener("click",function(){t.downloadImage(".png")})},se.prototype.downloadImage=function(t){var i=this.api,n=this.getExportData(),o=this.getDashboardInfo(),r=M.ExportTools.getExportFileName(this.getFileName(i),"","Screenshot")+t;this.generateImage(function(t,e){M.Tools.fileSave(r,t,e),i.onTransferAction({actions:i.getProperty("FileExport.Actions"),component:"ChartGL",dashboardName:_.get(o,"dashboardName")?o.dashboardName:"",dashboardId:_.get(o,"dashboardId")?o.dashboardId:"",fileLength:_.get(n,"dataset")?n.dataset.length:0},r,_.isNil(n.meta)?"na":n.meta,"success","png",i.humanFileSize(t.size))})},se.prototype.generateImage=function(s){var l=this,h=this.el.parentElement,p=h.getElementsByClassName("export-div")[0],u=h.getElementsByClassName("draw-div")[0];_.isNil(p)||p.classList.add("link-hide"),_.isNil(u)||u.classList.add("link-hide"),html2canvas(h,{onrendered:function(t){var e="Light"===l.theme?"#F8F8F8":"#282828",i=h.clientHeight,n=h.clientWidth,o=document.createElement("canvas"),r=(o.width=n,o.height=i,o.getContext("2d")),a=(r.fillStyle=e,r.fillRect(0,0,n,i),r.drawImage(t,0,0),_.isNil(p)||p.classList.remove("link-hide"),_.isNil(u)||u.classList.remove("link-hide"),l.api.getProperty("FileExport.PngButton"));l.isIE?-1<a.indexOf("Export Png")&&(e=o.toDataURL("image/png"),n=M.Tools.convertDataUrlToBlob(e),s(n,"image/png")):r.canvas.toBlob(function(t){-1<a.indexOf("Export Png")&&s(t,"application/octet-stream"),-1<a.indexOf("Copy to Clipboard")&&t&&M.Tools.copyToClipboard(t,"ChartGL",l.api)})}})},se.prototype.mergeArray=function(t,e,i){return Object.values(_.merge(_.keyBy(t,i),_.keyBy(e,i)))},se.prototype.getFileName=function(i){return _.map(i.getProperty("FileExport.FileName"),function(t,e){return(t=null!==(t=i.getProperty("FileExport.FileName."+e+".FileNamePart"))&&!_.isObject(t)?t:"").toString()}).join("")},se.prototype.getExportData=function(){var i=this,y=[],g=this.api,f=[],m=g.getProperty("FileExport.UseChartFormat"),o=[];return _.each(this.layers,function(h,p){if(h.isEnabled()){var e=[],u=_.get(h,"propertyCache.XAxis");if(!_.isNil(u)){var c=_.get(h,"config.yColNames");if(c){var n=[u].concat(c),d=_.get(h,"cols");if(_.get(d,u)){for(var t=0;t<d[u].length;t++)!function(i){var t=Object.assign.apply(Object,T([{}],_.flatMap(n,function(t){var e={};return e[0<=c.indexOf(t)?t+"_"+p:t]=d[t].getValue(i),e}),!1));e.push(t)}(t);o=i.mergeArray(o,e,u)}_.each(n,function(e,t){var i,n,o,r,a,s,l;_.find(y,function(t){return e===t.colId})||(i=(i=u===e?"x":"y").toUpperCase()+"axes."+h.getAxisId(i),n=0<=c.indexOf(e)?e+"_"+p:e,f.indexOf(n)<0&&f.push(n),null!=(o=_.get(d,e))&&o.qtype&&(o="",r="string",a=d[e].qtype,s=g.getProperty(i+".Format.Format"),l=(l=g.getProperty(i+".Format.Precision"))?"."+Array(l+1).join("0"):"",m&&0<=[5,6,7,8,9].indexOf(a)&&("Smart Number"===s?o="SmartNumber":"Formatted Number"===s?o="#,##0":"Number"===s&&(o="#0"),o+=l,r="Number"),y.push({colId:n,colName:1!==t||h.isRegexOrWild()?e:h.getLayerName(),dataFormat:o,dataKdbType:a,dataType:r,hideTrailingZeroes:g.getProperty(i+".Format.HideTrailingZeroes"),prefix:g.getProperty(i+".Format.Prefix"),suffix:g.getProperty(i+".Format.Suffix")})))})}}}}),{meta:y,dataset:o,allCols:f}},se.prototype.fileExport=function(t){var e=this.api,i=M.ExportTools,n=this.getExportData(),o=n.meta,r=n.allCols,n=n.dataset,e=(e=this.getFileName(e)).replace(/[^a-z0-9]/gi,"_"),n=(_.each(n,function(e){_.each(_.difference(r,Object.keys(e)),function(t){e[t]=null})}),{actions:this.api.getProperty("FileExport.Actions"),configSets:{chartGLExport:{dataSet:n,metaData:o}},fileFormat:t,fileName:e||"ChartGL_Export",selectedDashboard:this.getDashboardInfo(),workSheetTitle:"ChartGL"});i.openFileExportDialog(n)},se.prototype.getDashboardInfo=function(){var t=this.dashboardViewModel.get("selectedDocumentId");return{dashboardId:t,dashboardName:this.api.getDashboardName(t)}},se.prototype.renderLinks=function(){this.lnksExport=this.el.querySelectorAll(".lnksExport")[0],this.lnkCsvExport=this.el.querySelectorAll("a.lnkCsvExport")[0],this.lnkExcelExport=this.el.querySelectorAll("a.lnkExcelExport")[0],this.lnkPngExport=this.el.querySelectorAll("a.lnkPngExport")[0]},se.LEGEND_WIDTH=120;var re,ae=se;function se(t){var e=re.call(this,t)||this;return e.api=t.api,e.layers=t.layers,e.onResize=t.onResize,e.el=t.el,e.el.innerHTML=F.fileExporter({}),e.theme=t.theme,e.dashboardViewModel=t.dashboardViewModel,e.isIE=!1,HTMLCanvasElement&&HTMLCanvasElement.prototype&&_.get(HTMLCanvasElement.prototype,"msToBlob")&&(e.isIE=!0),e.render(),e.renderLinks(),e.initializeEvents(),e}he.prototype.getPixelPosFromAxisDataValue=function(t,e,i){var n=Number(i[0].x),e=(e-n)/(Number(i[0].y)-n-(Number(i[0].x)-n)),i=t?e*this.gl.canvas.width:(1-e)*this.gl.canvas.height;return i},he.prototype.getChartAxisDataValueFromPixelPos=function(t,e,i){var e=e/(t?this.gl.canvas.width:this.gl.canvas.height),n=Number(i[0].x),i=Number(i[0].y),e=(i-n)*e,t=t?n+e:i-e;return t},he.prototype.convertPositionDataToPixels=function(t,e,i,n,o,r,a){for(var s=[],l=0;l<t.options.aPositionData.length;l++){var h=void 0;l%2==0?h=this.getPixelPosFromAxisDataValue(!0,t.options.aPositionData[l],e?r:n):l%2==1&&(h=this.getPixelPosFromAxisDataValue(!1,t.options.aPositionData[l],i?a:o)),s.push(h)}return s},he.prototype.renderBuffers=function(t,e,i,n,o,r,a){for(var s=this.gl,l=s.createBuffer(),h=this.vertexShader.attributes,p=0;p<h.length;p++){var u=h[p].name,c=t.attributes[u],d=s.createBuffer(),d=(s.bindBuffer(s.ARRAY_BUFFER,d),"aPosition"===u?(d=this.convertPositionDataToPixels(t,e,i,n,o,r,a),t.updatePosition(d),s.bufferData(s.ARRAY_BUFFER,new Float32Array(d),s.STATIC_DRAW)):s.bufferData(s.ARRAY_BUFFER,c.bufferData,s.STATIC_DRAW),s.getAttribLocation(this.program,u));s.enableVertexAttribArray(d),s.vertexAttribPointer(d,c.size,s.FLOAT,!1,t.stride,c.offset)}t.indices&&(s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,l),s.bufferData(s.ELEMENT_ARRAY_BUFFER,t.indices,s.STATIC_DRAW));l=s.getUniformLocation(this.program,"u_resolution");s.uniform2f(l,s.canvas.width,s.canvas.height)},he.getParmsFromShader=function(t,e){for(var i=[],n=t.split("\n"),o=0;o<n.length;o++){var r,a=n[o].trim();a.slice(0,e.length)===e&&(r=(a=a.split(" "))[2].slice(0,a[2].length-1),i.push({type:a[1],name:r}))}return i},he.getAttributes=function(t){return he.getParmsFromShader(t,X.isWebGL2?"in":"attribute")},he.getVaryings=function(t){return he.getParmsFromShader(t,X.isWebGL2?"out":"varying")},he.getUniforms=function(t){return he.getParmsFromShader(t,"uniform")};var le=he;function he(t,e){var i=F.annotateVertex({isWebGL2:e}),n=F.annotateFragment({isWebGL2:e});this.isWebGL2=e,this.gl=t,this.vertexShader={shader:D.createShader(t,t.VERTEX_SHADER,i),attributes:he.getAttributes(i)},this.fragmentShader={shader:D.createShader(t,t.FRAGMENT_SHADER,n),attributes:he.getAttributes(n)},this.program=D.createProgram(t,this.vertexShader.shader,this.fragmentShader.shader)}h.prototype.updatePosition=function(t){this.aPosition=t,this.attributes.aPosition.bufferData=new Float32Array(t)},h.prototype.updateColor=function(t){this.options.aColor=t;t=X.hexColorToVec4(t,this.annotateType===h.RECTANGLE?50:100),t=[t.x,t.y,t.z,t.w],t=T(T(T(T([],t,!0),t,!0),t,!0),t,!0);this.attributes.aColor.bufferData=new Float32Array(t)},h.prototype.updateColorStyleProperty=function(t,e){this.options[t]=e,this[t]=X.hex2RGB(e)},h.prototype.updateOpacityStyleProperty=function(t,e){this.options[t]=e,this[t]=e/100},h.prototype.updateStyleProperty=function(t,e){t&&(this.options[t]=e,this[t]=e)},h.prototype.copyTextStyleProperty=function(t){this.text=t.text,this.fontSize=t.fontSize,this.fontBold=t.fontBold,this.textMargin=t.textMargin,this.updateColor(t.options.aColor),this.borderThickness=t.borderThickness,this.updateColorStyleProperty("borderColor",t.options.borderColor),this.updateOpacityStyleProperty("borderOpacity",t.options.borderOpacity),this.updateColorStyleProperty("fillColor",t.options.fillColor),this.updateOpacityStyleProperty("fillOpacity",t.options.fillOpacity),this.anchorPosition=t.anchorPosition},h.prototype.setReadState=function(){this.attributes.aColorBackup=this.attributes.aColor,this.attributes.aColor=this.attributes.aSelColor},h.prototype.setDrawState=function(){this.attributes.aColor=this.attributes.aColorBackup},h.getShapeType=function(t){var e;switch(t){case h.TREND_LINE:e=h.SHAPE_LINE;break;case h.RECTANGLE:case h.HORIZONTAL_LINE:case h.VERTICAL_LINE:case h.TEXT_NOTE:e=h.SHAPE_RECTANGLE;break;default:e=h.SHAPE_POINT}return e},h.getAnnotateTypeText=function(t){var e="";switch(t){case h.TREND_LINE:e="Trend line";break;case h.HORIZONTAL_LINE:e="Horizontal line";break;case h.VERTICAL_LINE:e="Vertical line";break;case h.RECTANGLE:e="Rectangle";break;case h.TEXT_NOTE:e="Text note"}return e},h.getIdFromSelColor=function(t){return t[0]+(t[1]<<8)+(t[2]<<16)+(t[3]<<24)},h.createSelColor=function(t){return[(t>>0&255)/255,(t>>8&255)/255,(t>>16&255)/255,(t>>24&255)/255]},h.DEFAULT_FONT_SIZE=12,h.DEFAULT_TEXT_MARGIN=7,h.DEFAULT_BORDER_THICKNESS=2,h.DEFAULT_BORDER_OPACITY=100,h.DEFAULT_FILL_OPACITY=20,h.DEFAULT_ANCHOR_POSITION="topLeft",h.TREND_LINE="trend-line",h.HORIZONTAL_LINE="horizontal-line",h.VERTICAL_LINE="vertical-line",h.RECTANGLE="rectangle",h.TEXT_NOTE="text-note",h.SHAPE_POINT="point",h.SHAPE_LINE="line",h.SHAPE_RECTANGLE="rectangle";var v=h;function h(t){this.text="",this.options=t||{},this.id=this.options.id,this.stride=0,this.annotateType=this.options.annotateType,this.shapeType=this.options.shapeType||h.getShapeType(this.options.annotateType);var t=X.hexColorToVec4(this.options.aColor,this.annotateType===h.RECTANGLE?50:100),t=[t.x,t.y,t.z,t.w],t=T(T(T(T([],t,!0),t,!0),t,!0),t,!0),e=(this.indices=null,this.shapeType===h.SHAPE_RECTANGLE&&(this.indices=this.annotateType===h.TEXT_NOTE?new Uint16Array([0,1,2,2,3,0]):new Uint16Array([0,1,2,1,2,3])),this.text=this.options.text||"",this.fontSize=this.options.fontSize||h.DEFAULT_FONT_SIZE,this.fontBold=this.options.fontBold||!1,this.textMargin=_.isNil(this.options.textMargin)?h.DEFAULT_TEXT_MARGIN:this.options.textMargin,this.borderThickness=this.options.borderThickness||h.DEFAULT_BORDER_THICKNESS,this.options.borderOpacity=_.isNil(this.options.borderOpacity)?h.DEFAULT_BORDER_OPACITY:this.options.borderOpacity,this.borderOpacity=this.options.borderOpacity/100,this.options.borderColor=this.options.borderColor||this.options.aColor,this.borderColor=X.hex2RGB(this.options.borderColor),this.options.fillOpacity=_.isNil(this.options.fillOpacity)?h.DEFAULT_FILL_OPACITY:this.options.fillOpacity,this.fillOpacity=this.options.fillOpacity/100,this.options.fillColor=this.options.fillColor||this.options.aColor,this.fillColor=X.hex2RGB(this.options.fillColor),this.anchorPosition=this.options.anchorPosition||h.DEFAULT_ANCHOR_POSITION,h.createSelColor(this.id)),e=T(T(T(T([],e,!0),e,!0),e,!0),e,!0);this.attributes={aPosition:{size:2,offset:0},aColor:{bufferData:new Float32Array(t),size:4,offset:0},aSelColor:{bufferData:new Float32Array(e),size:4,offset:0}}}pe=M.DialogBase,g(p,pe),p.prototype.dialogButtons=function(){var t=this;return[{text:"OK",click:this.onSave.bind(this),icon:"fa fa-check"},{text:"Cancel",click:function(){t.isCancel=!0,t.dialogClose()},icon:"fa fa-times"}]},p.prototype.onClose=function(){var t=this.drawCallback;t&&t()},p.prototype.preRender=function(){this.options.minHeight=300,this.options.width=350,this.options.iconClass="fas fa-edit",this.options.userClass="ChartGL annotations-dialog",this.options.dialogTitle="Annotations",this.options.draggable=!0,this.options.onClose=this.onClose},p.prototype.renderTemplate=function(){return F.annotateDialog({})},p.prototype.postRender=function(){this.annotateTypeSelect=this.el.querySelectorAll(".annotate-type-select")[0],this.annotateTypeColorBtn=this.el.querySelectorAll(".annotate-color-btn")[0],this.annotateTypeColorBtn&&(this.annotateTypeColorBtn.onclick=this.showColorPickerDialog.bind(this)),this.annotateTypeColorIcon=this.el.querySelectorAll(".annotate-color-icon")[0],this.editFieldSet=this.el.querySelectorAll(".options-annotate-edit")[0],this.tableBody=this.el.querySelectorAll(".tbody-annotate-edit")[0],this.deleteAllBtn=this.el.querySelectorAll(".delete-all-btn")[0],this.deleteAllBtn&&(this.deleteAllBtn.onclick=this.onDeleteAll.bind(this))},p.prototype.init=function(){if(this.editFieldSet.style.display=!_.isUndefined(this.settingsJSON.annotations)&&0<this.settingsJSON.annotations.length?"":"none",this.annotateTypeSelect.value=this.settingsJSON.draw.annotateType,this.annotateTypeColorIcon.style.color=this.settingsJSON.draw.color,this.annotateTypeColorBtn.value=this.settingsJSON.draw.color,this.annotateTypeColorBtn.innerHTML=this.settingsJSON.draw.color,!_.isUndefined(this.settingsJSON.annotations)){var t=this.settingsJSON.annotations;this.updatedAnnotations=_.cloneDeep(this.annotations);for(var e=0;e<t.length;e++){var i=this.tableBody.insertRow(),n=(i.classList.add(p.PREFIX_ROW+t[e].id),i.insertCell()),o=document.createTextNode(v.getAnnotateTypeText(t[e].type)),n=(n.appendChild(o),i.insertCell()),o=document.createElement("input"),r=document.createElement("span"),a=(r.className="fa fa-fw watermark fa-tint",r.classList.add(p.PREFIX_COLOR_ICON+t[e].id),o.type="button",o.className="ui-widget ui-state-default ui-corner-all",o.classList.add(p.PREFIX_COLOR_BTN+t[e].id),o.value=t[e].color,document.createTextNode(v.getAnnotateTypeText(t[e].color))),r=(o.appendChild(a),r.style.color=t[e].color,o.onclick=this.showColorPickerDialog.bind(this),n.appendChild(r),n.appendChild(o),t[e].type===v.TEXT_NOTE&&(a=document.createElement("button"),(r=document.createElement("span")).className="edit-icon fa fa-pencil",a.className="ui-widget ui-state-default ui-corner-all annotate-edit-btn",a.classList.add(p.PREFIX_EDIT_BTN+t[e].id),o=document.createTextNode("Edit"),a.setAttribute("title","Edit annotation"),a.appendChild(r),a.onclick=this.showTextAnnotationDialog.bind(this),a.appendChild(o),n.appendChild(a)),i.insertCell()),o=document.createElement("button"),n=document.createElement("span");n.className="fa fa-trash",o.className="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-icon-primary annotate-del-btn",o.classList.add(p.PREFIX_DELETE_BTN+t[e].id),o.setAttribute("title","Delete annotation"),o.appendChild(n),o.onclick=this.onDeleteRow.bind(this),r.appendChild(o)}this.onResize()}},p.prototype.showColorPickerDialog=function(t){var e=this,i=t.target,n=i.value;new M.ColorPickr({values:"false",noColor:"false",target:t.target,editor:this,path:n,selected:n,selectCallback:function(t){n!==t.toUpperCase()&&e.updateColor(t.toUpperCase(),i)}})},p.prototype.updateColor=function(t,e){e.value=t,e.innerHTML=t;var i=this.getAnnotationId(e,p.PREFIX_COLOR_BTN);i?(this.settingsJSON.annotations.find(function(t){return t.id===i}).color=t,this.el.querySelectorAll(".".concat(p.PREFIX_COLOR_ICON).concat(i))[0].style.color=t,(e=this.updatedAnnotations.find(function(t){return t.id===i})).updateColor(t),this.updateChangeStack(e),this.triggerDraw()):this.annotateTypeColorIcon.style.color=t},p.prototype.updateChangeStack=function(t){var e=t.id,i=(_.isNil(this.prev.change)&&(this.prev.change=[]),this.annotations.findIndex(function(t){return t.id===e})),n=this.prev.change.findIndex(function(t){return t.id===e}),i=Pe.getAnnotationJsonProperties(_.cloneDeep(this.annotations[i])),i=(n<0&&this.prev.change.push(i),Pe.getAnnotationJsonProperties(_.cloneDeep(t))),t=(_.isNil(this.next.change)&&(this.next.change=[]),this.next.change.findIndex(function(t){return t.id===e}));t!==n&&console.log("Warning - stack update - next and previous index do not match!"),0<t?this.next.change[t]=i:this.next.change.push(i)},p.prototype.updateProperties=function(){this.settingsJSON.draw.annotateType!==this.annotateTypeSelect.value&&(this.prev.defaultAnnotateType=this.settingsJSON.draw.annotateType,this.next.defaultAnnotateType=this.annotateTypeSelect.value,this.settingsJSON.draw.annotateType=this.annotateTypeSelect.value),this.settingsJSON.draw.color!==this.annotateTypeColorBtn.value&&(this.prev.defaultColor=this.settingsJSON.draw.color,this.next.defaultColor=this.annotateTypeColorBtn.value,this.settingsJSON.draw.color=this.annotateTypeColorBtn.value),this.settings=JSON.stringify(this.settingsJSON),this.api.setProperty("Annotations.Annotations",this.settings)},p.prototype.onDeleteAll=function(){var t=_.map(this.annotations,function(t){return Pe.getAnnotationJsonProperties(_.cloneDeep(t))});delete this.prev.add,delete this.prev.change,delete this.next.delete,delete this.next.change,this.prev.addAll=t,this.next.deleteAll=[],delete this.settingsJSON.annotations,delete this.updatedAnnotations,this.tableBody.style.display="none"},p.prototype.onSave=function(){var t=this.options.drawCallback;this.isCancel=!1,this.updateProperties(),t&&(this.prev.add&&this.prev.add.sort(function(t,e){return t.index-e.index}),t({prev:this.prev,next:this.next})),this.dialogClose()},p.prototype.onDeleteRow=function(t){var t=t.currentTarget,e=this.getAnnotationId(t,p.PREFIX_DELETE_BTN);this.settingsJSON.annotations=this.settingsJSON.annotations.filter(function(t){return t.id!==e});this.el.querySelectorAll(".".concat(p.PREFIX_ROW).concat(e))[0].style.display="none",this.updatedAnnotations=this.updatedAnnotations.filter(function(t){return t.id!==e}),_.isNil(this.prev.add)&&(this.prev.add=[]);t=this.annotations.findIndex(function(t){return t.id===e});this.prev.add.push({annotateJson:Pe.getAnnotationJsonProperties(_.cloneDeep(this.annotations[t])),index:t}),_.isNil(this.next.delete)&&(this.next.delete=[]),this.next.delete.push(e),this.prev.change&&(this.prev.change=this.prev.change.filter(function(t){return t.id!==e})),this.next.change&&(this.next.change=this.next.change.filter(function(t){return t.id!==e})),this.triggerDraw()},p.prototype.showTextAnnotationDialog=function(t){var t=t.currentTarget,e=this,i=this.getAnnotationId(t,p.PREFIX_EDIT_BTN);i&&(t=this.settingsJSON.annotations.find(function(t){return t.id===i}),t=new v(Pe.getAnnotateElementProps(t)),new de({api:this.api,annotateEl:t,canvas:this.canvas,bEdit:!0,updateCallback:function(t){e.updateTextAnnotation(t)}}))},p.prototype.updateTextAnnotation=function(e){var t;e&&((t=this.settingsJSON.annotations.find(function(t){return t.id===e.id})).text=e.text,t.fontSize=e.fontSize,t.fontBold=e.fontBold,t.textMargin=e.textMargin,t.borderThickness=e.borderThickness,t.borderColor=e.options.borderColor,t.borderOpacity=e.options.borderOpacity,t.fillColor=e.options.fillColor,t.fillOpacity=e.options.fillOpacity,t.anchorPosition=e.anchorPosition,t=this.el.querySelectorAll(".".concat(p.PREFIX_COLOR_BTN).concat(e.id))[0],this.updateColor(e.options.aColor,t),(t=this.updatedAnnotations.find(function(t){return t.id===e.id})).copyTextStyleProperty(e),this.updateChangeStack(t)),this.triggerDraw()},p.prototype.triggerDraw=function(){var t={detail:this.updatedAnnotations};this.canvas&&this.canvas.dispatchEvent(new CustomEvent("editAnnotationsDrawEvent",t))},p.prototype.getAnnotationId=function(t,e){for(var i,n=t.classList,o=0;o<n.length;o++)if(n[o].startsWith(e)){i=n[o].substr(n[o].indexOf(e)+e.length);break}return parseInt(i,10)},p.PREFIX_ROW="row_",p.PREFIX_COLOR_BTN="color-btn",p.PREFIX_COLOR_ICON="color-icon",p.PREFIX_DELETE_BTN="delete-btn",p.PREFIX_EDIT_BTN="edit-btn",p.DEFAULT_ANNOTATION_TYPE=v.TEXT_NOTE,p.DEFAULT_JSON={draw:{annotateType:p.DEFAULT_ANNOTATION_TYPE,color:p.DEFAULT_ANNOTATION_COLOR="#E8E824"}};var pe,ue=p;function p(t){var e=pe.call(this,t)||this;return e.isCancel=!1,e.annotations=[],e.next={},e.prev={},e.api=t.api,e.settings=e.api.getProperty("Annotations.Annotations"),""===e.settings?e.settingsJSON=p.DEFAULT_JSON:e.settingsJSON=JSON.parse(e.settings),e.annotations=e.options.annotations,e.canvas=e.options.canvas,e.init(),e}ce=M.DialogBase,g(ye,ce),ye.prototype.dialogButtons=function(){var t=this;return[{text:"OK",click:this.onSave.bind(this),icon:"fa fa-check"},{text:"Cancel",click:function(){t.isCancel=!0,t.dialogClose()},icon:"fa fa-times"}]},ye.prototype.onClose=function(){var t=this.updateCallback;t&&t()},ye.prototype.preRender=function(){this.options.dialogTitle="Text Note",this.options.minHeight=300,this.options.width=300,this.options.iconClass="fas fa-edit",this.options.userClass="ChartGL edit-text-annotation-dialog",this.options.draggable=!0,this.options.onClose=this.onClose},ye.prototype.renderTemplate=function(){return F.textNoteDialog({})},ye.prototype.postRender=function(){this.textArea=this.el.querySelectorAll(".annotate-text")[0],this.textArea&&this.textArea.addEventListener("input",this.updateInputValue.bind(this)),this.textColorBtn=this.el.querySelectorAll(".text-color-btn")[0],this.textColorBtn&&(this.textColorBtn.onclick=this.showColorPickerDialog.bind(this)),this.textColorIcon=this.el.querySelectorAll(".text-color-icon")[0],this.textSizeControl=this.el.querySelectorAll(".text-size")[0],this.textSizeControl&&(this.textSizeControl.addEventListener("input",this.updateSpinControlValue.bind(this)),this.textSizeControl.addEventListener("change",this.updateSpinControlValue.bind(this))),this.textBoldChkBox=this.el.querySelectorAll(".text-bold")[0],this.textBoldChkBox&&this.textBoldChkBox.addEventListener("change",this.onCheckBoxChange.bind(this)),this.textMarginControl=this.el.querySelectorAll(".text-margin")[0],this.textMarginControl&&(this.textMarginControl.addEventListener("input",this.updateSpinControlValue.bind(this)),this.textMarginControl.addEventListener("change",this.updateSpinControlValue.bind(this))),this.borderSizeControl=this.el.querySelectorAll(".border-thickness")[0],this.borderSizeControl&&(this.borderSizeControl.addEventListener("input",this.updateSpinControlValue.bind(this)),this.borderSizeControl.addEventListener("change",this.updateSpinControlValue.bind(this))),this.borderColorBtn=this.el.querySelectorAll(".border-color-btn")[0],this.borderColorBtn&&(this.borderColorBtn.onclick=this.showColorPickerDialog.bind(this)),this.borderColorIcon=this.el.querySelectorAll(".border-color-icon")[0],this.borderOpacitySlider=this.el.querySelectorAll(".border-opacity")[0],this.borderOpacitySlider&&(this.borderOpacitySlider.addEventListener("input",this.updateOpacityValue.bind(this)),this.borderOpacitySlider.addEventListener("change",this.updateOpacityValue.bind(this))),this.fillColorBtn=this.el.querySelectorAll(".fill-color-btn")[0],this.fillColorBtn&&(this.fillColorBtn.onclick=this.showColorPickerDialog.bind(this)),this.fillColorIcon=this.el.querySelectorAll(".fill-color-icon")[0],this.fillOpacitySlider=this.el.querySelectorAll(".fill-opacity")[0],this.fillOpacitySlider&&(this.fillOpacitySlider.addEventListener("input",this.updateOpacityValue.bind(this)),this.fillOpacitySlider.addEventListener("change",this.updateOpacityValue.bind(this))),this.anchorPositionSelect=this.el.querySelectorAll(".anchor-position")[0],this.anchorPositionSelect&&this.anchorPositionSelect.addEventListener("change",this.updateInputValue.bind(this)),this.onResize()},ye.prototype.init=function(){this.textArea.value=""===this.annotateEl.text?ye.DEFAULT_TEXT:this.annotateEl.text,this.annotateEl.text=this.textArea.value,this.bEdit||this.textArea.select(),this.textColorIcon.style.color=this.annotateEl.options.aColor,this.textColorBtn.value=this.annotateEl.options.aColor,this.textColorBtn.innerHTML=this.annotateEl.options.aColor,this.textSizeControl.value=this.annotateEl.fontSize,this.textBoldChkBox.checked=this.annotateEl.fontBold,this.textMarginControl.value=this.annotateEl.textMargin,this.borderSizeControl.value=this.annotateEl.borderThickness,this.borderColorIcon.style.color=this.annotateEl.options.borderColor,this.borderColorBtn.value=this.annotateEl.options.borderColor,this.borderColorBtn.innerHTML=this.annotateEl.options.borderColor,this.borderOpacitySlider.value=this.annotateEl.options.borderOpacity,this.fillColorIcon.style.color=this.annotateEl.options.fillColor,this.fillColorBtn.value=this.annotateEl.options.fillColor,this.fillColorBtn.innerHTML=this.annotateEl.options.fillColor,this.fillOpacitySlider.value=this.annotateEl.options.fillOpacity,this.anchorPositionSelect.value=this.annotateEl.anchorPosition},ye.prototype.remove=function(){return this.textArea&&this.textArea.removeEventListener("input",this.updateInputValue.bind(this)),this.textColorBtn&&(this.textColorBtn.onclick=this.showColorPickerDialog.bind(this)),this.textSizeControl&&(this.textSizeControl.removeEventListener("input",this.updateSpinControlValue.bind(this)),this.textSizeControl.removeEventListener("change",this.updateSpinControlValue.bind(this))),this.textBoldChkBox&&this.textBoldChkBox.removeEventListener("change",this.onCheckBoxChange.bind(this)),this.textMarginControl&&(this.textMarginControl.removeEventListener("input",this.updateSpinControlValue.bind(this)),this.textMarginControl.removeEventListener("change",this.updateSpinControlValue.bind(this))),this.borderSizeControl&&(this.borderSizeControl.removeEventListener("input",this.updateSpinControlValue.bind(this)),this.borderSizeControl.removeEventListener("change",this.updateSpinControlValue.bind(this))),this.borderColorBtn&&(this.borderColorBtn.onclick=this.showColorPickerDialog.bind(this)),this.borderOpacitySlider&&(this.borderOpacitySlider.removeEventListener("input",this.updateOpacityValue.bind(this)),this.borderOpacitySlider.removeEventListener("change",this.updateOpacityValue.bind(this))),this.fillColorBtn&&(this.fillColorBtn.onclick=this.showColorPickerDialog.bind(this)),this.fillOpacitySlider&&(this.fillOpacitySlider.removeEventListener("input",this.updateOpacityValue.bind(this)),this.fillOpacitySlider.removeEventListener("change",this.updateOpacityValue.bind(this))),this.anchorPositionSelect&&this.anchorPositionSelect.removeEventListener("change",this.updateInputValue.bind(this)),M.DialogBase.prototype.remove.apply(this)},ye.prototype.triggerDraw=function(){var t={detail:this.annotateEl};this.canvas&&this.canvas.dispatchEvent(new CustomEvent("editTextDrawEvent",t))},ye.prototype.showColorPickerDialog=function(t){var e=this,i=t.target,n=i.value;new M.ColorPickr({values:"false",noColor:"false",target:t.target,editor:this,path:n,selected:n,selectCallback:function(t){n!==t.toUpperCase()&&e.updateColor(t.toUpperCase(),i)}})},ye.prototype.updateColor=function(t,e){e.value=t,e.innerHTML=t;e.previousElementSibling.style.color=t;e=e.dataset.propertyName;e&&("aColor"===e?this.annotateEl.updateColor(t):this.annotateEl.updateColorStyleProperty(e,t),this.triggerDraw())},ye.prototype.onSave=function(){var t=this.options.updateCallback;this.isCancel=!1,t&&t(this.annotateEl),this.dialogClose()},ye.prototype.updateInputValue=function(t){t=t.target;this.annotateEl.updateStyleProperty(t.dataset.propertyName,t.value),this.triggerDraw()},ye.prototype.updateSpinControlValue=function(t){var e=t.target,i=e.dataset.propertyName;!i||"input"===t.type&&""===e.value||(t=parseInt(e.value,10),t=_.isNaN(t)||t<parseInt(e.min,10)||t>parseInt(e.max,10)?this.annotateEl[i]:t,e.value=t.toString(),this.annotateEl.updateStyleProperty(i,t),this.triggerDraw())},ye.prototype.updateOpacityValue=function(t){var t=t.target,e=t.dataset.propertyName;e&&(this.annotateEl.updateOpacityStyleProperty(e,parseInt(t.value,10)),this.triggerDraw())},ye.prototype.onCheckBoxChange=function(t){t=t.target;this.annotateEl.updateStyleProperty(t.dataset.propertyName,t.checked),this.triggerDraw()},ye.DEFAULT_TEXT="Text note";var ce,de=ye;function ye(t){t=ce.call(this,t)||this;return t.isCancel=!1,t.annotateEl=t.options.annotateEl,t.bEdit=t.options.bEdit,t.canvas=t.options.canvas,t.init(),t.triggerDraw(),t}fe.prototype.add=function(t,e){return this.position<this.history.length&&(this.history=this.history.slice(0,this.position)),this.history.push({command:t,data:e}),this.position++,{undo:!0,redo:!1}},fe.prototype.undo=function(){0<this.position&&this.position--;var t=this.getCurrentData();return{stackData:{command:fe.undoMap[t.command],data:t.data},undo:0<this.position,redo:!0}},fe.prototype.redo=function(){var t=this.getCurrentData();return this.position<this.history.length&&this.position++,{stackData:t,undo:!0,redo:this.position!==this.history.length}},fe.prototype.getCurrentData=function(){return this.history[this.position]},fe.COMMAND_APPEND="append",fe.COMMAND_DELETE="delete",fe.COMMAND_UPDATE_NEXT="update_next",fe.COMMAND_UPDATE_PREV="update_prev",fe.COMMAND_BULK_UPDATE_NEXT="bulk_update_next",fe.undoMap={append:fe.COMMAND_DELETE,delete:fe.COMMAND_APPEND,update_next:fe.COMMAND_UPDATE_PREV,update_prev:fe.COMMAND_UPDATE_NEXT,bulk_update_next:fe.COMMAND_BULK_UPDATE_PREV="bulk_update_prev",bulk_update_prev:fe.COMMAND_BULK_UPDATE_NEXT};var ge=fe;function fe(){this.position=0,this.history=[]}me=Backbone.View,g(O,me),O.prototype.createWebGLContext=function(){this.gl=this.canvas.getContext(X.glContext,{premultipliedAlpha:X.isWebGLHWAcclEnabled,preserveDrawingBuffer:!0}),this.gl?this.annotateGL=new le(this.gl,X.isWebGL2):M.Log.Error("ChartGL: Annotations Context Not Initialized")},O.prototype.resize=function(t,e,i,n){this.canvas.style.left=t+"px",this.canvas.style.top=e+"px",this.canvas.width=i,this.canvas.height=n,this.canvas2d.style.left=t+"px",this.canvas2d.style.top=e+"px",this.canvas2d.width=i,this.canvas2d.height=n},O.prototype.remove=function(){var t=this;return this.canvas2d.removeEventListener("mousedown",this.onAnnotateMouseDown.bind(this)),this.canvas2d.removeEventListener("mousemove",this.onAnnotateMouseMove.bind(this)),this.canvas2d.removeEventListener("mouseup",this.onAnnotateMouseUp.bind(this)),this.lnkAnnotate&&this.lnkAnnotate.removeEventListener("click",function(){return t.toggleDrawMode()}),this.lnkEditAnnotate&&this.lnkEditAnnotate.removeEventListener("click",function(){return t.toggleDrawMenu()}),this.lnkUndoAnnotate&&this.lnkUndoAnnotate.removeEventListener("click",function(){return t.onUndo()}),this.lnkRedoAnnotate&&this.lnkRedoAnnotate.removeEventListener("click",function(){return t.onRedo()}),this.canvas2d.removeEventListener("editTextDrawEvent",this.onEditTextDraw.bind(this)),this.stopListening(),Backbone.View.prototype.remove.apply(this)},O.prototype.showAnnotateControl=function(){var t=this.api.getProperty(O.PROP_ANNOTATE_CONTROL);this.lnksAnnotate&&(t?(this.el.style.width=O.LEGEND_WIDTH+"px",this.lnksAnnotate.classList.remove("link-disabled")):this.lnksAnnotate.classList.add("link-disabled"))},O.prototype.getWidth=function(){return this.api.getProperty(O.PROP_ANNOTATE_CONTROL)?O.LEGEND_WIDTH:0},O.prototype.onSettingsChange=function(){var t=this.api.getProperty(O.PROP_ANNOTATIONS);if(""===t)this.settingsJSON=ue.DEFAULT_JSON,this.annotations=[];else{this.gl||this.createWebGLContext();var e=void 0;try{e=JSON.parse(t)}catch(t){console.log("ChartGL: Annotations string is in wrong format - resetting to default..."),e=ue.DEFAULT_JSON}!_.isUndefined(this.settingsJSON)&&_.isEqual(this.settingsJSON,e)||(this.settingsJSON=e,this.loadAnnotations())}this.updateDrawIcon(),this.isInitialized&&this.gl&&this.draw(this.gl)},O.prototype.loadAnnotations=function(){var e=this;this.annotations=[],_.forEach(this.settingsJSON.annotations,function(t){t=new v(O.getAnnotateElementProps(t));e.annotations.push(t)})},O.prototype.saveAnnotations=function(){var t=_.map(this.annotations,function(t){return O.getAnnotationJsonProperties(t)}),e={annotations:t,draw:this.settingsJSON.draw};this.settingsJSON.annotations=t,this.api.setProperty(O.PROP_ANNOTATIONS,JSON.stringify(e))},O.getAnnotateElementProps=function(t){return{id:t.id,annotateType:t.type,aColor:t.color,aPositionData:t.aPositionData,text:t.text,fontSize:t.fontSize,fontBold:t.fontBold,textMargin:t.textMargin,borderThickness:t.borderThickness,borderColor:t.borderColor,borderOpacity:t.borderOpacity,fillColor:t.fillColor,fillOpacity:t.fillOpacity,anchorPosition:t.anchorPosition}},O.getAnnotationJsonProperties=function(t){return{id:t.id,type:t.annotateType,color:t.options.aColor,aPositionData:t.options.aPositionData,text:t.text,fontSize:t.fontSize,fontBold:t.fontBold,textMargin:t.textMargin,borderThickness:t.borderThickness,borderColor:t.options.borderColor,borderOpacity:t.options.borderOpacity,fillColor:t.options.fillColor,fillOpacity:t.options.fillOpacity,anchorPosition:t.anchorPosition}},O.prototype.addToStack=function(t,e){t=this.annotateStack.add(t,e);this.updateUndoRedo(t)},O.prototype.onUndo=function(){var t=this.annotateStack.undo();this.doCommand(t.stackData),this.updateUndoRedo(t)},O.prototype.onRedo=function(){var t=this.annotateStack.redo();this.doCommand(t.stackData),this.updateUndoRedo(t)},O.prototype.doCommand=function(e){var n=this;switch(e.command){case ge.COMMAND_APPEND:var t=new v(O.getAnnotateElementProps(e.data));this.annotations.push(t),this.saveAnnotations();break;case ge.COMMAND_DELETE:this.annotations=this.annotations.filter(function(t){return t.id!==e.data.id}),this.saveAnnotations();break;case ge.COMMAND_UPDATE_NEXT:case ge.COMMAND_UPDATE_PREV:var t=e.command===ge.COMMAND_UPDATE_NEXT?e.data.next:e.data.prev,t=new v(O.getAnnotateElementProps(t)),i=this.annotations.findIndex(function(t){return t.id===e.data.next.id});this.annotations[i]=t,this.saveAnnotations();break;case ge.COMMAND_BULK_UPDATE_NEXT:case ge.COMMAND_BULK_UPDATE_PREV:i=e.command===ge.COMMAND_BULK_UPDATE_NEXT?e.data.next:e.data.prev;_.isNil(i.defaultAnnotateType)||(this.settingsJSON.draw.annotateType=i.defaultAnnotateType),_.isNil(i.defaultColor)||(this.settingsJSON.draw.color=i.defaultColor),_.isNil(i.addAll)?_.isNil(i.deleteAll)?_.isNil(i.add)?_.isNil(i.delete)||_.forEach(i.delete,function(e){n.annotations=n.annotations.filter(function(t){return t.id!==e})}):_.forEach(i.add,function(t){var e=new v(O.getAnnotateElementProps(t.annotateJson));n.annotations.splice(t.index,0,e)}):this.annotations=[]:_.forEach(i.addAll,function(t){t=new v(O.getAnnotateElementProps(t));n.annotations.push(t)}),_.isNil(i.change)||_.forEach(i.change,function(e){var t=new v(O.getAnnotateElementProps(e)),i=n.annotations.findIndex(function(t){return t.id===e.id});n.annotations[i]=t}),this.saveAnnotations()}},O.prototype.updateUndoRedo=function(t){var e,i=null==(i=this.lnkUndoAnnotate)?void 0:i.classList.contains("btn-disabled"),n=null==(n=this.lnkRedoAnnotate)?void 0:n.classList.contains("btn-disabled");t.undo?i&&null!=(e=this.lnkUndoAnnotate)&&e.classList.remove("btn-disabled"):i||null!=(e=this.lnkUndoAnnotate)&&e.classList.add("btn-disabled"),t.redo?n&&null!=(i=this.lnkRedoAnnotate)&&i.classList.remove("btn-disabled"):n||null!=(e=this.lnkRedoAnnotate)&&e.classList.add("btn-disabled")},O.prototype.updateZoom=function(t,e,i,n){this.isInitialized||(this.isInitialized=!0),this.xAxisDataBounds=t,this.yAxisDataBounds=i,this.xAxisViewBounds=e,this.yAxisViewBounds=n,this.isXZoom=!_.isEqual(t,e),this.isYZoom=!_.isEqual(i,n),this.isZoom=this.isXZoom||this.isYZoom,this.dialogCurrEl?this.draw(this.gl,!1,!0,this.dialogCurrEl):this.draw(this.gl)},O.prototype.onEditTextDraw=function(t){this.dialogCurrEl=t.detail,this.draw(this.gl,!1,!0,t.detail)},O.prototype.onEditAnnotationsDraw=function(t){this.dialogAllAnnotations=t.detail,this.draw(this.gl,!1,!1,null,t.detail)},O.prototype.draw=function(t,e,i,n,o){if(t){for(var r=void 0!==e&&e,a=void 0!==i&&i,s=_.isNil(n)?this.currEl:n,e=this.annotateGL.program,l=(t.useProgram(e),t.clearColor(0,0,0,0),t.viewport(0,0,this.canvas.width,this.canvas.height),t.clear(t.COLOR_BUFFER_BIT),this.ctx.clearRect(0,0,this.canvas2d.width,this.canvas2d.height),_.isNil(o)?this.getAllElements():o),h=0;h<l.length;h++)r||l[h].annotateType!==v.TEXT_NOTE?(this.updateLineEndpoints(l[h]),this.annotateGL.renderBuffers(l[h],this.isXZoom,this.isYZoom,this.xAxisDataBounds,this.yAxisDataBounds,this.xAxisViewBounds,this.yAxisViewBounds),l[h].shapeType===v.SHAPE_RECTANGLE?this.gl.drawElements(t.TRIANGLES,l[h].indices.length,t.UNSIGNED_SHORT,0):l[h].shapeType===v.SHAPE_POINT?this.gl.drawArrays(t.POINTS,0,1):this.gl.drawArrays(l[h].shapeType===v.SHAPE_LINE?t.LINES:t.TRIANGLES,0,l[h].options.aPositionData.length)):this.drawText(t,a&&s.id===l[h].id?s:l[h]);this.action===O.ACTION_DRAW&&s&&(r||s.annotateType!==v.TEXT_NOTE?(this.annotateGL.renderBuffers(s,this.isXZoom,this.isYZoom,this.xAxisDataBounds,this.yAxisDataBounds,this.xAxisViewBounds,this.yAxisViewBounds),s.shapeType===v.SHAPE_RECTANGLE?t.drawElements(t.TRIANGLES,s.indices.length,t.UNSIGNED_SHORT,0):t.drawArrays(s.shapeType===v.SHAPE_LINE?t.LINES:t.TRIANGLES,0,s.options.aPositionData.length)):(a&&this.drawText(t,s),this.drawBoundingRectForText(s)))}},O.prototype.drawBoundingRectForText=function(t){var e=v.DEFAULT_FONT_SIZE,e=(this.ctx.font=e+"px "+O.FONT_DEFAULT,this.ctx.strokeStyle="#d3d3d3",this.ctx.setLineDash([15,5]),this.annotateGL.getPixelPosFromAxisDataValue(!0,t.options.aPositionData[0],this.isXZoom?this.xAxisViewBounds:this.xAxisDataBounds)),i=this.annotateGL.getPixelPosFromAxisDataValue(!0,t.options.aPositionData[2],this.isXZoom?this.xAxisViewBounds:this.xAxisDataBounds),n=this.annotateGL.getPixelPosFromAxisDataValue(!1,t.options.aPositionData[1],this.isYZoom?this.yAxisViewBounds:this.yAxisDataBounds),t=this.annotateGL.getPixelPosFromAxisDataValue(!1,t.options.aPositionData[5],this.isYZoom?this.yAxisViewBounds:this.yAxisDataBounds);this.ctx.strokeRect(Math.min(e,i),Math.min(n,t),Math.abs(i-e),Math.abs(t-n))},O.prototype.drawText=function(t,e){var i=this.ctx,n=e.fontSize,o=(this.ctx.save(),i.font=(e.fontBold?"bold ":"")+n+"px "+O.FONT_DEFAULT,e.text.split("\n")),r=this.updateTextPosition(e,o);this.ctx.fillStyle="rgba(".concat(e.fillColor[0],", ").concat(e.fillColor[1],", ").concat(e.fillColor[2],", ").concat(e.fillOpacity,")"),this.ctx.strokeStyle="rgba(".concat(e.borderColor[0],", ").concat(e.borderColor[1],", ").concat(e.borderColor[2],", ").concat(e.borderOpacity,")"),this.ctx.lineWidth=e.borderThickness,this.ctx.setLineDash([]),this.ctx.beginPath(),this.ctx.moveTo(r[0],r[1]);for(var a=2;a<r.length;a+=2)this.ctx.lineTo(r[a],r[a+1]);this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke(),i.fillStyle=e.options.aColor;for(a=0;a<o.length;a++)this.ctx.fillText(o[a],r[0]+e.textMargin,r[1]+e.textMargin+n*(a+1));if(this.currEl===e||this.editElem&&this.editElem.obj===e){this.ctx.setLineDash([5,15]),this.ctx.lineWidth=1,this.ctx.strokeStyle="#D3D3D3",this.ctx.beginPath(),this.ctx.moveTo(r[0],r[1]);for(a=2;a<r.length;a+=2)this.ctx.lineTo(r[a],r[a+1]);this.ctx.closePath(),this.ctx.stroke()}this.ctx.restore()},O.prototype.updateTextPosition=function(t,e){var i=this.ctx,n=_.max(_.map(e,function(t){return i.measureText(t).width})),e=e.length*t.fontSize,o=this.annotateGL.convertPositionDataToPixels(t,this.isXZoom,this.isYZoom,this.xAxisDataBounds,this.yAxisDataBounds,this.xAxisViewBounds,this.yAxisViewBounds),r=t.anchorPosition,n=n+o[0]+2*t.textMargin,e="topLeft"===r?e+o[1]+2*t.textMargin:o[7]-(e+2*t.textMargin),n=(o[2]=n,o[4]=n,this.annotateGL.getChartAxisDataValueFromPixelPos(!0,n,this.isXZoom?this.xAxisViewBounds:this.xAxisDataBounds)),n=(t.options.aPositionData[2]=n,t.options.aPositionData[4]=n,"topLeft"===r?(o[5]=e,o[7]=e):(o[1]=e,o[3]=e),this.annotateGL.getChartAxisDataValueFromPixelPos(!1,e,this.isYZoom?this.yAxisViewBounds:this.yAxisDataBounds));return"topLeft"===r?(t.options.aPositionData[5]=n,t.options.aPositionData[7]=n):(t.options.aPositionData[1]=n,t.options.aPositionData[3]=n),t.updatePosition(o),o},O.prototype.getAllElements=function(){return this.editElem&&this.editElem.points?this.annotations.concat(this.editElem.points):this.annotations},O.prototype.initializeEvents=function(){var e=this;this.canvas2d.addEventListener("mousedown",this.onAnnotateMouseDown.bind(this)),this.canvas2d.addEventListener("mousemove",this.onAnnotateMouseMove.bind(this)),this.canvas2d.addEventListener("mouseup",this.onAnnotateMouseUp.bind(this)),this.lnkAnnotate&&this.lnkAnnotate.addEventListener("click",function(){e.toggleDrawMode()}),this.lnkEditAnnotate&&this.lnkEditAnnotate.addEventListener("click",function(){e.toggleDrawMenu()}),this.lnkUndoAnnotate&&this.lnkUndoAnnotate.addEventListener("click",function(){var t;null!=(t=e.lnkUndoAnnotate)&&t.classList.contains("btn-disabled")||e.onUndo()}),this.lnkRedoAnnotate&&this.lnkRedoAnnotate.addEventListener("click",function(){var t;null!=(t=e.lnkRedoAnnotate)&&t.classList.contains("btn-disabled")||e.onRedo()}),new Event("editTextDrawEvent"),this.canvas2d.addEventListener("editTextDrawEvent",this.onEditTextDraw.bind(this)),new Event("editAnnotationsDrawEvent");this.canvas2d.addEventListener("editAnnotationsDrawEvent",this.onEditAnnotationsDraw.bind(this))},O.prototype.getUniqueId=function(){return _.random(1,16777216)},O.prototype.renderLinks=function(){this.lnksAnnotate=this.el.querySelectorAll(".lnksAnnotate")[0],this.lnkAnnotate=this.el.querySelectorAll("a.lnkAnnotate")[0],this.lnkEditAnnotate=this.el.querySelectorAll("a.lnkEditAnnotate")[0],this.lnkAnnotateIcon=this.el.querySelectorAll("i.draw-icon")[0],this.lnkUndoAnnotate=this.el.querySelectorAll(".lnkUndoAnnotate")[0],this.lnkRedoAnnotate=this.el.querySelectorAll(".lnkRedoAnnotate")[0]},O.prototype.toggleDrawMode=function(){var t="none"!==(null==(t=null==(t=null==(t=this.getOverlay())?void 0:t.el)?void 0:t.style)?void 0:t.display);this.getOverlay().el.style.display=t?"none":"","none"===(null==(t=null==(t=null==(t=this.getOverlay())?void 0:t.el)?void 0:t.style)?void 0:t.display)?null!=(t=this.lnksAnnotate)&&t.classList.add("ui-draw-mode-on"):null!=(t=this.lnksAnnotate)&&t.classList.remove("ui-draw-mode-on"),this.updateDrawIcon()},O.prototype.toggleDrawMenu=function(){null!=(t=this.lnksAnnotate)&&t.classList.contains("ui-draw-mode-on")||this.toggleDrawMode();var t,e=this;new ue({api:this.api,canvas:this.canvas2d,annotations:this.annotations,drawCallback:function(t){t&&e.addToStack(ge.COMMAND_BULK_UPDATE_NEXT,t),e.dialogAllAnnotations=null,e.draw(e.gl)}})},O.prototype.updateDrawIcon=function(){var t=null==(t=this.lnksAnnotate)?void 0:t.classList.contains("ui-draw-mode-on"),e=this.settingsJSON.draw.annotateType,i=this.settingsJSON.draw.color;if(!0===t){switch(e){case v.TREND_LINE:this.lnkAnnotateIcon.className="fa fa-fw fa-minus fa-rotate--45 draw-icon";break;case v.HORIZONTAL_LINE:this.lnkAnnotateIcon.className="fa fa-fw fa-minus draw-icon";break;case v.VERTICAL_LINE:this.lnkAnnotateIcon.className="fa fa-fw fa-minus fa-rotate-90 draw-icon";break;case v.RECTANGLE:this.lnkAnnotateIcon.className="fa fa-fw fa-stop draw-icon";break;case v.TEXT_NOTE:this.lnkAnnotateIcon.className="fa fa-fw fa-file-text draw-icon"}this.lnkAnnotateIcon.style.color=i,this.lnkAnnotateIcon.style.visibility="visible",this.lnkAnnotate&&this.lnkAnnotate.title&&(this.lnkAnnotate.title="Toggle Annotation mode\nCurrent Annotation type: "+v.getAnnotateTypeText(e))}else this.lnkAnnotateIcon.className="fa fa-fw fa-pencil draw-icon",this.lnkAnnotateIcon.style.removeProperty("color"),this.lnkAnnotateIcon.style.visibility="hidden",this.lnkAnnotate&&this.lnkAnnotate.title&&(this.lnkAnnotate.title="Toggle Annotation mode")},O.prototype.textNote=function(t){var i=this,e=_.cloneDeep(this.currEl);new de({api:this.api,annotateEl:e,canvas:this.canvas2d,bEdit:!0,updateCallback:function(t){var e;t&&(e={next:O.getAnnotationJsonProperties(t),prev:O.getAnnotationJsonProperties(_.cloneDeep(i.currEl))},i.addToStack(ge.COMMAND_UPDATE_NEXT,e),i.updateTextAnnotation(t)),i.currEl=null,i.draw(i.gl),i.updateOnMouseUp()}})},O.prototype.updateTextAnnotation=function(t){t&&(this.currEl.copyTextStyleProperty(t),this.saveAnnotations())},O.prototype.onAnnotateMouseDown=function(t){this.gl||this.createWebGLContext();var e=this.getElementFromMousePos(this.gl,t.offsetX,t.offsetY);2===t.detail?(e&&e.annotateType===v.TEXT_NOTE&&(this.currEl=e,this.textNote(t)),this.action=O.ACTION_NONE):this.action!==O.ACTION_DRAW&&(this.drag=!0,t=this.getVertexPositions(t.offsetX,t.offsetY),this.startX=t.x,this.startY=t.y,e?(this.currEl=e.shapeType===v.SHAPE_POINT?this.editElem.obj:e,this.prevStackEl=O.getAnnotationJsonProperties(_.cloneDeep(this.currEl)),this.action=e.shapeType===v.SHAPE_POINT?O.ACTION_RESIZE:O.ACTION_MOVE,this.action===O.ACTION_MOVE?this.editElem=null:this.editElem.activePosIndex=e.options.aPositionXIndex):this.action=O.ACTION_DRAW)},O.prototype.onAnnotateMouseMove=function(t){this.action;var e=this.currEl;if(this.drag){var i=this.getVertexPositions(t.offsetX,t.offsetY);if(this.action===O.ACTION_MOVE){for(var n=e.annotateType===v.HORIZONTAL_LINE?0:i.x-this.startX,o=e.annotateType===v.VERTICAL_LINE?0:i.y-this.startY,r=(this.startX=i.x,this.startY=i.y,0);r<e.options.aPositionData.length;r++)r%2==0&&0!==n?(e.aPosition[r]+=n,e.options.aPositionData[r]=this.annotateGL.getChartAxisDataValueFromPixelPos(!0,e.aPosition[r],this.isXZoom?this.xAxisViewBounds:this.xAxisDataBounds)):r%2==1&&0!==o&&(e.aPosition[r]+=o,e.options.aPositionData[r]=this.annotateGL.getChartAxisDataValueFromPixelPos(!1,e.aPosition[r],this.isYZoom?this.yAxisViewBounds:this.yAxisDataBounds));e.updatePosition(e.aPosition),this.draw(this.gl)}else if(this.action===O.ACTION_RESIZE){var a=this.editElem.activePosIndex,n=(this.startX=e.aPosition[a],this.startY=e.aPosition[a+1],i.x-this.startX),o=i.y-this.startY;if(e.shapeType===v.SHAPE_LINE)e.aPosition[a]+=n,e.aPosition[a+1]+=o,e.options.aPositionData[a]=this.annotateGL.getChartAxisDataValueFromPixelPos(!0,e.aPosition[a],this.isXZoom?this.xAxisViewBounds:this.xAxisDataBounds),e.options.aPositionData[a+1]=this.annotateGL.getChartAxisDataValueFromPixelPos(!1,e.aPosition[a+1],this.isYZoom?this.yAxisViewBounds:this.yAxisDataBounds),e.updatePosition(e.options.aPosition),this.editElem.points=null,this.draw(this.gl);else if(e.shapeType===v.SHAPE_RECTANGLE){for(r=0;r<e.aPosition.length;r+=2)e.aPosition[r]===this.startX&&(e.aPosition[r]+=n,e.options.aPositionData[r]=this.annotateGL.getChartAxisDataValueFromPixelPos(!0,e.aPosition[r],this.isXZoom?this.xAxisViewBounds:this.xAxisDataBounds)),e.aPosition[r+1]===this.startY&&(e.aPosition[r+1]+=o,e.options.aPositionData[r+1]=this.annotateGL.getChartAxisDataValueFromPixelPos(!1,e.aPosition[r+1],this.isYZoom?this.yAxisViewBounds:this.yAxisDataBounds));e.updatePosition(e.options.aPosition),this.editElem.points=null,this.draw(this.gl)}}else if(this.action===O.ACTION_DRAW){var s,l,h,p,u=this.settingsJSON.draw.annotateType,a=v.getShapeType(u),c=(u===v.VERTICAL_LINE?i.x=this.startX+O.LINE_RECT_WIDTH:u===v.HORIZONTAL_LINE&&(i.y=this.startY+O.LINE_RECT_WIDTH),this.annotateGL.getChartAxisDataValueFromPixelPos(!0,this.startX,this.isXZoom?this.xAxisViewBounds:this.xAxisDataBounds)),d=this.annotateGL.getChartAxisDataValueFromPixelPos(!1,this.startY,this.isYZoom?this.yAxisViewBounds:this.yAxisDataBounds),y=this.annotateGL.getChartAxisDataValueFromPixelPos(!0,i.x,this.isXZoom?this.xAxisViewBounds:this.xAxisDataBounds),g=this.annotateGL.getChartAxisDataValueFromPixelPos(!1,i.y,this.isYZoom?this.yAxisViewBounds:this.yAxisDataBounds);switch(a){case v.SHAPE_LINE:e=new v({annotateType:u,aPositionData:[c,d,y,g],aColor:this.settingsJSON.draw.color,id:this.getUniqueId()});break;case v.SHAPE_RECTANGLE:e=u===v.TEXT_NOTE?(s=Math.min(c,y),l=Math.max(c,y),h=Math.min(d,g),p=Math.max(d,g),new v({annotateType:u,aPositionData:[s,p,l,p,l,h,s,h],aColor:this.settingsJSON.draw.color,id:this.getUniqueId()})):new v({annotateType:u,aPositionData:[c,d,c,g,y,d,y,g],aColor:this.settingsJSON.draw.color,id:this.getUniqueId()})}this.currEl=e,this.draw(this.gl)}}else{var f=this.getElementFromMousePos(this.gl,t.offsetX,t.offsetY);if(f){switch(f.annotateType){case v.HORIZONTAL_LINE:document.body.style.cursor="ns-resize";break;case v.VERTICAL_LINE:document.body.style.cursor="ew-resize";break;default:document.body.style.cursor="move"}if((!this.editElem||this.editElem&&this.editElem.obj!=f)&&(this.editElem={obj:f,points:[]}),f.shapeType!==v.SHAPE_POINT){if(f.annotateType!==v.HORIZONTAL_LINE&&f.annotateType!==v.VERTICAL_LINE&&f.annotateType!==v.TEXT_NOTE){for(r=0;r<f.options.aPositionData.length;r+=2){var m=new v({shapeType:v.SHAPE_POINT,aPositionData:[f.options.aPositionData[r],f.options.aPositionData[r+1]],aColor:"#d3d3d3",aPositionXIndex:r,annEl:f,id:this.getUniqueId()});this.editElem.points.push(m)}this.draw(this.gl)}}else if(f.shapeType===v.SHAPE_POINT){var P=f.options.annEl;this.editElem.obj=P;for(r=0;r<P.options.aPositionData.length;r+=2){var x=P.options.aPositionData[r]===f.options.aPositionData[0]&&P.options.aPositionData[r+1]===f.options.aPositionData[1]?"#ff0000":"#d3d3d3",m=new v({shapeType:v.SHAPE_POINT,aPositionData:[P.options.aPositionData[r],P.options.aPositionData[r+1]],aColor:x,aPositionXIndex:r,annEl:P,id:this.getUniqueId()});this.editElem.points.push(m)}this.draw(this.gl)}}else document.body.style.cursor="default",this.editElem=null}},O.prototype.onAnnotateMouseUp=function(t){var e,i;this.drag&&(this.drag=!1,this.action===O.ACTION_DRAW&&this.currEl?this.currEl.annotateType===v.TEXT_NOTE?new de({api:(e=this).api,annotateEl:this.currEl,canvas:this.canvas2d,bEdit:!1,updateCallback:function(t){e.addAnnotationToList(t)}}):this.addAnnotationToList(this.currEl):(this.action!==O.ACTION_NONE&&this.currEl&&(i=O.getAnnotationJsonProperties(_.cloneDeep(this.currEl)),_.isEqual(this.prevStackEl,i)||(i={next:i,prev:this.prevStackEl},this.addToStack(ge.COMMAND_UPDATE_NEXT,i),this.prevStackEl=null)),this.saveAnnotations(),this.updateOnMouseUp())),document.body.style.cursor="default"},O.prototype.addAnnotationToList=function(t){this.action===O.ACTION_DRAW&&(t&&(this.annotations.push(t),this.addToStack(ge.COMMAND_APPEND,O.getAnnotationJsonProperties(_.cloneDeep(t)))),this.currEl=null,this.draw(this.gl)),this.saveAnnotations(),this.updateOnMouseUp()},O.prototype.updateOnMouseUp=function(){this.editElem=null,this.currEl=null,this.dialogCurrEl=null,this.action=O.ACTION_NONE},O.prototype.updateLineEndpoints=function(t){t.annotateType===v.VERTICAL_LINE?(t.options.aPositionData[1]=(this.yAxisDataBounds[0].x<this.yAxisViewBounds[0].x?this.yAxisDataBounds:this.yAxisViewBounds)[0].x,t.options.aPositionData[5]=t.options.aPositionData[1],t.options.aPositionData[3]=(this.yAxisDataBounds[0].y>this.yAxisViewBounds[0].y?this.yAxisDataBounds:this.yAxisViewBounds)[0].y,t.options.aPositionData[7]=t.options.aPositionData[3]):t.annotateType===v.HORIZONTAL_LINE&&(t.options.aPositionData[0]=(this.xAxisDataBounds[0].x<this.xAxisViewBounds[0].x?this.xAxisDataBounds:this.xAxisViewBounds)[0].x,t.options.aPositionData[2]=t.options.aPositionData[0],t.options.aPositionData[4]=(this.xAxisDataBounds[0].y>this.xAxisViewBounds[0].y?this.xAxisDataBounds:this.xAxisViewBounds)[0].y,t.options.aPositionData[6]=t.options.aPositionData[4])},O.prototype.getElementFromMousePos=function(t,e,i){var n,o=this.getAllElements();return o&&0<o.length?(o.forEach(function(t){t.setReadState()}),this.draw(t,!0),n=new Uint8Array(4),t.readPixels(e,this.canvas.height-i,1,1,t.RGBA,t.UNSIGNED_BYTE,n),e=this.selectObject(n),o.forEach(function(t){t.setDrawState()}),this.draw(t),e):null},O.prototype.getVertexPositions=function(t,e){return{x:t,y:e}},O.prototype.selectObject=function(t){var e=v.getIdFromSelColor(t);return this.getAllElements().find(function(t){return t.id===e})},O.FONT_DEFAULT="Segoe UI,Helvetica,Arial,sans-serif",O.ACTION_NONE="none",O.ACTION_DRAW="draw",O.ACTION_MOVE="move",O.ACTION_RESIZE="resize",O.PROP_ANNOTATIONS="Annotations.Annotations",O.PROP_ANNOTATE_CONTROL="Annotations.ShowAnnotateControl",O.LINE_RECT_WIDTH=3,O.LEGEND_WIDTH=130;var me,Pe=O;function O(t){var e=me.call(this,t)||this,i=(e.isInitialized=!1,e.action=O.ACTION_NONE,e.annotations=[],e.drag=!1,e.startX=0,e.startY=0,e.xAxisDataBounds=[],e.yAxisDataBounds=[],e.xAxisViewBounds=[],e.yAxisViewBounds=[],e.isXZoom=!1,e.isYZoom=!1,e.isZoom=!1,e.canvas=t.canvas,e.canvas2d=t.canvas2d,e.canvas2d.getContext("2d"));if(i)return e.ctx=i,e.getOverlay=t.getOverlay,e.api=t.api,e.drawEl=t.drawEl,e.onResize=t.onResize,e.el=t.el,e.el.innerHTML=F.annotate({}),e.api.getProperty(O.PROP_ANNOTATIONS)&&e.createWebGLContext(),e.render(),e.renderLinks(),e.annotateStack=new ge,e.initializeEvents(),e;throw new Error("ChartGL: failed to get 2D context")}u.easeInQuad=function(t){return Math.pow(t,2)},u.easeOutQuad=function(t){return-(Math.pow(t-1,2)-1)},u.easeInOutQuad=function(t){return(t/=.5)<1?.5*Math.pow(t,2):-.5*((t-=2)*t-2)},u.easeInCubic=function(t){return Math.pow(t,3)},u.easeOutCubic=function(t){return Math.pow(t-1,3)+1},u.easeInOutCubic=function(t){return(t/=.5)<1?.5*Math.pow(t,3):.5*(Math.pow(t-2,3)+2)},u.easeInQuart=function(t){return Math.pow(t,4)},u.easeOutQuart=function(t){return-(Math.pow(t-1,4)-1)},u.easeInOutQuart=function(t){return(t/=.5)<1?.5*Math.pow(t,4):-.5*((t-=2)*Math.pow(t,3)-2)},u.easeInQuint=function(t){return Math.pow(t,5)},u.easeOutQuint=function(t){return Math.pow(t-1,5)+1},u.easeInOutQuint=function(t){return(t/=.5)<1?.5*Math.pow(t,5):.5*(Math.pow(t-2,5)+2)},u.easeInSine=function(t){return 1-Math.cos(t*(Math.PI/2))},u.easeOutSine=function(t){return Math.sin(t*(Math.PI/2))},u.easeInOutSine=function(t){return-.5*(Math.cos(Math.PI*t)-1)},u.easeInExpo=function(t){return 0===t?0:Math.pow(2,10*(t-1))},u.easeOutExpo=function(t){return 1===t?1:1-Math.pow(2,-10*t)},u.easeInOutExpo=function(t){return 0===t?0:1===t?1:(t/=.5)<1?.5*Math.pow(2,10*(t-1)):.5*(2-Math.pow(2,-10*--t))},u.easeInCirc=function(t){return-(Math.sqrt(1-t*t)-1)},u.easeOutCirc=function(t){return Math.sqrt(1-Math.pow(t-1,2))},u.easeInOutCirc=function(t){return(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},u.easeOutBounce=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},u.easeInBack=function(t){return t*t*(2.70158*t-1.70158)},u.easeOutBack=function(t){return(t-=1)*t*(2.70158*t+1.70158)+1},u.easeInOutBack=function(t){var e=1.70158;return(t/=.5)<1?t*t*((1+(e*=1.525))*t-e)*.5:.5*((t-=2)*t*((1+(e*=1.525))*t+e)+2)},u.elastic=function(t){return-1*Math.pow(4,-8*t)*Math.sin((6*t-1)*(2*Math.PI)/2)+1},u.swingFromTo=function(t){var e=1.70158;return(t/=.5)<1?t*t*((1+(e*=1.525))*t-e)*.5:.5*((t-=2)*t*((1+(e*=1.525))*t+e)+2)},u.swingFrom=function(t){return t*t*(2.70158*t-1.70158)},u.swingTo=function(t){return--t*t*(2.70158*t+1.70158)+1},u.bounce=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},u.bouncePast=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?2-(7.5625*(t-=1.5/2.75)*t+.75):t<2.5/2.75?2-(7.5625*(t-=2.25/2.75)*t+.9375):2-(7.5625*(t-=2.625/2.75)*t+.984375)},u.easeFromTo=function(t){return(t/=.5)<1?.5*Math.pow(t,4):-.5*((t-=2)*Math.pow(t,3)-2)},u.easeFrom=function(t){return Math.pow(t,4)},u.easeTo=function(t){return Math.pow(t,.25)};var xe=u;function u(){}var z,U,ve={left:"right",right:"left",top:"bottom",bottom:"top",center:"center"},Oe=(N.prototype.drawLabels=function(t,e,i,n,o,u,c,d,y,g,f){var m,r,a,P,x,v,O,T,R,b,_,C,s,L,A,E,S,l,h,D,I,B=this;this.propertyCache&&(m=this.propertyCache[N.PROP_LABEL_ALIGN],h=this.propertyCache[N.PROP_LABEL_COLOR],s=this.propertyCache[N.PROP_LABEL_FONT_BOLD],l=this.propertyCache[N.PROP_LABEL_FONT_SIZE],r=0<(r=this.propertyCache[N.PROP_LABEL_FREQ])?r:1,a=this.propertyCache[N.PROP_LABEL_MAX_LABELS]||1,P=this.propertyCache[N.PROP_LABEL_OFFSET],x=this.propertyCache[N.PROP_LABEL_ROTATION],this.updateCanvasContext(m,h,s,l),v=new Y(i.x,i.z).applyFn(function(t){return Number(X.convertJSToScalar(n,t))}),O=new Y(i.y,i.w).applyFn(function(t){return Number(X.convertJSToScalar(o,t))}),h=this.api.getProperty("Layers."+e+"."+H.PROP_TYPE),T=h===G.Bounds,R=h===G.Baseline,b=h===G.Bar,_=h===G.Heatmap,C=t[0],s=T?[C]:t[1],_&&(s=[t[1][0]]),L=t[1][2],A=t[1][1],E=a>C.length?C.length:a,S=T?2*r:r,l=this.api.getProperty("Layers."+e+".XAxisId"),i=this.api.getProperty("Layers."+e+".YAxisId"),h=l.replace(/.*?(\d+)$/,"$1")-1,t=i.replace(/.*?(\d+)$/,"$1")-1,D=this.api.getProperty("Xaxes."+h+".Stacked"),I=this.api.getProperty("Yaxes."+t+".Stacked"),s.forEach(function(t,e){for(var i=0,n=0;n<E;n+=S){var o,r=B.labelStrings[e][i],a="y"===g,s="x"===g,l=T?(C[n+1]+C[n])/2:C[n],h=(R&&"center"===m&&a&&(l=(l+(v.x<0?0:v.x))/2),_&&("center"===m||"top"===m||"bottom"===m?l=(C[n]+A[n])/2:"right"===m&&(l=A[n])),X.normalize(Number(l),v.x,v.y)),p=f&&f[e]?f[e][n]:null,l=(b&&(l=D&&!y?l:l-u+c*(d+.5),y&&(l=I&&null!==p?"center"===m?(p+(p-C[n]))/2:p:(l+(v.x<0?0:v.x))/2),h=X.normalize(l,v.x,v.y)),h*B.canvas.width),h=(R&&a&&"center"!==m&&(l-=(o=B.ctx.measureText(r)).width/2),T?Number(O.y):t[n]),a=(_&&("center"===m||"left"===m||"right"===m?h=(t[n]+L[n])/2:"top"===m&&(h=L[n])),I&&!y&&null!==p?h="center"===m?(p+(p-t[n]))/2:p:(b&&!y||T||s)&&"center"===m&&(h=(h+(O.x<0?0:O.x))/2),(1-X.normalize(h,O.x,O.y))*B.canvas.height),p=(R&&s&&"center"!==m&&(a+=((o=B.ctx.measureText(r)).actualBoundingBoxAscent+o.actualBoundingBoxDescent)/2),0),h=0;P&&(p=Number(P.split(",")[0]),s=P.substring(P.indexOf(",")+1),h=Number(s.length?s:p)),B.ctx.save(),B.ctx.translate(l+p+B.xPadding,a+h+B.yPadding),B.ctx.rotate(x*(Math.PI/180)),B.ctx.fillText(r,0,0),B.ctx.restore(),i++}d++}))},N.prototype.getMaxLabelSize=function(t,s,l,e,h,p,u){var c,d,y,g,f,m,P,x,v,O,T,R,b,i,n,o,r,a,_=this;return this.propertyCache&&(n=this.propertyCache[N.PROP_LABEL_FONT_BOLD],o=this.propertyCache[N.PROP_LABEL_FONT_SIZE],a=this.propertyCache[N.PROP_LABEL_FREQ],c=0<a?a:1,a=this.propertyCache[N.PROP_LABEL_MAX_LABELS]||1,i=this.propertyCache[N.PROP_LABEL_TEMPLATE],d=this.propertyCache[N.PROP_LABEL_ALIGN],this.ctx.font=(n?"bold ":"")+o+"px "+W.FONTFACE,y=this.api.getTemplateViewStates(i),g=k.compile(i),f=this.api.getProperty("Layers."+l+"."+H.PROP_TYPE),m=f===G.Bounds,n=f===G.Baseline,P=t[0],o=m?[P]:t[1],f===G.Heatmap&&(o=[t[1][0]]),x=a>(null==P?void 0:P.length)?P.length:a,v=m?2*c:c,O=0,T=new Y(e.y,e.w).applyFn(function(t){return Number(X.convertJSToScalar(p,t))}),R=new Y(e.x,e.z).applyFn(function(t){return Number(X.convertJSToScalar(h,t))}),n&&(o.length||(o=[[T.y]]),P&&P.length||(P=[R.y])),this.labelStrings=[],b=[],o.forEach(function(t,e){_.labelStrings[e]=[],b[e]=[];for(var i=O=0;i<x;i+=v){var n=_.getRowData(O),o=f===G.Heatmap?"right"===d?".HeatmapX2":".HeatmapX1":".XAxis",o=_.api.getProperty("Layers."+l+o),o=n?n[o]:null,r=f===G.Heatmap&&"bottom"!==d?1:e,r=n?n[s[r]]:null,a=(u&&("x"===(a=u.axis)?(o=u.jsVal,r=X.convertToJsScalar(p,T.y,!0)):"y"===a&&(r=u.jsVal,o=X.convertToJsScalar(h,R.y,!0))),A(A({},y),{x:m?P[i]:o,y:m?Number(T.y):r,data:n,index:i,xColData:P[i]})),o=g(a);O+=c,_.labelStrings[e].push(o),b[e].push(a)}}),b[0])?(i=b[0].map(function(t,e){return t.xColData}),t=this.api.getProperty("Layers."+l+".XAxisId").replace(/.*?(\d+)$/,"$1")-1,a=this.api.getProperty("Xaxes."+t+".Type"),n=(e=this.getSortedIndices(b,a,i,t,f))[0],o=e[e.length-1],a=this.ctx.measureText(this.labelStrings[0][n]),e=(t=this.ctx.measureText(this.labelStrings[0][o])).actualBoundingBoxAscent+t.actualBoundingBoxDescent,r=this.propertyCache[N.PROP_LABEL_ALIGN],a=a.width,t=t.width,"left"===r&&(a*=2),"right"===r&&(t*=2),-1!==["top","bottom"].indexOf(r)&&(e*=2),{left:{width:a,position:X.convertToJsScalar(h,i[n])},right:{width:t,position:X.convertToJsScalar(h,i[o])},height:e}):null},N.prototype.onSettingsChange=function(t){var e=t[N.PROP_LABEL_ALIGN],e=ve[e];this.propertyCache=t,this.xPadding="right"===e?-5:"left"===e?5:0,this.yPadding="bottom"===e?-5:"top"===e?5:0},N.prototype.removeLabels=function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},N.prototype.updateTheme=function(t,e){var i=this.api.getProperty("Layers."+e+"."+N.PROP_LABEL_COLOR);"Light"!==t||"#ffffff"!==i&&"#fff"!==i?"Dark"!==t||"#000000"!==i&&"#000"!==i||(this.api.setProperty("Layers."+e+"."+N.PROP_LABEL_COLOR,"#ffffff"),this.propertyCache&&(this.propertyCache[N.PROP_LABEL_COLOR]="#ffffff")):(this.api.setProperty("Layers."+e+"."+N.PROP_LABEL_COLOR,"#000000"),this.propertyCache&&(this.propertyCache[N.PROP_LABEL_COLOR]="#000000"))},N.prototype.getSortedIndices=function(t,e,i,n,o){var r=o===G.Bounds,o=o===G.Baseline,a=t[0].map(function(t){return t.index});if(o)a=[0];else if("Linear"===e||"Time"===e||"Logarithmic"===e){for(var s=0;s<i.length;s++)a[s]=s;r||X.sortFn(a,i)}else if("Category"===e)if(this.api.getProperty("Xaxes."+n+".FilterUnique")){var l=new Map;i.forEach(function(t,e){var i=l.get(t);i?i.push(e):l.set(t,[e])}),a=[].concat.apply([],Array.from(l.values()))}else for(a=new Array(i.length),s=0;s<i.length;s++)a[s]=s;return a},N.prototype.updateCanvasContext=function(t,e,i,n){this.ctx.fillStyle=e,this.ctx.font=(i?"bold ":"")+n+"px "+W.FONTFACE;e=ve[t];"top"===t||"bottom"===t?(this.ctx.textBaseline=e,this.ctx.textAlign="center"):(this.ctx.textAlign=e,this.ctx.textBaseline="middle")},N.PROP_LABEL_ALIGN="Labels.Align",N.PROP_LABEL_MAX_LABELS="Labels.MaxLabels",N.PROP_LABEL_COLOR="Labels.Color",N.PROP_LABEL_FONT_BOLD="Labels.Font.Bold",N.PROP_LABEL_FONT_SIZE="Labels.Font.Size",N.PROP_LABEL_FREQ="Labels.Frequency",N.PROP_LABEL_OFFSET="Labels.Offset",N.PROP_LABEL_ROTATION="Labels.Rotation",N.PROP_LABEL_TEMPLATE="Labels.Template",N);function N(t,e,i){this.canvas=t,this.api=e,this.getRowData=i,this.labelStrings=[],this.xPadding=0,this.yPadding=0;t=this.canvas.getContext("2d");if(!t)throw new Error("ChartGL: failed to get 2D context");this.ctx=t}(e=z=z||{})[e.Init=0]="Init",e[e.Data=1]="Data",e[e.Process=2]="Process",e[e.Legend=3]="Legend",e[e.Axis=4]="Axis",e[e.Uniforms=5]="Uniforms",e[e.Loaded=6]="Loaded",e[e.Tooltip=7]="Tooltip",e[e.Valid=8]="Valid",(i=U=U||{})[i.Default=0]="Default",i[i.Fill=1]="Fill",i[i.Bubble=2]="Bubble",i[i.Border=3]="Border";Z.getNewLayerId=function(t){for(var e=0;t["L"+e];)e++;return"L"+e},Z.prototype.updateWebGLContext=function(t,e,i){var n=this,o=t&&e,r=!t||!e;if(this.gl&&(o||r)&&(this.clearWebGLViewport(this.gl),this.layers.forEach(function(t){return t.removeWebGLRefs(n.gl)})),o){o=this.el.getElementsByClassName("webgl-wrapper")[0],o=Ft.replaceWebGLCanvas(this.canvas,o);this.uid=o.uid,this.canvas=o.canvas,this.gl=t}else if(r&&(this.gl=Ft.setUpWebGLContext(this.canvas),!this.gl))return;this.useSingleContext=!(!t||!e),this.webGLContextAndCanvas=t&&e?{gl:t,canvas:e,elements:i}:void 0,this.processIfFixedBarsOrLine(!1,!0)},Z.prototype.onOverlayOver=function(t){var e;(null==t?void 0:t.x)===(null==(e=this.overPoint)?void 0:e.x)&&(null==t?void 0:t.y)===(null==(e=this.overPoint)?void 0:e.y)||(!t&&this.overPoint&&this.api.setProperty(Z.PROP_HOVER,""),this.overPoint=t,this.invalidate(z.Tooltip),t&&(this.hover=!0))},Z.prototype.onOverlayZoom=function(t){M.Log.Log("Region: "+t);var t=new V(t.x,1-t.w,t.z,1-t.y),e=new Y(this.activeZoom.x,this.activeZoom.z),i=new Y(this.activeZoom.y,this.activeZoom.w),n=X.calculateCroppedJs2(new Y(t.x,t.z),e),o=X.calculateCroppedJs2(new Y(t.y,t.w),i),n=(this.onXZoom=!_.isEqual(e,n),this.onYZoom=!_.isEqual(i,o),this.zoomTime=Date.now(),this.zoomEnabled?this.activeZoom:new V(0,0,1,1));this.activeZoom=this.activeZoom?X.calculateCroppedBounds(t,n):t,this.onZoom(t,!!e,!!i)},Z.prototype.onOverlayReset=function(){var i=this;this.click=!1,this.zoomTime=Date.now(),this.activeZoom=new V(0,0,1,1),this.resetZoom=!0,this.onXZoom=!0,this.onYZoom=!0,this.activeXPan.forEach(function(t,e){return i.activeXPan[e]=new Y(0,1)}),this.activeYPan.forEach(function(t,e){return i.activeYPan[e]=new Y(0,1)}),this.setIgnoreSettings(!0),this.axis.x.forEach(function(t,e){i.api.getProperty("Xaxes."+e+W.PROP_RESET_NULL)&&t.setRangeViewstate(null,"Xaxes",e),i.xAxisZoom[e]=new Y(0,1)}),this.axis.y.forEach(function(t,e){i.api.getProperty("Yaxes."+e+W.PROP_RESET_NULL)&&t.setRangeViewstate(null,"Yaxes",e),i.yAxisZoom[e]=new Y(0,1)}),this.setIgnoreSettings(!1),this.zoomedXDataBounds=[],this.zoomedYDataBounds=[],this.processIfFixedBarsOrLine()},Z.prototype.onPan=function(t,e,i,n){e&&this.crosshairSelected.onPan(e,this.canvas);e="Right"===n||"Left"===n;e?this.activeXPan[i]=new Y(t.x,t.z):this.activeYPan[i]=new Y(t.y,t.w),this.pannedAxis={axis:e?"x":"y",index:i},this.processIfFixedBarsOrLine(!0)},Z.prototype.getFileExporterWidth=function(){return this.fileExporterView?this.fileExporterView.getWidth():0},Z.prototype.getAnnotateWidth=function(){return this.annotationsView?this.annotationsView.getWidth():0},Z.prototype.onResize=function(){this.size=new Y(this.el.offsetWidth,this.el.offsetHeight),this.legend.onResize(this.el.offsetHeight),this.axis.onResize(),this.processIfFixedBarsOrLine()},Z.prototype.onResizeStop=function(){this.useSingleContext&&this.debouncedResizeStop()},Z.prototype.onSettingsChange=function(i){var e,n,o,r,a,s,l,h,t,p,u,c,d,y,g,f=this;this.ignoreSettingsChange||(y=_.find(_.keys(i),function(t){return 0===t.indexOf(Z.PROP_SELECT)}),d=_.find(_.keys(i),function(t){return 0===t.indexOf(Z.PROP_HOVER)}),(!y&&d||!d&&y)&&(this.settingsSelected=!(!y||this.click),this.settingsHovered=!(!d||this.hover),this.invalidate(z.Tooltip)),i.hasOwnProperty("Layers")||(y=X.expandNestedViewStates(i,this.api),d=X.replaceViewStatesWithValue("",y,this.api),i=d),0<(y=_.filter(_.keys(i),function(t){return-1!==t.indexOf("Layers.")})).length&&(e={},_.each(y,function(t){_.set(e,t,i[t]),delete i[t]}),_.extend(i,e)),d=i[Z.PROP_LEGEND_GROUPS],y=this.api.getProperty(Z.PROP_LEGEND_GROUPS).filter(function(t){return!!t}),(d||i[Z.PROP_LAYERS])&&(g=(t=y.length&&this.api.getProperty("Layers").some(function(t){return t.LegendGroup&&"None"!==t.LegendGroup}))?["Left","Right"]:["Top","Bottom","Left","Right"],this.api.getProperty(Z.PROP_POSSIBLEPOSITIONS)!==g)&&(this.api.setProperty(Z.PROP_POSSIBLEPOSITIONS,g),!t||"Top"!==(g=this.api.getProperty("Legend.Position"))&&"Bottom"!==g||this.api.setProperty("Legend.Position","Right")),d&&d.length&&(y.forEach(function(t,e){t=t.Name;_.isEmpty(t)&&f.api.setProperty(Z.PROP_LEGEND_GROUPS+"."+e+".Name","Legend Group "+(e+1))}),t=this.api.getProperty(Z.PROP_POSSIBLELEGENDGROUPS),g=y.map(function(t){return t.Name}),t!==["None"].concat(g)&&this.api.setProperty(Z.PROP_POSSIBLELEGENDGROUPS,["None"].concat(g)),this.legend.onSettingsChange(y)),d=i[Z.PROP_RANGE_SELECT],t=this.api.getProperty(Z.PROP_RANGE_SELECT),g=this.api.getProperty(Z.PROP_ZOOM),y=i[Z.PROP_ZOOM],_.isNil(d)&&_.isNil(y)||(t?(this.zoomEnabled=!1,this.rangeSelectorEnabled=!0):!1===t&&(this.rangeSelectorEnabled=!1),g!==this.zoomEnabled&&(g&&this.rangeSelectorEnabled||(this.zoomEnabled=g),d=void 0!==this.api.getProperty(Z.PROP_DURATION),y=this.api.getProperty(Z.PROP_EASING),!this.zoomEnabled||d&&y?this.zoomEnabled||!d&&!y||(this.api.setProperty(Z.PROP_DURATION,void 0),this.api.setProperty(Z.PROP_EASING,void 0)):(this.api.setProperty(Z.PROP_DURATION,400),this.api.setProperty(Z.PROP_EASING,"easeOutQuart")),this.api.getProperty("Yaxes").forEach(function(t,e){var i=void 0===f.api.getProperty("Yaxes."+e+".Range.SelectionMin"),n=void 0===f.api.getProperty("Yaxes."+e+".Range.SelectionMax");i&&n||!f.rangeSelectorEnabled?(i||n)&&f.zoomEnabled&&(f.api.setProperty("Yaxes."+e+".Range.SelectionMin",""),f.api.setProperty("Yaxes."+e+".Range.SelectionMax","")):(f.api.setProperty("Yaxes."+e+".Range.SelectionMin",void 0),f.api.setProperty("Yaxes."+e+".Range.SelectionMax",void 0))})),this.invalidate(z.Axis)),t=i[tt.PROP_HIERARCHICAL_RULES],g=i[Z.PROP_INHERIT_RULES],!t&&void 0===g||(t&&this.api.setProperty(tt.PROP_HIERARCHICAL_RULES,t),this.invalidate(z.Process)),i[tt.PROP_OVERRIDE_RULES]&&(this.overrideRules.updateOverrideRulesProperties(),this.invalidate(z.Process)),i[Z.PROP_LAYERS]&&(n=this.api.getProperty(Z.PROP_LAYERS),o=!1,r=_.reduce(n,function(t,e){return t[e[Z.PROP_LAYER_ID]]=!0,t},{}),_.each(this.layers,function(t){void 0===t||r[t.getId()]||(t.isBar()&&f.updateBars(t.getAxisId("x")),o=!0,t.remove(f.gl),f.layers.splice(f.layers.indexOf(t),1),f.activeBounds.splice(f.layers.indexOf(t),1))}),a=this.api.getProperty(Z.PROP_PATTERNS),_.each(this.layers,function(e){var t=_.findIndex(n,function(t){return t._Id===e.getId()});e.index!==t&&(e.index=t),a&&e.updateRenderState()}),d=this.layers.find(function(t){var e;if(i&&i.Layers)return e=i.Layers[t.index],t.getLayerType()!==e._Type||t.wildcardDataChanged(e[H.PROP_DATA])||f.layers.length!==i[Z.PROP_LAYERS].length||e.ShowCurrentTick!==t.isCurrentTickShown()}),this.drawLayers(i),d||this.updateWildcardLayers(),this.invalidate(this.layers.length?o||d?z.Process:z.Legend:z.Uniforms)),_.find(_.keys(i),function(t){return 0===t.indexOf(Z.PROP_FOCUS)})&&(s=_.first(X.focus2Array(this.api.getProperty(Z.PROP_FOCUS)))||[],this.layers.forEach(function(t){return t.setFocus(s)})),y=i[Z.PROP_PATTERNS],_.isNil(y)||(y||this.unsetPatterns(),this.invalidate(z.Process)),_.some(this.layers,function(t){return t.hasData()})&&(i[Z.PROP_LEGEND_POS]||void 0!==i[Z.PROP_USE_CUSTOM_LEGEND]||i[Z.PROP_CUSTOM_LEGEND])&&this.invalidate(z.Legend),l=_.find(_.keys(i),function(t){return 0===t.indexOf("Xaxes")}),h=_.find(_.keys(i),function(t){return 0===t.indexOf("Yaxes")}),g=this.api.getProperty("Xaxes"),t=this.api.getProperty("Yaxes"),p=[],u=[],(l||h)&&(this.axis.x.length===g.length&&this.axis.y.length===t.length||this.updateLayerPossibleAxes(),c=W.RANGE_PROPS,l&&_.each(g,function(e,t){var i=f.axis.x[t];i&&c.filter(function(t){return e[t]!==i.propertyCache[t]})&&p.push(Number(t)),f.axis.onSettingsChange(l,t)}),h&&_.each(t,function(e,t){var i=f.axis.y[t];i&&c.filter(function(t){return e[t]!==i.propertyCache[t]})&&u.push(Number(t)),f.axis.onSettingsChange(h,t)}),this.selZoom||this.checkRangeViewstatesChanged(g,"Xaxes"),this.selZoom||this.checkRangeViewstatesChanged(t,"Yaxes"),this.selZoom&&(this.getSelectionViewstates(),this.zoomTime||(this.zoomTime=Date.now())),d=function(t,i){t.forEach(function(e){f.layers.forEach(function(t){t.getAxisId(i)===e&&t.updateRenderState()})})},p.length||u.length?(p.length&&d(p,"x"),u.length&&d(u,"y"),this.invalidate(z.Process)):this.processIfFixedBarsOrLine()),(y=_.find(_.keys(i),function(t){return 0===t.indexOf(Z.PROP_CROSSHAIRS)}))&&!i[y]&&this.crosshairHover.hideCrosshair("hide-both"),(g=_.find(_.keys(i),function(t){return 0===t.indexOf(Z.PROP_COORDS)}))&&!i[g]&&this.tooltips.hideCoordinates(this.el),_.find(_.keys(i),function(t){return 0===t.indexOf(Z.PROP_EXPORT)})&&(this.fileExporterView.displayChoiceLinkButtons(),this.invalidate(z.Legend)),_.find(_.keys(i),function(t){return 0===t.indexOf(Z.PROP_ANNOTATE_CONTROL)})&&(this.annotationsView.showAnnotateControl(),this.invalidate(z.Legend)),_.find(_.keys(i),function(t){return 0===t.indexOf(Z.PROP_ANNOTATIONS)})&&this.annotationsView.onSettingsChange())},Z.prototype.onWheelZoom=function(t){var e,i,n,o,r=this.zoomedPoint||this.overPoint;r&&t.deltaY&&(t.preventDefault(),o=n=1,t.deltaY<(i=e=0)?(this.zoomedPoint=this.closestPoint,t.shiftKey?(i=.1*r.y,o=1-.1*(1-r.y)):(e=.1*r.x,n=1-.1*(1-r.x))):0<t.deltaY&&(t.shiftKey?(i=-.1*r.y,o=1+.1*(1-r.y)):(e=-.1*r.x,n=1+.1*(1-r.x))),r=new V(e,i,n,o),e=X.calculateCroppedBounds(r,this.activeZoom),i=!t.shiftKey&&1<e.z-e.x,n=t.shiftKey&&1<e.w-e.y,(o=i||n)&&(r=new V(0,0,1,1),i?e=new V(0,e.y,1,e.w):n&&(e=new V(e.x,0,e.z,1))),t.shiftKey?this.onYZoom=!0:this.onXZoom=!0,this.activeZoom=e,this.onZoom(r,!t.shiftKey,t.shiftKey,o))},Z.prototype.onZoom=function(n,t,e,o){var r=this;t&&this.axis.x.forEach(function(t,e){var i=r.xAxisZoom[e]||new Y(0,1);0===i.x&&1===i.y&&(r.zoomedXDataBounds=r.xAxisDataBounds),r.xAxisZoom[e]=o?new Y(0,1):r.xAxisZoom[e]&&r.zoomEnabled?X.calculateCroppedJs2(new Y(n.x,n.z),r.xAxisZoom[e]).applyFn(X.convertJSToNumber):new Y(r.activeZoom.x,r.activeZoom.z)}),e&&this.axis.y.forEach(function(t,e){var i=r.yAxisZoom[e]||new Y(0,1);0===i.x&&1===i.y&&(r.zoomedYDataBounds=r.yAxisDataBounds),r.yAxisZoom[e]=o?new Y(0,1):r.yAxisZoom[e]?X.calculateCroppedJs2(new Y(n.y,n.w),r.yAxisZoom[e]).applyFn(X.convertJSToNumber):new Y(r.activeZoom.y,r.activeZoom.w)}),this.processIfFixedBarsOrLine()},Z.prototype.updateWildcardLayers=function(n,o){var r=this,i=!1,t=_.filter(this.api.getProperty("Layers"),function(t){return X.isRegexOrWild(t.YAxis)});_.each(this.api.getProperty("Layers"),function(t,e){e=r.layers[e];e&&e.isBar()&&(i=r.updateBars(e.getAxisId("x")))}),_.each(t,function(e){var t=_.findIndex(r.layers,function(t){return t.getId()===e._Id}),i=r.api.getProperty("Layers."+t+".Enabled");i||r.legend.updateWildcards(r.layers[t],t),!0!==i||n||r.legend.updateWildcards(r.layers[t],t,"reset",o)}),this.legend.updatePalette(this.layers),this.legend.getLayers(this.layers),i&&this.invalidate(z.Process)},Z.prototype.remove=function(){var e=this;return this.useSingleContext&&this.clearWebGLViewport(this.gl),this.overlay&&this.overlay.remove(),this.layers.forEach(function(t){return t.remove(e.gl)}),this},Z.prototype.setTheme=function(e){"Light"===e?this.el.classList.add("Light"):this.el.classList.remove("Light"),this.axis.updateTheme(e),this.axis.renderAxes(),this.legend.updateTheme(e),this.tooltips.updateTheme(e,this.el),this.layers.forEach(function(t){return t.updateTheme(e)}),this.overrideRules.setTheme(e),this.theme=e,this.invalidate(z.Legend)},Z.prototype.calculatePaddedRange=function(t){var e,i,n,o,r,a=this.animateZoom;return t.isEnabled()&&t.Config?(r=t.index,o=t.getAxisId("x"),i=t.getAxisId("y"),e=this.activeXPan[o],n=this.activeYPan[i],e=new V(e.x,n.x,e.y,n.y),n=this.getDataBounds(r,a,o,i),a=t.getTriggerBounds("x")||new Y(n.x,n.z),o=t.getTriggerBounds("y")||new Y(n.y,n.w),i=new V(a.x,o.x,a.y,o.y),n=this.getLayerDataType("x",r),a=this.getLayerDataType("y",r),o=t.hasDataLabels()?t.getLabelSize(i,n,a):null,r=this.barGroupingInfo,t=t.getPaddedRange(i,this.size,o,r),X.calculateCroppedJsBounds(e,t,n,a)):null},Z.prototype.calculateLayerAxisMaps=function(){var n=this;this.xAxisLayer={},this.yAxisLayer={},this.layerXAxis={},this.layerYAxis={},this.layers.forEach(function(t,e){var i=n.api.getProperty(t.indexProp(H.PROP_XAXISID)).replace(/.*?(\d+)$/,"$1"),t=n.api.getProperty(t.indexProp(H.PROP_YAXISID)).replace(/.*?(\d+)$/,"$1");i&&(i=Number(i)-1,void 0===n.xAxisLayer[i]?n.xAxisLayer[i]=[e]:n.xAxisLayer[i].push(e),n.layerXAxis[e]=i),t&&(t=Number(t)-1,void 0===n.yAxisLayer[t]?n.yAxisLayer[t]=[e]:n.yAxisLayer[t].push(e),n.layerYAxis[e]=t)})},Z.prototype.calculateViewStateOverPoint=function(i){var t,n=this,o=i,e=_.find(this.xAxisViewBounds,function(t,e){e=_.max(n.getLayerDataTypes("x",e));return o=X.convertJSToNumber(X.convertStringToJsScalar(i,e)),t=t.applyFn(X.convertJSToNumber),o>=t.x&&o<=t.y});return e&&(e=e.applyFn(X.convertJSToNumber),t=new Y((o-e.x)/(e.y-e.x),0)),t},Z.prototype.checkRangeViewstatesChanged=function(t,r){var a=this;_.each(t,function(t,e){var i,n=a.api.getPropertyMeta(r+"."+e+W.PROP_SEL_MIN),o=a.api.getPropertyMeta(r+"."+e+W.PROP_SEL_MAX);(n||o)&&(i=!(e=("Xaxes"===r?a.xAxisViewBounds:a.yAxisViewBounds)[e])&&(n.value||o.value),a.zoomEnabled)&&(n.viewstateType||o.viewstateType)&&(e||i)&&(a.selZoom=!0)})},Z.prototype.clearWebGLViewport=function(t){Ft.clearWebGLViewport(t,this.overlay,this.theme,this.el,this.webGLContextAndCanvas)},Z.prototype.createDataBounds=function(t,o,r,a,e){var s=this;return a&&(this.xAxisDataBoundsNoRange=[]),e&&(o=this.getStackedBounds(o,a)),t.map(function(t,e){var i=new Y(0,1),n=(r[e]&&(n=r[e].map(function(t){return s.layers[t].isEnabled()&&s.layers[t].hasData()&&s.layers[t].getLayerType()!==G.Bounds&&s.layers[t].getLayerType()!==G.Baseline?o[t]:null}).filter(function(t){return t}),i=X.mergeRange(n)||new Y(0,1)),a&&(s.xAxisDataBoundsNoRange[e]=i),_.max(s.getLayerDataTypes(a?"x":"y",e)));return s.axis.getBounds(i,a?"Xaxes":"Yaxes",e,n)})},Z.prototype.createViewBounds=function(l,h,p,u,t){var c=this;return t.map(function(t,e){var i,n,o,r=new Y(0,1),a=new Y(0,1),s=u?c.xAxisLayer:c.yAxisLayer;return s[e]?(s=s[e].map(function(t){if(l[t])return u?X.xPart(l[t]):X.yPart(l[t])}).filter(function(t){return t}),r=X.mergeRange(s)||new Y(0,1),s=_.max(c.getLayerDataTypes(u?"x":"y",e)),c.updateZoomValues(r,e,s,u),i=o=(o=(u?c.xAxisZoom:c.yAxisZoom)[e])?o.applyFn(X.convertJSToNumber):u?new Y(c.activeZoom.x,c.activeZoom.z):new Y(c.activeZoom.y,c.activeZoom.w),h?(n=(u?c.lastXZoom:c.lastYZoom)[e])&&(i=X.scale2(p,n,o)):(c.zoomTime=0,u?c.lastXZoom[e]=_.clone(o):c.lastYZoom[e]=_.clone(o)),a=c.zoomEnabled?i.applyFn(X.convertJSToNumber):new Y(0,1),n=X.calculateCroppedJs2(a,r,s),c.api.getProperty(Z.PROP_RANGE_SELECT)&&u&&0===e&&(o=c.axis.getSelectionZoomBounds(n,"Xaxes",e,_.max(c.getLayerDataTypes("x",e,!0)),c.getAllCategoryData("X",e)),c.overlay.updateRangeSelector(X.calculateCrop(o,n,s))),[n,a]):[r,a]})},Z.prototype.drawCoordinates=function(t,e,i,n){var o="";if(e){if(this.overlay.isDraggingRange())return this.tooltips.hideCoordinates(this.el,"x"),void this.tooltips.hideCoordinates(this.el,"y");"x"===(o=this.overlay.getZoomDirection())?this.tooltips.hideCoordinates(this.el,"y"):"y"===o&&this.tooltips.hideCoordinates(this.el,"x")}var r,a,s,l=this.api.getProperty(Z.PROP_SNAP)&&!e,h=!l&&this.overPoint?new Y(this.overPoint.x,Math.abs(this.overPoint.y)):new Y(t.overpoint.x,1-t.overpoint.y),p=e?0:t.layer.index,p=this.activeBounds[p].applyFn(X.toNumber),u=t.layer,c=u.getLayerType(),d=u.isHorizontal(),y=null,g=null,f=c===G.Baseline,m=u.getBaselineInfo(),i=("y"!==o&&(r=u.getAxisType("x")===W.TYPE_CATEGORY?E.Float:(d?u.YType:u.XType)||0,a=(r=f&&m.types?m.types.x:r)?new Y(Number(X.convertJSToScalar(r,p.x)),Number(X.convertJSToScalar(r,p.z))):new Y(p.x,p.z),s=l&&c!==G.Bounds&&c!==G.Baseline?i:(a.y-a.x)*h.x+a.x,y=this.getCoordinateInfo(t,e,s,i,"x")),"x"!==o&&(r=u.getAxisType("y")===W.TYPE_CATEGORY?E.Float:(d?u.XType:u.YType)||0,a=(r=f&&m.types?m.types.y:r)?new Y(Number(X.convertJSToScalar(r,p.y)),Number(X.convertJSToScalar(r,p.w))):new Y(p.y,p.w),s=l&&c!==G.Bounds&&c!==G.Baseline?n:(a.x-a.y)*h.y+a.y,g=this.getCoordinateInfo(t,e,s,n,"y")),u.isHorizontal()?g:y),o=u.isHorizontal()?y:g,d=u.getAxisId("x"),f=u.getAxisId("y");this.tooltips.drawCoordinates(this.canvas,h,this.renderedMargin,this.el,i,o,d,f)},Z.prototype.drawLayers=function(a){var s=this,l=this.api.getProperty(Z.PROP_LAYERS),h=_.reduce(l,function(t,e){return t[e[Z.PROP_LAYER_ID]]=!0,t},{}),i=(_.each(l,function(t,e){a.Layers[e]&&(t=a.Layers[e]);var i,n=s.api.getProperty("Layers."+e+"."+Z.PROP_LAYER_ID),o=t[Z.PROP_LAYER_ID],n=(_.isEmpty(o)&&_.isEmpty(n)&&(o=t[Z.PROP_LAYER_ID]=Z.getNewLayerId(h),h[o]=!0,s.api.setProperty(Z.PROP_LAYERS+"."+e+"."+Z.PROP_LAYER_ID,o,{silent:!0})),t[Z.PROP_LAYER_NAME]),n=(_.isEmpty(n)&&s.api.setProperty(Z.PROP_LAYERS+"."+e+"."+Z.PROP_LAYER_NAME,"Layer "+(e+1)),_.find(s.layers,function(t){return t.getId()===o})),e=_.findIndex(l,function(t){return t._Id===o}),r=!1;n||(r=!0,n=new H(e,o,s.api,s.invalidate.bind(s),s.setIgnoreSettings.bind(s),s.el,s.updateWildcardLayers.bind(s),s.theme||"",s.globalPalette),s.layers.push(n),0<e&&s.layers[e-1].isBar()&&s.updateBars(s.layers[e-1].getAxisId("x"))),n.onSettingsChange(t),0<e&&!n.getDataSource()&&r&&(i=e-1,t=[H.PROP_COLOR,H.PROP_XAXISID,H.PROP_YAXISID,H.PROP_TYPE,H.PROP_XAXIS,H.PROP_YAXIS,H.PROP_BARPERCENT,H.PROP_BARFIXED,H.PROP_BARWIDTHTYPE,H.PROP_BAR_ORIENTATION,H.PROP_FILL,H.PROP_FILLCOLOR,H.PROP_FILLOPACITY,H.PROP_BEARCOLOR,H.PROP_BULLCOLOR,H.PROP_NEUTRALCOLOR,H.PROP_WICKCOLOR,H.PROP_CANDLEPERCENT,H.PROP_CANDLEFIXED,H.PROP_CANDLEWIDTHTYPE,H.PROP_PALETTE,H.PROP_SPAN_GAPS,H.PROP_FILLPALETTE,H.PROP_FADE,H.PROP_INCREASE_COLOR,H.PROP_DECREASE_COLOR,H.PROP_X1_COORD,H.PROP_X2_COORD,H.PROP_INTERPOLATION,H.PROP_STEPPED,H.PROP_BASELINE_AXIS,H.PROP_BASELINE_VALUE,H.PROP_HEATMAP_SCORE,H.PROP_HEATMAP_X1,H.PROP_HEATMAP_X2,H.PROP_HEATMAP_Y1,H.PROP_HEATMAP_Y2,H.PROP_LINETHICKNESS,H.PROP_BUBBLES_COLOR,H.PROP_BUBBLES_OPACITY,H.PROP_RADIUS_SCALE,H.PROP_SEG_LENGTH,H.PROP_LINE_STYLE,H.PROP_DASH_GAP,H.PROP_DASH_WIDTH,H.PROP_BORDER_COLOR,H.PROP_BORDER_OPACITY,H.PROP_BORDER_PALETTE,H.PROP_BORDER_WIDTH],r=_.map(t,function(t){return s.api.getProperty("Layers."+i+"."+t)}),n.updateLayer(s.layers[i].getDataSource(),r,t))}),[]),n=(_.each(l,function(e){var t=s.layers[_.findIndex(s.layers,function(t){return t.getId()===e._Id})];t&&i.push(t)}),this.layers=i,this.legend.getLayers(this.layers),this.layers.filter(function(t){return s.api.getProperty(t.indexProp(H.PROP_TYPE))===G.Line}));this.setIgnoreSettings(!0),_.each(n,function(t){var e=s.api.getProperty(t.indexProp(H.PROP_FILL)),i=s.api.getProperty(t.indexProp("possibleLayers"));i&&i.length===n.length+1||(i=_.map(n,function(t){return"Layer "+(t.index+1)}),i=["No Fill","Origin"].concat(_.without(i,"Layer "+(t.index+1))),s.api.setProperty(t.indexProp("possibleLayers"),i),-1===i.indexOf(e)&&s.api.setProperty(t.indexProp(H.PROP_FILL),"No Fill"))}),this.setIgnoreSettings(!1)},Z.prototype.doActions=function(a,s,l){var h,p=this,t=this.api.getProperty(a.indexProp(H.PROP_ACTIONS));null!=t&&t.length&&(this.setIgnoreSettings(!0),h=[],t.forEach(function(t,i){var e,n=p.api.getProperty(a.indexProp(H.PROP_ACTIONS+"."+i+".Current"));switch(n){case"<thisName>":e=s.name;break;case"<thisX>":e=s.xAxisRaw;break;case"<thisY>":e=s.yAxisRaw;break;default:e=s.data[n]}var o,r=p.api.getProperty(a.indexProp(H.PROP_ACTIONS+"."+i+".Trigger"));"mousemove"===l&&"Hover"!==r||"mousemove"!==l&&"Hover"===r||(o={},Object.keys(t).forEach(function(t){var e;"DataSource"===t?(e=a.indexProp(H.PROP_ACTIONS+"."+i),o[t]=p.api.getProperty(e)[t]):(e=a.indexProp(H.PROP_ACTIONS+"."+i+"."+t),o[t]=p.api.getProperty(e))}),h.push(A(A({},t=o),{Value:e,_PropertyIndex:i})))}),this.api.doActions(h,"Layers.".concat(a.index,".Actions")),this.setIgnoreSettings(!1))},Z.prototype.formatData=function(t,e,i){var n=this.api.getProperty((t="Xaxis"===t?"Xaxes."+i:"Yaxes."+i)+W.PROP_FORMAT),i=this.axis.getProperty(t,i,W.PROP_PRECISION),o=this.api.getProperty(t+W.PROP_HIDETRAIL),t=this.api.getProperty(t+W.PROP_DATE_FORMAT);return X.formatData(e,n,i,o,t)},Z.prototype.getBaselineOverPoint=function(t){var e=t.getBaselineInfo(),i=t.getBaselineAxis(),n="x"===i?"y":"x",o=e.scalarVal,r=t.getAxisId(i),r=("x"===i?this.yAxisViewBounds:this.xAxisViewBounds)[r],n=e.types?e.types[n]:E.Float,n=X.convertJSToScalar(n,null==r?void 0:r.y),r=new Y("x"===i?o:n,"y"===i?o:n),n=X.convertVec4ToScalar(this.getLayerViewBounds(t.index),(null==(i=e.types)?void 0:i.x)||E.Float,(null==(o=e.types)?void 0:o.y)||E.Float);return X.calculateRelativePoint(r,n)},Z.prototype.getClosestPoint=function(t,n,e,i){var o,r,a=this,s=n.isHorizontal(),l=X.convertVec4ToScalar(this.getLayerViewBounds(n.index),this.getLayerDataType("x",n.index),this.getLayerDataType("y",n.index)),t=n.getClosestPointFromRelativeX(s?1+t.y:t.x,s?t.x:1+t.y,this.canvas.width,s?new V(l.y,l.x,l.w,l.z):l,e,i);if(null!==t)return o=t[0],s=t[1],l=t[2],r=t[3],i=function(t){var e=n.getConvertedCategoryData(o,t,r),i=n.getAxisId(t),t=("x"===t?a.xAxisViewBounds:a.yAxisViewBounds)[i];return X.calcCrop(e,t.x,t.y)},t=new Y(n.getAxisType("x")===W.TYPE_CATEGORY?i("x"):s.x,n.getAxisType("y")===W.TYPE_CATEGORY?i("y"):s.y),new St(n,o,t,l,r,e)},Z.prototype.getAllCategoryData=function(t,e){return this.api.getProperty(t+"axes."+e+".Type")!==W.TYPE_CATEGORY||null==(t=this.layers.filter(function(t){return t.getAxisId("x")===e})[0])?void 0:t.getAllCategoryData("x")},Z.prototype.getAxisDataBounds=function(t,e,i,n,o){var r=t,a=(null==(a=this.pannedAxis)?void 0:a.axis)===i&&(null==(a=this.pannedAxis)?void 0:a.index)===n,n=(null==(i=("x"===i?this.xAxisViewBounds:this.yAxisViewBounds)[n])?void 0:i.y)>=t.y;return r=!o&&!a||!e||e.x===t.x&&e.y===t.y?r:new Y(e.x,(n?t:e).y)},Z.prototype.getDataBounds=function(t,e,i,n){var t=this.getLayerDataBounds(t),o=this.zoomedXDataBounds[i],r=this.zoomedYDataBounds[n],o=this.getAxisDataBounds(X.xPart(t),o,"x",i,e),i=this.getAxisDataBounds(X.yPart(t),r,"y",n,e);return new V(o.x,i.x,o.y,i.y)},Z.prototype.getLayerDataBounds=function(t){return V.fromVec2(this.xAxisDataBounds[this.layerXAxis[t]],this.yAxisDataBounds[this.layerYAxis[t]])},Z.prototype.getLayerViewBounds=function(t){return V.fromVec2(this.xAxisViewBounds[this.layerXAxis[t]],this.yAxisViewBounds[this.layerYAxis[t]])},Z.prototype.getCoordinateInfo=function(t,e,i,n,o){var r=t.layer.getAxisId(o),a=o.toUpperCase()+"axes.",e=e?this.api.getProperty(a+"0.Position"):this.api.getProperty(a+r+".Position"),a=i;return!_.isEqual(i,n)&&M.Tools.isKDBTemporal(n)&&(r=t.layer.index,a=X.convertToJsScalar(this.getLayerDataType(o,r),i,!0)),{position:e,val:a}},Z.prototype.getGroupedBars=function(){var s,i,n,o,l=this,h=[];if(this.layers.filter(function(t){return t.isBar()&&t.isEnabled()}).forEach(function(e){var t=e.getWildcardColumns();1<t.length?t.forEach(function(t){return h.push(e)}):h.push(e)}),h.length)return s={},this.api.getProperty("Xaxes").forEach(function(t,e){var i=h.filter(function(t){return t.getAxisId("x")===e}),n=l.api.getProperty("Xaxes."+e+W.PROP_FILTER_UNIQUE),o=l.api.getProperty("Xaxes."+e+W.PROP_TYPE),r=i.map(function(t){return t.getGroupedBarData()}),a=[];r.forEach(function(t,e){var i;a=0<e&&o===W.TYPE_CATEGORY&&!n?(i=[],t.forEach(function(t,e){_.isEqual(t[e],a[0][e])||i.push(t)}),a.concat(i)):a.concat(t)}),s[e]={dataLength:(n||o!==W.TYPE_CATEGORY?_.uniq(a):a).length,indices:i.map(function(t,e){return e}),layers:i}}),i=[],n=[],o=[],h.forEach(function(t,e){t=s[t.getAxisId("x")];i[e]=t.indices,n[e]=t.layers,o[e]=t.dataLength}),{barIndices:i,dataLengths:o,layersCommonXAxis:n,allBarLayers:h}},Z.prototype.getLayerDataType=function(t,e){var i,n,e=this.layers[e],o=e.getLayerType();return o===G.Baseline?(i=e.getBaselineInfo(),(n=e.getBaselineAxis())===t?i.type:this.getLayerDataTypes(t,e.getAxisId("x"===n?"y":"x"))[0]):"y"===t&&o===G.Bounds?this.getLayerDataTypes(t,e.getAxisId("y"))[0]:!e.hasData()||(i=e.isHorizontal(),n="y"===t&&!i||"x"===t&&i?e.YType:e.XType,e.getAxisType(t)===W.TYPE_CATEGORY)?E.Float:n},Z.prototype.getLayerDataTypes=function(o,r,t){var e=o.toUpperCase()+"axes",i=this.api.getProperty(e+"."+r+".Type"),n=this.layers.filter(function(t){var e=t.getLayerType(),i="y"===o&&e===G.Bounds,e=e===G.Baseline,n=t.isEnabled();return t.getAxisId(o)===r&&n&&t.hasData()&&!i&&!e});return n.length&&(i!==W.TYPE_CATEGORY||t)?n.map(function(t){return"x"===o&&!t.isHorizontal()||"y"===o&&t.isHorizontal()?t.XType:t.YType}):this.axis.getAxisType(e,r)},Z.prototype.getSelectionViewstates=function(){var r=this;this.axis.x.forEach(function(t,e){var i,n,o=r.xAxisDataBounds[e];o?(i=_.max(r.getLayerDataTypes("x",e,!0)),n=r.axis.getSelectionZoomBounds(o,"Xaxes",e,i,r.getAllCategoryData("X",e)),r.xAxisZoom[e]=X.calculateCrop(n,o,i)):r.xAxisZoom[e]=new Y(0,1)}),this.axis.y.forEach(function(t,e){var i,n,o=r.yAxisDataBounds[e];o?(i=_.max(r.getLayerDataTypes("y",e,!0)),n=r.axis.getSelectionZoomBounds(o,"Yaxes",e,i,r.getAllCategoryData("Y",e)),r.yAxisZoom[e]=X.calculateCrop(n,o,i)):r.yAxisZoom[e]=new Y(0,1)})},Z.prototype.getStackedBounds=function(n,o){var r=this;return this.api.getProperty(Z.PROP_YAXES).map(function(t,e){return r.layers.filter(function(t){return t.isEnabled()&&t.isBar()&&t.getAxisId("y")===e}).map(function(t){return t.index})}).forEach(function(t,e){var i;r.api.getProperty("Yaxes."+e+".Stacked")&&(t=t.map(function(t){return Array.prototype.concat.apply([],r.layers[t].getStackedYData())}),(t=Array.prototype.concat.apply([],t)).length)&&(i=_.min(r.getLayerDataTypes(o?"x":"y",e))||0,n[e]=new Y(X.convertToJsScalar(i,Math.min.apply(Math,t)),X.convertToJsScalar(i,Math.max.apply(Math,t))))}),n},Z.prototype.initializeEventListeners=function(){var e,i=this;this.el.addEventListener("mousedown",function(t){t.target===i.el.getElementsByClassName("axis")[0]&&(i.panning=!0,e=i.pan.onAxisPan(t,i.el.getBoundingClientRect())[1],i.pan.onPointDown(i.pan.onAxisPan(t,i.el.getBoundingClientRect())[0],e))}),document.addEventListener("mouseup",function(){setTimeout(function(){i.panning=!1,i.pannedAxis=null,document.body.style.cursor="default"},75)}),document.addEventListener("mousemove",function(t){i.panning&&(t=i.pan.onAxisPan(t,i.el.getBoundingClientRect())[0],i.pan.onPanning(t,e,i.xAxisZoom,i.yAxisZoom,i.activeXPan,i.activeYPan,i.el))}),this.el.addEventListener("wheel",function(t){i.onWheelZoom(t)})},Z.prototype.invalidate=function(t){if(t<this.renderState){if((this.renderState=t)===z.Process&&this.expressTime<Date.now()-Z.REST_MS&&_.every(this.layers,function(t){return t.RenderState===z.Process}))return this.expressTime=Date.now(),this.validate();window.requestAnimationFrame(this.validate.bind(this))}},Z.prototype.onOverlayClick=function(){this.click=!0,this.invalidate(z.Tooltip)},Z.prototype.processLayerData=function(t,e,i,n){var o,r,a,s,l=this.xAxisZoom[this.layerXAxis[t.index]],h=this.yAxisZoom[this.layerYAxis[t.index]],l=l&&h?V.fromVec2(l,h):this.activeZoom,h=this.zoomEnabled?l:new V(0,0,1,1),l=this.getLayerDataBounds(t.index),p=t.hasBorders()?this.calculatePaddedRange(t):null;("Fixed Width"===t.getBarType()||t.isThickLines()||t.hasLineStyle()||t.hasBorders())&&(o=this.getLayerDataType("x",t.index),r=this.getLayerDataType("y",t.index),t.getInterpolation()!==et.Monotone&&!t.hasLineStyle()||(s=this.activeXPan[this.layerXAxis[t.index]],a=this.activeYPan[this.layerYAxis[t.index]],s=new V(s.x,a.x,s.y,a.y),l=X.calculateCroppedJsBounds(s,l,o,r)),a=X.calculateCroppedJsBounds(h,l,o,r),s=p?X.calculateCroppedJsBounds(h,p,o,r):null,"Percentage"===t.getBarType()&&t.hasBorders()||(l=a),p=s,t.RenderState!==z.Process)&&t.updateRenderState(),t.processData(this.gl,this.size,l,p,t.getLayerType()===G.Bounds?this.getLayerDataType("y",t.index):null,h,e,i?[i,n,h]:null)},Z.prototype.processIfFixedBarsOrLine=function(e,t){var i=this.layers.filter(function(t){return e?t.getLayerType()===G.Line&&(t.getInterpolation()===et.Monotone||t.hasLineStyle()):t.hasFixedWidth()||t.isCandlestick()||t.isThickLines()||t.hasLineStyle()||t.hasStackedGap()||t.hasBorders()}),t=t?this.layers:i;_.each(t,function(t){return t.onResize()}),this.invalidate(t.length?z.Process:z.Axis)},Z.prototype.resizeLabelsCanvas=function(t,e,i,n){var o=this.el.getElementsByClassName("data-labels")[0];o.style.left=t+"px",o.style.top=e+"px",o.width=i,o.height=n},Z.prototype.setIgnoreSettings=function(t){this.ignoreSettingsChange=t},Z.prototype.setMultiAxisSettings=function(t){var s=this;t.forEach(function(t,o){var e,i,r,a=s.api.getProperty("Xaxes."+o+".Format.MultiAxis");t.length?(e=null==a?void 0:a.map(function(t,e){return s.api.getProperty("Xaxes."+o+".Format.MultiAxis."+e+".Field")}),i=t.map(function(t){return t[3]}),a&&_.isEqual(e,i)||(r=[],t.forEach(function(t,e){var i=t[3],n=null==a?void 0:a.find(function(t,e){return s.api.getProperty("Xaxes."+o+".Format.MultiAxis."+e+".Field")===i}),t={Rotation:0,Prefix:"",Suffix:"",FontSize:12,Precision:2,Field:t[3]};r.push(n||t)}),s.api.setProperty("Xaxes."+o+".Format.MultiAxis",r))):(s.setIgnoreSettings(!0),s.api.setProperty("Xaxes."+o+".Format.MultiAxis",[]),s.setIgnoreSettings(!1))})},Z.prototype.setPatterns=function(){var o=this,r=0,a=0,s=0,l=this.api.getProperty(Z.PROP_PATTERNS);this.layers.forEach(function(t){var e,i=t.getLayerType(),n=o.api.getProperty("Layers."+t.index+"."+H.PROP_ICON);i===G.Bar?(e={},l&&t.getAllCols().forEach(function(t){e[t]=M.Tools.Patterns[a%M.Tools.Patterns.length],r++,a++}),t.setPatterns(e),t.setPatternIndex(s),t.updateRenderState(),s=r):i===G.Bubble&&n&&(t.setPatternIndex(s),s=++r)})},Z.prototype.unsetPatterns=function(){var e=this;this.layers.forEach(function(t){t.getLayerType()===G.Bar&&(t.unsetPatterns(e.gl),t.updateRenderState())})},Z.prototype.setRange=function(t,e,i,n,o,r){var a=o?new Y(this.activeZoom.x,this.activeZoom.z):new Y(this.activeZoom.y,this.activeZoom.w),n=n?n.applyFn(X.convertJSToNumber):a,a=X.calculateCroppedJs2(n,e,i),n=r[1];n&&n.length&&(i=(e=function(t,i){return t.reduce(function(t,e){return Math.abs(e-i)<Math.abs(t-i)?e:t})})(n,a.x),e=e(n,a.y),i=n.indexOf(i),n=n.indexOf(e),e=r[0],a=new Y(e[i],e[n])),this.setIgnoreSettings(!0),o?this.axis.x[t].setRangeViewstate(a,"Xaxes",t):this.axis.y[t].setRangeViewstate(a,"Yaxes",t),this.setIgnoreSettings(!1)},Z.prototype.updateBars=function(e){var t=this.layers.filter(function(t){return t.isBar()&&t.isEnabled()&&t.getAxisId("x")===e});return t.forEach(function(t){return t.updateRenderState()}),!!t.length},Z.prototype.updateLayerPossibleAxes=function(){var n=this,o=(this.setIgnoreSettings(!0),this.api.getProperty(Z.PROP_XAXES)),r=this.api.getProperty(Z.PROP_YAXES),a=o.map(function(t,e){return"X-Axis "+(e+1)}),s=r.map(function(t,e){return"Y-Axis "+(e+1)});_.each(this.layers,function(t,e){var i=n.api.getProperty("Layers."+e+".possibleXAxes"),e=n.api.getProperty("Layers."+e+".possibleYAxes");i.length!==o.length&&t.updateAxisId(a,"x"),e.length!==r.length&&t.updateAxisId(s,"y")}),this.api.getProperty(tt.PROP_OVERRIDE_RULES).length&&(this.overrideRules.setPossibleAxes(a,s),this.overrideRules.setPossibleLayers(this.layers)),this.setIgnoreSettings(!1)},Z.prototype.updateViewBounds=function(s,l,t,h){var p=this,u="x"===s,c=u?this.xAxisViewBounds:this.yAxisViewBounds,d=u?this.xAxisDataBounds:this.yAxisDataBounds,y=-1;return t.map(function(t,e){var i=t[0],n=(null==(n=p.pannedAxis)?void 0:n.axis)===s&&(null==(n=p.pannedAxis)?void 0:n.index)===e,t=t[1],n=h||n||l,t=0===t.x&&1===t.y,o=void 0!==(null==(o=c[e])?void 0:o.x)?null==(o=c[e])?void 0:o.x:i.x,r=void 0!==(null==(r=c[e])?void 0:r.y)?null==(r=c[e])?void 0:r.y:i.y;(n||t)&&(o=i.x);"Smart"===p.api.getProperty(s.toUpperCase()+"axes."+e+".Format.Distribution")&&(y++,a=null!=(t=u?p.xAxisBreakInfo:p.yAxisBreakInfo)&&t.max?null==t?void 0:t.max[y]:null);var a,t=_.max(p.getLayerDataTypes(u?"x":"y",e)),t=a?X.convertToJsScalar(t,a):null,t=i.y>=(t||(null==(a=d[e])?void 0:a.y));return(n||t)&&(r=i.y),new Y(o,r)})},Z.prototype.updateZoomValues=function(t,e,i,n){var o,r=n?"x":"y",a=this.layers.filter(function(t){return t.getAxisId(n?"x":"y")===e})[0].getAllCategoryData(n?"x":"y"),s=_.max(this.getLayerDataTypes(n?"x":"y",e,!0)),l=(null==(l=this.pannedAxis)?void 0:l.index)===e&&(null==(l=this.pannedAxis)?void 0:l.axis)===r,r=this.axis.getSelectionZoomBounds(t,n?"Xaxes":"Yaxes",e,s,a),h=0!==r.x&&1!==r.y;n?(this.selZoom&&h&&(this.xAxisZoom[e]=X.calculateCrop(r,t,s)),(this.onXZoom||l)&&(o=this.api.getProperty("Xaxes."+e+W.PROP_RESET_NULL),(!this.resetZoom||o)&&this.resetZoom||this.setRange(e,t,i,this.xAxisZoom[e],n,a))):(this.selZoom&&h&&(this.yAxisZoom[e]=X.calculateCrop(r,t,s)),(this.onYZoom||l)&&(o=this.api.getProperty("Yaxes."+e+W.PROP_RESET_NULL),(!this.resetZoom||o)&&this.resetZoom||this.setRange(e,t,i,this.yAxisZoom[e],n,a)))},Z.prototype.processSmartAxes=function(t,r,l,h){var p=this,u=[],c=[],d=[],t=(t.forEach(function(t,e){var i,n,a,o,s=[];"Smart"===p.api.getProperty(("x"===r?Z.PROP_XAXES:Z.PROP_YAXES)+"."+e+W.PROP_DISTRIBUTION)&&(n=(o=(i=l.filter(function(t){return t.getAxisId(r)===e&&t.isEnabled()&&t.getLayerType()!==G.Baseline})).map(function(t){return[t.getTriggerData(r),t.getTriggerIntervals(r)]})).map(function(t){return t[0]}),a=o.map(function(t){return t[1]}),o=Array.prototype.concat.apply([],n),(o="y"===r?Array.prototype.concat.apply([],o):o).length&&(c.push(Math.min.apply(Math,o)),d.push(Math.max.apply(Math,o))),a.forEach(function(t,i){null!=t&&t.forEach(function(e){var n=e[0],o=e[1],r=!0,t=(a.filter(function(t,e){return e!==i}).forEach(function(t,e){t.forEach(function(t,e){var i=t[0],t=t[1];i<n&&o<t&&(r=!1)})}),s.filter(function(t){return _.isEqual(t,e)}));r&&!t.length&&s.push(e)})}),i.forEach(function(t){t.updateRenderState(),p.processLayerData(t,h,s,r)})),u.push(s)}),{breakIntervals:u,min:c,max:d});"x"===r?this.xAxisBreakInfo=t:this.yAxisBreakInfo=t},Z.prototype.validate=function(){var l=this;if(this.api.getProperty("Layers").length){var s,h,p,u,c,i,d,e=this.layers.filter(function(t){return t.isEnabled()}),n=e.filter(function(t){return t.Config}),o=(this.api.getProperty(Z.PROP_TRACK_LOAD_TIME)&&!this.performanceTrack&&this.renderState<=z.Process&&null!=(o=e.map(function(t){return t.getPerformanceTrack()}).filter(function(t){return t}))&&o.length&&(this.performanceTrack=Math.min.apply(Math,o)),this.renderState<z.Legend&&this.layers.filter(function(t){return!t.isEnabled()}).length&&!n.length&&(this.renderState=z.Legend),_.some(e,function(t){return t.RenderState===z.Data})),r=e.map(function(t){return t.datasourceError}).filter(function(t){return!!t});if(o&&_.isEmpty(r)){if(e.filter(function(t){return"virtual"===t.getDataSource().attributes._dataType}).length)return this.api.showQueryStatus({error:"ChartGL does not support virtual queries",type:"Warning"}),this.showQueryStatus=!0,void(this.renderState=z.Process);this.isLoading||this.api.showQueryStatus({error:"",type:"Loading"}),this.isLoading=!0,this.showQueryStatus=!0}else{if(this.layers.every(function(t){return t.isEnabled()&&t.hasNoResults()}))return this.api.showQueryStatus({error:"",type:"NoResults"}),this.showQueryStatus=!0,void(this.renderState=z.Valid);r.length&&r[0]?(this.api.showQueryStatus({error:t(r[0].error),type:"Error"}),this.showQueryStatus=!0,this.renderState=z.Valid):this.showQueryStatus&&(this.api.hideQueryStatus(),this.showQueryStatus=!1),this.isLoading=!1}this.calculateLayerAxisMaps(),this.renderState<=z.Process&&n.length&&(s=this.getGroupedBars(),this.barGroupingInfo=s,0<this.layers.length&&this.layers.some(function(t){return t.getDataSource()})&&this.showQueryStatus&&this.api.hideErrorMessage(),o=this.layers.map(function(t){return t.isHorizontal()?t.getDataRangeY():t.getDataRangeX()}),e=this.layers.map(function(t){return t.isHorizontal()?t.getDataRangeX():t.getDataRangeY()}),N=this.api.getProperty("Xaxes"),k=this.api.getProperty("Yaxes"),w=n.filter(function(t){return t.hasData()}),this.xAxisDataBounds=this.createDataBounds(N,o,this.xAxisLayer,!0),this.yAxisDataBounds=this.createDataBounds(k,e,this.yAxisLayer,!1),this.activeXPan=N.map(function(t,e){return l.activeXPan[e]||new Y(0,1)}),this.activeYPan=k.map(function(t,e){return l.activeYPan[e]||new Y(0,1)}),this.api.getProperty(Z.PROP_PATTERNS)&&this.setPatterns(),P=this.api.getProperty(tt.PROP_HIERARCHICAL_RULES),O=this.api.getProperty(Z.PROP_INHERIT_RULES),x=this.api.getProperty(tt.PROP_OVERRIDE_RULES),O&&null!=P&&P.length&&(x=P.concat(x)),r=this.layers.filter(function(t){return t.hasOverrideRules()}).length,(x.length||!x.length&&r)&&(this.setIgnoreSettings(!0),this.overrideRules.setPossibleDataCols(this.layers),this.setIgnoreSettings(!1),r=x.filter(function(t){return t.RuleType===j.Column||""===t.RuleType}),this.overrideRules.updateOverrideRulesColors(r,this.layers),r=x.filter(function(t){return t.RuleType===j.Layer}),this.overrideRules.updateOverrideRulesColorPalettes(r,this.layers)),r=this.layers.filter(function(t){return t.hasFixedWidth()||t.isCandlestick()}),(this.onXZoom||this.onYZoom||this.selZoom)&&!this.resetZoom||_.each(r,function(t){return t.onResize()}),h=_.some(this.layers.filter(function(t){return t.isEnabled()}),function(t){return!t.Config}),r=this.api.getProperty(Z.PROP_YAXES),p=r.map(function(t,e){return l.layers.filter(function(t){return t.isEnabled()&&t.isBar()&&t.getAxisId("y")===e}).map(function(t){return t.index})}),c={},w.forEach(function(t,e){var i,n,o,r,a=t.isBar()&&!h&&s;a&&(i=s.allBarLayers.indexOf(t),n=s.layersCommonXAxis[i].indexOf(t),o=t.getAxisId("y"),l.api.getProperty(Z.PROP_YAXES+"."+o+".Stacked")&&void 0!==(o=p[o])[o.indexOf(t.index)-1]&&(o=l.layers[t.index-1].getStackedXData(),r=l.layers[t.index-1].getStackedYData(),o)&&r&&(r=r[r.length-1],c=X.getStackedData(o,r,c)),u={barIndices:s.barIndices[i],dataLength:s.dataLengths[i],index:n,stacked:c}),!a&&t.isBar()||l.processLayerData(t,u)}),i=function(t,e){return"Time"===l.api.getProperty(t+"."+e+W.PROP_TYPE)&&"Smart"===l.api.getProperty(t+"."+e+W.PROP_DISTRIBUTION)},v=(B=this.api.getProperty(Z.PROP_XAXES)).filter(function(t,e){return i(Z.PROP_XAXES,e)}),I=r.filter(function(t,e){return i(Z.PROP_YAXES,e)}),v.length&&this.processSmartAxes(B,"x",w,u),I.length&&this.processSmartAxes(r,"y",w,u),r.some(function(t,e){return!0===l.api.getProperty("Yaxes."+e+".Stacked")})&&(this.layers.some(function(t){return t.isHorizontal()&&t.getAxisStacked("y")})?(v=this.createDataBounds(N,o,this.xAxisLayer,!0,!0),this.xAxisDataBounds=v):(I=this.createDataBounds(k,e,this.yAxisLayer,!1,!0),this.yAxisDataBounds=I)),d=!0,w.forEach(function(t){var e,i,n,o,r,a=t.getFillType(),s=-1!==a.indexOf("Layer");t.RenderState===z.Process&&(s||"Origin"===a)&&(e=o=null,n=i=void 0,s&&(e=Number(a.replace(/.*?(\d+)$/,"$1")||1)-1,i=l.api.getProperty("Layers."+e+"."+H.PROP_INTERPOLATION),n=l.api.getProperty("Layers."+e+"."+H.PROP_STEPPED),s=l.api.getProperty("Layers."+t.index+"."+H.PROP_INTERPOLATION),r=l.api.getProperty("Layers."+t.index+"."+H.PROP_STEPPED),s={interpolation:s===et.Linear?et.Linear:i,steppedLine:s===et.Linear?r:n},(o=l.layers[e].getFillToLayerData(s)).length||(d=!1)),r={fill:a,cols:o,toBounds:null!==e?X.calculateCroppedJsBounds(l.activeZoom,l.getLayerDataBounds(e),l.getLayerDataType("x",e),l.getLayerDataType("y",e)):void 0,fromBounds:X.calculateCroppedJsBounds(l.activeZoom,l.getLayerDataBounds(t.index),l.getLayerDataType("x",t.index),l.getLayerDataType("y",t.index)),interpolation:i,steppedLine:n},d)&&t.processLineFillData(l.gl,r)}),!n.filter(function(t){return t.RenderState>=z.Process}).length&&n.length||(r=this.initialChartLoaded&&(this.onXZoom||this.onYZoom||this.resetZoom||this.selZoom),this.renderState=r?z.Axis:z.Legend),!_.some(n,function(t){return!1===t.hasData()})&&d||(this.renderState=z.Process)),this.renderState===z.Legend&&(this.legend.render(),this.axis.onResize(),this.renderState=z.Axis);var a,y,g,f=[],m=[];if(this.renderState===z.Axis&&(this.updateLayerPossibleAxes(),o=!1,v=0,this.zoomEnabled&&(this.lastXZoom.length||this.lastYZoom.length)&&(e=Date.now()-this.zoomTime,I=this.api.getProperty(Z.PROP_DURATION),v=(0,xe[this.api.getProperty(Z.PROP_EASING)])(e/I),this.animateZoom=!!(o=e<I)),r=this.layers.map(function(t){return l.calculatePaddedRange(t)}),e=this.api.getProperty("Xaxes"),I=this.createViewBounds(r,o,v,!0,e),this.xAxisViewBounds=this.updateViewBounds("x",this.onXZoom,I,o),f=I.map(function(t){return t[1]}),e=this.api.getProperty("Yaxes"),I=this.createViewBounds(r,o,v,!1,e),this.yAxisViewBounds=this.updateViewBounds("y",this.onYZoom,I,o),m=I.map(function(t){return t[1]}),a=function(t,e,i,n){var o=l.layers.filter(function(t){return t.getAxisId(e)===i}).map(function(t){return t.getTriggerBounds(e)}).filter(function(t){return t}),o=X.mergeRange(o)||new Y(0,1),n=X.calculateCrop(n,o),o="x"===e?l.xAxisBreakInfo:l.yAxisBreakInfo;o&&t.updateBreakIntervals(o.breakIntervals[i],o.min[i],o.max[i],n)},this.setIgnoreSettings(!0),_.values(this.axis.x).forEach(function(t,e){var i=l.getLayerDataTypes("x",e,!0),n=(l.api.getProperty("Xaxes."+e+".Type")===W.TYPE_CATEGORY&&(n=l.layers.filter(function(t){return t.getAxisId("x")===e}).map(function(t){return t.getAllCategoryData("x")[0]}),l.axis.updateCategoryData("x",e,t,n)),l.xAxisViewBounds[e]||new Y(0,1));t.isTriggerBreakApplied()&&a(t,"x",e,n),t.updateBounds(n,i)}),_.values(this.axis.y).forEach(function(t,e){var i=l.getLayerDataTypes("y",e,!0),n=(l.api.getProperty("Yaxes."+e+".Type")===W.TYPE_CATEGORY&&(n=l.layers.filter(function(t){return t.getAxisId("y")===e}).map(function(t){return t.getAllCategoryData("y")[0]}),l.axis.updateCategoryData("y",e,t,n)),l.yAxisViewBounds[e]||new Y(0,1));t.isTriggerBreakApplied()&&a(t,"y",e,n),t.updateBounds(n,i)}),this.setIgnoreSettings(!1),_.first(n.map(function(t){return t.Config}).filter(function(t){return!!t}))&&(y={},this.layers.forEach(function(t,e){var i=t.getCurrentTickVals();null!=i&&i.length&&(t=t.getAxisId("y"),y[t]||(y[t]=[]),y[t].push(i))}),r=(B=this.api.getProperty(Z.PROP_XAXES)).map(function(t,e){var i=l.layers.filter(function(t){return t.getAxisId("x")===e}),n=[];return i.forEach(function(t){t.getAxisGroupColsData().forEach(function(t){return n.push(t)})}),n}),this.axis.updateMultiAxis(B,r),this.setMultiAxisSettings(r),v=this.xAxisDataBoundsNoRange.map(function(t,e){var i=X.calcCrop(l.xAxisViewBounds[e].x,t.x,t.y),e=X.calcCrop(l.xAxisViewBounds[e].y,t.x,t.y);return new Y(i,e)}),P=this.api.getProperty(tt.PROP_HIERARCHICAL_RULES),O=this.api.getProperty(Z.PROP_INHERIT_RULES),x=this.api.getProperty(tt.PROP_OVERRIDE_RULES),(x=O&&null!=P&&P.length?P.concat(x):x).length?(e=x.filter(function(t){return t.RuleType===j.Axis}),this.overrideRules.updateOverrideRulesAxis(e,this.layers)):!x.length&&this.axis.hasOverrideRules()&&this.axis.resetOverrideRules(),o=this.axis.render(this.size.x,this.size.y,this.api.getProperty("Xaxes"),this.api.getProperty("Yaxes"),y,r,v),_.isEqual(o,this.renderedMargin)&&this.size===this.renderedSize||(I=this.canvas.style.left,this.useSingleContext&&""!==I&&this.clearWebGLViewport(this.gl),B=Math.max(this.size.x-o.x-o.z,0),O=Math.max(this.size.y-o.y-o.w,0),this.overlay.resize(o.x,o.y,B,O),this.resizeLabelsCanvas(o.x,o.y,B,O),this.canvas.style.left=o.x+"px",this.canvas.style.top=o.y+"px",this.canvas.width=B,this.canvas.height=O,this.annotationsView.resize(o.x,o.y,B,O),this.renderedMargin=_.clone(o),this.renderedSize=this.size),P=f[0]||new Y(0,1),this.crosshairSelected.updateSelected(P,this.animateZoom||this.onXZoom,this.canvas),e=this.api.getProperty(Z.PROP_RANGE_SELECT),this.zoomEnabled?this.overlay.clearRangeLines(!0,e):e?this.overlay.drawRangeLines():this.overlay.clearRangeLines(!1,!1)),this.onXZoom=!1,this.onYZoom=!1,this.selZoom=!1,this.renderState=z.Uniforms),this.renderState===z.Uniforms&&_.every(n.filter(function(t){return t.hasData()}),function(t){return t.RenderState>=z.Uniforms})&&(Ft.clearColor(this.gl,this.theme),g=this.gl,this.useSingleContext?Ft.clearWebGLViewport(g,this.overlay,this.theme,this.el,this.webGLContextAndCanvas):(g.clear(g.COLOR_BUFFER_BIT),g.viewport(0,0,g.canvas.width,g.canvas.height)),g.enable(g.BLEND),g.blendFunc(g.SRC_ALPHA,g.ONE_MINUS_SRC_ALPHA),this.layers.forEach(function(t){return t.removeLabels()}),_.filter(n,function(t){return t&&t.RenderState===z.Uniforms}).forEach(function(t){var e,i,n,o,r;t.hasData()&&(e=0,l.api.getProperty("Layers."+t.index+"."+H.PROP_SCALE_ZOOM)&&l.zoomEnabled&&(n=l.animateZoom?f:l.lastXZoom,i=l.animateZoom?m:l.lastYZoom,n=n[l.layerXAxis[t.index]]||new Y(0,1),i=i[l.layerYAxis[t.index]]||new Y(0,1),e=((n=V.fromVec2(n,i)).z-n.x+(n.w-n.y))/2),i=l.api.getProperty(t.indexProp(H.PROP_TYPE))===G.Line,n="No Fill"!==l.api.getProperty(t.indexProp(H.PROP_FILL)),o=l.getLayerViewBounds(t.index),r=void 0,t.getLayerType()===G.Baseline&&(r={x:l.getLayerDataType("x",t.index),y:l.getLayerDataType("y",t.index)}),i&&n&&t.render(g,o,e,U.Fill),t.render(g,o,e,U.Default,r),i&&l.api.getProperty(t.indexProp(H.PROP_RADIUS_SCALE))&&t.render(g,o,e,U.Bubble),t.hasDataLabels())&&t.drawLabels(o,l.getLayerDataType("x",t.index),l.getLayerDataType("y",t.index),l.barGroupingInfo)}),this.annotationsView.updateZoom(this.xAxisDataBounds,this.xAxisViewBounds,this.yAxisDataBounds,this.yAxisViewBounds),this.renderState=this.panning||this.zoomEnabled&&this.animateZoom?z.Axis:z.Loaded),this.renderState===z.Loaded&&(this.api.getProperty(Z.PROP_TRACK_LOAD_TIME)&&this.performanceTrack&&(x=Date.now()-this.performanceTrack,this.layers.filter(function(t){return t.isEnabled()}).every(function(t){return t.RenderState>=z.Uniforms}))&&(this.setIgnoreSettings(!0),this.api.setProperty(Z.PROP_LOAD_TIME,x),this.setIgnoreSettings(!1),this.layers.forEach(function(t){return t.updatePerformanceTracker(!0)}),this.performanceTrack=null),r=this.api.getProperty(Z.PROP_SELECT_FIRST_POINT),!1===this.initialChartLoaded&&r?this.api.getPropertyMeta(Z.PROP_SELECT).viewstateType&&this.layers[0]&&(B=(I=null==(v=this.layers[0].Config)?void 0:v.xCol).getRange&&I.calcRange,I)&&(F=void 0,F=B?(O=X.getRange(I),X.convertToJsScalar(I.qtype,O[0],!0)):X.getColValue(I,0),M.Tools.isKDBTemporal(F)&&(F=M.Tools.convertKDBTemporalToMoment(F).toDashString()),this.setIgnoreSettings(!0),this.api.setProperty(Z.PROP_SELECT,F),this.setIgnoreSettings(!1),o=this.calculateViewStateOverPoint(B?F:0))&&(this.crosshairSelected.render(this.renderedMargin,o,"click",this.dashboardViewModel.get(Z.APP_THEME),this.canvas),this.initialChartLoaded=!0):!1!==this.initialChartLoaded||r||(this.initialChartLoaded=!0),this.renderState=z.Tooltip),this.renderState===z.Tooltip){if(this.zoomTime=0,this.resetZoom=!1,this.activeBounds=this.layers.map(function(t){return l.getLayerViewBounds(t.index)}),!this.activeBounds.length)return;var P=this.api.getProperty(Z.PROP_HOVER),e=this.api.getProperty(Z.PROP_SELECT),x=void 0,v=(null===this.overPoint&&(P||e)&&(F=this.settingsSelected?e:this.settingsHovered?P:"")&&(x=this.calculateViewStateOverPoint(F)),this.api.getProperty(Z.PROP_COORDS)),O=this.overlay.isDragging(),T=this.overPoint||x;if(!T||O&&!v)return this.renderState=z.Valid,void(P||(this.tooltips.hideTooltip(),this.tooltips.hideCoordinates(this.el),this.crosshairHover.hideCrosshair(""),this.hover=!1));var R,b=[],C=[],L=((w=n.filter(function(t){return t.hasData()})).forEach(function(n){var t=n.getLayerType(),o=t===G.Bounds,e=t===G.Heatmap;if(n.getLayerType()===G.Baseline){var t=l.getBaselineOverPoint(n),t=new St(n,0,t,"",0,"Value");b.push(t),l.api.getProperty("Overlay.ShowAllPoints")&&C.push(t)}else for(var i=o||e?2:1,r=0;r<i;r++){var a="XAxis",a=(o?a=0===r?"x1":"x2":e&&(a=0===r?"HeatmapX1":"HeatmapX2"),l.getClosestPoint(T,n,a,n.getBoundsCol(a)));a&&b.push(a)}l.api.getProperty("Overlay.ShowAllPoints")&&(t=n.getAllPointsFromRelativeX(),_.each(t,function(t){_.each(t,function(t){if(t)for(var e=o?2:1,i=0;i<e;i++)C.push(new St(n,t[0],t[1],t[2],t[3],o?0===i?"x1":"x2":"XAxis"))})}))}),null),A=null,E=null,S=T.x,D=1+T.y;if(_.each(b,function(t){var e,i,n,o=Number(t.overpoint.x),r=Number(t.overpoint.y);null===A?(A=Math.abs(S-o),E=Math.abs(D-r),L=t):(o=Math.abs(S-o))<A?(A=o,E=Math.abs(D-r),L=t):o===A&&E&&((i=(e=Math.abs(D-r))<E)&&(R=t),n=t.layer.getAxisId("y"),!(i=l.api.getProperty("Yaxes."+n+".Stacked")&&t.layer.getLayerType()===G.Bar&&(L&&!i&&L.overpoint.y<D&&(i=!0),r<D)?!1:i)&&e!==E||(E=e,A=o,L=t))}),L){var I=L.layer.getAxisId("y"),B=this.api.getProperty("Yaxes."+I+".Stacked"),o=(L=L.layer.getLayerType()===G.Bar&&B&&R&&L.overpoint.y<D?R:L).overpoint;if(1<o.x||o.x<0||1<o.y||o.y<0||isNaN(o.x)||isNaN(o.y))return void(this.renderState=z.Valid);this.closestPoint!==L.overpoint&&(this.closestPoint=L.overpoint);r=this.tooltips.render(this.canvas,L,C.length?C:b,b),e=this.tooltips.returnPointInfo();if(e&&r){var w,x=L.layer.getLayerType(),P=x===G.Bounds?H.PROP_X1_COORD:x===G.Heatmap?H.PROP_HEATMAP_X1:H.PROP_XAXIS,N=L.layer.getAxisData(P),k=L.yAxis,F=r[N],n=r[k];if(v&&(L.layer.getLayerType()===G.Baseline&&("x"===(null==(w=L.layer.getBaselineInfo())?void 0:w.axis)?(F=w.jsVal,n=this.getLayerViewBounds(L.layer.index).w):(n=w.jsVal,F=this.getLayerViewBounds(L.layer.index).z)),this.drawCoordinates(L,O,F,n)),O)return this.crosshairHover.hideCrosshair(""),this.tooltips.hideTooltip(),void(this.renderState=z.Valid);this.hover||!this.click&&!this.settingsSelected?(this.doActions(L.layer,e,"mousemove"),I=!this.api.getProperty(Z.PROP_SNAP)&&this.overPoint?new Y(this.overPoint.x,1+this.overPoint.y):L.overpoint,this.crosshairHover.render(this.renderedMargin,I,"hover",this.dashboardViewModel.get(Z.APP_THEME),this.canvas),this.overPoint&&this.api.getPropertyMeta(Z.PROP_HOVER).viewstateType&&(M.Tools.isKDBTemporal(F)&&(F=M.Tools.convertKDBTemporalToMoment(F).toDashString()),this.api.setProperty(Z.PROP_HOVER,F))):(this.doActions(L.layer,e,"click"),this.crosshairSelected.render(this.renderedMargin,L.overpoint,"click",this.dashboardViewModel.get(Z.APP_THEME),this.canvas),this.click&&this.api.getPropertyMeta(Z.PROP_SELECT).viewstateType&&(M.Tools.isKDBTemporal(F)&&(F=M.Tools.convertKDBTemporalToMoment(F).toDashString()),this.api.setProperty(Z.PROP_SELECT,F)))}}else this.tooltips.hideTooltip();this.hover=!1,this.click=!1,this.settingsHovered=!1,this.settingsSelected=!1,this.renderState=z.Valid}this.renderState<z.Valid&&window.requestAnimationFrame(this.validate.bind(this))}else this.api.showErrorMessage({error:t("To get started, please add a layer from")+" <b> "+t("Properties-Layers")+" </b> ",type:"Warning"}),this.legend.render()},Z.getComponentDefinition=b.getComponentDefinition,Z.PROP_FOCUS="Basics.Focus",Z.PROP_XAXES="Xaxes",Z.PROP_YAXES="Yaxes",Z.PROP_PATTERNS="Basics.UsePatterns",Z.PROP_COORDS="Overlay.ShowCoordinates",Z.PROP_CROSSHAIRS="Overlay.ShowCrosshairs",Z.PROP_DURATION="Basics.Duration",Z.PROP_HOVER="Basics.Hover",Z.PROP_INHERIT_RULES="Basics.UseHierarchicalRules",Z.PROP_SELECT="Basics.Selected",Z.PROP_SELECT_FIRST_POINT="Basics.SelectFirstPoint",Z.PROP_EASING="Basics.Easing",Z.PROP_TRACK_LOAD_TIME="Basics.TrackLoadTime",Z.PROP_LOAD_TIME="Basics.LoadTime",Z.PROP_LAYERS="Layers",Z.PROP_LAYER_ID="_Id",Z.PROP_LAYER_NAME="Name",Z.PROP_LEGEND_GROUPS="Legend.LegendGroups",Z.PROP_POSSIBLELEGENDGROUPS="possibleLegendGroups",Z.PROP_LEGEND_POS="Legend.Position",Z.PROP_USE_CUSTOM_LEGEND="Legend.UseCustomLegend",Z.PROP_CUSTOM_LEGEND="Legend.CustomLegend",Z.PROP_POSSIBLEPOSITIONS="possiblePositions",Z.PROP_SNAP="Overlay.SnapToPoint",Z.APP_THEME="DashboardTheme",Z.PROP_EXPORT="FileExport",Z.PROP_ANNOTATE_CONTROL="Annotations.ShowAnnotateControl",Z.PROP_ANNOTATIONS="Annotations.Annotations",Z.PROP_RANGE_SELECT="Basics.RangeSelection",Z.PROP_ZOOM="Basics.Zoom",Z.REST_MS=500;var Te=Z;function Z(t){var e=this,t=(this.ignoreSettingsChange=!1,this.layers=[],this.isLoading=!1,this.xAxisLayer={},this.yAxisLayer={},this.layerXAxis={},this.layerYAxis={},this.xAxisDataBoundsNoRange=[],this.xAxisDataBounds=[],this.yAxisDataBounds=[],this.xAxisViewBounds=[],this.yAxisViewBounds=[],this.activeZoom=new V(0,0,1,1),this.animateZoom=!1,this.selZoom=!1,this.lastXZoom=[],this.lastYZoom=[],this.xAxisZoom=[],this.yAxisZoom=[],this.onXZoom=!1,this.onYZoom=!1,this.pannedAxis=null,this.rangeSelectorEnabled=!1,this.zoomTime=0,this.resetZoom=!1,this.zoomedXDataBounds=[],this.zoomedYDataBounds=[],this.zoomEnabled=!0,this.click=!1,this.closestPoint=new Y(0,1),this.hover=!1,this.overPoint=null,this.settingsSelected=!1,this.settingsHovered=!1,this.activeXPan=[],this.activeYPan=[],this.panning=!1,this.activeBounds=[],this.expressTime=Date.now()-Z.REST_MS,this.globalPalette=[],this.initialChartLoaded=!1,this.performanceTrack=Date.now(),this.renderedMargin=new V(0,0,0,0),this.renderedSize=new Y(1,1),this.renderState=z.Valid,this.showQueryStatus=!0,this.size=new Y(1,1),this.theme="",this.useSingleContext=!1,this.options=t,this.api=t.api,this.el=t.el,this.el.className+=" ChartGL",this.uid=_.uniqueId("ChartGL"),this.el.innerHTML=F.app({uid:this.uid}),this.tooltips=new Dt(this.api,this.formatData.bind(this)),this.dashboardViewModel=t.dashboardViewModel,this.debouncedResizeStop=_.debounce(function(){e.onResize()},50),this.legend=new zt(this.el,this.api,this.tooltips,this.invalidate.bind(this),this.setIgnoreSettings.bind(this),this.updateWildcardLayers.bind(this),this.getFileExporterWidth.bind(this),this.getAnnotateWidth.bind(this)),this.axis=new Zt(this.api,this.el.getElementsByClassName("axis")[0],this.legend),this.globalPalette=t.dashboardAppModel.get("globalPalettes"),this.api.setProperty("possiblePalettes",_.map(_.uniqBy(this.globalPalette,"rule"),"rule")),this.overrideRules=new tt(this.options,this.api,this.axis,this.theme,this.globalPalette,this.onSettingsChange.bind(this)),this.pan=new Vt(this.api,this.axis,this.onPan.bind(this)),this.canvas=this.el.getElementsByTagName("canvas")[1],this.image=document.createElement("img"),this.image.style.opacity="0",this.crosshairHover=new Bt(this.el,this.api),this.crosshairSelected=new Bt(this.el,this.api),this.overlay=new qt(this.el.getElementsByClassName("overlay")[0],this.onOverlayOver.bind(this),this.onOverlayZoom.bind(this),this.onOverlayReset.bind(this),this.onOverlayClick.bind(this)),X.isWebGLHWAcclEnabled||M.Log.Warn("ChartGL: Hardware Acceleration not enabled"),t.webGLContextAndCanvas);if(t){var i=t.gl,n=t.canvas,t=t.elements;this.updateWebGLContext(i,n,t),this.useSingleContext=!0}else if(this.gl=Ft.setUpWebGLContext(this.canvas),!this.gl)return;this.annotationsCanvas=this.el.getElementsByClassName("annotations")[0],this.setTheme(this.dashboardViewModel.get(Z.APP_THEME)),this.onResize(),this.initializeEventListeners(),this.fileExporterView=new ae({api:this.api,el:this.el.getElementsByClassName("export-div")[0],layers:this.layers,onResize:this.onResize.bind(this),theme:this.theme,dashboardViewModel:this.dashboardViewModel}),this.annotationsView=new Pe({api:this.api,el:this.el.getElementsByClassName("draw-div")[0],canvas:this.annotationsCanvas,canvas2d:this.el.getElementsByClassName("annotations2d")[0],getOverlay:function(){return e.overlay},onResize:this.onResize.bind(this)})}return Te});