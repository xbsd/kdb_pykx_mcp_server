define(["backbone","Handlebars","QuickBase","css!./css/main.css"],function(A,t,l){"use strict";var o,I=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}))(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),D=(e.app=t.template({compiler:[8,">= 4.3.0"],main:function(t,e,i,o,n){var a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="configure-widgets">\n    <a class="show-configure-menu ui-widget ui-state-active" title="Component Layout">\n        <i class="fa fa-cog"></i> <i class="fa fa-caret-down"></i>\n    </a>\n    <ul class="configure-widgets-menu ui-widget ui-widget-content"></ul>\n</div>\n<div class="webgl-panel-wrapper"></div>\n<div class="worksheet" data-cy="views-worksheet">\n    <div class="grid-stack"><div class="grid-stack-overlay"></div></div>\n    <div class="worksheet-highlight-item"></div>\n    <div class="row-highlight-item"></div>\n    <div class="highlight-viewport">\n        <div class="highlight-layer">\n            <div class="highlight-item"></div>\n        </div>\n    </div>\n    <div class="no-widgets-info">\n        <div class="loading">'+t.escapeExpression((a(i,"t")||e&&a(e,"t")||t.hooks.helperMissing).call(null!=e?e:t.nullContext||{},"start dragging widgets from the panel on your left",{name:"t",hash:{},data:n,loc:{start:{line:18,column:29},end:{line:18,column:87}}}))+'</div>\n\n        <div class="dragComponentsHelp">\n            <i class="fa fa-chevron-right"></i>\n            <i class="fa fa-chevron-right"></i>\n            <i class="fa fa-chevron-right"></i>\n        </div>\n    </div>\n</div>\n'},useData:!0}),e.configureWidgetsMenu=t.template({1:function(t,e,i,o,n){var a,s=null!=e?e:t.nullContext||{},r=t.hooks.helperMissing,d="function",h=t.escapeExpression,t=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <li data-widgetid="'+h(typeof(a=null!=(a=t(i,"id")||(null!=e?t(e,"id"):e))?a:r)==d?a.call(s,{name:"id",hash:{},data:n,loc:{start:{line:3,column:23},end:{line:3,column:29}}}):a)+'"><i class="fa fa-plus-circle"></i> '+h(typeof(a=null!=(a=t(i,"name")||(null!=e?t(e,"name"):e))?a:r)==d?a.call(s,{name:"name",hash:{},data:n,loc:{start:{line:3,column:65},end:{line:3,column:73}}}):a)+"</li>\n"},compiler:[8,">= 4.3.0"],main:function(t,e,i,o,n){var a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<li class="ui-widget-header">Available Components</li>\n'+(null!=(i=a(i,"each").call(null!=e?e:t.nullContext||{},null!=e?a(e,"widgets"):e,{name:"each",hash:{},fn:t.program(1,n,0),inverse:t.noop,data:n,loc:{start:{line:2,column:0},end:{line:4,column:9}}}))?i:"")+'<li>-</li>\n<li data-actionid="reset">Reset Layout</li>'},useData:!0}),e);function e(){}a.getComponentDefinition=function(t){var e={id:50,componentName:"panel",componentDescription:"group multiple components together with a panel",appKey:"Panel",disable_array_reorder:!0,appArgs:{json:{version:"v2.11.0",Basics:{ComponentName:"panel",Name:"",RelativeHeight:!0,Advanced:!1,UserLayout:!1,Floatable:!0,EnableWebGLContext:!1,ColCount:36,RowHeight:25,RowCount:24,ExpandWidgets:"None",Repeatable:!1,RepeatableViewstate:""},Style:{advanced:""}},schema:{type:"object",title:"Properties",_transform:function(t,e,i,o){var n="Basics.RepeatableViewstate";i===n&&(i=_.get(t,n+".attributes._type"))&&"list"!==i&&alert("Please select a list type viewstate"),_.set(e,"properties.Basics.properties.RowCount.options.hidden",!_.get(t,"Basics.RelativeHeight")),_.set(e,"properties.Basics.properties.RowHeight.options.hidden",!!_.get(t,"Basics.RelativeHeight")),o(void 0,e)},properties:{Basics:{type:"object",title:"Basics",options:{disable_array_reorder:!0},properties:{ComponentName:{type:"string",title:"hide me",options:{hidden:!0}},Name:{type:"string",title:"Name",default:""},RelativeHeight:{type:"boolean",title:"Fill Height",default:!0,format:"checkbox"},Advanced:{type:"boolean",title:"Advanced Layout",default:!1,format:"checkbox"},UserLayout:{type:"boolean",title:"User Layout",default:!1,format:"checkbox"},Floatable:{type:"boolean",title:"Floatable",default:!0,format:"checkbox"},EnableWebGLContext:{type:"boolean",title:"Enable WebGL Context",default:!1,format:"checkbox"},ColCount:{title:"Column Count",type:"number",minimum:1,default:36},RowHeight:{title:"Row Height",type:"number",default:25,options:{hidden:!0}},RowCount:{title:"Row Count",type:"number",minimum:1,default:24},ExpandWidgets:{title:"Expand Widgets",type:"string",default:"None",enum:["None","Fill Dashboard","Fill Panel"]},Repeatable:{type:"boolean",title:"Repeatable",default:!1,format:"checkbox",tooltip:"If toggled on, the panel repeats based on Repeatable Viewstate. Child components cannot be edited while repeatable is enabled."},RepeatableViewstate:{title:"Repeatable Viewstate",type:"string",default:"",tooltip:"Set the repeatable Viewstate. Must be of type list"}}},Style:{type:"object",title:"Style",options:{collapsed:!0},properties:{advanced:{type:"css",title:"Advanced CSS",default:""}}}}}}};if(0<_.keys(t.settingsModel.attributes).length)for(var i=_.find(a.upgrades,{version:t.settingsModel.get("version")}),o=void 0===i?1:a.upgrades.indexOf(i)+1;o<a.upgrades.length;o+=1){var n=a.upgrades[o];n.fn(t.settingsModel),t.settingsModel.set("version",n.version)}return e},a.upgrades=[{version:"4.0.0d15",fn:function(t){t.set("Basics.RelativeHeight",!1),t.set("Basics.Advanced",!1),t.set("Style.advanced","")}},{version:"4.0.1",fn:function(t){t.set("Basics.UserLayout",!1)}},{version:"4.4.0",fn:function(t){t.set("Basics.ColCount",12),t.set("Basics.Floatable",!1),t.set("Basics.RowHeight",t.get("Basics.RelativeHeight")?void 0:25),t.set("Basics.RowCount",void 0)}},{version:"4.7.7",fn:function(t){t.get("Basics.Name")||t.set("Basics.Name","")}},{version:"4.7.8",fn:function(t){t.get("Basics.EnableWebGLContext")||t.set("Basics.EnableWebGLContext",!1)}},{version:"v2.2.5",fn:function(t){t.get("Basics.ExpandWidgets")||t.set("Basics.ExpandWidgets","None")}},{version:"v2.11.0",fn:function(t){_.isNil(t.get("Basics.Repeatable"))&&t.set("Basics.Repeatable",!1),_.isNil(t.get("Basics.RepeatableViewstate"))&&t.set("Basics.RepeatableViewstate","")}}];t=a;function a(){}i.prototype.add=function(t){this.styleMapUsage[t]=this.styleMapUsage[t]||0,0===this.styleMapUsage[t]&&(this.styleMap[t]=this._createStyle(t)),this.styleMapUsage[t]++},i.prototype._createStyle=function(t){var e,i=[],o=100/t,n=".grid-stack.grid-stack-".concat(t,">.grid-stack-item");i.push("".concat(n,"{min-width:").concat(+o.toFixed(5),"%}"));for(var a=1;a<=t;a++)e=+(o*a).toFixed(5),i.push("".concat(n,"[data-gs-width='").concat(a,"']{width:").concat(e,"%}")),i.push("".concat(n,"[data-gs-x='").concat(a,"']{left:").concat(e,"%}"));var s=document.createElement("style");return s.setAttribute("type","text/css"),s.innerHTML=i.join(""),document.head.appendChild(s),s},i.prototype.remove=function(t){var e;this.styleMapUsage[t]--,0===this.styleMapUsage[t]&&(e=this.styleMap[t])&&(e.parentNode.removeChild(e),this.styleMap[t]=null)};var P=i;function i(){this.styleMap={},this.styleMapUsage={}}y=document.createElement("canvas"),s={canvas:!!(v=y.getContext("2d")),imageData:!!v.getImageData,dataURL:!!y.toDataURL,btoa:!!window.btoa},r="image/octet-stream";var s,r,Y,K,j,L,n,B,O,d,z,m,X,U={saveAsImage:g,saveAsPNG:function(t,e,i){return g(t,e,i,"png")},saveAsJPEG:function(t,e,i){return g(t,e,i,"jpeg")},saveAsGIF:function(t,e,i){return g(t,e,i,"gif")},saveAsBMP:function(t,e,i){return g(t,e,i,"bmp")},convertToImage:c,convertToPNG:function(t,e,i){return c(t,e,i,"png")},convertToJPEG:function(t,e,i){return c(t,e,i,"jpeg")},convertToGIF:function(t,e,i){return c(t,e,i,"gif")},convertToBMP:function(t,e,i){return c(t,e,i,"bmp")}};function h(t,e,i){var o=t.width,n=t.height,a=(null==e&&(e=o),null==i&&(i=n),document.createElement("canvas")),s=a.getContext("2d");return a.width=e,a.height=i,s.drawImage(t,0,0,o,n,0,0,e,i),a}function G(t,e,i,o){return(t=h(t,i,o)).toDataURL(e)}function V(t){document.location.href=t}function F(t){var e=document.createElement("img");return e.src=t,e}function q(t){return"image/"+(t=t.toLowerCase().replace(/jpg/i,"jpeg")).match(/png|jpeg|bmp|gif/)[0]}function Q(t){if(!window.btoa)throw"btoa undefined";var e="";if("string"==typeof t)e=t;else for(var i=0;i<t.length;i++)e+=String.fromCharCode(t[i]);return btoa(e)}function J(t){var e=t.width,i=t.height;return t.getContext("2d").getImageData(0,0,e,i)}function Z(t,e){return"data:"+e+";base64,"+t}function tt(t){var e=t.width,i=t.height,o=[66,77,255&(o=54+(n=e*i*3)),o>>8&255,o>>16&255,o>>24&255,0,0,0,0,54,0,0,0],n=[40,0,0,0,255&e,e>>8&255,e>>16&255,e>>24&255,255&i,i>>8&255,i>>16&255,i>>24&255,1,0,24,0,0,0,0,0,255&n,n>>8&255,n>>16&255,n>>24&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],a=(4-3*e%4)%4,s=t.data,r="",d=e<<2,h=i,l=String.fromCharCode;do{for(var g=d*(h-1),c="",p=0;p<e;p++){var u=p<<2;c+=l(s[g+u+2])+l(s[g+u+1])+l(s[g+u])}for(var m=0;m<a;m++)c+=String.fromCharCode(0)}while(r+=c,--h);return Q(o.concat(n))+Q(r)}function g(t,e,i,o){var n;s.canvas&&s.dataURL&&("string"==typeof t&&(t=document.getElementById(t)),o=q(o=null==o?"png":o),/bmp/.test(o)?(n=J(h(t,e,i)),V(Z(tt(n),r))):V(G(t,o,e,i).replace(o,r)))}function c(t,e,i,o){var n;if(s.canvas&&s.dataURL)return"string"==typeof t&&(t=document.getElementById(t)),o=q(o=null==o?"png":o),/bmp/.test(o)?(n=J(h(t,e,i)),F(Z(tt(n),"image/bmp"))):F(G(t,o,e,i))}function et(t,e,i){var o,n=t.runtimeStyle&&t.runtimeStyle[e],a=t.style;return!/^-?[0-9]+\.?[0-9]*(?:px)?$/i.test(i)&&/^-?\d/.test(i)&&(o=a.left,n&&(t.runtimeStyle.left=t.currentStyle.left),a.left="fontSize"===e?"1em":i||0,i=a.pixelLeft+"px",a.left=o,n)&&(t.runtimeStyle.left=n),/^(thin|medium|thick)$/i.test(i)?i:Math.round(parseFloat(i))+"px"}function it(t){return parseInt(t,10)}function ot(t,e,i,o,n,a){var s,r,d,e=X.Util.getCSS(e,t,n);return 1===e.length&&(n=e[0],(e=[])[0]=n,e[1]=n),-1!==e[0].toString().indexOf("%")?(s=parseFloat(e[0])/100,r=i.width*s,"backgroundSize"!==t&&(r-=(a||o).width*s)):"backgroundSize"===t?"auto"===e[0]?r=o.width:/contain|cover/.test(e[0])?(r=(n=X.Util.resizeBounds(o.width,o.height,i.width,i.height,e[0])).width,d=n.height):r=parseInt(e[0],10):r=parseInt(e[0],10),"auto"===e[1]?d=r/o.width*o.height:-1!==e[1].toString().indexOf("%")?(s=parseFloat(e[1])/100,d=i.height*s,"backgroundSize"!==t&&(d-=(a||o).height*s)):d=parseInt(e[1],10),[r,d]}function p(t){return function(e){try{t.addColorStop(e.stop,e.color)}catch(t){z.log(["failed to add color stop: ",t,"; tried to add: ",e])}}}Y=window,K=document,(X={Util:{}}).Util.log=function(t){X.logging&&Y.console&&Y.console.log&&Y.console.log(t)},X.Util.trimText=(n=String.prototype.trim,function(t){return n?n.apply(t):((t||"")+"").replace(/^\s+|\s+$/g,"")}),X.Util.asFloat=function(t){return parseFloat(t)},B=/((rgba|rgb)\([^\)]+\)(\s-?\d+px){0,})/g,O=/(-?\d+px)|(#.+)|(rgb\(.+\))|(rgba\(.+\))/g,X.Util.parseTextShadows=function(t){if(!t||"none"===t)return[];for(var e=t.match(B),i=[],o=0;e&&o<e.length;o++){var n=e[o].match(O);i.push({color:n[0],offsetX:n[1]?n[1].replace("px",""):0,offsetY:n[2]?n[2].replace("px",""):0,blur:n[3]?n[3].replace("px",""):0})}return i},X.Util.parseBackgroundImage=function(t){function e(){i&&((o='"'===o.substr(0,1)?o.substr(1,o.length-2):o)&&h.push(o),"-"===i.substr(0,1)&&0<(a=i.indexOf("-",1)+1)&&(n=i.substr(0,a),i=i.substr(a)),l.push({prefix:n,method:i.toLowerCase(),value:s,args:h})),h=[],i=n=o=s=""}var i,o,n,a,s,r,d,h,l=[],g=0,c=0;e();for(var p=0,u=t.length;p<u;p++)if(r=t[p],!(0===g&&-1<" \r\n\t".indexOf(r))){switch(r){case'"':d?d===r&&(d=null):d=r;break;case"(":if(!d){if(0===g){g=1,s+=r;continue}c++}break;case")":if(!d&&1===g){if(0===c){g=0,s+=r,e();continue}c--}break;case",":if(!d){if(0===g){e();continue}if(1===g&&0===c&&!i.match(/^url$/i)){h.push(o),o="",s+=r;continue}}}s+=r,0===g?i+=r:o+=r}return e(),l},X.Util.Bounds=function(t){var e,i={};return t.getBoundingClientRect&&(e=t.getBoundingClientRect(),i.top=e.top,i.bottom=e.bottom||e.top+e.height,i.left=e.left,i.width=t.offsetWidth,i.height=t.offsetHeight),i},X.Util.OffsetBounds=function(t){var e=t.offsetParent?X.Util.OffsetBounds(t.offsetParent):{top:0,left:0};return{top:t.offsetTop+e.top,bottom:t.offsetTop+t.offsetHeight+e.top,left:t.offsetLeft+e.left,width:t.offsetWidth,height:t.offsetHeight}},X.Util.getCSS=function(t,e,i){var o=(L=void 0!==t?K.defaultView.getComputedStyle(t,null):L)[e];if(/^background(Size|Position)$/.test(e)){var n=o,a=e;if(n=(n=(n||"").split(","))[i||0]||n[0]||"auto",n=X.Util.trimText(n).split(" "),"backgroundSize"!==a||n[0]&&!n[0].match(/cover|contain|auto/)){if(n[0]=-1===n[0].indexOf("%")?et(t,a+"X",n[0]):n[0],n[1]===j){if("backgroundSize"===a)return n[1]="auto",n;n[1]=n[0]}n[1]=-1===n[1].indexOf("%")?et(t,a+"Y",n[1]):n[1]}return n}return/border(Top|Bottom)(Left|Right)Radius/.test(e)?((i=o.split(" ")).length<=1&&(i[1]=i[0]),i.map(it)):o},X.Util.resizeBounds=function(t,e,i,o,n){var a,s,t=t/e;return n&&"auto"!==n?i/o<t^"contain"===n?a=(s=o)*t:s=(a=i)/t:(a=i,s=o),{width:a,height:s}},X.Util.BackgroundPosition=function(t,e,i,o,n){t=ot("backgroundPosition",t,e,i,o,n);return{left:t[0],top:t[1]}},X.Util.BackgroundSize=function(t,e,i,o){t=ot("backgroundSize",t,e,i,o);return{width:t[0],height:t[1]}},X.Util.Extend=function(t,e){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},X.Util.Children=function(t){var e;try{e=t.nodeName&&"IFRAME"===t.nodeName.toUpperCase()?t.contentDocument||t.contentWindow.document:function(t){var e=[];if(null!==t){var i=e,o=t,n=i.length,a=0;if("number"==typeof o.length)for(var s=o.length;a<s;a++)i[n++]=o[a];else for(;o[a]!==j;)i[n++]=o[a++];i.length=n}return e}(t.childNodes)}catch(t){X.Util.log("html2canvas.Util.Children failed with exception: "+t.message),e=[]}return e},X.Util.isTransparent=function(t){return"transparent"===t||"rgba(0, 0, 0, 0)"===t},X.Util.Font=(d={},function(t,e,i){var o,n,a,s,r;return d[t+"-"+e]!==j?d[t+"-"+e]:(o=i.createElement("div"),n=i.createElement("img"),s=i.createElement("span"),r="Hidden Text",o.style.visibility="hidden",o.style.fontFamily=t,o.style.fontSize=e,o.style.margin=0,o.style.padding=0,i.body.appendChild(o),n.src="data:image/gif;base64,R0lGODlhAQABAIABAP///wAAACwAAAAAAQABAAACAkQBADs=",n.width=1,n.height=1,n.style.margin=0,n.style.padding=0,n.style.verticalAlign="baseline",s.style.fontFamily=t,s.style.fontSize=e,s.style.margin=0,s.style.padding=0,s.appendChild(i.createTextNode(r)),o.appendChild(s),o.appendChild(n),a=n.offsetTop-s.offsetTop+1,o.removeChild(s),o.appendChild(i.createTextNode(r)),o.style.lineHeight="normal",n.style.verticalAlign="super",s=n.offsetTop-o.offsetTop+1,d[t+"-"+e]=r={baseline:a,lineWidth:1,middle:s},i.body.removeChild(o),r)}),z=X.Util,m=[/^(-webkit-linear-gradient)\(([a-z\s]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-o-linear-gradient)\(([a-z\s]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-webkit-gradient)\((linear|radial),\s((?:\d{1,3}%?)\s(?:\d{1,3}%?),\s(?:\d{1,3}%?)\s(?:\d{1,3}%?))([\w\d\.\s,%\(\)\-]+)\)$/,/^(-moz-linear-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?))([\w\d\.\s,%\(\)]+)\)$/,/^(-webkit-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s([a-z\-]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-moz-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s?([a-z\-]*)([\w\d\.\s,%\(\)]+)\)$/,/^(-o-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s([a-z\-]+)([\w\d\.\s,%\(\)]+)\)$/],(X.Generate=v={}).parseGradient=function(t,e){for(var i,o,n,a,s,r,d,h,l,g,c,p=m.length,u=0;u<p&&!(o=t.match(m[u]));u+=1);if(o)switch(o[1]){case"-webkit-linear-gradient":case"-o-linear-gradient":if(i={type:"linear",x0:null,y0:null,x1:null,y1:null,colorStops:[]},a=o[2].match(/\w+/g))for(s=a.length,u=0;u<s;u+=1)switch(a[u]){case"top":i.y0=0,i.y1=e.height;break;case"right":i.x0=e.width,i.x1=0;break;case"bottom":i.y0=e.height,i.y1=0;break;case"left":i.x0=0,i.x1=e.width}if(null===i.x0&&null===i.x1&&(i.x0=i.x1=e.width/2),null===i.y0&&null===i.y1&&(i.y0=i.y1=e.height/2),a=o[3].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}(?:%|px))?)+/g))for(s=a.length,r=1/Math.max(s-1,1),u=0;u<s;u+=1)(d=a[u].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%|px)?/))[2]?(n=parseFloat(d[2]),"%"===d[3]?n/=100:n/=e.width):n=u*r,i.colorStops.push({color:d[1],stop:n});break;case"-webkit-gradient":if(i={type:"radial"===o[2]?"circle":o[2],x0:0,y0:0,x1:0,y1:0,colorStops:[]},(a=o[3].match(/(\d{1,3})%?\s(\d{1,3})%?,\s(\d{1,3})%?\s(\d{1,3})%?/))&&(i.x0=a[1]*e.width/100,i.y0=a[2]*e.height/100,i.x1=a[3]*e.width/100,i.y1=a[4]*e.height/100),a=o[4].match(/((?:from|to|color-stop)\((?:[0-9\.]+,\s)?(?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)\))+/g))for(s=a.length,u=0;u<s;u+=1)d=a[u].match(/(from|to|color-stop)\(([0-9\.]+)?(?:,\s)?((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\)/),n=parseFloat(d[2]),"from"===d[1]&&(n=0),"to"===d[1]&&(n=1),i.colorStops.push({color:d[3],stop:n});break;case"-moz-linear-gradient":if(i={type:"linear",x0:0,y0:0,x1:0,y1:0,colorStops:[]},(a=o[2].match(/(\d{1,3})%?\s(\d{1,3})%?/))&&(i.x0=a[1]*e.width/100,i.y0=a[2]*e.height/100,i.x1=e.width-i.x0,i.y1=e.height-i.y0),a=o[3].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}%)?)+/g))for(s=a.length,r=1/Math.max(s-1,1),u=0;u<s;u+=1)(d=a[u].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%)?/))[2]?(n=parseFloat(d[2]),d[3]&&(n/=100)):n=u*r,i.colorStops.push({color:d[1],stop:n});break;case"-webkit-radial-gradient":case"-moz-radial-gradient":case"-o-radial-gradient":if(i={type:"circle",x0:0,y0:0,x1:e.width,y1:e.height,cx:0,cy:0,rx:0,ry:0,colorStops:[]},(a=o[2].match(/(\d{1,3})%?\s(\d{1,3})%?/))&&(i.cx=a[1]*e.width/100,i.cy=a[2]*e.height/100),a=o[3].match(/\w+/),d=o[4].match(/[a-z\-]*/),a&&d)switch(d[0]){case"farthest-corner":case"cover":case"":h=Math.sqrt(Math.pow(i.cx,2)+Math.pow(i.cy,2)),l=Math.sqrt(Math.pow(i.cx,2)+Math.pow(i.y1-i.cy,2)),g=Math.sqrt(Math.pow(i.x1-i.cx,2)+Math.pow(i.y1-i.cy,2)),c=Math.sqrt(Math.pow(i.x1-i.cx,2)+Math.pow(i.cy,2)),i.rx=i.ry=Math.max(h,l,g,c);break;case"closest-corner":h=Math.sqrt(Math.pow(i.cx,2)+Math.pow(i.cy,2)),l=Math.sqrt(Math.pow(i.cx,2)+Math.pow(i.y1-i.cy,2)),g=Math.sqrt(Math.pow(i.x1-i.cx,2)+Math.pow(i.y1-i.cy,2)),c=Math.sqrt(Math.pow(i.x1-i.cx,2)+Math.pow(i.cy,2)),i.rx=i.ry=Math.min(h,l,g,c);break;case"farthest-side":"circle"===a[0]?i.rx=i.ry=Math.max(i.cx,i.cy,i.x1-i.cx,i.y1-i.cy):(i.type=a[0],i.rx=Math.max(i.cx,i.x1-i.cx),i.ry=Math.max(i.cy,i.y1-i.cy));break;case"closest-side":case"contain":"circle"===a[0]?i.rx=i.ry=Math.min(i.cx,i.cy,i.x1-i.cx,i.y1-i.cy):(i.type=a[0],i.rx=Math.min(i.cx,i.x1-i.cx),i.ry=Math.min(i.cy,i.y1-i.cy))}if(a=o[5].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}(?:%|px))?)+/g))for(s=a.length,r=1/Math.max(s-1,1),u=0;u<s;u+=1)(d=a[u].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%|px)?/))[2]?(n=parseFloat(d[2]),"%"===d[3]?n/=100:n/=e.width):n=u*r,i.colorStops.push({color:d[1],stop:n})}return i},v.Gradient=function(t,e){if(0!==e.width&&0!==e.height){var i,o,n=K.createElement("canvas"),a=n.getContext("2d");if(n.width=e.width,n.height=e.height,i=X.Generate.parseGradient(t,e))switch(i.type){case"linear":o=a.createLinearGradient(i.x0,i.y0,i.x1,i.y1),i.colorStops.forEach(p(o)),a.fillStyle=o,a.fillRect(0,0,e.width,e.height);break;case"circle":o=a.createRadialGradient(i.cx,i.cy,0,i.cx,i.cy,i.rx),i.colorStops.forEach(p(o)),a.fillStyle=o,a.fillRect(0,0,e.width,e.height);break;case"ellipse":var s=K.createElement("canvas"),r=s.getContext("2d"),d=Math.max(i.rx,i.ry),h=2*d;s.width=s.height=h,o=r.createRadialGradient(i.rx,i.ry,0,i.rx,i.ry,d),i.colorStops.forEach(p(o)),r.fillStyle=o,r.fillRect(0,0,h,h),a.fillStyle=i.colorStops[i.colorStops.length-1].color,a.fillRect(0,0,n.width,n.height),a.drawImage(s,i.cx-i.rx,i.cy-i.ry,2*i.rx,2*i.ry)}return n}},v.ListAlpha=function(t){for(var e="";e=String.fromCharCode(64+t%26)+e,26<26*(t/=26););return e},v.ListRoman=function(t){var e,i=["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"],o=[1e3,900,500,400,100,90,50,40,10,9,5,4,1],n="",a=i.length;if(t<=0||4e3<=t)return t;for(e=0;e<a;e+=1)for(;o[e]<=t;)t-=o[e],n+=i[e];return n},X.Parse=function(e,p){Y.scroll(0,0);var t=p.elements===j?K.body:p.elements[0],c=t.ownerDocument,_=X.Util,d=_.Support(p,c),b=new RegExp("("+p.ignoreElements+")"),n=c.body,I=_.getCSS,C="___html2canvas___pseudoelement",i=c.createElement("style");function u(t,e){t=parseInt(I(t,e),10);return isNaN(t)?0:t}function x(t,e,i,o,n,a){"transparent"!==a&&(t.setVariable("fillStyle",a),t.fillRect(e,i,o,n),0)}function T(t,e,i){if(0<t.length)return e+i.toUpperCase()}function m(t,e,i,o){null!==t&&0<_.trimText(t).length&&(o.fillText(t,e,i),0)}function f(t,e,i,o){var n=I(e,"fontWeight"),a=I(e,"fontFamily"),s=I(e,"fontSize"),r=_.parseTextShadows(I(e,"textShadow"));switch(parseInt(n,10)){case 401:n="bold";break;case 400:n="normal"}if(t.setVariable("fillStyle",o),t.setVariable("font",[I(e,"fontStyle"),I(e,"fontVariant"),n,s,a].join(" ")),t.setVariable("textAlign","left"),r.length&&(t.setVariable("shadowColor",r[0].color),t.setVariable("shadowOffsetX",r[0].offsetX),t.setVariable("shadowOffsetY",r[0].offsetY),t.setVariable("shadowBlur",r[0].blur)),"none"!==i)return _.Font(a,s,c)}function A(t,e,i,o,n){var a,s,r;return d.rangeBounds&&!n?("none"===i&&0===_.trimText(e).length||(i=e,a=t.node,s=t.textOffset,(r=c.createRange()).setStart(a,s),r.setEnd(a,s+i.length),a=r.getBoundingClientRect()),t.textOffset+=e.length):t.node&&"string"==typeof t.node.nodeValue&&(s=o?t.node.splitText(e.length):null,i=t.node,r=n,o=i.parentNode,e=c.createElement("wrapper"),n=i.cloneNode(!0),e.appendChild(i.cloneNode(!0)),o.replaceChild(e,i),i=r?_.OffsetBounds(e):_.Bounds(e),o.replaceChild(n,e),a=i,t.node=s),a}function a(t,e,s){var r,d,h=s.ctx,l=I(t,"color"),g=I(t,"textDecoration"),i=I(t,"textAlign"),c={node:e,textOffset:0};0<_.trimText(e.nodeValue).length&&(e.nodeValue=function(t,e){switch(e){case"lowercase":return t.toLowerCase();case"capitalize":return t.replace(/(^|\s|:|-|\(|\))([a-z])/g,T);case"uppercase":return t.toUpperCase();default:return t}}(e.nodeValue,I(t,"textTransform")),i=i.replace(["-webkit-auto"],["auto"]),d=!p.letterRendering&&/^(left|right|justify|auto)$/.test(i)&&/^(normal|none|0px)$/.test(I(t,"letterSpacing"))?e.nodeValue.split(/(\b| )/):e.nodeValue.split(""),r=f(h,t,g,l),p.chinese&&d.forEach(function(t,e){/.*[\u4E00-\u9FA5].*$/.test(t)&&((t=t.split("")).unshift(e,1),d.splice.apply(d,t))}),d.forEach(function(t,e){e=A(c,t,g,e<d.length-1,s.transform.matrix);if(e){m(t,e.left,e.bottom,h);var i=h,o=e,n=r,a=l;switch(g){case"underline":x(i,o.left,Math.round(o.top+n.baseline+n.lineWidth),o.width,1,a);break;case"overline":x(i,o.left,Math.round(o.top),o.width,1,a);break;case"line-through":x(i,o.left,Math.ceil(o.top+n.middle+n.lineWidth),o.width,1,a)}}}))}function $(t,e){var i,o=function(t){var e=-1,i=1,o=t.parentNode.childNodes;if(t.parentNode){for(;o[++e]!==t;)1===o[e].nodeType&&i++;return i}return-1}(t);switch(e){case"decimal":i=o;break;case"decimal-leading-zero":i=1===o.toString().length?o="0"+o.toString():o.toString();break;case"upper-roman":i=X.Generate.ListRoman(o);break;case"lower-roman":i=X.Generate.ListRoman(o).toLowerCase();break;case"lower-alpha":i=X.Generate.ListAlpha(o).toLowerCase();break;case"upper-alpha":i=X.Generate.ListAlpha(o)}return i+". "}function B(t,e,i){var o,n,a,s,e=e.ctx,r=I(t,"listStyleType");/^(decimal|decimal-leading-zero|upper-alpha|upper-latin|upper-roman|lower-alpha|lower-greek|lower-latin|lower-roman)$/i.test(r)&&(r=$(t,r),o=t,n=r,(s=c.createElement("boundelement")).style.display="inline",a=o.style.listStyleType,o.style.listStyleType="none",s.appendChild(c.createTextNode(n)),o.insertBefore(s,o.firstChild),n=_.Bounds(s),o.removeChild(s),o.style.listStyleType=a,s=n,f(e,t,"none",I(t,"color")),"inside"===I(t,"listStylePosition"))&&(e.setVariable("textAlign","left"),m(r,i.left,s.bottom,e))}function k(t){t=e[t];return!(!t||!0!==t.succeeded)&&t.img}function M(t,e){var i=Math.max(t.left,e.left),o=Math.max(t.top,e.top);return{left:i,top:o,width:Math.min(t.left+t.width,e.left+e.width)-i,height:Math.min(t.top+t.height,e.top+e.height)-o}}function W(t,e,i,o,n){var a=u(e,"paddingLeft"),s=u(e,"paddingTop"),r=u(e,"paddingRight"),e=u(e,"paddingBottom");h(t,i,0,0,i.width,i.height,o.left+a+n[3].width,o.top+s+n[0].width,o.width-(n[1].width+n[3].width+a+r),o.height-(n[0].width+n[2].width+s+e))}i.innerHTML="."+C+'-before:before { content: "" !important; display: none !important; }.'+C+'-after:after { content: "" !important; display: none !important; }',n.appendChild(i),e=e||{};s=(Math.sqrt(2)-1)/3*4;var s,D=function(t,e,i,o){var n=i*s,a=o*s,i=t+i,o=e+o;return{topLeft:l({x:t,y:o},{x:t,y:o-a},{x:i-n,y:e},{x:i,y:e}),topRight:l({x:t,y:e},{x:t+n,y:e},{x:i,y:o-a},{x:i,y:o}),bottomRight:l({x:i,y:e},{x:i,y:e+a},{x:t+n,y:o},{x:t,y:o}),bottomLeft:l({x:i,y:o},{x:i-n,y:o},{x:t,y:e+a},{x:t,y:e})}};function l(a,s,r,d){function h(t,e,i){return{x:t.x+(e.x-t.x)*i,y:t.y+(e.y-t.y)*i}}return{start:a,startControl:s,endControl:r,end:d,subdivide:function(t){var e=h(a,s,t),i=h(s,r,t),o=h(r,d,t),n=h(e,i,t),i=h(i,o,t),t=h(n,i,t);return[l(a,e,n,t),l(t,i,o,d)]},curveTo:function(t){t.push(["bezierCurve",s.x,s.y,r.x,r.y,d.x,d.y])},curveToReversed:function(t){t.push(["bezierCurve",r.x,r.y,s.x,s.y,a.x,a.y])}}}function P(t,e,i,o,n,a,s){0<e[0]||0<e[1]?(t.push(["line",o[0].start.x,o[0].start.y]),o[0].curveTo(t),o[1].curveTo(t)):t.push(["line",a,s]),(0<i[0]||0<i[1])&&t.push(["line",n[0].start.x,n[0].start.y])}function L(t,e,i,o,n,a,s){var r=[];return 0<e[0]||0<e[1]?(r.push(["line",o[1].start.x,o[1].start.y]),o[1].curveTo(r)):r.push(["line",t.c1[0],t.c1[1]]),0<i[0]||0<i[1]?(r.push(["line",a[0].start.x,a[0].start.y]),a[0].curveTo(r),r.push(["line",s[0].end.x,s[0].end.y]),s[0].curveToReversed(r)):(r.push(["line",t.c2[0],t.c2[1]]),r.push(["line",t.c3[0],t.c3[1]])),0<e[0]||0<e[1]?(r.push(["line",n[1].end.x,n[1].end.y]),n[1].curveToReversed(r)):r.push(["line",t.c4[0],t.c4[1]]),r}function O(t,e,i){for(var o,n,a,s,r,d,h,l,g,c,p,u,m,f,y,v,w,_,b,C,x,k,M,W=e.left,E=e.top,S=e.width,R=e.height,H=(M=t,["TopLeft","TopRight","BottomRight","BottomLeft"].map(function(t){return I(M,"border"+t+"Radius")})),N=(h=H,l=i,g=(d=e).left,c=d.top,p=d.width,d=d.height,u=h[0][0],m=h[0][1],f=h[1][0],y=h[1][1],v=h[2][0],w=h[2][1],_=h[3][0],h=h[3][1],b=p-f,C=d-w,x=p-v,k=d-h,{topLeftOuter:D(g,c,u,m).topLeft.subdivide(.5),topLeftInner:D(g+l[3].width,c+l[0].width,Math.max(0,u-l[3].width),Math.max(0,m-l[0].width)).topLeft.subdivide(.5),topRightOuter:D(g+b,c,f,y).topRight.subdivide(.5),topRightInner:D(g+Math.min(b,p+l[3].width),c+l[0].width,b>p+l[3].width?0:f-l[3].width,y-l[0].width).topRight.subdivide(.5),bottomRightOuter:D(g+x,c+C,v,w).bottomRight.subdivide(.5),bottomRightInner:D(g+Math.min(x,p+l[3].width),c+Math.min(C,d+l[0].width),Math.max(0,v-l[1].width),Math.max(0,w-l[2].width)).bottomRight.subdivide(.5),bottomLeftOuter:D(g,c+k,_,h).bottomLeft.subdivide(.5),bottomLeftInner:D(g+l[3].width,c+k,Math.max(0,_-l[3].width),Math.max(0,h-l[2].width)).bottomLeft.subdivide(.5)}),T={clip:function(t,e,i,o,n){var a=[];switch(I(t,"backgroundClip")){case"content-box":case"padding-box":P(a,o[0],o[1],e.topLeftInner,e.topRightInner,n.left+i[3].width,n.top+i[0].width),P(a,o[1],o[2],e.topRightInner,e.bottomRightInner,n.left+n.width-i[1].width,n.top+i[0].width),P(a,o[2],o[3],e.bottomRightInner,e.bottomLeftInner,n.left+n.width-i[1].width,n.top+n.height-i[2].width),P(a,o[3],o[0],e.bottomLeftInner,e.topLeftInner,n.left+i[3].width,n.top+n.height-i[2].width);break;default:P(a,o[0],o[1],e.topLeftOuter,e.topRightOuter,n.left,n.top),P(a,o[1],o[2],e.topRightOuter,e.bottomRightOuter,n.left+n.width,n.top),P(a,o[2],o[3],e.bottomRightOuter,e.bottomLeftOuter,n.left+n.width,n.top+n.height),P(a,o[3],o[0],e.bottomLeftOuter,e.topLeftOuter,n.left,n.top+n.height)}return a}(t,N,i,H,e),borders:[]},A=0;A<4;A++)if(0<i[A].width){switch(o=W,n=E,a=S,s=R-i[2].width,A){case 0:s=i[0].width,r=L({c1:[o,n],c2:[o+a,n],c3:[o+a-i[1].width,n+s],c4:[o+i[3].width,n+s]},H[0],H[1],N.topLeftOuter,N.topLeftInner,N.topRightOuter,N.topRightInner);break;case 1:r=L({c1:[(o=W+S-i[1].width)+(a=i[1].width),n],c2:[o+a,n+s+i[2].width],c3:[o,n+s],c4:[o,n+i[0].width]},H[1],H[2],N.topRightOuter,N.topRightInner,N.bottomRightOuter,N.bottomRightInner);break;case 2:r=L({c1:[o+a,(n=n+R-i[2].width)+(s=i[2].width)],c2:[o,n+s],c3:[o+i[3].width,n],c4:[o+a-i[3].width,n]},H[2],H[3],N.bottomRightOuter,N.bottomRightInner,N.bottomLeftOuter,N.bottomLeftInner);break;case 3:a=i[3].width,r=L({c1:[o,n+s+i[2].width],c2:[o,n],c3:[o+a,n+i[0].width],c4:[o+a,n+s]},H[3],H[0],N.bottomLeftOuter,N.bottomLeftInner,N.topLeftOuter,N.topLeftInner)}T.borders.push({args:r,color:i[A].color})}return T}function E(t,e){var i=t.drawShape();e.forEach(function(t,e){i[0===e?"moveTo":t[0]+"To"].apply(null,t.slice(1))})}function S(e,t,i){var o=c.createElement("valuewrap");["lineHeight","textAlign","fontFamily","color","fontSize","paddingLeft","paddingTop","width","height","border","borderLeftWidth","borderTopWidth"].forEach(function(t){try{o.style[t]=I(e,t)}catch(t){_.log("html2canvas: Parse: Exception caught in renderFormValue: "+t.message)}}),o.style.borderColor="black",o.style.borderStyle="solid",o.style.display="block",o.style.position="absolute",!/^(submit|reset|button|text|password)$/.test(e.type)&&"SELECT"!==e.nodeName||(o.style.lineHeight=I(e,"height")),o.style.top=t.top+"px",o.style.left=t.left+"px",t=(t="SELECT"===e.nodeName?(e.options[e.selectedIndex]||0).text:e.value)||e.placeholder,t=c.createTextNode(t),o.appendChild(t),n.appendChild(o),a(e,t,i),n.removeChild(o)}function h(t){t.drawImage.apply(t,Array.prototype.slice.call(arguments,1)),0}function R(t,e){var i,o=Y.getComputedStyle(t,e);if(o&&o.content&&"none"!==o.content&&"-moz-alt-content"!==o.content&&"none"!==o.display)return e="url"===(t=(e=(t=o.content+"").substr(0,1))===t.substr(t.length-1)&&e.match(/'|"/)?t.substr(1,t.length-2):t).substr(0,3),(i=K.createElement(e?"img":"span")).className=C+"-before "+C+"-after",Object.keys(o).filter(z).forEach(function(e){try{i.style[e]=o[e]}catch(t){_.log(["Tried to assign readonly property ",e,"Error:",t])}}),e?i.src=_.parseBackgroundImage(t)[0].args[0]:i.innerHTML=t,i}function z(t){return isNaN(Y.parseInt(t,10))}function g(t,e,i,o){var n=Math.round(o.left+i.left),o=Math.round(o.top+i.top);t.createPattern(e),t.translate(n,o),t.fill(),t.translate(-n,-o)}function r(t,e,i,o,n,a,s,r){var d=[];d.push(["line",Math.round(n),Math.round(a)]),d.push(["line",Math.round(n+s),Math.round(a)]),d.push(["line",Math.round(n+s),Math.round(r+a)]),d.push(["line",Math.round(n),Math.round(r+a)]),E(t,d),t.save(),t.clip(),g(t,e,i,o),t.restore()}function U(t,e,i,o,n){var a=_.BackgroundSize(t,e,o,n),s=_.BackgroundPosition(t,e,o,n,a),t=I(t,"backgroundRepeat").split(",").map(_.trimText);switch(o=function(t,e){if(t.width===e.width&&t.height===e.height)return t;var i=c.createElement("canvas");return i.width=e.width,i.height=e.height,h(i.getContext("2d"),t,0,0,t.width,t.height,0,0,e.width,e.height),i}(o,a),t[n]||t[0]){case"repeat-x":r(i,o,s,e,e.left,e.top+s.top,99999,o.height);break;case"repeat-y":r(i,o,s,e,e.left+s.left,e.top,o.width,99999);break;case"no-repeat":r(i,o,s,e,e.left+s.left,e.top+s.top,o.width,o.height);break;default:g(i,o,s,{top:e.top,left:e.left,width:o.width,height:o.height})}}function G(t){return t.replace("px","")}var o,y,v,V=/(matrix)\((.+)\)/;function F(t,e,i,o){g=e?i.width:Math.max(Math.max(c.body.scrollWidth,c.documentElement.scrollWidth),Math.max(c.body.offsetWidth,c.documentElement.offsetWidth),Math.max(c.body.clientWidth,c.documentElement.clientWidth)),s=e?i.height:Math.max(Math.max(c.body.scrollHeight,c.documentElement.scrollHeight),Math.max(c.body.offsetHeight,c.documentElement.offsetHeight),Math.max(c.body.clientHeight,c.documentElement.clientHeight));var n,a,s,r,d,h,l,g={storage:a=[],width:g,height:s,clip:function(){a.push({type:"function",name:"clip",arguments:arguments})},translate:function(){a.push({type:"function",name:"translate",arguments:arguments})},fill:function(){a.push({type:"function",name:"fill",arguments:arguments})},save:function(){a.push({type:"function",name:"save",arguments:arguments})},restore:function(){a.push({type:"function",name:"restore",arguments:arguments})},fillRect:function(){a.push({type:"function",name:"fillRect",arguments:arguments})},createPattern:function(){a.push({type:"function",name:"createPattern",arguments:arguments})},drawShape:function(){var t=[];return a.push({type:"function",name:"drawShape",arguments:t}),{moveTo:function(){t.push({name:"moveTo",arguments:arguments})},lineTo:function(){t.push({name:"lineTo",arguments:arguments})},arcTo:function(){t.push({name:"arcTo",arguments:arguments})},bezierCurveTo:function(){t.push({name:"bezierCurveTo",arguments:arguments})},quadraticCurveTo:function(){t.push({name:"quadraticCurveTo",arguments:arguments})}}},drawImage:function(){a.push({type:"function",name:"drawImage",arguments:arguments})},fillText:function(){a.push({type:"function",name:"fillText",arguments:arguments})},setVariable:function(t,e){return a.push({type:"variable",name:t,arguments:e}),e}},g={ctx:g,opacity:(s=e,g.setVariable("globalAlpha",I(t,"opacity")*(s?s.opacity:1))),cssPosition:I(t,"position"),borders:(n=t,["Top","Right","Bottom","Left"].map(function(t){return{width:u(n,"border"+t+"Width"),color:I(n,"border"+t+"Color")}})),transform:o,clip:e&&e.clip?_.Extend({},e.clip):null};return s=t,o=e,d="static"!==(e=g).cssPosition,h=d?I(s,"zIndex"):"auto",l=I(s,"opacity"),s="none"!==I(s,"cssFloat"),e.zIndex=r={zindex:h,children:[]},r.isPositioned=d,r.isFloated=s,r.opacity=l,r.ownStacking="auto"!==h||l<1,o&&o.zIndex.children.push(e),!0===p.useOverflow&&!0===/(hidden|scroll|auto)/.test(I(t,"overflow"))&&!1===/(BODY)/i.test(t.nodeName)&&(g.clip=g.clip?M(g.clip,i):i),g}function w(t,e,i,o){r=I(s=t,"transform")||I(s,"-webkit-transform")||I(s,"-moz-transform")||I(s,"-ms-transform")||I(s,"-o-transform");var n,a,s,r={origin:(I(s,"transform-origin")||I(s,"-webkit-transform-origin")||I(s,"-moz-transform-origin")||I(s,"-ms-transform-origin")||I(s,"-o-transform-origin")||"0px 0px").split(" ").map(G).map(_.asFloat),matrix:a=r&&"none"!==r&&(s=r.match(V))&&"matrix"===s[1]?s[2].split(",").map(_.trimText).map(_.asFloat):a},d=(s=t,s=(a=r).matrix?_.OffsetBounds(s):_.Bounds(s),a.origin[0]+=s.left,a.origin[1]+=s.top,s),h=F(t,e,d,r),l=h.borders,g=h.ctx,c=(a=d,s=h.clip,a={left:a.left+l[3].width,top:a.top+l[0].width,width:a.width-(l[1].width+l[3].width),height:a.height-(l[0].width+l[2].width)},a=s?M(a,s):a),e=O(t,d,l),r=b.test(t.nodeName)?"#efefef":I(t,"backgroundColor");if(E(g,e.clip),g.save(),g.clip(),0<c.height&&0<c.width&&!o){x(g,d.left,d.top,d.width,d.height,r);for(var p,u=t,m=c,f=g,y=I(u,"backgroundImage"),v=_.parseBackgroundImage(y),w=v.length;w--;)(y=v[w]).args&&0!==y.args.length&&((p=k("url"===y.method?y.args[0]:y.value))?U(u,m,f,p,w):_.log("html2canvas: Error loading background:",y))}else o&&(h.backgroundColor=r);switch(g.restore(),e.borders.forEach(function(t){var e,i;e=g,i=t.args,"transparent"!==(t=t.color)&&(e.setVariable("fillStyle",t),E(e,i),e.fill(),0)}),i||(s=h,o=R(a=t,":before"),r=R(a,":after"),(o||r)&&(o&&(a.className+=" "+C+"-before",a.parentNode.insertBefore(o,a),H(o,s,!0),a.parentNode.removeChild(o),a.className=a.className.replace(C+"-before","").trim()),r)&&(a.className+=" "+C+"-after",a.appendChild(r),H(r,s,!0),a.removeChild(r),a.className=a.className.replace(C+"-after","").trim())),t.nodeName){case"IMG":(n=k(t.getAttribute("src")))?W(g,t,n,d,l):_.log("html2canvas: Error loading <img>:"+t.getAttribute("src"));break;case"INPUT":/^(text|url|email|submit|button|reset)$/.test(t.type)&&0<(t.value||t.placeholder||"").length&&S(t,d,h);break;case"TEXTAREA":0<(t.value||t.placeholder||"").length&&S(t,d,h);break;case"SELECT":0<(t.options||t.placeholder||"").length&&S(t,d,h);break;case"LI":B(t,h,c);break;case"CANVAS":W(g,t,t,d,l)}return h}function H(t,e,i){var o;"none"===I(o=t,"display")||"hidden"===I(o,"visibility")||o.hasAttribute("data-html2canvas-ignore")||(e=w(t,e,i,!1)||e,b.test(t.nodeName))||N(t,e,i)}function N(e,i,o){_.Children(e).forEach(function(t){t.nodeType===t.ELEMENT_NODE?H(t,i,o):t.nodeType===t.TEXT_NODE&&a(e,t,i)})}return o=I(K.documentElement,"backgroundColor"),y=_.isTransparent(o)&&t===K.body,v=w(t,null,!1,y),N(t,v),y&&(o=v.backgroundColor),n.removeChild(i),{backgroundColor:o,stack:v}},X.Preload=function(s){var o,n,t,e,r={numLoaded:0,numFailed:0,numTotal:0,cleanupDone:!1},a=X.Util,d=0,i=s.elements[0]||K.body,h=i.ownerDocument,l=i.getElementsByTagName("img"),g=l.length,c=h.createElement("a"),p=(new Image).crossOrigin!==j;function u(){a.log("html2canvas: start: images: "+r.numLoaded+" / "+r.numTotal+" (failed: "+r.numFailed+")"),!r.firstRun&&r.numLoaded>=r.numTotal&&(a.log("Finished loading images: # "+r.numTotal+" (failed: "+r.numFailed+")"),"function"==typeof s.complete)&&s.complete(r)}function m(t,e,i){var o,n,a=s.proxy;c.href=t,t=c.href,o="html2canvas_"+d++,i.callbackname=o,-1<a.indexOf("?")?a+="&":a+="?",a+="url="+encodeURIComponent(t)+"&callback="+o,n=h.createElement("script"),Y[o]=function(t){"error:"===t.substring(0,6)?(i.succeeded=!1,r.numLoaded++,r.numFailed++,u()):(w(e,i),e.src=t),Y[o]=j;try{delete Y[o]}catch(t){}n.parentNode.removeChild(n),n=null,delete i.script,delete i.callbackname},n.setAttribute("type","text/javascript"),n.setAttribute("src",a),i.script=n,Y.document.body.appendChild(n)}function f(t,e){var e=Y.getComputedStyle(t,e),i=e.content;"url"===i.substr(0,3)&&n.loadImage(X.Util.parseBackgroundImage(i)[0].args[0]),v(e.backgroundImage,t)}function y(t){return t&&t.method&&t.args&&0<t.args.length}function v(t,i){var o;X.Util.parseBackgroundImage(t).filter(y).forEach(function(t){var e;"url"===t.method?n.loadImage(t.args[0]):t.method.match(/\-?gradient$/)&&(o===j&&(o=X.Util.Bounds(i)),t=t.value,e=o,(e=X.Generate.Gradient(t,e))!==j)&&(r[t]={img:e,succeeded:!0},r.numTotal++,r.numLoaded++,u())})}function w(e,i){e.onload=function(){i.timer!==j&&Y.clearTimeout(i.timer),r.numLoaded++,i.succeeded=!0,e.onerror=e.onload=null,u()},e.onerror=function(){var t;if("anonymous"===e.crossOrigin&&(Y.clearTimeout(i.timer),s.proxy))return t=e.src,e=new Image,(i.img=e).src=t,void m(e.src,e,i);r.numLoaded++,r.numFailed++,i.succeeded=!1,e.onerror=e.onload=null,u()}}for(c.href=Y.location.href,o=c.protocol+c.host,n={loadImage:function(t){var e,i;t&&r[t]===j&&(e=new Image,t.match(/data:image\/.*;base64,/i)?(e.src=t.replace(/url\(['"]{0,}|['"]{0,}\)$/gi,""),i=r[t]={img:e},r.numTotal++,w(e,i)):(c.href=t,c.href=c.href,c.protocol+c.host===o||!0===s.allowTaint?(i=r[t]={img:e},r.numTotal++,w(e,i),e.src=t):p&&!s.allowTaint&&s.useCORS?(e.crossOrigin="anonymous",i=r[t]={img:e},r.numTotal++,w(e,i),e.src=t):s.proxy&&(i=r[t]={img:e},r.numTotal++,m(t,e,i))))},cleanupDOM:function(t){var e,i;if(!r.cleanupDone){for(i in t&&"string"==typeof t?a.log("html2canvas: Cleanup because: "+t):a.log("html2canvas: Cleanup after timeout: "+s.timeout+" ms."),r)if(r.hasOwnProperty(i)&&"object"==typeof(e=r[i])&&e.callbackname&&e.succeeded===j){Y[e.callbackname]=j;try{delete Y[e.callbackname]}catch(t){}e.script&&e.script.parentNode&&(e.script.setAttribute("src","about:blank"),e.script.parentNode.removeChild(e.script)),r.numLoaded++,r.numFailed++,a.log("html2canvas: Cleaned up failed img: '"+i+"' Steps: "+r.numLoaded+" / "+r.numTotal)}Y.stop!==j?Y.stop():K.execCommand!==j&&K.execCommand("Stop",!1),K.close!==j&&K.close(),r.cleanupDone=!0,t&&"string"==typeof t||u()}},renderingDone:function(){e&&Y.clearTimeout(e)}},0<s.timeout&&(e=Y.setTimeout(n.cleanupDOM,s.timeout)),a.log("html2canvas: Preload starts: finding background-images"),r.firstRun=!0,!function t(e){var i=!1;try{a.Children(e).forEach(t)}catch(t){}try{i=e.nodeType}catch(t){i=!1,a.log("html2canvas: failed to access some element's nodeType - Exception: "+t.message)}if(1===i||i===j){f(i=e,":before"),f(i,":after");try{v(a.getCSS(e,"backgroundImage"),e)}catch(t){a.log("html2canvas: failed to get background-image - Exception: "+t.message)}v(e)}}(i),a.log("html2canvas: Preload: Finding images"),t=0;t<g;t+=1)n.loadImage(l[t].getAttribute("src"));return r.firstRun=!1,a.log("html2canvas: Preload: Done."),r.numTotal===r.numLoaded&&u(),n},X.Renderer=function(t,i){return function(t){var e;if("string"==typeof i.renderer&&X.Renderer[t]!==j)e=X.Renderer[t](i);else{if("function"!=typeof t)throw new Error("Unknown renderer");e=t(i)}if("function"!=typeof e)throw new Error("Invalid renderer defined");return e}(i.renderer)(t,i,K,(t=t.stack,r=[],function e(t,i,o){var n="auto"===i.zIndex.zindex?0:Number(i.zIndex.zindex),a=t,s=i.zIndex.isPositioned,r=i.zIndex.isFloated,d={node:i},h=o;i.zIndex.ownStacking?(a=d.context={"!":[{node:i,children:[]}]},h=j):(s||r)&&(h=d.children=[]),(0===n&&o?o:(t[n]||(t[n]=[]),t[n])).push(d),i.zIndex.children.forEach(function(t){e(a,t,h)})}(e={},t),function a(s){Object.keys(s).sort().forEach(function(t){var e=[],i=[],o=[],n=[];s[t].forEach(function(t){(t.node.zIndex.isPositioned||t.node.zIndex.opacity<1?o:t.node.zIndex.isFloated?i:e).push(t)}),function e(t){t.forEach(function(t){n.push(t),t.children&&e(t.children)})}(e.concat(i,o)),n.forEach(function(t){t.context?a(t.context):r.push(t.node)})})}(e),r),X);var e,r},X.Util.Support=function(t,o){return{rangeBounds:(n=!1,o.createRange&&(e=o.createRange()).getBoundingClientRect&&((i=o.createElement("boundtest")).style.height="123px",i.style.display="block",o.body.appendChild(i),e.selectNode(i),123===e.getBoundingClientRect().height&&(n=!0),o.body.removeChild(i)),n),svgRendering:t.svgRendering&&function(){var t=new Image,e=o.createElement("canvas"),i=e.getContext!==j&&e.getContext("2d");if(!1===i)return!1;e.width=e.height=10,t.src=["data:image/svg+xml,","<svg xmlns='http://www.w3.org/2000/svg' width='10' height='10'>","<foreignObject width='10' height='10'>","<div xmlns='http://www.w3.org/1999/xhtml' style='width:10;height:10;'>","sup","</div>","</foreignObject>","</svg>"].join("");try{i.drawImage(t,0,0),e.toDataURL()}catch(t){return!1}return X.Util.log("html2canvas: Parse: SVG powered rendering available"),!0}()};var e,i,n},Y.html2canvas=function(t,e){var i,o={logging:!1,elements:t=t.length?t:[t],background:"#fff",proxy:null,timeout:0,useCORS:!1,allowTaint:!1,svgRendering:!1,ignoreElements:"IFRAME|OBJECT|PARAM",useOverflow:!0,letterRendering:!1,chinese:!1,width:null,height:null,taintTest:!0,renderer:"Canvas"},o=X.Util.Extend(e,o);return X.logging=o.logging,o.complete=function(t){"function"==typeof o.onpreloaded&&!1===o.onpreloaded(t)||(i=X.Parse(t,o),"function"==typeof o.onparsed&&!1===o.onparsed(i))||(i=X.Renderer(i,o),"function"==typeof o.onrendered&&o.onrendered(i))},Y.setTimeout(function(){X.Preload(o)},0),{render:function(t,e){return X.Renderer(t,X.Util.Extend(e,o))},parse:function(t,e){return X.Parse(t,X.Util.Extend(e,o))},preload:function(t){return X.Preload(X.Util.Extend(t,o))},log:X.Util.log}},Y.html2canvas.log=X.Util.log,Y.html2canvas.Renderer={Canvas:j},X.Renderer.Canvas=function(n){n=n||{};var a=K,s=[],r=K.createElement("canvas"),d=r.getContext("2d"),h=X.Util,l=n.canvas||a.createElement("canvas");function g(t,e){switch(e.type){case"variable":t[e.name]=e.arguments;break;case"function":switch(e.name){case"createPattern":if(0<e.arguments[0].width&&0<e.arguments[0].height)try{t.fillStyle=t.createPattern(e.arguments[0],"repeat")}catch(t){h.log("html2canvas: Renderer: Error creating pattern",t.message)}break;case"drawShape":i=t,o=e.arguments,i.beginPath(),o.forEach(function(t){i[t.name].apply(i,t.arguments)}),i.closePath();break;case"drawImage":0<e.arguments[8]&&0<e.arguments[7]&&(!n.taintTest||n.taintTest&&function(t){if(-1===s.indexOf(t.arguments[0].src)){d.drawImage(t.arguments[0],0,0);try{d.getImageData(0,0,1,1)}catch(t){return r=a.createElement("canvas"),d=r.getContext("2d"),0}s.push(t.arguments[0].src)}return 1}(e))&&t.drawImage.apply(t,e.arguments);break;default:t[e.name].apply(t,e.arguments)}}var i,o}return function(t,e,i,o,n){var a,s=l.getContext("2d"),r=t.stack;return l.width=l.style.width=e.width||r.ctx.width,l.height=l.style.height=e.height||r.ctx.height,a=s.fillStyle,s.fillStyle=h.isTransparent(r.backgroundColor)&&e.background!==j?e.background:t.backgroundColor,s.fillRect(0,0,l.width,l.height),s.fillStyle=a,o.forEach(function(t){s.textBaseline="bottom",s.save(),t.transform.matrix&&(s.translate(t.transform.origin[0],t.transform.origin[1]),s.transform.apply(s,t.transform.matrix),s.translate(-t.transform.origin[0],-t.transform.origin[1])),t.clip&&(s.beginPath(),s.rect(t.clip.left,t.clip.top,t.clip.width,t.clip.height),s.clip()),t.ctx.storage&&t.ctx.storage.forEach(function(t){g(s,t)}),s.restore()}),h.log("html2canvas: Renderer: Canvas renderer done - returning canvas obj"),1===e.elements.length&&"object"==typeof e.elements[0]&&"BODY"!==e.elements[0].nodeName?(r=n.Util.Bounds(e.elements[0]),(t=i.createElement("canvas")).width=Math.ceil(r.width),t.height=Math.ceil(r.height),(s=t.getContext("2d")).drawImage(l,r.left,r.top,r.width,r.height,0,0,r.width,r.height),l=null,t):l}};var u,f,y,v,w,b,nt,C,x,k,at,M,st={initializeBasePanel:function(){var i=this,o=_.zipObject([N.KEY_ROW_COUNT,N.KEY_ROW_HEIGHT],["rowCount","rowHeight"]),t=(this.api={setProperty:function(t,e){i.documentModel.set(o[t],e)}},{});this.listenTo(this.documentModel,"change:colCount",this.onChange_BasePanel_colCount),this.listenTo(this.documentModel,"change:floatable",this.onChange_BasePanel_floatable),this.listenTo(this.documentModel,"change:relativeHeight",this.onChange_BasePanel_relativeHeight),this.listenTo(this.documentModel,"change:rowHeight",this.onChange_BasePanel_rowHeight),this.listenTo(this.documentModel,"change:rowCount",this.onChange_BasePanel_rowCount),this.listenTo(this.documentModel,"change:worksheetPadding",this.onChange_BasePanel_worksheetPadding),this.setupChangeSet_colCount(t),this.setupChangeSet_floatable(t),this.setupChangeSet_relativeHeight(t),this.setupChangeSet_rowCount(t),this.setupChangeSet_rowHeight(t),this.onSettingsChange(t)},onChange_BasePanel_colCount:function(){this.model.set("colCount",this.documentModel.get("colCount")),this.onSettingsChange(this.setupChangeSet_colCount())},onChange_BasePanel_floatable:function(){this.model.set("floatable",this.documentModel.get("floatable")),this.onSettingsChange(this.setupChangeSet_floatable())},onChange_BasePanel_relativeHeight:function(){this.model.set("relativeHeight",this.documentModel.get("relativeHeight")),this.onSettingsChange(this.setupChangeSet_relativeHeight())},onChange_BasePanel_rowCount:function(){this.model.set("rowCount",this.documentModel.get("rowCount")),this.onSettingsChange(this.setupChangeSet_rowCount())},onChange_BasePanel_rowHeight:function(){this.model.set("rowHeight",this.documentModel.get("rowHeight")),this.onSettingsChange(this.setupChangeSet_rowHeight())},onChange_BasePanel_worksheetPadding:function(){this.set_gridstackMargin(),this.applyGridStackMargin(),this.onResize(!0)},regenerateThumb:function(){var n=this;this.widgets.length<=0?n.model.set("thumb",null):window.html2canvas(this.$gridstack,{onrendered:function(t){var e=$(t).attr("height"),i=$(t).attr("width"),o=e/i;200<=i&&o<=1?e=(i=200)*o:100<=e&&(i=(e=100)/o),n.model.set("thumb",U.convertToPNG(t,i,e).src)}})},set_gridstackMargin:function(){this.gridstackMargin=this.documentModel.get("worksheetPadding"),_.isNumber(this.gridstackMargin)||(this.gridstackMargin=10)},setChangeSetKey:function(t,e,i){return t[e]=this.documentModel.get(i),t},setDocumentModelProperty:function(t,e){this.documentModel.set(t,e),this.updatePropertyInspectorForBasePanel()},setupChangeSet_colCount:function(t){return this.setChangeSetKey(t||{},N.KEY_COLUMN_COUNT,"colCount")},setupChangeSet_floatable:function(t){return this.setChangeSetKey(t||{},N.KEY_FLOATABLE,"floatable")},setupChangeSet_relativeHeight:function(t){return this.setChangeSetKey(t||{},N.KEY_RELATIVE_HEIGHT,"relativeHeight")},setupChangeSet_rowCount:function(t){return this.setChangeSetKey(t||{},N.KEY_ROW_COUNT,"rowCount")},setupChangeSet_rowHeight:function(t){return this.setChangeSetKey(t||{},N.KEY_ROW_HEIGHT,"rowHeight")},updatePropertyInspectorForBasePanel:function(){this.documentModel.trigger("basePanelLayoutChanged")}};function W(t){this.grid=t}function E(t){M.GridStackDragDropPlugin.call(this,t)}u=jQuery,f=_,y=window,w=function(t,e){console.warn("gridstack.js: Option `"+t+"` is deprecated as of v0.2.5 and has been replaced with `"+e+"`. It will be **completely** removed in v1.0.")},(b={isIntercepted:function(t,e){return!(t.x+t.width<=e.x||e.x+e.width<=t.x||t.y+t.height<=e.y||e.y+e.height<=t.y)},sort:function(t,e,i){return i=i||f.chain(t).map(function(t){return t.x+t.width}).max().value(),e=-1!=e?1:-1,f.sortBy(t,[function(t){return e*(t.x+t.y*i)}])},createStylesheet:function(t){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.setAttribute("data-gs-style-id",t),e.styleSheet?e.styleSheet.cssText="":e.appendChild(document.createTextNode("")),document.getElementsByTagName("head")[0].appendChild(e),e.sheet},removeStylesheet:function(t){u("STYLE[data-gs-style-id="+t+"]").remove()},insertCSSRule:function(t,e,i,o){"function"==typeof t.insertRule?t.insertRule(e+"{"+i+"}",o):"function"==typeof t.addRule&&t.addRule(e,i,o)},toBool:function(t){return"boolean"==typeof t?t:"string"==typeof t?!(""===(t=t.toLowerCase())||"no"==t||"false"==t||"0"==t):Boolean(t)},_collisionNodeCheck:function(t){return t!=this.node&&b.isIntercepted(t,this.nn)},_didCollide:function(t){return b.isIntercepted({x:this.n.x,y:this.newY,width:this.n.width,height:this.n.height},t)},_isAddNodeIntercepted:function(t){return b.isIntercepted({x:this.x,y:this.y,width:this.node.width,height:this.node.height},t)},parseHeight:function(t){var e="px";if(t&&f.isString(t)){var i=t.match(/^(-[0-9]+\.[0-9]+|[0-9]*\.[0-9]+|-[0-9]+|[0-9]+)(px|em|rem|vh|vw)?$/);if(!i)throw new Error("Invalid height");e=i[2]||"px",t=parseFloat(i[1])}return{height:t,unit:e}},removePositioningStyles:function(t){t=t[0].style;t.position&&t.removeProperty("position"),t.left&&t.removeProperty("left"),t.top&&t.removeProperty("top"),t.width&&t.removeProperty("width"),t.height&&t.removeProperty("height")},getScrollParent:function(t){t=null==t?null:t.scrollHeight>t.clientHeight?t:b.getScrollParent(t.parentNode);return t},updateScrollPosition:function(t,e,i){var o,n,a,s,r=t.getBoundingClientRect(),d=window.innerHeight||document.documentElement.clientHeight;(r.top<0||r.bottom>d)&&(o=r.bottom-d,n=r.top,null!=(a=b.getScrollParent(t)))&&(s=a.scrollTop,r.top<0&&i<0?t.offsetHeight>d?a.scrollTop+=i:a.scrollTop+=Math.abs(n)>Math.abs(i)?i:n:0<i&&(t.offsetHeight>d?a.scrollTop+=i:a.scrollTop+=i<o?i:o),e.position.top+=a.scrollTop-s)}}).is_intercepted=(v=function(t,e,i){function o(){return console.warn("gridstack.js: Function `"+e+"` is deprecated as of v0.2.5 and has been replaced with `"+i+"`. It will be **completely** removed in v1.0."),t.apply(this,arguments)}return o.prototype=t.prototype,o})(b.isIntercepted,"is_intercepted","isIntercepted"),b.create_stylesheet=v(b.createStylesheet,"create_stylesheet","createStylesheet"),b.remove_stylesheet=v(b.removeStylesheet,"remove_stylesheet","removeStylesheet"),b.insert_css_rule=v(b.insertCSSRule,"insert_css_rule","insertCSSRule"),W.registeredPlugins=[],W.registerPlugin=function(t){W.registeredPlugins.push(t)},W.prototype.resizable=function(t,e){return this},W.prototype.draggable=function(t,e){return this},W.prototype.droppable=function(t,e){return this},W.prototype.isDroppable=function(t){return!1},W.prototype.on=function(t,e,i){return this},nt=0,(C=function(t,e,i,o,n){this.width=t,this.float=i||!1,this.height=o||0,this.nodes=n||[],this.onchange=e||function(){},this._updateCounter=0,this._float=this.float,this._addedNodes=[],this._removedNodes=[]}).prototype.batchUpdate=function(){this._updateCounter=1,this.float=!0},C.prototype.commit=function(){0!==this._updateCounter&&(this._updateCounter=0,this.float=this._float,this._packNodes(),this._notify())},C.prototype.getNodeDataByDOMEl=function(e){return f.find(this.nodes,function(t){return e.get(0)===t.el.get(0)})},C.prototype._fixCollisions=function(t){this._sortNodes(-1);var e=t,i=Boolean(f.find(this.nodes,function(t){return t.locked}));for(this.float||i||(e={x:0,y:t.y,width:this.width,height:t.height});;){var o=f.find(this.nodes,f.bind(b._collisionNodeCheck,{node:t,nn:e}));if(void 0===o)return;this.moveNode(o,o.x,t.y+t.height,o.width,o.height,!0)}},C.prototype.isAreaEmpty=function(t,e,i,o){var n={x:t||0,y:e||0,width:i||1,height:o||1},t=f.find(this.nodes,f.bind(function(t){return b.isIntercepted(t,n)},this));return null==t},C.prototype._sortNodes=function(t){this.nodes=b.sort(this.nodes,t,this.width)},C.prototype._packNodes=function(){this._sortNodes(),this.float?f.each(this.nodes,f.bind(function(t,e){if(!t._updating&&void 0!==t._origY&&t.y!=t._origY)for(var i=t.y;i>=t._origY;)f.chain(this.nodes).take(e).find(f.bind(b._didCollide,{n:t,newY:i})).value()||(t._dirty=!0,t.y=i),--i},this)):f.each(this.nodes,f.bind(function(t,e){if(!t.locked)for(;0<t.y;){var i=t.y-1,o=0===e;if(!(o=0<e?void 0===f.chain(this.nodes).take(e).find(f.bind(b._didCollide,{n:t,newY:i})).value():o))break;t._dirty=t.y!=i,t.y=i}},this))},C.prototype._prepareNode=function(t,e){return(t=f.defaults(t||{},{width:1,height:1,x:0,y:0})).x=parseInt(""+t.x),t.y=parseInt(""+t.y),t.width=parseInt(""+t.width),t.height=parseInt(""+t.height),t.autoPosition=t.autoPosition||!1,t.noResize=t.noResize||!1,t.noMove=t.noMove||!1,t.width>this.width?t.width=this.width:t.width<1&&(t.width=1),t.height<1&&(t.height=1),t.x<0&&(t.x=0),t.x+t.width>this.width&&(e?t.width=this.width-t.x:t.x=this.width-t.width),t.y<0&&(t.y=0),t},C.prototype._notify=function(){var t,e=Array.prototype.slice.call(arguments,0);e[0]=void 0===e[0]?[]:[e[0]],e[1]=void 0===e[1]||e[1],this._updateCounter||(t=e[0].concat(this.getDirtyNodes()),this.onchange(t,e[1]))},C.prototype.cleanNodes=function(){this._updateCounter||f.each(this.nodes,function(t){t._dirty=!1})},C.prototype.getDirtyNodes=function(){return f.filter(this.nodes,function(t){return t._dirty})},C.prototype.addNode=function(t,e){if(void 0!==(t=this._prepareNode(t)).maxWidth&&(t.width=Math.min(t.width,t.maxWidth)),void 0!==t.maxHeight&&(t.height=Math.min(t.height,t.maxHeight)),void 0!==t.minWidth&&(t.width=Math.max(t.width,t.minWidth)),void 0!==t.minHeight&&(t.height=Math.max(t.height,t.minHeight)),t._id=++nt,t._dirty=!0,t.autoPosition){this._sortNodes();for(var i=0;;++i){var o=i%this.width,n=Math.floor(i/this.width);if(!(o+t.width>this.width)&&!f.find(this.nodes,f.bind(b._isAddNodeIntercepted,{x:o,y:n,node:t}))){t.x=o,t.y=n;break}}}return this.nodes.push(t),void 0!==e&&e&&this._addedNodes.push(f.clone(t)),this._fixCollisions(t),this._packNodes(),this._notify(),t},C.prototype.removeNode=function(t,e){e=void 0===e||e,this._removedNodes.push(f.clone(t)),t._id=null,this.nodes=f.without(this.nodes,t),this._packNodes(),this._notify(t,e)},C.prototype.canMoveNode=function(e,t,i,o,n){if(!this.isNodeChangedPosition(e,t,i,o,n))return!1;var a,s=Boolean(f.find(this.nodes,function(t){return t.locked}));if(!this.height&&!s)return!0;var r=new C(this.width,null,this.float,0,f.map(this.nodes,function(t){return t==e?a=u.extend({},t):u.extend({},t)}));if(void 0===a)return!0;r.moveNode(a,t,i,o,n);t=!0;return s&&(t&=!Boolean(f.find(r.nodes,function(t){return t!=a&&Boolean(t.locked)&&Boolean(t._dirty)}))),this.height&&(t&=r.getGridHeight()<=this.height),t},C.prototype.canBePlacedWithRespectToHeight=function(t){var e;return!this.height||((e=new C(this.width,null,this.float,0,f.map(this.nodes,function(t){return u.extend({},t)}))).addNode(t),e.getGridHeight()<=this.height)},C.prototype.isNodeChangedPosition=function(t,e,i,o,n){return"number"!=typeof e&&(e=t.x),"number"!=typeof i&&(i=t.y),"number"!=typeof o&&(o=t.width),"number"!=typeof n&&(n=t.height),void 0!==t.maxWidth&&(o=Math.min(o,t.maxWidth)),void 0!==t.maxHeight&&(n=Math.min(n,t.maxHeight)),void 0!==t.minWidth&&(o=Math.max(o,t.minWidth)),void 0!==t.minHeight&&(n=Math.max(n,t.minHeight)),t.x!=e||t.y!=i||t.width!=o||t.height!=n},C.prototype.moveNode=function(t,e,i,o,n,a){var s;return this.isNodeChangedPosition(t,e,i,o,n)&&("number"!=typeof e&&(e=t.x),"number"!=typeof i&&(i=t.y),"number"!=typeof o&&(o=t.width),"number"!=typeof n&&(n=t.height),void 0!==t.maxWidth&&(o=Math.min(o,t.maxWidth)),void 0!==t.maxHeight&&(n=Math.min(n,t.maxHeight)),void 0!==t.minWidth&&(o=Math.max(o,t.minWidth)),void 0!==t.minHeight&&(n=Math.max(n,t.minHeight)),t.x==e&&t.y==i&&t.width==o&&t.height==n||(s=t.width!=o,t._dirty=!0,t.x=e,t.y=i,t.width=o,t.height=n,t.lastTriedX=e,t.lastTriedY=i,t.lastTriedWidth=o,t.lastTriedHeight=n,t=this._prepareNode(t,s),this._fixCollisions(t),a)||(this._packNodes(),this._notify())),t},C.prototype.getGridHeight=function(){return f.reduce(this.nodes,function(t,e){return Math.max(t,e.y+e.height)},0)},C.prototype.beginUpdate=function(t){f.each(this.nodes,function(t){t._origY=t.y}),t._updating=!0},C.prototype.endUpdate=function(){f.each(this.nodes,function(t){t._origY=t.y});var t=f.find(this.nodes,function(t){return t._updating});t&&(t._updating=!1)},(x=function(t,e){var i,o,n,a,s,r,d=this,t=(e=e||{},this.container=u(t),void 0!==e.handle_class&&(e.handleClass=e.handle_class,w("handle_class","handleClass")),void 0!==e.item_class&&(e.itemClass=e.item_class,w("item_class","itemClass")),void 0!==e.placeholder_class&&(e.placeholderClass=e.placeholder_class,w("placeholder_class","placeholderClass")),void 0!==e.placeholder_text&&(e.placeholderText=e.placeholder_text,w("placeholder_text","placeholderText")),void 0!==e.cell_height&&(e.cellHeight=e.cell_height,w("cell_height","cellHeight")),void 0!==e.vertical_margin&&(e.verticalMargin=e.vertical_margin,w("vertical_margin","verticalMargin")),void 0!==e.min_width&&(e.minWidth=e.min_width,w("min_width","minWidth")),void 0!==e.static_grid&&(e.staticGrid=e.static_grid,w("static_grid","staticGrid")),void 0!==e.is_nested&&(e.isNested=e.is_nested,w("is_nested","isNested")),void 0!==e.always_show_resize_handle&&(e.alwaysShowResizeHandle=e.always_show_resize_handle,w("always_show_resize_handle","alwaysShowResizeHandle")),e.itemClass=e.itemClass||"grid-stack-item",0<this.container.closest("."+e.itemClass).length);this.opts=f.defaults(e||{},{width:parseInt(this.container.attr("data-gs-width"))||12,height:parseInt(this.container.attr("data-gs-height"))||0,itemClass:"grid-stack-item",placeholderClass:"grid-stack-placeholder",placeholderText:"",handle:".grid-stack-item-content",handleClass:null,cellHeight:60,verticalMargin:20,auto:!0,minWidth:768,float:!1,staticGrid:!1,_class:"grid-stack-instance-"+(1e4*Math.random()).toFixed(0),animate:Boolean(this.container.attr("data-gs-animate"))||!1,alwaysShowResizeHandle:e.alwaysShowResizeHandle||!1,resizable:f.defaults(e.resizable||{},{autoHide:!e.alwaysShowResizeHandle,handles:"se"}),draggable:f.defaults(e.draggable||{},{handle:(e.handleClass?"."+e.handleClass:e.handle||"")||".grid-stack-item-content",scroll:!1,appendTo:"body"}),disableDrag:e.disableDrag||!1,disableResize:e.disableResize||!1,rtl:"auto",removable:!1,removableOptions:f.defaults(e.removableOptions||{},{accept:"."+e.itemClass}),removeTimeout:2e3,verticalMarginUnit:"px",cellHeightUnit:"px",disableOneColumnMode:e.disableOneColumnMode||!1,oneColumnModeClass:e.oneColumnModeClass||"grid-stack-one-column-mode",ddPlugin:null}),!1===this.opts.ddPlugin?this.opts.ddPlugin=W:null===this.opts.ddPlugin&&(this.opts.ddPlugin=f.first(W.registeredPlugins)||W),this.dd=new this.opts.ddPlugin(this),"auto"===this.opts.rtl&&(this.opts.rtl="rtl"===this.container.css("direction")),this.opts.rtl&&this.container.addClass("grid-stack-rtl"),this.opts.isNested=t,(o="auto"===this.opts.cellHeight)?d.cellHeight(d.cellWidth(),!0):this.cellHeight(this.opts.cellHeight,!0),this.verticalMargin(this.opts.verticalMargin,!0),this.container.addClass(this.opts._class),this._setStaticClass(),t&&this.container.addClass("grid-stack-nested"),this._initStyles(),this.grid=new C(this.opts.width,function(t,e){e=void 0===e||e;var i=0;f.each(this.nodes,function(t){i=Math.max(i,t.y+t.height)}),f.each(t,function(t){e&&null===t._id?t.el&&t.el.remove():t.el.attr("data-gs-x",t.x).attr("data-gs-y",t.y).attr("data-gs-width",t.width).attr("data-gs-height",t.height)}),d._updateStyles(i+10)},this.opts.float,this.opts.height),this.opts.auto&&(n=[],(a=this).container.children("."+this.opts.itemClass+":not(."+this.opts.placeholderClass+")").each(function(t,e){e=u(e),n.push({el:e,i:parseInt(e.attr("data-gs-x"))+parseInt(e.attr("data-gs-y"))*a.opts.width})}),f.chain(n).sortBy(function(t){return t.i}).each(function(t){d._prepareElement(t.el)}).value()),this.setAnimation(this.opts.animate),this.placeholder=u('<div class="'+this.opts.placeholderClass+" "+this.opts.itemClass+'"><div class="placeholder-content">'+this.opts.placeholderText+"</div></div>").hide(),this._updateContainerHeight(),this._updateHeightsOnResize=f.throttle(function(){d.cellHeight(d.cellWidth(),!1)},100),this.onResizeHandler=function(){o&&d._updateHeightsOnResize(),d._isOneColumnMode()&&!d.opts.disableOneColumnMode?i||(d.container.addClass(d.opts.oneColumnModeClass),i=!0,d.grid._sortNodes(),f.each(d.grid.nodes,function(t){d.container.append(t.el),d.opts.staticGrid||(d.dd.draggable(t.el,"disable"),d.dd.resizable(t.el,"disable"),t.el.trigger("resize"))})):i&&(d.container.removeClass(d.opts.oneColumnModeClass),i=!1,d.opts.staticGrid||f.each(d.grid.nodes,function(t){t.noMove||d.opts.disableDrag||d.dd.draggable(t.el,"enable"),t.noResize||d.opts.disableResize||d.dd.resizable(t.el,"enable"),t.el.trigger("resize")}))},u(window).resize(this.onResizeHandler),this.onResizeHandler(),d.opts.staticGrid||"string"!=typeof d.opts.removable||(e=u(d.opts.removable),this.dd.isDroppable(e)||this.dd.droppable(e,d.opts.removableOptions),this.dd.on(e,"dropover",function(t,e){e=u(e.draggable);e.data("_gridstack_node")._grid===d&&(e.data("inTrashZone",!0),d._setupRemovingTimeout(e))}).on(e,"dropout",function(t,e){e=u(e.draggable);e.data("_gridstack_node")._grid===d&&(e.data("inTrashZone",!1),d._clearRemovingTimeout(e))})),!d.opts.staticGrid&&d.opts.acceptWidgets&&(s=null,r=function(t,e){var i=s,o=i.data("_gridstack_node"),t=d.getCellFromPixel({left:t.pageX,top:t.pageY},!0),n=Math.max(0,t.x),t=Math.max(0,t.y);o._added||(o._added=!0,o.el=i,o.autoPosition=!0,o.x=n,o.y=t,d.grid.cleanNodes(),d.grid.beginUpdate(o),d.grid.addNode(o),d.container.append(d.placeholder),d.placeholder.attr("data-gs-x",o.x).attr("data-gs-y",o.y).attr("data-gs-width",o.width).attr("data-gs-height",o.height).show(),o.el=d.placeholder,o._beforeDragX=o.x,o._beforeDragY=o.y,d._updateContainerHeight()),d.grid.canMoveNode(o,n,t)&&(d.grid.moveNode(o,n,t),d._updateContainerHeight())},this.dd.droppable(d.container,{accept:function(t){var e=(t=u(t)).data("_gridstack_node");return(!e||e._grid!==d)&&t.is(!0===d.opts.acceptWidgets?".grid-stack-item":d.opts.acceptWidgets)}}).on(d.container,"dropover",function(t,e){d.container.offset();var e=u(e.draggable),i=d.cellWidth(),o=d.cellHeight(),n=e.data("_gridstack_node"),i=n?n.width:Math.ceil(e.outerWidth()/i),o=n?n.height:Math.ceil(e.outerHeight()/o),i=(s=e,d.grid._prepareNode({width:i,height:o,_added:!1,_temporary:!0}));e.data("_gridstack_node",i),e.data("_gridstack_node_orig",n),e.on("drag",r)}).on(d.container,"dropout",function(t,e){var i,e=u(e.draggable);e.data("_gridstack_node")&&(e.unbind("drag",r),(i=e.data("_gridstack_node")).el=null,d.grid.removeNode(i),d.placeholder.detach(),d._updateContainerHeight(),e.data("_gridstack_node",e.data("_gridstack_node_orig")))}).on(d.container,"drop",function(t,e){d.placeholder.detach();var i=u(e.draggable).data("_gridstack_node"),o=(i._grid=d,u(e.draggable).clone(!1)),n=(o.data("_gridstack_node",i),u(e.draggable).data("_gridstack_node_orig"));void 0!==n&&void 0!==n._grid&&n._grid._triggerRemoveEvent(),u(e.helper).remove(),i.el=o,d.placeholder.hide(),b.removePositioningStyles(o),o.find("div.ui-resizable-handle").remove(),o.attr("data-gs-x",i.x).attr("data-gs-y",i.y).attr("data-gs-width",i.width).attr("data-gs-height",i.height).addClass(d.opts.itemClass).enableSelection().removeData("draggable").removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled").unbind("drag",r),d.container.append(o),d._prepareElementsByNode(o,i),d._updateContainerHeight(),d.grid._addedNodes.push(i),d._triggerAddEvent(),d._triggerChangeEvent(),d.grid.endUpdate(),u(e.draggable).unbind("drag",r),u(e.draggable).removeData("_gridstack_node"),u(e.draggable).removeData("_gridstack_node_orig")}))}).prototype._triggerChangeEvent=function(t){var e=this.grid.getDirtyNodes(),i=!1,o=[];e&&e.length&&(o.push(e),i=!0),!i&&!0!==t||this.container.trigger("change",o)},x.prototype._triggerAddEvent=function(){this.grid._addedNodes&&0<this.grid._addedNodes.length&&(this.container.trigger("added",[f.map(this.grid._addedNodes,f.clone)]),this.grid._addedNodes=[])},x.prototype._triggerRemoveEvent=function(){this.grid._removedNodes&&0<this.grid._removedNodes.length&&(this.container.trigger("removed",[f.map(this.grid._removedNodes,f.clone)]),this.grid._removedNodes=[])},x.prototype._initStyles=function(){this._stylesId&&b.removeStylesheet(this._stylesId),this._stylesId="gridstack-style-"+(1e5*Math.random()).toFixed(),this._styles=b.createStylesheet(this._stylesId),null!==this._styles&&(this._styles._max=0)},x.prototype._updateStyles=function(t){if(null!==this._styles&&void 0!==this._styles){var e,i="."+this.opts._class+" ."+this.opts.itemClass,o=this;if(void 0===t&&(t=this._styles._max),this._initStyles(),this._updateContainerHeight(),this.opts.cellHeight&&!(0!==this._styles._max&&t<=this._styles._max)&&(e=this.opts.verticalMargin&&this.opts.cellHeightUnit!==this.opts.verticalMarginUnit?function(t,e){return t&&e?"calc("+(o.opts.cellHeight*t+o.opts.cellHeightUnit)+" + "+(o.opts.verticalMargin*e+o.opts.verticalMarginUnit)+")":o.opts.cellHeight*t+o.opts.verticalMargin*e+o.opts.cellHeightUnit}:function(t,e){return o.opts.cellHeight*t+o.opts.verticalMargin*e+o.opts.cellHeightUnit},0===this._styles._max&&b.insertCSSRule(this._styles,i,"min-height: "+e(1,0)+";",0),t>this._styles._max)){for(var n=this._styles._max;n<t;++n)b.insertCSSRule(this._styles,i+'[data-gs-height="'+(n+1)+'"]',"height: "+e(n+1,n)+";",n),b.insertCSSRule(this._styles,i+'[data-gs-min-height="'+(n+1)+'"]',"min-height: "+e(n+1,n)+";",n),b.insertCSSRule(this._styles,i+'[data-gs-max-height="'+(n+1)+'"]',"max-height: "+e(n+1,n)+";",n),b.insertCSSRule(this._styles,i+'[data-gs-y="'+n+'"]',"top: "+e(n,n)+";",n);this._styles._max=t}}},x.prototype._updateContainerHeight=function(){var t,e;this.grid._updateCounter||(t=this.grid.getGridHeight(),0<(e=parseInt(this.container.css("min-height")))&&t<(e=(e+this.opts.verticalMargin)/(this.cellHeight()+this.opts.verticalMargin))&&(t=e),this.container.attr("data-gs-current-height",t),this.opts.cellHeight&&(this.opts.verticalMargin?this.opts.cellHeightUnit===this.opts.verticalMarginUnit?this.container.css("height",t*(this.opts.cellHeight+this.opts.verticalMargin)-this.opts.verticalMargin+this.opts.cellHeightUnit):this.container.css("height","calc("+(t*this.opts.cellHeight+this.opts.cellHeightUnit)+" + "+(t*(this.opts.verticalMargin-1)+this.opts.verticalMarginUnit)+")"):this.container.css("height",t*this.opts.cellHeight+this.opts.cellHeightUnit)))},x.prototype._isOneColumnMode=function(){return(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)<=this.opts.minWidth},x.prototype._setupRemovingTimeout=function(t){var e=u(t).data("_gridstack_node");!e._removeTimeout&&this.opts.removable&&(e._removeTimeout=setTimeout(function(){t.addClass("grid-stack-item-removing"),e._isAboutToRemove=!0},this.opts.removeTimeout))},x.prototype._clearRemovingTimeout=function(t){var e=u(t).data("_gridstack_node");e._removeTimeout&&(clearTimeout(e._removeTimeout),e._removeTimeout=null,t.removeClass("grid-stack-item-removing"),e._isAboutToRemove=!1)},x.prototype._prepareElementsByNode=function(r,d){function t(t,e){var i,o,n=Math.round(e.position.left/h),a=Math.floor((e.position.top+l/2)/l);if("drag"!=t.type&&(i=Math.round(e.size.width/h),o=Math.round(e.size.height/l)),"drag"==t.type){var s=e.position.top-d._prevYPix;d._prevYPix=e.position.top,b.updateScrollPosition(r[0],e,s),r.data("inTrashZone")||n<0||n>=g.grid.width||a<0||!g.grid.float&&a>g.grid.getGridHeight()?d._temporaryRemoved||(!0===g.opts.removable&&g._setupRemovingTimeout(r),n=d._beforeDragX,a=d._beforeDragY,g.placeholder.detach(),g.placeholder.hide(),g.grid.removeNode(d),g._updateContainerHeight(),d._temporaryRemoved=!0):(g._clearRemovingTimeout(r),d._temporaryRemoved&&(g.grid.addNode(d),g.placeholder.attr("data-gs-x",n).attr("data-gs-y",a).attr("data-gs-width",i).attr("data-gs-height",o).show(),g.container.append(g.placeholder),d.el=g.placeholder,d._temporaryRemoved=!1))}else if("resize"==t.type&&n<0)return;e=void 0!==i?i:d.lastTriedWidth,s=void 0!==o?o:d.lastTriedHeight,!g.grid.canMoveNode(d,n,a,i,o)||d.lastTriedX===n&&d.lastTriedY===a&&d.lastTriedWidth===e&&d.lastTriedHeight===s||(d.lastTriedX=n,d.lastTriedY=a,d.lastTriedWidth=i,d.lastTriedHeight=o,g.grid.moveNode(d,n,a,i,o),g._updateContainerHeight())}function e(t,e){g.container.append(g.placeholder);var i=u(this),o=(g.grid.cleanNodes(),g.grid.beginUpdate(d),h=g.cellWidth(),Math.ceil(i.outerHeight()/i.attr("data-gs-height")));l=g.container.height()/parseInt(g.container.attr("data-gs-current-height")),g.placeholder.attr("data-gs-x",i.attr("data-gs-x")).attr("data-gs-y",i.attr("data-gs-y")).attr("data-gs-width",i.attr("data-gs-width")).attr("data-gs-height",i.attr("data-gs-height")).show(),d.el=g.placeholder,d._beforeDragX=d.x,d._beforeDragY=d.y,d._prevYPix=e.position.top,g.dd.resizable(r,"option","minWidth",h*(d.minWidth||1)),g.dd.resizable(r,"option","minHeight",o*(d.minHeight||1)),"resizestart"==t.type&&i.find(".grid-stack-item").trigger("resizestart")}function i(t,e){var i,o=u(this);o.data("_gridstack_node")&&(i=!1,g.placeholder.detach(),d.el=o,g.placeholder.hide(),d._isAboutToRemove?(i=!0,r.data("_gridstack_node")._grid._triggerRemoveEvent(),r.removeData("_gridstack_node"),r.remove()):(g._clearRemovingTimeout(r),d._temporaryRemoved?(b.removePositioningStyles(o),o.attr("data-gs-x",d._beforeDragX).attr("data-gs-y",d._beforeDragY).attr("data-gs-width",d.width).attr("data-gs-height",d.height),d.x=d._beforeDragX,d.y=d._beforeDragY,d._temporaryRemoved=!1,g.grid.addNode(d)):(b.removePositioningStyles(o),o.attr("data-gs-x",d.x).attr("data-gs-y",d.y).attr("data-gs-width",d.width).attr("data-gs-height",d.height))),g._updateContainerHeight(),g._triggerChangeEvent(i),g.grid.endUpdate(),(i=o.find(".grid-stack")).length&&"resizestop"==t.type&&(i.each(function(t,e){e=u(e).data("gridstack");e&&e.onResizeHandler&&e.onResizeHandler()}),o.find(".grid-stack-item").trigger("resizestop"),o.find(".grid-stack-item").trigger("gsresizestop")),"resizestop"==t.type)&&g.container.trigger("gsresizestop",o)}var h,l,g=this;this.dd.draggable(r,{start:e,stop:i,drag:t}).resizable(r,{start:e,stop:i,resize:t}),(d.noMove||this._isOneColumnMode()&&!g.opts.disableOneColumnMode||this.opts.disableDrag||this.opts.staticGrid)&&this.dd.draggable(r,"disable"),(d.noResize||this._isOneColumnMode()&&!g.opts.disableOneColumnMode||this.opts.disableResize||this.opts.staticGrid)&&this.dd.resizable(r,"disable"),r.attr("data-gs-locked",d.locked?"yes":null)},x.prototype._prepareElement=function(t,e){e=void 0!==e&&e;(t=u(t)).addClass(this.opts.itemClass);e=this.grid.addNode({x:parseInt(t.attr("data-gs-x"),10),y:parseInt(t.attr("data-gs-y"),10),width:t.attr("data-gs-width"),height:t.attr("data-gs-height"),maxWidth:t.attr("data-gs-max-width"),minWidth:t.attr("data-gs-min-width"),maxHeight:t.attr("data-gs-max-height"),minHeight:t.attr("data-gs-min-height"),autoPosition:b.toBool(t.attr("data-gs-auto-position")),noResize:b.toBool(t.attr("data-gs-no-resize")),noMove:b.toBool(t.attr("data-gs-no-move")),locked:b.toBool(t.attr("data-gs-locked")),resizeHandles:t.attr("data-gs-resize-handles"),el:t,id:t.attr("data-gs-id"),_grid:this},e);t.data("_gridstack_node",e),this._prepareElementsByNode(t,e)},x.prototype.setAnimation=function(t){t?this.container.addClass("grid-stack-animate"):this.container.removeClass("grid-stack-animate")},x.prototype.addWidget=function(t,e,i,o,n,a,s,r,d,h,l){return t=u(t),void 0!==e&&t.attr("data-gs-x",e),void 0!==i&&t.attr("data-gs-y",i),void 0!==o&&t.attr("data-gs-width",o),void 0!==n&&t.attr("data-gs-height",n),void 0!==a&&t.attr("data-gs-auto-position",a?"yes":null),void 0!==s&&t.attr("data-gs-min-width",s),void 0!==r&&t.attr("data-gs-max-width",r),void 0!==d&&t.attr("data-gs-min-height",d),void 0!==h&&t.attr("data-gs-max-height",h),void 0!==l&&t.attr("data-gs-id",l),this.container.append(t),this._prepareElement(t,!0),this._triggerAddEvent(),this._updateContainerHeight(),this._triggerChangeEvent(!0),t},x.prototype.makeWidget=function(t){return t=u(t),this._prepareElement(t,!0),this._triggerAddEvent(),this._updateContainerHeight(),this._triggerChangeEvent(!0),t},x.prototype.willItFit=function(t,e,i,o,n){return this.grid.canBePlacedWithRespectToHeight({x:t,y:e,width:i,height:o,autoPosition:n})},x.prototype.removeWidget=function(t,e){e=void 0===e||e;var i=(i=(t=u(t)).data("_gridstack_node"))||this.grid.getNodeDataByDOMEl(t);this.grid.removeNode(i,e),t.removeData("_gridstack_node"),this._updateContainerHeight(),e&&t.remove(),this._triggerChangeEvent(!0),this._triggerRemoveEvent()},x.prototype.removeAll=function(e){f.each(this.grid.nodes,f.bind(function(t){this.removeWidget(t.el,e)},this)),this.grid.nodes=[],this._updateContainerHeight()},x.prototype.destroy=function(t){u(window).off("resize",this.onResizeHandler),this.disable(),void 0===t||t?this.container.remove():(this.removeAll(!1),this.container.removeData("gridstack")),b.removeStylesheet(this._stylesId),this.grid&&(this.grid=null)},x.prototype.resizable=function(t,o){var n=this;return(t=u(t)).each(function(t,e){var i=(e=u(e)).data("_gridstack_node");null!=i&&(i.noResize=!o,i.noResize||n._isOneColumnMode()&&!n.opts.disableOneColumnMode?n.dd.resizable(e,"disable"):n.dd.resizable(e,"enable"))}),this},x.prototype.movable=function(t,o){var n=this;return(t=u(t)).each(function(t,e){var i=(e=u(e)).data("_gridstack_node");null!=i&&(i.noMove=!o,i.noMove||n._isOneColumnMode()&&!n.opts.disableOneColumnMode?(n.dd.draggable(e,"disable"),e.removeClass("ui-draggable-handle")):(n.dd.draggable(e,"enable"),e.addClass("ui-draggable-handle")))}),this},x.prototype.enableMove=function(t,e){this.movable(this.container.children("."+this.opts.itemClass),t),e&&(this.opts.disableDrag=!t)},x.prototype.enableResize=function(t,e){this.resizable(this.container.children("."+this.opts.itemClass),t),e&&(this.opts.disableResize=!t)},x.prototype.disable=function(){this.movable(this.container.children("."+this.opts.itemClass),!1),this.resizable(this.container.children("."+this.opts.itemClass),!1),this.container.trigger("disable")},x.prototype.enable=function(){this.movable(this.container.children("."+this.opts.itemClass),!0),this.resizable(this.container.children("."+this.opts.itemClass),!0),this.container.trigger("enable")},x.prototype.locked=function(t,o){return(t=u(t)).each(function(t,e){var i=(e=u(e)).data("_gridstack_node");null!=i&&(i.locked=o||!1,e.attr("data-gs-locked",i.locked?"yes":null))}),this},x.prototype.maxHeight=function(t,o){return(t=u(t)).each(function(t,e){var i=(e=u(e)).data("_gridstack_node");null==i||isNaN(o)||(i.maxHeight=o||!1,e.attr("data-gs-max-height",o))}),this},x.prototype.minHeight=function(t,o){return(t=u(t)).each(function(t,e){var i=(e=u(e)).data("_gridstack_node");null==i||isNaN(o)||(i.minHeight=o||!1,e.attr("data-gs-min-height",o))}),this},x.prototype.maxWidth=function(t,o){return(t=u(t)).each(function(t,e){var i=(e=u(e)).data("_gridstack_node");null==i||isNaN(o)||(i.maxWidth=o||!1,e.attr("data-gs-max-width",o))}),this},x.prototype.minWidth=function(t,o){return(t=u(t)).each(function(t,e){var i=(e=u(e)).data("_gridstack_node");null==i||isNaN(o)||(i.minWidth=o||!1,e.attr("data-gs-min-width",o))}),this},x.prototype._updateElement=function(t,e){var i,o=(t=u(t).first()).data("_gridstack_node");null!=o&&((i=this).grid.cleanNodes(),i.grid.beginUpdate(o),e.call(this,t,o),i._updateContainerHeight(),i._triggerChangeEvent(),i.grid.endUpdate())},x.prototype.resize=function(t,i,o){this._updateElement(t,function(t,e){i=null!=i?i:e.width,o=null!=o?o:e.height,this.grid.moveNode(e,e.x,e.y,i,o)})},x.prototype.move=function(t,i,o){this._updateElement(t,function(t,e){i=null!=i?i:e.x,o=null!=o?o:e.y,this.grid.moveNode(e,i,o,e.width,e.height)})},x.prototype.update=function(t,i,o,n,a){this._updateElement(t,function(t,e){i=null!=i?i:e.x,o=null!=o?o:e.y,n=null!=n?n:e.width,a=null!=a?a:e.height,this.grid.moveNode(e,i,o,n,a)})},x.prototype.verticalMargin=function(t,e){if(void 0===t)return this.opts.verticalMargin;t=b.parseHeight(t);this.opts.verticalMarginUnit===t.unit&&this.opts.height===t.height||(this.opts.verticalMarginUnit=t.unit,this.opts.verticalMargin=t.height,e)||this._updateStyles()},x.prototype.cellHeight=function(t,e){if(void 0===t)return this.opts.cellHeight||(i=this.container.children("."+this.opts.itemClass).first(),Math.ceil(i.outerHeight()/i.attr("data-gs-height")));var i=b.parseHeight(t);this.opts.cellHeightUnit===i.unit&&this.opts.cellHeight===i.height||(this.opts.cellHeightUnit=i.unit,this.opts.cellHeight=i.height,e)||this._updateStyles()},x.prototype.cellWidth=function(){return this.container.outerWidth()/this.opts.width},x.prototype.getCellFromPixel=function(t,e){var e=void 0!==e&&e?this.container.offset():this.container.position(),i=t.left-e.left,t=t.top-e.top,e=Math.floor(this.container.width()/this.opts.width),o=Math.floor(this.container.height()/parseInt(this.container.attr("data-gs-current-height")));return{x:Math.floor(i/e),y:Math.floor(t/o)}},x.prototype.batchUpdate=function(){this.grid.batchUpdate()},x.prototype.commit=function(){this.grid.commit(),this._updateContainerHeight()},x.prototype.isAreaEmpty=function(t,e,i,o){return this.grid.isAreaEmpty(t,e,i,o)},x.prototype.setStatic=function(t){this.opts.staticGrid=!0===t,this.enableMove(!t),this.enableResize(!t),this._setStaticClass()},x.prototype._setStaticClass=function(){var t="grid-stack-static";!0===this.opts.staticGrid?this.container.addClass(t):this.container.removeClass(t)},x.prototype._updateNodeWidths=function(t,e){this.grid._sortNodes(),this.grid.batchUpdate();for(var i,o=0;o<this.grid.nodes.length;o++)i=this.grid.nodes[o],this.update(i.el,Math.round(i.x*e/t),void 0,Math.round(i.width*e/t),void 0);this.grid.commit()},x.prototype.setGridWidth=function(t,e){this.container.removeClass("grid-stack-"+this.opts.width),!0!==e&&this._updateNodeWidths(this.opts.width,t),this.opts.width=t,this.grid.width=t,this.container.addClass("grid-stack-"+t)},C.prototype.batch_update=v(C.prototype.batchUpdate),C.prototype._fix_collisions=v(C.prototype._fixCollisions,"_fix_collisions","_fixCollisions"),C.prototype.is_area_empty=v(C.prototype.isAreaEmpty,"is_area_empty","isAreaEmpty"),C.prototype._sort_nodes=v(C.prototype._sortNodes,"_sort_nodes","_sortNodes"),C.prototype._pack_nodes=v(C.prototype._packNodes,"_pack_nodes","_packNodes"),C.prototype._prepare_node=v(C.prototype._prepareNode,"_prepare_node","_prepareNode"),C.prototype.clean_nodes=v(C.prototype.cleanNodes,"clean_nodes","cleanNodes"),C.prototype.get_dirty_nodes=v(C.prototype.getDirtyNodes,"get_dirty_nodes","getDirtyNodes"),C.prototype.add_node=v(C.prototype.addNode,"add_node","addNode, "),C.prototype.remove_node=v(C.prototype.removeNode,"remove_node","removeNode"),C.prototype.can_move_node=v(C.prototype.canMoveNode,"can_move_node","canMoveNode"),C.prototype.move_node=v(C.prototype.moveNode,"move_node","moveNode"),C.prototype.get_grid_height=v(C.prototype.getGridHeight,"get_grid_height","getGridHeight"),C.prototype.begin_update=v(C.prototype.beginUpdate,"begin_update","beginUpdate"),C.prototype.end_update=v(C.prototype.endUpdate,"end_update","endUpdate"),C.prototype.can_be_placed_with_respect_to_height=v(C.prototype.canBePlacedWithRespectToHeight,"can_be_placed_with_respect_to_height","canBePlacedWithRespectToHeight"),x.prototype._trigger_change_event=v(x.prototype._triggerChangeEvent,"_trigger_change_event","_triggerChangeEvent"),x.prototype._init_styles=v(x.prototype._initStyles,"_init_styles","_initStyles"),x.prototype._update_styles=v(x.prototype._updateStyles,"_update_styles","_updateStyles"),x.prototype._update_container_height=v(x.prototype._updateContainerHeight,"_update_container_height","_updateContainerHeight"),x.prototype._is_one_column_mode=v(x.prototype._isOneColumnMode,"_is_one_column_mode","_isOneColumnMode"),x.prototype._prepare_element=v(x.prototype._prepareElement,"_prepare_element","_prepareElement"),x.prototype.set_animation=v(x.prototype.setAnimation,"set_animation","setAnimation"),x.prototype.add_widget=v(x.prototype.addWidget,"add_widget","addWidget"),x.prototype.make_widget=v(x.prototype.makeWidget,"make_widget","makeWidget"),x.prototype.will_it_fit=v(x.prototype.willItFit,"will_it_fit","willItFit"),x.prototype.remove_widget=v(x.prototype.removeWidget,"remove_widget","removeWidget"),x.prototype.remove_all=v(x.prototype.removeAll,"remove_all","removeAll"),x.prototype.min_height=v(x.prototype.minHeight,"min_height","minHeight"),x.prototype.min_width=v(x.prototype.minWidth,"min_width","minWidth"),x.prototype._update_element=v(x.prototype._updateElement,"_update_element","_updateElement"),x.prototype.cell_height=v(x.prototype.cellHeight,"cell_height","cellHeight"),x.prototype.cell_width=v(x.prototype.cellWidth,"cell_width","cellWidth"),x.prototype.get_cell_from_pixel=v(x.prototype.getCellFromPixel,"get_cell_from_pixel","getCellFromPixel"),x.prototype.batch_update=v(x.prototype.batchUpdate,"batch_update","batchUpdate"),x.prototype.is_area_empty=v(x.prototype.isAreaEmpty,"is_area_empty","isAreaEmpty"),x.prototype.set_static=v(x.prototype.setStatic,"set_static","setStatic"),x.prototype._set_static_class=v(x.prototype._setStaticClass,"_set_static_class","_setStaticClass"),y.GridStackUI=x,y.GridStackUI.Utils=b,y.GridStackUI.Engine=C,y.GridStackUI.GridStackDragDropPlugin=W,u.fn.gridstack=function(e){return this.each(function(){var t=u(this);t.data("gridstack")||t.data("gridstack",new x(this,e))})},y.GridStackUI,k=jQuery,at=_,M=GridStackUI,window,M.GridStackDragDropPlugin.registerPlugin(E),((E.prototype=Object.create(M.GridStackDragDropPlugin.prototype)).constructor=E).prototype.resizable=function(t,e){var i;return t=k(t),"disable"===e||"enable"===e?t.resizable(e):"option"===e?t.resizable(e,arguments[2],arguments[3]):(i=t.data("gs-resize-handles")?t.data("gs-resize-handles"):this.grid.opts.resizable.handles,t.resizable(at.extend({},this.grid.opts.resizable,{handles:i},{start:e.start||function(){},stop:e.stop||function(){},resize:e.resize||function(){}}))),this},E.prototype.draggable=function(t,e){return t=k(t),"disable"===e||"enable"===e?t.draggable(e):t.draggable(at.extend({},this.grid.opts.draggable,{containment:this.grid.opts.isNested?this.grid.container.parent():null,distance:7,start:e.start||function(){},stop:e.stop||function(){},drag:e.drag||function(){}})),this},E.prototype.droppable=function(t,e){return(t=k(t)).droppable(e),this},E.prototype.isDroppable=function(t,e){return t=k(t),Boolean(t.data("droppable"))},E.prototype.on=function(t,e,i){return k(t).on(e,i),this},window.GridStackUI.prototype._updateStyles=function(t){if(null!==this._styles&&void 0!==this._styles){var e,i="."+this.opts._class+" > ."+this.opts.itemClass,o=this;if(void 0===t&&(t=this._styles._max,this._initStyles(),this._updateContainerHeight()),this.opts.cellHeight){if(!(0!==this._styles._max&&t<=this._styles._max)&&(e=this.opts.verticalMargin&&this.opts.cellHeightUnit!==this.opts.verticalMarginUnit?function(t,e){return t&&e?"calc("+(o.opts.cellHeight*t+o.opts.cellHeightUnit)+" + "+(o.opts.verticalMargin*e+o.opts.verticalMarginUnit)+")":o.opts.cellHeight*t+o.opts.verticalMargin*e+o.opts.cellHeightUnit}:function(t,e){return o.opts.cellHeight*t+o.opts.verticalMargin*e+o.opts.cellHeightUnit},0===this._styles._max&&window.GridStackUI.Utils.insertCSSRule(this._styles,i,"min-height: "+e(1,0)+";",0),t>this._styles._max)){for(var n=this._styles._max;n<t;++n)window.GridStackUI.Utils.insertCSSRule(this._styles,i+'[data-gs-height="'+(n+1)+'"]',"height: "+e(n+1,n)+";",n),window.GridStackUI.Utils.insertCSSRule(this._styles,i+'[data-gs-min-height="'+(n+1)+'"]',"min-height: "+e(n+1,n)+";",n),window.GridStackUI.Utils.insertCSSRule(this._styles,i+'[data-gs-max-height="'+(n+1)+'"]',"max-height: "+e(n+1,n)+";",n),window.GridStackUI.Utils.insertCSSRule(this._styles,i+'[data-gs-y="'+n+'"]',"top: "+e(n,n)+";",n);this._styles._max=t}}else this._styles._max=t}},window.GridStackUI.Utils.getScrollParent=_.wrap(window.GridStackUI.Utils.getScrollParent,function(t,e){return e&&e.parentNode&&e.parentNode.className&&0<=e.parentNode.className.indexOf("fillHeightMode")?null:t(e)});R.updateChartsWebGLContext=function(t,i,o,n){t.forEach(function(t){var e=t.view.key;"ChartGL"!==e&&-1===R.PANELS.indexOf(e)||null!=(e=t.view.app)&&e.updateWebGLContext(i,o,n)})},R.validateWebGL=function(t){t?l.Log.Info("webgl works!"):"undefined"!=typeof WebGL2RenderingContext?console.error("Your browser appears to support WebGL but it might be disabled. Try updating your OS and/or video card drivers"):console.error("Your browser does not support WebGL")},R.clearWebGLCanvas=function(t){t&&(t.clearColor(0,0,0,0),t.viewport(0,0,t.canvas.width,t.canvas.height),t.clear(t.COLOR_BUFFER_BIT))},R.createWebGLCanvas=function(t){var e=document.createElement("canvas");return e.setAttribute("class","webgl-canvas"),e.id=_.uniqueId("PanelGL"),t.getElementsByClassName("webgl-panel-wrapper")[0].append(e),e},R.createWebGLContext=function(t){var e,i,o=/Trident\/.*rv:11/.test(navigator.userAgent),o="undefined"!=typeof WebGL2RenderingContext?"webgl2":o?"experimental-webgl":"webgl",n=(e="webgl",(i=document.createElement("canvas")).setAttribute("width","1"),i.setAttribute("height","1"),(n=document.getElementsByTagName("body")[0]).appendChild(i),e=i.getContext(e,{failIfMajorPerformanceCaveat:!0}),n.removeChild(i),!!e);return t.getContext(o,{premultipliedAlpha:n,preserveDrawingBuffer:!0})},R.resizeCharts=function(t,e,i){i&&this.clearWebGLCanvas(e),t.forEach(function(t){var e=t.view.key;"ChartGL"!==e&&-1===R.PANELS.indexOf(e)||t.view.onResize(!0)})},R.PANELS=["Panel","FlexPanel","Accordion","Tabs","OverlayPanel"];var S=R;function R(){}H.prototype.onExpandWidgetsChange=function(e,t){var i=this;t.forEach(function(t){"None"===e?(i.removeExpandButtonFromWidget(t),i.widgetExpanded=!1,i.expandedWidgetModel=null):"Fill Dashboard"!==e&&"Fill Panel"!==e||i.addExpandButtonToWidget(t),t.view.updateExpandedButton("Fill Dashboard"===e||"Fill Panel"===e,!0)})},H.prototype.removeExpandButtonFromWidget=function(t){var t=t.view.el.getElementsByClassName("expand-btn-div")[0],e=t.getElementsByClassName("expand-btn")[0];e&&(e.removeEventListener("click",this.expandWidget),t.removeChild(e))},H.prototype.updateExpandButtonIcon=function(t){var e,t=t.view.el.getElementsByClassName("expand-btn-div")[0].getElementsByClassName("expand-btn")[0];t&&(e=this.widgetExpanded?"minus":"window-maximize",t.innerHTML='<span><i class="fa fa-'+e+'"></i></span>')},H.prototype.applyExpandedAttrs=function(t){var e,i,t=t||this.expandedWidgetModel;t&&(i=document.querySelectorAll("[data-widgetid='"+t.widgetId+"']"),_.each(i,function(t){"none"!==t.style.display&&(e=t)}),e)&&(e.setAttribute("data-gs-height",this.getRowCount()),e.setAttribute("data-gs-width",this.getColumnCount()),e.setAttribute("data-gs-x","0"),e.setAttribute("data-gs-y","0"),i=this.getWidgets(),"Fill Panel"===this.expandWidgetsValue)&&1===i.length&&this.gridstack&&this.gridstack.update(t.$widget,0,0,this.getColumnCount(),this.getRowCount())},H.prototype.getExpandedWidget=function(){return this.expandedWidgetModel},H.prototype.getWidgetExpanded=function(){return this.widgetExpanded},H.prototype.addWidgetToBasePanel=function(t,e){var i=this,o=document.querySelector("[data-widgetid='"+t.widgetId+"']");this.widgetExpanded=!0,this.onChange_RelativeHeight(),o&&(this.getWidgets().forEach(function(t){var e=document.querySelector("[data-widgetid='"+t.widgetId+"']");i.widgetTags[t.widgetId]={"data-gs-x":e.getAttribute("data-gs-x"),"data-gs-y":e.getAttribute("data-gs-y")},e.style.display="none"}),o.style.display="none",this.onResize(!0)),this.expandedWidgetModel=t,this.expandWidgetsValue=e,this.setExpandWidgetsValue(e),this.getWidgetCollection().add(t.model),this.switchOffBuildMode(!1),this.applyExpandedAttrs(t),this.onResize(!0)},H.prototype.expandWidget=function(e){var t,i,o,n=this.expandWidgetsValue;"Fill Dashboard"===n?null!=(o=this.basePanelRef)&&o.addWidgetToBasePanel(e,"Fill Dashboard"):"Fill Panel"===n&&(this.widgetExpanded=!0,this.updateExpandButtonIcon(e),this.onChange_RelativeHeight(),this.expandedWidgetModel=e,this.getWidgets().forEach(function(t){t.widgetId!==e.widgetId&&t.$widget.hide()}),o=document.querySelector("[data-widgetid='"+e.widgetId+"']"))&&(n=o.getAttribute("data-gs-height"),t=o.getAttribute("data-gs-width"),i=o.getAttribute("data-gs-x"),o=o.getAttribute("data-gs-y"),this.expandedWidget={widgetHeight:n,widgetWidth:t,widgetX:i,widgetY:o},this.applyExpandedAttrs(e),e.view.onResize(!0))},H.prototype.collapseWidget=function(e){var t;this.widgetExpanded=!1,this.expandedWidgetModel=null,this.onChange_RelativeHeight(),this.updateExpandButtonIcon(e),"Fill Dashboard"===this.expandWidgetsValue?(this.isBasePanel&&this.removeWidgetFromBasePanel(e),t=document.getElementsByClassName("worksheet")[0].getElementsByClassName("grid-stack")[0].children,_.each(t,function(t){t.classList.contains("grid-stack-item")&&(t.style.display="")}),document.querySelector("[data-widgetid='"+e.widgetId+"']").style.display=""):"Fill Panel"===this.expandWidgetsValue&&(t=document.querySelector("[data-widgetid='"+e.widgetId+"']"))&&this.expandedWidget&&(this.expandedWidget.widgetHeight&&t.setAttribute("data-gs-height",this.expandedWidget.widgetHeight),this.expandedWidget.widgetWidth&&t.setAttribute("data-gs-width",this.expandedWidget.widgetWidth),this.expandedWidget.widgetX&&t.setAttribute("data-gs-x",this.expandedWidget.widgetX),this.expandedWidget.widgetY&&t.setAttribute("data-gs-y",this.expandedWidget.widgetY),this.getWidgets().forEach(function(t){t.widgetId!==e.widgetId&&t.$widget.show()})),this.onResize(!0),this.expandedWidget={}},H.prototype.addExpandButtonToWidget=function(e){var t,i,o=this,n=e.view.el.getElementsByClassName("expand-btn-div")[0];n.getElementsByClassName("expand-btn")[0]?this.updateExpandButtonIcon(e):((t=document.createElement("div")).className="expand-btn",i=this.widgetExpanded?"minus":"window-maximize",t.innerHTML='<span><i class="fa fa-'+i+'"></i></span>',n.appendChild(t),t.addEventListener("click",function(t){return o.widgetExpanded?o.collapseWidget(e):o.expandWidget(e)}),i="Fill Dashboard"===this.expandWidgetsValue||"Fill Panel"===this.expandWidgetsValue,e.view.updateExpandedButton(i,!1))},H.prototype.removeWidgetFromBasePanel=function(t){var i=this;this.expandedWidgetModel=null,this.widgetExpanded=!1,this.getWidgetCollection().remove(t.model),this.getWidgets().forEach(function(t){var e=document.querySelector("[data-widgetid='"+t.widgetId+"']"),t=i.widgetTags[t.widgetId];t&&(e.setAttribute("data-gs-x",t["data-gs-x"]),e.setAttribute("data-gs-y",t["data-gs-y"])),e.style.display=""}),this.widgetTags={},this.setExpandWidgetsValue("None")},H.prototype.setGridstack=function(t){this.gridstack=t},H.prototype.updateExpandWidgetsValue=function(t){this.expandWidgetsValue=t};var rt=H;function H(t,e,i,o,n,a,s,r,d,h){this.isBasePanel=t,this.basePanelRef=e,this.onResize=i,this.getWidgets=o,this.getWidgetCollection=n,this.switchOffBuildMode=a,this.onChange_RelativeHeight=s,this.getRowCount=r,this.getColumnCount=d,this.setExpandWidgetsValue=h,this.widgetExpanded=!1,this.expandedWidgetModel=null,this.expandWidgetsValue="None",this.widgetTags={}}dt=l.ComponentDropView,I(T,dt),T.prototype.initialize=function(t){this.options=t,this.api=t.api,this.widgetClass="ui-widget",this.widgetEdge=12,this.gridstackMargin=0,this.isBasePanel=t.isBasePanel||!1,this.dashboardAppModel=t.dashboardAppModel,this.dashboardViewModel=t.dashboardViewModel,this.documentModel=t.documentModel,this.dataModel=t.dataModel,this.DeltaClientLib=t.DeltaClientLib,this.documentViewModel=t.viewModel,this.model=this.model||t.componentModel,this.events=null,this.expandWidgets=new rt(this.isBasePanel,t.basePanel,this.onResize.bind(this),this.getWidgets.bind(this),this.getWidgetsCollection.bind(this),this.switchBuildMode.bind(this),this.onChange_RelativeHeight.bind(this),this.getRowCount.bind(this),this.getColumnCount.bind(this),this.setExpandWidgetsValue.bind(this)),this.basePanel=this.isBasePanel?this.expandWidgets:t.basePanel,this.webGLContextAndCanvas=t.webGLContextAndCanvas,this.webGLContextAndCanvas&&this.webGLContextAndCanvas.elements&&(this.webGLContextAndCanvas.elements=this.webGLContextAndCanvas.elements.concat(this.el)),this.model instanceof l.Component&&(this.model.panelView=this),this.quickView=t.quickView,this.settingsModel=t.settingsModel,this.websiteUrl=t.websiteUrl,this.userWidgets=new l.WidgetCollection([],{},this.model),this.viewModel=new A.DeepModel,this.widgets=[],this.throttledUpdateHighlightItem=_.throttle(this.updateHighlightItem,41),this.debouncedRenderConfigureWidgetsMenu=_.debounce(this.renderConfigureWidgetsMenu,100),this.postRender(),this.isBasePanel&&(_.extend(this,st),this.initializeBasePanel&&this.initializeBasePanel(this),this.triggerDragEvent=this.triggerDragEvent.bind(this),$(window).on("dragover",this.triggerDragEvent),this.onPanelDragEvent_throttled=_.throttle(this.onPanelDragEvent,200),this.listenTo(this.dashboardViewModel,"onPanelDragEvent",this.onPanelDragEvent_throttled))},T.prototype.initializeEvents=function(){var t=this;l.ComponentDropView.prototype.initializeEvents.apply(this),this.listenTo(this.viewModel,"change:"+T.KEY_RELATIVE_HEIGHT,this.onChange_RelativeHeight),this.listenTo(this.viewModel,"change:"+T.KEY_FLOATABLE,this.onChange_Floatable),this.listenTo(this.viewModel,"change:"+T.KEY_COLUMN_COUNT,this.onChange_ColumnCount),this.listenTo(this.viewModel,"change:"+T.KEY_ROW_COUNT,this.onChange_RowCount),this.listenTo(this.viewModel,"change:"+T.KEY_ROW_HEIGHT,this.onChange_RowHeight),this.listenTo(this.viewModel,"change:"+T.KEY_ADVANCED,this.onPropAdvanced),this.listenTo(this.viewModel,"change:"+T.REPEATABLE_VIEWSTATE,function(){t.viewModel.get(T.REPEATABLE)&&t.populatePanelWithWidgets()}),this.listenTo(this.viewModel,"change:"+T.REPEATABLE,this.onLayoutReset),this.$worksheet.on("click",$.proxy(this.onWorksheetClick,this)),this.$showConfigureWidgetsMenu.on("click",$.proxy(this.onShowConfigureWidgetsMenu,this)),this.$configureWidgetsMenu.on("click",$.proxy(this.onConfigureWidgetsMenuClick,this)),this.listenTo(this.userWidgets,"add remove reset",this.debouncedRenderConfigureWidgetsMenu),this.listenTo(this.userWidgets,"reset",this.onUserLayoutReset),this.$worksheet.on("dragenter",this.getSafeDragNDropHandler(this.onWorksheetDragEnter)),this.$worksheet.on("dragover",this.getSafeDragNDropHandler(this.onWorksheetDragOver)),this.$worksheet.on("dragleave",this.getSafeDragNDropHandler(this.onWorksheetDragLeave)),this.$worksheet.on("drop",this.getSafeDragNDropHandler(this.onWorksheetDrop)),this.listenTo(this.dashboardViewModel,"change:selectedWidget",this.changeOverlayVisibilty),this.listenTo(this.dashboardViewModel,"change:buildMode",this.changeOverlayVisibilty)},T.prototype.initializeEvents_widgetCollection=function(){var a=this;this.listenTo(this.widgetsCollection,"remove",function(e,t,i){var o=_.find(a.widgets,function(t){return t.model.cid===e.cid}),n=(a.selected&&a.selected===o&&a.deselectCurrentWidget(),a.expandWidgets.getExpandedWidget());o&&o.widgetId===(null==n?void 0:n.widgetId)&&a.expandWidgets.collapseWidget(o),a.removeWidget(o)}),this.listenTo(this.widgetsCollection,"add",function(t,e){a.ignoreGridstackEvents=!0;var t=a.addWidget(t,!1,null),i=a.expandWidgetsValue;"Fill Dashboard"!==i&&"Fill Panel"!==i||a.expandWidgets.addExpandButtonToWidget(t),a.ignoreGridstackEvents=!1})},T.prototype.initializePost=function(){var t;this.hasInitPost||(this.hasInitPost=!0,this.initializeEvents(),this.isBasePanel&&this.set_gridstackMargin&&this.set_gridstackMargin(),this.modifyFillHeightModeCssClass(),this.set_columnCount(),this.recalculateColumnWidth(),this.isUserEditMode()?(this.populateUserWidgetsCollection(),this.widgetsCollection=this.userWidgets,this.dashboardViewModel.set("userConfigurable",!0)):this.widgetsCollection=this.model.get("widgets"),this.initializeEvents_widgetCollection(),this.upgradeGridsterLayout(),(t=this.getMaxRowCount())>(this.viewModel.get(T.KEY_ROW_COUNT)||0)&&(this.isFillHeight()?this.api.setProperty(T.KEY_ROW_COUNT,t):this.viewModel.set(T.KEY_ROW_COUNT,t,{silent:!0})),this.set_rowCount(),this.recalculateUsedRowHeight(),this.viewModel.get(T.KEY_ADVANCED)||this.initGridStack(),this.populatePanelWithWidgets(),this.switchBuildMode(this.dashboardViewModel.get("buildMode")),this.changeOverlayVisibilty(),this.isInitialized=!0)},T.prototype.addWidget=function(t,e,i){this.$noWidgetsInfo.hide();!!this.api.getProperty&&this.api.getProperty("Basics.EnableWebGLContext")?(this.gl||this.setWebGLContext(),o={gl:this.gl,canvas:this.canvas,elements:[this.el]}):this.webGLContextAndCanvas&&(-1===(null==(n=this.webGLContextAndCanvas.elements)?void 0:n.indexOf(this.el))&&(this.webGLContextAndCanvas.elements=n.concat(this.el)),o=this.webGLContextAndCanvas);var o,n=this.expandWidgetsValue;return l.ComponentDropView.prototype.addWidget.apply(this,[t,e,i,this.basePanel,o,"Fill Dashboard"===n||"Fill Screen"===n])},T.prototype.insertNewWidget=function(t,e,i,o,n,a,s,r){var d;if((n||(n=new l.Widget({},{},this.widgetsCollection),d={},_.isNumber(t)&&(d.row=t),_.isNumber(e)&&(d.column=e),_.isNumber(i)&&(d.rowSpan=i),_.isNumber(o)&&(d.colSpan=o),_.isEmpty(d))||(t=n.get("layout"),_.extend(t.attributes,d),_.extend(t._previousAttributes,d)),r)&&!this.changeLayout(n))return void l.ErrorDialog.ShowError("No space available!");return a&&!s&&this.addComponentToWidget(n,a,!1),this.isUserEditMode()?this.widgetsCollection.add(n):this.widgetsCollection.commandAdd(n,s?"Paste":null),_.findLast(this.widgets,{widgetId:n.id})},T.prototype.addWidgetEvents=function(t){var e,i=this;if(!(t instanceof $))throw"Wrong parameter.";_.each(t,function(t){(e=$(t)).on("click",$.proxy(i.onWidgetClick,i)),e.on("dragenter",i.getSafeDragNDropHandler(i.onComponentDragEnter)),e.on("dragleave",i.getSafeDragNDropHandler(i.onComponentDragLeave)),e.on("dragover",i.getSafeDragNDropHandler(i.onComponentDragOver)),e.on("drop",i.getSafeDragNDropHandler(i.onComponentDrop)),e.on("mousedown",$.proxy(i.onWidgetMouseDown,i))})},T.prototype.applyGridStackMargin=function(){var t={margin:this.gridstackMargin};this.$gridstack&&this.$gridstack.css(t),this.$rowHighlightItem&&this.$rowHighlightItem.css(t),this.$worksheetHighlightItem&&this.$worksheetHighlightItem.css("margin-left",this.gridstackMargin),this.recalculateUsedRowHeight()},T.prototype.changeLayout=function(t){var r=this,e=this.dashboardAppModel.get("copiedWidgetSize")||[300,200];if(this.viewModel.get(T.KEY_ADVANCED)){t.get("layout").set({row:this.getMaxRowCount(),column:0,rowSpan:1,colSpan:this.columnCount});var i=t.get("component").get("options").get("Style"),o=i.advanced||"";_.every([".advanced-item","width","height"],function(t){return o.indexOf(t)<0})&&(i.advanced=(o?o+"\n\n":"")+'.advanced-item[data-widgetid="'+t.get("id")+'"] { width: '+Math.min(e[0],this.columnCount*this.columnWidth)+"px; height: "+e[1]+"px; }\n\n")}else if(this.isFillHeight()){for(var i=this.dashboardAppModel.get("copiedWidgetSize")||[300,200],d=Math.max(1,Math.min(this.columnCount,Math.round(i[0]/this.columnWidth))),h=Math.max(1,Math.min(this.rowCount,Math.round(i[1]/this.usedRowHeight))),n=void 0,a=void 0,s=!1,l=void 0,g=void 0,c=0,p=0,u=_.map(Array(this.rowCount),function(){return _.fill(Array(r.columnCount),1)}),n=(this.widgetsCollection.each(function(t){for(var e,t=t.get("layout"),i=t.get("row"),o=t.get("column"),n=i+t.get("rowSpan"),a=o+t.get("colSpan"),s=i;s<n;s++)for(e=o;e<a;e++)u[s][e]=0}),0);!s&&n<this.rowCount;n++)for(a=0;!s&&a<this.columnCount;a++)u[n][a]&&(l=function(t,e){for(var i,o,n=1,a=0,s=e;u[t][s]&&s<e+d&&s<r.columnCount;s++,a++);if(p<=a){for(c=p<a?0:c,p=a,o=_.range(e,s),i=t+1;i<t+h&&i<r.rowCount;i++){if(!_.every(o,function(t){return u[i][t]}))break;n++}if(c<n)return[t,e,c=n,a]}}(n,a))&&(s=(g=l)[2]===h&&g[3]===d);if(!g)return!1;t.get("layout").set({row:g[0],column:g[1],rowSpan:g[2],colSpan:g[3]})}else t.get("layout").set({row:this.getMaxRowCount(),column:0,rowSpan:Math.max(1,Math.round(e[1]/this.usedRowHeight)),colSpan:Math.max(1,Math.min(this.columnCount,Math.round(e[0]/this.columnWidth)))});return!0},T.prototype.changeOverlayVisibilty=function(){var t;!!this.dashboardViewModel.get("buildMode")?(t=this.dashboardViewModel.get("selectedWidget"),_.isNil(t)?this.isBasePanel?this.$gridOverlay.show():this.$gridOverlay.hide():t.get("id")===this.options.widgetId?this.$gridOverlay.show():this.$gridOverlay.hide()):this.$gridOverlay.hide()},T.prototype.clearPanel_initGridstack=function(){this.clearWidgets(),this.removeGridstack(),this.viewModel.get(T.KEY_ADVANCED)||this.initGridStack()},T.prototype.clearWidgets=function(){_.includes(this.model.get("widgets").map("id"),this.dashboardViewModel.get("selectedWidgetId"))&&this.deselectCurrentWidget(),0<this.widgets.length&&(_.each(this.widgets,function(t){t.view&&_.isFunction(t.view.remove)&&t.view.remove()}),this.widgets=[],this.gridstack?(this.ignoreGridstackEvents=!0,this.gridstack.removeAll(),this.ignoreGridstackEvents=!1):this.$gridstack&&this.$gridstack.children(":not(.grid-stack-overlay)").remove())},T.prototype.createUserWidget=function(t,e){var i=new l.Widget({id:t.id},{},{});return e=e||t.get("layout").attributes,i.get("layout").set(e),i.set("component",t.get("component")),i},T.prototype.deselectCurrentWidget=function(){this.dashboardViewModel.set("selectedWidget",null),this.dashboardViewModel.set("selectedWidgetView",null,{silent:!0})},T.prototype.disableWidgetSelect=function(){this.ignoreWidgetSelect=!0;var t=this.currentActionWidget&&this.currentActionWidget.$widget?this.currentActionWidget.$widget.find(".errorPanel"):null;t&&t.css("pointer-events","none")},T.prototype.enableWidgetSelect=function(){this.userCan("select")&&(this.ignoreWidgetSelect=!1);var t=this.currentActionWidget&&this.currentActionWidget.$widget?this.currentActionWidget.$widget.find(".errorPanel"):null;t&&t.css("pointer-events","")},T.prototype.findWidgetItem=function(t){return _.find(this.widgets,{widgetId:t})},T.prototype.isUserEditMode=function(){return this.viewModel.get(T.KEY_USER_LAYOUT)&&this.quickView},T.prototype.generateUserLayout=function(t){var e={};return t.each(function(t){e[t.id]=t.get("layout").attributes}),e},T.prototype.getMaxRowCount=function(){var t=this.widgetsCollection.models;return _.max(t.map(function(t){t=t.get("layout");return t.get("row")+t.get("rowSpan")}))||0},T.prototype.getNewWidgetLayout=function(t){var t=t.get("layout"),e=t.get("row"),i=t.get("column"),o=t.get("rowSpan"),t=t.get("colSpan");_.isNaN(e)||_.isNaN(i),o&&t||Math.ceil(this.columnCount/2)},T.prototype.highlightItemToBeReplaced=function(t){t.hasClass(T.CSS_REPLACING)||_.includes(["Accordion","FlexPanel","Panel","Tabs"],t.data("componentid"))||t.addClass(T.CSS_REPLACING)},T.prototype.initGridStack=function(){var e=this;T.gsStyleManager.add(this.columnCount),this.applyGridStackMargin(),this.setupMinHeight(),this.modifyFillHeightModeCssClass(),this.gridstack=this.$gridstack.gridstack({animate:!1,cellHeight:this.usedRowHeight,height:this.isFillHeight()?this.rowCount:0,float:this.viewModel.get(T.KEY_FLOATABLE),width:this.columnCount,verticalMargin:0,resizable:{autoHide:!1,handles:"ne,nw,se,sw,s,e,w"}}).data("gridstack"),this.expandWidgets.setGridstack(this.gridstack),this.setupGetGridHeight(),this.$gridstack.addClass("grid-stack-".concat(this.columnCount)),this.updateOverlaySize(),this.$gridstack.data("dragdata",{}),this.$gridstack.on("resizestart",$.proxy(this.onWidgetResizeStart,this)),this.$gridstack.on("resize",$.proxy(this.onWidgetResize,this)),this.$gridstack.on("resizestop",$.proxy(this.onWidgetResizeStop,this)),this.$gridstack.on("gsresizestop",$.proxy(this.onWidgetGSResizeStop,this)),this.$gridstack.on("dragstart",$.proxy(this.onWidgetDraggingStart,this)),this.$gridstack.on("drag",$.proxy(this.onWidgetDragging,this)),this.$gridstack.on("dragstop",$.proxy(this.onWidgetDraggingStop,this)),this.$gridstack.on("change",$.proxy(this.onGridstackChange,this)),this.el.getElementsByClassName("worksheet")[0].addEventListener("scroll",function(t){return e.onScroll(t)}),this.$gridstack.on("dragenter",this.getSafeDragNDropHandler(this.onGridstackDragEnter)),this.$gridstack.on("dragleave",this.getSafeDragNDropHandler(this.onGridstackDragLeave)),this.$gridstack.on("dragover",this.getSafeDragNDropHandler(this.onGridstackDragOver)),this.$gridstack.on("drop",this.getSafeDragNDropHandler(this.onGridstackDrop)),this.dashboardViewModel.get("buildMode")||this.switchBuildMode(this.dashboardViewModel.get("buildMode"))},T.prototype.initSortable=function(){var n=this;this.$gridstack.sortable({stop:function(){var t=$(this).children();_.each(t,function(e,t){var i=_.find(n.widgets,function(t){return t.$widget[0]===e}),o=$(e);i&&(i.model.get("layout").set("row",t*T.DEFAULT_WIDGET_ROW_SPAN),i.model.get("layout").set("rowSpan",T.DEFAULT_WIDGET_ROW_SPAN)),o.attr("data-gs-y",t*T.DEFAULT_WIDGET_ROW_SPAN),o.attr("data-gs-height",T.DEFAULT_WIDGET_ROW_SPAN)})}}),this.$gridstack.disableSelection()},T.prototype.modifyFillHeightModeCssClass=function(){this.$gridstack.removeClass("fillHeightMode"),this.isFillHeight()&&!this.viewModel.get(T.KEY_ADVANCED)&&this.$gridstack.addClass("fillHeightMode")},T.prototype.onChange_ColumnCount=function(){this.$gridstack.removeClass("grid-stack-".concat(this.columnCount)),T.gsStyleManager.remove(this.columnCount),this.set_columnCount(),this.recalculateColumnWidth(),T.gsStyleManager.add(this.columnCount),this.$gridstack.addClass("grid-stack-".concat(this.columnCount)),this.gridstack&&this.gridstack.setGridWidth(this.columnCount,!0),this.updateOverlaySize()},T.prototype.onChange_Floatable=function(){this.gridstack&&(this.gridstack.grid.float=this.gridstack.grid._float=this.viewModel.get(T.KEY_FLOATABLE),this.gridstack.batchUpdate(),this.gridstack.commit())},T.prototype.onChange_RelativeHeight=function(){this.isFillHeight()?this.$worksheetHighlightItem.hide():this.$worksheetHighlightItem.show(),this.isBasePanel&&this.updatePropertyInspectorForBasePanel&&this.updatePropertyInspectorForBasePanel(),this.modifyFillHeightModeCssClass(),this.recalculateUsedRowHeight(),this.setupGetGridHeight(),this.setupMinHeight(),this.onResize(!0)},T.prototype.onChange_RowCount=function(){this.set_rowCount(),this.setupGetGridHeight(),this.recalculateUsedRowHeight(),this.updateOverlaySize(),!this.viewModel.get(T.KEY_ADVANCED)&&this.isFillHeight()&&this.onResize(!0)},T.prototype.onChange_RowHeight=function(){this.viewModel.get(T.KEY_ADVANCED)||(this.recalculateUsedRowHeight(),this.isFillHeight())||(this.gridstack.cellHeight(this.usedRowHeight),this.updateOverlaySize(),this.onResize(!0))},T.prototype.onComponentDragOver=function(t){var e,i,o,n;return this.triggerDragEvent(t),this.userCan("addNew")&&(i=$(t.target).closest(".grid-stack-item"),this.isFillHeight()?this.highlightItemToBeReplaced(i):(i&&(n=i.offset()),o=t.originalEvent.pageY-n.top,t=t.originalEvent.pageX-n.left,n=i.outerHeight()||0,o<=this.widgetEdge?(this.rowDropNo=_.parseInt(i.attr("data-gs-y")),e=0===this.rowDropNo?0:i.position().top-this.widgetEdge/2+1,this.onComponentDragOver_moveHighlightItem(i,e,t)):n-o<=this.widgetEdge?(e=i.position().top+n-this.widgetEdge+this.widgetEdge/2-1,this.rowDropNo=_.parseInt(i.attr("data-gs-y"))+_.parseInt(i.attr("data-gs-height")),this.onComponentDragOver_moveHighlightItem(i,e,t)):(this.rowDrop&&(this.rowDrop=!1,this.$rowHighlightItem.hide()),this.highlightItemToBeReplaced(i)))),!1},T.prototype.onComponentDragOver_moveHighlightItem=function(t,e,i){this.rowDrop=!0,t.removeClass(T.CSS_REPLACING);t=_.parseInt(t.attr("data-gs-x"))*this.columnWidth,t=this.gridstackMargin+t+Math.max(0,Math.floor(i/this.columnWidth)*this.columnWidth),i=Math.min(Math.round(this.recommendedWidth/this.columnWidth)*this.columnWidth,this.columnCount*this.columnWidth-t+this.gridstackMargin);this.colDrop=Math.round((t-this.gridstackMargin)/this.columnWidth),this.colSpanDrop=Math.round(i/this.columnWidth),this.rowSpanDrop=Math.round(this.recommendedHeight/this.usedRowHeight),this.$rowHighlightItem.css({top:e,"margin-left":t,width:i,display:"block"})},T.prototype.onComponentDragEnter=function(t){this.triggerDragEvent(t),this.setVisibility_overlayOnly(!0)},T.prototype.onComponentDragLeave=function(t){this.triggerDragEvent(t),$(t.target).closest(".grid-stack-item").removeClass(T.CSS_REPLACING),this.rowDrop&&(this.rowDrop=!1,this.$rowHighlightItem.hide()),this.isDropping||this.setVisibility_overlayOnly(!1)},T.prototype.onComponentDrop=function(t){var e,i,o,n;return void 0!==t.originalEvent.dataTransfer&&(o=t.originalEvent.dataTransfer.getData("text"),n=this.dashboardAppModel.get("components").get(o),this.userCan("addNew"))&&(n?(this.rowDrop?(this.rowDrop=!1,e=this.rowDropNo,this.$rowHighlightItem.hide()):(n=$(t.currentTarget).attr("data-widgetid"),i=this.findWidgetItem(n),this.dashboardViewModel.set("selectedWidget",null)),this.onComponentDragLeave(t),i?(this.addComponentToWidget(i.model,o,!0),"Fill Dashboard"!==(n=this.expandWidgetsValue)&&"Fill Panel"!==n||this.expandWidgets.addExpandButtonToWidget(i)):this.insertNewWidget(e,this.colDrop,this.rowSpanDrop,this.colSpanDrop,null,o,!1)):(this.$highlightItem.hide(),this.rowDrop=!1,this.$rowHighlightItem.hide())),!1},T.prototype.onComponentDropWrap=function(t,e,i,o,n){var a=t.originalEvent.dataTransfer.getData("text"),t=null==(t=t.originalEvent.dataTransfer.data)?void 0:t.onEnterKey;this.dashboardAppModel.get("components").has(a)&&this.insertNewWidget(e,i,o,n,null,a,!1,t)},T.prototype.onConfigureWidgetsMenuClick=function(t){var e=$(t.target).data("actionid"),t=$(t.target).data("widgetid");t?(t=this.model.get("widgets").get(t))&&(t=this.createUserWidget(t),this.userWidgets.add(t)):e&&"reset"===e&&this.userWidgets.reset(),this.$configureWidgets.removeClass("showing-menu")},T.prototype.onGridstackChange=function(t){t.currentTarget===t.target&&this.updateWidgetsLayout()},T.prototype.onGridstackDragEnter=function(t){this.setDraggedWidgetRecommendedSize(),this.triggerDragEvent(t),this.setVisibility_overlayOnly(!0)},T.prototype.onGridstackDragLeave=function(t){this.triggerDragEvent(t),this.isDropping&&(this.isDropping=!1,this.dashboardAppModel.get("smartDrop")&&this.$highlightItem.hide(),this.rowDrop=!1,this.$rowHighlightItem.hide()),this.setVisibility_overlayOnly(!1)},T.prototype.onGridstackDragOver=function(t,e){return this.triggerDragEvent(t),this.prevX=t.originalEvent.layerX,this.prevY=t.originalEvent.layerY,this.isDropping?this.dashboardAppModel.get("smartDrop")&&this.throttledUpdateHighlightItem(this.prevX,this.prevY):(this.isDropping=!0,this.dashboardAppModel.get("smartDrop")&&this.updateHighlightLayer(),this.dashboardAppModel.get("smartDrop")&&(this.throttledUpdateHighlightItem(this.prevX,this.prevY),this.$highlightItem.show())),this.rowDrop&&(this.rowDrop=!1,this.$rowHighlightItem.hide()),this.setVisibility_overlayOnly(!0),!1},T.prototype.onGridstackDrop=function(t){this.deselectCurrentWidget();var e=parseInt(this.$highlightItem.css("left"),10),i=parseInt(this.$highlightItem.css("top"),10),o=parseInt(this.$highlightItem.css("width"),10),n=parseInt(this.$highlightItem.css("height"),10),i=(this.onGridstackDragLeave(t),Math.round(i/this.gridstack.cellHeight())),e=Math.round(e/this.columnWidth),n=Math.round(n/this.gridstack.cellHeight()),o=Math.round(o/this.columnWidth);return this.onComponentDropWrap(t,i,e,n,o),!1},T.prototype.onMaterialChange=function(){this.documentViewModel.trigger("materialChange")},T.prototype.onPanelDragEvent=function(t){t&&this.dashboardViewModel.get("buildMode")&&(t=$(t.target),_.includes(["Accordion","FlexPanel","Panel","Tabs"],t.closest(".grid-stack-item").data("componentid"))?this.$gridOverlay.hide():(t=t.closest(".worksheet")).length?t.get(0)===this.$worksheet.get(0)?this.$gridOverlay.show():this.$gridOverlay.hide():this.changeOverlayVisibilty())},T.prototype.onPropAdvanced=function(){this.clearPanel_initGridstack(),this.populatePanelWithWidgets()},T.prototype.onRemoveWidget=function(t){this.isUserEditMode()?this.widgetsCollection.remove(t):this.widgetsCollection.commandRemove(t)},T.prototype.onResize=function(t){this.gl&&t&&S.clearWebGLCanvas(this.gl),!this.viewModel.get(T.KEY_ADVANCED)&&this.gridstack?(this.isFillHeight()&&(t=!0,this.setupMinHeight()),t&&(this.gridstack.setAnimation(!1),this.gridstack.batchUpdate(),this.recalculateUsedRowHeight(),this.recalculateColumnWidth(),this.gridstack.cellHeight(this.usedRowHeight),this.updateOverlaySize(),this.gridstack.commit(),this.expandWidgets.getWidgetExpanded()&&this.expandWidgets.applyExpandedAttrs(),this.onResizeWidgets(),this.gridstack.container.outerHeight(),this.gridstack.setAnimation(!0))):this.onResizeWidgets()},T.prototype.onResizeWidgets=function(){_.each(this.widgets,function(t){t.view&&(_.isFunction(t.view.onResize)&&t.view.onResize(!0),_.isFunction(t.view.onResizeStop))&&t.view.onResizeStop(!0)})},T.prototype.onSettingsChange=function(t){var i=this,t=(_.each(t,function(t,e){i.viewModel.set(e,t)}),this.initializePost(),void 0!==t["Basics.EnableWebGLContext"]?this.setWebGLContext():this.gl&&S.resizeCharts(this.widgets,this.gl),t[T.KEY_EXPAND_WIDGETS]);void 0!==t&&(this.expandWidgetsValue=t,this.expandWidgets.updateExpandWidgetsValue(t),this.expandWidgets.onExpandWidgetsChange(t,this.widgets)),this.expandWidgets.getWidgetExpanded()&&this.expandWidgets.applyExpandedAttrs()},T.prototype.getRowCount=function(){return this.rowCount},T.prototype.getColumnCount=function(){return this.columnCount},T.prototype.getWidgets=function(){return this.widgets},T.prototype.getWidgetsCollection=function(){return this.widgetsCollection},T.prototype.isFillHeight=function(){return!!this.expandWidgets.getWidgetExpanded()||this.viewModel.get(T.KEY_RELATIVE_HEIGHT)},T.prototype.onShowConfigureWidgetsMenu=function(){this.$configureWidgets.toggleClass("showing-menu"),this.$configureWidgets.hasClass("showing-menu")&&this.$configureWidgetsMenu.position({of:this.$showConfigureWidgetsMenu,my:"right top",at:"right bottom"})},T.prototype.onUserLayoutReset=function(){this.api&&this.api.saveSetting("layout",""),this.populateUserWidgetsCollection(),this.clearPanel_initGridstack(),this.populatePanelWithWidgets()},T.prototype.onLayoutReset=function(){this.clearPanel_initGridstack(),this.populatePanelWithWidgets()},T.prototype.onScroll=function(t){this.gl?S.resizeCharts(this.widgets,this.gl,!0):this.webGLContextAndCanvas&&S.resizeCharts(this.widgets,this.webGLContextAndCanvas.gl),this.onWidgetsScroll()},T.prototype.onWidgetDraggingStart=function(t,e){e&&e.helper&&e.helper.parent().get(0)===this.$gridstack.get(0)&&(this.setVisibility_overlay_outline(!0),this.disableWidgetSelect())},T.prototype.onWidgetDragging=function(t,e){this.gl&&S.resizeCharts(this.widgets,this.gl)},T.prototype.onWidgetDraggingStop=function(t,e){this.gl&&S.resizeCharts(this.widgets,this.gl),e&&e.helper&&e.helper.parent().get(0)===this.$gridstack.get(0)&&(this.setVisibility_overlay_outline(!1),this.enableWidgetSelect())},T.prototype.onWidgetMouseDown=function(t){t=$(t.currentTarget).attr("data-widgetid");t&&(this.currentActionWidget=this.findWidgetItem(t))},T.prototype.onWidgetGSResizeStop=function(t,e){this.gridstack.setAnimation(!1);var i=_.parseInt($(e).attr("data-gs-width"))*this.gridstack.cellWidth(),e=_.parseInt($(e).attr("data-gs-height"))*this.gridstack.cellHeight();this.currentActionWidget&&this.currentActionWidget.view&&this.currentActionWidget.view.onResize&&(this.currentActionWidget.view.onResize(),this.currentActionWidget.view.onResizeStop&&this.currentActionWidget.view.onResizeStop(i,e),this.currentActionWidget=null),this.gridstack.setAnimation(!0)},T.prototype.onWidgetResize=function(t,e){this.gl&&S.resizeCharts(this.widgets,this.gl)},T.prototype.onWidgetResizeStart=function(t,e){e&&e.element&&e.element.parent().get(0)===this.$gridstack.get(0)&&(this.gridstack.setAnimation(!1),this.setVisibility_overlay_outline(!0),this.disableWidgetSelect(),this.currentActionWidget)&&this.currentActionWidget.view&&this.currentActionWidget.view.onResize&&(this.currentActionWidget.view.onResizeStart&&this.currentActionWidget.view.onResizeStart(),this.currentActionWidget.view.onResize())},T.prototype.onWidgetResizeStop=function(t,e){this.gl&&S.resizeCharts(this.widgets,this.gl),e&&e.element&&e.element.parent().get(0)===this.$gridstack.get(0)&&(this.gridstack.setAnimation(!0),this.setVisibility_overlay_outline(!1),this.dashboardViewModel.get("buildMode"))&&this.enableWidgetSelect()},T.prototype.onWidgetsScroll=function(){_.each(this.widgets,function(t){t.view&&_.isFunction(t.view.onScroll)&&t.view.onScroll()})},T.prototype.onWorksheetClick=function(t){document.querySelector(T.ADVANCED_CSS_WIDGET)||this.isBasePanel&&this.dashboardViewModel.get("buildMode")&&this.deselectCurrentWidget()},T.prototype.onWorksheetDragEnter=function(t){this.setDraggedWidgetRecommendedSize(),this.triggerDragEvent(t),this.setVisibility_overlayOnly(!0)},T.prototype.onWorksheetDragLeave=function(t){this.triggerDragEvent(t),this.isDraggingOverWorksheet&&(this.isDraggingOverWorksheet=!1,this.$worksheetHighlightItem.removeClass("now-over")),this.rowDrop=!1,this.$rowHighlightItem.hide(),this.isDropping||this.setVisibility_overlayOnly(!1)},T.prototype.onWorksheetDragOver=function(t){var e,i,o;return this.triggerDragEvent(t),this.userCan("addNew")&&(this.isFillHeight()?this.isDraggingOverWorksheet||(this.isDraggingOverWorksheet=!0,this.$worksheetHighlightItem.css({"margin-left":this.gridstackMargin,display:"none"}).addClass("now-over")):(this.isDraggingOverWorksheet=!0,t=t.originalEvent.layerX,e=this.gridstackMargin,i=this.usedRowHeight,o=this.columnWidth*this.columnCount,e+=t=Math.max(0,Math.floor((t-e)/this.columnWidth)*this.columnWidth),i=Math.round(this.recommendedHeight/this.usedRowHeight)*this.usedRowHeight,o=Math.min(Math.round(this.recommendedWidth/this.columnWidth)*this.columnWidth,this.columnWidth*this.columnCount-t),this.$worksheetHighlightItem.css({"margin-left":e,display:"block",width:o,height:i}).addClass("now-over")),this.rowDrop)&&(this.rowDrop=!1,this.$rowHighlightItem.hide()),!1},T.prototype.onWorksheetDrop=function(t){if(this.deselectCurrentWidget(),this.isDraggingOverWorksheet){if(this.isDraggingOverWorksheet=!1,this.$worksheetHighlightItem.removeClass("now-over"),this.$worksheetHighlightItem.hide(),this.gridstack&&this.isFillHeight())return!1;var e=this.getMaxRowCount(),i=_.parseInt(this.$worksheetHighlightItem.css("margin-left"))-this.gridstackMargin,i=Math.round(i/this.columnWidth),o=_.parseInt(this.$worksheetHighlightItem.css("height")),o=Math.round(o/this.usedRowHeight)||T.DEFAULT_WIDGET_ROW_SPAN,n=_.parseInt(this.$worksheetHighlightItem.css("width")),n=Math.round(n/this.columnWidth)||Math.ceil(this.columnCount/2);this.onComponentDropWrap(t,e,i,o,n)}return!1},T.prototype.pasteWidget=function(t){var e,i="",o=t.clone(),t=o.get("component").get("definitionId"),n=o.get("component"),a=(this.updateComponentAlias(n),this.pendingNames={},this.dashboardViewModel.get("selectedWidgetView"));if(a)switch(a.model instanceof l.Popup?"Popup":a.model.get("key")){case"Accordion":a.app.pasteWidget(o);break;case"Tabs":n.set("id",o.get("id")),a.app.componentModel.get("components").add(n),o.get("component").setParent(a.app.componentModel.get("components"));break;case"Popup":a.pasteWidget(o);break;case"FlexPanel":case"OverlayPanel":a.app.pasteWidget(o);break;case"Panel":e=a.app;break;default:for(var s=void 0,r=a.model;!s&&(r=r.parent);)s=r.panelView;e=s||this}else e=this;return e&&(e.changeLayout(o)?(i=e.insertNewWidget(null,null,null,null,o,t,!0).widgetId,o.setParent(e.widgetsCollection)):l.ErrorDialog.ShowError("No space available!")),i},T.prototype.updateComponentAlias=function(t){var e=this;_.each(t.get("widgets").models,function(t){e.updateComponentAlias(t.get("component"))}),_.each(t.get("components").models,function(t){e.updateComponentAlias(t)});var i=(t.get("options").get("Basics")?"Basics":"Basic")+".Name",o=t.get("options").get(i);_.isObject(o)||_.isEmpty(o)||(o=this.getNewAliasName(t,i,o),t.get("options").set(i,o))},T.prototype.getNewAliasName=function(t,e,i){var o=t.get("key"),t=this.dashboardAppModel.get("documents").get(this.dashboardViewModel.get("selectedDocumentId")).getComponents(),n=_.filter(t,function(t){return t.get("key")===o}),a=!0,s=1,t=i.match(/^(.+ copy)( \(\d+\))?$/);for(t?i=t[1]:i+=" copy";a;)n.some(function(t){return t.get("options").get(e)===(1<s?i+" ("+s+")":i)})||this.pendingNames[o]&&_.includes(this.pendingNames[o],1<s?i+" ("+s+")":i)?s+=1:(a=!1,1<s&&(i+=" ("+s+")"));return this.pendingNames[o]?this.pendingNames[o].push(i):this.pendingNames[o]=[i],i},T.prototype.populatePanelWithWidgets=function(){var e=this,t=this.getRepeatablePanels(),i=this.widgetsCollection.sortBy(function(t){t=t.get("layout");return 1e3*t.get("row")+t.get("column")});this.gridstack&&this.gridstack.batchUpdate(),this.ignoreGridstackEvents=!0,_.each(i,function(t){e.viewModel.get(T.REPEATABLE)||e.addWidget(t,!0,null)}),this.ignoreGridstackEvents=!1,this.gridstack&&(this.gridstack.commit(),_.defer(function(){e.gridstack&&e.gridstack.setAnimation(!0)})),t&&t.length&&this.duplicateRepeatableComponents(t)},T.prototype.populateUserWidgetsCollection=function(){var i=this,e=this.api.loadSetting("layout");try{e=JSON.parse(e)}catch(t){e=null}e=e?_.pick(e,i.model.get("widgets").map(function(t){return t.id})):this.generateUserLayout(this.model.get("widgets")),_.isEmpty(e)?this.debouncedRenderConfigureWidgetsMenu():_.each(e,function(t,e){var e=i.model.get("widgets").get(e);e&&(e=i.createUserWidget(e,{row:t.row,column:t.column,rowSpan:t.rowSpan,colSpan:t.colSpan}),i.userWidgets.add(e))})},T.prototype.recalculateUsedRowHeight=function(){this.viewModel.get(T.KEY_ADVANCED)?this.usedRowHeight=null:this.isFillHeight()?this.usedRowHeight=(this.$worksheet.height()-2*this.gridstackMargin)/this.rowCount:this.usedRowHeight=this.viewModel.get(T.KEY_ROW_HEIGHT)},T.prototype.recalculateColumnWidth=function(){this.columnWidth=(this.$worksheet.width()-2*this.gridstackMargin)/this.columnCount},T.prototype.recreateGridStackPanel=function(){this.$gridstack=$(document.createElement("div")),this.$gridstack.addClass("grid-stack"),this.$gridOverlay=$(document.createElement("div")).addClass("grid-stack-overlay").appendTo(this.$gridstack).hide(),this.changeOverlayVisibilty(),this.$gridstack.prependTo(this.$worksheet)},T.prototype.removeAllRepeatableDataModels=function(){var i=this;_.get(this,"dataModel.attributes")&&_.each(this.dataModel.attributes,function(t,e){0<=e.indexOf("_repeatable")&&(i.dataModel.removeSubscriptions(t),i.dataModel.unset(e))})},T.prototype.remove=function(){var t;this.stopListening(),this.$worksheet.off(),this.$showConfigureWidgetsMenu.off(),this.$configureWidgetsMenu.off(),this.$gridstack.off(),this.removeAllRepeatableDataModels(),this.clearWidgets(),this.removeGridstack(!0),null!=(t=this.webGLContextAndCanvas)&&t.elements&&-1<(t=this.webGLContextAndCanvas.elements.indexOf(this.el))&&this.webGLContextAndCanvas.elements.splice(t,1),this.isBasePanel&&(this.onPanelDragEvent_throttled.cancel(),$(window).off("dragover",this.triggerDragEvent)),A.View.prototype.remove.apply(this)},T.prototype.removeGridstack=function(t){this.gridstack&&(this.gridstack.destroy(),this.gridstack=null,this.$gridstack.remove(),T.gsStyleManager.remove(this.columnCount),t||this.recreateGridStackPanel())},T.prototype.removeWidget=function(t){var e;t&&(_.pull(this.widgets,t),this.userCan("addNew")&&this.widgets.length<=0&&this.$noWidgetsInfo.show(),t.$widget.css({border:"none",background:"none","box-shadow":"none","pointer-events":"none"}),t.view&&t.view.remove&&t.view.remove(),t.$widget.off(),"Fill Dashboard"!==(e=this.expandWidgetsValue)&&"Fill Panel"!==e||this.expandWidgets.removeExpandButtonFromWidget(t),this.gridstack?(this.ignoreGridstackEvents=!0,this.gridstack.removeWidget(t.$widget),this.ignoreGridstackEvents=!1):t.$widget.remove())},T.prototype.postRender=function(){return this.$el.addClass("panel"),this.$el.html(D.app()),this.$worksheet=this.$el.find("> .worksheet"),this.$gridstack=this.$worksheet.find("> .grid-stack"),this.$worksheetHighlightItem=this.$worksheet.find("> .worksheet-highlight-item"),this.$rowHighlightItem=this.$worksheet.find("> .row-highlight-item"),this.$gridOverlay=this.$gridstack.find("> .grid-stack-overlay").hide(),this.$highlightLayer=this.$worksheet.find("> .highlight-viewport > .highlight-layer"),this.$highlightItem=this.$highlightLayer.find("> .highlight-item"),this.$configureWidgets=this.$el.find("> .configure-widgets"),this.$configureWidgetsMenu=this.$configureWidgets.find("> .configure-widgets-menu"),this.$showConfigureWidgetsMenu=this.$configureWidgets.find("> .show-configure-menu"),this.$noWidgetsInfo=this.$worksheet.find("> .no-widgets-info"),this.$configureWidgetsMenu.menu({items:"> :not(.ui-widget-header)"}),this},T.prototype.renderComponent=function(t,e,i,o,n){e=this.createComponentView(t,e,i,o,n),this.trackWidgetModelChanges(t.model),i=$("<div/>",{class:"grid-stack-item-content"}).append(e.$el);t.$widget.append(i)},T.prototype.renderConfigureWidgetsMenu=function(){var t,e=this;this.isUserEditMode()&&(t=this.model.get("widgets").reject(function(t){return e.userWidgets.has(t)}),this.$configureWidgets.toggleClass("widgets-available",!_.isEmpty(t)),this.$configureWidgetsMenu.html(D.configureWidgetsMenu({widgets:_.map(t,function(t){var e=t.get("component").get("options"),i=(e.get("Basics")?e.get("Basics"):e.get("Basic")).Name,o="BasicComponents"===t.get("component").get("key")?e.get("Basics.ComponentName"):t.get("component").get("key");return{id:t.id,name:e.get("format.widgetTitle")||i||o}})})),this.$configureWidgetsMenu.menu("refresh"))},T.prototype.renderWidget=function(t){var e,t=t.get("layout"),i=t.get("row"),o=t.get("column"),n=t.get("rowSpan"),t=t.get("colSpan");return(_.isNaN(i)||_.isNaN(o))&&(o=i=null),n&&t||(n=T.DEFAULT_WIDGET_ROW_SPAN,t=Math.ceil(this.columnCount/2)),this.viewModel.get(T.KEY_ADVANCED)?(e=$('<div class="advanced-item">'),void 0!==o&&e.attr("data-gs-x",o),void 0!==i&&e.attr("data-gs-y",i),void 0!==t&&e.attr("data-gs-width",t),void 0!==n&&e.attr("data-gs-height",n),this.$gridstack.append(e),this.quickView||this.initSortable()):e=this.gridstack.addWidget("<div/>",o,i,t,n,_.isNil(o)||_.isNil(i)),e},T.prototype.set_columnCount=function(){this.columnCount=this.viewModel.get(T.KEY_COLUMN_COUNT)},T.prototype.set_rowCount=function(){this.rowCount=this.viewModel.get(T.KEY_ROW_COUNT)},T.prototype.setDraggedWidgetRecommendedSize=function(){var t=this.dashboardAppModel.get("draggedComponentId"),t=this.dashboardAppModel.get("components").get(t),t=_.get(t,"attributes.size",[300,200]);this.recommendedWidth=t[0],this.recommendedHeight=t[1]},T.prototype.setExpandWidgetsValue=function(t){this.expandWidgetsValue=t},T.prototype.setWebGLContext=function(){var t=this.api.getProperty("Basics.EnableWebGLContext");if(t&&!this.gl||!t&&this.gl){if(t){if(this.canvas=S.createWebGLCanvas(this.el),this.gl=S.createWebGLContext(this.canvas),S.validateWebGL(this.gl),!this.gl)return}else S.clearWebGLCanvas(this.gl),this.gl=null,this.el.getElementsByClassName("webgl-panel-wrapper")[0].removeChild(this.canvas),this.canvas=null;S.updateChartsWebGLContext(this.widgets,this.gl,this.canvas,[this.el])}},T.prototype.setupGetGridHeight=function(){var t=this,e=this.isFillHeight();this.gridstack&&(e?(this.gridstack.grid.getGridHeight=function(){return t.rowCount},this.gridstack.grid.height=this.rowCount):(this.gridstack.grid.getGridHeight=window.GridStackUI.Engine.prototype.getGridHeight,this.gridstack.grid.height=0))},T.prototype.setupMinHeight=function(){},T.prototype.setVisibility_overlayOnly=function(t){!this.dashboardViewModel.get("buildMode")||(t?this.$gridOverlay.show():this.$gridOverlay.hide())},T.prototype.setVisibility_overlay_outline=function(t){this.$gridstack.removeClass("outlinedLocal"),t?(this.$gridstack.addClass("outlinedLocal"),this.$gridOverlay.show()):this.changeOverlayVisibilty()},T.prototype.stopTrackingWidgetChanges=function(t){t=t.model;this.stopListening(t.get("layout"),"change"),this.stopListening(t.get("component").get("options"),"change")},T.prototype.switchOffBuildMode=function(t){this.gridstack&&this.gridstack.disable(),this.$el.removeClass("user-configurable"),this.disableWidgetSelect(),this.$gridstack.find("> div").addClass("build-off"),this.viewModel.get("Basics.Advanced")&&this.$gridstack.sortable("instance")&&this.$gridstack.sortable("destroy"),this.dashboardAppModel.set("showBreadcrumbs",!1),this.isUserEditMode()&&t&&(t=this.generateUserLayout(this.widgetsCollection),_.isEqual(t,this.api.loadSetting("layout"))||(this.api.saveSetting("layout",JSON.stringify(t)),this.dashboardViewModel.trigger("widgets-configured")),this.$configureWidgets.removeClass("showing-menu"))},T.prototype.switchOnBuildMode=function(t){var e=this;this.userCan("layout")&&(this.gridstack&&this.gridstack.enable(),this.$el.addClass("user-configurable")),this.userCan("select")&&this.enableWidgetSelect(),this.viewModel.get("Basics.Advanced")&&this.initSortable(),this.dashboardAppModel.set("showBreadcrumbs",!0),this.userCan("configure")&&setTimeout(function(){e.$gridstack.find("> div").removeClass("build-off")},100)},T.prototype.trackWidgetModelChanges=function(n){var a=this;this.listenTo(n.get("layout"),"change",function(t){a.gridstack&&a.gridstack.setAnimation(!1);var e=_.find(a.widgets,{widgetId:n.id}),i=null==e?void 0:e.$widget,o=t.attributes;a.ignoreGridstackEvents=!0,a.gridstack&&a.gridstack.update(i,o.column,o.row,o.colSpan,o.rowSpan),a.ignoreGridstackEvents=!1,(t.hasChanged("colSpan")||t.hasChanged("rowSpan"))&&_.hasIn(e,"view.app.onResize")&&e.view.app.onResize(),_.defer(function(){a.gridstack&&a.gridstack.setAnimation(!0)})})},T.prototype.triggerDragEvent=function(t){this.dashboardViewModel.trigger("onPanelDragEvent",t)},T.prototype.updateHighlightItem=function(o,n){var t=this.$gridstack,e=t.width(),i=t.height(),t=t.find("> .grid-stack-item"),a=[],s=[],r=[],d=[];a.push(0),r.push(0),s.push(e),d.push(i),_.each(t,function(t){var t=$(t),e=t.position(),i=e.left+(t?t.width():0),t=e.top+(t?t.height():0),e={top:e.top,left:e.left,right:i,bottom:t};e.top<n?r.push(e.top):n<e.top&&d.push(e.top),e.bottom<n?r.push(e.bottom):n<e.bottom&&d.push(e.bottom)}),r=_.max(r),d=_.min(d),_.each(t,function(t){var t=$(t),e=t.position(),i=e.left+(t?t.width():0),t=e.top+(t?t.height():0),e={top:e.top,left:e.left,right:i,bottom:t};(d<e.bottom&&e.top<d||e.top<r&&r<e.bottom||r<e.top&&e.bottom<d||e.top<r&&d<e.bottom||e.top===r&&e.bottom===d)&&(e.left<o?a.push(e.left):o<e.left&&s.push(e.left),e.right<o?a.push(e.right):o<e.right&&s.push(e.right))}),a=_.max(a),s=_.min(s),a=Math.max(0,Math.floor(o/this.columnWidth)*this.columnWidth),s=Math.min(s,a+Math.max(1,Math.round(this.recommendedWidth/this.columnWidth))*this.columnWidth),this.viewModel.get(T.KEY_FLOATABLE)&&(r=Math.floor(n/this.usedRowHeight)*this.usedRowHeight),d=Math.min(d,r+Math.max(1,Math.round(this.recommendedHeight/this.usedRowHeight))*this.usedRowHeight),this.$highlightItem.css({left:a,width:s-a,top:r,height:d-r})},T.prototype.updateHighlightLayer=function(){var t={top:0,left:0},e=this.$gridstack.position();t.top+=this.gridstackMargin,t.left+=e.left+this.gridstackMargin,t.top+=parseInt(this.$gridstack.parent().css("margin-top")),t.left+=parseInt(this.$gridstack.parent().css("margin-left")),this.$highlightLayer&&this.$highlightLayer.css({"margin-top":t.top,"margin-left":t.left,width:this.$gridstack.width(),height:this.$gridstack.height()})},T.prototype.updateOverlaySize=function(){this.$gridOverlay.css({"background-size":"".concat(100/this.columnCount,"% ").concat(this.usedRowHeight,"px")})},T.prototype.updateWebGLContext=function(t,e,i){i=i.concat(this.el);this.webGLContextAndCanvas=t&&e?{gl:t,canvas:e,elements:i}:void 0,S.updateChartsWebGLContext(this.widgets,t,e,i)},T.prototype.updateWidgetsLayout=function(e){this.ignoreGridstackEvents||this.isUserEditMode()?_.each(this.widgets,function(t){t.model.get("layout").set({row:parseInt(t.$widget.attr("data-gs-y"),10),column:parseInt(t.$widget.attr("data-gs-x"),10),rowSpan:parseInt(t.$widget.attr("data-gs-height"),10),colSpan:parseInt(t.$widget.attr("data-gs-width"),10)},{silent:e||!1})}):this.widgetsCollection.commandSet(_.map(this.widgets,function(t){return{id:t.model.id,layout:{row:parseInt(t.$widget.attr("data-gs-y"),10),column:parseInt(t.$widget.attr("data-gs-x"),10),rowSpan:parseInt(t.$widget.attr("data-gs-height"),10),colSpan:parseInt(t.$widget.attr("data-gs-width"),10)}}}),{silent:e||!1})},T.prototype.upgradeGridsterLayout=function(){var t=this.widgetsCollection.map(function(t){return t.get("layout")});this.viewModel.get(T.KEY_FLOATABLE)||_.some(t,function(t){return 0===t.get("row")||0===t.get("column")})||_.each(t,function(t){t.set("row",t.get("row")-1),t.set("column",t.get("column")-1)})},T.prototype.userCan=function(t){var e=!1;return e=this.dashboardViewModel.get("buildMode")&&(!this.quickView||this.isUserEditMode()&&!_.includes(["addNew","select"],t))?!0:e},T.prototype.updateDataSource=function(t,e){var i,n,a=this,o=[],o="ChartGL"===(null==t?void 0:t.get("component")).get("key")?null==(i=null==(i=null==t?void 0:t.get("component"))?void 0:i.get("options"))?void 0:i.get("Layers"):[null==(i=null==(i=null==t?void 0:t.get("component"))?void 0:i.get("options"))?void 0:i.get("Basics")];return Array.isArray(o)&&(i=this.api.getProperty(T.REPEATABLE_VIEWSTATE),n=null==i?void 0:i[e],o.forEach(function(t){var e=(null==(e=null==t?void 0:t.Data)?void 0:e.path)||(null==(e=null==t?void 0:t.Data)?void 0:e.value),i="string"!=typeof(i="_repeatable_".concat(e,"_").concat(n))?"":i.replace(/[^a-zA-Z0-9 _-]/g,"").slice(0,100),o=a.dataModel.get(i);e&&(o=o||a.dataModel.getByPath(e).clone())&&(e=o.get("_queryString")||"",o.path=i,o.set("_queryString",function(t,e){e=String(e).replace(/"/g,'\\"');return t.replace(/\$repeatViewstate/g,'`$"'.concat(e,'"'))}(e,n)),a.dataModel.set(i,o),_.get(t,"Data.value")?t.Data.value=i:t.Data=o)}),null!=(i=t.get("component")))&&i.trigger(),t},T.prototype.getRepeatablePanels=function(){var t,e=this,i=[],o=this.model.get("options"),n="Panel"===this.model.get("key"),a=null==o?void 0:o.get(T.REPEATABLE_VIEWSTATE),o=(null==o?void 0:o.get(T.REPEATABLE))&&a;return n&&(n=a?null==a?void 0:a.get("value"):[],null!=(a=this.widgetsCollection)&&a.models.filter(function(t){return t.get("Repeated")}).forEach(function(t){return e.widgetsCollection.remove(t)}),0!==n.length)&&(t=(null==(a=this.widgetsCollection)?void 0:a.models)||[],o)&&n.forEach(function(){t.forEach(function(t){_.isNil(t.get("Repeated"))&&i.push(t)})}),i},T.prototype.duplicateRepeatableComponents=function(t){var a=this,s=0,r=0,d=this.viewModel.get(T.KEY_COLUMN_COUNT),h=this.viewModel.get(T.KEY_ROW_COUNT),e=null==(e=this.api.getProperty("Basics"))?void 0:e.RepeatableViewstate;(null==e?void 0:e.get)&&"list"===e.get("_type")&&Array.isArray(t)&&t.forEach(function(t,e){var i=a.viewModel.get(T.REPEATABLE_VIEWSTATE)[e],o=t.get("layout"),n=o.get("colSpan"),o=o.get("rowSpan");d<r+n&&(r=0,s+=o),d<r+n||h<s+o?l.ErrorDialog.ShowError("No space available!"):((t=t.clone()).get("layout").set({colSpan:n,rowSpan:o,row:s,column:r}),t.set("Repeated",i),i=null==(o=t.get("component"))?void 0:o.get("definitionId"),o=a.insertNewWidget(null,null,null,null,t,i,!0,!1),"Panel"===(null==(i=t.get("component"))?void 0:i.get("key"))?t.get("component").get("widgets").models.forEach(function(t){return a.updateDataSource(t,e)}):a.updateDataSource(o.model,e),o.model.setParent(a.widgetsCollection),r+=n)})},T.getComponentDefinition=t.getComponentDefinition,T.KEY_RELATIVE_HEIGHT="Basics.RelativeHeight",T.KEY_FLOATABLE="Basics.Floatable",T.KEY_ADVANCED="Basics.Advanced",T.KEY_USER_LAYOUT="Basics.UserLayout",T.KEY_COLUMN_COUNT="Basics.ColCount",T.KEY_ROW_COUNT="Basics.RowCount",T.KEY_ROW_HEIGHT="Basics.RowHeight",T.REPEATABLE="Basics.Repeatable",T.REPEATABLE_VIEWSTATE="Basics.RepeatableViewstate",T.CSS_REPLACING="replacing",T.ADVANCED_CSS_WIDGET=".ui-widget-content > .ui-widget-header  >.fa-css3",T.KEY_EXPAND_WIDGETS="Basics.ExpandWidgets",T.DEFAULT_ROW_COUNT_IN_FILL_HEIGHT_MODE=24,T.DEFAULT_ROW_HEIGHT_IN_NON_FILL_HEIGHT_MODE=25,T.DEFAULT_WIDGET_ROW_SPAN=12,T.gsStyleManager=new P;var dt,N=T;function T(t){t=dt.call(this,t)||this;return t.dropdownValues=null,t.selected=null,t.settingsModel=null,t.rowDropNo=0,t.isInitialized=!1,t.pendingNames={},t.initializeBasePanel=null,t.gl=null,t.canvas=null,t.expandWidgetsValue="None",t}return N});