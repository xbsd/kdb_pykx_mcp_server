define(["backbone","Datagrid","Handlebars","log","QuickBase","css!./css/app.css"],function(i,t,e,o,n){"use strict";var l,s=this&&this.__extends||(l=function(e,t){return(l=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}l(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,i=1,o=arguments.length;i<o;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},a=(d.app=e.template({compiler:[8,">= 4.3.0"],main:function(e,t,i,o,n){var l=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="container">\n    <div class="header">\n        <button class="upload">'+e.escapeExpression((l(i,"t")||t&&l(t,"t")||e.hooks.helperMissing).call(null!=t?t:e.nullContext||{},"Upload",{name:"t",hash:{},data:n,loc:{start:{line:3,column:31},end:{line:3,column:45}}}))+'</button>\n    </div>\n    <div class="files-container">\n        <div class="files-scroll">\n            <div class="files-view"></div>\n        </div>\n        <form action="/upload-target" enctype="multipart/form-data" action="POST" class="dropzone"></form>\n    </div>\n</div>'},useData:!0}),d.appLite=e.template({compiler:[8,">= 4.3.0"],main:function(e,t,i,o,n){var l,s=null!=t?t:e.nullContext||{},r=e.hooks.helperMissing,a="function",d=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<iframe class="light" style="width:100%;height:100%;" frameborder="0" src="'+d(typeof(l=null!=(l=e(i,"server")||(null!=t?e(t,"server"):t))?l:r)==a?l.call(s,{name:"server",hash:{},data:n,loc:{start:{line:1,column:75},end:{line:1,column:85}}}):l)+d(typeof(l=null!=(l=e(i,"port")||(null!=t?e(t,"port"):t))?l:r)==a?l.call(s,{name:"port",hash:{},data:n,loc:{start:{line:1,column:85},end:{line:1,column:93}}}):l)+"/?theme="+d(typeof(l=null!=(l=e(i,"theme")||(null!=t?e(t,"theme"):t))?l:r)==a?l.call(s,{name:"theme",hash:{},data:n,loc:{start:{line:1,column:101},end:{line:1,column:110}}}):l)+'"> </iframe>'},useData:!0}),d.fileListIcon=e.template({1:function(e,t,i,o,n){var l=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="icon"><i class="fa '+e.escapeExpression("function"==typeof(i=null!=(i=l(i,"icon")||(null!=t?l(t,"icon"):t))?i:e.hooks.helperMissing)?i.call(null!=t?t:e.nullContext||{},{name:"icon",hash:{},data:n,loc:{start:{line:1,column:43},end:{line:1,column:51}}}):i)+'"></i></div>'},3:function(e,t,i,o,n){var l,s=null!=t?t:e.nullContext||{},r=e.hooks.helperMissing,a="function",d=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="last-modified"><span  title="'+d(typeof(l=null!=(l=e(i,"lastModifiedMoment")||(null!=t?e(t,"lastModifiedMoment"):t))?l:r)==a?l.call(s,{name:"lastModifiedMoment",hash:{},data:n,loc:{start:{line:4,column:67},end:{line:4,column:89}}}):l)+'"><i class="fa fa-clock-o"></i> '+d(typeof(l=null!=(l=e(i,"lastModifiedMoment")||(null!=t?e(t,"lastModifiedMoment"):t))?l:r)==a?l.call(s,{name:"lastModifiedMoment",hash:{},data:n,loc:{start:{line:4,column:121},end:{line:4,column:143}}}):l)+"</span></div>"},compiler:[8,">= 4.3.0"],main:function(e,t,i,o,n){var l,s,r=null!=t?t:e.nullContext||{},a=e.hooks.helperMissing,d="function",p=e.escapeExpression,c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return(null!=(l=c(i,"if").call(r,null!=t?c(t,"icon"):t,{name:"if",hash:{},fn:e.program(1,n,0),inverse:e.noop,data:n,loc:{start:{line:1,column:0},end:{line:1,column:70}}}))?l:"")+'\n<div class="name"><span title="'+p(typeof(s=null!=(s=c(i,"name")||(null!=t?c(t,"name"):t))?s:a)==d?s.call(r,{name:"name",hash:{},data:n,loc:{start:{line:2,column:31},end:{line:2,column:39}}}):s)+'">'+p(typeof(s=null!=(s=c(i,"name")||(null!=t?c(t,"name"):t))?s:a)==d?s.call(r,{name:"name",hash:{},data:n,loc:{start:{line:2,column:41},end:{line:2,column:49}}}):s)+'</span></div>\n<div class="size"><span title="'+p(typeof(s=null!=(s=c(i,"size")||(null!=t?c(t,"size"):t))?s:a)==d?s.call(r,{name:"size",hash:{},data:n,loc:{start:{line:3,column:31},end:{line:3,column:39}}}):s)+'">'+p(typeof(s=null!=(s=c(i,"size")||(null!=t?c(t,"size"):t))?s:a)==d?s.call(r,{name:"size",hash:{},data:n,loc:{start:{line:3,column:41},end:{line:3,column:49}}}):s)+"</span></div>\n"+(null!=(l=c(i,"if").call(r,null!=t?c(t,"lastModifiedMoment"):t,{name:"if",hash:{},fn:e.program(3,n,0),inverse:e.noop,data:n,loc:{start:{line:4,column:0},end:{line:4,column:163}}}))?l:"")+'\n<div class="directory"><span title="'+p(typeof(s=null!=(s=c(i,"directory")||(null!=t?c(t,"directory"):t))?s:a)==d?s.call(r,{name:"directory",hash:{},data:n,loc:{start:{line:5,column:36},end:{line:5,column:49}}}):s)+'"><i class="fa fa-folder-o"></i> '+p(typeof(s=null!=(s=c(i,"directory")||(null!=t?c(t,"directory"):t))?s:a)==d?s.call(r,{name:"directory",hash:{},data:n,loc:{start:{line:5,column:82},end:{line:5,column:95}}}):s)+'</span></div>\n<div class="actions"></div>'},useData:!0}),d.fileListStatus=e.template({1:function(e,t,i,o,n){var l,s=null!=t?t:e.nullContext||{},r=e.hooks.helperMissing,a="function",d=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'    <span class="file-error">\n        <i class="fa fa-warning" title="'+d(typeof(l=null!=(l=e(i,"errorMessage")||(null!=t?e(t,"errorMessage"):t))?l:r)==a?l.call(s,{name:"errorMessage",hash:{},data:n,loc:{start:{line:3,column:40},end:{line:3,column:56}}}):l)+'"></i>\n    </span>\n    <i class="clear-file fa fa-times-circle" title="'+d((e(i,"t")||t&&e(t,"t")||r).call(s,"Clear",{name:"t",hash:{},data:n,loc:{start:{line:5,column:52},end:{line:5,column:65}}}))+'" data-filename="'+d(typeof(l=null!=(l=e(i,"name")||(null!=t?e(t,"name"):t))?l:r)==a?l.call(s,{name:"name",hash:{},data:n,loc:{start:{line:5,column:82},end:{line:5,column:90}}}):l)+'"></i>\n'},3:function(e,t,i,o,n){var l=null!=t?t:e.nullContext||{},s=e.hooks.helperMissing,r=e.escapeExpression,e=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'    <i class="download-file fa fa-download" title="'+r((e(i,"t")||t&&e(t,"t")||s).call(l,"Download",{name:"t",hash:{},data:n,loc:{start:{line:8,column:51},end:{line:8,column:67}}}))+'" data-filename="'+r("function"==typeof(r=null!=(r=e(i,"name")||(null!=t?e(t,"name"):t))?r:s)?r.call(l,{name:"name",hash:{},data:n,loc:{start:{line:8,column:84},end:{line:8,column:92}}}):r)+'"></i>\n'},5:function(e,t,i,o,n){return"    <span>Queued</span>\n"},7:function(e,t,i,o,n){var l=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'    <span class="file-progress ui-widget-content">\n        <span class="file-progress-bar" style="width: 0%"></span>\n        <i class="cancel-upload fa fa-times-circle" title="'+e.escapeExpression((l(i,"t")||t&&l(t,"t")||e.hooks.helperMissing).call(null!=t?t:e.nullContext||{},"Cancel",{name:"t",hash:{},data:n,loc:{start:{line:16,column:59},end:{line:16,column:73}}}))+'"></i>\n    </span>\n'},9:function(e,t,i,o,n){var l=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'    <span class="upload-success"><i class="fa fa-tick"></i> '+e.escapeExpression((l(i,"t")||t&&l(t,"t")||e.hooks.helperMissing).call(null!=t?t:e.nullContext||{},"Upload successful",{name:"t",hash:{},data:n,loc:{start:{line:20,column:60},end:{line:20,column:85}}}))+"</span>\n"},compiler:[8,">= 4.3.0"],main:function(e,t,i,o,n){var l,s=null!=t?t:e.nullContext||{},r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return(null!=(l=r(i,"if").call(s,null!=t?r(t,"hasError"):t,{name:"if",hash:{},fn:e.program(1,n,0),inverse:e.noop,data:n,loc:{start:{line:1,column:0},end:{line:6,column:7}}}))?l:"")+(null!=(l=r(i,"if").call(s,null!=t?r(t,"isDownloadable"):t,{name:"if",hash:{},fn:e.program(3,n,0),inverse:e.noop,data:n,loc:{start:{line:7,column:0},end:{line:9,column:7}}}))?l:"")+(null!=(l=r(i,"if").call(s,null!=t?r(t,"isQueued"):t,{name:"if",hash:{},fn:e.program(5,n,0),inverse:e.noop,data:n,loc:{start:{line:10,column:0},end:{line:12,column:7}}}))?l:"")+(null!=(l=r(i,"if").call(s,null!=t?r(t,"isUploading"):t,{name:"if",hash:{},fn:e.program(7,n,0),inverse:e.noop,data:n,loc:{start:{line:13,column:0},end:{line:18,column:7}}}))?l:"")+(null!=(l=r(i,"if").call(s,null!=t?r(t,"wasSuccess"):t,{name:"if",hash:{},fn:e.program(9,n,0),inverse:e.noop,data:n,loc:{start:{line:19,column:0},end:{line:21,column:7}}}))?l:"")},useData:!0}),d);function d(){}var p={UserDefined:{type:"boolean",title:"User Defined",format:"checkbox",default:!1},Field:{title:"Data Field Name",type:"customDropdown",default:"",data:"possible_columns",watch:{possible_columns:"root.possibleColumns"}},DisplayName:{title:"Display Name",type:"string",default:""},Sortable:{type:"boolean",format:"checkbox",default:!0,options:{hidden:!0}},Format:{type:"string",enum:["General","Number","Formatted Number","Smart Number","Date","Time","DateTime","Percentage","Boolean"],default:"General"},Precision:{type:"number",title:"Precision",format:"number",minimum:0,maximum:10,default:2},HideTrailingZeroes:{type:"boolean",title:"Hide Trailing Zeroes",format:"checkbox",default:!1},Currency:{title:"Currency Symbol",type:"string",enum:["none","USD","GBP","EUR"],default:"none"},DateFormat:{title:"Date Format",type:"string",enum:n.Tools.Formats.Date,default:"YYYY-MM-DD"},TimeFormat:{title:"Time Format",type:"string",enum:n.Tools.Formats.Time,default:"HH:mm:ss"},HighlightNegativeColor:{options:{noColor:!0},type:"gradient",title:"Negative Color",default:""},HighlightChanges:{type:"boolean",title:"Highlight Changes",format:"checkbox",default:!1},HighlightChangeDuration:{title:"Highlight Change Duration",minimum:50,maximum:1e3,type:"number",step:10,format:"range",default:200},ShowArrowsOnChange:{type:"boolean",title:"Show arrows on Change",format:"checkbox",default:!1},HighlightMinValueColor:{options:{noColor:!0},type:"gradient",title:"Min Value Color",default:""},HighlightMaxValueColor:{options:{noColor:!0},type:"gradient",title:"Max Value Color",default:""},RangeHighlightColor:{options:{noColor:!0},type:"gradient",title:"Range Color",default:""},WidthWeight:{title:"Width (relative)",minimum:0,type:"number",default:1},MinWidthAbsolute:{title:"Min Width (px)",minimum:0,type:"number",default:1},PercentageColorOverride:{type:"gradient",default:"#606060",title:"Percentage Color"},IsReadonly:{type:"boolean",title:"Read Only",format:"checkbox",default:!1},TextAlign:{title:"Text Align",type:"string",enum:["left","center","right"],default:"center"},Template:{type:"handlebar",data:[],default:""},Hidden:{type:"boolean",format:"checkbox",default:!1}},c=(_.each(["UserDefined","Field","DisplayName","WidthWeight","MinWidthAbsolute","TextAlign","Sortable","Format","Precision","HideTrailingZeroes","Currency","DateFormat","TimeFormat","HighlightNegativeColor","HighlightChanges","HighlightChangeDuration","ShowArrowsOnChange","HighlightMinValueColor","HighlightMaxValueColor","RangeHighlightColor","PercentageColorOverride","IsReadonly","Template","Hidden"],function(e,t){p[e].propertyOrder=1010+t}),[{UserDefined:!1,Field:"name",DisplayName:"Name",Sortable:!0,Format:"General",Precision:0,HideTrailingZeroes:!1,Currency:"none",DateFormat:"YYYY-MM-DD",TimeFormat:"HH:mm:ss.SSS",HighlightNegativeColor:"",HighlightChanges:!1,HighlightChangeDuration:200,ShowArrowsOnChange:!1,HighlightMinValueColor:"",HighlightMaxValueColor:"",RangeHighlightColor:"",WidthWeight:1,MinWidthAbsolute:110,PercentageColorOverride:"#93DF93",IsReadonly:!1,TextAlign:"left",Template:'{{#if icon}}<i class="fa {{icon}} icon"></i>{{/if}} {{name}}',Hidden:!1},{UserDefined:!1,Field:"size",DisplayName:"Size",Sortable:!0,Format:"Formatted Number",Precision:0,HideTrailingZeroes:!1,Currency:"none",DateFormat:"YYYY-MM-DD",TimeFormat:"HH:mm:ss",HighlightNegativeColor:"",HighlightChanges:!1,HighlightChangeDuration:200,ShowArrowsOnChange:!1,HighlightMinValueColor:"",HighlightMaxValueColor:"",RangeHighlightColor:"",WidthWeight:1,MinWidthAbsolute:110,PercentageColorOverride:"#93DF93",IsReadonly:!1,TextAlign:"center",Template:"",Hidden:!1},{UserDefined:!1,Field:"lastModified",DisplayName:"Last Modified",Sortable:!0,Format:"DateTime",Precision:2,HideTrailingZeroes:!1,Currency:"none",DateFormat:"YYYY-MM-DD",TimeFormat:"HH:mm:ss",HighlightNegativeColor:"",HighlightChanges:!0,HighlightChangeDuration:200,ShowArrowsOnChange:!1,HighlightMinValueColor:"",HighlightMaxValueColor:"",RangeHighlightColor:"",WidthWeight:1,MinWidthAbsolute:100,PercentageColorOverride:"#93DF93",IsReadonly:!1,TextAlign:"center",Template:"",Hidden:!1},{UserDefined:!1,Field:"directory",DisplayName:"Directory",Sortable:!0,Format:"General",Precision:5,HideTrailingZeroes:!1,Currency:"none",DateFormat:"YYYY-MM-DD",TimeFormat:"HH:mm:ss",HighlightNegativeColor:"",HighlightChanges:!0,HighlightChangeDuration:200,ShowArrowsOnChange:!1,HighlightMinValueColor:"",HighlightMaxValueColor:"",RangeHighlightColor:"",WidthWeight:1,MinWidthAbsolute:70,PercentageColorOverride:"#93DF93",IsReadonly:!1,TextAlign:"center",Template:"",Hidden:!1},{UserDefined:!0,Field:"status",DisplayName:"",Sortable:!0,Format:"General",Precision:0,HideTrailingZeroes:!1,Currency:"none",DateFormat:"YYYY-MM-DD",TimeFormat:"HH:mm:ss",HighlightNegativeColor:"",HighlightChanges:!0,HighlightChangeDuration:200,ShowArrowsOnChange:!1,HighlightMinValueColor:"",HighlightMaxValueColor:"",RangeHighlightColor:"",WidthWeight:1,MinWidthAbsolute:70,PercentageColorOverride:"#93DF93",IsReadonly:!1,TextAlign:"center",Template:'{{#if hasError}}     <span class="file-error">         <i class="fa fa-warning" title="{{errorMessage}}"></i>     </span>     <i class="clear-file fa fa-times-circle" title="{{t "Clear"}}" data-action="clear" data-filename="{{name}}"></i> {{/if}} {{#if isDownloadable}}     <i class="download-file fa fa-download" title="{{t "Download"}}" data-action="download" data-filename="{{name}}"></i> {{/if}} {{#if isQueued}}     <span>Queued</span> {{/if}} {{#if isUploading}}     <span class="file-progress ui-widget-content">         <span class="file-progress-bar" style="width: 0%"></span>         <i class="cancel-upload fa fa-times-circle" title="{{t "Cancel"}} data-action="cancel" data-filename="{{name}}"></i>     </span> {{/if}} {{#if wasSuccess}}     <span class="upload-success"><i class="fa fa-tick"></i> {{t "Upload successful"}}</span> {{/if}}',Hidden:!1}]),e=(u.getComponentDefinition=function(e){var t={Trigger:{type:"string",enum:["Click","Double Click"],default:"Click",title:"Trigger Action",propertyOrder:2}},i=e.dashboardAppModel.get("isLite"),t={id:1003,componentName:"upload",componentDescription:"See results from your data queries.",appKey:"Upload",listViewThumb:"",ghostViewThumb:null,buildViewThumb:null,appArgs:{json:{version:"v2.9.0",possible_servers:[""],Basics:{Name:"",IsLite:!1,Port:4200,AcceptFileName:"",AcceptFileType:"",UploadFileSizeRule:"",UploadFileSizeRuleError:"The current file has exceeded the maximum allowed size.",Directory:"/",Server:"",DownloadEnabled:!0,UploadEnabled:!0,RefreshInterval:0},ColumnsConfiguration:c,Actions:[],FileActions:[],Style:{DisplayType:"Table",RowHeight:30,HeaderRowHeight:30,Theme:"Dark",advanced:""}},schema:{type:"object",title:"Properties",properties:{possibleColumns:{type:"array",items:{type:"string"},default:[""],options:{hidden:!0}},possible_servers:{type:"array",items:{type:"string"},default:[""],options:{hidden:!0}},Basics:{type:"object",title:"Basics",options:{collapsed:!1},properties:{Name:{title:"Name",type:"string",default:"",propertyOrder:1},IsLite:{type:"boolean",format:"checkbox",default:!1,options:{hidden:!0},propertyOrder:2},Port:{type:"number",title:"Port Number",format:"number",default:4200,options:{hidden:!i},propertyOrder:3},Accept:{options:{hidden:!0},propertyOrder:4},AcceptFileName:{type:"string",title:"Valid File Names",default:"*",options:{hidden:i},propertyOrder:5},AcceptFileType:{type:"string",title:"Valid File Types",default:"*",options:{hidden:i},propertyOrder:6},UploadFileSizeRule:{type:"string",title:"Upload File Size Rule",default:"*",tooltip:"Upload File Size Rule (optional):\n\nSpecify the maximum allowed file size in bytes (e.g., 1048576 for 1 MB).\nIf no value is provided, files of any size will be accepted.\n",options:{hidden:i},propertyOrder:7},UploadFileSizeRuleError:{type:"string",title:"Upload File Size Rule Error",default:"The current file has exceeded the maximum allowed size.",options:{hidden:i},propertyOrder:8},Directory:{type:"string",title:"Directory",default:"",options:{hidden:i},propertyOrder:9},Server:{type:"string",title:"Server",default:"",enumSource:"possible_servers",watch:{possible_servers:"root.possible_servers"},propertyOrder:10},DownloadEnabled:{type:"boolean",title:"Download Enabled",format:"checkbox",options:{hidden:i},propertyOrder:11},UploadEnabled:{type:"boolean",title:"Upload Enabled",format:"checkbox",options:{hidden:i},propertyOrder:12},RefreshInterval:{type:"number",title:"Refresh Interval",format:"number",options:{hidden:i},propertyOrder:13}}},ColumnsConfiguration:{type:"array",format:"object",title:"Columns",options:{collapsed:!1,bulkEditor:!0,hidden:i},items:{type:"object",title:"column",headerTemplate:"Column {{ i1 }}   {{#if self.DisplayName}}{{ self.DisplayName }}{{else}}{{ self.Field }}{{/if}}",options:{collapsed:!0},properties:p,watch:{DisplayName:"DisplayName",Field:"Field"}}},Actions:{type:"actions",options:{hidden:i,collapsed:!0},fields:{map:_.extend({Current:{title:"Trigger Source",type:"string",enum:["name","size","lastModified","directory"],options:{enum_titles:["Name","Size","Last Modified","Directory"]},default:"",propertyOrder:10}},t),nav:t,query:t,url:t}},FileActions:{type:"array",format:"table",title:"Upload Actions",options:{collapsed:!0,hidden:i},items:{type:"object",title:"Action",options:{collapsed:!0},properties:{EventType:{title:"Event Type",type:"string",default:"all",enum:["all","onSuccess","onFail"]},Result:{title:"Last Result",type:"string",default:""}}}},Style:{type:"object",title:"Style",options:{collapsed:!0,hidden:i},properties:{Theme:{type:"string",title:"Theme",options:{hidden:!0},enum:["Light","Dark"]},DashboardTheme:{options:{hidden:!0}},DisplayType:{type:"string",title:"Display Type",default:"Table",enum:["Icons","Table"]},RowHeight:{type:"number",format:"number",title:"Row Height",default:30},HeaderRowHeight:{type:"number",format:"number",title:"Header Row Height",default:30},advanced:{type:"css",title:"Advanced CSS",default:""}},_transform:function(e,t,i,o){console.log("Test",e,t,i),"DisplayType"===i?(i="Table"===e.DisplayType,_.set(t,"properties.RowHeight.options.hidden",!i),_.set(t,"properties.HeaderRowHeight.options.hidden",!i),o(e,t)):o()}}}}}};if(e.settingsModel&&0<_.keys(e.settingsModel.attributes).length)for(var i=_.find(u.upgrades,{version:e.settingsModel.get("version")}),o=void 0===i?1:u.upgrades.indexOf(i)+1;o<u.upgrades.length;o+=1){var n=u.upgrades[o];n.fn(e.settingsModel),e.settingsModel.set("version",n.version)}return t},u.upgrades=[{version:"4.0.0_s10",fn:function(e){e.set("Basics.AcceptFileName",!0),e.set("Basics.AcceptFileType",e.get("Basics.Accept")),e.unset("Basics.Accept")}},{version:"4.0.1",fn:function(e){e.set("Basics.RefreshInterval",0)}},{version:"4.1.1",fn:function(e){e.get("Basics.Directory")||e.set("Basics.Directory","/")}},{version:"4.3.0",fn:function(e){e.get("Actions")||e.set("Actions",[])}},{version:"4.6.1",fn:function(e){var t={Name:"name",Size:"size","Last Modified":"lastModified",Directory:"directory"};e.get("ColumnsConfiguration")||e.set("ColumnsConfiguration",c),_.each(e.get("Actions"),function(e){e.Current=t[e.Current]||"name"})}},{version:"4.7.0",fn:function(e){e.set("Style.RowHeight",30),e.set("Style.HeaderRowHeight",30)}},{version:"4.7.5",fn:function(e){_.isNil(e.get("FileActions"))&&e.set("FileActions",[])}},{version:"4.7.6",fn:function(e){_.isNil(e.get("Basics.IsLite"))&&e.set("Basics.IsLite",!1),_.isNil(e.get("Basics.Port"))&&e.set("Basics.Port",4200)}},{version:"4.7.7",fn:function(e){e.get("Basics.Name")||e.set("Basics.Name","")}},{version:"v2.9.0",fn:function(e){console.log("settingsModel:",e),_.isNil(e.get("Basics.UploadFileSizeRule"))&&e.set("Basics.UploadFileSizeRule",""),_.isNil(e.get("Basics.UploadFileSizeRuleError"))&&e.set("Basics.UploadFileSizeRuleError","The current file has exceeded the maximum allowed size.")}}],u);function u(){}h=i.Model,s(m,h),m.getFileIcon=function(e){var t="";switch(e){case"doc":case"docx":t="fa-file-word-o";break;case"xls":case"xlsx":t="fa-file-excel-o";break;case"gif":case"jpeg":case"jpg":case"png":case"tif":case"tiff":t="fa-file-image-o";break;case"csv":case"txt":t="fa-file-text-o";break;case"7z":case"tar":case"bz":case"gz":case"rar":case"zip":case"zipx":t="fa-file-archive-o";break;case"pdf":t="fa-file-pdf-o";break;default:t="fa-file-o"}return t},m.prototype.defaults=function(){return{name:"",size:null,directory:null,lastModified:null,downloadable:!1,uploadBytesSent:null,uploadProgress:null,uploadStatus:null,errorMessage:null,isSelected:!1}},m.prototype.isNew=function(){return!0},m.prototype.onDownloadableChanged=function(){var e=this.get("downloadable"),t=this.get("uploadStatus");this.set({isDownloadable:(t===Dropzone.SUCCESS||_.isNull(t))&&!0===e})},m.prototype.onLastModifiedChanged=function(){var e=n.Tools.convertValueToMoment(this.get("lastModified"));this.set({lastModified:e.toKdbObject(),lastModifiedMoment:e},{silent:!0})},m.prototype.onNameChanged=function(){var e=this.get("name").split(".").pop();this.set({extension:e,icon:m.getFileIcon(e)})},m.prototype.onStatusChanged=function(){var e=this.get("downloadable"),t=this.get("uploadStatus");this.set({hasError:t===Dropzone.ERROR||t===Dropzone.CANCELED||"error"===t,isDownloadable:(t===Dropzone.SUCCESS||_.isNull(t))&&!0===e,isQueued:t===Dropzone.ADDED,isUploading:t===Dropzone.UPLOADING,wasSuccess:t===Dropzone.SUCCESS})};var h,f=m;function m(e){e=h.call(this,e)||this;return e.onDownloadableChanged(),e.onLastModifiedChanged(),e.onNameChanged(),e.onStatusChanged(),e.listenTo(e,"change:downloadable",e.onDownloadableChanged.bind(e)),e.listenTo(e,"change:lastModified",e.onLastModifiedChanged.bind(e)),e.listenTo(e,"change:name",e.onNameChanged.bind(e)),e.listenTo(e,"change:uploadStatus",e.onStatusChanged.bind(e)),e}f.prototype.idAttribute="name";g=i.Collection,s(y,g);var g,v=y;function y(){var e=null!==g&&g.apply(this,arguments)||this;return e.model=f,e}!function(){var s,n,t,e,c,r,l,a,d=[].slice,p={}.hasOwnProperty;function i(){}l=function(){},i.prototype.addEventListener=i.prototype.on,i.prototype.on=function(e,t){return this._callbacks=this._callbacks||{},this._callbacks[e]||(this._callbacks[e]=[]),this._callbacks[e].push(t),this},i.prototype.emit=function(){var e,t,i,o=arguments[0],n=2<=arguments.length?d.call(arguments,1):[];if(this._callbacks=this._callbacks||{},e=this._callbacks[o])for(t=0,i=e.length;t<i;t++)e[t].apply(this,n);return this},i.prototype.removeListener=i.prototype.off,i.prototype.removeAllListeners=i.prototype.off,i.prototype.removeEventListener=i.prototype.off,i.prototype.off=function(e,t){var i,o,n,l;if(this._callbacks&&0!==arguments.length){if(i=this._callbacks[e])if(1===arguments.length)delete this._callbacks[e];else for(o=n=0,l=i.length;n<l;o=++n)if(i[o]===t){i.splice(o,1);break}}else this._callbacks={};return this},n=i,(s=function(){var P,I,e,t=_,i=n;for(e in i)p.call(i,e)&&(t[e]=i[e]);function o(){this.constructor=t}function _(e,t){if(this.element=e,this.version=_.version,this.defaultOptions.previewTemplate=this.defaultOptions.previewTemplate.replace(/\n*/g,""),this.clickableElements=[],this.listeners=[],this.files=[],"string"==typeof this.element&&(this.element=document.querySelector(this.element)),!this.element||null==this.element.nodeType)throw new Error("Invalid dropzone element.");if(this.element.dropzone)throw new Error("Dropzone already attached.");if(_.instances.push(this),this.element.dropzone=this,e=null!=(e=_.optionsForElement(this.element))?e:{},this.options=P({},this.defaultOptions,e,null!=t?t:{}),this.options.forceFallback||!_.isBrowserSupported())return this.options.fallback.call(this);if(null==this.options.url&&(this.options.url=this.element.getAttribute("action")),!this.options.url)throw new Error("No URL provided.");if(this.options.acceptedFiles&&this.options.acceptedMimeTypes)throw new Error("You can't provide both 'acceptedFiles' and 'acceptedMimeTypes'. 'acceptedMimeTypes' is deprecated.");this.options.acceptedMimeTypes&&(this.options.acceptedFiles=this.options.acceptedMimeTypes,delete this.options.acceptedMimeTypes),this.options.method=this.options.method.toUpperCase(),(e=this.getExistingFallback())&&e.parentNode&&e.parentNode.removeChild(e),!1!==this.options.previewsContainer&&(this.options.previewsContainer?this.previewsContainer=_.getElement(this.options.previewsContainer,"previewsContainer"):this.previewsContainer=this.element),this.options.clickable&&(!0===this.options.clickable?this.clickableElements=[this.element]:this.clickableElements=_.getElements(this.options.clickable,"clickable")),this.init()}return o.prototype=i.prototype,t.prototype=new o,t.__super__=i.prototype,_.prototype.Emitter=n,_.prototype.events=["drop","dragstart","dragend","dragenter","dragover","dragleave","addedfile","addedfiles","removedfile","thumbnail","error","errormultiple","processing","processingmultiple","uploadprogress","totaluploadprogress","sending","sendingmultiple","success","successmultiple","canceled","canceledmultiple","complete","completemultiple","reset","maxfilesexceeded","maxfilesreached","queuecomplete"],_.prototype.defaultOptions={url:null,method:"post",withCredentials:!1,parallelUploads:2,uploadMultiple:!1,maxFilesize:256,paramName:"file",createImageThumbnails:!0,maxThumbnailFilesize:10,thumbnailWidth:120,thumbnailHeight:120,filesizeBase:1e3,maxFiles:null,params:{},clickable:!0,ignoreHiddenFiles:!0,acceptedFiles:null,acceptedMimeTypes:null,autoProcessQueue:!0,autoQueue:!0,addRemoveLinks:!1,previewsContainer:null,hiddenInputContainer:"body",capture:null,renameFilename:null,dictDefaultMessage:"Drop files here to upload",dictFallbackMessage:"Your browser does not support drag'n'drop file uploads.",dictFallbackText:"Please use the fallback form below to upload your files like in the olden days.",dictFileTooBig:"File is too big ({{filesize}}MiB). Max filesize: {{maxFilesize}}MiB.",dictInvalidFileType:"You can't upload files of this type.",dictResponseError:"Server responded with {{statusCode}} code.",dictCancelUpload:"Cancel upload",dictCancelUploadConfirmation:"Are you sure you want to cancel this upload?",dictRemoveFile:"Remove file",dictRemoveFileConfirmation:null,dictMaxFilesExceeded:"You can not upload any more files.",accept:function(e,t){return t()},init:function(){return l},forceFallback:!1,fallback:function(){var e,t,i,o,n,l;for(this.element.className=this.element.className+" dz-browser-not-supported",o=0,n=(l=this.element.getElementsByTagName("div")).length;o<n;o++)e=l[o],/(^| )dz-message($| )/.test(e.className)&&((t=e).className="dz-message");return t||(t=_.createElement('<div class="dz-message"><span></span></div>'),this.element.appendChild(t)),(i=t.getElementsByTagName("span")[0])&&(null!=i.textContent?i.textContent=this.options.dictFallbackMessage:null!=i.innerText&&(i.innerText=this.options.dictFallbackMessage)),this.element.appendChild(this.getFallbackForm())},resize:function(e){var t,i={srcX:0,srcY:0,srcWidth:e.width,srcHeight:e.height},o=e.width/e.height;return i.optWidth=this.options.thumbnailWidth,i.optHeight=this.options.thumbnailHeight,null==i.optWidth&&null==i.optHeight?(i.optWidth=i.srcWidth,i.optHeight=i.srcHeight):null==i.optWidth?i.optWidth=o*i.optHeight:null==i.optHeight&&(i.optHeight=1/o*i.optWidth),t=i.optWidth/i.optHeight,e.height<i.optHeight||e.width<i.optWidth?(i.trgHeight=i.srcHeight,i.trgWidth=i.srcWidth):t<o?(i.srcHeight=e.height,i.srcWidth=i.srcHeight*t):(i.srcWidth=e.width,i.srcHeight=i.srcWidth/t),i.srcX=(e.width-i.srcWidth)/2,i.srcY=(e.height-i.srcHeight)/2,i},drop:function(e){return this.element.classList.remove("dz-drag-hover")},dragstart:l,dragend:function(e){return this.element.classList.remove("dz-drag-hover")},dragenter:function(e){return this.element.classList.add("dz-drag-hover")},dragover:function(e){return this.element.classList.add("dz-drag-hover")},dragleave:function(e){return this.element.classList.remove("dz-drag-hover")},paste:l,reset:function(){return this.element.classList.remove("dz-started")},addedfile:function(t){var e,i,o,n,l,s,r,a,d,p,c,u,h;if(this.element===this.previewsContainer&&this.element.classList.add("dz-started"),this.previewsContainer){for(t.previewElement=_.createElement(this.options.previewTemplate.trim()),t.previewTemplate=t.previewElement,this.previewsContainer.appendChild(t.previewElement),o=0,s=(d=t.previewElement.querySelectorAll("[data-dz-name]")).length;o<s;o++)d[o].textContent=this._renameFilename(t.name);for(n=0,r=(p=t.previewElement.querySelectorAll("[data-dz-size]")).length;n<r;n++)p[n].innerHTML=this.filesize(t.size);for(this.options.addRemoveLinks&&(t._removeLink=_.createElement('<a class="dz-remove" href="javascript:undefined;" data-dz-remove>'+this.options.dictRemoveFile+"</a>"),t.previewElement.appendChild(t._removeLink)),h=this,e=function(e){return e.preventDefault(),e.stopPropagation(),t.status===_.UPLOADING?_.confirm(h.options.dictCancelUploadConfirmation,function(){return h.removeFile(t)}):h.options.dictRemoveFileConfirmation?_.confirm(h.options.dictRemoveFileConfirmation,function(){return h.removeFile(t)}):h.removeFile(t)},u=[],l=0,a=(c=t.previewElement.querySelectorAll("[data-dz-remove]")).length;l<a;l++)i=c[l],u.push(i.addEventListener("click",e));return u}},removedfile:function(e){var t;return e.previewElement&&null!=(t=e.previewElement)&&t.parentNode.removeChild(e.previewElement),this._updateMaxFilesReachedClass()},thumbnail:function(e,t){var i,o,n,l;if(e.previewElement){for(e.previewElement.classList.remove("dz-file-preview"),o=0,n=(l=e.previewElement.querySelectorAll("[data-dz-thumbnail]")).length;o<n;o++)(i=l[o]).alt=e.name,i.src=t;return setTimeout(function(){return e.previewElement.classList.add("dz-image-preview")},1)}},error:function(e,t){var i,o,n,l,s;if(e.previewElement){for(e.previewElement.classList.add("dz-error"),"String"!=typeof t&&t.error&&(t=t.error),s=[],o=0,n=(l=e.previewElement.querySelectorAll("[data-dz-errormessage]")).length;o<n;o++)i=l[o],s.push(i.textContent=t);return s}},errormultiple:l,processing:function(e){if(e.previewElement&&(e.previewElement.classList.add("dz-processing"),e._removeLink))return e._removeLink.textContent=this.options.dictCancelUpload},processingmultiple:l,uploadprogress:function(e,t,i){var o,n,l,s,r;if(e.previewElement){for(r=[],n=0,l=(s=e.previewElement.querySelectorAll("[data-dz-uploadprogress]")).length;n<l;n++)"PROGRESS"===(o=s[n]).nodeName?r.push(o.value=t):r.push(o.style.width=t+"%");return r}},totaluploadprogress:l,sending:l,sendingmultiple:l,success:function(e){if(e.previewElement)return e.previewElement.classList.add("dz-success")},successmultiple:l,canceled:function(e){return this.emit("error",e,"Upload canceled.")},canceledmultiple:l,complete:function(e){if(e._removeLink&&(e._removeLink.textContent=this.options.dictRemoveFile),e.previewElement)return e.previewElement.classList.add("dz-complete")},completemultiple:l,maxfilesexceeded:l,maxfilesreached:l,queuecomplete:l,addedfiles:l,previewTemplate:'<div class="dz-preview dz-file-preview">\n  <div class="dz-image"><img data-dz-thumbnail /></div>\n  <div class="dz-details">\n    <div class="dz-size"><span data-dz-size></span></div>\n    <div class="dz-filename"><span data-dz-name></span></div>\n  </div>\n  <div class="dz-progress"><span class="dz-upload" data-dz-uploadprogress></span></div>\n  <div class="dz-error-message"><span data-dz-errormessage></span></div>\n  <div class="dz-success-mark">\n    <svg width="54px" height="54px" viewBox="0 0 54 54" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">\n      <title>Check</title>\n      <defs></defs>\n      <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">\n        <path d="M23.5,31.8431458 L17.5852419,25.9283877 C16.0248253,24.3679711 13.4910294,24.366835 11.9289322,25.9289322 C10.3700136,27.4878508 10.3665912,30.0234455 11.9283877,31.5852419 L20.4147581,40.0716123 C20.5133999,40.1702541 20.6159315,40.2626649 20.7218615,40.3488435 C22.2835669,41.8725651 24.794234,41.8626202 26.3461564,40.3106978 L43.3106978,23.3461564 C44.8771021,21.7797521 44.8758057,19.2483887 43.3137085,17.6862915 C41.7547899,16.1273729 39.2176035,16.1255422 37.6538436,17.6893022 L23.5,31.8431458 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z" id="Oval-2" stroke-opacity="0.198794158" stroke="#747474" fill-opacity="0.816519475" fill="#FFFFFF" sketch:type="MSShapeGroup"></path>\n      </g>\n    </svg>\n  </div>\n  <div class="dz-error-mark">\n    <svg width="54px" height="54px" viewBox="0 0 54 54" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">\n      <title>Error</title>\n      <defs></defs>\n      <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">\n        <g id="Check-+-Oval-2" sketch:type="MSLayerGroup" stroke="#747474" stroke-opacity="0.198794158" fill="#FFFFFF" fill-opacity="0.816519475">\n          <path d="M32.6568542,29 L38.3106978,23.3461564 C39.8771021,21.7797521 39.8758057,19.2483887 38.3137085,17.6862915 C36.7547899,16.1273729 34.2176035,16.1255422 32.6538436,17.6893022 L27,23.3431458 L21.3461564,17.6893022 C19.7823965,16.1255422 17.2452101,16.1273729 15.6862915,17.6862915 C14.1241943,19.2483887 14.1228979,21.7797521 15.6893022,23.3461564 L21.3431458,29 L15.6893022,34.6538436 C14.1228979,36.2202479 14.1241943,38.7516113 15.6862915,40.3137085 C17.2452101,41.8726271 19.7823965,41.8744578 21.3461564,40.3106978 L27,34.6568542 L32.6538436,40.3106978 C34.2176035,41.8744578 36.7547899,41.8726271 38.3137085,40.3137085 C39.8758057,38.7516113 39.8771021,36.2202479 38.3106978,34.6538436 L32.6568542,29 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z" id="Oval-2" sketch:type="MSShapeGroup"></path>\n        </g>\n      </g>\n    </svg>\n  </div>\n</div>'},P=function(){for(var e,t,i,o=arguments[0],n=2<=arguments.length?d.call(arguments,1):[],l=0,s=n.length;l<s;l++)for(e in t=n[l])i=t[e],o[e]=i;return o},_.prototype.getAcceptedFiles=function(){for(var e,t=this.files,i=[],o=0,n=t.length;o<n;o++)(e=t[o]).accepted&&i.push(e);return i},_.prototype.getRejectedFiles=function(){for(var e,t=this.files,i=[],o=0,n=t.length;o<n;o++)(e=t[o]).accepted||i.push(e);return i},_.prototype.getFilesWithStatus=function(e){for(var t,i=this.files,o=[],n=0,l=i.length;n<l;n++)(t=i[n]).status===e&&o.push(t);return o},_.prototype.getQueuedFiles=function(){return this.getFilesWithStatus(_.QUEUED)},_.prototype.getUploadingFiles=function(){return this.getFilesWithStatus(_.UPLOADING)},_.prototype.getAddedFiles=function(){return this.getFilesWithStatus(_.ADDED)},_.prototype.getActiveFiles=function(){for(var e,t=this.files,i=[],o=0,n=t.length;o<n;o++)(e=t[o]).status!==_.UPLOADING&&e.status!==_.QUEUED||i.push(e);return i},_.prototype.init=function(){var e,i,n,t,o,l,s,r,a,d,p,c,u,h,f,m,g,v,y;for("form"===this.element.tagName&&this.element.setAttribute("enctype","multipart/form-data"),this.element.classList.contains("dropzone")&&!this.element.querySelector(".dz-message")&&this.element.appendChild(_.createElement('<div class="dz-default dz-message"><span>'+this.options.dictDefaultMessage+"</span></div>")),this.clickableElements.length&&(r=this,(n=function(){return r.hiddenFileInput&&r.hiddenFileInput.parentNode.removeChild(r.hiddenFileInput),r.hiddenFileInput=document.createElement("input"),r.hiddenFileInput.setAttribute("type","file"),(null==r.options.maxFiles||1<r.options.maxFiles)&&r.hiddenFileInput.setAttribute("multiple","multiple"),r.hiddenFileInput.className="dz-hidden-input",null!=r.options.acceptedFiles&&r.hiddenFileInput.setAttribute("accept",r.options.acceptedFiles),null!=r.options.capture&&r.hiddenFileInput.setAttribute("capture",r.options.capture),r.hiddenFileInput.style.visibility="hidden",r.hiddenFileInput.style.position="absolute",r.hiddenFileInput.style.top="0",r.hiddenFileInput.style.left="0",r.hiddenFileInput.style.height="0",r.hiddenFileInput.style.width="0",document.querySelector(r.options.hiddenInputContainer).appendChild(r.hiddenFileInput),r.hiddenFileInput.addEventListener("change",function(){var e,t,i,o=r.hiddenFileInput.files;if(o.length)for(t=0,i=o.length;t<i;t++)e=o[t],r.addFile(e);return r.emit("addedfiles",o),n()})})()),this.URL=null!=(l=window.URL)?l:window.webkitURL,t=0,o=(s=this.events).length;t<o;t++)e=s[t],this.on(e,this.options[e]);return this.on("uploadprogress",(a=this,function(){return a.updateTotalUploadProgress()})),this.on("removedfile",(d=this,function(){return d.updateTotalUploadProgress()})),this.on("canceled",(p=this,function(e){return p.emit("complete",e)})),this.on("complete",(c=this,function(e){if(0===c.getAddedFiles().length&&0===c.getUploadingFiles().length&&0===c.getQueuedFiles().length)return setTimeout(function(){return c.emit("queuecomplete")},0)})),i=function(e){return e.stopPropagation(),e.preventDefault?e.preventDefault():e.returnValue=!1},this.listeners=[{element:this.element,events:{dragstart:function(e){return v.emit("dragstart",e)},dragenter:function(e){return i(e),g.emit("dragenter",e)},dragover:function(e){var t;try{t=e.dataTransfer.effectAllowed}catch(e){}return e.dataTransfer.dropEffect="move"===t||"linkMove"===t?"move":"copy",i(e),m.emit("dragover",e)},dragleave:function(e){return f.emit("dragleave",e)},drop:function(e){return i(e),h.drop(e)},dragend:(u=h=f=m=g=v=this,function(e){return u.emit("dragend",e)})}}],this.clickableElements.forEach((y=this,function(t){return y.listeners.push({element:t,events:{click:function(e){return t===y.element&&e.target!==y.element&&!_.elementInside(e.target,y.element.querySelector(".dz-message"))||y.hiddenFileInput.click(),!0}}})})),this.enable(),this.options.init.call(this)},_.prototype.destroy=function(){var e;return this.disable(),this.removeAllFiles(!0),null!=(e=this.hiddenFileInput)&&e.parentNode&&(this.hiddenFileInput.parentNode.removeChild(this.hiddenFileInput),this.hiddenFileInput=null),delete this.element.dropzone,_.instances.splice(_.instances.indexOf(this),1)},_.prototype.updateTotalUploadProgress=function(){var e,t,i,o,n,l=0,s=0;if(this.getActiveFiles().length){for(i=0,o=(n=this.getActiveFiles()).length;i<o;i++)l+=(e=n[i]).upload.bytesSent,s+=e.upload.total;t=100*l/s}else t=100;return this.emit("totaluploadprogress",t,s,l)},_.prototype._getParamName=function(e){return"function"==typeof this.options.paramName?this.options.paramName(e):""+this.options.paramName+(this.options.uploadMultiple?"["+e+"]":"")},_.prototype._renameFilename=function(e){return"function"!=typeof this.options.renameFilename?e:this.options.renameFilename(e)},_.prototype.getFallbackForm=function(){var e,t;return(e=this.getExistingFallback())||(e='<div class="dz-fallback">',this.options.dictFallbackText&&(e+="<p>"+this.options.dictFallbackText+"</p>"),e+='<input type="file" name="'+this._getParamName(0)+'" '+(this.options.uploadMultiple?'multiple="multiple"':void 0)+' /><input type="submit" value="Upload!"></div>',e=_.createElement(e),"FORM"!==this.element.tagName?(t=_.createElement('<form action="'+this.options.url+'" enctype="multipart/form-data" method="'+this.options.method+'"></form>')).appendChild(e):(this.element.setAttribute("enctype","multipart/form-data"),this.element.setAttribute("method",this.options.method)),null!=t?t:e)},_.prototype.getExistingFallback=function(){for(var e,t=function(e){for(var t,i=0,o=e.length;i<o;i++)if(t=e[i],/(^| )fallback($| )/.test(t.className))return t},i=["div","form"],o=0,n=i.length;o<n;o++)if(e=t(this.element.getElementsByTagName(i[o])))return e},_.prototype.setupEventListeners=function(){for(var i,o,n,e=this.listeners,t=[],l=0,s=e.length;l<s;l++)i=e[l],t.push(function(){var e=i.events,t=[];for(o in e)n=e[o],t.push(i.element.addEventListener(o,n,!1));return t}());return t},_.prototype.removeEventListeners=function(){for(var i,o,n,e=this.listeners,t=[],l=0,s=e.length;l<s;l++)i=e[l],t.push(function(){var e=i.events,t=[];for(o in e)n=e[o],t.push(i.element.removeEventListener(o,n,!1));return t}());return t},_.prototype.disable=function(){var e,t,i,o,n;for(this.clickableElements.forEach(function(e){return e.classList.remove("dz-clickable")}),this.removeEventListeners(),n=[],t=0,i=(o=this.files).length;t<i;t++)e=o[t],n.push(this.cancelUpload(e));return n},_.prototype.enable=function(){return this.clickableElements.forEach(function(e){return e.classList.add("dz-clickable")}),this.setupEventListeners()},_.prototype.filesize=function(e){var t,i,o,n,l,s=0,r="b";if(0<e){for(t=n=0,l=(o=["TB","GB","MB","KB","b"]).length;n<l;t=++n)if(i=o[t],Math.pow(this.options.filesizeBase,4-t)/10<=e){s=e/Math.pow(this.options.filesizeBase,4-t),r=i;break}s=Math.round(10*s)/10}return"<strong>"+s+"</strong> "+r},_.prototype._updateMaxFilesReachedClass=function(){return null!=this.options.maxFiles&&this.getAcceptedFiles().length>=this.options.maxFiles?(this.getAcceptedFiles().length===this.options.maxFiles&&this.emit("maxfilesreached",this.files),this.element.classList.add("dz-max-files-reached")):this.element.classList.remove("dz-max-files-reached")},_.prototype.drop=function(e){var t;e.dataTransfer&&(this.emit("drop",e),t=e.dataTransfer.files,this.emit("addedfiles",t),t.length)&&((e=e.dataTransfer.items)&&e.length&&null!=e[0].webkitGetAsEntry?this._addFilesFromItems(e):this.handleFiles(t))},_.prototype.paste=function(e){var t;if(null!=(null!=e&&null!=(t=e.clipboardData)?t.items:void 0))return this.emit("paste",e),(t=e.clipboardData.items).length?this._addFilesFromItems(t):void 0},_.prototype.handleFiles=function(e){for(var t,i=[],o=0,n=e.length;o<n;o++)t=e[o],i.push(this.addFile(t));return i},_.prototype._addFilesFromItems=function(e){for(var t,i,o=[],n=0,l=e.length;n<l;n++)null!=(i=e[n]).webkitGetAsEntry&&(t=i.webkitGetAsEntry())?t.isFile?o.push(this.addFile(i.getAsFile())):t.isDirectory?o.push(this._addFilesFromDirectory(t,t.name)):o.push(void 0):null!=i.getAsFile&&(null==i.kind||"file"===i.kind)?o.push(this.addFile(i.getAsFile())):o.push(void 0);return o},_.prototype._addFilesFromDirectory=function(e,n){var l,s,t=e.createReader(),i=function(e){return"undefined"!=typeof console&&null!==console&&"function"==typeof console.log?console.log(e):void 0};return s=this,(l=function(){return t.readEntries(function(e){var t,i,o;if(0<e.length){for(i=0,o=e.length;i<o;i++)(t=e[i]).isFile?t.file(function(e){if(!s.options.ignoreHiddenFiles||"."!==e.name.substring(0,1))return e.fullPath=n+"/"+e.name,s.addFile(e)}):t.isDirectory&&s._addFilesFromDirectory(t,n+"/"+t.name);l()}return null},i)})()},_.prototype.accept=function(e,t){return _.isValidFile(e,this.options.acceptedFiles)?null!=this.options.maxFiles&&this.getAcceptedFiles().length>=this.options.maxFiles?(t(this.options.dictMaxFilesExceeded.replace("{{maxFiles}}",this.options.maxFiles)),this.emit("maxfilesexceeded",e)):this.options.accept.call(this,e,t):t(this.options.dictInvalidFileType)},_.prototype.addFile=function(t){return t.upload={progress:0,total:t.size,bytesSent:0},this.files.push(t),t.status=_.ADDED,this.emit("addedfile",t),this._enqueueThumbnail(t),this.accept(t,(i=this,function(e){return e?(t.accepted=!1,i._errorProcessing([t],e)):(t.accepted=!0,i.options.autoQueue&&i.enqueueFile(t)),i._updateMaxFilesReachedClass()}));var i},_.prototype.enqueueFiles=function(e){for(var t,i=0,o=e.length;i<o;i++)t=e[i],this.enqueueFile(t);return null},_.prototype.enqueueFile=function(e){if(e.status!==_.ADDED||!0!==e.accepted)throw new Error("This file can't be queued because it has already been processed or was rejected.");if(e.status=_.QUEUED,this.options.autoProcessQueue)return setTimeout((t=this,function(){return t.processQueue()}),0);var t},_.prototype._thumbnailQueue=[],_.prototype._processingThumbnail=!1,_.prototype._enqueueThumbnail=function(e){if(this.options.createImageThumbnails&&e.type.match(/image.*/)&&e.size<=1024*this.options.maxThumbnailFilesize*1024)return this._thumbnailQueue.push(e),setTimeout((t=this,function(){return t._processThumbnailQueue()}),0);var t},_.prototype._processThumbnailQueue=function(){var e;if(!this._processingThumbnail&&0!==this._thumbnailQueue.length)return this._processingThumbnail=!0,this.createThumbnail(this._thumbnailQueue.shift(),(e=this,function(){return e._processingThumbnail=!1,e._processThumbnailQueue()}))},_.prototype.removeFile=function(e){if(e.status===_.UPLOADING&&this.cancelUpload(e),this.files=a(this.files,e),this.emit("removedfile",e),0===this.files.length)return this.emit("reset")},_.prototype.removeAllFiles=function(e){var t,i,o,n;for(null==e&&(e=!1),i=0,o=(n=this.files.slice()).length;i<o;i++)(t=n[i]).status===_.UPLOADING&&!e||this.removeFile(t);return null},_.prototype.createThumbnail=function(e,t){var i,o=new FileReader;return o.onload=(i=this,function(){if("image/svg+xml"!==e.type)return i.createThumbnailFromUrl(e,o.result,t);i.emit("thumbnail",e,o.result),null!=t&&t()}),o.readAsDataURL(e)},_.prototype.createThumbnailFromUrl=function(o,e,n,t){var l,s=document.createElement("img");return t&&(s.crossOrigin=t),s.onload=(l=this,function(){var e,t,i;if(o.width=s.width,o.height=s.height,null==(t=l.options.resize.call(l,o)).trgWidth&&(t.trgWidth=t.optWidth),null==t.trgHeight&&(t.trgHeight=t.optHeight),i=(e=document.createElement("canvas")).getContext("2d"),e.width=t.trgWidth,e.height=t.trgHeight,r(i,s,null!=(i=t.srcX)?i:0,null!=(i=t.srcY)?i:0,t.srcWidth,t.srcHeight,null!=(i=t.trgX)?i:0,null!=(i=t.trgY)?i:0,t.trgWidth,t.trgHeight),i=e.toDataURL("image/png"),l.emit("thumbnail",o,i),null!=n)return n()}),null!=n&&(s.onerror=n),s.src=e},_.prototype.processQueue=function(){var e,t=this.options.parallelUploads,i=this.getUploadingFiles().length,o=i;if(!(t<=i)&&0<(e=this.getQueuedFiles()).length){if(this.options.uploadMultiple)return this.processFiles(e.slice(0,t-i));for(;o<t;){if(!e.length)return;this.processFile(e.shift()),o++}}},_.prototype.processFile=function(e){return this.processFiles([e])},_.prototype.processFiles=function(e){for(var t,i=0,o=e.length;i<o;i++)(t=e[i]).processing=!0,t.status=_.UPLOADING,this.emit("processing",t);return this.options.uploadMultiple&&this.emit("processingmultiple",e),this.uploadFiles(e)},_.prototype._getFilesWithXhr=function(n){var l;return function(){for(var e=this.files,t=[],i=0,o=e.length;i<o;i++)(l=e[i]).xhr===n&&t.push(l);return t}.call(this)},_.prototype.cancelUpload=function(e){var t,i,o,n,l,s,r;if(e.status===_.UPLOADING){for(o=0,l=(i=this._getFilesWithXhr(e.xhr)).length;o<l;o++)(t=i[o]).status=_.CANCELED;for(e.xhr.abort(),n=0,s=i.length;n<s;n++)t=i[n],this.emit("canceled",t);this.options.uploadMultiple&&this.emit("canceledmultiple",i)}else(r=e.status)!==_.ADDED&&r!==_.QUEUED||(e.status=_.CANCELED,this.emit("canceled",e),this.options.uploadMultiple&&this.emit("canceledmultiple",[e]));if(this.options.autoProcessQueue)return this.processQueue()},I=function(){var e=arguments[0],t=2<=arguments.length?d.call(arguments,1):[];return"function"==typeof e?e.apply(this,t):e},_.prototype.uploadFile=function(e){return this.uploadFiles([e])},_.prototype.uploadFiles=function(p){for(var c,e,i,t,o,n,l,s,r,a,d,u,h,f,m,g,v,y,w,b,C,F,E,M,D,S,z,T,A,k,x,R=new XMLHttpRequest,H=0,L=p.length;H<L;H++)(c=p[H]).xhr=R;for(t in E=I(this.options.method,p),f=I(this.options.url,p),R.open(E,f,!0),R.withCredentials=!!this.options.withCredentials,u=null,i=function(){for(var e=[],t=0,i=p.length;t<i;t++)c=p[t],e.push(A._errorProcessing(p,u||A.options.dictResponseError.replace("{{statusCode}}",R.status),R));return e},k=A=this,h=function(e){var t,i,o,n,l,s,r,a,d;if(null!=e)for(i=100*e.loaded/e.total,o=0,s=p.length;o<s;o++)(c=p[o]).upload={progress:i,total:e.total,bytesSent:e.loaded};else{for(t=!0,i=100,n=0,r=p.length;n<r;n++)100===(c=p[n]).upload.progress&&c.upload.bytesSent===c.upload.total||(t=!1),c.upload.progress=i,c.upload.bytesSent=c.upload.total;if(t)return}for(d=[],l=0,a=p.length;l<a;l++)c=p[l],d.push(k.emit("uploadprogress",c,i,c.upload.bytesSent));return d},R.onload=(x=this,function(t){var e;if(p[0].status!==_.CANCELED&&4===R.readyState){if(u=R.responseText,R.getResponseHeader("content-type")&&~R.getResponseHeader("content-type").indexOf("application/json"))try{u=JSON.parse(u)}catch(e){t=e,u="Invalid JSON response from server."}return h(),200<=(e=R.status)&&e<300?x._finished(p,u,t):i()}}),R.onerror=function(){if(p[0].status!==_.CANCELED)return i()},(null!=(E=R.upload)?E:R).onprogress=h,n={Accept:"application/json","Cache-Control":"no-cache","X-Requested-With":"XMLHttpRequest"},this.options.headers&&P(n,this.options.headers),n)(o=n[t])&&R.setRequestHeader(t,o);if(e=new FormData,this.options.params)for(a in M=this.options.params)m=M[a],e.append(a,m);for(g=0,w=p.length;g<w;g++)c=p[g],this.emit("sending",c,R,e);if(this.options.uploadMultiple&&this.emit("sendingmultiple",p,R,e),"FORM"===this.element.tagName)for(v=0,b=(D=this.element.querySelectorAll("input, textarea, select, button")).length;v<b;v++)if(r=(s=D[v]).getAttribute("name"),z=s.getAttribute("type"),"SELECT"===s.tagName&&s.hasAttribute("multiple"))for(y=0,C=(S=s.options).length;y<C;y++)(d=S[y]).selected&&e.append(r,d.value);else(!z||"checkbox"!==(z=z.toLowerCase())&&"radio"!==z||s.checked)&&e.append(r,s.value);for(l=F=0,T=p.length-1;0<=T?F<=T:T<=F;l=0<=T?++F:--F)e.append(this._getParamName(l),p[l],this._renameFilename(p[l].name));return this.submitRequest(R,e,p)},_.prototype.submitRequest=function(e,t,i){return e.send(t)},_.prototype._finished=function(e,t,i){for(var o,n=0,l=e.length;n<l;n++)(o=e[n]).status=_.SUCCESS,this.emit("success",o,t,i),this.emit("complete",o);if(this.options.uploadMultiple&&(this.emit("successmultiple",e,t,i),this.emit("completemultiple",e)),this.options.autoProcessQueue)return this.processQueue()},_.prototype._errorProcessing=function(e,t,i){for(var o,n=0,l=e.length;n<l;n++)(o=e[n]).status=_.ERROR,this.emit("error",o,t,i),this.emit("complete",o);if(this.options.uploadMultiple&&(this.emit("errormultiple",e,t,i),this.emit("completemultiple",e)),this.options.autoProcessQueue)return this.processQueue()},_}()).version="4.3.0",s.options={},s.optionsForElement=function(e){if(e.getAttribute("id"))return s.options[t(e.getAttribute("id"))]},s.instances=[],s.forElement=function(e){if(null==(null!=(e="string"==typeof e?document.querySelector(e):e)?e.dropzone:void 0))throw new Error("No Dropzone found for given element. This is probably because you're trying to access it before Dropzone had the time to initialize. Use the `init` option to setup any additional observers on your Dropzone.");return e.dropzone},s.autoDiscover=!0,s.discover=function(){var e,t,l,i,o,n;for(document.querySelectorAll?l=document.querySelectorAll(".dropzone"):(l=[],(e=function(e){for(var t,i=[],o=0,n=e.length;o<n;o++)t=e[o],/(^| )dropzone($| )/.test(t.className)?i.push(l.push(t)):i.push(void 0);return i})(document.getElementsByTagName("div")),e(document.getElementsByTagName("form"))),n=[],i=0,o=l.length;i<o;i++)t=l[i],!1!==s.optionsForElement(t)?n.push(new s(t)):n.push(void 0);return n},s.blacklistedBrowsers=[/opera.*Macintosh.*version\/12/i],s.isBrowserSupported=function(){var e,t,i,o=!0;if(window.File&&window.FileReader&&window.FileList&&window.Blob&&window.FormData&&document.querySelector)if("classList"in document.createElement("a"))for(e=0,t=(i=s.blacklistedBrowsers).length;e<t;e++)i[e].test(navigator.userAgent)&&(o=!1);else o=!1;else o=!1;return o},a=function(e,t){for(var i,o=[],n=0,l=e.length;n<l;n++)(i=e[n])!==t&&o.push(i);return o},t=function(e){return e.replace(/[\-_](\w)/g,function(e){return e.charAt(1).toUpperCase()})},s.createElement=function(e){var t=document.createElement("div");return t.innerHTML=e,t.childNodes[0]},s.elementInside=function(e,t){if(e===t)return!0;for(;e=e.parentNode;)if(e===t)return!0;return!1},s.getElement=function(e,t){var i;if("string"==typeof e?i=document.querySelector(e):null!=e.nodeType&&(i=e),null==i)throw new Error("Invalid `"+t+"` option provided. Please provide a CSS selector or a plain HTML element.");return i},s.getElements=function(e,t){var i,o,n,l,s,r,a;if(e instanceof Array){o=[];try{for(n=0,s=e.length;n<s;n++)i=e[n],o.push(this.getElement(i,t))}catch(e){o=null}}else if("string"==typeof e)for(o=[],l=0,r=(a=document.querySelectorAll(e)).length;l<r;l++)i=a[l],o.push(i);else null!=e.nodeType&&(o=[e]);if(null!=o&&o.length)return o;throw new Error("Invalid `"+t+"` option provided. Please provide a CSS selector, a plain HTML element or a list of those.")},s.confirm=function(e,t,i){return window.confirm(e)?t():null!=i?i():void 0},s.isValidFile=function(e,t){var i,o,n,l,s;if(!t)return!0;for(t=t.split(","),i=(o=e.type).replace(/\/.*$/,""),l=0,s=t.length;l<s;l++)if("."===(n=(n=t[l]).trim()).charAt(0)){if(-1!==e.name.toLowerCase().indexOf(n.toLowerCase(),e.name.length-n.length))return!0}else if(/\/\*$/.test(n)){if(i===n.replace(/\/.*$/,""))return!0}else if(o===n)return!0;return!1},"undefined"!=typeof jQuery&&null!==jQuery&&(jQuery.fn.dropzone=function(e){return this.each(function(){return new s(this,e)})}),"undefined"!=typeof module&&null!==module?module.exports=s:window.Dropzone=s,s.ADDED="added",s.QUEUED="queued",s.ACCEPTED=s.QUEUED,s.UPLOADING="uploading",s.PROCESSING=s.UPLOADING,s.CANCELED="canceled",s.ERROR="error",s.SUCCESS="success",c=function(e){e.naturalWidth;var t,i,o,n,l=e.naturalHeight,s=document.createElement("canvas");for(s.width=1,s.height=l,(s=s.getContext("2d")).drawImage(e,0,0),t=s.getImageData(0,0,1,l).data,n=0,o=i=l;n<o;)0===t[4*(o-1)+3]?i=o:n=o,o=i+n>>1;return 0==(e=o/l)?1:e},r=function(e,t,i,o,n,l,s,r,a,d){var p=c(t);return e.drawImage(t,i,o,n,l,s,r,a,d/p)},e=function(t,i){var o=!1,e=!0,n=t.document,l=n.documentElement,s=n.addEventListener?"addEventListener":"attachEvent",r=n.addEventListener?"removeEventListener":"detachEvent",a=n.addEventListener?"":"on",d=function(e){if("readystatechange"!==e.type||"complete"===n.readyState)return("load"===e.type?t:n)[r](a+e.type,d,!1),!o&&(o=!0)?i.call(t,e.type||e):void 0},p=function(){try{l.doScroll("left")}catch(e){return void setTimeout(p,50)}return d("poll")};if("complete"!==n.readyState){if(n.createEventObject&&l.doScroll){try{e=!t.frameElement}catch(e){}e&&p()}return n[s](a+"DOMContentLoaded",d,!1),n[s](a+"readystatechange",d,!1),t[s](a+"load",d,!1)}},s._autoDiscoverFunction=function(){if(s.autoDiscover)return s.discover()},e(window,s._autoDiscoverFunction)}.call(this);w=i.View,s(C,w),C.prototype.getActiveUploads=function(){var e=_.filter(this.dropzone.files,function(e){return"error"===e.status});return this.dropzone.getQueuedFiles().concat(this.dropzone.getUploadingFiles()).concat(e)},C.prototype.remove=function(){return this.dropzone&&(this.dropzone.off(),this.dropzone.destroy()),i.View.prototype.remove.call(this)},C.prototype.initializeEvents=function(){this.dropzone.on("addedfile",this.onDropzoneAddedFile.bind(this)),this.dropzone.on("canceled",this.onDropzoneCancelled.bind(this)),this.dropzone.on("error",this.onDropzoneError.bind(this)),this.dropzone.on("processing",this.onDropzoneProcessing.bind(this)),this.dropzone.on("removedfile",this.onDropzoneRemovedFile.bind(this)),this.dropzone.on("success",this.onDropzoneSuccess.bind(this)),this.dropzone.on("uploadprogress",this.onDropzoneUploadProgress.bind(this)),this.listenTo(this.viewModel,"change:acceptedFileTypes",this.onAcceptedFileTypesChanged.bind(this)),this.listenTo(this.viewModel,"change:uploadEnabled",this.onUploadEnabledChanged.bind(this))},C.prototype.isFileValid=function(e,t){var i=new RegExp(this.viewModel.get("acceptedFileNames")),o=this.viewModel.get("uploadFileSizeRule"),n=this.viewModel.get("uploadFileSizeRuleError"),l=[];if(e.name.match(i)||l.push('Invalid filename (must match "'.concat(this.viewModel.get("acceptedFileNames"),'")')),0===e.size&&l.push("Attachment has zero file size"),o&&e.size>o&&l.push(n),0<l.length)return t(l.map(function(e){return" ".concat(e)}).join("\n"));t()},C.prototype.onAcceptedFileTypesChanged=function(){var e=this.viewModel.get("acceptedFileTypes");this.dropzone.options.acceptedFiles=e,$(this.dropzone.hiddenFileInput).attr("accept",e).trigger("change")},C.prototype.onDropzoneAddedFile=function(t){var e=this,i=(t.directory=this.viewModel.get("directory"),this.fileToOverwrite=this.fileCollection.find(function(e){return e.get("name")===t.name&&e.get("directory")===t.directory}),this.fileCollection.add({name:t.name,size:t.size,directory:t.directory,lastModified:(new Date).getTime(),uploadStatus:t.status}));t.modelId=i.id,this.listenTo(i,"cancel-upload",function(){e.dropzone.cancelUpload(t)})},C.prototype.onDropzoneCancelled=function(e){var t=this.fileCollection.get(e.modelId);t&&t.set({errorMessage:"Cancelled",uploadStatus:e.status})},C.prototype.onDropzoneError=function(e,t){var i=this.fileCollection.get(e.modelId);i&&i.set({errorMessage:t,uploadStatus:e.status})},C.prototype.onDropzoneProcessing=function(e){var t=this.fileCollection.get(e.modelId);t&&t.set("uploadStatus",e.status)},C.prototype.onDropzoneRemovedFile=function(e){e=this.fileCollection.get(e.modelId);e&&this.fileCollection.remove(e)},C.prototype.onDropzoneSuccess=function(e,t){var i=this.fileCollection.get(e.modelId);i&&(i.set({downloadable:this.viewModel.get("downloadEnabled"),uploadStatus:e.status}),i.set("uploadStatus",e.status)),t||this.onDropzoneError(e,"Upload failed - check parameters")},C.prototype.onDropzoneUploadProgress=function(e,t,i){var o=this.fileCollection.get(e.modelId);o&&o.set({uploadBytesSent:i,uploadProgress:t,uploadStatus:e.status})},C.prototype.onUploadEnabledChanged=function(){this.viewModel.get("uploadEnabled")?this.dropzone.enable():this.dropzone.disable()};var w,b=C;function C(e){var t=w.call(this,e)||this,i=(_.isFunction(e.onSubmitRequest)&&(Dropzone.prototype.submitRequest=e.onSubmitRequest),t.fileCollection=e.fileCollection,t.viewModel=e.viewModel,_.extend({accept:t.isFileValid.bind(t),addRemoveLinks:!0,dictDefaultMessage:"Drop files to upload",dictCancelUpload:"Cancel",dictRemoveFile:"Remove",maxFilesize:t.viewModel.get("uploadFileSizeRule"),previewsContainer:!1},e.dropzoneOptions));return t.dropzone=new Dropzone(e.container,i),t.initializeEvents(),t}F=i.View,s(M,F),M.prototype.onResize=function(){this.grid&&this.grid.onResize()},M.prototype.remove=function(){return this.grid&&this.grid.remove(),this.throttledUpdateDataSource.cancel(),this.$el.off("click"),i.View.prototype.remove.call(this)},M.prototype.initializeEvents=function(){this.listenTo(this.fileCollection,"add remove reset change",this.throttledUpdateDataSource.bind(this)),this.listenTo(this.appSettingsModel,"change:"+this.PROP_ACTIONS,this.onActionsChange.bind(this)),this.listenTo(this.viewModel,"change:"+this.PROP_COLUMNS,this.onColumnsChange.bind(this)),this.$el.on("click",this.onClick.bind(this))},M.prototype.initializeSettingsModel=function(){var e="Dark"===this.dashboardViewModel.get("DashboardTheme");return t.getSettingsModel({Basics:{Data:this.dataModel,ShowPagingControl:!1,EnableGrouping:!1,Filtering:"Column Filters"},ColumnsConfiguration:this.viewModel.get(this.PROP_COLUMNS),Selection:{Actions:this.getActions(),FollowSelectedValue:!0,Mode:"Single Row"},FileExport:{ShowExportCsvButton:!1,ShowExportExcelButton:!1,ShowFullExportButton:!1},HighlightRules:[{RuleType:"discrete",Name:"Error",Target:"*",ConditionSource:"uploadStatus",ConditionOperator:"==",ConditionValue:"error",Color:"#E74B4B"}],Style:{SelectedRowBackgroundColor:"#3A9FC7",HeaderTextTransformation:"capitalize",EvenRowBackgroundColorOverride:e?"#282828":"#f0f0f0",OddRowBackgroundColorOverride:e?"#303030":"#e0e0e0",RowHeight:this.viewModel.get("RowHeight"),HeaderRowHeight:this.viewModel.get("HeaderRowHeight")}})},M.prototype.getActions=function(){return this.appSettingsModel.get(this.PROP_ACTIONS).map(function(e){return _.extend({TriggerColumn:"*"},e)})},M.prototype.initializeDataModel=function(){var e=new n.DocumentDataModel({_subscriptionKey:"name",_dataType:"copy"},null,"",null);return e.apply(),e},M.prototype.onClick=function(e){var t=$(e.target),i=t.data("action"),t=t.data("filename");i&&t&&((t=this.fileCollection.get(t))&&("download"===i?t.trigger("download-file",t):"cancel"===i?t.trigger("cancel-upload"):"clear"===i&&(t.get("downloadable")?t.set("uploadStatus",null):t.destroy())),e.stopPropagation())},M.prototype.onActionsChange=function(){this.settingsModel.set("Selection.Actions",this.getActions())},M.prototype.onColumnsChange=function(){this.settingsModel.set("ColumnsConfiguration",this.viewModel.get(this.PROP_COLUMNS))},M.prototype.updateDataModel=function(){this.dataModel.isPending||(this.dataModel.isPending=!0,this.dataModel.onExecuteSuccess(_.extend({rows:this.fileCollection.toJSON()},M.dataSpec),!0))},M.dataSpec={class:"",columns:["name","size","lastModified","directory"],meta:{name:11,size:6,lastModified:12,directory:11}};var F,E=M;function M(e){var t=F.call(this,e)||this;return t.PROP_ACTIONS="Actions",t.PROP_COLUMNS="ColumnsConfiguration",t.api=e.api,t.appSettingsModel=e.settingsModel,t.dashboardViewModel=e.dashboardViewModel,t.fileCollection=e.fileCollection,t.viewModel=e.viewModel,t.$el.html(""),t.dataModel=t.initializeDataModel(),t.settingsModel=t.initializeSettingsModel(),t.api.setProperty("possibleColumns",M.dataSpec.columns),t.throttledUpdateDataSource=_.throttle(t.updateDataModel.bind(t),1e3),t.api.loadApp("Datagrid",t.$el[0],t.settingsModel,{sortColumns:[{sortCol:"lastModified",sortAsc:!1}]},function(e){t.grid=e,t.throttledUpdateDataSource(),t.initializeEvents()},"upload"),t}D=i.View,s(z,D),z.prototype.remove=function(){return this.$cancelUpload.off("click"),this.$clearFile.off("click"),this.$downloadFile.off("click"),this.$el.off("click"),this.$el.off("dblclick"),i.View.prototype.remove.apply(this)},z.prototype.initializeEvents=function(){this.listenTo(this.model,"change:errorMessage change:downloadable change:uploadStatus",this.renderActions.bind(this)),this.listenTo(this.model,"change:uploadProgress",this.onChangeProgress.bind(this)),this.listenTo(this.model,"change:directory change:lastModified change:name change:size",this.renderAttributes.bind(this)),this.listenTo(this.model,"destroy",this.onDestroy.bind(this)),this.listenTo(this.model,"change:isSelected",this.onSelectChange.bind(this)),this.$cancelUpload.on("click",this.onCancelUpload.bind(this)),this.$clearFile.on("click",this.onClearFile.bind(this)),this.$downloadFile.on("click",this.onDownloadFile.bind(this)),this.$el.on("click",this.onClick.bind(this)),this.$el.on("dblclick",this.onDblClick.bind(this))},z.prototype.formatBytes=function(e,t){var i;return 0===e?"0 Byte":(t=t?t+1:3,i=Math.floor(Math.log(e)/Math.log(1e3)),parseFloat((e/Math.pow(1e3,i)).toFixed(t))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][i])},z.prototype.onCancelUpload=function(){this.model.trigger("cancel-upload")},z.prototype.onClearFile=function(){this.model.get("downloadable")?this.model.set("uploadStatus",null):(this.userInitiatedDestroy=!0,this.model.destroy(),this.userInitiatedDestroy=!1)},z.prototype.onClick=function(){this.processClick("Click")},z.prototype.onChangeProgress=function(){this.$el.find(".file-progress-bar").css("width",this.model.get("uploadProgress")+"%")},z.prototype.onDblClick=function(){this.processClick("Double Click")},z.prototype.onDestroy=function(){_.includes([Dropzone.ERROR,Dropzone.CANCELED],this.model.get("uploadStatus"))&&!this.userInitiatedDestroy||this.remove()},z.prototype.onDownloadFile=function(){this.model.trigger("download-file",this.model)},z.prototype.onSelectChange=function(){this.$el.toggleClass("highlight",this.model.get("isSelected"))},z.prototype.processClick=function(e){var t={Name:this.model.get("name"),Size:this.formatBytes(this.model.get("size")),"Last Modified":this.model.get("lastModified").toString(),Directory:this.model.get("directory")};this.model.set("isSelected",!0),this.model.trigger("doActions",e,t)},z.prototype.renderActions=function(){var e=this,t=this.model.toJSON(),i=this.model.get("uploadStatus");_.extend(t,{hasError:i===Dropzone.ERROR||i===Dropzone.CANCELED||"error"===i,isDownloadable:(i===Dropzone.SUCCESS||_.isNull(i))&&!0===this.model.get("downloadable"),isQueued:i===Dropzone.ADDED,isUploading:i===Dropzone.UPLOADING,wasSuccess:i===Dropzone.SUCCESS}),this.$actions.html(a.fileListStatus(t)),this.$el.removeClass(function(e,t){return(t.match(/(^|\s)status-\S+/g)||[]).join(" ")}),i&&this.$el.addClass("status-"+i),i===Dropzone.SUCCESS&&_.delay(function(){e.$el.removeClass("status-"+Dropzone.SUCCESS).find(".upload-success").remove(),e.model.unset("uploadStatus",{silent:!0})},5e3)},z.prototype.renderAttributes=function(){var e=this.model.toJSON();e.name&&(e.icon=f.getFileIcon(e.name.split(".").pop())),e.lastModified&&(e.lastModified=e.lastModifiedMoment.toString()),e.size&&(e.size=this.formatBytes(e.size)),this.$el.html(a.fileListIcon(e)),this.$actions=this.$el.find(".actions"),this.renderActions()};var D,S=z;function z(e){e=D.call(this,e)||this;return e.userInitiatedDestroy=!1,e.$el.addClass("file-icon ui-widget-content"),e.renderAttributes(),e.$cancelUpload=e.$el.find(".cancel-upload"),e.$clearFile=e.$el.find(".clear-file"),e.$downloadFile=e.$el.find(".download-file"),e.initializeEvents(),e}T=i.View,s(x,T),x.prototype.initializeEvents=function(){this.listenTo(this.fileCollection,"add",this.onFileAdded.bind(this)),this.listenTo(this.fileCollection,"reset",this.onFilesReset.bind(this))},x.prototype.onFileAdded=function(e){e.get("isSelected")&&this.$el.addClass("highlight"),this.viewModel.get("downloadEnabled")&&!e.get("uploadStatus")&&e.set("downloadable",!0);e=new S({model:e});this.fileIconsItems.push(e),this.$el.append(e.$el)},x.prototype.onFilesReset=function(){var t=this;this.destroyIconsItems(),this.fileCollection.each(function(e){t.onFileAdded(e)})},x.prototype.destroyIconsItems=function(){for(;0<this.fileIconsItems.length;)this.fileIconsItems.pop().remove()};var T,A,k=x;function x(e){var t=T.call(this,e)||this;return t.fileIconsItems=[],t.$el.addClass("file-icons"),t.$el.html(""),t.viewModel=e.viewModel,t.fileCollection=e.fileCollection,t.initializeEvents(),t.onFilesReset(),t}function R(e){var t=A.call(this,e)||this;return t.dragCounter=0,t.fetchingFiles=!1,t.hasInit=!1,t.isVirtualLinkSupported=!1,t.isLite=!1,t.api=e.api,t.dashboardViewModel=e.dashboardViewModel,t.hideErrorMessage=e.api.hideErrorMessage,t.showErrorMessage=e.api.showErrorMessage,t.deltaClientLib=e.DeltaClientLib,t.settingsModel=e.settingsModel,t.fileCollection=new v,t.viewModel=new i.Model({acceptedFileNames:"",acceptedFileTypes:"",uploadFileSizeRule:"",uploadFileSizeRuleError:"",directory:"",displayType:null,downloadEnabled:!1,error:null,uploadEnabled:!1,server:""}),t.dragCounter=0,t.uid=_.uniqueId("upload"),t.el.className+=" Upload",t.isLite=e.dashboardAppModel.get("isLite"),t.setTheme(t.dashboardViewModel.get(R.APP_THEME)),t.isLite||(t.$el.html(a.app()),t.api.setProperty("Basics.IsLite",!1),t.$dropzoneForm=t.$el.find("form.dropzone"),t.$filesView=t.$el.find(".files-view"),t.$uploadButton=t.$el.find("button.upload"),t.$dropzoneForm.prop("id",t.uid),t.$uploadButton.button(),t.initializeDownloader(),t.initializeDropzone(),t.initializeErrorHandler()),t}return A=i.View,s(R,A),R.prototype.onResize=function(){this.currentView&&this.currentView.onResize&&this.currentView.onResize()},R.prototype.onSettingsChange=function(e){var i=this;_.each(e,function(e,t){i.viewModel.set(R.SETTINGS_MAP[t],e)}),this.hasInit||(this.hasInit=!0,this.isLite)||this.postInit()},R.prototype.remove=function(){return this.$el.off(),this.isLite||(this.$dropzoneForm.off(),this.currentView&&this.currentView.remove(),this.dropzone.remove(),this.refreshTimer&&clearInterval(this.refreshTimer),this.$uploadButton.button("destroy")),i.View.prototype.remove.call(this)},R.prototype.loadTemplateLite=function(e){this.$el.html(a.appLite({server:this.api.getProperty("Basics.Server")?this.api.getProperty("Basics.Server"):"http://localhost",port:this.api.getProperty("Basics.Port")?":"+this.api.getProperty("Basics.Port"):"",theme:e.toLowerCase()})),this.api.setProperty("Basics.IsLite",!0)},R.prototype.setTheme=function(e){this.isLite&&this.loadTemplateLite(e)},R.prototype.initializeEvents=function(){this.$el.on("dragenter",this.onDragEnter.bind(this)),this.$el.on("dragleave drop",this.onDragLeave.bind(this)),this.$dropzoneForm.on("dragenter",this.onDragEnter.bind(this)),this.$dropzoneForm.on("dragleave drop",this.onDragLeave.bind(this)),this.$uploadButton.on("dragenter",this.onDragEnter.bind(this)),this.$uploadButton.on("dragleave drop",this.onDragLeave.bind(this)),this.listenTo(this.fileCollection,"add",this.onFileAdded.bind(this)),this.listenTo(this.fileCollection,"download-file",this.onDownloadFile.bind(this)),this.listenTo(this.fileCollection,"doActions",this.doActions.bind(this)),this.listenTo(this.fileCollection,"remove",this.onFileRemoved.bind(this)),this.listenTo(this.fileCollection,"change:isSelected",this.onSelect.bind(this)),this.listenTo(this.viewModel,"change:displayType change:RowHeight change:HeaderRowHeight",this.onDisplayTypeChanged.bind(this)),this.listenTo(this.viewModel,"change:downloadEnabled",this.onDownloadEnabledChanged.bind(this)),this.listenTo(this.viewModel,"change:directory change:server",this.getFiles.bind(this)),this.listenTo(this.viewModel,"change:refreshInterval",this.onRefreshIntervalChange.bind(this)),this.listenTo(this.viewModel,"change:uploadEnabled",this.onUploadEnabledChanged.bind(this))},R.prototype.doActions=function(o,n){var e=this.viewModel.get("Actions"),l=[];_.each(e,function(e,t){var i=e.Current||"",i=n[i];e.Trigger===o&&l.push(_.extend({},e,{_PropertyIndex:t,Value:i}))}),this.api.doActions(l,"Actions")},R.prototype.doFileActions=function(e,t,i,o){var n=this.dashboardViewModel.get("selectedDocumentId"),l=this.api.getDashboardName(n);this.api.onTransferAction({actions:this.api.getProperty("FileActions"),component:"Upload",dashboardId:n,dashboardName:l},e,void 0,o,e.substr(e.lastIndexOf(".")+1,e.length),this.api.humanFileSize(t),i)},R.prototype.getConnections=function(){function t(){i.servers=_.map(i.connections,function(e){return e.name}),i.api.setProperty("possible_servers",i.servers),i.viewModel.get("server")?i.getFiles():i.api.setProperty("Basics.Server",i.servers[0])}var i=this;this.connections=[{host:"<default>",name:"<default>"}],this.deltaClientLib.connectionCollectionSync("read",null,{success:function(e){_.isArray(e)&&(i.connections=i.connections.concat(_.filter(e,function(e){return"daemon"===e.type}))),t()},error:function(e){t(),n.Log.Error("Connections error",e)}})},R.prototype.getFiles=function(){var t=this,e=this.viewModel.get("directory"),i=this.getSelectedHost();e?-1!==e.indexOf("..")?this.viewModel.set("error",{error:'Directory can not contain ".."',type:"Error"}):this.viewModel.set("error",null):this.viewModel.set("error",{error:"Directory can not be blank.",type:"Error"}),i&&e?this.fetchingFiles||(this.fetchingFiles=!0,this.api.deltaClient.request("FileAccessAPI.getAvailableFiles",function(e){n.Log.Info("FileAccessAPI",e),t.fetchingFiles=!1,t.fileCollection.set(_.map(e,function(e){return r(r({},e),{downloadable:t.viewModel.get("downloadEnabled")})}))},function(e){t.fetchingFiles=!1,t.viewModel.set("error",{error:"FileAccessAPI error - "+e,type:"Error"})},i,e)):this.fileCollection.set([])},R.prototype.getSelectedHost=function(){var t=this,e=_.find(this.connections,function(e){return e.name===t.viewModel.get("server")});return e?e.host:""},R.prototype.getToken=function(t){var i=this;this.api.deltaClient.request("TokenAPI.getToken",function(e){n.Log.Info("TokenAPI",e),_.isFunction(t)&&t(e)},function(e){i.viewModel.set("error",{error:"TokenAPI error - "+e,type:"Error"}),_.isFunction(t)&&t(null,e)})},R.prototype.initializeDownloader=function(){this.isVirtualLinkSupported=(-1<navigator.userAgent.toLowerCase().indexOf("firefox")||-1<navigator.userAgent.toLowerCase().indexOf("safari"))&&-1===navigator.userAgent.toLowerCase().indexOf("chrome")},R.prototype.initializeDropzone=function(){var s=this;this.dropzone=new b({container:"#"+this.uid,dropzoneOptions:{url:this.api.deltaClient.connection.url+"/kxfileupload",clickable:this.$uploadButton[0],sending:function(e,t,i){i.append("client",s.api.deltaClient.base64DeltaClient()),i.append("dir",s.viewModel.get("directory")),i.append("server",s.getSelectedHost())}},fileCollection:this.fileCollection,onSubmitRequest:function(o,n,l){return s.getToken(function(e,t){var i="success";return e?(s.doFileActions(l[0].name,l[0].size,"upload",i),n.append("token",e),o.send(n)):(o.dispatchEvent(new Event("error")),o.abort(),(e=s.fileCollection.find(function(e){return e.get("name")===l[0].name&&e.get("directory")===l[0].directory}))&&e.set({errorMessage:i="TokenAPI Error "+t,uploadStatus:"error"}),s.doFileActions(l[0].name,l[0].size,"upload",i),!1)})},viewModel:this.viewModel})},R.prototype.initializeErrorHandler=function(){this.updateErrorMessage(),this.listenTo(this.viewModel,"change:error",this.updateErrorMessage.bind(this))},R.prototype.onDisplayTypeChanged=function(){var e=this.viewModel.get("displayType"),t=(this.currentView&&(this.currentView.remove(),this.$filesView.html("")),document.createElement("div"));this.$filesView.append(t),this.currentView="Table"===e?new E({el:t,api:this.api,dashboardViewModel:this.dashboardViewModel,fileCollection:this.fileCollection,settingsModel:this.settingsModel,viewModel:this.viewModel}):new k({el:t,fileCollection:this.fileCollection,viewModel:this.viewModel})},R.prototype.onDownloadEnabledChanged=function(){_.invokeMap(this.fileCollection.models,"set",{downloadable:this.viewModel.get("downloadEnabled")})},R.prototype.onDownloadFile=function(o){var n=this,l=o.get("directory"),s=o.get("name"),r=this.getSelectedHost();this.getToken(function(e,t){if(!e)return o.set({errorMessage:"TokenAPI Error "+t,uploadStatus:"error"}),!1;var i,t=n.api.deltaClient.connection.url+"/kxfiledownload?token="+encodeURIComponent(e)+"&filename="+encodeURIComponent(s)+"&dir="+encodeURIComponent(l)+"&server="+encodeURIComponent(r);n.isVirtualLinkSupported?((e=document.createElement("a")).href=t,void 0!==e.download&&(e.download=t.substring(t.lastIndexOf("/")+1,t.length)),document.createEvent&&((i=document.createEvent("MouseEvents")).initEvent("click",!0,!0),e.dispatchEvent(i))):window.open(t,"_blank","noopener,noreferrer,resizable"),n.doFileActions(s,o.get("size"),"download","success")})},R.prototype.onDragEnter=function(){if(this.viewModel.get("uploadEnabled"))return this.dragCounter+=1,this.$el.addClass("dragging"),!1},R.prototype.onDragLeave=function(){this.viewModel.get("uploadEnabled")&&(this.dragCounter=Math.max(0,this.dragCounter-1),0===this.dragCounter)&&this.$el.removeClass("dragging")},R.prototype.onFileAdded=function(e){this.dropzone.fileToOverwrite&&this.dropzone.fileToOverwrite.destroy(),this.viewModel.get("downloadEnabled")&&!e.get("uploadStatus")&&e.set("downloadable",!0)},R.prototype.onFileRemoved=function(e){e.destroy()},R.prototype.onRefreshIntervalChange=function(){var e=this,t=this.viewModel.get("refreshInterval");t%1!=0?this.api.setProperty("Basics.RefreshInterval",Math.round(t)):(this.refreshTimer&&clearInterval(this.refreshTimer),0<t&&(this.refreshTimer=setInterval(function(){_.isEmpty(e.dropzone.getActiveUploads())&&e.getFiles()},1e3*t)))},R.prototype.onSelect=function(t){var e;t.get("isSelected")&&(e=this.fileCollection.find(function(e){return!0===e.get("isSelected")&&e.cid!==t.cid}))&&e.set("isSelected",!1)},R.prototype.onUploadEnabledChanged=function(){this.viewModel.get("uploadEnabled")?this.$el.addClass("upload-enabled"):this.$el.removeClass("upload-enabled")},R.prototype.postInit=function(){this.initializeEvents(),this.getConnections(),this.onDisplayTypeChanged(),this.onDownloadEnabledChanged(),this.onRefreshIntervalChange(),this.onUploadEnabledChanged()},R.prototype.updateErrorMessage=function(){this.viewModel.get("error")?this.showErrorMessage(this.viewModel.get("error")):this.hideErrorMessage()},R.getComponentDefinition=e.getComponentDefinition,R.SETTINGS_MAP={"Basics.AcceptFileName":"acceptedFileNames","Basics.AcceptFileType":"acceptedFileTypes","Basics.UploadFileSizeRule":"uploadFileSizeRule","Basics.UploadFileSizeRuleError":"uploadFileSizeRuleError","Basics.Directory":"directory","Basics.DownloadEnabled":"downloadEnabled","Basics.UploadEnabled":"uploadEnabled","Basics.RefreshInterval":"refreshInterval","Basics.Server":"server","Style.DisplayType":"displayType","Style.RowHeight":"RowHeight","Style.HeaderRowHeight":"HeaderRowHeight",Actions:"Actions",ColumnsConfiguration:"ColumnsConfiguration"},R.APP_THEME="DashboardTheme",R});